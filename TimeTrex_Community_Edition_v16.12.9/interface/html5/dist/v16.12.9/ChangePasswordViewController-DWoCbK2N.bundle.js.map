{"version":3,"file":"ChangePasswordViewController-DWoCbK2N.bundle.js","sources":["../../views/my_account/password/ChangePasswordViewController.js"],"sourcesContent":["export class ChangePasswordViewController extends BaseViewController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tshowPassword: null,\n\n\t\t\tshowPhonePassword: null,\n\t\t\tmfa_type_array: null,\n\t\t\thas_authenticated: false,\n\t\t\tapi_authentication: null,\n\t\t\tapi_misc: null,\n\t\t\tapi_notification_device_token: null,\n\n\t\t\tresult_data: []\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinit( options ) {\n\n\t\t//this._super('initialize', options );\n\n\t\tthis.permission_id = 'user';\n\t\tthis.viewId = 'ChangePassword';\n\t\tthis.script_name = 'ChangePasswordView';\n\t\tthis.context_menu_name = $.i18n._( 'Passwords / Security' );\n\t\tthis.api = TTAPI.APIUser;\n\t\tthis.api_authentication = TTAPI.APIAuthentication;\n\t\tthis.api_notification_device_token = TTAPI.APINotificationDeviceToken;\n\t\tthis.api_misc = TTAPI.APIMisc;\n\n\t\tthis.initPermission();\n\n\t\tthis.render();\n\n\t\tthis.initData();\n\t}\n\n\tinitOptions( callback ) {\n\t\tvar options = [{ option_name: 'mfa_type' },];\n\n\t\tthis.initDropDownOptions( options, callback );\n\t}\n\n\tinitPermission() {\n\t\tsuper.initPermission();\n\n\t\tif ( PermissionManager.validate( 'user', 'edit_own_password' ) ) {\n\t\t\tthis.showPassword = true;\n\t\t} else {\n\t\t\tthis.showPassword = false;\n\t\t}\n\n\t\tif ( PermissionManager.validate( 'user', 'edit_own_phone_password' ) ) {\n\t\t\tthis.showPhonePassword = true;\n\t\t} else {\n\t\t\tthis.showPhonePassword = false;\n\t\t}\n\t}\n\n\trender() {\n\t\tsuper.render();\n\t}\n\n\tgetCustomContextMenuModel() {\n\t\tvar context_menu_model = {\n\t\t\tgroups: {\n\t\t\t\ttrusted: {\n\t\t\t\t\tlabel: $.i18n._( 'Trusted Device' ), id: this.viewId + 'trusted', sort_order: 8000\n\t\t\t\t}\n\t\t\t},\n\t\t\texclude: ['default'],\n\t\t\tinclude: [\n\t\t\t\t'save',\n\t\t\t\t'cancel',\n\t\t\t\t{\n\t\t\t\t\tlabel: '', //Empty label. vue_icon is displayed instead of text.\n\t\t\t\t\tid: 'other_header',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\taction_group: 'other',\n\t\t\t\t\taction_group_header: true,\n\t\t\t\t\tvue_icon: 'tticon tticon-more_vert_black_24dp',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Reauthenticate' ),\n\t\t\t\t\tid: 'reauthenticate',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\taction_group: 'other'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Register API Key' ),\n\t\t\t\t\tid: 'register_api_key',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\taction_group: 'other'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Remove All Trusted Devices' ),\n\t\t\t\t\tid: 'remove_all_trusted_devices',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\taction_group: 'other'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Sign Out All Sessions' ),\n\t\t\t\t\tid: 'logout_all_sessions',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\taction_group: 'other'\n\t\t\t\t},\n\t\t\t]\n\t\t};\n\n\t\treturn context_menu_model;\n\t}\n\n\tonCustomContextClick( id ) {\n\t\tswitch ( id ) {\n\t\t\tcase 'remove_all_trusted_devices':\n\t\t\t\tthis.removeAllTrustedDevices();\n\t\t\t\tbreak;\n\t\t\tcase 'reauthenticate':\n\t\t\t\tGlobal.showAuthenticationModal( this.viewId, 'user_name_multifactor', {\n\t\t\t\t\tstep: 'password',\n\t\t\t\t\ttype_id: 10,\n\t\t\t\t\tuser_action_message: ''\n\t\t\t\t}, true, ( result ) => {\n\t\t\t\t\tGlobal.hideAuthenticationModal();\n\t\t\t\t\tif ( result.status === true ) {\n\t\t\t\t\t\tthis.has_authenticated = true;\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\tcase 'register_api_key':\n\t\t\t\tthis.registerAPIKey();\n\t\t\t\tbreak;\n\t\t\tcase 'logout_all_sessions':\n\t\t\t\tthis.logoutAllSessions();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tregisterAPIKey() {\n\t\tthis.api_authentication.registerAPIKeyForCurrentUser( {\n\t\t\tonResult: ( result ) => {\n\t\t\t\tif ( result && result.isValid() ) {\n\t\t\t\t\tvar key = result.getResult();\n\t\t\t\t\tTAlertManager.showFlexAlert( $.i18n._( 'API Key' ), $.i18n._( 'Below is a new API key for ' ) + LocalCacheData.getLoginUser().user_name + $.i18n._( ' Please copy or write it down for safe keeping, as you will not be able to see it again after this.' ), 'text', key, null, 345, $.i18n._( 'Close' ) );\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t}\n\n\tlogoutAllSessions() {\n\t\tTAlertManager.showConfirmAlert( $.i18n._( 'Which sessions do you want to sign out? Note that your current session will not be signed out.' ), $.i18n._( 'Sign Out' ), ( flag ) => {\n\t\t\tthis.api_authentication.logoutAllSessions( !flag, {\n\t\t\t\tonResult: ( result ) => {\n\t\t\t\t\tif ( result && result.isValid() ) {\n\t\t\t\t\t\tTAlertManager.showAlert( $.i18n._( 'Sessions have been logged out.' ) );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\t\t}, $.i18n._( 'Browser/App' ), $.i18n._( '+API Keys' ) );\n\t}\n\n\tremoveAllTrustedDevices() {\n\t\tthis.api_authentication.removeAllTrustedDevices( {\n\t\t\tonResult: ( result ) => {\n\t\t\t\tTAlertManager.showAlert( $.i18n._( 'All trusted devices have been removed.' ), $.i18n._( 'Trusted Device' ) );\n\t\t\t}\n\t\t} );\n\t}\n\n\tsaveValidate( context_btn, p_id ) {\n\t\t// always show\n\t}\n\n\tsetCurrentEditRecordData() {\n\t\t//Set current edit record data to all widgets\n\n\t\tfor ( var key in this.current_edit_record ) {\n\t\t\tvar widget = this.edit_view_ui_dic[key];\n\t\t\tif ( Global.isSet( widget ) ) {\n\t\t\t\tswitch ( key ) {\n\t\t\t\t\tcase 'user_name':\n\t\t\t\t\t\twidget.setValue( LocalCacheData.loginUser.user_name );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'phone_id':\n\n\t\t\t\t\t\tif ( !LocalCacheData.loginUser.phone_id ) {\n\t\t\t\t\t\t\twidget.setValue( $.i18n._( 'Not Specified' ) );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twidget.setValue( LocalCacheData.loginUser.phone_id );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t\tthis.collectUIDataToCurrentEditRecord();\n\t\tthis.setEditViewDataDone();\n\t}\n\n\topenEditView() {\n\n\t\tvar $this = this;\n\n\t\tif ( $this.edit_only_mode && ( this.showPassword || this.showPhonePassword ) ) {\n\n\t\t\t$this.buildContextMenu();\n\n\t\t\t$this.initOptions( () => {\n\t\t\t\tif ( !$this.edit_view ) {\n\t\t\t\t\t$this.initEditViewUI( 'ChangePassword', 'ChangePasswordEditView.html' );\n\t\t\t\t}\n\n\t\t\t\t$this.getUserPasswordData( function( result ) {\n\t\t\t\t\t$this.current_edit_record = result;\n\t\t\t\t\t$this.initEditView();\n\t\t\t\t} );\n\t\t\t} );\n\n\t\t}\n\t}\n\n\tgetUserPasswordData( callBack ) {\n\t\tvar $this = this;\n\t\tvar filter = {};\n\t\tfilter.filter_data = {};\n\t\tfilter.filter_data.id = LocalCacheData.loginUser.id;\n\t\tfilter.filter_columns = { id: true, mfa_type_id: true };\n\n\t\t$this.api['get' + $this.api.key_name]( filter, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tvar result_data = result.getResult();\n\t\t\t\tif ( Global.isSet( result_data[0] ) ) {\n\t\t\t\t\tcallBack( result_data[0] );\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t}\n\n\tcheckTabPermissions( tab ) {\n\t\tvar retval = false;\n\n\t\tswitch ( tab ) {\n\t\t\tcase 'tab_web_password':\n\t\t\t\tif ( this.showPassword ) {\n\t\t\t\t\tretval = true;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'tab_quick_punch_password':\n\t\t\t\tif ( this.showPhonePassword ) {\n\t\t\t\t\tretval = true;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'tab_multifactor':\n\t\t\t\t//Current edit record is not set during initPermission, so we need to check if it's set here.\n\t\t\t\tif ( this.current_edit_record.mfa_type_id && this.current_edit_record.mfa_type_id != 1000 ) {\n\t\t\t\t\tretval = true;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tretval = super.checkTabPermissions( tab );\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn retval;\n\t}\n\n\tonFormItemChange( target, doNotValidate ) {\n\n\t\tthis.setIsChanged( target );\n\t\tthis.setMassEditingFieldsWhenFormChange( target );\n\n\t\tvar key = target.getField();\n\t\t//this.current_edit_record[key] = target.getValue();\n\t\tvar c_value = target.getValue();\n\n\t\tswitch ( key ) {\n\t\t\tcase 'mfa_type_id':\n\t\t\t\tif ( this.current_edit_record.mfa_type_id == 1000 ) {\n\t\t\t\t\t//This tab should never be displayed if SAML is enabled. However, if user is already on this tab when SAML is enabled, we prevent them switching MFA types.\n\t\t\t\t\ttarget.setValue( 0 ); //Do not allow dropdown to change, show disabled.\n\t\t\t\t\tthis.current_edit_record.mfa_type_id = 1000; //Keep mfa as 1000\n\t\t\t\t\tTAlertManager.showAlert( $.i18n._( 'SAML is enabled, you cannot change MFA settings.' ), $.i18n._( 'Error' ) );\n\t\t\t\t} else if ( this.current_edit_record.mfa_type_id != c_value && c_value != 0 && this.current_edit_record.mfa_type_id != 0 ) {\n\t\t\t\t\t//setUser() API does not allow changing mfa_type_id and we need to display this error here. (Validation also occurs server side)\n\t\t\t\t\ttarget.setValue( this.current_edit_record.mfa_type_id ); //Do not allow dropdown to change, user must select disable.\n\t\t\t\t\tTAlertManager.showAlert( $.i18n._( 'You must disable multifactor before switching to a different type.' ), $.i18n._( 'Error' ) );\n\t\t\t\t} else {\n\t\t\t\t\tthis.onMfaTypeChange( c_value, this.current_edit_record.mfa_type_id );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\tthis.current_edit_record[key] = c_value;\n\t}\n\n\ttoggleSaveButton( show_button ) {\n\t\tvar context_menu_array = ContextMenuManager.getMenuModelByMenuId( this.determineContextMenuMountAttributes().id );\n\n\t\tcontext_menu_array.forEach( ( context_btn ) => {\n\t\t\tif ( context_btn.id === 'save' ) {\n\t\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, show_button );\n\t\t\t}\n\t\t} );\n\t}\n\n\tonMfaTypeChange( mfa_type_id, old_mfa_type_id ) {\n\t\t//Disable \"Save\" button as the user may quickly press it before the QR code is generated, causing them to miss instructions.\n\t\tthis.toggleSaveButton( false );\n\n\t\t//Validate current user to make sure mfa settings can be saved\n\t\tthis.api.validateUser( { id: LocalCacheData.getLoginUser().id }, {\n\t\t\tonResult: ( result ) => {\n\t\t\t\tif ( result && result.isValid() == false ) {\n\t\t\t\t\tlet details = result.getDetails();\n\t\t\t\t\tlet error_string = $.i18n._( 'Validation Error. Unable to turn on Multifactor Authentication.<br><br>' );\n\n\t\t\t\t\tif ( Global.isArray( details ) || typeof details === 'object' ) {\n\t\t\t\t\t\terror_string += Global.convertValidationErrorToString( details );\n\t\t\t\t\t} else {\n\t\t\t\t\t\terror_string += result.getDescription();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.toggleSaveButton( true );\n\t\t\t\t\tTAlertManager.showAlert( error_string, $.i18n._( 'Error' ) );\n\t\t\t\t} else {\n\t\t\t\t\tif ( mfa_type_id == 0 ) { //Disabling MFA, the server will determine which MFA needs to be disabled\n\t\t\t\t\t\tthis.toggleSaveButton( true );\n\t\t\t\t\t\tthis.onSaveClick( false, true ); //Trigger save to instigate the disabling of authentication.\n\t\t\t\t\t} else if ( mfa_type_id == 10 ) { //Mobile app\n\t\t\t\t\t\tthis.showMfaInstructions( true ); //Internal TimeTrex MFA\n\t\t\t\t\t} else if ( mfa_type_id == 100 ) { //Webauthn passkeys\n\t\t\t\t\t\tTTWebauthn.enrollCurrentUser( () => {\n\t\t\t\t\t\t\tthis.toggleSaveButton( true );\n\t\t\t\t\t\t\tthis.onSaveClick();\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t//If we need to check app token exists\n\t\t\t\t// let data = {};\n\t\t\t\t// data.filter_data = { id: LocalCacheData.getLoginUser().id };\n\t\t\t\t// this.api_notification_device_token.getNotificationDeviceToken( data, {\n\t\t\t\t// \tonResult: ( res ) => {\n\t\t\t\t// \t\tresult = res.getResult();\n\t\t\t\t// \t\tif ( Array.isArray( result ) && result.length > 0 ) {\n\t\t\t\t// \t\t\tthis.showMfaInstructions( true );\n\t\t\t\t// \t\t} else {\n\t\t\t\t// \t\t\tthis.showMfaInstructions( false );\n\t\t\t\t// \t\t}\n\t\t\t\t// \t}\n\t\t\t\t// } );\n\t\t\t\t// }\n\t\t\t}\n\t\t} );\n\t}\n\n\tshowMfaInstructions( has_notification_device_token ) {\n\t\tthis.api_misc.generateQRCode( JSON.stringify( {\n\t\t\tserver_url: Global.getBaseURL( null, false ).replace( '/interface/html5/', '' ), //App does not need the /interface/html5/ part of the URL\n\t\t\tuser_name: LocalCacheData.getLoginUser().user_name\n\t\t} ), {\n\t\t\tonResult: ( res ) => {\n\t\t\t\tthis.toggleSaveButton( true );\n\n\t\t\t\tlet result = res.getResult();\n\t\t\t\tTAlertManager.showModalAlert( 'multifactor_authentication', 'download_instructions', ( flag ) => {\n\t\t\t\t\tif ( flag === true ) {\n\t\t\t\t\t\tthis.onSaveClick();\n\t\t\t\t\t}\n\t\t\t\t}, result );\n\t\t\t}\n\t\t} );\n\t}\n\n\tonSaveClick( ignoreWarning, disable_mfa ) {\n\t\tvar $this = this;\n\n\t\tvar record = this.current_edit_record;\n\t\tLocalCacheData.current_doing_context_action = 'save';\n\t\tif ( !Global.isSet( ignoreWarning ) ) {\n\t\t\tignoreWarning = false;\n\t\t}\n\t\tif ( !Global.isSet( disable_mfa ) ) {\n\t\t\tdisable_mfa = false;\n\t\t}\n\t\tthis.clearErrorTips();\n\n\t\tvar key = this.getEditViewTabIndex();\n\t\tif ( key === 0 ) {\n\t\t\t$this.saveWebPassword( record, function( result ) {\n\t\t\t\tif ( result && result.isValid() ) {\n\t\t\t\t\t$this.removeEditView();\n\t\t\t\t} else {\n\t\t\t\t\t$this.showErrorTips( result, 0 );\n\t\t\t\t}\n\n\t\t\t} );\n\t\t} else if ( key === 1 ) {\n\t\t\t$this.savePhonePassword( record, function( result ) {\n\t\t\t\tif ( result && result.isValid() ) {\n\t\t\t\t\t$this.removeEditView();\n\t\t\t\t} else {\n\t\t\t\t\t$this.showErrorTips( result, 1 );\n\t\t\t\t}\n\t\t\t} );\n\t\t} else if ( key === 2 ) {\n\t\t\t$this.saveMultiFactorSettings( disable_mfa, function( result ) {\n\t\t\t\tif ( result && result.isValid() ) {\n\t\t\t\t\t$this.removeEditView();\n\t\t\t\t} else {\n\t\t\t\t\t$this.showErrorTips( result, 1 );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t}\n\n\tshowErrorTips( result, index ) {\n\n\t\tvar details = result.getDetails();\n\t\tvar error_list = details;\n\t\tvar tabKey;\n\n\t\tvar found_in_current_tab = false;\n\t\tfor ( var key in error_list ) {\n\t\t\tif ( parseInt( index ) === 0 ) {\n\n\t\t\t\tif ( this.current_edit_record['web.password'] ) {\n\t\t\t\t\ttabKey = 'web.' + key;\n\t\t\t\t} else {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( parseInt( index ) === 1 ) {\n\t\t\t\tif ( this.current_edit_record['phone.password'] ) {\n\t\t\t\t\ttabKey = 'phone.' + key.replace( 'phone_', '' );\n\t\t\t\t} else {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( !error_list.hasOwnProperty( key ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif ( !Global.isSet( this.edit_view_ui_dic[tabKey] ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif ( this.edit_view_ui_dic[tabKey].is( ':visible' ) ) {\n\t\t\t\tthis.edit_view_ui_dic[tabKey].setErrorStyle( error_list[key], true );\n\t\t\t\tfound_in_current_tab = true;\n\t\t\t}\n\n\t\t\tthis.edit_view_error_ui_dic[tabKey] = this.edit_view_ui_dic[tabKey];\n\n\t\t}\n\n\t\tif ( !found_in_current_tab ) {\n\n\t\t\tthis.showEditViewError( result );\n\n\t\t}\n\t}\n\n\tsaveWebPassword( record, callBack ) {\n\t\tvar $this = this;\n\t\tthis.api['changePassword']( record['web.password'], record['web.password2'], 'user_name', {\n\t\t\tonResult: function( result ) {\n\t\t\t\tcallBack( result );\n\t\t\t}\n\t\t} );\n\t}\n\n\tsavePhonePassword( record, callBack ) {\n\t\tvar $this = this;\n\t\tthis.api['changePassword']( record['phone.password'], record['phone.password2'], 'quick_punch_id', {\n\t\t\tonResult: function( result ) {\n\t\t\t\tcallBack( result );\n\t\t\t}\n\t\t} );\n\t}\n\n\tsaveMultiFactorSettings( disable_mfa, callBack ) {\n\t\t//When disabling MFA set requested mfa_type_id to 0 as server will determine which mfa method needs to be disabled.\n\t\t//We do not this.current_edit_record.mfa_type_id or the dropdown until the MFA method has been verified.\n\t\tthis.api.setMultiFactorSettings( disable_mfa ? 0 : this.current_edit_record.mfa_type_id, {\n\t\t\tonResult: ( result ) => {\n\t\t\t\tcallBack( result );\n\t\t\t}\n\t\t} );\n\t}\n\n\tbuildEditViewUI() {\n\t\tvar $this = this;\n\t\tsuper.buildEditViewUI();\n\n\t\tvar tab_model = {\n\t\t\t'tab_web_password': { 'label': $.i18n._( 'Web Password' ) },\n\t\t\t'tab_quick_punch_password': { 'label': $.i18n._( 'Quick Punch Password' ) },\n\t\t\t'tab_multifactor': {\n\t\t\t\t'label': $.i18n._( 'Multifactor Authentication' ),\n\t\t\t\tinit_callback: 'initMultifactorView',\n\t\t\t\thtml_template: this.getMultifactorTabHtml()\n\t\t\t},\n\t\t};\n\t\tthis.setTabModel( tab_model );\n\n\t\t//Tab 0 start\n\n\t\tvar tab_web_password = this.edit_view_tab.find( '#tab_web_password' );\n\n\t\tvar tab_web_password_column1 = tab_web_password.find( '.first-column' );\n\n\t\tthis.edit_view_tabs[0] = [];\n\n\t\tthis.edit_view_tabs[0].push( tab_web_password_column1 );\n\n\t\t// User Name\n\t\tvar form_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\tform_item_input.TText( { field: 'user_name' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'User Name' ), form_item_input, tab_web_password_column1, '' );\n\n\t\t// New Password\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.PASSWORD_INPUT );\n\t\tform_item_input.TPasswordInput( { field: 'web.password', width: 200 } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'New Password' ), form_item_input, tab_web_password_column1 );\n\n\t\t// New Password(confirm)\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.PASSWORD_INPUT );\n\t\tform_item_input.TPasswordInput( { field: 'web.password2', width: 200 } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'New Password (Confirm)' ), form_item_input, tab_web_password_column1, '' );\n\n\t\t//Tab 1 start\n\n\t\tvar tab_quick_punch_password = this.edit_view_tab.find( '#tab_quick_punch_password' );\n\n\t\tvar tab_quick_punch_password_column1 = tab_quick_punch_password.find( '.first-column' );\n\n\t\tthis.edit_view_tabs[1] = [];\n\n\t\tthis.edit_view_tabs[1].push( tab_quick_punch_password_column1 );\n\n\t\t// Quick Punch ID\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\tform_item_input.TText( { field: 'phone_id' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Quick Punch ID' ), form_item_input, tab_quick_punch_password_column1, '' );\n\n\t\t// New Password\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.PASSWORD_INPUT );\n\t\tform_item_input.TPasswordInput( { field: 'phone.password', width: 200 } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'New Quick Punch Password' ), form_item_input, tab_quick_punch_password_column1 );\n\n\t\t// New Password(confirm)\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.PASSWORD_INPUT );\n\t\tform_item_input.TPasswordInput( { field: 'phone.password2', width: 200 } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'New Quick Punch Password (Confirm)' ), form_item_input, tab_quick_punch_password_column1, '' );\n\n\t\t//Tab 2 start\n\n\t\tvar tab_multifactor = this.edit_view_tab.find( '#tab_multifactor' );\n\t\tvar tab_multifactor_column1 = tab_multifactor.find( '.first-column' );\n\n\t\tthis.edit_view_tabs[1] = [];\n\t\tthis.edit_view_tabs[1].push( tab_multifactor_column1 );\n\n\t\t// Multifactor Authentication Type\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\t\tform_item_input.TComboBox( { field: 'mfa_type_id' } );\n\t\tform_item_input.setSourceData( this.mfa_type_array );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Multifactor Type' ), form_item_input, tab_multifactor_column1, '' );\n\t}\n\n\tinitMultifactorView() {\n\t\tif ( ( Global.getProductEdition() >= 15 ) ) {\n\t\t\tthis.edit_view_tab.find( '#tab_multifactor' ).find( '.first-column' ).css( 'display', 'block' );\n\t\t\tthis.edit_view.find( '.permission-defined-div' ).css( 'display', 'none' );\n\t\t} else {\n\t\t\tthis.edit_view_tab.find( '#tab_multifactor' ).find( '.first-column' ).css( 'display', 'none' );\n\t\t\tthis.edit_view.find( '.permission-defined-div' ).css( 'display', 'block' );\n\t\t\tthis.edit_view.find( '.permission-message' ).html( Global.getUpgradeMessage() );\n\t\t}\n\t}\n\n\tgetMultifactorTabHtml() {\n\t\treturn `\n\t\t<div id=\"tab_multifactor\" class=\"edit-view-tab-outside\">\n\t\t\t<div class=\"edit-view-tab\" id=\"tab_multifactor_content_div\">\n\t\t\t\t<div class=\"first-column full-width-column\"></div>\n\t\t\t\t<div class=\"save-and-continue-div permission-defined-div\">\n\t\t\t\t\t<span class=\"message permission-message\"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>`;\n\t}\n}"],"names":["ChangePasswordViewController","options","_","$","callback","context_menu_model","id","result","key","flag","context_btn","p_id","widget","$this","callBack","filter","result_data","tab","retval","target","doNotValidate","c_value","show_button","context_menu_array","mfa_type_id","old_mfa_type_id","details","error_string","has_notification_device_token","res","ignoreWarning","disable_mfa","record","index","error_list","tabKey","found_in_current_tab","tab_model","tab_web_password","tab_web_password_column1","form_item_input","tab_quick_punch_password","tab_quick_punch_password_column1","tab_multifactor","tab_multifactor_column1"],"mappings":"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"}