import{_ as T,j as _}from"./vendor-tTApdY0Y.bundle.js";import{b as C,G as u}from"./main_ui-z76rxVqJ.entry.bundle.js";class w extends C{constructor(t={}){T.defaults(t,{view_file:"",page_orientation_array:null,font_size_array:null,auto_refresh_array:null,chart_display_mode_array:null,chart_type_array:null,templates_array:null,setup_fields_array:null,log_action_id_array:null,log_table_name_id_array:null,time_period_array:null,visible_report_widgets:null,visible_report_values:null,visible_report_widgets_order_fix:null,status_id_array:null,api_user_report:null,current_saved_report:null,saved_report_array:null,sub_saved_report_view_controller:null,sub_custom_column_view_controller:null,need_refresh_display_columns:!1,ReportMissedField:null,include_form_setup:!1,show_empty_message:!1,do_validate_after_create_ui:!1,form_setup_changed:!1,is_report:!0}),super(t)}preInit(t){this.preInitReport()}init(t){this.real_this=this.constructor.__super__,this.permission_id="report",LocalCacheData.current_open_report_controller=this;var i=this;i.api_user_report=TTAPI.APIUserReportData,i.initReport(),TTPromise.resolve("Reports","openReport"),i.postInitReport()}preInitReport(t){}initReport(t){}postInitReport(t){}render(){}processFilterField(){}getDefaultReport(t){var i=T.find(t,function(e){return e.is_default===!0});return t&&t.length>0&&!i&&(i=t[0]),i}getDefaultContextMenuModel(){var t={groups:{editor:{label:_.i18n._("Editor"),id:"editor"},saved_report:{label:_.i18n._("Saved Report"),id:this.viewId+"SavedReport"}},icons:{}};return t.icons.view_html={label:_.i18n._("View"),id:"view_html",action_group:"view",group:"editor",vue_icon:"tticon tticon-visibility_black_24dp",show_on_right_click:!0},t.icons.view={label:_.i18n._("PDF"),id:"view",action_group:"view",group:"editor",vue_icon:"tticon tticon-picture_as_pdf_black_24dp"},t.icons.export_excel={label:_.i18n._("Excel"),id:"export_excel",action_group:"view",group:"editor",vue_icon:"tticon tticon-file_upload_black_24dp",sort_order:1800},t.icons.cancel={label:_.i18n._("Cancel"),id:"cancel",group:"editor",vue_icon:"tticon tticon-cancel_black_24dp",sort_order:1990},t.icons.save_existed_report={label:_.i18n._("Save"),id:"save_existed_report",action_group:"save",group:"saved_report",vue_icon:"tticon tticon-save_black_24dp",show_on_right_click:!0},t.icons.save_new_report={label:_.i18n._("Save as New"),id:"save_new_report",action_group:"save",group:"saved_report",vue_icon:"tticon tticon-save_black_24dp"},t}setDefaultMenuExportIcon(t,i,e){}openEditView(){var t=this;this.initOptions(function(){t.processFilterField(),t.edit_view||(t.initEditViewUI(t.viewId,t.view_file),t.buildContextMenu(),t.setEditMenu()),t.do_validate_after_create_ui=!0,TTPromise.wait("init","init",function(){if(LocalCacheData.default_edit_id_for_next_open_edit_view)t.navigation.setValue(LocalCacheData.default_edit_id_for_next_open_edit_view),t.api_user_report.getUserReportData({filter_data:{id:LocalCacheData.default_edit_id_for_next_open_edit_view}},{onResult:function(i){i=i.getResult(),t.current_saved_report=i[0],t.current_edit_record={},t.visible_report_values={},LocalCacheData.default_edit_id_for_next_open_edit_view=null,t.initEditView()}});else if(LocalCacheData.getAutoFillData()){let i=LocalCacheData.getAutoFillData();t.current_saved_report={},t.current_edit_record={},t.visible_report_values={},t.do_validate_after_create_ui=!1,t.initEditView(),TTPromise.wait("BaseViewController","initialize",()=>{var e;t.setSelectTemplate(i.config),t.edit_view_ui_dic.template.setValue((e=i.config)==null?void 0:e.template),LocalCacheData.setAutoFillData(null)})}else t.api_user_report.getUserReportData({filter_data:{script:t.script_name,is_default:!0}},{onResult:function(i){var e=i.getResult();t.current_saved_report={},e&&e.length>0&&(t.current_saved_report=e[0]),t.current_edit_record={},t.visible_report_values={},t.initEditView()}})})})}setDefaultConfigData(){var t=this;this.api.getOtherConfig({onResult:function(i){if(!(t.current_saved_report&&t.current_saved_report.data&&t.current_saved_report.data.config&&t.current_saved_report.data.config.other)){i=i.getResult();for(var e in i)t.edit_view_ui_dic.hasOwnProperty(e)&&(t.edit_view_ui_dic[e].setValue(i[e]),t.current_edit_record[e]=i[e])}}}),this.api.getChartConfig({onResult:function(i){if(!(t.current_saved_report&&t.current_saved_report.data&&t.current_saved_report.data.config&&t.current_saved_report.data.config.chart)){i=i.getResult();for(var e in i)t.edit_view_ui_dic.hasOwnProperty(e)&&(t.edit_view_ui_dic[e].setValue(i[e]),t.current_edit_record[e]=i[e])}}})}setTabStatus(){}initTabData(){}getReportData(t){var i=this,e={};e.filter_data={script:this.script_name},this.api_user_report.getUserReportData(e,{onResult:function(a){var s=a.getResult();i.pager_data=a.getPagerData(),t(s)}})}initOptions(t){var i=[{option_name:"page_orientation"},{option_name:"font_size"},{option_name:"auto_refresh"},{option_name:"chart_display_mode"},{option_name:"chart_type"},{option_name:"templates"},{option_name:"setup_fields"}];this.initDropDownOptions(i,function(e){t(e)})}initEditViewData(){var t=this.edit_view.find(".navigation-div");if(t.css("display","block"),!this.navigation.getSourceData()){this.navigation.setSourceData(this.saved_report_array),LocalCacheData.getLoginUserPreference()&&this.navigation.setRowPerPage(LocalCacheData.getLoginUserPreference().items_per_page),this.navigation.setPagerData(this.pager_data);var i={};i.filter_data={script:this.script_name},this.navigation.setDefaultArgs(i)}this.navigation.setValue(this.current_saved_report),this.setUIWidgetFieldsToCurrentEditRecord(),this.setNavigationArrowsEnabled(),this.setCurrentEditRecordData(),this.edit_view.find(".save-and-continue-div").SaveAndContinueBox({related_view_controller:this}),this.edit_view.find(".save-and-continue-div").css("display","none")}onRightOrLeftArrowClickCallBack(t){this.navigation.setValue(t),this.current_saved_report=t,this.current_edit_record={},this.visible_report_values={},this.initEditView()}initEditView(){var t=this,i=window.location.href;if(i.indexOf("&sm")>0&&(i=i.substring(0,i.indexOf("&sm"))),t.current_saved_report&&t.current_saved_report.id?i=i+"&sm="+t.viewId+"&sid="+t.current_saved_report.id:i=i+"&sm="+t.viewId,window.location.href.indexOf("&tab=")>0){var e=window.location.href;e=e.substr(window.location.href.indexOf("&tab=")+5),e=e.substr(0,window.location.href.indexOf("&")),i+="&tab="+e}u.setURLToBrowser(i),super.initEditView()}setNavigation(){var t=this;this.navigation.off("formItemChange").on("formItemChange",function(i,e){var a=e.getValue();if(t.edit_view_error_ui_dic={},!a||a===TTUUID.zero_id){t.current_saved_report=null,t.saved_report_array=[],t.current_edit_record={},t.visible_report_values={},t.do_validate_after_create_ui=!0,t.initEditView();return}a!==t.current_edit_record.id&&(t.current_saved_report=e.getValue(!0),t.current_edit_record={},t.visible_report_values={},t.initEditView()),u.triggerAnalyticsEditViewNavigation("navigation",t.viewId)})}initSubCustomColumnView(t){var i=this;if(i.sub_view_mode=!0,this.sub_custom_column_view_controller){i.sub_custom_column_view_controller.edit_only_mode=!1,i.sub_custom_column_view_controller.buildContextMenu(!0),i.sub_custom_column_view_controller.parent_value=this.script_name,i.sub_custom_column_view_controller.initData();return}u.loadViewSource("CustomColumn","CustomColumnViewController.js",function(){var s=i.edit_view_tab.find("#tab_custom_columns"),c=s.find(".first-column-sub-view");TTPromise.add("SubCustomColumnView","init"),TTPromise.wait("SubCustomColumnView","init",function(){c.css("opacity","1")}),c.css("opacity","0"),u.trackView("SubReportScheduleView"),CustomColumnViewController.loadSubView(c,e,a)});function e(){}function a(s){i.sub_custom_column_view_controller=s,i.sub_custom_column_view_controller.parent_key="script",i.sub_custom_column_view_controller.parent_value=i.script_name,i.sub_custom_column_view_controller.parent_view_controller=i,i.sub_custom_column_view_controller.edit_only_mode=!1,i.sub_custom_column_view_controller.sub_view_mode=!0,t&&t(),i.sub_custom_column_view_controller.initData()}}onSavedReportDelete(){this.refreshNav()}initSubSavedReportView(t){var i=this;if(i.sub_view_mode=!0,this.sub_saved_report_view_controller){i.sub_saved_report_view_controller.edit_only_mode=!1,i.sub_saved_report_view_controller.buildContextMenu(!0),i.sub_saved_report_view_controller.parent_value=this.script_name,i.sub_saved_report_view_controller.initData();return}u.loadViewSource("SavedReport","SavedReportViewController.js",function(){var s=i.edit_view_tab.find("#tab_saved_reports"),c=s.find(".first-column-sub-view");TTPromise.add("SubSavedReportView","init"),TTPromise.wait("SubSavedReportView","init",function(){c.css("opacity","1")}),c.css("opacity","0"),u.trackView("SubReportScheduleView"),SavedReportViewController.loadSubView(c,e,a)});function e(){}function a(s){i.sub_saved_report_view_controller=s,i.sub_saved_report_view_controller.parent_key="script",i.sub_saved_report_view_controller.parent_value=i.script_name,i.sub_saved_report_view_controller.parent_view_controller=i,i.sub_saved_report_view_controller.edit_only_mode=!1,i.sub_saved_report_view_controller.sub_view_mode=!0,t?t():i.sub_saved_report_view_controller.initData()}}buildEditViewUI(){var t=this;this.initEditViewTabs();var i=this.edit_view.find(".navigation-div"),e=i.find(".navigation-label"),a=i.find(".left-click"),s=i.find(".right-click"),c=i.find(".navigation-widget-div");this.initNavigationWidget(c),a.attr("src",u.getRealImagePath("images/left_arrow.svg")),s.attr("src",u.getRealImagePath("images/right_arrow.svg")),e.text(this.navigation_label),this.edit_view_close_icon=this.edit_view.find(".close-icon"),this.edit_view_close_icon.hide(),this.edit_view_close_icon.click(function(){t.onCloseIconClick()});var h=this.edit_view.find("a[ref=tab_report]"),b=this.edit_view.find("a[ref=tab_setup]"),o=this.edit_view.find("a[ref=tab_chart]");if(this.include_form_setup){var d=this.edit_view.find("a[ref=tab_form_setup]"),r=this.edit_view.find("a[ref=tab_custom_columns]"),n=this.edit_view.find("a[ref=tab_saved_reports]");h.text(_.i18n._("Report")),b.text(_.i18n._("Setup")),o.text(_.i18n._("Chart")),d.text(_.i18n._("Form Setup")),r.text(_.i18n._("Custom Columns")),n.text(_.i18n._("Saved Reports")),this.buildFormSetupUI()}else{var d=this.edit_view.find("a[ref=tab_custom_columns]"),r=this.edit_view.find("a[ref=tab_saved_reports]");h.text(_.i18n._("Report")),b.text(_.i18n._("Setup")),o.text(_.i18n._("Chart")),d.text(_.i18n._("Custom Columns")),r.text(_.i18n._("Saved Reports"))}this.navigation.AComboBox({api_class:TTAPI.APIUserReportData,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_user_report_data",default_args:{filter_data:{script:this.script_name}},navigation_mode:!0,show_search_inputs:!0,set_empty:!0,always_search_full_columns:!0}),this.setNavigation(),this.saved_report_array==null&&(this.navigation.setSourceData(null),t.getReportData(function(y){y&&y.length>0?t.saved_report_array=y:t.saved_report_array=[]}));var l=this.edit_view_tab.find("#tab_report"),m=l.find(".first-column"),p=u.loadWidgetByName(FormItemType.COMBO_BOX);p.TComboBox({field:"template",set_empty:!0}),p.setSourceData(t.templates_array),this.addEditFieldToColumn(_.i18n._("Template"),p,m);var g=this.edit_view_tab.find("#tab_setup"),v=g.find(".first-column");p=u.loadWidgetByName(FormItemType.AWESOME_BOX),p.AComboBox({allow_multiple_selection:!0,key:"value",layout_name:"global_option_column",allow_drag_to_order:!0,set_empty:!0,field:"setup_field"}),this.addEditFieldToColumn(_.i18n._("Fields"),p,v,""),this.setup_fields_array.shift(),p.setSourceData(this.setup_fields_array),p=u.loadWidgetByName(FormItemType.COMBO_BOX),p.TComboBox({field:"page_orientation",set_empty:!1}),p.setSourceData(t.page_orientation_array),this.addEditFieldToColumn(_.i18n._("Page Orientation"),p,v),p=u.loadWidgetByName(FormItemType.COMBO_BOX),p.TComboBox({field:"font_size",set_empty:!1}),p.setSourceData(t.font_size_array),this.addEditFieldToColumn(_.i18n._("Font Size"),p,v),p=u.loadWidgetByName(FormItemType.CHECKBOX),p.TCheckbox({field:"disable_grand_total"}),this.addEditFieldToColumn(_.i18n._("Disable Grand Total"),p,v),p=u.loadWidgetByName(FormItemType.CHECKBOX),p.TCheckbox({field:"show_duplicate_values"}),this.addEditFieldToColumn(_.i18n._("Show Duplicate Values"),p,v),p=u.loadWidgetByName(FormItemType.COMBO_BOX),p.TComboBox({field:"auto_refresh",set_empty:!1}),p.setSourceData(t.auto_refresh_array),this.addEditFieldToColumn(_.i18n._("Auto-Refresh"),p,v),p=u.loadWidgetByName(FormItemType.TEXT_INPUT),p.TTextInput({field:"maximum_page_limit",width:50}),this.addEditFieldToColumn(_.i18n._("Maximum Pages"),p,v);var I=this.edit_view_tab.find("#tab_chart"),f=I.find(".first-column");p=u.loadWidgetByName(FormItemType.CHECKBOX),p.TCheckbox({field:"enable"}),this.addEditFieldToColumn(_.i18n._("Enable"),p,f,""),p=u.loadWidgetByName(FormItemType.COMBO_BOX),p.TComboBox({field:"display_mode",set_empty:!1}),p.setSourceData(t.chart_display_mode_array),this.addEditFieldToColumn(_.i18n._("Display"),p,f),p=u.loadWidgetByName(FormItemType.COMBO_BOX),p.TComboBox({field:"type",set_empty:!1}),p.setSourceData(t.chart_type_array),this.addEditFieldToColumn(_.i18n._("Type"),p,f),p=u.loadWidgetByName(FormItemType.CHECKBOX),p.TCheckbox({field:"include_sub_total"}),this.addEditFieldToColumn(_.i18n._("Chart Sub-Totals"),p,f),p=u.loadWidgetByName(FormItemType.CHECKBOX),p.TCheckbox({field:"axis_scale_static"}),this.addEditFieldToColumn(_.i18n._("Consistent Axis Scales"),p,f),p=u.loadWidgetByName(FormItemType.CHECKBOX),p.TCheckbox({field:"combine_columns"}),this.addEditFieldToColumn(_.i18n._("Combine Columns"),p,f,""),TTPromise.resolve("init","init")}buildFormSetupUI(){}buildSelectTemplateData(){for(var t=this.current_saved_report.data.template,i=this.current_saved_report.data.config,e={},a=0;a<t.length;a++){var s=t[a];e[s]=i[s]}return e}setCurrentEditRecordData(){var t=this;if(LocalCacheData.default_filter_for_next_open_view)this.do_validate_after_create_ui=!1,this.current_edit_record.template=LocalCacheData.default_filter_for_next_open_view.template,t.onTemplateChange(this.current_edit_record.template),LocalCacheData.default_filter_for_next_open_view=null;else if(this.current_saved_report&&this.current_saved_report.data){var i=this.buildSelectTemplateData();this.setSelectTemplate(i),this.current_edit_record.template=this.current_saved_report.data.config.template;for(var e in this.current_saved_report.data.config.other)this.current_saved_report.data.config.other.hasOwnProperty(e)&&(this.current_edit_record[e]=this.current_saved_report.data.config.other[e]);for(var a in this.current_saved_report.data.config.chart)this.current_saved_report.data.config.chart.hasOwnProperty(a)&&(this.current_edit_record[a]=this.current_saved_report.data.config.chart[a])}else LocalCacheData.getAutoFillData()||(this.do_validate_after_create_ui=!1,this.onTemplateChange(this.templates_array[1].id),this.current_edit_record.template=this.templates_array[1].id);for(var s in this.current_edit_record)if(this.current_edit_record.hasOwnProperty(s)){var c=this.edit_view_ui_dic[s];if(u.isSet(c))switch(s){case"user_id":c.setValue(this.current_edit_record[s]);break;case"country":this.setCountryValue(c,s);break;default:c.setValue(this.current_edit_record[s]);break}}this.include_form_setup&&this.api.getCompanyFormConfig({onResult:function(h){var b=h.getResult();b.length==1&&b.hasOwnProperty("0")&&b[0]===!1||t.setFormSetupData(b)}}),this.collectUIDataToCurrentEditRecord(),this.setDefaultConfigData(),this.setEditViewDataDone()}setEditViewDataDone(){if(this.setTabOVisibility(!0),this.do_validate_after_create_ui&&(this.validate(),this.do_validate_after_create_ui=!1),this.initRightClickMenuForViewButton(),window.location.href.indexOf("&tab=")>0){var t=window.location.href;t=t.substr(window.location.href.indexOf("&tab=")+5),t=t.substr(0,window.location.href.indexOf("&"));for(var i=this.edit_view_tab.find(".edit-view-tab-bar-label").children(),e=0;e<i;e++)if(_(i[e]).find("a").length>0&&t==_(i[e]).find("a").html().replace(/\/|\s+/g,"")){_(i[e]).find("a").click();break}}TTPromise.resolve("init","init"),_(".edit-view-tab-bar").css("opacity",1)}initRightClickMenuForViewButton(){var t=this,i="#viewHTMLIcon";if(_(i).length!=0){var e=this.getViewButtonRightClickItems();!e||_.isEmptyObject(e)||(_.contextMenu("destroy",i),_.contextMenu({selector:i,callback:function(a,s){t.onContextMenuClick(null,a)},onContextMenu:function(){return!1},items:e,zIndex:50}))}}getViewButtonRightClickItems(){var t={};t.viewHTMLIcon={name:_.i18n._("View"),icon:"viewHTMLIcon",disabled:function(){return i()}},t.viewHTMLNewWindow={name:_.i18n._("View (New Window)"),icon:"viewHTMLIcon",disabled:function(){return i()}};function i(){return!!_("#viewHTMLIcon").parent().hasClass("disable-image")}return t}onFormItemChangeProcessFilterField(){}preFormItemChange(t,i){return!0}onFormItemChange(t,i){this.preFormItemChange(t);var e=this;this.setIsChanged(t);var a=t.getField(),s,c,h,b,o;if(this.visible_report_widgets&&(this.visible_report_widgets[a]||a==="start_date"||a==="end_date"||a==="pay_period_id"||a==="pay_period_schedule_id"))if(a==="sort")this.visible_report_values[a]=t.getValue(!0);else if(a.indexOf("time_period")>=0)s=t.getValue(),(!this.visible_report_values[a]||this.visible_report_values[a].time_period!==s)&&(this.visible_report_values[a]={time_period:s},this.onTimePeriodChange(t));else if(a==="filter")this.onFormItemChangeProcessFilterField(t,a);else if(a==="start_date"||a==="end_date"||a==="pay_period_id"||a==="pay_period_schedule_id")s=this.visible_report_values[t.attr("time_period_key")?t.attr("time_period_key"):"time_period"],s[a]=t.getValue();else if(a==="membership_renewal_date")h=t.getValue(),this.visible_report_values[a]={time_period:h},this.onMembershipRenewalDateChange(t);else if(a==="start_date_1"||a==="end_date_1"||a==="pay_period_id_1"||a==="pay_period_schedule_id_1")h=this.visible_report_values.membership_renewal_date,h[a.replace("_1","")]=t.getValue();else if(a==="skill_expiry_date")c=t.getValue(),this.visible_report_values[a]={time_period:c},this.onSkillExpiryDate(t);else if(a==="start_date_2"||a==="end_date_2"||a==="pay_period_id_2"||a==="pay_period_schedule_id_2")c=this.visible_report_values.skill_expiry_date,c[a.replace("_2","")]=t.getValue();else if(a==="license_expiry_date")b=t.getValue(),this.visible_report_values[a]={time_period:b},this.onLicenseExpiryDate(t);else if(a==="start_date_3"||a==="end_date_3"||a==="pay_period_id_3"||a==="pay_period_schedule_id_3")b=this.visible_report_values.license_expiry_date,b[a.replace("_3","")]=t.getValue();else if(a==="education_graduate_date")o=t.getValue(),this.visible_report_values[a]={time_period:o},this.onEducationGraduateDate(t);else if(a==="start_date_4"||a==="end_date_4"||a==="pay_period_id_4"||a==="pay_period_schedule_id_4")o=this.visible_report_values.education_graduate_date,o[a.replace("_4","")]=t.getValue();else if(t.hasClass("t-checkbox"))this.visible_report_values[a]=t.getValue();else{var d=t.getValue();d&&(_.type(d)!=="array"||d.length>0)&&d!=TTUUID.zero_id?this.visible_report_values[a]=t.getValue():delete this.visible_report_values[a]}else this.current_edit_record[a]=t.getValue();a==="template"?(e.onTemplateChange(this.current_edit_record[a]),e.setEditMenu()):i||this.validate(),this.include_form_setup&&a===3&&(this.form_setup_changed=!0)}onTemplateChange(t){var i=this;this.api.getTemplate(t,{onResult:function(e){var a=e.getResult();i.setSelectTemplate(a)}})}setSelectTemplate(t){var i=this,e=u.buildRecordArray(t),a=e.length;if(i.current_edit_record){i.current_edit_record.setup_field=[],i.visible_report_values={};for(var s=0;s<a;s++){var c=e[s];c.value!=="template"&&(i.visible_report_values[c.value]=c.label,i.current_edit_record.setup_field.push(c.value))}i.createUI(e)}}getFieldLabel(t){for(var i=this.setup_fields_array.length,e=0;e<i;e++){var a=this.setup_fields_array[e];if(a.value===t)return a.label}}createUI(t){this.cleanUI();var i=this,e=t.length,a=this.edit_view_tab.find("#tab_report"),s=a.find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(s),this.visible_report_widgets={},this.edit_view_form_item_dic={},this.visible_report_widgets_order_fix={};var c=this.visible_report_values;this.visible_report_values={};for(var h=1001,b=0;b<e;b++){var o=t[b],d="",r="";o.value?d=o.value:d=o,r=c[d];var n=this.getUIWidget(d);!n||!this.getFieldLabel(d)||(d.indexOf("time_period")>=0||d==="membership_renewal_date"||d==="skill_expiry_date"||d=="license_expiry_date"||d=="education_graduate_date"?(this.addEditFieldToColumn(_.i18n._(this.getFieldLabel(d)),n,s,"",null,!0,!0),i.edit_view_form_item_dic[d].attr("id","report_"+d+"_div")):this.addEditFieldToColumn(_.i18n._(this.getFieldLabel(d)),n,s,"",null,!0),r&&(d.indexOf("time_period")>=0?(n.setValue(r.time_period),i.onTimePeriodChange(n,r)):d==="membership_renewal_date"?(n.setValue(r.time_period),i.onMembershipRenewalDateChange(n,r)):d==="skill_expiry_date"?(n.setValue(r.time_period),i.onSkillExpiryDate(n,r)):d==="license_expiry_date"?(n.setValue(r.time_period),i.onLicenseExpiryDate(n,r)):d==="education_graduate_date"?(n.setValue(r.time_period),i.onEducationGraduateDate(n,r)):d==="filter"?i.setFilterValue(n,r):n.setValue(r)),this.initSourceData(d,n),delete this.current_edit_record[d],n.hasClass("t-checkbox")?this.visible_report_values[d]=r:r&&(this.visible_report_values[d]=r),this.visible_report_widgets[d]=n,this.visible_report_widgets_order_fix[d]=h,h=h+1)}this.setEditViewWidgetsMode(),this.need_refresh_display_columns=!1,this.editFieldResize(0)}onTabShow(t){var i=_(t.target).tabs("option","active");if(this.editFieldResize(i),!!this.current_edit_record){var e=this.getEditViewTabIndex();this.include_form_setup?((e===1||this.need_refresh_display_columns)&&i===0?(this.buildReportUIBaseOnSetupFields(),this.buildContextMenu(!0),this.setEditMenu()):i===1?(this.edit_view_ui_dic.setup_field.setValue(this.current_edit_record.setup_field),u.getProductEdition()==10&&this.edit_view_ui_dic.auto_refresh.parent().parent().css("display","none"),this.buildContextMenu(!0),this.setEditMenu()):i===2?u.getProductEdition()>=15?(this.edit_view_tab.find("#tab_chart").find(".first-column").css("display","block"),this.edit_view.find(".permission-defined-div").css("display","none")):(this.edit_view_tab.find("#tab_chart").find(".first-column").css("display","none"),this.edit_view.find(".permission-defined-div").css("display","block"),this.edit_view.find(".permission-message").html(u.getUpgradeMessage())):i===4?u.getProductEdition()>=15?(this.edit_view_tab.find("#tab_form_setup").find(".first-column-sub-view").css("display","block"),this.edit_view.find(".permission-defined-div").css("display","none"),this.initSubCustomColumnView()):(this.edit_view_tab.find("#tab_form_setup").find(".first-column-sub-view").css("display","none"),this.edit_view.find(".permission-defined-div").css("display","block"),this.edit_view.find(".permission-message").html(u.getUpgradeMessage())):i===5?this.initSubSavedReportView():(this.buildContextMenu(!0),this.setEditMenu()),this.checkFormSetupSaved(e)):(e===1||this.need_refresh_display_columns)&&i===0?(this.buildReportUIBaseOnSetupFields(),this.buildContextMenu(!0),this.setEditMenu()):i===1?(this.edit_view_ui_dic.setup_field.setValue(this.current_edit_record.setup_field),u.getProductEdition()==10&&this.edit_view_ui_dic.auto_refresh.parent().parent().css("display","none"),this.buildContextMenu(!0),this.setEditMenu()):i===2?u.getProductEdition()>=15?(this.edit_view_tab.find("#tab_chart").find(".first-column").css("display","block"),this.edit_view.find(".permission-defined-div").css("display","none")):(this.edit_view_tab.find("#tab_chart").find(".first-column").css("display","none"),this.edit_view.find(".permission-defined-div").css("display","block"),this.edit_view.find(".permission-message").html(u.getUpgradeMessage())):i===3?u.getProductEdition()>=15?(this.edit_view_tab.find("#tab_custom_columns").find(".first-column-sub-view").css("display","block"),this.edit_view.find(".permission-defined-div").css("display","none"),this.initSubCustomColumnView()):(this.edit_view_tab.find("#tab_custom_columns").find(".first-column-sub-view").css("display","none"),this.edit_view.find(".permission-defined-div").css("display","block"),this.edit_view.find(".permission-message").html(u.getUpgradeMessage())):i===4?this.initSubSavedReportView():(this.buildContextMenu(!0),this.setEditMenu()),i===0&&this.validate()}}checkFormSetupSaved(t,i){var e=this;i==null&&(i=_.i18n._("Form Setup")),t===3&&this.form_setup_changed&&(e.form_setup_changed=!1,TAlertManager.showConfirmAlert(_.i18n._("You have modified")+" "+i+" "+_.i18n._("data without saving, would you like to save your data now?"),"",function(a){a&&e.onSaveSetup(i)}))}cleanUI(){for(var t in this.edit_view_form_item_dic)if(this.edit_view_form_item_dic.hasOwnProperty(t)){var i=this.edit_view_form_item_dic[t];typeof i.getField>"u"&&t.indexOf("separated_")!=-1||i.remove()}if(this.edit_view_tab){var e=this.edit_view_tab.find("#tab_report"),a=e.find(".first-column"),s=a.find(".clear-both-div");s.remove()}_(".errortip-box").remove(),_(".errortip-box").remove()}removeEditView(){super.removeEditView(),this.sub_custom_column_view_controller=null,this.sub_saved_report_view_controller=null,LocalCacheData.current_open_report_controller=null}getUIWidget(t){var i;if(t.indexOf("time_period")>=0)i=this.getSimpleTComboBox(t,!1);else switch(t){case"is_reprint":i=this.getCheckBox(t);break;case"columns":case"sub_total":case"group":case"page_break":case"user_review_control_type_id":case"user_review_control_status_id":case"severity_id":case"term_id":case"kpi_type_id":case"kpi_status_id":case"fluency_id":case"qualification_type_id":case"proficiency_id":case"competency_id":case"ownership_id":case"invoice_status_id":case"user_status_id":case"pay_stub_status_id":case"filter":case"pay_period_time_sheet_verify_status_id":case"job_status_id":case"job_item_status_id":case"client_status_id":case"product_type_id":case"custom_filter":case"log_action_id":case"log_table_name_id":case"accrual_type_id":case"accrual_policy_type_id":case"exception_policy_severity_id":case"exception_policy_type_id":case"expense_policy_require_receipt_id":case"expense_policy_type_id":case"user_expense_payment_method_id":case"user_expense_status_id":case"job_applicant_sex_id":case"job_applicant_status_id":case"job_application_status_id":case"job_application_type_id":case"job_vacancy_employment_status_id":case"job_vacancy_level_id":case"job_vacancy_status_id":case"job_vacancy_type_id":case"job_vacancy_wage_type_id":case"pay_stub_run_id":case"pay_stub_type_id":case"remittance_source_account_type_id":case"transaction_type_id":case"transaction_status_id":i=this.getSimpleTComboBox(t);break;case"sort":i=this.getSortComboBox(t);break;case"license_expiry_date":case"membership_renewal_date":case"skill_expiry_date":case"education_graduate_date":i=this.getComboBox(t);break;case"user_group_id":case"qualification_group_id":case"kpi_group_id":case"job_group_id":case"job_item_group_id":case"client_group_id":case"product_group_id":i=this.getTreeModeAComboBox(t);break;case"user_tag":case"review_tag":case"job_tag":case"job_item_tag":i=this.getTag(t);break;case"include_user_id":case"exclude_user_id":case"client_sales_contact_id":case"created_by_id":case"updated_by_id":case"include_reviewer_user_id":case"exclude_reviewer_user_id":case"job_applicant_interviewer_user_id":case"job_application_interviewer_user_id":i=this.getTComboBox(t,"global_user",TTAPI.APIUser);break;case"user_title_id":i=this.getTComboBox(t,"global_user_title",TTAPI.APIUserTitle);break;case"payroll_remittance_agency_id":i=this.getTComboBox(t,"global_payroll_remittance_agency",TTAPI.APIPayrollRemittanceAgency);break;case"legal_entity_id":i=this.getTComboBox(t,"global_legal_entity",TTAPI.APILegalEntity);break;case"policy_group_id":i=this.getTComboBox(t,"global_policy_group",TTAPI.APIPolicyGroup);break;case"default_branch_id":case"schedule_branch_id":case"punch_branch_id":i=this.getTComboBox(t,"global_branch",TTAPI.APIBranch);break;case"default_department_id":case"schedule_department_id":case"punch_department_id":i=this.getTComboBox(t,"global_department",TTAPI.APIDepartment);break;case"default_job_id":case"punch_job_id":case"include_job_id":case"exclude_job_id":i=this.getTComboBox(t,"global_job",TTAPI.APIJob);break;case"default_job_item_id":case"punch_job_item_id":case"include_job_item_id":case"exclude_job_item_id":i=this.getTComboBox(t,"global_job_item",TTAPI.APIJobItem);break;case"absence_policy_id":i=this.getTComboBox(t,"global_absences",TTAPI.APIAbsencePolicy);break;case"currency_id":i=this.getTComboBox(t,"global_currency",TTAPI.APICurrency);break;case"include_no_data_rows":case"exclude_ytd_adjustment":case"show_child_expenses":i=this.getCheckBox(t);break;case"accrual_policy_id":i=this.getTComboBox(t,"global_accrual",TTAPI.APIAccrualPolicy);break;case"pay_period_id":i=this.getTComboBox(t,"global_Pay_period",TTAPI.APIPayPeriod);break;case"job_id":u.getProductEdition()>=20&&(i=this.getTComboBox(t,"global_job",TTAPI.APIJob));break;case"job_item_id":u.getProductEdition()>=20&&(i=this.getTComboBox(t,"global_job_item",TTAPI.APIJobItem));break;case"default_punch_tag_id":case"punch_tag_id":u.getProductEdition()>=20&&(i=this.getTComboBox(t,"global_punch_tag",TTAPI.APIPunchTag));break;case"expense_policy_id":i=this.getTComboBox(t,"global_expense_policy",TTAPI.APIExpensePolicy);break;case"pay_stub_entry_account_id":i=this.getTComboBox(t,"global_PayStubAccount",TTAPI.APIPayStubEntryAccount);break;case"product_id":case"exclude_product_id":case"include_product_id":i=this.getTComboBox(t,"global_product",TTAPI.APIProduct);break;case"job_client_id":case"exclude_client_id":case"include_client_id":i=this.getTComboBox(t,"global_client",TTAPI.APIClient);break;case"company_deduction_id":i=this.getTComboBox(t,"global_deduction",TTAPI.APICompanyDeduction);break;case"qualification_id":i=this.getTComboBox(t,"global_qualification",TTAPI.APIQualification);break;case"kpi_id":i=this.getTComboBox(t,"global_kpi",TTAPI.APIKPI);break;case"job_applicant_id":i=this.getTComboBox(t,"global_job_applicant",TTAPI.APIJobApplicant);break;case"job_vacancy_id":i=this.getTComboBox(t,"global_job_vacancy",TTAPI.APIJobVacancy);break;case"accrual_policy_account_id":i=this.getTComboBox(t,"global_accrual_policy_account",TTAPI.APIAccrualPolicyAccount);break;default:u.isSet(w.ReportMissedField)||(w.ReportMissedField={}),w.ReportMissedField[t]=!0;break}return i}getTag(t){var i=u.loadWidgetByName(FormItemType.TAG_INPUT);return i.TTagInput({field:t}),i}getTreeModeAComboBox(t){var i=u.loadWidgetByName(FormItemType.AWESOME_BOX);return i=i.AComboBox({tree_mode:!0,allow_multiple_selection:!0,layout_name:"global_tree_column",set_empty:!0,field:t}),i}getCheckBox(t){var i=u.loadWidgetByName(FormItemType.CHECKBOX);return i=i.TCheckbox({field:t}),i}getTComboBox(t,i,e){var a=u.loadWidgetByName(FormItemType.AWESOME_BOX);return a=a.AComboBox({api_class:e,allow_multiple_selection:!0,layout_name:i,show_search_inputs:!0,set_empty:!0,field:t}),a}getSortComboBox(t){var i=u.loadWidgetByName(FormItemType.AWESOME_BOX);return i=i.AComboBox({field:t,allow_drag_to_order:!0,allow_multiple_selection:!0,set_empty:!0,layout_name:"global_sort_columns"}),i}getSimpleTComboBox(t,i){u.isSet(i)||(i=!0);var e=u.loadWidgetByName(FormItemType.AWESOME_BOX);return e=e.AComboBox({field:t,set_empty:!0,allow_multiple_selection:i,layout_name:"global_option_column",key:"value"}),e}getComboBox(t){var i=u.loadWidgetByName(FormItemType.COMBO_BOX);return i=i.TComboBox({field:t,set_empty:!0}),i}initSourceData(t,i){var e=null,a="",s=this;switch(t){case"sort":e=this.api,a="columns",e.getOptions(a,{onResult:function(o){b(o)}});break;case"kpi_group_id":TTAPI.APIKPIGroup.getKPIGroup("",!1,!1,{onResult:function(o){o=o.getResult(),o=u.buildTreeRecord(o),i.setSourceData(o)}});break;case"qualification_group_id":TTAPI.APIQualificationGroup.getQualificationGroup("",!1,!1,{onResult:function(o){o=o.getResult(),o=u.buildTreeRecord(o),i.setSourceData(o)}});break;case"product_group_id":TTAPI.APIProductGroup.getProductGroup("",!1,!1,{onResult:function(o){o=o.getResult(),o=u.buildTreeRecord(o),i.setSourceData(o)}});break;case"client_group_id":TTAPI.APIClientGroup.getClientGroup("",!1,!1,{onResult:function(o){o=o.getResult(),o=u.buildTreeRecord(o),i.setSourceData(o)}});break;case"user_group_id":TTAPI.APIUserGroup.getUserGroup("",!1,!1,{onResult:function(o){o=o.getResult(),o=u.buildTreeRecord(o),i.setSourceData(o)}});break;case"policy_group_id":TTAPI.PolicyGroup.getPolicyGroup("",!1,!1,{onResult:function(o){o=o.getResult(),o=u.buildTreeRecord(o),i.setSourceData(o)}});break;case"job_group_id":TTAPI.APIJobGroup.getJobGroup("",!1,!1,{onResult:function(o){o=o.getResult(),o=u.buildTreeRecord(o),i.setSourceData(o)}});break;case"job_item_group_id":TTAPI.APIJobItemGroup.getJobItemGroup("",!1,!1,{onResult:function(o){o=o.getResult(),o=u.buildTreeRecord(o),i.setSourceData(o)}});break;case"job_vacancy_employment_status_id":e=TTAPI.APIJobVacancy,a="employment_status";break;case"job_vacancy_level_id":e=TTAPI.APIJobVacancy,a="level";break;case"job_vacancy_status_id":e=TTAPI.APIJobVacancy,a="status";break;case"job_vacancy_type_id":e=TTAPI.APIJobVacancy,a="type";break;case"job_vacancy_wage_type_id":e=TTAPI.APIJobVacancy,a="wage_type";break;case"job_application_status_id":e=TTAPI.APIJobApplication,a="status";break;case"job_application_type_id":e=TTAPI.APIJobApplication,a="type";break;case"job_applicant_sex_id":e=TTAPI.APIJobApplicant,a="sex";break;case"job_applicant_status_id":e=TTAPI.APIJobApplicant,a="status";break;case"user_review_control_type_id":e=TTAPI.APIUserReviewControl,a="type";break;case"user_review_control_status_id":e=TTAPI.APIUserReviewControl,a="status";break;case"severity_id":e=TTAPI.APIUserReviewControl,a="severity";break;case"term_id":e=TTAPI.APIUserReviewControl,a="term";break;case"kpi_status_id":e=TTAPI.APIKPI,a="status";break;case"kpi_type_id":e=TTAPI.APIKPI,a="type";break;case"proficiency_id":e=TTAPI.APIUserSkill,a="proficiency";break;case"fluency_id":e=TTAPI.APIUserLanguage,a="fluency";break;case"competency_id":e=TTAPI.APIUserLanguage,a="competency";break;case"user_status_id":e=TTAPI.APIUser,a="status";break;case"pay_stub_status_id":e=TTAPI.APIPayStub,a="filtered_status";break;case"ownership_id":e=TTAPI.APIUserMembership,a="ownership";break;case"license_expiry_date":e=this.api,a="license_expiry_date";break;case"membership_renewal_date":e=this.api,a="membership_renewal_date";break;case"skill_expiry_date":e=this.api,a="skill_expiry_date";break;case"education_graduate_date":e=this.api,a="education_graduate_date";break;case"group":case"sub_total":case"page_break":e=this.api,a="static_columns";break;case"pay_period_time_sheet_verify_status_id":e=TTAPI.APIPayPeriodTimeSheetVerify,a="filter_report_status";break;case"job_status_id":e=TTAPI.APIJob,a="status";break;case"custom_filter":e=this.api,a="report_custom_filters";break;case"log_action_id":e=TTAPI.APILog,a="action";break;case"log_table_name_id":e=TTAPI.APILog,a="table_name";break;case"filter":this.script_name==="ScheduleSummaryReport"?(e=TTAPI.APISchedule,a="status"):this.script_name==="InvoiceTransactionSummaryReport"?(e=TTAPI.APITransaction,a="type"):this.script_name==="PayStubSummaryReport"?(e=TTAPI.APIPayStub,a="status"):this.script_name==="ActiveShiftReport"&&(e=TTAPI.APIUser,a="status");break;case"accrual_policy_type_id":e=TTAPI.APIAccrualPolicy,a="type";break;case"accrual_type_id":e=TTAPI.APIAccrual,a="type";break;case"qualification_type_id":e=TTAPI.APIQualification,a="type";break;case"exception_policy_type_id":e=TTAPI.APIExceptionPolicy,a="type";break;case"exception_policy_severity_id":e=TTAPI.APIExceptionPolicy,a="severity";break;case"expense_policy_require_receipt_id":e=TTAPI.APIExpensePolicy,a="require_receipt";break;case"expense_policy_type_id":e=TTAPI.APIExpensePolicy,a="type";break;case"user_expense_payment_method_id":e=TTAPI.APIUserExpense,a="payment_method";break;case"user_expense_status_id":e=TTAPI.APIUserExpense,a="status";break;case"job_item_status_id":e=TTAPI.APIJobItem,a="status";break;case"client_status_id":e=TTAPI.APIClient,a="status";break;case"invoice_status_id":e=TTAPI.APIInvoice,a="status";break;case"invoice_transaction_type_id":e=TTAPI.APITransaction,a="type";break;case"product_type_id":e=TTAPI.APIProduct,a="type";break;case"pay_stub_type_id":e=TTAPI.APIPayStub,a="type";break;case"transaction_type_id":e=this.api,a="type";break;case"transaction_status_id":e=this.api,a="status";break;case"pay_stub_run_id":for(var c={},h=1;h<=128;h++)c[h]=h;c=u.buildRecordArray(c),i.setSourceData(c);return;default:if(i.getAPI&&i.getAPI()||!i.setSourceData)return;t.replace("_id",""),e=this.api,a=t,t.indexOf("time_period")>=0&&(a="time_period");break}e&&(this.need_refresh_display_columns&&(a==="columns"||t=="custom_filter")?e.getOptions(a,{noCache:!0,onResult:function(o){b(o)}}):e.getOptions(a,{onResult:function(o){b(o)}}));function b(o){var d=o.getResult();d=u.buildRecordArray(d),t==="sort"?d=s.buildSortSelectorUnSelectColumns(d):t.indexOf("time_period")>=0&&(s.time_period_array=d),i.setSourceData(d)}}getDatePicker(t){var i=u.loadWidgetByName(FormItemType.DATE_PICKER);return i.TDatePicker({field:t}),i}putInputToInsideFormItem(t,i){var e=_(u.loadWidgetByName(WidgetNamesDic.EDIT_VIEW_SUB_FORM_ITEM)),a=e.find(".edit-view-form-item-label"),s=e.find(".edit-view-form-item-input-div");return e.addClass("remove-margin"),a.text(_.i18n._(i)),s.append(t),e}onLicenseExpiryDate(t,i){var e=this,a=t.getValue();this.visible_report_widgets.license_expiry_date=null,this.visible_report_widgets.start_date_3=null,this.visible_report_widgets.end_date_3=null,this.visible_report_widgets.pay_period_id_3=null,this.visible_report_widgets.pay_period_schedule_id_3=null,a==="custom_date"?b():a==="custom_pay_period"?c():a==="this_pay_period"||a==="last_pay_period"||a==="to_last_pay_period"||a==="to_this_pay_period"?s():h();function s(){var o=e.edit_view.find("#report_license_expiry_date_div"),d=_(o.children()[1]);d.empty();var r=_("<div class='v-box'></div>"),n=e.getSimpleTComboBox("license_expiry_date",!1,!1);e.initSourceData("license_expiry_date",n),n.setValue(a);var l=e.getTComboBox("pay_period_schedule_id_3","global_pay_period_schedule",TTAPI.APIPayPeriodSchedule),m=e.putInputToInsideFormItem(n,_.i18n._("Section")),p=e.putInputToInsideFormItem(l,_.i18n._("Pay Period Schedule"));e.visible_report_widgets.license_expiry_date=n,e.visible_report_widgets.pay_period_schedule_id_3=l,n.unbind("formItemChange").bind("formItemChange",function(g,v){e.onFormItemChange(v)}),l.unbind("formItemChange").bind("formItemChange",function(g,v){e.onFormItemChange(v)}),i&&l.setValue(i.pay_period_schedule_id),r.append(m),r.append("<div class='clear-both-div'></div>"),r.append(p),r.append("<div class='clear-both-div'></div>"),e.setEditFieldSize(r.find(".edit-view-form-item-sub-label-div > span"),120),d.append(r)}function c(){var o=e.edit_view.find("#report_license_expiry_date_div"),d=_(o.children()[1]);d.empty();var r=_("<div class='v-box'></div>"),n=e.getSimpleTComboBox("license_expiry_date",!1,!1);e.initSourceData("license_expiry_date",n),n.setValue(a);var l=e.getTComboBox("pay_period_id_3","global_Pay_period",TTAPI.APIPayPeriod);l.unbind("formItemChange").bind("formItemChange",function(g,v){e.onFormItemChange(v)});var m=e.putInputToInsideFormItem(n,_.i18n._("Section")),p=e.putInputToInsideFormItem(l,_.i18n._("Pay Period"));e.visible_report_widgets.license_expiry_date=n,e.visible_report_widgets.pay_period_id_3=l,n.unbind("formItemChange").bind("formItemChange",function(g,v){e.onFormItemChange(v)}),i&&l.setValue(i.pay_period_id),d.append(r),r.append(m),r.append("<div class='clear-both-div'></div>"),r.append(p),r.append("<div class='clear-both-div'></div>"),e.setEditFieldSize(r.find(".edit-view-form-item-sub-label-div > span"),70)}function h(){var o=e.edit_view.find("#report_license_expiry_date_div"),d=_(o.children()[1]);d.empty();var r=e.getSimpleTComboBox("license_expiry_date",!1,!1);d.append(r),r.setValue(a),e.initSourceData("license_expiry_date",r),r.unbind("formItemChange").bind("formItemChange",function(n,l){e.onFormItemChange(l)}),e.visible_report_widgets.license_expiry_date=r}function b(){var o=e.edit_view.find("#report_license_expiry_date_div"),d=_(o.children()[1]);d.empty();var r=_("<div class='v-box'></div>"),n=e.getSimpleTComboBox("license_expiry_date",!1,!1);e.initSourceData("license_expiry_date",n),n.setValue(a);var l=e.getDatePicker("start_date_3"),m=e.getDatePicker("end_date_3");i&&(l.setValue(i.start_date),m.setValue(i.end_date));var p=e.putInputToInsideFormItem(n,_.i18n._("Section")),g=e.putInputToInsideFormItem(l,_.i18n._("Start Date")),v=e.putInputToInsideFormItem(m,_.i18n._("End Date"));e.visible_report_widgets.license_expiry_date=n,e.visible_report_widgets.start_date_3=l,e.visible_report_widgets.end_date_3=m,n.unbind("formItemChange").bind("formItemChange",function(I,f){e.onFormItemChange(f)}),l.unbind("formItemChange").bind("formItemChange",function(I,f){e.onFormItemChange(f)}),m.unbind("formItemChange").bind("formItemChange",function(I,f){e.onFormItemChange(f)}),r.append(p),r.append("<div class='clear-both-div'></div>"),r.append(g),r.append("<div class='clear-both-div'></div>"),r.append(v),r.append("<div class='clear-both-div'></div>"),e.setEditFieldSize(r.find(".edit-view-form-item-sub-label-div > span"),70),d.append(r)}}onEducationGraduateDate(t,i){var e=this,a=t.getValue();this.visible_report_widgets.education_graduate_date=null,this.visible_report_widgets.start_date_4=null,this.visible_report_widgets.end_date_4=null,this.visible_report_widgets.pay_period_id_4=null,this.visible_report_widgets.pay_period_schedule_id_4=null,a==="custom_date"?b():a==="custom_pay_period"?c():a==="this_pay_period"||a==="last_pay_period"||a==="to_last_pay_period"||a==="to_this_pay_period"?s():h();function s(){var o=e.edit_view.find("#report_education_graduate_date_div"),d=_(o.children()[1]);d.empty();var r=_("<div class='v-box'></div>"),n=e.getSimpleTComboBox("education_graduate_date",!1,!1);e.initSourceData("education_graduate_date",n),n.setValue(a);var l=e.getTComboBox("pay_period_schedule_id_4","global_pay_period_schedule",TTAPI.APIPayPeriodSchedule),m=e.putInputToInsideFormItem(n,_.i18n._("Section")),p=e.putInputToInsideFormItem(l,_.i18n._("Pay Period Schedule"));e.visible_report_widgets.education_graduate_date=n,e.visible_report_widgets.pay_period_schedule_id_4=l,n.unbind("formItemChange").bind("formItemChange",function(g,v){e.onFormItemChange(v)}),l.unbind("formItemChange").bind("formItemChange",function(g,v){e.onFormItemChange(v)}),i&&l.setValue(i.pay_period_schedule_id),r.append(m),r.append("<div class='clear-both-div'></div>"),r.append(p),r.append("<div class='clear-both-div'></div>"),e.setEditFieldSize(r.find(".edit-view-form-item-sub-label-div > span"),120),d.append(r)}function c(){var o=e.edit_view.find("#report_education_graduate_date_div"),d=_(o.children()[1]);d.empty();var r=_("<div class='v-box'></div>"),n=e.getSimpleTComboBox("education_graduate_date",!1,!1);e.initSourceData("education_graduate_date",n),n.setValue(a);var l=e.getTComboBox("pay_period_id_4","global_Pay_period",TTAPI.APIPayPeriod);l.unbind("formItemChange").bind("formItemChange",function(g,v){e.onFormItemChange(v)});var m=e.putInputToInsideFormItem(n,_.i18n._("Section")),p=e.putInputToInsideFormItem(l,_.i18n._("Pay Period"));e.visible_report_widgets.education_graduate_date=n,e.visible_report_widgets.pay_period_id_4=l,n.unbind("formItemChange").bind("formItemChange",function(g,v){e.onFormItemChange(v)}),i&&l.setValue(i.pay_period_id),d.append(r),r.append(m),r.append("<div class='clear-both-div'></div>"),r.append(p),r.append("<div class='clear-both-div'></div>"),e.setEditFieldSize(r.find(".edit-view-form-item-sub-label-div > span"),70)}function h(){var o=e.edit_view.find("#report_education_graduate_date_div"),d=_(o.children()[1]);d.empty();var r=e.getSimpleTComboBox("education_graduate_date",!1,!1);d.append(r),r.setValue(a),e.initSourceData("education_graduate_date",r),r.unbind("formItemChange").bind("formItemChange",function(n,l){e.onFormItemChange(l)}),e.visible_report_widgets.education_graduate_date=r}function b(){var o=e.edit_view.find("#report_education_graduate_date_div"),d=_(o.children()[1]);d.empty();var r=_("<div class='v-box'></div>"),n=e.getSimpleTComboBox("education_graduate_date",!1,!1);e.initSourceData("education_graduate_date",n),n.setValue(a);var l=e.getDatePicker("start_date_4"),m=e.getDatePicker("end_date_4");i&&(l.setValue(i.start_date),m.setValue(i.end_date));var p=e.putInputToInsideFormItem(n,_.i18n._("Section")),g=e.putInputToInsideFormItem(l,_.i18n._("Start Date")),v=e.putInputToInsideFormItem(m,_.i18n._("End Date"));e.visible_report_widgets.education_graduate_date=n,e.visible_report_widgets.start_date_4=l,e.visible_report_widgets.end_date_4=m,n.unbind("formItemChange").bind("formItemChange",function(I,f){e.onFormItemChange(f)}),l.unbind("formItemChange").bind("formItemChange",function(I,f){e.onFormItemChange(f)}),m.unbind("formItemChange").bind("formItemChange",function(I,f){e.onFormItemChange(f)}),r.append(p),r.append("<div class='clear-both-div'></div>"),r.append(g),r.append("<div class='clear-both-div'></div>"),r.append(v),r.append("<div class='clear-both-div'></div>"),e.setEditFieldSize(r.find(".edit-view-form-item-sub-label-div > span"),70),d.append(r)}}onSkillExpiryDate(t,i){var e=this,a=t.getValue();this.visible_report_widgets.skill_expiry_date=null,this.visible_report_widgets.start_date_2=null,this.visible_report_widgets.end_date_2=null,this.visible_report_widgets.pay_period_id_2=null,this.visible_report_widgets.pay_period_schedule_id_2=null,a==="custom_date"?b():a==="custom_pay_period"?c():a==="this_pay_period"||a==="last_pay_period"||a==="to_last_pay_period"||a==="to_this_pay_period"?s():h();function s(){var o=e.edit_view.find("#report_skill_expiry_date_div"),d=_(o.children()[1]);d.empty();var r=_("<div class='v-box'></div>"),n=e.getSimpleTComboBox("skill_expiry_date",!1,!1);e.initSourceData("skill_expiry_date",n),n.setValue(a);var l=e.getTComboBox("pay_period_schedule_id_2","global_pay_period_schedule",TTAPI.APIPayPeriodSchedule),m=e.putInputToInsideFormItem(n,_.i18n._("Section")),p=e.putInputToInsideFormItem(l,_.i18n._("Pay Period Schedule"));e.visible_report_widgets.skill_expiry_date=n,e.visible_report_widgets.pay_period_schedule_id_2=l,n.unbind("formItemChange").bind("formItemChange",function(g,v){e.onFormItemChange(v)}),l.unbind("formItemChange").bind("formItemChange",function(g,v){e.onFormItemChange(v)}),i&&l.setValue(i.pay_period_schedule_id),r.append(m),r.append("<div class='clear-both-div'></div>"),r.append(p),r.append("<div class='clear-both-div'></div>"),e.setEditFieldSize(r.find(".edit-view-form-item-sub-label-div > span"),120),d.append(r)}function c(){var o=e.edit_view.find("#report_skill_expiry_date_div"),d=_(o.children()[1]);d.empty();var r=_("<div class='v-box'></div>"),n=e.getSimpleTComboBox("skill_expiry_date",!1,!1);e.initSourceData("skill_expiry_date",n),n.setValue(a);var l=e.getTComboBox("pay_period_id_2","global_Pay_period",TTAPI.APIPayPeriod);l.unbind("formItemChange").bind("formItemChange",function(g,v){e.onFormItemChange(v)});var m=e.putInputToInsideFormItem(n,_.i18n._("Section")),p=e.putInputToInsideFormItem(l,_.i18n._("Pay Period"));e.visible_report_widgets.skill_expiry_date=n,e.visible_report_widgets.pay_period_id_2=l,n.unbind("formItemChange").bind("formItemChange",function(g,v){e.onFormItemChange(v)}),i&&l.setValue(i.pay_period_id),d.append(r),r.append(m),r.append("<div class='clear-both-div'></div>"),r.append(p),r.append("<div class='clear-both-div'></div>"),e.setEditFieldSize(r.find(".edit-view-form-item-sub-label-div > span"),70)}function h(){var o=e.edit_view.find("#report_skill_expiry_date_div"),d=_(o.children()[1]);d.empty();var r=e.getSimpleTComboBox("skill_expiry_date",!1,!1);d.append(r),r.setValue(a),e.initSourceData("skill_expiry_date",r),r.unbind("formItemChange").bind("formItemChange",function(n,l){e.onFormItemChange(l)}),e.visible_report_widgets.skill_expiry_date=r}function b(){var o=e.edit_view.find("#report_skill_expiry_date_div"),d=_(o.children()[1]);d.empty();var r=_("<div class='v-box'></div>"),n=e.getSimpleTComboBox("skill_expiry_date",!1,!1);e.initSourceData("skill_expiry_date",n),n.setValue(a);var l=e.getDatePicker("start_date_2"),m=e.getDatePicker("end_date_2");i&&(l.setValue(i.start_date),m.setValue(i.end_date));var p=e.putInputToInsideFormItem(n,_.i18n._("Section")),g=e.putInputToInsideFormItem(l,_.i18n._("Start Date")),v=e.putInputToInsideFormItem(m,_.i18n._("End Date"));e.visible_report_widgets.skill_expiry_date=n,e.visible_report_widgets.start_date_2=l,e.visible_report_widgets.end_date_2=m,n.unbind("formItemChange").bind("formItemChange",function(I,f){e.onFormItemChange(f)}),l.unbind("formItemChange").bind("formItemChange",function(I,f){e.onFormItemChange(f)}),m.unbind("formItemChange").bind("formItemChange",function(I,f){e.onFormItemChange(f)}),r.append(p),r.append("<div class='clear-both-div'></div>"),r.append(g),r.append("<div class='clear-both-div'></div>"),r.append(v),r.append("<div class='clear-both-div'></div>"),e.setEditFieldSize(r.find(".edit-view-form-item-sub-label-div > span"),70),d.append(r)}}onMembershipRenewalDateChange(t,i){var e=this,a=t.getValue();this.visible_report_widgets.membership_renewal_date=null,this.visible_report_widgets.start_date_1=null,this.visible_report_widgets.end_date_1=null,this.visible_report_widgets.pay_period_id_1=null,this.visible_report_widgets.pay_period_schedule_id_1=null,a==="custom_date"?b():a==="custom_pay_period"?c():a==="this_pay_period"||a==="last_pay_period"||a==="to_last_pay_period"||a==="to_this_pay_period"?s():h();function s(){var o=e.edit_view.find("#report_membership_renewal_date_div"),d=_(o.children()[1]);d.empty();var r=_("<div class='v-box'></div>"),n=e.getSimpleTComboBox("membership_renewal_date",!1,!1);e.initSourceData("membership_renewal_date",n),n.setValue(a);var l=e.getTComboBox("pay_period_schedule_id_1","global_pay_period_schedule",TTAPI.APIPayPeriodSchedule),m=e.putInputToInsideFormItem(n,_.i18n._("Section")),p=e.putInputToInsideFormItem(l,_.i18n._("Pay Period Schedule"));e.visible_report_widgets.membership_renewal_date=n,e.visible_report_widgets.pay_period_schedule_id_1=l,n.unbind("formItemChange").bind("formItemChange",function(g,v){e.onFormItemChange(v)}),l.unbind("formItemChange").bind("formItemChange",function(g,v){e.onFormItemChange(v)}),i&&l.setValue(i.pay_period_schedule_id),r.append(m),r.append("<div class='clear-both-div'></div>"),r.append(p),r.append("<div class='clear-both-div'></div>"),e.setEditFieldSize(r.find(".edit-view-form-item-sub-label-div > span"),120),d.append(r)}function c(){var o=e.edit_view.find("#report_membership_renewal_date_div"),d=_(o.children()[1]);d.empty();var r=_("<div class='v-box'></div>"),n=e.getSimpleTComboBox("membership_renewal_date",!1,!1);e.initSourceData("membership_renewal_date",n),n.setValue(a);var l=e.getTComboBox("pay_period_id_1","global_Pay_period",TTAPI.APIPayPeriod);l.unbind("formItemChange").bind("formItemChange",function(g,v){e.onFormItemChange(v)});var m=e.putInputToInsideFormItem(n,_.i18n._("Section")),p=e.putInputToInsideFormItem(l,_.i18n._("Pay Period"));e.visible_report_widgets.membership_renewal_date=n,e.visible_report_widgets.pay_period_id_1=l,n.unbind("formItemChange").bind("formItemChange",function(g,v){e.onFormItemChange(v)}),i&&l.setValue(i.pay_period_id),d.append(r),r.append(m),r.append("<div class='clear-both-div'></div>"),r.append(p),r.append("<div class='clear-both-div'></div>"),e.setEditFieldSize(r.find(".edit-view-form-item-sub-label-div > span"),70)}function h(){var o=e.edit_view.find("#report_membership_renewal_date_div"),d=_(o.children()[1]);d.empty();var r=e.getSimpleTComboBox("membership_renewal_date",!1,!1);d.append(r),r.setValue(a),e.initSourceData("membership_renewal_date",r),r.unbind("formItemChange").bind("formItemChange",function(n,l){e.onFormItemChange(l)}),e.visible_report_widgets.membership_renewal_date=r}function b(){var o=e.edit_view.find("#report_membership_renewal_date_div"),d=_(o.children()[1]);d.empty();var r=_("<div class='v-box'></div>"),n=e.getSimpleTComboBox("membership_renewal_date",!1,!1);e.initSourceData("membership_renewal_date",n),n.setValue(a);var l=e.getDatePicker("start_date_1"),m=e.getDatePicker("end_date_1");i&&(l.setValue(i.start_date),m.setValue(i.end_date));var p=e.putInputToInsideFormItem(n,_.i18n._("Section")),g=e.putInputToInsideFormItem(l,_.i18n._("Start Date")),v=e.putInputToInsideFormItem(m,_.i18n._("End Date"));e.visible_report_widgets.membership_renewal_date=n,e.visible_report_widgets.start_date_1=l,e.visible_report_widgets.end_date_1=m,n.unbind("formItemChange").bind("formItemChange",function(I,f){e.onFormItemChange(f)}),l.unbind("formItemChange").bind("formItemChange",function(I,f){e.onFormItemChange(f)}),m.unbind("formItemChange").bind("formItemChange",function(I,f){e.onFormItemChange(f)}),r.append(p),r.append("<div class='clear-both-div'></div>"),r.append(g),r.append("<div class='clear-both-div'></div>"),r.append(v),r.append("<div class='clear-both-div'></div>"),e.setEditFieldSize(r.find(".edit-view-form-item-sub-label-div > span"),62),d.append(r)}}onTimePeriodChange(t,i){var e=this,a=t.getValue(),s=t.getField();this.visible_report_widgets[s]=null,a==="custom_date"?o():a==="custom_pay_period"?h():a==="this_pay_period"||a==="last_pay_period"||a==="to_last_pay_period"||a==="to_this_pay_period"||a==="this_year_this_pay_period"||a==="this_year_last_pay_period"?c():b();function c(){var d=e.edit_view.find("#report_"+s+"_div"),r=_(d.children()[1]);r.empty();var n=_("<div class='v-box'></div>"),l=e.getSimpleTComboBox(s,!1,!1);e.initSourceData(s,l),l.setValue(a);var m=e.getTComboBox("pay_period_schedule_id","global_pay_period_schedule",TTAPI.APIPayPeriodSchedule);m.attr("time_period_key",s);var p=e.putInputToInsideFormItem(l,_.i18n._("Section")),g=e.putInputToInsideFormItem(m,_.i18n._("Pay Period Schedule"));e.visible_report_widgets[s]=l,l.unbind("formItemChange").bind("formItemChange",function(v,I){e.onFormItemChange(I)}),m.unbind("formItemChange").bind("formItemChange",function(v,I){e.onFormItemChange(I)}),i&&m.setValue(i.pay_period_schedule_id),n.append(p),n.append("<div class='clear-both-div'></div>"),n.append(g),n.append("<div class='clear-both-div'></div>"),e.setEditFieldSize(n.find(".edit-view-form-item-sub-label-div > span"),120),r.append(n)}function h(){var d=e.edit_view.find("#report_"+s+"_div"),r=_(d.children()[1]);r.empty();var n=_("<div class='v-box'></div>"),l=e.getSimpleTComboBox(s,!1,!1);e.initSourceData(s,l),l.setValue(a);var m=e.getTComboBox("pay_period_id","global_Pay_period",TTAPI.APIPayPeriod);m.attr("time_period_key",s),m.unbind("formItemChange").bind("formItemChange",function(v,I){e.onFormItemChange(I)});var p=e.putInputToInsideFormItem(l,_.i18n._("Section")),g=e.putInputToInsideFormItem(m,_.i18n._("Pay Period"));e.visible_report_widgets[s]=l,l.unbind("formItemChange").bind("formItemChange",function(v,I){e.onFormItemChange(I)}),i&&m.setValue(i.pay_period_id),r.append(n),n.append(p),n.append("<div class='clear-both-div'></div>"),n.append(g),n.append("<div class='clear-both-div'></div>"),e.setEditFieldSize(n.find(".edit-view-form-item-sub-label-div > span"),70)}function b(){var d=e.edit_view.find("#report_"+s+"_div"),r=_(d.children()[1]);r.empty();var n=e.getSimpleTComboBox(s,!1,!1);r.append(n),n.setValue(a),e.initSourceData(s,n),n.unbind("formItemChange").bind("formItemChange",function(l,m){e.onFormItemChange(m)}),e.visible_report_widgets[s]=n}function o(){var d=e.edit_view.find("#report_"+s+"_div"),r=_(d.children()[1]);r.empty();var n=_("<div class='v-box'></div>"),l=e.getSimpleTComboBox(s,!1,!1);e.initSourceData(s,l),l.setValue(a);var m=e.getDatePicker("start_date"),p=e.getDatePicker("end_date");m.attr("time_period_key",s),p.attr("time_period_key",s),i&&(m.setValue(i.start_date),p.setValue(i.end_date));var g=e.putInputToInsideFormItem(l,_.i18n._("Section")),v=e.putInputToInsideFormItem(m,_.i18n._("Start Date")),I=e.putInputToInsideFormItem(p,_.i18n._("End Date"));e.visible_report_widgets[s]=l,l.unbind("formItemChange").bind("formItemChange",function(f,y){e.onFormItemChange(y)}),m.unbind("formItemChange").bind("formItemChange",function(f,y){e.onFormItemChange(y)}),p.unbind("formItemChange").bind("formItemChange",function(f,y){e.onFormItemChange(y)}),n.append(g),n.append("<div class='clear-both-div'></div>"),n.append(v),n.append("<div class='clear-both-div'></div>"),n.append(I),n.append("<div class='clear-both-div'></div>"),e.setEditFieldSize(n.find(".edit-view-form-item-sub-label-div > span"),62),r.append(n)}}setErrorTips(t,i){this.clearErrorTips();var e=t.getDetails(),a=e[0],s=!1;this.edit_view_tab.find("#tab_report"),this.edit_view_tab.find("#tab_setup");for(var c in a)a.hasOwnProperty(c)&&u.isSet(this.edit_view_ui_dic[c])&&(c==="time_period"||c==="membership_renewal_date"||c==="skill_expiry_date"||c==="license_expiry_date"||c==="education_graduate_date"?(this.visible_report_widgets[c]&&this.visible_report_widgets[c].is(":visible")?(this.visible_report_widgets[c].setErrorStyle(a[c],!0),s=!0):this.visible_report_widgets[c]&&this.visible_report_widgets[c].setErrorStyle(a[c]),this.edit_view_error_ui_dic[c]=this.visible_report_widgets[c]):(this.edit_view_ui_dic[c].is(":visible")?(this.edit_view_ui_dic[c].setErrorStyle(a[c],!0),s=!0):this.edit_view_ui_dic[c].setErrorStyle(a[c]),this.edit_view_error_ui_dic[c]=this.edit_view_ui_dic[c]));s||this.showEditViewError(t)}buildSortSelectorUnSelectColumns(t){var i=[],e=100;return _.each(t,function(a,s){var c=_.extend({},s);c.id=e,c.sort="asc",i.push(c),e=e+1}),i}setEditViewWidgetsMode(){var t={};for(var i in this.edit_view_ui_dic){var e=this.edit_view_ui_dic[i];e.css("opacity",1);var a=e.parent().parent().parent(),s=a.parent().attr("id");a.hasClass("v-box")||(t[s]||(t[s]=!0),u.isSet(e.setEnabled)&&e.setEnabled(!0))}}buildReportUIBaseOnSetupFields(){var t=this.current_edit_record.setup_field;t&&t.length>0&&this.createUI(t)}getFormValues(){var t={};return t.page_orientation=this.current_edit_record.page_orientation,t.font_size=this.current_edit_record.font_size,t.auto_refresh=this.current_edit_record.auto_refresh,t.disable_grand_total=this.current_edit_record.disable_grand_total,t.maximum_page_limit=this.current_edit_record.maximum_page_limit,t.show_duplicate_values=this.current_edit_record.show_duplicate_values,this.current_saved_report&&u.isSet(this.current_saved_report.name)&&(t.report_name=this.current_saved_report.name,t.report_description=this.current_saved_report.description),t}getChartValues(){var t={};return t.enable=this.current_edit_record.enable,t.display_mode=this.current_edit_record.display_mode,t.type=this.current_edit_record.type,t.include_sub_total=this.current_edit_record.include_sub_total,t.axis_scale_static=this.current_edit_record.axis_scale_static,t.combine_columns=this.current_edit_record.combine_columns,t}convertSortValues(t){for(var i=[],e=0;e<t.length;e++){var a=t[e];if(u.isSet(a.fullValue)){var s={};s[a.value]=a.sort,i.push(s)}else{i=t;break}}return i}addOrderFix(t){var i={};for(var e in t)if(t.hasOwnProperty(e)){var a=this.visible_report_widgets_order_fix[e];a>0&&(i["-"+a+"-"+e]=t[e])}return i}validate(t){var i=this,e=this.getFormValues(),a=this.getChartValues();this.buildReportUIBaseOnSetupFields();var s=this.visible_report_values;s.sort&&(s.sort=this.convertSortValues(s.sort)),s=this.addOrderFix(s);var c=s;if(c["-1000-template"]=this.current_edit_record.template,c.other=e,c.chart=a,this.include_form_setup&&(c.form=this.getFormSetupData(!0)),s.sort&&(s.sort=this.convertSortValues(s.sort)),t){var h=this.api.validateReport(c,"pdf",{async:!1});if(h)return this.validateResult(h),h.getResult()}else return this.api.validateReport(c,"pdf",{onResult:function(b){i.validateResult(b)}}),null}onViewExcelClick(t){var i=this.getPostReportJson(),e={0:i,1:"csv"};if(this.include_form_setup){if(this.show_empty_message){var a=_.i18n._("Setup data for this report has not been completed yet. Please click on the Form Setup tab to do so now.");t&&(a=t),TAlertManager.showAlert(a);return}i.form=this.getFormSetupData(!0)}this.doFormIFrameCall(e);var s="Excel";LocalCacheData.getAllURLArgs()&&LocalCacheData.getAllURLArgs().sm&&(s=LocalCacheData.getAllURLArgs().sm+"@Excel"),_().TFeedback({source:s,force_source:!0,delay:5e3})}getVisibleReportValues(){for(var t in this.visible_report_values.filter)this.visible_report_values.filter[t]==TTUUID.zero_id&&delete this.visible_report_values.filter[t];return this.visible_report_values}getPostReportJson(t){var i=this.getFormValues(),e=this.getChartValues(),a=this.getVisibleReportValues();a.sort&&(a.sort=this.convertSortValues(a.sort)),t||(a=this.addOrderFix(a));var s=a;return t?s.template=this.current_edit_record.template:s["-1000-template"]=this.current_edit_record.template,s.other=i,s.chart=e,s}onContextMenuClick(t,i){if(ProgressBar.showOverlay(),window.clickProcessing!=!0){window.clickProcessing=!0,window.clickProcessingHandle=window.setTimeout(function(){window.clickProcessing==!0&&(window.clickProcessing=!1,ProgressBar.closeOverlay(),TTPromise.wait())},1e3);var e;if(u.isSet(i))e=i;else if(t.disabled){ProgressBar.closeOverlay();return}switch(e){case"view":ProgressBar.showOverlay(),this.onViewClick();break;case"view_html":ProgressBar.showOverlay(),this.onViewClick("html");break;case"view_html_new_window":ProgressBar.showOverlay(),this.onViewClick("html",!0);break;case"export_excel":this.onViewExcelClick();break;case"cancel":this.onCancelClick();break;case"save_existed_report":this.onSaveExistedReportClick();break;case"save_new_report":this.onSaveNewReportClick();break;case"save_setup":this.onSaveSetup();break;case"view_form":this.onViewClick("pdf_form");break;case"e_file":this.onViewClick("efile");break;case"timesheet_view":this.onViewClick("pdf_timesheet");break;case"timesheet_view_detail":this.onViewClick("pdf_timesheet_detail");break;default:ProgressBar.closeOverlay(),this.onCustomContextClick(e,t);break}u.triggerAnalyticsContextMenuClick(t,i)}}onSaveSetup(t){var i=this,e=this.getFormSetupData();t==null&&(t=_.i18n._("Form setup")),this.save_export_setup_data!=null&&(e=this.save_export_setup_data),i.show_empty_message=!1,i.form_setup_changed=!1,e?this.api.setCompanyFormConfig(e,{onResult:function(a){a&&a.isValid()?TAlertManager.showAlert(t+" "+_.i18n._("has been saved successfully")):(i.show_empty_message=!0,i.form_setup_changed=!0,TAlertManager.showAlert(t+" "+_.i18n._("save failed, please try again")))}}):TAlertManager.showAlert(t+" "+_.i18n._("invalid, please try again"))}getFormSetupData(){}onViewClick(t,i,e){if(t||(t="pdf"),!!this.validate(!0)){var a=this.getPostReportJson(),s={0:a,1:t};if(this.include_form_setup){if(this.show_empty_message){var c=_.i18n._("Setup data for this report has not been completed yet. Please click on the Form Setup tab to do so now.");e&&(c=e),TAlertManager.showAlert(c);return}a.form=this.getFormSetupData(!0)}if(t==="html"){var h=ServiceCaller.getAPIURL("Class="+this.api.className+"&Method=get"+this.api.key_name+"&v=2");u.getStationID()&&(h=h+"&StationID="+u.getStationID());var b=TTUUID.generateUUID();h=h+"&MessageID="+b;var o="<script>";o+="function getCookie( name ) {",o+='	var name = name + "=";',o+='	var split_cookie = document.cookie.split( ";" );',o+="	for ( var i = 0; i < split_cookie.length; i++ ) {",o+="		var tmp_cookie = split_cookie[i].trim();",o+="",o+="		if ( tmp_cookie.indexOf( name ) === 0 ) {",o+="			return tmp_cookie.substring( name.length, tmp_cookie.length );",o+="		}",o+="	}",o+='	return ""',o+="}",o+="",o+="var timeout_handler;",o+="var post_data;",o+="function startRefreshReport() {",o+='	if ( typeof( auto_refresh_time ) !== "undefined" && auto_refresh_time > 0 ) {',o+='		timeout_handler = setTimeout( "refreshReport()", ( auto_refresh_time * 1000 ) );',o+="	}",o+="}",o+="",o+="function refreshReport() {",o+='	this.document.getElementById( "refresh-icon" ).classList.add( "button-rotate" );',o+="	try {",o+="		$.ajax({",o+='			dataType: "JSON",',o+="			data: { json: JSON.stringify( post_data ) },",o+='            headers: { "X-Client-ID": "Browser-TimeTrex", "X-CSRF-Token": getCookie( "CSRF-Token" ) },',o+='			type: "POST",',o+='            url: "'+h+'",',o+="			success: function(result) {",o+='			if(console){ console.log( "Auto refreshing report: Seconds: "+ auto_refresh_time +" Current Time: "+ Date() ) }',o+='			var newDoc = result.api_retval + $("body").children(":last")[0].outerHTML; document.open("text/html"); document.write(newDoc); document.close(); ',o+="			}",o+="		})",o+="	} catch(e) {}",o+="}",o+="startRefreshReport();",o+="",o+='$( "body" ).mousemove( function( e ) {',o+="	window.parent.Global.doPingIfNecessary()",o+="} );",o+="<\/script>",this.api["get"+this.api.key_name](a,t,{onResult:function(r){var n=r.getResult();if(n)if(u.isEmpty(n)===!1){if(n=n+o,i){var l=window.open();l.post_data=s,l.document.writeln(n),l.document.close()}else if(n){if(BaseWizardController.isWizardInitializingOrActive("ReportViewWizardController")==!0){Debug.Text("ReportViewWizardController: Ignoring request to open report, another report is already being generated or is already open.","ReportViewWizardController.js","ReportViewWizardController","onResult",10);return}var m={post_data:s,result:n};IndexViewController.openWizard("ReportViewWizard",m),ProgressBar.closeOverlay()}}else TAlertManager.showAlert(_.i18n._("NO DATA MATCHES CRITERIA",LocalCacheData.getApplicationName()),_.i18n._("NOTICE"));else TAlertManager.showErrorAlert(r)}})}else if(t==="pdf_form_publish_employee")this.api["get"+this.api.key_name](a,t,{onResult:function(r){var n=r.getResult();n?(UserGenericStatusWindowController.open(n,LocalCacheData.getLoginUser().id,function(){}),ProgressBar.closeOverlay()):TAlertManager.showAlert(_.i18n._("NO DATA MATCHES CRITERIA",LocalCacheData.getApplicationName()),_.i18n._("NOTICE"))}});else{this.doFormIFrameCall(s),ProgressBar.closeOverlay();var d="PDF";LocalCacheData.getAllURLArgs()&&LocalCacheData.getAllURLArgs().sm&&(d=LocalCacheData.getAllURLArgs().sm+"@PDF"),_().TFeedback({source:d,force_source:!0,delay:5e3})}}}processTransactions(t){var i=this.getPostReportJson(!0),e={0:{filter_data:i},1:!0,2:t},a=TTAPI.APIPayStub,s=ServiceCaller.getAPIURL("Class="+a.className+"&Method=get"+a.key_name);u.APIFileDownload(a.className,a.key_name,e,s)}setEditMenuViewIcon(t,i){}doFormIFrameCall(t){var i=ServiceCaller.getAPIURL("Class="+this.api.className+"&Method=get"+this.api.key_name);u.APIFileDownload(this.api.className,this.api.key_name,t,i)}onSaveNewReportClick(){var t=this,i=this.getPostReportJson(!0),e=this.current_edit_record.setup_field;i.template&&e.unshift("template");var a={};a.data={},a.data.config=i,a.data.template=e,a.script=this.script_name,this.sub_saved_report_view_controller?(t.sub_saved_report_view_controller.edit_only_mode=!0,t.sub_saved_report_view_controller.buildContextMenu(!0),t.sub_saved_report_view_controller.onAddClick(a)):this.initSubSavedReportView(function(){t.sub_saved_report_view_controller.edit_only_mode=!0,t.sub_saved_report_view_controller.onAddClick(a)})}onSaveExistedReportClick(){var t=this,i=this.getPostReportJson(!0),e=this.current_edit_record.setup_field;i.template&&e.unshift("template");var a=this.current_saved_report;a||(a={}),a.data={},a.data.config=i,a.data.template=e,a.script||(a.script=this.script_name),this.sub_saved_report_view_controller?(t.sub_saved_report_view_controller.edit_only_mode=!0,t.sub_saved_report_view_controller.buildContextMenu(!0),t.sub_saved_report_view_controller.onAddClick(a)):this.initSubSavedReportView(function(){t.sub_saved_report_view_controller.edit_only_mode=!0,t.sub_saved_report_view_controller.onAddClick(a)})}onSaveDoneCallback(t,i){var e=t.getResult();TTUUID.isUUID(e)==!1&&i&&i.id&&(e=i.id),this.refreshNav(e)}refreshNav(t){var i=this;this.navigation.setSourceData(null),i.getReportData(function(e){if(e&&e.length>0){if(TTUUID.isUUID(t))for(var a=0;a<e.length;a++){var s=e[a];if(s.id===t){i.current_saved_report=e[a];break}}else i.current_saved_report=i.getDefaultReport(e);i.saved_report_array=e}else i.current_saved_report=null,i.saved_report_array=[];i.current_edit_record={},i.visible_report_values={},i.initEditView()})}processFormSetupDataAndAddToBatch(t,i){var a;let e={};if(t)for(let s=0;s<i.length;s++)if(i[s].data&&typeof i[s].data=="object"&&i[s].api)for(let c in i[s].data){let h=i[s].field_key+"_"+c;i[s].api&&i[s].data[c]!==!1&&i[s].api&&i[s].data[c].length===1?(e[i[s].api.className]||(e[i[s].api.className]={method:i[s].api_method,records:[]}),e[i[s].api.className].records.push({field:h,id:i[s].data[c][0]})):this.edit_view_ui_dic[h].setValue(i[s].data[c]),this.current_edit_record[h]=i[s].data[c]}else i[s].data!==void 0&&((a=this.edit_view_ui_dic[i[s].field_key])==null||a.setValue(i[s].data),this.current_edit_record[i[s].field_key]=i[s].data);return e}getBatchedRealFormDataFromAPI(t){if(Object.keys(t).length>0){let i=this;for(let e in t){let a={};a.filter_data={id:T.uniq(t[e].records.map(s=>s.id))},TTAPI[e][t[e].method](a,{onResult:function(s){let c=s.getResult();if(c&&Array.isArray(c))for(let h=0;h<t[e].records.length;h++){let b=c.find(o=>o.id===t[e].records[h].id);b!==void 0&&i.edit_view_ui_dic[t[e].records[h].field]&&(i.edit_view_ui_dic[t[e].records[h].field].getAllowMultipleSelection()===!0?i.edit_view_ui_dic[t[e].records[h].field].setValue([b]):i.edit_view_ui_dic[t[e].records[h].field].setValue(c))}}})}}}}w.ReportMissedField=null;export{w as ReportBaseViewController};
//# sourceMappingURL=ReportBaseViewController-sqxrqYaU.bundle.js.map
