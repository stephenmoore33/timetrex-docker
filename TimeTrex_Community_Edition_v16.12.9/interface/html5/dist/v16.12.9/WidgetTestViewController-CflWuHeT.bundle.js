import{_ as p,j as t}from"./vendor-tTApdY0Y.bundle.js";import"./TImage-D3G3HRb1.bundle.js";import"./TImageAdvBrowser-CQSTdPda.bundle.js";import"./TColorPicker-CsBr6yL-.bundle.js";import{SwitchButtonIcon as u}from"./SwitchButton-CmqnnJuO.bundle.js";class C extends BaseViewController{constructor(e={}){p.defaults(e,{el:"#awesomebox_test_view_container",user_api:null,user_group_api:null,company_api:null,user_id_array:null}),super(e)}init(e){this.edit_view_tpl="WidgetTestEditView.html",this.permission_id="user",this.viewId="WidgetTest",this.script_name="WidgetTest",this.table_name_key="awesomebox_test",this.context_menu_name=t.i18n._("Widget Test"),this.navigation_label=t.i18n._("Widget Test"),this.api=TTAPI.APIUser,this.select_company_id=LocalCacheData.getCurrentCompany().id,this.user_group_api=TTAPI.APIUserGroup,this.company_api=TTAPI.APICompany,this.user_id_array=[],this.render(),this.buildContextMenu(),this.initData()}setCurrentEditRecordData(){this.collectUIDataToCurrentEditRecord(),this.setEditViewDataDone()}clearEditViewData(){return!1}buildEditViewUI(){var e=this;ContextMenuManager.getMenu(this.determineContextMenuMountAttributes().id)===void 0?this.buildContextMenu():Debug.Warn("Context Menu ("+this.determineContextMenuMountAttributes().id+") already exists for: "+this.viewId,"AwesomeBoxTestView.js","AwesomeBoxTestView","buildEditViewUI",10);var i={tab_employee:{label:t.i18n._("Employee")}};this.setTabModel(i);var a=this.edit_view_tab.find("#tab_employee"),l=a.find(".first-column"),s=a.find(".second-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(l);var o=Global.loadWidgetByName(FormItemType.SEPARATED_BOX);o.SeparatedBox({label:t.i18n._("Separated_box: if you see this, the test is passing.")}),this.addEditFieldToColumn(null,o,l),o=Global.loadWidgetByName(FormItemType.CHECKBOX),o.TCheckbox({field:"checkbox"}),this.addEditFieldToColumn(t.i18n._("TCheckbox"),o,l,""),o=Global.loadWidgetByName(FormItemType.COLOR_PICKER),o.TColorPicker({field:"color_picker"}),this.addEditFieldToColumn(t.i18n._("TColorPicker"),o,l),o=Global.loadWidgetByName(FormItemType.DATE_PICKER),o.TDatePicker({field:"datepicker"}),this.addEditFieldToColumn(t.i18n._("TDatePicker"),o,l,"",null),o=Global.loadWidgetByName(FormItemType.DATE_PICKER),o.TRangePicker({field:"daterange",validation_field:"date_stamp"}),this.addEditFieldToColumn(t.i18n._("TDateRange"),o,l,"",null,!0),o=Global.loadWidgetByName(FormItemType.TIME_PICKER),o.TTimePicker({field:"timepicker"}),this.addEditFieldToColumn(t.i18n._("TTimePicker"),o,l),o=Global.loadWidgetByName(FormItemType.IMAGE_AVD_BROWSER),this.file_browser=o.TImageAdvBrowser({field:"imagebrowser",default_width:128,default_height:128,enable_delete:!0,callBack:function(d){new ServiceCaller().uploadFile(d,"object_type=user_photo&object_id="+e.current_edit_record.id,{onResult:function(c){c.toLowerCase()==="true"?e.file_browser.setImage(ServiceCaller.getURLByObjectType("user_photo")+"&object_id="+e.current_edit_record.id):TAlertManager.showAlert(c,"Error")}})},deleteImageHandler:function(d){e.onDeleteImage()}}),this.addEditFieldToColumn(t.i18n._("TImageAdvBrowser"),this.file_browser,l,"",null,!1,!0),Global.loadScript("global/widgets/formula_builder/FormulaBuilder.js",function(){o=Global.loadWidgetByName(FormItemType.FORMULA_BUILDER),o.FormulaBuilder({field:"formula",width:"100%",onFormulaBtnClick:function(){var d=TTAPI.APIReportCustomColumn;d.getOptions("formula_functions",{onResult:function(c){var g=c.getResult();e.api.getOptions("formula_variables",{onResult:m});function m(k){var b=k.getResult(),r={};r.functions=Global.buildRecordArray(g),r.variables=Global.buildRecordArray(b),r.formula=e.current_edit_record.company_value1,r.current_edit_record=Global.clone(e.current_edit_record),r.api=e.api,IndexViewController.openWizard("FormulaBuilderWizard",r,function(_){e.current_edit_record.company_value1=_,e.edit_view_ui_dic.df_11.setValue(_)})}}})}}),e.detachElement("df_11"),e.addEditFieldToColumn("FormulaBuilder",o,l,"",null,!0),o.parent().width("45%")});var n=t(".control-bar .action-chooser-div");this.all_employee_btn=n.find("#all_employee"),this.daily_totals_btn=n.find("#daily_totals"),this.weekly_totals_btn=n.find("#weekly_totals"),this.strict_range_btn=n.find("#strict_range"),this.all_employee_btn=this.all_employee_btn.SwitchButton({icon:u.all_employee,tooltip:t.i18n._("Show Unscheduled Employees")}),this.daily_totals_btn=this.daily_totals_btn.SwitchButton({icon:u.daily_total,tooltip:t.i18n._("Daily Totals")}),this.weekly_totals_btn=this.weekly_totals_btn.SwitchButton({icon:u.weekly_total,tooltip:t.i18n._("Weekly Totals")}),this.strict_range_btn=this.strict_range_btn.SwitchButton({icon:u.strict_range,tooltip:t.i18n._("Strict Range")}),this.all_employee_btn.click(function(){}),this.daily_totals_btn.click(function(){}),this.weekly_totals_btn.click(function(){}),this.strict_range_btn.setValue(!0),this.strict_range_btn.click(function(){}),this.toggle_button=t(this.el).find(".toggle-button-div");var h=[{label:t.i18n._("Day"),value:"day"},{label:t.i18n._("Week"),value:"week"},{label:t.i18n._("Month"),value:"month"},{label:t.i18n._("Year"),value:"year"}];this.toggle_button=this.toggle_button.TToggleButton({data_provider:h}),this.toggle_button.bind("change",function(d,c){e.scroll_position=0,e.select_all_shifts_array=[],e.select_shifts_array=[],e.select_recurring_shifts_array=[]}),o=Global.loadWidgetByName(FormItemType.TAG_INPUT),o.TTagInput({field:"tags",object_type_id:930}),this.addEditFieldToColumn(t.i18n._("TTagInput"),o,s,"",null,null,!0),o=Global.loadWidgetByName(FormItemType.TEXT_INPUT),o.TTextInput({field:"text",width:"100%"}),this.addEditFieldToColumn(t.i18n._("TText"),o,s),o.parent().width("45%"),o=Global.loadWidgetByName(FormItemType.PASSWORD_INPUT),o.TPasswordInput({field:"password",width:200}),this.addEditFieldToColumn(t.i18n._("TPasswordInput"),o,s),o=Global.loadWidgetByName(FormItemType.TEXT_AREA),o.TTextArea({field:"textarea"}),this.addEditFieldToColumn(t.i18n._("TTextArea"),o,s,"",null,null,!0)}buildSearchFields(){super.buildSearchFields(),this.search_fields=[]}getCustomContextMenuModel(){var e={exclude:["default"],include:["edit","cancel"]};return e}search(){var e=this;this.api.getUser({},!0,{onResult:function(i){var a=i.getResult();e.user_id_array=a,a=e.processResultData(a),e.grid.setData(a),e.grid.setGridColumnsWidth(),e.onEditClick(a[0].id)}})}setEditViewDataDone(){var e=this;setTimeout(function(){TAlertManager.showConfirmAlert(t.i18n._("Run tests?"),null,function(i){i==!0&&e.runTests()}),e.setTabOVisibility(!0),t(".edit-view-tab-bar").css("opacity",1),TTPromise.resolve("init","init")},2500),super.setEditViewDataDone()}runTests(){var e=this;t("#qunit_script").length==0&&(t("<script id='qunit_script' src='framework/qunit/qunit.js'><\/script>").appendTo("head"),t("<link rel='stylesheet' type='text/css' href='framework/qunit/qunit.css'>").appendTo("head")),QUnit.config.autostart=!1,t("#qunit_container").css("width","100%"),t("#qunit_container").css("height","auto"),t("#qunit_container").css("overflow-y","scroll"),t("#qunit_container").css("top","0px"),t("#qunit_container").css("left","0px"),t("#qunit_container").css("z-index","100"),t("#qunit_container").css("background","#fff"),t("#qunit_container").show(),t("#tt_debug_console").remove(),window.qunit_initiated||(window.qunit_initiated=!0),QUnit.module("Widgets"),this.testCheckbox(),this.testColorPicker(),TTPromise.add("datetests","picker"),TTPromise.add("datetests","range"),this.testDatePicker(),this.testDateRange(),TTPromise.wait("datetests",null,function(){e.testTimePicker()}),TTPromise.add("wizardtests","imagebrowser"),this.testImageBrowser(),TTPromise.wait("wizardtests","imagebrowser",function(){e.testFormulaBuilder()}),TTPromise.wait("null","null",function(){e.testTags()}),this.testButtons(),this.testText(),this.testPassword(),this.testTextarea()}testCheckbox(){var e=this;QUnit.test("Checkbox tests",function(i){var a=e.edit_view_ui_dic.checkbox;i.ok(a.getValue()==!1,"checkbox not checked"),a.setValue(!0),i.ok(a.getValue(),"checkbox checked via code"),a.setValue(!1),i.ok(a.getValue()==!1,"checkbox unchecked via code"),t(a).click(),i.ok(a.getValue(),"checkbox checked via click"),t(a).click(),i.ok(a.getValue()==!1,"checkbox unchecked via click")})}testColorPicker(){var e=this;QUnit.test("ColorPicker tests",function(i){var a=i.async(),l=e.edit_view_ui_dic.color_picker;i.ok(l.getValue()=="","widget empty"),t(l).click(),setTimeout(function(){t(".cp-color-picker").hide(),i.ok(l.getValue()=="FFFFFF","widget white after no select: "+l.getValue()),l.setValue("FF0000"),i.ok(l.getValue()=="FF0000","widget red after set value programatically"+l.getValue()),t(l).click(),t(".cp-color-picker").hide(),a()},1e3)})}testDatePicker(){var e=this;QUnit.test("DatePicker tests",function(i){var a=i.async(),l=e.edit_view_ui_dic.datepicker;i.ok(l.getValue()=="","widget empty"),setTimeout(function(){l.find("#tDatePickerIcon").trigger("mouseup"),i.ok(t("#ui-datepicker-div:visible").length>0,"calendar visible after click"),t(t("#ui-datepicker-div .ui-datepicker-calendar td")[15]).click(),setTimeout(function(){i.ok(t("#ui-datepicker-div:visible").length==0,"calendar invisible after date selection"),i.ok(l.getValue()!="","value is not blank"),TTPromise.resolve("datetests","picker"),a()},1e3)},1e3)})}testDateRange(){var e=this;QUnit.test("DateRange tests",function(i){var a=i.async(),l=e.edit_view_ui_dic.daterange;i.ok(typeof l.getValue()>"u","widget empty "+l.getValue()),l.find("#tDatePickerIcon").trigger("mouseup"),setTimeout(function(){i.ok(t(".t-range-picker-div:visible").length>0,"calendar visible after click"),t(t(".t-range-picker-div .end-picker td")[15]).click(),t(".t-range-picker-div .close-icon").click(),setTimeout(function(){i.ok(t(".t-range-picker-div:visible").length==0,"calendar invisible after closing"),i.ok(l.getValue()!="","value is not blank"),a(),TTPromise.resolve("datetests","range")},1e3)},1e3)})}testTimePicker(){var e=this;QUnit.test("TimePicker tests",function(i){var a=e.edit_view_ui_dic.timepicker;i.ok(a.getValue()=="","widget empty: "+a.getValue()),a.find("#tTimePickerIcon").trigger("mouseup"),i.ok(t("#ui-datepicker-div:visible").length>0,"timepicker widget visible after click"),t('#ui-datepicker-div:visible button[data-handler="today"]').click(),i.ok(t("#ui-datepicker-div:visible").length>0,"timepicker widget visible after now click"),t('#ui-datepicker-div:visible button[data-handler="hide"]').click(),i.ok(t("#ui-datepicker-div:visible").length==0,"timepicker widget gone clicking close button"),i.ok(a.getValue()!="","value is not blank")})}testImageBrowser(){var e=this;TTPromise.add(""),QUnit.test("ImageBrowser tests",function(i){var a=i.async(),l=e.edit_view_ui_dic.imagebrowser;i.ok(typeof l.getValue()>"u","widget empty: "+l.getValue()),l.find("#upload_image").click(),setTimeout(function(){i.ok(t(".wizard:visible").length>0,"wizard visible"),t(".wizard:visible .close-btn").click(),i.ok(t(".wizard:visible").length==0,"wizard invisible"),a(),TTPromise.resolve("wizardtests","imagebrowser")},1e3)})}testFormulaBuilder(){var e=this;QUnit.test("FormulaBuilder tests",function(i){var a=i.async(),l=e.edit_view_ui_dic.formula;i.ok(l.getValue()=="","widget empty: "+l.getValue()),l.find(".t-button.formula-btn").click(),setTimeout(function(){i.ok(t(".wizard:visible").length>0,"wizard visible"),t(".wizard:visible .close-btn").click(),i.ok(t(".wizard:visible").length==0,"wizard invisible"),a()},1e3)})}testButtons(){QUnit.test("TotalButtons tests",function(e){var i=e.async(),a=t(".control-bar .action-chooser-div #all_employee .all-employee"),l=t(".control-bar .action-chooser-div #daily_totals .daily"),s=t(".control-bar .action-chooser-div #weekly_totals .weekly"),o=t(".control-bar .action-chooser-div #strict_range .strict-range");e.ok(o.hasClass("selected"),"strict range starts selected"),e.ok(l.hasClass("selected")==!1,"daily totals starts unselected"),e.ok(s.hasClass("selected")==!1,"week total starts unselected"),e.ok(a.hasClass("selected")==!1,"all employees starts unselected"),o.click(),setTimeout(function(){e.ok(o.hasClass("selected")==!1,"strict range unselects on click"),l.click(),setTimeout(function(){e.ok(l.hasClass("selected"),"daily_totals_btn selects on click"),s.click(),setTimeout(function(){e.ok(s.hasClass("selected"),"weekly_totals_btn selects on click"),a.click(),setTimeout(function(){e.ok(a.hasClass("selected"),"all_employee_btn selects on click"),o.click(),l.click(),s.click(),a.click(),setTimeout(function(){e.ok(o.hasClass("selected"),"strict range starts selected"),e.ok(l.hasClass("selected")==!1,"daily totals starts unselected"),e.ok(s.hasClass("selected")==!1,"week total starts unselected"),e.ok(a.hasClass("selected")==!1,"all employees starts unselected"),i()},1500)},1500)},1500)},1500)},1500)})}testTags(){var e=this;QUnit.test("Tags tests",function(i){var a=i.async(),l=e.edit_view_ui_dic.tags.find("input.add-tag-input"),s=e.edit_view_ui_dic.tags.getValue();i.ok(s=="","starts empty "+s),l.focus(),t(l).val("test1"),t(l).trigger({type:"keydown",which:32,keyCode:32}),t(l).val("test2"),t(l).trigger({type:"keydown",which:32,keyCode:32}),setTimeout(function(){var o=e.edit_view_ui_dic.tags.getValue();i.ok(o=="test1,test2","2 tags entered and return in value: "+o),setTimeout(function(){t(".tag-span-div .close-btn").click(),setTimeout(function(){var n=e.edit_view_ui_dic.tags.getValue();i.ok(n=="-test1,-test2","2 tags entered and return (subtracted) in value: "+n),a()},1e3)},1e3)},1e3)})}testText(){var e=this;QUnit.test("Text test",function(i){var a=e.edit_view_ui_dic.text;a.setValue("testing textbox"),i.ok(a.getValue()=="testing textbox","accepts text and returns value"),a.setValue(""),i.ok(a.getValue()=="","returned value updates when text is updated")})}testPassword(){var e=this;QUnit.test("Password box test",function(i){var a=e.edit_view_ui_dic.password;a.setValue("testing textbox"),i.ok(a.getValue()=="testing textbox","accepts text and returns value"),a.setValue(""),i.ok(a.getValue()=="","returned value updates when text is updated")})}testTextarea(){var e=this;QUnit.test("Password box test",function(i){var a=e.edit_view_ui_dic.textarea;a.setValue("testing textbox"),i.ok(a.getValue()=="testing textbox","accepts text and returns value"),a.setValue(""),i.ok(a.getValue()=="","returned value updates when text is updated")})}}export{C as WidgetTestViewController};
//# sourceMappingURL=WidgetTestViewController-CflWuHeT.bundle.js.map
