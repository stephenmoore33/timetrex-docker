import{_ as c,j as a}from"./vendor-tTApdY0Y.bundle.js";class y extends BaseViewController{constructor(i={}){c.defaults(i,{el:"#user_preference_view_container",date_format_array:null,other_date_format_array:null,js_date_format_array:null,flex_date_format_array:null,jquery_date_format_array:null,time_format_array:null,js_time_format_array:null,flex_time_format_array:null,date_time_format_array:null,time_unit_format_array:null,distance_format_array:null,time_zone_array:null,location_timezone_array:null,area_code_timezone_array:null,timesheet_view_array:null,start_week_day_array:null,schedule_icalendar_type_array:null,language_array:null,user_group_array:null,country_array:null,province_array:null,notification_status_array:null,notification_type_array:null,priority_array:null,original_user_preference_notification_data:[],e_province_array:null,user_api:null,user_group_api:null,company_api:null,api_date:null,user_preference_notification_api:null}),super(i)}init(i){this.edit_view_tpl="UserPreferenceEditView.html",this.permission_id="user_preference",this.viewId="UserPreference",this.script_name="UserPreferenceView",this.table_name_key="user_preference",this.context_menu_name=a.i18n._("Preferences"),this.navigation_label=a.i18n._("Employees"),this.api=TTAPI.APIUserPreference,this.api_date=TTAPI.APITTDate,this.user_api=TTAPI.APIUser,this.user_group_api=TTAPI.APIUserGroup,this.company_api=TTAPI.APICompany,this.user_preference_notification_api=TTAPI.APIUserPreferenceNotification,this.render(),this.buildContextMenu(),this.initData()}getCustomContextMenuModel(){var i={exclude:["add","copy","copy_as_new","save_and_copy","save_and_new","delete_icon","delete_and_next"],include:[]};return i}initOptions(){var i=this,d=[{option_name:"status",api:this.user_api},{option_name:"country",field_name:"country",api:this.company_api},{option_name:"language",api:this.api},{option_name:"date_format",api:this.api},{option_name:"time_format",api:this.api},{option_name:"time_unit_format",api:this.api},{option_name:"distance_format",api:this.api},{option_name:"time_zone",api:this.api},{option_name:"start_week_day",api:this.api},{option_name:"schedule_icalendar_type",api:this.api},{option_name:"default_login_screen",api:this.api},{option_name:"notification_status",api:this.api},{option_name:"notification_type",api:this.user_preference_notification_api},{option_name:"priority",api:this.user_preference_notification_api}];this.initDropDownOptions(d),this.user_group_api.getUserGroup("",!1,!1,{onResult:function(r){r=r.getResult(),r=Global.buildTreeRecord(r),i.user_group_array=r,!i.sub_view_mode&&i.basic_search_field_ui_dic.group_id&&(i.basic_search_field_ui_dic.group_id.setSourceData(r),i.adv_search_field_ui_dic.group_id.setSourceData(r))}})}initInsideEditorData(){var i=this,d={};d.filter_data={},d.filter_data.user_id=this.current_edit_record.user_id,i.user_preference_notification_api.getUserPreferenceNotification(d,!0,{onResult:function(r){var n=r.getResult(),e=[];for(var t in n)n.hasOwnProperty(t)&&e.push(n[t]);e=e.sort(function(l,o){return i.notification_type_array.findIndex(_=>_.id===l.type_id)-i.notification_type_array.findIndex(_=>_.id===o.type_id)}),i.original_user_preference_notification_data=c.map(e,c.clone),i.editor.setValue(e)}})}setProvince(i,d){var r=this;!i||i==="-1"||i==="0"?(r.province_array=[],this.adv_search_field_ui_dic.province.setSourceData([])):this.company_api.getOptions("province",i,{onResult:function(n){n=n.getResult(),n||(n=[]),r.province_array=Global.buildRecordArray(n),r.adv_search_field_ui_dic.province.setSourceData(r.province_array)}})}eSetProvince(i,d){var r=this,n=r.edit_view_ui_dic.province;!i||i==="-1"||i==="0"?(r.e_province_array=[],n.setSourceData([])):this.company_api.getOptions("province",i,{onResult:function(e){e=e.getResult(),e||(e=[]),r.e_province_array=Global.buildRecordArray(e),d&&r.e_province_array.length>0&&(r.current_edit_record.province=r.e_province_array[0].value,n.setValue(r.current_edit_record.province)),n.setSourceData(r.e_province_array)}})}onSetSearchFilterFinished(){if(this.search_panel.getSelectTabIndex()===1){var i=this.adv_search_field_ui_dic.country,d=i.getValue();this.setProvince(d)}}onBuildAdvUIFinished(){this.adv_search_field_ui_dic.country.change(a.proxy(function(){var i=this.adv_search_field_ui_dic.country,d=i.getValue();this.setProvince(d),this.adv_search_field_ui_dic.province.setValue(null)},this))}buildSearchFields(){this.search_fields=[new SearchField({label:a.i18n._("Employee"),in_column:1,field:"user_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_user",api_class:TTAPI.APIUser,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:a.i18n._("Status"),in_column:1,field:"status_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:a.i18n._("First Name"),in_column:1,field:"first_name",basic_search:!0,adv_search:!0,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:a.i18n._("Last Name"),in_column:1,field:"last_name",basic_search:!0,adv_search:!0,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:a.i18n._("Employee Number"),in_column:1,field:"employee_number",basic_search:!1,adv_search:!0,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:a.i18n._("Group"),in_column:2,multiple:!0,field:"group_id",layout_name:"global_tree_column",tree_mode:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:a.i18n._("Default Branch"),in_column:2,field:"default_branch_id",layout_name:"global_branch",api_class:TTAPI.APIBranch,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:a.i18n._("Default Department"),field:"default_department_id",in_column:2,layout_name:"global_department",api_class:TTAPI.APIDepartment,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:a.i18n._("Title"),field:"title_id",in_column:2,layout_name:"global_job_title",api_class:TTAPI.APIUserTitle,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:a.i18n._("Country"),in_column:3,field:"country",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.COMBO_BOX}),new SearchField({label:a.i18n._("Province/State"),in_column:3,field:"province",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX})]}onFormItemChange(i,d){this.setIsChanged(i),this.setMassEditingFieldsWhenFormChange(i);var r=i.getField(),n=i.getValue();this.current_edit_record[r]=n,r==="schedule_icalendar_type_id"?this.onStatusChange():r==="notification_status_id"&&this.initSubNotificationView(),d||this.validate()}buildEditViewUI(){super.buildEditViewUI();var i=this,d={tab_preference:{label:a.i18n._("Preferences")},tab_preferences_notification:{label:a.i18n._("Notifications"),init_callback:"initSubNotificationView",html_template:this.getPreferencesNotificationTabHtml()},tab_schedule_sync:{label:a.i18n._("Schedule Synchronization"),init_callback:"initSubScheduleSyncView",html_template:this.getScheduleSyncronizationTabHtml()},tab_audit:!0};this.setTabModel(d),this.navigation.AComboBox({id:this.script_name+"_navigation",api_class:TTAPI.APIUserPreference,allow_multiple_selection:!1,layout_name:"global_user_preference",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation();var r=this.edit_view_tab.find("#tab_preference"),n=r.find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(n);var e,t,l;this.is_mass_editing||(e=Global.loadWidgetByName(FormItemType.TEXT),e.TText({field:"full_name"}),this.addEditFieldToColumn(a.i18n._("Employee"),e,n,"")),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"language",set_empty:!0}),e.setSourceData(i.language_array),this.addEditFieldToColumn(a.i18n._("Language"),e,n),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"date_format",set_empty:!0}),e.setSourceData(i.date_format_array),this.addEditFieldToColumn(a.i18n._("Date Format"),e,n),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"time_format",set_empty:!0}),e.setSourceData(i.time_format_array),this.addEditFieldToColumn(a.i18n._("Time Format"),e,n),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"time_unit_format",set_empty:!0}),e.setSourceData(i.time_unit_format_array),this.addEditFieldToColumn(a.i18n._("Time Units"),e,n),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"distance_format",set_empty:!0}),e.setSourceData(i.distance_format_array),this.addEditFieldToColumn(a.i18n._("Distance Units"),e,n),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"time_zone",set_empty:!0}),e.setSourceData(i.time_zone_array),this.addEditFieldToColumn(a.i18n._("Time Zone"),e,n),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"start_week_day"}),e.setSourceData(i.start_week_day_array),this.addEditFieldToColumn(a.i18n._("Calendar Starts On"),e,n),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"items_per_page",width:50}),this.addEditFieldToColumn(a.i18n._("Rows per page"),e,n),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"default_login_screen"}),e.setSourceData(i.default_login_screen_array),this.addEditFieldToColumn(a.i18n._("Default Screen"),e,n),e=Global.loadWidgetByName(FormItemType.CHECKBOX),e.TCheckbox({field:"enable_save_timesheet_state"}),this.addEditFieldToColumn(a.i18n._("Save TimeSheet State"),e,n);var o=this.edit_view_tab.find("#tab_preferences_notification"),_=o.find(".first-column");if(this.edit_view_tabs[1]=[],this.edit_view_tabs[1].push(_),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"notification_status_id"}),e.setSourceData(Global.addFirstItemToArray(i.notification_status_array)),this.addEditFieldToColumn(a.i18n._("Notification Status"),e,_),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"notification_duration",width:50}),t=a("<div class='widget-h-box'></div>"),l=a("<span class='widget-right-label'> "+a.i18n._("Seconds (Use 0 for infinite)")+"</span>"),t.append(e),t.append(l),this.addEditFieldToColumn(a.i18n._("Display Notifications For"),e,_,"",t),this.is_mass_editing==!1){let f=function(){return`
			<table class="inside-editor-render">
				<tr class="title">
					<td style="width: 50px"><%= enabled %></td>
					<td style="width: 400px"><%= name %></td>
					<td style="width: 150px"><%= priority %></td>
					<td style="width: 110px"><%= web %></td>
					<td style="width: 110px"><%= email_work %></td>
					<td style="width: 110px"><%= email_home %></td>
					<td style="width: 110px"><%= app %></td>
					<td style="width: 200px"><%= settings %></td>
				</tr>
			</table>`},b=function(){return`
			<tr class="inside-editor-row data-row">
				<td class="cell"></td>
				<td class="cell"></td>
				<td class="cell"></td>
				<td class="cell"></td>
				<td class="cell"></td>
				<td class="cell"></td>
				<td class="cell"></td>
				<td class="cell"></td>
			</tr>`};var m=o.find(".inside-editor-div"),h={enabled:a.i18n._("Enabled"),name:a.i18n._("Type"),web:a.i18n._("Browser"),email_work:a.i18n._("Work Email"),email_home:a.i18n._("Home Email"),app:a.i18n._("Mobile App"),priority:a.i18n._("Priority"),settings:a.i18n._("Settings")};this.editor=Global.loadWidgetByName(FormItemType.INSIDE_EDITOR),this.editor.InsideEditor({title:"",addRow:this.insideEditorAddRow,getValue:this.insideEditorGetValue,setValue:this.insideEditorSetValue,parent_controller:this,render:f(),render_args:h,render_inline_html:!0,row_render:b()}),m.append(this.editor)}var p=this.edit_view_tab.find("#tab_schedule_sync"),s=p.find(".first-column");this.edit_view_tabs[2]=[],this.edit_view_tabs[2].push(s),e=Global.loadWidgetByName(FormItemType.SEPARATED_BOX),e.SeparatedBox({label:a.i18n._("Shifts Scheduled to Work")}),this.addEditFieldToColumn(null,e,s,"",null,!0,!1,"shifts_scheduled_to_work"),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"schedule_icalendar_alarm1_working",width:90,need_parser_sec:!0}),t=a("<div class='widget-h-box'></div>"),l=a("<span class='widget-right-label'>( "+a.i18n._("before schedule start time")+" )</span>"),t.append(e),t.append(l),this.addEditFieldToColumn(a.i18n._("Alarm 1"),e,s,"",t,!0),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"schedule_icalendar_alarm2_working",width:90,need_parser_sec:!0}),t=a("<div class='widget-h-box'></div>"),l=a("<span class='widget-right-label'>( "+a.i18n._("before schedule start time")+" )</span>"),t.append(e),t.append(l),this.addEditFieldToColumn(a.i18n._("Alarm 2"),e,s,"",t,!0),e=Global.loadWidgetByName(FormItemType.SEPARATED_BOX),e.SeparatedBox({label:a.i18n._("Shifts Scheduled Absent")}),this.addEditFieldToColumn(null,e,s,"",null,!0,!1,"shifts_scheduled_absent"),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"schedule_icalendar_alarm1_absence",width:90,need_parser_sec:!0}),t=a("<div class='widget-h-box'></div>"),l=a("<span class='widget-right-label'>( "+a.i18n._("before schedule start time")+" )</span>"),t.append(e),t.append(l),this.addEditFieldToColumn(a.i18n._("Alarm 1"),e,s,"",t,!0),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"schedule_icalendar_alarm2_absence",width:90,need_parser_sec:!0}),t=a("<div class='widget-h-box'></div>"),l=a("<span class='widget-right-label'>( "+a.i18n._("before schedule start time")+" )</span>"),t.append(e),t.append(l),this.addEditFieldToColumn(a.i18n._("Alarm 2"),e,s,"",t,!0),e=Global.loadWidgetByName(FormItemType.SEPARATED_BOX),e.SeparatedBox({label:a.i18n._("Modified Shifts")}),this.addEditFieldToColumn(null,e,s,"",null,!0,!1,"modified_shifts"),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"schedule_icalendar_alarm1_modified",width:90,need_parser_sec:!0}),t=a("<div class='widget-h-box'></div>"),l=a("<span class='widget-right-label'>( "+a.i18n._("before schedule start time")+" )</span>"),t.append(e),t.append(l),this.addEditFieldToColumn(a.i18n._("Alarm 1"),e,s,"",t,!0),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"schedule_icalendar_alarm2_modified",width:90,need_parser_sec:!0}),t=a("<div class='widget-h-box'></div>"),l=a("<span class='widget-right-label'>( "+a.i18n._("before schedule start time")+" )</span>"),t.append(e),t.append(l),this.addEditFieldToColumn(a.i18n._("Alarm 2"),e,s,"",t,!0)}onMassEditClick(){var i=this;i.is_add=!1,i.is_viewing=!1,i.is_mass_editing=!0,LocalCacheData.current_doing_context_action="mass_edit",i.openEditView();var d={},r=this.getGridSelectIdArray();r.length,this.mass_edit_record_ids=[],a.each(r,function(n,e){i.mass_edit_record_ids.push(e)}),d.filter_data={},d.filter_data.id=this.mass_edit_record_ids,this.api["getCommon"+this.api.key_name+"Data"](d,{onResult:function(n){var e=n.getResult();e||(e=[]),i.unique_columns=[],i.linked_columns=[],i.current_edit_record=e,i.initEditView()}})}onStatusChange(){this.current_edit_record.schedule_icalendar_type_id==0?(this.detachElement("schedule_icalendar_alarm1_working"),this.detachElement("schedule_icalendar_alarm2_working"),this.detachElement("schedule_icalendar_alarm1_absence"),this.detachElement("schedule_icalendar_alarm2_absence"),this.detachElement("schedule_icalendar_alarm1_modified"),this.detachElement("schedule_icalendar_alarm2_modified"),this.detachElement("shifts_scheduled_to_work"),this.detachElement("shifts_scheduled_absent"),this.detachElement("modified_shifts")):(this.attachElement("schedule_icalendar_alarm1_working"),this.attachElement("schedule_icalendar_alarm2_working"),this.attachElement("schedule_icalendar_alarm1_absence"),this.attachElement("schedule_icalendar_alarm2_absence"),this.attachElement("schedule_icalendar_alarm1_modified"),this.attachElement("schedule_icalendar_alarm2_modified"),this.attachElement("shifts_scheduled_to_work"),this.attachElement("shifts_scheduled_absent"),this.attachElement("modified_shifts")),this.editFieldResize()}setCurrentEditRecordData(){for(var i in this.current_edit_record){var d=this.edit_view_ui_dic[i];if(Global.isSet(d))switch(i){case"full_name":d.setValue(this.current_edit_record.first_name+" "+this.current_edit_record.last_name);break;default:d.setValue(this.current_edit_record[i]);break}}this.collectUIDataToCurrentEditRecord(),this.setEditViewDataDone()}setEditViewDataDone(){super.setEditViewDataDone(),this.onStatusChange(),this.is_mass_editing==!1&&this.initInsideEditorData()}setCalendarURL(i){if(Global.isSet(i)||(i=this.edit_view_ui_dic.calendar_url),this.is_mass_editing){i.setValue("Not available when mass editing");return}this.api.getScheduleIcalendarURL(this.current_edit_record.user_name,this.current_edit_record.schedule_icalendar_type_id,{onResult:function(d){var r=d.getResult();i.setValue(ServiceCaller.root_url+r,!0),i.unbind("click"),i.click(function(){window.open(i.text())})}})}initSubScheduleSyncView(){Global.getProductEdition()>=15?(this.edit_view_tab.find("#tab_schedule_sync").find(".first-column").css("display","block"),this.edit_view.find(".permission-defined-div").css("display","none"),this.buildContextMenu(!0),this.setEditMenu()):(this.edit_view_tab.find("#tab_schedule_sync").find(".first-column").css("display","none"),this.edit_view.find(".permission-defined-div").css("display","block"),this.edit_view.find(".permission-message").html(Global.getUpgradeMessage()))}initSubNotificationView(){this.current_edit_record.notification_status_id==0?(this.edit_view_tab.find("#tab_preferences_notification").find(".inside-editor-div").css("display","none"),this.edit_view_ui_dic.notification_duration.parent().parent().parent().css("display","none")):(this.edit_view_tab.find("#tab_preferences_notification").find(".inside-editor-div").css("display","block"),this.edit_view_ui_dic.notification_duration.parent().parent().parent().css("display","block"))}insideEditorSetValue(i){var d=i.length;if(d!==0){this.removeAllRows();for(var r=0;r<i.length;r++)if(Global.isSet(i[r])){var n=i[r];n.enabled=n.status_id==10,n.web_push_enabled=n.device_id.includes(4),n.email_work_enabled=n.device_id.includes(256),n.email_home_enabled=n.device_id.includes(512),n.app_push_enabled=n.device_id.includes(32768),n.type_id.startsWith("reminder_")&&(n.reminder_delay=n.reminder_delay),this.addRow(n)}}}insideEditorAddRow(i,d){i||(i={});var r=this.getRowRender(),n=this.getRender(),e={};t=Global.loadWidgetByName(FormItemType.CHECKBOX),t.TCheckbox({field:"enabled"}),t.setValue(i.enabled),e[t.getField()]=t,r.children().eq(0).append(t),this.setWidgetEnableBaseOnParentController(t);var t=Global.loadWidgetByName(FormItemType.COMBO_BOX);if(t.TComboBox({field:"type_id"}),t.setSourceData(Global.addFirstItemToArray(this.parent_controller.notification_type_array)),t.setValue(i.type_id),t.setEnabled(!1),t.css("text-align-last","center"),e[t.getField()]=t,r.children().eq(1).append(t),t=Global.loadWidgetByName(FormItemType.COMBO_BOX),t.TComboBox({field:"priority_id",set_empty:!1}),t.setSourceData(this.parent_controller.priority_array),t.setValue(i.priority_id),e[t.getField()]=t,r.children().eq(2).append(t),t=Global.loadWidgetByName(FormItemType.CHECKBOX),t.TCheckbox({field:"web_push_enabled"}),t.setValue(i.web_push_enabled),e[t.getField()]=t,r.children().eq(3).append(t),t=Global.loadWidgetByName(FormItemType.CHECKBOX),t.TCheckbox({field:"email_work_enabled"}),t.setValue(i.email_work_enabled),e[t.getField()]=t,r.children().eq(4).append(t),t=Global.loadWidgetByName(FormItemType.CHECKBOX),t.TCheckbox({field:"email_home_enabled"}),t.setValue(i.email_home_enabled),e[t.getField()]=t,r.children().eq(5).append(t),t=Global.loadWidgetByName(FormItemType.CHECKBOX),t.TCheckbox({field:"app_push_enabled"}),t.setValue(i.app_push_enabled),e[t.getField()]=t,r.children().eq(6).append(t),i.type_id.startsWith("reminder_")){t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"reminder_delay",need_parser_sec:!0,mode:"time_unit"}),t.setValue(i.reminder_delay),e[t.getField()]=t;var l=a("<div class='widget-h-box'></div>"),o=a("<span class='widget-left-label'> "+a.i18n._("Delay")+": </span>");l.append(o),l.append(t),r.children().eq(7).append(l)}e.current_edit_item=i,typeof d<"u"?(r.insertAfter(a(n).find("tr").eq(d)),this.rows_widgets_array.splice(d,0,e)):(a(n).append(r),this.rows_widgets_array.push(e)),this.parent_controller.is_viewing&&r.find(".control-icon").hide(),this.removeLastRowLine()}insideEditorGetValue(i){for(var d=this.rows_widgets_array.length,r=[],n=0;n<d;n++){var e=this.rows_widgets_array[n],t=e.current_edit_item;t.priority_id=e.priority_id.getValue(),t.status_id=e.enabled.getValue()===!0?10:20,t.device_id=[],e.web_push_enabled.getValue()===!0&&t.device_id.push(4),e.email_work_enabled.getValue()===!0&&t.device_id.push(256),e.email_home_enabled.getValue()===!0&&t.device_id.push(512),e.app_push_enabled.getValue()===!0&&t.device_id.push(32768),t.type_id.startsWith("reminder_")&&e.reminder_delay&&(t.reminder_delay=e.reminder_delay.getValue()),r.push(t)}return r}onSaveResult(i){var d=this;if(i&&i.isValid()){var r=i.getResult();r===!0?d.refresh_id=d.current_edit_record.id:TTUUID.isUUID(r)&&r!=TTUUID.zero_id&&r!=TTUUID.not_exist_id&&(d.refresh_id=r),this.is_mass_editing==!1?d.saveInsideEditorData(function(){var n=d.onSaveDone(i);(n==null||n==!0)&&d.removeEditView()}):d.removeEditView()}else d.setErrorMenu(),d.setErrorTips(i)}saveInsideEditorData(i){var d=this.editor.getValue(this.refresh_id);let r=this.getChangedRecords(d,this.original_user_preference_notification_data,["enabled","web_push_enabled","email_work_enabled","email_home_enabled","app_push_enabled"]);Array.isArray(r)&&r.length>0?this.user_preference_notification_api.setUserPreferenceNotification(r,{onResult:function(n){Global.isSet(i)&&i()}}):Global.isSet(i)&&i()}onSaveDone(i){var d=this.getSelectedItem().id;d===LocalCacheData.getLoginUser().id&&Global.updateUserPreference()}onSaveAndContinueDone(i){this.onSaveDone(i),this.initInsideEditorData()}onSaveAndNextDone(i){this.onSaveDone(i)}validate(){var i=this,d={};if(this.is_mass_editing){for(var r in this.edit_view_ui_dic){var n=this.edit_view_ui_dic[r];Global.isSet(n.isChecked)&&n.isChecked()&&n.getEnabled()&&(d[r]=n.getValue())}this.mass_edit_record_ids.length>0&&(d.id=this.mass_edit_record_ids[0])}else d=this.current_edit_record;this.api["validate"+this.api.key_name](d,{onResult:function(e){i.validateResult(e)}})}getPreferencesNotificationTabHtml(){return`<div id="tab_preferences_notification" class="edit-view-tab-outside">
					<div class="edit-view-tab" id="tab_preferences_notification_content_div">
						<div class="first-column full-width-column"></div>
						<div class="inside-editor-div full-width-column"></div>
					</div>
				</div>`}getScheduleSyncronizationTabHtml(){return`<div id="tab_schedule_sync" class="edit-view-tab-outside">
					<div class="edit-view-tab" id="tab_schedule_sync_content_div">
						<div class="first-column full-width-column"></div>
						<div class="save-and-continue-div permission-defined-div">
							<span class="message permission-message"></span>
						</div>
					</div>
				</div>`}setSubLogViewFilter(){return this.sub_log_view_controller?(this.sub_log_view_controller.getSubViewFilter=function(i){return i.table_name_object_id={user_preference:[this.parent_edit_record.id],user_preference_notification:this.parent_view_controller.editor.getValue(this.refresh_id).map(d=>d.id)},i},!0):!1}}y.loadView=function(){Global.loadViewSource("UserPreference","UserPreferenceView.html",function(u){Global.contentContainer().html(u)})};export{y as UserPreferenceViewController};
//# sourceMappingURL=UserPreferenceViewController-DtzPe9SK.bundle.js.map
