import{_ as r,j as o}from"./vendor-tTApdY0Y.bundle.js";class u extends BaseViewController{constructor(e={}){r.defaults(e,{el:"#document_revision_view_container"}),super(e)}init(e){this.edit_view_tpl="DocumentRevisionEditView.html",this.permission_id="document",this.viewId="DocumentRevision",this.script_name="DocumentRevisionView",this.table_name_key="document_revision",this.context_menu_name=o.i18n._("Revisions"),this.navigation_label=o.i18n._("Revision"),this.api=TTAPI.APIDocumentRevision,this.render(),this.sub_view_mode?this.buildContextMenu(!0):this.buildContextMenu(),this.sub_view_mode||this.initData(),Global.initFileDragAndDrop(document.querySelector(this.el+" .grid-div"),i=>{this.attachDragAndDropFile(i)})}getCustomContextMenuModel(){var e={groups:{download:{label:o.i18n._("Download"),id:this.script_name+"download"}},exclude:["export_excel","mass_edit","copy"],include:[{label:o.i18n._("Download"),id:"download",group:"download"},{label:o.i18n._("View"),id:"view_file",group:"download"}]};return e}setCustomDefaultMenuIcon(e,i,t){switch(e){case"download":case"view_file":this.setDefaultMenuDownIcon(i,t);break}}setDefaultMenuDownIcon(e,i,t){i===1?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setCustomEditMenuIcon(e,i){switch(e){case"download":case"view_file":this.setEditMenuDownloadIcon(i);break}}setEditViewDataDone(){super.setEditViewDataDone(),Global.initFileDragAndDrop(this.edit_view[0].firstElementChild,e=>{this.attachDragAndDropFile(e)})}onCustomContextClick(e){switch(e){case"download":this.onDownloadClick();break}}onAddClick(){var e=this;if(this.setCurrentEditViewState("new"),e.openEditView(),this.sub_view_mode){if(this.parent_key==="document_id"){var i=this.parent_value;e.api["get"+e.api.key_name+"DefaultData"](i,{onResult:function(t){e.onAddResult(t)}})}}else e.api["get"+e.api.key_name+"DefaultData"]({onResult:function(t){e.onAddResult(t)}})}setEditMenuDownloadIcon(e,i){(!this.current_edit_record||!this.current_edit_record.id)&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}handleSaveResult(e,i){var t=this,n=e.getResult()===!0&&this.current_edit_record.id?this.current_edit_record.id:e.getResult(),a=t.file_browser.getValue();a?t.api.uploadFile(a,"object_type=document_revision&object_id="+n,{onResult:d=>{super[i](e)}}):super[i](e)}onSaveResult(e){return this.handleSaveResult(e,"onSaveResult")}onSaveAndContinueResult(e){return this.handleSaveResult(e,"onSaveAndContinueResult")}onSaveAndNewResult(e){return this.handleSaveResult(e,"onSaveAndNewResult")}onSaveAndCopyResult(e){return this.handleSaveResult(e,"onSaveAndCopyResult")}onCustomContextClick(e){switch(e){case"download":case"view_file":this.onDownloadClick();break}}doFormIFrameCall(){var e=ServiceCaller.getURLByObjectType("file_download")+"&object_type=document&parent_id="+this.current_edit_record.document_id+"&object_id="+this.current_edit_record.id;Global.APIFileDownload(null,null,null,e)}onDownloadClick(){var e=this;if(this.edit_view&&this.current_edit_record.id)this.doFormIFrameCall();else{var i={},t,n=this.getGridSelectIdArray(),a=n.length;a>0&&(t=n[0]),i.filter_data={},i.filter_data.id=[t];var d=this.api["get"+this.api.key_name](i,{async:!1}),l=d.getResult();l||(l=[]),l=l[0],e.current_edit_record=l,e.doFormIFrameCall()}}buildEditViewUI(){super.buildEditViewUI();var e={tab_revision:{label:o.i18n._("Revision")}};this.setTabModel(e),this.navigation.AComboBox({api_class:TTAPI.APIDocumentRevision,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_document_revison",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation();var i=this.edit_view_tab.find("#tab_revision"),t=i.find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(t);var n=Global.loadWidgetByName(FormItemType.TEXT_INPUT);n.TTextInput({field:"revision",width:114}),this.addEditFieldToColumn(o.i18n._("Revision"),n,t,""),n=Global.loadWidgetByName(FormItemType.FILE_BROWSER),this.file_browser=n.TImageBrowser({field:"",name:"file_data",accept_filter:"*"}),this.addEditFieldToColumn(o.i18n._("File"),n,t,"",null,!1,!0),n=Global.loadWidgetByName(FormItemType.TEXT_AREA),n.TTextArea({field:"change_log"}),this.addEditFieldToColumn(o.i18n._("Change Log"),n,t,"",null,!1,!0)}attachDragAndDropFile(e){this.is_edit==!1&&this.is_add==!1&&this.is_viewing==!1&&this.onAddClick();let i=new DataTransfer;i.items.add(e[0]);let t=this.edit_view_ui_dic[""][0].querySelector("input");t.files=i.files,o(t).trigger("change")}}u.loadSubView=function(s,e,i){Global.loadViewSource("DocumentRevision","SubDocumentRevisionView.html",function(t){var n={},a=r.template(t);Global.isSet(e)&&e(),Global.isSet(s)&&(s.html(a(n)),Global.isSet(i)&&TTPromise.wait("BaseViewController","initialize",function(){i(sub_document_revision_view_controller)}))})};export{u as DocumentRevisionViewController};
//# sourceMappingURL=DocumentRevisionViewController-B8SL0oEk.bundle.js.map
