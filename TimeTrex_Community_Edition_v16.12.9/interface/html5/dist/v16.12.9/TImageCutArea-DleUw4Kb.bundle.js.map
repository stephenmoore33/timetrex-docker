{"version":3,"file":"TImageCutArea-DleUw4Kb.bundle.js","sources":["../../global/widgets/filebrowser/TImageCutArea.js"],"sourcesContent":["( function( $ ) {\n\n\t$.fn.TImageCutArea = function( options ) {\n\n\t\tGlobal.addCss( 'global/widgets/filebrowser/TImageBrowser.css' );\n\t\tvar opts = $.extend( {}, $.fn.TImageCutArea.defaults, options );\n\n\t\tvar $this = this;\n\t\tvar field;\n\t\tvar name = 'file_data';\n\n\t\tvar default_width = 400;\n\t\tvar default_height = 300;\n\n\t\tvar default_after_width = 200;\n\t\tvar default_after_height = 150;\n\n\t\tthis.clearErrorStyle = function() {\n\n\t\t};\n\n\t\tthis.getField = function() {\n\t\t\treturn field;\n\t\t};\n\n\t\tthis.getValue = function() {\n\n\t\t};\n\n\t\tvar setAfterImage = function( val ) {\n\t\t\tvar image = $this.children().eq( 1 ).children().eq( 1 );\n\n\t\t\tif ( !val ) {\n\t\t\t\timage.attr( 'src', '' );\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar d = new Date();\n\t\t\timage.attr( 'src', val );\n\n\t\t};\n\n\t\tthis.setImage = function( val ) {\n\t\t\tvar image = $this.children().eq( 0 ).children().eq( 1 );\n\n\t\t\tif ( !val ) {\n\t\t\t\timage.attr( 'src', '' );\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar d = new Date();\n\t\t\timage.attr( 'src', val );\n\n\t\t\tsetAfterImage( val );\n\n\t\t\tsetTimeout( function() {\n\t\t\t\t$( image ).imgAreaSelect( {\n\t\t\t\t\thandles: true,\n\t\t\t\t\tx1: 0,\n\t\t\t\t\ty1: 0,\n\t\t\t\t\tx2: $( image ).width(),\n\t\t\t\t\ty2: $( image ).height(),\n\t\t\t\t\tonSelectEnd: function( img, selection ) {\n\n\t\t\t\t\t\tvar rate = image[0].naturalWidth / image.width();\n\t\t\t\t\t\tvar sx = selection.x1 * rate;\n\t\t\t\t\t\tvar sy = selection.y1 * rate;\n\t\t\t\t\t\tvar tx = selection.x2 * rate;\n\t\t\t\t\t\tvar ty = selection.y2 * rate - 1;\n\t\t\t\t\t\tvar width = selection.width * rate;\n\t\t\t\t\t\tvar height = selection.height * rate;\n\n\t\t\t\t\t\tvar canvas = $( '<canvas></canvas>' );\n\t\t\t\t\t\tcanvas = canvas[0];\n\t\t\t\t\t\tcanvas.width = width;\n\t\t\t\t\t\tcanvas.height = height;\n\t\t\t\t\t\tvar ctx = canvas.getContext( '2d' );\n\n\t\t\t\t\t\tctx.drawImage( image[0], sx, sy, width - 1, height - 1, 0, 0, width, height );\n\t\t\t\t\t\tsetAfterImage( '' );\n\t\t\t\t\t\tsetAfterImage( canvas.toDataURL() );\n\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}, 100 );\n\n\t\t};\n\n\t\tthis.getAfterImageSrc = function() {\n\t\t\tvar image = $this.children().eq( 1 ).children().eq( 1 );\n\n\t\t\treturn image.attr( 'src' );\n\t\t};\n\n\t\tthis.clearSelect = function() {\n\t\t\tvar image = $this.children().eq( 0 ).children().eq( 1 );\n\n\t\t\t$( image ).imgAreaSelect( { remove: true } );\n\n\t\t};\n\n\t\tvar onImageLoad = function( image ) {\n\n//\t\t\tif ( $( image ).height() > default_height ) {\n//\t\t\t\t$( image ).css( 'height', default_height );\n//\n//\t\t\t}\n//\n//\t\t\tif ( $( image ).width() > default_width ) {\n//\t\t\t\t$( image ).css( 'width', default_width );\n//\n//\t\t\t\t$( image ).css( 'height', 'auto' );\n//\t\t\t}\n\n//\t\t\t$( image ).show();\n\n\t\t};\n\n\t\tvar onAfterImageLoad = function( image ) {\n\n//\t\t\tif ( $( image ).height() > default_after_height ) {\n//\t\t\t\t$( image ).css( 'height', default_after_height );\n//\n//\t\t\t}\n//\n//\t\t\tif ( $( image ).width() > default_after_width ) {\n//\t\t\t\t$( image ).css( 'width', default_after_width );\n//\n//\t\t\t\t$( image ).css( 'height', 'auto' );\n//\t\t\t}\n\n//\t\t\t$( image ).show();\n\n\t\t};\n\n\t\tthis.setValue = function( val ) {\n\n\t\t\tif ( !val ) {\n\t\t\t\tval = '';\n\t\t\t}\n\n\t\t};\n\n\t\tfor ( var i = 0; i < this.length; i++ ) {\n\t\t\tvar $item = this[i];\n\n\t\t\tvar o = $.meta ? $.extend( {}, opts, $( $item ).data() ) : opts;\n\n\t\t\tfield = o.field;\n\n\t\t\tif ( o.default_width > 0 ) {\n\t\t\t\tdefault_width = o.default_width;\n\t\t\t}\n\n\t\t\tif ( o.default_height > 0 ) {\n\t\t\t\tdefault_height = o.default_height;\n\t\t\t}\n\n\t\t\tif ( Global.isSet( o.name ) ) {\n\t\t\t\tname = o.name;\n\t\t\t}\n\n\t\t\tvar image = $( $item ).children().eq( 0 ).children().eq( 1 );\n\t\t\timage.on( 'load', function() {\n\t\t\t\tonImageLoad( this );\n\n\t\t\t} );\n\n\t\t\tvar after_image = $( $item ).children().eq( 1 ).children().eq( 1 );\n\t\t\tafter_image.on( 'load', function() {\n\t\t\t\tonAfterImageLoad( this );\n\n\t\t\t} );\n\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\t$.fn.TImageCutArea.defaults = {};\n\t$.fn.TImageCutArea.html_template = `\n\t<div class=\"t-image-cut\">\n\t\t<div class=\"before-div\">\n\t\t\t<span>Before:</span>\n\t\t\t<img class=\"before-img\">\n\t\t</div>\n\t\t<div class=\"after-div\">\n\t\t\t<span>After:</span>\n\t\t\t<img class=\"after-img\">\n\t\t</div>\n\t</div>\n\t`;\n\n} )( jQuery );"],"names":["$","options","opts","$this","field","setAfterImage","val","image","img","selection","rate","sx","sy","width","height","canvas","ctx","i","$item","o","after_image","jQuery"],"mappings":"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"}