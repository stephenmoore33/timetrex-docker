{"version":3,"file":"DocumentViewController-DckK37q9.bundle.js","sources":["../../views/document/DocumentViewController.js"],"sourcesContent":["import '@/global/widgets/filebrowser/TImage';\nimport '@/global/widgets/filebrowser/TImageBrowser';\n\nexport class DocumentViewController extends BaseViewController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tel: '#document_view_container',\n\n\t\t\t// _required_files: ['TImageBrowser', 'TImage'],\n\n\t\t\tstatus_array: null,\n\t\t\tdocument_group_array: null,\n\n\t\t\tdocument_group_api: null,\n\t\t\tdocument_revision_api: null,\n\t\t\tdocument_attach_api: null,\n\t\t\tsub_document_revision_view_controller: null,\n\t\t\tsub_revision_view_controller: null,\n\n\t\t\tdocument_object_type_id: null,\n\n\t\t\tmulti_file_upload_current_count: 0,\n\t\t\tmulti_file_upload_total_count: 0,\n\t\t\tmulti_file_upload_message_id: null,\n\t\t\tmulti_file_upload_ids: [],\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinit( options ) {\n\t\t//this._super('initialize', options );\n\t\tthis.edit_view_tpl = 'DocumentEditView.html';\n\t\tthis.permission_id = 'document';\n\t\tthis.viewId = 'Document';\n\t\tthis.script_name = 'DocumentView';\n\t\tthis.table_name_key = 'document';\n\t\tthis.context_menu_name = $.i18n._( 'Documents' );\n\t\tthis.navigation_label = $.i18n._( 'Document' );\n\t\tthis.api = TTAPI.APIDocument;\n\t\tthis.document_group_api = TTAPI.APIDocumentGroup;\n\t\tthis.document_revision_api = TTAPI.APIDocumentRevision;\n\t\tthis.document_attach_api = TTAPI.APIDocumentAttachment;\n\n\t\tthis.render();\n\n\t\tif ( this.sub_view_mode ) {\n\t\t\tthis.buildContextMenu( true );\n\t\t} else {\n\t\t\tthis.buildContextMenu();\n\t\t}\n\n\t\t//call init data in parent view\n\t\tif ( !this.sub_view_mode ) {\n\t\t\tthis.initData();\n\t\t}\n\n\t\t//User does not have permission to add documents, so don't show the drag and drop tip and do not initialize the drag and drop functionality.\n\t\tif ( PermissionManager.validate( 'document', 'add' ) === true ) {\n\t\t\t//List view drag and drop\n\t\t\tGlobal.initFileDragAndDrop( document.querySelector( this.el ).parentNode, ( files ) => {\n\t\t\t\tthis.attachDragAndDropFile( files );\n\t\t\t} );\n\n\t\t\tthis.showDragAndDropTip();\n\t\t}\n\t}\n\n\tgetCustomContextMenuModel() {\n\t\tvar context_menu_model = {\n\t\t\texclude: ['copy'],\n\t\t\tinclude: [\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Download' ),\n\t\t\t\t\tid: 'download',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\taction_group: 'download',\n\t\t\t\t\tsort_order: 100\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'View' ),\n\t\t\t\t\tid: 'view_file',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\taction_group: 'download',\n\t\t\t\t\tsort_order: 200\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\treturn context_menu_model;\n\t}\n\n\tsetCustomDefaultMenuIcon( id, context_btn, grid_selected_length ) {\n\t\tswitch ( id ) {\n\t\t\tcase 'download':\n\t\t\tcase 'view_file':\n\t\t\t\tthis.setDefaultMenuDownIcon( context_btn, grid_selected_length );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tsetDefaultMenuDownIcon( context_btn, grid_selected_length, pId ) {\n\n\t\tif ( grid_selected_length === 1 ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t} else {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tinitOptions() {\n\t\tvar $this = this;\n\t\tthis.initDropDownOption( 'status' );\n\n\t\tthis.document_group_api.getDocumentGroup( '', false, false, {\n\t\t\tonResult: function( res ) {\n\n\t\t\t\tres = res.getResult();\n\t\t\t\tres = Global.buildTreeRecord( res );\n\n\t\t\t\tif ( !$this.sub_view_mode ) {\n\t\t\t\t\tif ( !$this.sub_view_mode && $this.basic_search_field_ui_dic['group_id'] ) {\n\t\t\t\t\t\t$this.basic_search_field_ui_dic['group_id'].setSourceData( res );\n\t\t\t\t\t\t$this.adv_search_field_ui_dic['group_id'].setSourceData( res );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t$this.document_group_array = res;\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tgetSubViewFilter( filter ) {\n\n\t\tif ( filter.length === 0 ) {\n\t\t\tfilter = {};\n\t\t}\n\n\t\tif ( this.sub_view_mode && Global.isSet( this.document_object_type_id ) ) {\n\t\t\tfilter['object_type_id'] = this.document_object_type_id;\n\t\t}\n\n\t\treturn filter;\n\t}\n\n\tbuildSearchFields() {\n\n\t\tsuper.buildSearchFields();\n\t\tthis.search_fields = [\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Status' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'status_id',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tlayout_name: 'global_option_column',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Name' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'name',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.TEXT_INPUT\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Description' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'description',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.TEXT_INPUT\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'File Name' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'remote_file_name',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.TEXT_INPUT\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Tags' ),\n\t\t\t\tfield: 'tag',\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tin_column: 1,\n\t\t\t\tobject_type_id: 700,\n\t\t\t\tform_item_type: FormItemType.TAG_INPUT\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Group' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tmultiple: true,\n\t\t\t\tfield: 'group_id',\n\t\t\t\tlayout_name: 'global_tree_column',\n\t\t\t\ttree_mode: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Template' ),\n\t\t\t\tfield: 'template',\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tin_column: 2,\n\t\t\t\tform_item_type: FormItemType.CHECKBOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Private' ),\n\t\t\t\tfield: 'private',\n\t\t\t\tbasic_search: ( PermissionManager.validate( 'document', 'view' ) && PermissionManager.validate( 'document', 'view_private' ) ) ? true : false,\n\t\t\t\tadv_search: ( PermissionManager.validate( 'document', 'view' ) && PermissionManager.validate( 'document', 'view_private' ) ) ? true : false,\n\t\t\t\tin_column: 2,\n\t\t\t\tform_item_type: FormItemType.CHECKBOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Attachments' ),\n\t\t\t\tfield: 'is_attachment',\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: ( PermissionManager.validate( 'document', 'view' ) && PermissionManager.validate( 'document', 'view_private' ) && PermissionManager.validate( 'document', 'edit' ) && PermissionManager.validate( 'user', 'edit' ) ) ? true : false, //Require additional permissions other than just document ones to show document attachments.\n\t\t\t\tin_column: 2,\n\t\t\t\tform_item_type: FormItemType.CHECKBOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Created By' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'created_by',\n\t\t\t\tlayout_name: 'global_user',\n\t\t\t\tapi_class: TTAPI.APIUser,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Updated By' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'updated_by',\n\t\t\t\tlayout_name: 'global_user',\n\t\t\t\tapi_class: TTAPI.APIUser,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} )\n\t\t];\n\t}\n\n\tbuildEditViewUI() {\n\n\t\tsuper.buildEditViewUI();\n\n\t\tvar $this = this;\n\n\t\tvar tab_model = {\n\t\t\t'tab_document': { 'label': $.i18n._( 'Document' ) },\n\t\t\t'tab_revision': {\n\t\t\t\t'label': $.i18n._( 'Revision' ),\n\t\t\t\t'init_callback': 'initSubDocumentRevisionView',\n\t\t\t\t'display_on_mass_edit': false\n\t\t\t},\n\t\t\t'tab_audit': true,\n\t\t};\n\t\tthis.setTabModel( tab_model );\n\n\t\tthis.navigation.AComboBox( {\n\t\t\tapi_class: TTAPI.APIDocument,\n\t\t\tid: this.script_name + '_navigation',\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_document',\n\t\t\tnavigation_mode: true,\n\t\t\tshow_search_inputs: true\n\t\t} );\n\n\t\tthis.setNavigation();\n\n\t\t//Tab 0 start\n\n\t\tvar tab_document = this.edit_view_tab.find( '#tab_document' );\n\n\t\tvar tab_document_column1 = tab_document.find( '.first-column' );\n\n\t\tthis.edit_view_tabs[0] = [];\n\n\t\tthis.edit_view_tabs[0].push( tab_document_column1 );\n\n\t\t// Status\n\t\tvar form_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\n\t\tform_item_input.TComboBox( { field: 'status_id' } );\n\t\tform_item_input.setSourceData( $this.status_array );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Status' ), form_item_input, tab_document_column1, '' );\n\n\t\t// Name\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\n\t\tform_item_input.TTextInput( { field: 'name', width: '100%' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Name' ), form_item_input, tab_document_column1 );\n\n\t\tform_item_input.parent().width( '45%' );\n\n\t\t// Revision\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\n\t\tform_item_input.TTextInput( { field: 'revision', width: 114 } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Revision' ), form_item_input, tab_document_column1, '', null, true );\n\n\t\t// File\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.FILE_BROWSER );\n\n\t\tthis.file_browser = form_item_input.TImageBrowser( { field: 'file', name: 'file_data', accept_filter: '*' } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'File' ), form_item_input, tab_document_column1, '', null, true, true );\n\n\t\t// Group\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\ttree_mode: true,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_tree_column',\n\t\t\tfield: 'group_id',\n\t\t\tset_empty: true\n\t\t} );\n\t\tform_item_input.setSourceData( $this.document_group_array );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Group' ), form_item_input, tab_document_column1 );\n\n\t\t// Template\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.CHECKBOX );\n\t\tform_item_input.TCheckbox( { field: 'template' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Template' ), form_item_input, tab_document_column1 );\n\n\t\t// Private\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.CHECKBOX );\n\t\tform_item_input.TCheckbox( { field: 'private' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Private' ), form_item_input, tab_document_column1 );\n\n\t\t// Description\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_AREA );\n\t\tform_item_input.TTextArea( { field: 'description' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Description' ), form_item_input, tab_document_column1, '', null, false, true );\n\n\t\t//Tags\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TAG_INPUT );\n\n\t\tform_item_input.TTagInput( { field: 'tag', object_type_id: 700 } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Tags' ), form_item_input, tab_document_column1, '', null, null, true );\n\t}\n\n\tisEditChange() {\n\n\t\tif ( this.current_edit_record.id ) {\n\t\t\tthis.detachElement( 'revision' );\n\t\t\tthis.detachElement( 'file' );\n\t\t} else if ( this.is_mass_editing ) {\n\t\t\tthis.detachElement( 'revision' );\n\t\t\tthis.detachElement( 'file' );\n\t\t} else {\n\t\t\tthis.attachElement( 'revision' );\n\t\t\tthis.attachElement( 'file' );\n\t\t}\n\n\t\tthis.editFieldResize();\n\t}\n\n\tsetEditViewDataDone() {\n\t\tsuper.setEditViewDataDone();\n\t\tthis.isEditChange();\n\n\t\t//Add view drag and drop\n\t\tif ( this.is_add && PermissionManager.validate( 'document', 'add' ) === true ) {\n\t\t\tGlobal.initFileDragAndDrop( this.edit_view[0].firstElementChild, ( files ) => {\n\t\t\t\tthis.attachDragAndDropFile( files );\n\t\t\t} );\n\t\t}\n\t}\n\n\tonCustomContextClick( id ) {\n\t\tswitch ( id ) {\n\t\t\tcase 'view_file':\n\t\t\t\tthis.onDownloadClick();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tdoFormIFrameCall() {\n\t\tvar url = ServiceCaller.getURLByObjectType( 'file_download' ) + '&object_type=document&parent_id=' + this.current_edit_record.id;\n\t\tif ( Global.isSet( this.document_object_type_id ) ) {\n\t\t\turl = url + '&parent_object_type_id=' + this.document_object_type_id;\n\t\t}\n\t\turl = url + '&object_id=' + this.current_edit_record.document_revision_id;\n\n\t\tGlobal.APIFileDownload( null, null, null, url );\n\t}\n\n\tonDownloadClick() {\n\n\t\tvar $this = this;\n\t\tvar url;\n\t\tif ( this.edit_view && this.current_edit_record.id ) {\n\t\t\tthis.doFormIFrameCall();\n\n\t\t} else {\n\t\t\tvar filter = {};\n\t\t\tvar selectedId;\n\t\t\tvar grid_selected_id_array = this.getGridSelectIdArray();\n\t\t\tvar grid_selected_length = grid_selected_id_array.length;\n\t\t\tif ( grid_selected_length > 0 ) {\n\t\t\t\tselectedId = grid_selected_id_array[0];\n\t\t\t}\n\t\t\tfilter.filter_data = {};\n\t\t\tfilter.filter_data.id = [selectedId];\n\t\t\tfilter.filter_data.object_type_id = this.document_object_type_id;\n\n\t\t\tvar result = this.api['get' + this.api.key_name]( filter, { async: false } );\n\n\t\t\tvar result_data = result.getResult();\n\n\t\t\tif ( !result_data ) {\n\t\t\t\tresult_data = [];\n\t\t\t}\n\n\t\t\tresult_data = result_data[0];\n\n\t\t\t$this.current_edit_record = result_data;\n\n\t\t\t$this.doFormIFrameCall();\n\n\t\t}\n\t}\n\n\tgetAPIFilters() {\n\t\tvar filter = super.getAPIFilters();\n\t\tfilter.filter_data.object_type_id = this.document_object_type_id; // Note: On My Account->Documents data.object_type_id is NULL, but this is definately used in other areas, like Edit Employee->Attachments.\n\n\t\treturn filter;\n\t}\n\n\tonAddResult( result ) {\n\t\tvar $this = this;\n\t\tvar result_data = result.getResult();\n\n\t\tif ( !result_data ) {\n\t\t\tresult_data = [];\n\t\t}\n\n\t\tresult_data.company = LocalCacheData.current_company.name;\n\t\tresult_data.revision = '1.0';\n\n\t\tif ( $this.sub_view_mode && $this.parent_key ) {\n\t\t\tresult_data[$this.parent_key] = $this.parent_value;\n\t\t}\n\n\t\t$this.current_edit_record = result_data;\n\t\t$this.initEditView();\n\t}\n\n\tonCustomContextClick( id ) {\n\t\tswitch ( id ) {\n\t\t\tcase 'download':\n\t\t\tcase 'view_file':\n\t\t\t\tthis.onDownloadClick();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\thandleUploadSuperCall( super_fun_name, document_result ) {\n\t\tif ( super_fun_name === 'onMultipleUploadResult' ) {\n\t\t\tthis.onMultipleUploadResult( document_result.getResult() );\n\t\t} else {\n\t\t\tsuper[super_fun_name]( document_result );\n\t\t}\n\t}\n\n\tsetAttachmentBinding( document_result, super_fun_name ) {\n\t\tvar $this = this;\n\t\tvar document_id = document_result.getResult();\n\n\t\t/* jshint ignore:start */\n\t\tif ( TTUUID.isUUID( document_id ) == false ) {\n\t\t\tthis.handleUploadSuperCall( super_fun_name, document_result );\n\t\t\treturn;\n\t\t}\n\t\t/* jshint ignore:end */\n\n\t\tif ( $this.sub_view_mode ) {\n\t\t\tvar args = {};\n\t\t\targs.object_type_id = $this.document_object_type_id;\n\t\t\targs.object_id = $this.parent_value;\n\t\t\targs.document_id = document_id;\n\t\t\t$this.document_attach_api.setDocumentAttachment( args, {\n\t\t\t\tonResult: () => {\n\t\t\t\t\tthis.handleUploadSuperCall( super_fun_name, document_result );\n\t\t\t\t}\n\t\t\t} );\n\t\t} else {\n\t\t\tthis.handleUploadSuperCall( super_fun_name, document_result );\n\t\t}\n\t}\n\n\thandleSaveResult( document_result, super_fun_name, file_to_upload ) {\n\t\tvar document_id = document_result.getResult();\n\t\tvar $this = this;\n\n\t\tvar file_data;\n\n\t\tif ( file_to_upload ) {\n\t\t\tfile_data = file_to_upload;\n\t\t} else if ( !$this.current_edit_record.id && !this.is_mass_editing ) {\n\t\t\tfile_data = $this.file_browser.getValue();\n\t\t} else {\n\t\t\tfile_data = null;\n\t\t}\n\n\t\t//Save a document revision data if has upload file, otherwise don't\n\t\tif ( document_result && document_result.isValid() == true && file_data ) {\n\t\t\tvar document_revision_record = {};\n\t\t\tdocument_revision_record['document_id'] = document_id;\n\t\t\tif ( file_to_upload ) {\n\t\t\t\tdocument_revision_record['revision'] = '1.0';\n\t\t\t} else {\n\t\t\t\tdocument_revision_record['revision'] = this.current_edit_record.revision;\n\t\t\t}\n\n\t\t\t$this.document_revision_api['set' + $this.document_revision_api.key_name]( document_revision_record,\n\t\t\t\t{\n\t\t\t\t\tonResult: function( document_revision_result ) {\n\t\t\t\t\t\tif ( document_revision_result && document_revision_result.isValid() ) {\n\t\t\t\t\t\t\tvar url = 'object_type=document_revision&object_id=' + document_revision_result.getResult();\n\t\t\t\t\t\t\tif ( Global.isSet( $this.document_object_type_id ) ) {\n\t\t\t\t\t\t\t\turl = url + '&parent_object_type_id=' + $this.document_object_type_id;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t$this.api.uploadFile( file_data, url, {\n\t\t\t\t\t\t\t\tonResult: function( upload_file_result ) {\n\t\t\t\t\t\t\t\t\t$this.setAttachmentBinding( document_result, super_fun_name );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$this.api['delete' + $this.api.key_name]( [document_id], {\n\t\t\t\t\t\t\t\tonResult: function() {\n\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\tTAlertManager.showErrorAlert( document_revision_result );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t} else {\n\t\t\t$this.setAttachmentBinding( document_result, super_fun_name );\n\t\t}\n\t}\n\n\t// Dev note: this is not the ideal refactor, as would like to remove the use of 'super_fun_name'\n\t// but its the best quickest most reliable way to refactor this for now.\n\tonSaveResult( result ) {\n\t\treturn this.handleSaveResult( result, 'onSaveResult' );\n\t}\n\n\tonSaveAndContinueResult( result ) {\n\t\treturn this.handleSaveResult( result, 'onSaveAndContinueResult' );\n\t}\n\n\tonSaveAndNewResult( result ) {\n\t\treturn this.handleSaveResult( result, 'onSaveAndNewResult' );\n\t}\n\n\tonSaveAndCopyResult( result ) {\n\t\treturn this.handleSaveResult( result, 'onSaveAndCopyResult' );\n\t}\n\n\tsetCustomEditMenuIcon( id, context_btn ) {\n\t\tswitch ( id ) {\n\t\t\tcase 'download':\n\t\t\tcase 'view_file':\n\t\t\t\tthis.setEditMenuDownloadIcon( context_btn );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tsetEditMenuDownloadIcon( context_btn, pId ) {\n\t\tif ( !this.current_edit_record || !this.current_edit_record.id ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tgetGridSetup() {\n\t\tvar $this = this;\n\t\tvar retval = {\n\t\t\tcontainer_selector: this.sub_view_mode ? '.edit-view-tab-bar' : '.view',\n\t\t\tsub_grid_mode: false,\n\t\t\tonGridResize: true,\n\t\t\tonSelectRow: function() {\n\t\t\t\t$this.onGridSelectRow();\n\t\t\t},\n\t\t\tonCellSelect: function() {\n\t\t\t\t$this.onGridSelectRow();\n\t\t\t},\n\t\t\tonSelectAll: function() {\n\t\t\t\t$this.onGridSelectAll();\n\t\t\t},\n\t\t\tondblClickRow: function( e ) {\n\t\t\t\t$this.onGridDblClickRow( e );\n\t\t\t},\n\t\t\tonRightClickRow: function( rowId ) {\n\t\t\t\tvar id_array = $this.getGridSelectIdArray();\n\t\t\t\tif ( id_array.indexOf( rowId ) < 0 ) {\n\t\t\t\t\t$this.grid.grid.resetSelection();\n\t\t\t\t\t$this.grid.grid.setSelection( rowId );\n\t\t\t\t\t$this.onGridSelectRow();\n\t\t\t\t}\n\t\t\t},\n\t\t\theight: 200\n\t\t};\n\n\t\tif ( this.sub_view_mode ) {\n\t\t\tretval.setGridSize = function() {\n\t\t\t\t$this.baseViewSubTabGridResize( 'tab_attachment' );\n\t\t\t};\n\t\t}\n\n\t\treturn retval;\n\t}\n\n\tremoveEditView() {\n\t\tsuper.removeEditView();\n\n\t\tthis.sub_revision_view_controller = null;\n\t}\n\n\tinitSubDocumentRevisionView() {\n\t\tvar $this = this;\n\n\t\tif ( !this.current_edit_record.id ) {\n\t\t\tTTPromise.resolve( 'BaseViewController', 'onTabShow' ); //Since search() isn't called in this case, and we just display the \"Please Save This Record ...\" message, resolve the promise.\n\t\t\treturn;\n\t\t}\n\n\t\tif ( this.sub_revision_view_controller ) {\n\t\t\tthis.sub_revision_view_controller.buildContextMenu( true );\n\t\t\tthis.sub_revision_view_controller.setDefaultMenu();\n\t\t\t$this.sub_revision_view_controller.parent_key = 'document_id';\n\t\t\t$this.sub_revision_view_controller.parent_value = $this.current_edit_record.id;\n\t\t\t$this.sub_revision_view_controller.parent_edit_record = $this.current_edit_record;\n\t\t\t$this.sub_revision_view_controller.parent_view_controller = $this;\n\t\t\t$this.sub_revision_view_controller.initData();\n\t\t\treturn;\n\t\t}\n\n\t\tGlobal.loadScript( 'views/document/DocumentRevisionViewController.js', function() {\n\t\t\tvar tab_revision = $this.edit_view_tab.find( '#tab_revision' );\n\t\t\tvar firstColumn = tab_revision.find( '.first-column-sub-view' );\n\n\t\t\tGlobal.trackView( 'Sub' + 'DocumentRevision' + 'View' );\n\t\t\tTTPromise.wait( 'BaseViewController', 'initialize', function() {\n\t\t\t\tDocumentRevisionViewController.loadSubView( firstColumn, beforeLoadView, afterLoadView );\n\t\t\t} );\n\n\t\t} );\n\n\t\tfunction beforeLoadView() {\n\n\t\t}\n\n\t\tfunction afterLoadView( subViewController ) {\n\t\t\t$this.sub_revision_view_controller = subViewController;\n\t\t\t$this.sub_revision_view_controller.parent_key = 'document_id';\n\t\t\t$this.sub_revision_view_controller.parent_value = $this.current_edit_record.id;\n\t\t\t$this.sub_revision_view_controller.parent_edit_record = $this.current_edit_record;\n\t\t\t$this.sub_revision_view_controller.parent_view_controller = $this;\n\t\t\t$this.sub_revision_view_controller.initData();\n\t\t}\n\t}\n\n\tsearchDone() {\n\t\tTTPromise.resolve( 'initSubDocumentView', 'init' );\n\t\tsuper.searchDone();\n\t}\n\n\tattachDragAndDropFile( files ) {\n\t\tif ( this.is_edit == false && this.is_add == false && this.is_viewing == false ) {\n\t\t\t//List view multiple files were dropped, upload all of them behind the scenes.\n\t\t\tif ( files.length > 1 ) {\n\t\t\t\tthis.multipleFileUpload( files );\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t//Single file was dropped onto list view, open the edit view and attach the file.\n\t\t\tthis.onAddClick();\n\t\t}\n\n\t\t//Only add the first file as each document is a single file.\n\t\tlet data_transfer = new DataTransfer()\n\t\tdata_transfer.items.add( files[0] );\n\n\t\tlet file_input = this.edit_view_ui_dic.file[0].querySelector('input');\n\t\tfile_input.files = data_transfer.files;\n\n\t\t//Trigger the change event so the file name is displayed.\n\t\t$( file_input ).trigger( 'change' );\n\n\t\t//The document_name is the file name before the '.' otherwise if there is no '.' use the full name of the uploaded file.\n\t\t//  Replace underscores with spaces.\n\t\tlet document_name = ( ( files[0].name.includes( '.' ) ) ? files[0].name.split( '.' )[0] : files[0].name ).replaceAll( '_', ' ' );\n\t\tdocument_name = Global.ucwords( document_name ); //Make each word start with uppercase.\n\n\t\tTTPromise.wait( 'init', 'init', () => {\n\t\t\t//Need to wait for the edit view to be built before setting the document_name otherwise the field will be blank.\n\t\t\tif ( this.current_edit_record.name === false || this.current_edit_record.name.length === 0 ) {\n\t\t\t\tthis.edit_view_ui_dic.name.setValue( document_name );\n\t\t\t\tthis.current_edit_record.name = document_name;\n\t\t\t}\n\t\t} );\n\t}\n\n\tmultipleFileUpload( files ) {\n\t\tthis.multi_file_upload_current_count = 0;\n\t\tthis.multi_file_upload_total_count = files.length;\n\t\tthis.multi_file_upload_message_id = TTUUID.generateUUID();\n\t\tthis.multi_file_upload_ids = [];\n\n\t\tProgressBar.showProgressBar( this.multi_file_upload_message_id );\n\t\tProgressBar.changeProgressBarMessage( this.multi_file_upload_message_id, $.i18n._( 'Uploading files ' + this.multi_file_upload_current_count + ' / ' + this.multi_file_upload_total_count + ' completed...' ) );\n\n\t\tfor ( let file of files ) {\n\n\t\t\tlet filename = file.name.includes( '.' ) ? file.name.split( '.' )[0] : file.name;\n\n\t\t\tlet file_data = {\n\t\t\t\tcompany_id: LocalCacheData.getCurrentCompany().id,\n\t\t\t\tstatus_id: 10,\n\t\t\t\tprivate: true,\n\t\t\t\trevision: '1.0',\n\t\t\t\tname: filename,\n\t\t\t};\n\n\t\t\tthis.api.setDocument( file_data, {\n\t\t\t\tonResult: ( result ) => {\n\t\t\t\t\tlet formData = new FormData();\n\t\t\t\t\tformData.append( 'file_data', file );\n\n\t\t\t\t\tthis.handleSaveResult( result, 'onMultipleUploadResult', formData );\n\n\t\t\t\t\tProgressBar.changeProgressBarMessage( this.multi_file_upload_message_id, $.i18n._( 'Uploading files ' + this.multi_file_upload_current_count + ' / ' + this.multi_file_upload_total_count + ' completed...' ) );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t}\n\n\tonMultipleUploadResult( document_id ) {\n\t\tthis.multi_file_upload_current_count++;\n\t\tthis.multi_file_upload_ids.push( document_id );\n\n\t\tif ( this.multi_file_upload_current_count === this.multi_file_upload_total_count ) {\n\t\t\tProgressBar.removeProgressBar( this.multi_file_upload_message_id );\n\t\t\tthis.search();\n\n\t\t\tTAlertManager.showAlert( $.i18n._( this.multi_file_upload_total_count + ' file(s) uploaded successfully' ), $.i18n._( 'Upload Complete' ), () => {\n\t\t\t\tthis.highLightGridRowById( this.multi_file_upload_ids );\n\t\t\t} );\n\t\t} else {\n\t\t\tProgressBar.changeProgressBarMessage( $.i18n._( 'Uploading files ' + this.multi_file_upload_current_count + ' / ' + this.multi_file_upload_total_count + ' completed...' ) );\n\t\t}\n\t}\n\n\tshowDragAndDropTip() {\n\t\tlet tip = document.createElement( 'div' );\n\t\ttip.className = 'alert alert-info drag-and-drop-tip';\n\t\ttip.textContent = $.i18n._( 'Drag and drop file(s) here to upload.' );\n\t\tdocument.querySelector( this.el + ' .grid-div' ).before( tip );\n\t}\n}\n\nDocumentViewController.loadSubView = function( container, beforeViewLoadedFun, afterViewLoadedFun ) {\n\n\tGlobal.loadViewSource( 'Document', 'SubDocumentView.html', function( result ) {\n\t\tvar args = {};\n\t\tvar template = _.template( result );\n\n\t\tif ( Global.isSet( beforeViewLoadedFun ) ) {\n\t\t\tbeforeViewLoadedFun();\n\t\t}\n\n\t\tif ( Global.isSet( container ) ) {\n\t\t\tcontainer.html( template( args ) ); //This populates the grid outer div below 'first-column-sub-view'\n\t\t\tif ( Global.isSet( afterViewLoadedFun ) ) {\n\t\t\t\tTTPromise.wait( 'BaseViewController', 'initialize', function() {\n\t\t\t\t\tafterViewLoadedFun( sub_document_view_controller );\n\t\t\t\t} );\n\t\t\t}\n\t\t}\n\t} );\n};"],"names":["DocumentViewController","options","_","$","files","context_menu_model","id","context_btn","grid_selected_length","pId","$this","res","filter","tab_model","tab_document","tab_document_column1","form_item_input","url","selectedId","grid_selected_id_array","result","result_data","super_fun_name","document_result","document_id","args","file_to_upload","file_data","document_revision_record","document_revision_result","upload_file_result","retval","e","rowId","id_array","tab_revision","firstColumn","beforeLoadView","afterLoadView","subViewController","data_transfer","file_input","document_name","file","filename","formData","tip","container","beforeViewLoadedFun","afterViewLoadedFun","template"],"mappings":"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"}