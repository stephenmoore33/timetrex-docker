{"version":3,"mappings":"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","names":["PunchesViewController","options","_","$","p_id","$this","res","arg","result","widget","records","tab_model","form_item_input","widgetContainer","tab_punch","tab_punch_column1","default_args","check_box","label","target","source_data","val","job_coder","job_item_coder","punch_tags","get_real_data","punch_tag_coder","good","good_label","bad","bad_label","latitude","longitude","accuracy","map_icon","isChecked","getEnabled","event","display_columns","first_item","second_item","index","content","did_clean_dic","key","column","tab_id","initial_load","is_transfer","type_id_widget","status_id_widget","record","mass_edit_record_ids","changed_fields","mass_records","value","common_record","current_edit_record","dates_array","i","user_id","j","final_record","date","dates","resultArray","beginDate","endDate","nextDate","date_array","args","punch_tag_widget","actual_time_value","location_data","filter","field","input_div","result_data","context_menu_model","data","punches","map_options","ids","__vitePreload","module","processed_punches_for_map","id","context_btn","grid_selected_length","iconName","temp_filter","grid_selected_id_array","selectedId","pId","navigation_div","ignoreWarning","result1","doNotValidate","c_value","dataset","successCallback","moved_unsaved_markers","full_item","user","column_filter","enable_system_columns"],"ignoreList":[],"sources":["../../views/attendance/punches/PunchesViewController.js"],"sourcesContent":["import '@/global/widgets/filebrowser/TImage';\n\nexport class PunchesViewController extends BaseViewController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tel: '#punches_view_container',\n\n\t\t\t// _required_files: {\n\t\t\t// \t10: ['TImage'],\n\t\t\t// \t15: ['leaflet-timetrex']\n\t\t\t// },\n\t\t\t// TODO: breakdown leaflet-timetrex so only the convert functions are needed in ViewControllers.\n\n\t\t\told_type_status: {},\n\n\t\t\tuser_api: null,\n\t\t\tuser_group_api: null,\n\t\t\tapi_station: null,\n\t\t\ttype_array: null,\n\n\t\t\tpunch_tag_api: null,\n\t\t\tdefault_punch_tag: [],\n\t\t\tprevious_punch_tag_selection: [],\n\n\t\t\tactual_time_label: null,\n\n\t\t\tlocation_mass_edit_check_box: null,\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinit( options ) {\n\t\t//this._super('initialize', options );\n\t\tthis.edit_view_tpl = 'PunchesEditView.html';\n\t\tthis.permission_id = 'punch';\n\t\tthis.viewId = 'Punches';\n\t\tthis.script_name = 'PunchesView';\n\t\tthis.table_name_key = 'punch';\n\t\tthis.context_menu_name = $.i18n._( 'Punches' );\n\t\tthis.navigation_label = $.i18n._( 'Punch' );\n\t\tthis.api = TTAPI.APIPunch;\n\t\tthis.user_api = TTAPI.APIUser;\n\t\tthis.user_group_api = TTAPI.APIUserGroup;\n\n\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\tthis.job_api = TTAPI.APIJob;\n\t\t\tthis.job_item_api = TTAPI.APIJobItem;\n\t\t\tthis.punch_tag_api = TTAPI.APIPunchTag;\n\t\t}\n\n\t\tthis.api_station = TTAPI.APIStation;\n\n\t\tthis.initPermission();\n\t\tthis.render();\n\n\t\tthis.buildContextMenu();\n\t\tthis.initData();\n\t}\n\n\tjobUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'punch';\n\t\t}\n\n\t\tif ( PermissionManager.validate( 'job', 'enabled' ) &&\n\t\t\tPermissionManager.validate( p_id, 'edit_job' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tjobItemUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'punch';\n\t\t}\n\n\t\tif ( PermissionManager.validate( 'job_item', 'enabled' ) &&\n\t\t\tPermissionManager.validate( p_id, 'edit_job_item' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tpunchTagUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'punch';\n\t\t}\n\n\t\tif ( PermissionManager.validate( 'punch_tag', 'enabled' ) &&\n\t\t\tPermissionManager.validate( p_id, 'edit_punch_tag' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tbranchUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'punch';\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'edit_branch' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tdepartmentUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'punch';\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'edit_department' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tgoodQuantityUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'punch';\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'edit_quantity' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tbadQuantityUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'punch';\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'edit_quantity' ) &&\n\t\t\tPermissionManager.validate( p_id, 'edit_bad_quantity' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\ttransferUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'punch';\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'edit_transfer' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tnoteUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'punch';\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'edit_note' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tlocationUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'punch';\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'edit_location' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tstationValidate() {\n\t\tif ( PermissionManager.validate( 'station', 'enabled' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t//Speical permission check for views, need override\n\tinitPermission() {\n\t\tsuper.initPermission();\n\n\t\tif ( this.jobUIValidate() ) {\n\t\t\tthis.show_job_ui = true;\n\t\t} else {\n\t\t\tthis.show_job_ui = false;\n\t\t}\n\n\t\tif ( this.jobItemUIValidate() ) {\n\t\t\tthis.show_job_item_ui = true;\n\t\t} else {\n\t\t\tthis.show_job_item_ui = false;\n\t\t}\n\n\t\tif ( this.punchTagUIValidate() ) {\n\t\t\tthis.show_punch_tag_ui = true;\n\t\t} else {\n\t\t\tthis.show_punch_tag_ui = false;\n\t\t}\n\n\t\tif ( this.branchUIValidate() ) {\n\t\t\tthis.show_branch_ui = true;\n\t\t} else {\n\t\t\tthis.show_branch_ui = false;\n\t\t}\n\n\t\tif ( this.departmentUIValidate() ) {\n\t\t\tthis.show_department_ui = true;\n\t\t} else {\n\t\t\tthis.show_department_ui = false;\n\t\t}\n\n\t\tif ( this.goodQuantityUIValidate() ) {\n\t\t\tthis.show_good_quantity_ui = true;\n\t\t} else {\n\t\t\tthis.show_good_quantity_ui = false;\n\t\t}\n\n\t\tif ( this.badQuantityUIValidate() ) {\n\t\t\tthis.show_bad_quantity_ui = true;\n\t\t} else {\n\t\t\tthis.show_bad_quantity_ui = false;\n\t\t}\n\n\t\tif ( this.transferUIValidate() ) {\n\t\t\tthis.show_transfer_ui = true;\n\t\t} else {\n\t\t\tthis.show_transfer_ui = false;\n\t\t}\n\n\t\tif ( this.noteUIValidate() ) {\n\t\t\tthis.show_note_ui = true;\n\t\t} else {\n\t\t\tthis.show_note_ui = false;\n\t\t}\n\n\t\tif ( this.locationUIValidate() ) {\n\t\t\tthis.show_location_ui = true;\n\t\t} else {\n\t\t\tthis.show_location_ui = false;\n\t\t}\n\n\t\tif ( this.stationValidate() ) {\n\t\t\tthis.show_station_ui = true;\n\t\t} else {\n\t\t\tthis.show_station_ui = false;\n\t\t}\n\t}\n\n\tinitOptions() {\n\t\tvar $this = this;\n\n\t\tthis.initDropDownOption( 'type' );\n\n\t\tthis.initDropDownOption( 'status', 'status_id', this.api, null, 'status_array' );\n\n\t\tthis.initDropDownOption( 'status', 'user_status_id', this.user_api, null, 'user_status_array' );\n\n\t\tthis.user_group_api.getUserGroup( '', false, false, {\n\t\t\tonResult: function( res ) {\n\t\t\t\tres = res.getResult();\n\n\t\t\t\tres = Global.buildTreeRecord( res );\n\t\t\t\t$this.user_group_array = res;\n\t\t\t\t$this.basic_search_field_ui_dic['group_id'].setSourceData( res );\n\t\t\t\t$this.adv_search_field_ui_dic['group_id'].setSourceData( res );\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tonEditStationDone() {\n\t\tthis.setStation();\n\t}\n\n\tsetStation() {\n\n\t\tvar $this = this;\n\t\tvar arg = { filter_data: { id: this.current_edit_record.station_id } };\n\n\t\tthis.api_station.getStation( arg, {\n\t\t\tonResult: function( result ) {\n\t\t\t\t$this.station = result.getResult()[0];\n\t\t\t\tvar widget = $this.edit_view_ui_dic['station_id'];\n\t\t\t\twidget.setValue( $this.station.type + '-' + $this.station.description );\n\t\t\t\twidget.css( 'cursor', 'pointer' );\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tuniformVariable( records ) {\n\t\tif ( this.is_mass_editing == false ) {\n\t\t\trecords = this.buildMassAddRecord( records );\n\t\t}\n\n\t\tif ( Array.isArray( records ) ) {\n\t\t\tfor ( let i = 0; i < records.length; i++ ) {\n\t\t\t\tif ( !records[i].hasOwnProperty( 'time_stamp' ) ) {\n\t\t\t\t\trecords[i].time_stamp = false;\n\t\t\t\t}\n\t\t\t}\n\t\t} else if ( !records.hasOwnProperty( 'time_stamp' ) ) {\n\t\t\trecords.time_stamp = false;\n\t\t}\n\n\t\treturn records;\n\t}\n\n\tgetCustomFieldReferenceField() {\n\t\treturn 'note';\n\t}\n\n\tbuildEditViewUI() {\n\n\t\tsuper.buildEditViewUI();\n\n\t\tvar $this = this;\n\n\t\tvar tab_model = {\n\t\t\t'tab_punch': { 'label': $.i18n._( 'Punch' ) },\n\t\t\t'tab_audit': true,\n\t\t};\n\t\tthis.setTabModel( tab_model );\n\n\t\tvar form_item_input;\n\t\tvar widgetContainer;\n\n\t\tthis.navigation.AComboBox( {\n\t\t\tapi_class: TTAPI.APIPunch,\n\t\t\tid: this.script_name + '_navigation',\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_punch',\n\t\t\tnavigation_mode: true,\n\t\t\tshow_search_inputs: true\n\t\t} );\n\n\t\tthis.setNavigation();\n\n\t\t//Tab 0 start\n\n\t\tvar tab_punch = this.edit_view_tab.find( '#tab_punch' );\n\n\t\tvar tab_punch_column1 = tab_punch.find( '.first-column' );\n\n\t\tthis.edit_view_tabs[0] = [];\n\n\t\tthis.edit_view_tabs[0].push( tab_punch_column1 );\n\n\t\t// Employee\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIUser,\n\t\t\tallow_multiple_selection: true,\n\t\t\tlayout_name: 'global_user',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'user_id'\n\t\t} );\n\n\t\tvar default_args = {};\n\t\tdefault_args.permission_section = 'punch';\n\t\tform_item_input.setDefaultArgs( default_args );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Employee' ), form_item_input, tab_punch_column1, '', null, true );\n\n\t\t// Time\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TIME_PICKER );\n\n\t\tform_item_input.TTimePicker( { field: 'punch_time', validation_field: 'time_stamp' } );\n\n\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\t\tthis.actual_time_label = $( '<span class=\\'widget-right-label\\'></span>' );\n\t\twidgetContainer.append( form_item_input );\n\t\twidgetContainer.append( this.actual_time_label );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Time' ), form_item_input, tab_punch_column1, '', widgetContainer );\n\n\t\t//Date\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\t\tform_item_input.TDatePicker( { field: 'punch_date', validation_field: 'date_stamp' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Date' ), form_item_input, tab_punch_column1, '', null, true );\n\n\t\t//Mass Add Date\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\t\tform_item_input.TRangePicker( { field: 'punch_dates', validation_field: 'date_stamp' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Date' ), form_item_input, tab_punch_column1, '', null, true );\n\n\t\t//Transfer\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.CHECKBOX );\n\t\tform_item_input.TCheckbox( { field: 'transfer' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Transfer' ), form_item_input, tab_punch_column1, '', null, true );\n\t\tif ( this.show_transfer_ui == false || this.is_add == false ) {\n\t\t\tthis.detachElement( 'transfer' );\n\t\t}\n\n\t\t// Punch\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\t\tform_item_input.TComboBox( { field: 'type_id' } );\n\t\tform_item_input.setSourceData( $this.type_array );\n\n\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\t\tvar check_box = Global.loadWidgetByName( FormItemType.CHECKBOX );\n\t\tcheck_box.TCheckbox( { field: 'disable_rounding' } );\n\t\tvar label = $( '<span class=\\'widget-right-label\\'>' + $.i18n._( 'Disable Rounding' ) + '</span>' );\n\t\twidgetContainer.append( form_item_input );\n\n\t\t// Check if view only mode. To prevent option appearing but disabled, as disabled checkboxes are not very clear - same in TimeSheetViewController\n\t\tif ( this.is_viewing || PermissionManager.validate( 'punch', 'edit_disable_rounding' ) == false ) {\n\t\t\t// dev-note: not sure if we need to pass widgetContainer here, or if we can omit if its only one element now (due to the if is_viewing).\n\t\t\t// to be safe, will continue to use widgetContainer for this case. We only want to affect viewing mode (hide rounding checkbox), less risk of regression to keep widget container in.\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Punch Type' ), form_item_input, tab_punch_column1, '', widgetContainer, true );\n\t\t} else {\n\t\t\twidgetContainer.append( label );\n\t\t\twidgetContainer.append( check_box );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Punch Type' ), [form_item_input, check_box], tab_punch_column1, '', widgetContainer, true );\n\t\t}\n\n\t\t// In/Out\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\t\tform_item_input.TComboBox( { field: 'status_id' } );\n\t\tform_item_input.setSourceData( $this.status_array );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'In/Out' ), form_item_input, tab_punch_column1 );\n\n\t\t// Branch\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIBranch,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_branch',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'branch_id',\n\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\treturn $this.onSourceDataCreate( target, source_data );\n\t\t\t} ),\n\t\t\tadded_items: [\n\t\t\t\t{ value: TTUUID.not_exist_id, label: Global.default_item },\n\t\t\t\t{ value: 'ffffffff-ffff-ffff-ffff-000000000002', label: $.i18n._( '-- Current Shift --' ) }\n\t\t\t]\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Branch' ), form_item_input, tab_punch_column1, '', null, true );\n\n\t\tif ( !this.show_branch_ui ) {\n\t\t\tthis.detachElement( 'branch_id' );\n\t\t}\n\n\t\t// Department\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIDepartment,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_department',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'department_id',\n\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\treturn $this.onSourceDataCreate( target, source_data );\n\t\t\t} ),\n\t\t\tadded_items: [\n\t\t\t\t{ value: TTUUID.not_exist_id, label: Global.default_item },\n\t\t\t\t{ value: 'ffffffff-ffff-ffff-ffff-000000000002', label: $.i18n._( '-- Current Shift --' ) }\n\t\t\t]\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Department' ), form_item_input, tab_punch_column1, '', null, true );\n\n\t\tif ( !this.show_department_ui ) {\n\t\t\tthis.detachElement( 'department_id' );\n\t\t}\n\n\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\n\t\t\t//Job\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIJob,\n\t\t\t\tallow_multiple_selection: false,\n\t\t\t\tlayout_name: 'global_job',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tsetRealValueCallBack: ( function( val ) {\n\t\t\t\t\tif ( val ) {\n\t\t\t\t\t\tjob_coder.setValue( val.manual_id );\n\t\t\t\t\t}\n\t\t\t\t} ),\n\t\t\t\tfield: 'job_id',\n\t\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\t\treturn $this.onSourceDataCreate( target, source_data );\n\t\t\t\t} ),\n\t\t\t\tadded_items: [\n\t\t\t\t\t{ value: TTUUID.not_exist_id, label: Global.default_item },\n\t\t\t\t\t{ value: 'ffffffff-ffff-ffff-ffff-000000000002', label: $.i18n._( '-- Current Shift --' ) }\n\t\t\t\t]\n\t\t\t} );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\tvar job_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tjob_coder.TTextInput( { field: 'job_quick_search', disable_keyup_event: true } );\n\t\t\tjob_coder.addClass( 'job-coder' );\n\n\t\t\twidgetContainer.append( job_coder );\n\t\t\twidgetContainer.append( form_item_input );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Job' ), [form_item_input, job_coder], tab_punch_column1, '', widgetContainer, true );\n\n\t\t\tif ( !this.show_job_ui ) {\n\t\t\t\tthis.detachElement( 'job_id' );\n\t\t\t}\n\n\t\t\t//Job Item\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIJobItem,\n\t\t\t\tallow_multiple_selection: false,\n\t\t\t\tlayout_name: 'global_job_item',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tsetRealValueCallBack: ( function( val ) {\n\t\t\t\t\tif ( val ) {\n\t\t\t\t\t\tjob_item_coder.setValue( val.manual_id );\n\t\t\t\t\t}\n\t\t\t\t} ),\n\t\t\t\tfield: 'job_item_id',\n\t\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\t\treturn $this.onSourceDataCreate( target, source_data );\n\t\t\t\t} ),\n\t\t\t\tadded_items: [\n\t\t\t\t\t{ value: TTUUID.not_exist_id, label: Global.default_item },\n\t\t\t\t\t{ value: 'ffffffff-ffff-ffff-ffff-000000000002', label: $.i18n._( '-- Current Shift --' ) }\n\t\t\t\t]\n\t\t\t} );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\tvar job_item_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tjob_item_coder.TTextInput( { field: 'job_item_quick_search', disable_keyup_event: true } );\n\t\t\tjob_item_coder.addClass( 'job-coder' );\n\n\t\t\twidgetContainer.append( job_item_coder );\n\t\t\twidgetContainer.append( form_item_input );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Task' ), [form_item_input, job_item_coder], tab_punch_column1, '', widgetContainer, true );\n\n\t\t\tif ( !this.show_job_item_ui ) {\n\t\t\t\tthis.detachElement( 'job_item_id' );\n\t\t\t}\n\n\t\t\t//Punch Tag\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIPunchTag,\n\t\t\t\tallow_multiple_selection: true,\n\t\t\t\tlayout_name: 'global_punch_tag',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tget_real_data_on_multi: true,\n\t\t\t\tsetRealValueCallBack: ( ( punch_tags, get_real_data ) => {\n\t\t\t\t\tif ( punch_tags ) {\n\t\t\t\t\t\tthis.setPunchTagQuickSearchManualIds( punch_tags, get_real_data );\n\t\t\t\t\t}\n\t\t\t\t} ),\n\t\t\t\tfield: 'punch_tag_id'\n\t\t\t} );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\tvar punch_tag_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tpunch_tag_coder.TTextInput( { field: 'punch_tag_quick_search', disable_keyup_event: true } );\n\t\t\tpunch_tag_coder.addClass( 'job-coder' );\n\n\t\t\twidgetContainer.append( punch_tag_coder );\n\t\t\twidgetContainer.append( form_item_input );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Tags' ), [form_item_input, punch_tag_coder], tab_punch_column1, '', widgetContainer, true );\n\n\t\t\tif ( !this.show_punch_tag_ui ) {\n\t\t\t\tthis.detachElement( 'punch_tag_id' );\n\t\t\t}\n\n\t\t}\n\n\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t// Quantity\n\t\t\tvar good = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tgood.TTextInput( { field: 'quantity', width: 40 } );\n\t\t\tgood.addClass( 'quantity-input' );\n\n\t\t\tvar good_label = $( '<span class=\\'widget-right-label\\'>' + $.i18n._( 'Good' ) + ': </span>' );\n\n\t\t\tvar bad = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tbad.TTextInput( { field: 'bad_quantity', width: 40 } );\n\t\t\tbad.addClass( 'quantity-input' );\n\n\t\t\tvar bad_label = $( '<span class=\\'widget-right-label\\'>/ ' + $.i18n._( 'Bad' ) + ': </span>' );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\twidgetContainer.append( good_label );\n\t\t\twidgetContainer.append( good );\n\t\t\twidgetContainer.append( bad_label );\n\t\t\twidgetContainer.append( bad );\n\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Quantity' ), [good, bad], tab_punch_column1, '', widgetContainer, true );\n\n\t\t\tif ( !this.show_bad_quantity_ui && !this.show_good_quantity_ui ) {\n\t\t\t\tthis.detachElement( 'quantity' );\n\t\t\t} else {\n\t\t\t\tif ( !this.show_bad_quantity_ui ) {\n\t\t\t\t\tbad_label.hide();\n\t\t\t\t\tbad.hide();\n\t\t\t\t}\n\n\t\t\t\tif ( !this.show_good_quantity_ui ) {\n\t\t\t\t\tgood_label.hide();\n\t\t\t\t\tgood.hide();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t//Note\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_AREA );\n\n\t\tform_item_input.TTextArea( { field: 'note', width: '100%' } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Note' ), form_item_input, tab_punch_column1, '', null, true, true );\n\n\t\tform_item_input.parent().width( '45%' );\n\n\t\tif ( !this.show_note_ui ) {\n\t\t\tthis.detachElement( 'note' );\n\t\t}\n\n\t\t//Location\n\t\tif ( Global.getProductEdition() >= 15 ) {\n\t\t\tvar latitude = Global.loadWidgetByName( FormItemType.TEXT );\n\t\t\tlatitude.TText( { field: 'latitude' } );\n\t\t\tvar longitude = Global.loadWidgetByName( FormItemType.TEXT );\n\t\t\tlongitude.TText( { field: 'longitude' } );\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box link-widget-box\\'></div>' );\n\t\t\tvar accuracy = Global.loadWidgetByName( FormItemType.TEXT );\n\t\t\taccuracy.TText( { field: 'position_accuracy' } );\n\t\t\tlabel = $( '<span class=\\'widget-right-label\\'>' + $.i18n._( 'Accuracy' ) + ':</span>' );\n\n\t\t\tvar map_icon = $( '<img class=\"widget-h-box-mapIcon\" src=\"framework/leaflet/images/marker-icon-red.png\" >' ); // TODO, fix image location so that its not in a library folder incase library removed.\n\n\t\t\tthis.location_wrapper = $( '<div class=\"widget-h-box-mapLocationWrapper\"></div>' );\n\t\t\twidgetContainer.append( map_icon );\n\t\t\twidgetContainer.append( this.location_wrapper );\n\t\t\tthis.location_wrapper.append( latitude );\n\t\t\tthis.location_wrapper.append( $( '<span>, </span>' ) );\n\t\t\tthis.location_wrapper.append( longitude );\n\t\t\tthis.location_wrapper.append( label );\n\t\t\tthis.location_wrapper.append( accuracy );\n\t\t\tthis.location_wrapper.append( $( '<span>m</span>' ) );\n\n\t\t\tif ( this.is_mass_editing ) {\n\t\t\t\tthis.location_mass_edit_check_box = $( ' <div class=\"mass-edit-checkbox-wrapper\"><input type=\"checkbox\" class=\"mass-edit-checkbox\"></input>' +\n\t\t\t\t\t'<label for=\"checkbox-input-1\" class=\"input-helper input-helper--checkbox\"></label></div>' );\n\n\t\t\t\tthis.location_mass_edit_check_box.insertBefore( $( map_icon ) );\n\t\t\t\tthis.location_mass_edit_check_box.change( () => {\n\t\t\t\t\tthis.trigger( 'formItemChange', [this.edit_view_ui_dic.longitude] );\n\t\t\t\t\tthis.trigger( 'formItemChange' [this.edit_view_ui_dic.latitude] );\n\t\t\t\t\tthis.trigger( 'position_accuracy' [this.edit_view_ui_dic.position_accuracy] );\n\t\t\t\t} );\n\n\t\t\t\t//The location field is actually 3 fields in one, longitude, latitude and accuracy.\n\t\t\t\t//Therefore, in mass edit mode it's the widgetContainer that is marked as changed.\n\n\t\t\t\tlet isChecked = () => this.location_mass_edit_check_box.find( '.mass-edit-checkbox' )[0].checked;\n\t\t\t\tlet getEnabled = () => true;\n\n\t\t\t\t//These 3 widgets inside the widgetContainer represent one field and share the same checkbox and enabled state.\n\t\t\t\tlongitude.isChecked = latitude.isChecked = accuracy.isChecked = isChecked;\n\t\t\t\tlongitude.getEnabled = latitude.getEnabled = accuracy.getEnabled = getEnabled;\n\t\t\t}\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Location' ), [latitude, longitude, accuracy], tab_punch_column1, '', widgetContainer, true );\n\t\t\twidgetContainer.click( ( event ) => {\n\t\t\t\tif ( event.target.className != 'mass-edit-checkbox' ) {\n\t\t\t\t\tthis.onMapClick();\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\t// #2117 - Manual location only supported in edit because we need a punch record to append the data to.\n\t\t\tif ( ( !this.is_edit && !this.is_viewing && !this.is_mass_editing ) || !this.show_location_ui ) {\n\t\t\t\twidgetContainer.parents( '.edit-view-form-item-div' ).hide();\n\t\t\t}\n\t\t}\n\n\t\t// Station\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\tform_item_input.TText( { field: 'station_id' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Station' ), form_item_input, tab_punch_column1, '', null, true, true );\n\n\t\tform_item_input.click( function() {\n\t\t\tif ( $this.current_edit_record.station_id && $this.show_station_ui ) {\n\t\t\t\tIndexViewController.openEditView( $this, 'Station', $this.current_edit_record.station_id );\n\t\t\t}\n\n\t\t} );\n\n\t\t//Split Punch Control\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.CHECKBOX );\n\t\tform_item_input.TCheckbox( { field: 'split_punch_control' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Split Existing Punches' ), form_item_input, tab_punch_column1, '', null, true );\n\t\tif ( this.is_add == false ) {\n\t\t\tthis.detachElement( 'split_punch_control' );\n\t\t}\n\n\t\t//Punch Image\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.IMAGE );\n\t\tform_item_input.TImage( { field: 'punch_image' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Image' ), form_item_input, tab_punch_column1, '', null, true, true );\n\n\t\tif ( this.is_mass_editing ) {\n\t\t\tthis.detachElement( 'punch_image' );\n\t\t\tthis.detachElement( 'user_id' );\n\t\t}\n\t}\n\n\tonSourceDataCreate( target, source_data ) {\n\t\tvar display_columns = target.getDisplayColumns();\n\t\tvar first_item = {};\n\t\tvar second_item = {};\n\n\t\t$.each( display_columns, function( index, content ) {\n\t\t\tfirst_item.id = TTUUID.not_exist_id;\n\t\t\tfirst_item[content.name] = Global.default_item;\n\n\t\t\tsecond_item.id = 'ffffffff-ffff-ffff-ffff-000000000002';\n\t\t\tsecond_item[content.name] = $.i18n._( '-- Current Shift --' );\n\n\t\t\treturn false;\n\t\t} );\n\n\t\t//Error: Object doesn't support property or method 'unshift' in /interface/html5/line 6953\n\t\tif ( !source_data || $.type( source_data ) !== 'array' ) {\n\t\t\tsource_data = [];\n\t\t}\n\n\t\tsource_data.unshift( second_item );\n\t\tsource_data.unshift( first_item );\n\n\t\treturn source_data;\n\t}\n\n\t//set widget disablebility if view mode or edit mode\n\tsetEditViewWidgetsMode() {\n\t\tvar did_clean_dic = {};\n\t\tfor ( var key in this.edit_view_ui_dic ) {\n\t\t\tif ( !this.edit_view_ui_dic.hasOwnProperty( key ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tvar widget = this.edit_view_ui_dic[key];\n\t\t\tvar widgetContainer = this.edit_view_form_item_dic[key];\n\t\t\twidget.css( 'opacity', 1 );\n\t\t\tvar column = widget.parent().parent().parent();\n\t\t\tvar tab_id = column.parent().attr( 'id' );\n\t\t\tif ( !column.hasClass( 'v-box' ) ) {\n\t\t\t\tif ( !did_clean_dic[tab_id] ) {\n\t\t\t\t\tdid_clean_dic[tab_id] = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tswitch ( key ) {\n\t\t\t\tcase 'punch_dates':\n\t\t\t\t\tif ( !this.is_mass_editing && ( this.isMassAdding() || !this.current_edit_record.id || this.current_edit_record.id == TTUUID.zero_id ) ) {\n\t\t\t\t\t\tthis.attachElement( key );\n\t\t\t\t\t\twidget.css( 'opacity', 1 ); //show\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.detachElement( key );\n\t\t\t\t\t\twidget.css( 'opacity', 0 ); //hide\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'punch_date':\n\t\t\t\t\tif ( !this.is_mass_editing && ( this.isMassAdding() || !this.current_edit_record.id || this.current_edit_record.id == TTUUID.zero_id ) ) {\n\t\t\t\t\t\tthis.detachElement( key );\n\t\t\t\t\t\twidget.css( 'opacity', 0 ); //hide - opposite from above\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.attachElement( key );\n\t\t\t\t\t\twidget.css( 'opacity', 1 ); //show\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif ( this.is_viewing ) {\n\t\t\t\tif ( Global.isSet( widget.setEnabled ) ) {\n\t\t\t\t\twidget.setEnabled( false );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif ( Global.isSet( widget.setEnabled ) ) {\n\n\t\t\t\t\twidget.setEnabled( true );\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n\n\tonTransferChanged( initial_load ) {\n\n\t\tvar is_transfer = false;\n\t\tif ( this.edit_view_ui_dic && this.edit_view_ui_dic['transfer'] && this.edit_view_ui_dic['transfer'].getValue() == true ) {\n\t\t\tis_transfer = true;\n\t\t}\n\n\t\t// type_id_widget is undefined in interface/html5/framework/jquery.min.js?v=9.0.1-20151022-091549 line 2 > eval line 390\n\t\tvar type_id_widget = this.edit_view_ui_dic['type_id'];\n\t\tvar status_id_widget = this.edit_view_ui_dic['status_id'];\n\t\tif ( is_transfer && type_id_widget && status_id_widget ) {\n\n\t\t\ttype_id_widget.setEnabled( false );\n\t\t\tstatus_id_widget.setEnabled( false );\n\n\t\t\tthis.old_type_status.type_id = type_id_widget.getValue();\n\t\t\tthis.old_type_status.status_id = status_id_widget.getValue();\n\n\t\t\ttype_id_widget.setValue( 10 );\n\t\t\tstatus_id_widget.setValue( 10 );\n\n\t\t\tthis.current_edit_record.type_id = 10;\n\t\t\tthis.current_edit_record.status_id = 10;\n\n\t\t} else if ( type_id_widget && status_id_widget ) {\n\t\t\ttype_id_widget.setEnabled( true );\n\t\t\tstatus_id_widget.setEnabled( true );\n\n\t\t\tif ( this.old_type_status.hasOwnProperty( 'type_id' ) ) {\n\t\t\t\ttype_id_widget.setValue( this.old_type_status.type_id );\n\t\t\t\tstatus_id_widget.setValue( this.old_type_status.status_id );\n\n\t\t\t\tthis.current_edit_record.type_id = this.old_type_status.type_id;\n\t\t\t\tthis.current_edit_record.status_id = this.old_type_status.status_id;\n\t\t\t}\n\n\t\t}\n\n\t\tif ( is_transfer == true ) {\n\t\t\tif ( this.original_note == '' ) {\n\t\t\t\tthis.original_note = this.current_edit_record.note;\n\t\t\t} else {\n\t\t\t\tthis.original_note = this.edit_view_ui_dic.note.getValue();\n\t\t\t}\n\t\t\tthis.edit_view_ui_dic.note.setValue( this.new_note ? this.new_note : '' );\n\t\t\tthis.current_edit_record.note = this.new_note ? this.new_note : '';\n\n\t\t} else if ( typeof initial_load == 'undefined' || initial_load === false ) {\n\n\t\t\tthis.new_note = this.edit_view_ui_dic.note.getValue();\n\t\t\tthis.edit_view_ui_dic.note.setValue( this.original_note ? this.original_note : '' );\n\t\t\tthis.current_edit_record.note = this.original_note ? this.original_note : '';\n\t\t}\n\t}\n\n\t//Make sure this.current_edit_record is updated before validate\n\tvalidate() {\n\n\t\tvar $this = this;\n\n\t\tvar record = {};\n\n\t\tif ( this.is_mass_editing ) {\n\t\t\tfor ( var key in this.edit_view_ui_dic ) {\n\n\t\t\t\tif ( !this.edit_view_ui_dic.hasOwnProperty( key ) ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tvar widget = this.edit_view_ui_dic[key];\n\n\t\t\t\tif ( Global.isSet( widget.isChecked ) ) {\n\t\t\t\t\tif ( widget.isChecked() && widget.getEnabled() ) {\n\t\t\t\t\t\trecord[key] = widget.getValue();\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trecord.id = this.mass_edit_record_ids[0];\n\t\t\trecord = this.uniformVariable( record );\n\n\t\t} else {\n\t\t\trecord = this.current_edit_record;\n\t\t\trecord = this.uniformVariable( record );\n\t\t}\n\n\t\tthis.api['validate' + this.api.key_name]( record, {\n\t\t\tonResult: function( result ) {\n\t\t\t\t$this.validateResult( result );\n\n\t\t\t}\n\t\t} );\n\t}\n\n\t// TODO: not ideal to need to have this here. want to use the base view version,\n\t//  but need this in order to prevent it using the uniformVariable function in BaseViewController version,\n\t//  as Punches uniformVariable function does something additional\n\tbuildMassEditSaveRecord( mass_edit_record_ids, changed_fields ) {\n\t\tvar $this = this;\n\t\tvar mass_records = [];\n\t\t$.each( mass_edit_record_ids, function( index, value ) {\n\t\t\tvar common_record = Global.clone( changed_fields );\n\t\t\tcommon_record.id = value;\n\t\t\tmass_records.push( common_record );\n\t\t} );\n\t\treturn mass_records;\n\t}\n\n\tbuildMassAddRecord( current_edit_record ) {\n\t\tvar record = [];\n\t\tvar dates_array = current_edit_record.punch_dates;\n\n\t\tif ( dates_array && dates_array.indexOf( ' - ' ) > 0 ) {\n\t\t\tdates_array = this.parserDatesRange( dates_array );\n\t\t}\n\n\t\tif ( dates_array ) {\n\t\t\tfor ( var i = 0; i < dates_array.length; i++ ) {\n\t\t\t\tvar common_record = Global.clone( current_edit_record );\n\t\t\t\tdelete common_record.punch_dates;\n\t\t\t\tcommon_record.punch_date = dates_array[i];\n\t\t\t\tvar user_id = this.current_edit_record.user_id;\n\n\t\t\t\tif ( Global.isArray( user_id ) ) {\n\t\t\t\t\tfor ( var j = 0; j < user_id.length; j++ ) {\n\t\t\t\t\t\tvar final_record = Global.clone( common_record );\n\t\t\t\t\t\tfinal_record.user_id = this.current_edit_record.user_id[j];\n\t\t\t\t\t\trecord.push( final_record );\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\trecord.push( common_record );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn record;\n\t}\n\n\tparserDatesRange( date ) {\n\t\tvar dates = date.split( ' - ' );\n\t\tvar resultArray = [];\n\t\tvar beginDate = Global.strToDate( dates[0] );\n\t\tvar endDate = Global.strToDate( dates[1] );\n\n\t\tvar nextDate = beginDate;\n\n\t\twhile ( nextDate.getTime() < endDate.getTime() ) {\n\t\t\tresultArray.push( nextDate.format() );\n\t\t\tnextDate = new Date( new Date( nextDate.getTime() ).setDate( nextDate.getDate() + 1 ) );\n\t\t}\n\n\t\tresultArray.push( dates[1] );\n\n\t\treturn resultArray;\n\t}\n\n\tsetCurrentEditRecordData() {\n\t\tvar $this = this;\n\t\t//Set current edit record data to all widgets\n\t\tfor ( var key in this.current_edit_record ) {\n\n\t\t\tif ( !this.current_edit_record.hasOwnProperty( key ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar widget = this.edit_view_ui_dic[key];\n\t\t\tif ( Global.isSet( widget ) ) {\n\t\t\t\tswitch ( key ) {\n\t\t\t\t\tcase 'punch_dates':\n\t\t\t\t\t\tvar date_array;\n\t\t\t\t\t\tif ( !this.current_edit_record.punch_dates ) {\n\t\t\t\t\t\t\tdate_array = [this.current_edit_record['punch_date']];\n\t\t\t\t\t\t\tthis.current_edit_record.punch_dates = date_array;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdate_array = this.current_edit_record.punch_dates;\n\t\t\t\t\t\t}\n\t\t\t\t\t\twidget.setValue( date_array );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'country': //popular case\n\t\t\t\t\t\tthis.setCountryValue( widget, key );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'enable_email_notification_message':\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_id':\n\t\t\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\t\t\tvar args = {};\n\t\t\t\t\t\t\targs.filter_data = {\n\t\t\t\t\t\t\t\tstatus_id: 10,\n\t\t\t\t\t\t\t\tuser_id: this.current_edit_record.user_id,\n\t\t\t\t\t\t\t\tpunch_branch_id: this.current_edit_record.branch_id,\n\t\t\t\t\t\t\t\tpunch_department_id: this.current_edit_record.department_id\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\twidget.setDefaultArgs( args );\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_item_id':\n\t\t\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\t\t\tvar args = {};\n\t\t\t\t\t\t\targs.filter_data = { status_id: 10, job_id: this.current_edit_record.job_id };\n\t\t\t\t\t\t\twidget.setDefaultArgs( args );\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'punch_tag_id':\n\t\t\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t\tthis.previous_punch_tag_selection = this.current_edit_record[key];\n\n\t\t\t\t\t\t\tvar punch_tag_widget = widget;\n\t\t\t\t\t\t\tTTPromise.wait( null, null, function() {\n\t\t\t\t\t\t\t\t//Update default args for punch tags AComboBox last as they rely on data from job, job item and related fields.\n\t\t\t\t\t\t\t\tvar args = {};\n\t\t\t\t\t\t\t\targs.filter_data = $this.getPunchTagFilterData();\n\t\t\t\t\t\t\t\tpunch_tag_widget.setDefaultArgs( args );\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'punch_tag_quick_search':\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_quick_search':\n//\t\t\t\t\t\twidget.setValue( this.current_edit_record['job_id'] ? this.current_edit_record['job_id'] : 0 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_item_quick_search':\n//\t\t\t\t\t\twidget.setValue( this.current_edit_record['job_item_id'] ? this.current_edit_record['job_item_id'] : 0 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'station_id':\n\t\t\t\t\t\tif ( this.current_edit_record[key] ) {\n\t\t\t\t\t\t\tthis.setStation();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twidget.setValue( 'N/A' );\n\t\t\t\t\t\t\twidget.css( 'cursor', 'default' );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'punch_image':\n\t\t\t\t\t\tvar station_form_item = this.edit_view_form_item_dic['station_id'];\n\t\t\t\t\t\tif ( this.current_edit_record['has_image'] ) {\n\t\t\t\t\t\t\tthis.attachElement( 'punch_image' );\n\t\t\t\t\t\t\twidget.setValue( ServiceCaller.getURLByObjectType( 'file_download' ) + '&object_type=punch_image&parent_id=' + this.current_edit_record.user_id + '&object_id=' + this.current_edit_record.id );\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.detachElement( 'punch_image' );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t\tvar actual_time_value;\n\t\tif ( this.current_edit_record.id ) {\n\n\t\t\tif ( this.current_edit_record.actual_time_stamp ) {\n\t\t\t\tactual_time_value = $.i18n._( 'Actual Time' ) + ': ' + this.current_edit_record.actual_time_stamp;\n\t\t\t} else {\n\t\t\t\tactual_time_value = 'N/A';\n\t\t\t}\n\n\t\t}\n\t\tthis.actual_time_label.text( actual_time_value );\n\n\t\tthis.collectUIDataToCurrentEditRecord();\n\t\tthis.setLocationValue();\n\n\t\tthis.setEditViewDataDone();\n\t\tthis.isEditChange();\n\t}\n\n\tsetLocationValue( location_data ) {\n\t\tif ( Global.getProductEdition() >= 15 ) {\n\t\t\tif ( location_data ) {\n\t\t\t\tthis.current_edit_record.latitude = location_data.latitude;\n\t\t\t\tthis.current_edit_record.longitude = location_data.longitude;\n\t\t\t\tthis.current_edit_record.position_accuracy = location_data.position_accuracy; //If position is manually modified, it should always be set to 0m.\n\t\t\t}\n\t\t\tthis.edit_view_ui_dic['latitude'].setValue( this.current_edit_record.latitude );\n\t\t\tthis.edit_view_ui_dic['longitude'].setValue( this.current_edit_record.longitude );\n\t\t\tthis.edit_view_ui_dic['position_accuracy'].setValue( this.current_edit_record.position_accuracy ? this.current_edit_record.position_accuracy : 0 );\n\n\t\t\tif ( !this.current_edit_record.latitude && !this.is_mass_editing ) {\n\t\t\t\tthis.location_wrapper.hide();\n\t\t\t} else {\n\t\t\t\tif ( this.show_location_ui ) {\n\t\t\t\t\tthis.location_wrapper.show();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tisEditChange() {\n\n\t\tif ( this.current_edit_record.id || this.is_mass_editing ) {\n\t\t\tthis.edit_view_ui_dic['user_id'].setEnabled( false );\n\t\t} else {\n\t\t\tthis.edit_view_ui_dic['user_id'].setEnabled( true );\n\t\t}\n\t}\n\n\t//set tab 0 visible after all data set done. This be hide when init edit view data\n\tsetEditViewDataDone() {\n\t\t// Remove this on 14.9.14 because adding tab url support, ned set url when tab index change and\n\t\t// need know what's current doing action. See if this cause any problem\n\t\t//LocalCacheData.current_doing_context_action = '';\n\t\tthis.setTabOVisibility( true );\n\n\t\tif ( this.is_edit == true ) {\n\t\t\tthis.edit_view_ui_dic.user_id.setAllowMultipleSelection( false );\n\t\t} else {\n\t\t\tthis.edit_view_ui_dic.user_id.setAllowMultipleSelection( true );\n\t\t}\n\n\t\tif ( this.is_viewing == true && ( this.current_edit_record.latitude == 0 || this.current_edit_record.longitude == 0 ) ) {\n\t\t\t$( '.widget-h-box-mapLocationWrapper' ).parents( '.edit-view-form-item-div' ).hide();\n\t\t} else {\n\t\t\tif ( this.show_location_ui ) {\n\t\t\t\t$( '.widget-h-box-mapLocationWrapper' ).parents( '.edit-view-form-item-div' ).show();\n\t\t\t}\n\t\t}\n\n\t\tthis.navigation.setValue( this.current_edit_record.id );\n\n\t\t$( '.edit-view-tab-bar' ).css( 'opacity', 1 );\n\t\tTTPromise.resolve( 'init', 'init' );\n\t}\n\n\tsetSubLogViewFilter() {\n\t\tif ( !this.sub_log_view_controller ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.sub_log_view_controller.getSubViewFilter = function( filter ) {\n\t\t\tfilter['table_name_object_id'] = {\n\t\t\t\t'punch': [this.parent_edit_record.id],\n\t\t\t\t'punch_control': [this.parent_edit_record.punch_control_id]\n\t\t\t};\n\n\t\t\treturn filter;\n\t\t};\n\n\t\treturn true;\n\t}\n\n\tbuildOtherFieldUI( field, label ) {\n\n\t\tif ( !this.edit_view_tab ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar form_item_input;\n\t\tvar $this = this;\n\t\tvar tab_punch = this.edit_view_tab.find( '#tab_punch' );\n\t\tvar tab_punch_column1 = tab_punch.find( '.first-column' );\n\n\t\tif ( $this.edit_view_ui_dic[field] ) {\n\t\t\tform_item_input = $this.edit_view_ui_dic[field];\n\t\t\tform_item_input.setValue( $this.current_edit_record[field] );\n\t\t} else {\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tform_item_input.TTextInput( { field: field } );\n\t\t\tvar input_div = $this.addEditFieldToColumn( label, form_item_input, tab_punch_column1 );\n\n\t\t\tinput_div.insertBefore( this.edit_view_form_item_dic['note'] );\n\n\t\t\tform_item_input.setValue( $this.current_edit_record[field] );\n\t\t}\n\t\tform_item_input.css( 'opacity', 1 );\n\t\tform_item_input.css( 'minWidth', 300 );\n\n\t\tif ( $this.is_viewing ) {\n\t\t\tform_item_input.setEnabled( false );\n\t\t} else {\n\t\t\tform_item_input.setEnabled( true );\n\t\t}\n\t}\n\n\tonAddResult( result ) {\n\t\tvar $this = this;\n\t\tvar result_data = result.getResult();\n\n\t\tif ( !result_data ) {\n\t\t\tresult_data = [];\n\t\t}\n\n\t\tresult_data.company = LocalCacheData.current_company.name;\n\t\tresult_data.punch_date = ( new Date() ).format();\n\n\t\tif ( $this.sub_view_mode && $this.parent_key ) {\n\t\t\tresult_data[$this.parent_key] = $this.parent_value;\n\t\t}\n\n\t\t$this.current_edit_record = result_data;\n\t\t$this.initEditView();\n\t}\n\n\tbuildSearchFields() {\n\n\t\tsuper.buildSearchFields();\n\t\tvar default_args = { permission_section: 'punch' };\n\t\tthis.search_fields = [\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Employee Status' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'user_status_id',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tlayout_name: 'global_option_column',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Pay Period' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'pay_period_id',\n\t\t\t\tlayout_name: 'global_Pay_period',\n\t\t\t\tapi_class: TTAPI.APIPayPeriod,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Start Date' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'start_date',\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.DATE_PICKER\n\t\t\t} ),\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'End Date' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'end_date',\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.DATE_PICKER\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Employee' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'user_id',\n\t\t\t\tlayout_name: 'global_user',\n\t\t\t\tdefault_args: default_args,\n\t\t\t\tapi_class: TTAPI.APIUser,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Status' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'status_id',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tlayout_name: 'global_option_column',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Type' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'type_id',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tlayout_name: 'global_option_column',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Group' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tmultiple: true,\n\t\t\t\tfield: 'group_id',\n\t\t\t\tlayout_name: 'global_tree_column',\n\t\t\t\ttree_mode: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Title' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'title_id',\n\t\t\t\tlayout_name: 'global_user_title',\n\t\t\t\tapi_class: TTAPI.APIUserTitle,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Punch Branch' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'branch_id',\n\t\t\t\tlayout_name: 'global_branch',\n\t\t\t\tapi_class: TTAPI.APIBranch,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Punch Department' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'department_id',\n\t\t\t\tlayout_name: 'global_department',\n\t\t\t\tapi_class: TTAPI.APIDepartment,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Default Branch' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'default_branch_id',\n\t\t\t\tlayout_name: 'global_branch',\n\t\t\t\tapi_class: TTAPI.APIBranch,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Default Department' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'default_department_id',\n\t\t\t\tlayout_name: 'global_department',\n\t\t\t\tapi_class: TTAPI.APIDepartment,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Job' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'job_id',\n\t\t\t\tlayout_name: 'global_job',\n\t\t\t\tapi_class: ( Global.getProductEdition() >= 20 ) ? TTAPI.APIJob : null,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: ( this.show_job_ui && ( Global.getProductEdition() >= 20 ) ),\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Task' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'job_item_id',\n\t\t\t\tlayout_name: 'global_job_item',\n\t\t\t\tapi_class: ( Global.getProductEdition() >= 20 ) ? TTAPI.APIJobItem : null,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: ( this.show_job_item_ui && ( Global.getProductEdition() >= 20 ) ),\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Punch Tags' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'punch_tag_id',\n\t\t\t\tlayout_name: 'global_punch_tag',\n\t\t\t\tapi_class: ( Global.getProductEdition() >= 20 ) ? TTAPI.APIPunchTag : null,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: ( this.show_punch_tag_ui && ( Global.getProductEdition() >= 20 ) ),\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Created By' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'created_by',\n\t\t\t\tlayout_name: 'global_user',\n\t\t\t\tapi_class: TTAPI.APIUser,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Updated By' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'updated_by',\n\t\t\t\tlayout_name: 'global_user',\n\t\t\t\tapi_class: TTAPI.APIUser,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} )\n\t\t];\n\t}\n\n\tgetCustomContextMenuModel() {\n\t\tvar context_menu_model = {\n\t\t\texclude: ['copy'],\n\t\t\tinclude: [\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Jump To' ),\n\t\t\t\t\tid: 'jump_to_header',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\taction_group: 'jump_to',\n\t\t\t\t\taction_group_header: true,\n\t\t\t\t\tsort_order: 9050,\n\t\t\t\t\tpermission_result: false // to hide it in legacy context menu and avoid errors in legacy parsers.\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'TimeSheet' ),\n\t\t\t\t\tid: 'timesheet',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\taction_group: 'jump_to',\n\t\t\t\t\tsort_order: 9050,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Edit Employee' ),\n\t\t\t\t\tid: 'edit_employee',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\taction_group: 'jump_to',\n\t\t\t\t\tsort_order: 9050,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\tif ( Global.getProductEdition() >= 15 ) {\n\t\t\tcontext_menu_model.include.push(\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Map' ),\n\t\t\t\t\tid: 'map',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\tgroup: 'other',\n\t\t\t\t\tvue_icon: 'tticon tticon-map_black_24dp',\n\t\t\t\t\tsort_order: 8000,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Import' ),\n\t\t\t\t\tid: 'import_icon',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\taction_group: 'import_export',\n\t\t\t\t\tgroup: 'other',\n\t\t\t\t\tvue_icon: 'tticon tticon-file_download_black_24dp',\n\t\t\t\t\tsort_order: 9010\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\treturn context_menu_model;\n\t}\n\n\tonMapClick() {\n\t\t// only trigger map load in specific product editions.\n\t\tif ( ( Global.getProductEdition() >= 15 ) ) {\n\t\t\tProgressBar.showProgressBar();\n\n\t\t\t// TODO: this is repeated below, perhaps in future now that getFilterColumnsFromDisplayColumns() is commented out, this can be consolidated?\n\t\t\tvar data = {\n\t\t\t\tfilter_columns: {\n\t\t\t\t\tid: true,\n\t\t\t\t\tlatitude: true,\n\t\t\t\t\tlongitude: true,\n\t\t\t\t\tpunch_date: true,\n\t\t\t\t\tpunch_time: true,\n\t\t\t\t\tposition_accuracy: true,\n\t\t\t\t\tuser_id: true\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tvar punches = [];\n\t\t\tvar map_options = {};\n\n\t\t\tif ( this.is_edit || this.is_mass_editing || this.is_add ) {\n\t\t\t\t//when editing, if the user reloads, the grid's selected id array become the whole grid.\n\t\t\t\t//to avoid mapping every punch in that scenario we need to grab the current_edit_record, rather than pull data from getGridSelectIdArray()\n\t\t\t\t//check for mass edit as well. <-- not sure what this refers to, assuming the same happens in mass edit, but maps are disabled on mass edit atm.\n\t\t\t\tpunches.push( this.current_edit_record );\n\t\t\t\t// from the edit view we want to allow single markers to be draggable.\n\t\t\t\tif ( !this.is_viewing ) {\n\t\t\t\t\t// make sure that when view only (so no save) marker is not draggable, and thus no new marker can be added either.\n\t\t\t\t\tmap_options.single_marker_draggable = true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tvar ids = this.getGridSelectIdArray();\n\t\t\t\t// from the map icon on the ribbon bar we want to PREVENT single markers being draggable. As this is intended as a read only view.\n\t\t\t\tmap_options.single_marker_draggable = false;\n\n\t\t\t\tdata.filter_data = Global.convertLayoutFilterToAPIFilter( this.select_layout );\n\t\t\t\tif ( ids.length > 0 ) {\n\t\t\t\t\tdata.filter_data.id = ids;\n\t\t\t\t}\n\t\t\t\t// data.filter_columns = this.getFilterColumnsFromDisplayColumns()\n\t\t\t\tdata.filter_columns.first_name = true;\n\t\t\t\tdata.filter_columns.last_name = true;\n\t\t\t\tdata.filter_columns.user_id = true;\n\t\t\t\tdata.filter_columns.date_stamp = true; // #2735 - grouping punches by date_stamp instead of punch_date, to allow cross date punch controls to plot distances.\n\t\t\t\tdata.filter_columns.punch_date = true;\n\t\t\t\tdata.filter_columns.punch_time = true;\n\t\t\t\tdata.filter_columns.time_stamp = true;\n\t\t\t\tdata.filter_columns.status = true;\n\t\t\t\tdata.filter_columns.punch_control_id = true;\n\t\t\t\tdata.filter_columns.branch = true;\n\t\t\t\tdata.filter_columns.branch_id = true;\n\t\t\t\tdata.filter_columns.department = true;\n\t\t\t\tdata.filter_columns.department_id = true;\n\t\t\t\tdata.filter_columns.job_manual_id = true;\n\t\t\t\tdata.filter_columns.job = true;\n\t\t\t\tdata.filter_columns.job_id = true;\n\t\t\t\tdata.filter_columns.job_item_manual_id = true;\n\t\t\t\tdata.filter_columns.job_item = true; // also known as Task\n\t\t\t\tdata.filter_columns.job_item_id = true;\n\t\t\t\tdata.filter_columns.punch_tag_id = true;\n\t\t\t\tdata.filter_columns.total_time = true;\n\t\t\t\tdata.filter_columns.latitude = true;\n\t\t\t\tdata.filter_columns.longitude = true;\n\t\t\t\tdata.filter_columns.position_accuracy = true;\n\n\t\t\t\tpunches = this.api.getPunch( data, { async: false } ).getResult();\n\t\t\t}\n\n\t\t\timport( /* webpackChunkName: \"leaflet-timetrex\" */ '@/framework/leaflet/leaflet-timetrex' ).then(( module )=>{\n\t\t\t\tvar processed_punches_for_map = module.TTConvertMapData.processPunchesFromViewController( punches, map_options );\n\t\t\t\tIndexViewController.openEditView( this, 'Map', processed_punches_for_map );\n\t\t\t}).catch( Global.importErrorHandler );\n\t\t}\n\t}\n\n\tonCustomContextClick( id ) {\n\t\tswitch ( id ) {\n\t\t\tcase 'timesheet':\n\t\t\tcase 'edit_employee':\n\t\t\t\tthis.onNavigationClick( id );\n\t\t\t\tbreak;\n\t\t\tcase 'map':\n\t\t\t\tthis.onMapClick();\n\t\t\t\tbreak;\n\t\t\tcase 'import_icon':\n\t\t\t\tthis.onImportClick();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tonImportClick() {\n\t\tvar $this = this;\n\t\tIndexViewController.openWizard( 'ImportCSVWizard', 'Punch', function() {\n\t\t\t$this.search();\n\t\t} );\n\t}\n\n\tsetCustomDefaultMenuIcon( id, context_btn, grid_selected_length ) {\n\t\tswitch ( id ) {\n\t\t\tcase 'timesheet':\n\t\t\t\tthis.setDefaultMenuViewIcon( context_btn, grid_selected_length, 'punch' );\n\t\t\t\tbreak;\n\t\t\tcase 'edit_employee':\n\t\t\t\tthis.setDefaultMenuEditIcon( context_btn, grid_selected_length, 'user' );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tsetCustomEditMenuIcon( id, context_btn ) {\n\t\tswitch ( id ) {\n\t\t\tcase 'timesheet':\n\t\t\t\tthis.setEditMenuNavViewIcon( context_btn, 'punch' );\n\t\t\t\tbreak;\n\t\t\tcase 'edit_employee':\n\t\t\t\tthis.setEditMenuNavEditIcon( context_btn, 'user' );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\tonNavigationClick( iconName ) {\n\t\tvar $this = this;\n\t\tvar filter;\n\t\tvar temp_filter;\n\t\tvar grid_selected_id_array;\n\t\tvar grid_selected_length;\n\n\t\tswitch ( iconName ) {\n\t\t\tcase 'timesheet':\n\t\t\t\tfilter = { filter_data: {} };\n\t\t\t\tif ( Global.isSet( this.current_edit_record ) ) {\n\n\t\t\t\t\tfilter.user_id = this.current_edit_record.user_id;\n\t\t\t\t\tfilter.base_date = this.current_edit_record.punch_date;\n\t\t\t\t\tGlobal.addViewTab( this.viewId, $.i18n._( 'Punches' ), window.location.href );\n\t\t\t\t\tIndexViewController.goToView( 'TimeSheet', filter );\n\t\t\t\t} else {\n\t\t\t\t\ttemp_filter = {};\n\t\t\t\t\tgrid_selected_id_array = this.getGridSelectIdArray();\n\t\t\t\t\tgrid_selected_length = grid_selected_id_array.length;\n\n\t\t\t\t\tif ( grid_selected_length > 0 ) {\n\t\t\t\t\t\tvar selectedId = grid_selected_id_array[0];\n\n\t\t\t\t\t\ttemp_filter.filter_data = {};\n\t\t\t\t\t\ttemp_filter.filter_data.id = [selectedId];\n\n\t\t\t\t\t\tthis.api['get' + this.api.key_name]( temp_filter, {\n\t\t\t\t\t\t\tonResult: function( result ) {\n\n\t\t\t\t\t\t\t\tvar result_data = result.getResult();\n\n\t\t\t\t\t\t\t\tif ( !result_data ) {\n\t\t\t\t\t\t\t\t\tresult_data = [];\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tresult_data = result_data[0];\n\n\t\t\t\t\t\t\t\tfilter.user_id = result_data.user_id;\n\t\t\t\t\t\t\t\tfilter.base_date = result_data.punch_date;\n\n\t\t\t\t\t\t\t\tGlobal.addViewTab( $this.viewId, $.i18n._( 'Punches' ), window.location.href );\n\t\t\t\t\t\t\t\tIndexViewController.goToView( 'TimeSheet', filter );\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase 'edit_employee':\n\t\t\t\tfilter = { filter_data: {} };\n\t\t\t\tif ( Global.isSet( this.current_edit_record ) ) {\n\t\t\t\t\tIndexViewController.openEditView( this, 'Employee', this.current_edit_record.user_id );\n\t\t\t\t} else {\n\t\t\t\t\ttemp_filter = {};\n\t\t\t\t\tgrid_selected_id_array = this.getGridSelectIdArray();\n\t\t\t\t\tgrid_selected_length = grid_selected_id_array.length;\n\n\t\t\t\t\tif ( grid_selected_length > 0 ) {\n\t\t\t\t\t\tselectedId = grid_selected_id_array[0];\n\n\t\t\t\t\t\ttemp_filter.filter_data = {};\n\t\t\t\t\t\ttemp_filter.filter_data.id = [selectedId];\n\n\t\t\t\t\t\tthis.api['get' + this.api.key_name]( temp_filter, {\n\t\t\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\t\t\tvar result_data = result.getResult();\n\n\t\t\t\t\t\t\t\tif ( !result_data ) {\n\t\t\t\t\t\t\t\t\tresult_data = [];\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tresult_data = result_data[0];\n\n\t\t\t\t\t\t\t\tIndexViewController.openEditView( $this, 'Employee', result_data.user_id );\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tsetEditMenuSaveAndContinueIcon( context_btn, pId ) {\n\t\tthis.saveAndContinueValidate( context_btn, pId );\n\n\t\tif ( this.is_mass_editing || this.is_viewing || this.isMassDateOrMassUser() ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tcopyAsNewResetIds( data ) {\n\t\t//override where needed.\n\t\tdata.id = '';\n\t\tdata.punch_control_id = ''; //Clear the punch_control_id record as well so we don't force the punch to be assigned to it.\n\t\treturn data;\n\t}\n\n\t_continueDoCopyAsNew() {\n\t\tvar $this = this;\n\t\tthis.setCurrentEditViewState( 'new' );\n\t\tLocalCacheData.current_doing_context_action = 'copy_as_new';\n\t\tif ( Global.isSet( this.edit_view ) ) {\n\t\t\tthis.current_edit_record = this.copyAsNewResetIds( this.current_edit_record );\n\t\t\tvar navigation_div = this.edit_view.find( '.navigation-div' );\n\t\t\tnavigation_div.css( 'display', 'none' );\n\t\t\tthis.openEditView();\n\t\t\tthis.initEditView();\n\t\t\tthis.setEditMenu();\n\t\t\tthis.setTabStatus();\n\t\t\tthis.is_changed = false;\n\t\t\tProgressBar.closeOverlay();\n\t\t} else {\n\t\t\tsuper._continueDoCopyAsNew();\n\t\t}\n\t}\n\n\tisMassDateOrMassUser() {\n\t\tif ( this.isMassAdding() ) {\n\t\t\tif ( this.current_edit_record.punch_dates && this.current_edit_record.punch_dates.length > 1 ) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif ( this.current_edit_record.user_id && this.current_edit_record.user_id.length > 1 ) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tonSaveAndCopy( ignoreWarning ) {\n\t\tvar $this = this;\n\t\tif ( !Global.isSet( ignoreWarning ) ) {\n\t\t\tignoreWarning = false;\n\t\t}\n\t\tthis.is_add = true;\n\t\tthis.is_changed = false;\n\t\tLocalCacheData.current_doing_context_action = 'save_and_copy';\n\t\tvar record = this.current_edit_record;\n\t\trecord = this.uniformVariable( record );\n\n\t\tthis.clearNavigationData();\n\t\tthis.api['set' + this.api.key_name]( record, false, ignoreWarning, {\n\t\t\tonResult: function( result ) {\n\t\t\t\t$this.onSaveAndCopyResult( result );\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tonSaveAndNewClick( ignoreWarning ) {\n\t\tvar $this = this;\n\t\tif ( !Global.isSet( ignoreWarning ) ) {\n\t\t\tignoreWarning = false;\n\t\t}\n\t\tthis.setCurrentEditViewState( 'new' );\n\t\tvar record = this.current_edit_record;\n\t\trecord = this.uniformVariable( record );\n\t\tthis.api['set' + this.api.key_name]( record, false, ignoreWarning, {\n\t\t\tonResult: function( result ) {\n\t\t\t\t$this.onSaveAndNewResult( result );\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tonMassEditClick() {\n\n\t\tvar $this = this;\n\t\t$this.is_add = false;\n\t\t$this.is_viewing = false;\n\t\t$this.is_mass_editing = true;\n\t\tLocalCacheData.current_doing_context_action = 'mass_edit';\n\t\t$this.openEditView();\n\t\tvar filter = {};\n\t\tvar grid_selected_id_array = this.getGridSelectIdArray();\n\t\tvar grid_selected_length = grid_selected_id_array.length;\n\t\tthis.mass_edit_record_ids = [];\n\n\t\t$.each( grid_selected_id_array, function( index, value ) {\n\t\t\t$this.mass_edit_record_ids.push( value );\n\t\t} );\n\n\t\tfilter.filter_data = {};\n\t\tfilter.filter_data.id = this.mass_edit_record_ids;\n\n\t\tthis.api['getCommon' + this.api.key_name + 'Data']( filter, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tvar result_data = result.getResult();\n\n\t\t\t\tif ( !result_data ) {\n\t\t\t\t\tresult_data = [];\n\t\t\t\t}\n\n\t\t\t\t$this.api['getOptions']( 'unique_columns', {\n\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\t$this.unique_columns = result.getResult();\n\t\t\t\t\t\t$this.api['getOptions']( 'linked_columns', {\n\t\t\t\t\t\t\tonResult: function( result1 ) {\n\t\t\t\t\t\t\t\t$this.linked_columns = result1.getResult();\n\n\t\t\t\t\t\t\t\tif ( $this.sub_view_mode && $this.parent_key ) {\n\t\t\t\t\t\t\t\t\tresult_data[$this.parent_key] = $this.parent_value;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t$this.current_edit_record = result_data;\n\t\t\t\t\t\t\t\t$this.initEditView();\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tonSaveAndContinue( ignoreWarning ) {\n\t\tvar $this = this;\n\t\tif ( !Global.isSet( ignoreWarning ) ) {\n\t\t\tignoreWarning = false;\n\t\t}\n\t\tthis.is_changed = false;\n\t\tLocalCacheData.current_doing_context_action = 'save_and_continue';\n\n\t\tif ( this.isMassAdding() ) {\n\n\t\t\tif ( this.current_edit_record.punch_dates && this.current_edit_record.punch_dates.length === 1 ) {\n\t\t\t\tthis.current_edit_record.punch_date = this.current_edit_record.punch_dates[0];\n\t\t\t}\n\n\t\t\tif ( this.current_edit_record.user_id && this.current_edit_record.user_id.length === 1 ) {\n\t\t\t\tthis.current_edit_record.user_id = this.current_edit_record.user_id[0];\n\t\t\t}\n\n\t\t}\n\n\t\tthis.current_edit_record = this.uniformVariable( this.current_edit_record );\n\n\t\tthis.api['set' + this.api.key_name]( this.current_edit_record, false, ignoreWarning, {\n\t\t\tonResult: function( result ) {\n\t\t\t\t$this.onSaveAndContinueResult( result );\n\t\t\t}\n\t\t} );\n\t}\n\n\tonFormItemChange( target, doNotValidate ) {\n\n\t\tvar $this = this;\n\t\tthis.setIsChanged( target );\n\t\tthis.setMassEditingFieldsWhenFormChange( target );\n\t\tvar key = target.getField();\n\n\t\tvar c_value = target.getValue();\n\n\t\tthis.current_edit_record[key] = c_value;\n\n\t\tswitch ( key ) {\n\t\t\tcase 'user_id':\n\t\t\t\tthis.setEditMenu();\n\t\t\t\tbreak;\n\t\t\tcase 'punch_date':\n\t\t\t\tthis.current_edit_record.punch_dates = [c_value];\n\t\t\t\tbreak;\n\t\t\tcase 'punch_dates':\n\t\t\t\tthis.setEditMenu();\n\t\t\t\tbreak;\n\t\t\tcase 'transfer':\n\t\t\t\tthis.onTransferChanged();\n\t\t\t\tbreak;\n\t\t\tcase 'job_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.edit_view_ui_dic['job_quick_search'].setValue( target.getValue( true ) ? ( target.getValue( true ).manual_id ? target.getValue( true ).manual_id : '' ) : '' );\n\t\t\t\t\tthis.setJobItemValueWhenJobChanged( target.getValue( true ), 'job_item_id', {\n\t\t\t\t\t\tstatus_id: 10,\n\t\t\t\t\t\tjob_id: this.current_edit_record.job_id\n\t\t\t\t\t} );\n\t\t\t\t\tthis.edit_view_ui_dic['job_quick_search'].setCheckBox( true );\n\t\t\t\t\tthis.setPunchTagValuesWhenCriteriaChanged( this.getPunchTagFilterData(), 'punch_tag_id' );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'job_item_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.edit_view_ui_dic['job_item_quick_search'].setValue( target.getValue( true ) ? ( target.getValue( true ).manual_id ? target.getValue( true ).manual_id : '' ) : '' );\n\t\t\t\t\tthis.edit_view_ui_dic['job_item_quick_search'].setCheckBox( true );\n\t\t\t\t\tthis.setPunchTagValuesWhenCriteriaChanged( this.getPunchTagFilterData(), 'punch_tag_id' );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'punch_tag_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tif ( c_value !== TTUUID.zero_id && c_value !== false && c_value.length > 0 ) {\n\t\t\t\t\t\tthis.setPunchTagQuickSearchManualIds( target.getSelectItems() );\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.edit_view_ui_dic['punch_tag_quick_search'].setValue( '' );\n\t\t\t\t\t}\n\t\t\t\t\t$this.previous_punch_tag_selection = c_value;\n\t\t\t\t\t//Reset source data to make sure correct punch tags are always shown.\n\t\t\t\t\tthis.edit_view_ui_dic['punch_tag_id'].setSourceData( null );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'user_id':\n\t\t\tcase 'branch_id':\n\t\t\tcase 'department_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.setPunchTagValuesWhenCriteriaChanged( this.getPunchTagFilterData(), 'punch_tag_id' );\n\t\t\t\t\tthis.setJobValueWhenCriteriaChanged( 'job_id', {\n\t\t\t\t\t\tstatus_id: 10,\n\t\t\t\t\t\tuser_id: this.current_edit_record.user_id,\n\t\t\t\t\t\tpunch_branch_id: this.current_edit_record.branch_id,\n\t\t\t\t\t\tpunch_department_id: this.current_edit_record.department_id\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'job_quick_search':\n\t\t\tcase 'job_item_quick_search':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.onJobQuickSearch( key, c_value );\n\t\t\t\t\tthis.setPunchTagValuesWhenCriteriaChanged( this.getPunchTagFilterData(), 'punch_tag_id' );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'punch_tag_quick_search':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.onPunchTagQuickSearch( c_value, this.getPunchTagFilterData(), 'punch_tag_id' );\n\n\t\t\t\t\t//Don't validate immediately as onPunchTagQuickSearch is doing async API calls, and it would cause a guaranteed validation failure.\n\t\t\t\t\tdoNotValidate = true;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthis.current_edit_record[key] = c_value;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif ( !doNotValidate ) {\n\t\t\tthis.validate();\n\t\t}\n\t}\n\n\tonMapSaveClick( dataset, successCallback ) {\n\t\tthis.savePunchPosition( dataset, successCallback );\n\t}\n\n\tsavePunchPosition( moved_unsaved_markers, successCallback ) {\n\t\tif ( !moved_unsaved_markers || moved_unsaved_markers.length !== 1 ) {\n\t\t\tDebug.Text( 'ERROR: Invalid params/data passed to function.', 'PunchesViewController.js', 'PunchesViewController', 'savePunchPosition', 1 );\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( this.is_mass_editing == true ) {\n\t\t\tthis.location_mass_edit_check_box.find( '.mass-edit-checkbox' )[0].checked = true;\n\t\t}\n\n\t\t// Regardless of record type, we want to just pass the value back, rather than a api save from map, then another save from parent view.\n\t\t// Map info will only be saved if user clicks save on the parent edit view.\n\t\tthis.setLocationValue( moved_unsaved_markers[0] );\n\t\tsuccessCallback();\n\t\tthis.is_changed = true;\n\t\treturn true;\n\t}\n\n\tgetSelectEmployee( full_item ) {\n\t\tvar user;\n\t\tif ( full_item ) {\n\t\t\tuser = LocalCacheData.getLoginUser();\n\t\t} else {\n\t\t\tuser = LocalCacheData.getLoginUser().id;\n\t\t}\n\t\treturn user;\n\t}\n\n\tgetFilterColumnsFromDisplayColumns( column_filter, enable_system_columns ) {\n\t\tif ( column_filter == undefined ) {\n\t\t\tcolumn_filter = {};\n\t\t}\n\t\tcolumn_filter.latitude = true;\n\t\tcolumn_filter.longitude = true;\n\t\treturn this._getFilterColumnsFromDisplayColumns( column_filter, enable_system_columns );\n\t}\n\n\tisMassAdding() {\n\t\tif ( this.current_edit_record && ( Array.isArray( this.current_edit_record.user_id ) === true\n\t\t\t|| ( Array.isArray( this.current_edit_record.punch_dates ) === true && this.current_edit_record.punch_dates.length > 1 ) ) ) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n}\n"],"file":"v16.12.9/PunchesViewController-BEFzLKXZ.bundle.js"}