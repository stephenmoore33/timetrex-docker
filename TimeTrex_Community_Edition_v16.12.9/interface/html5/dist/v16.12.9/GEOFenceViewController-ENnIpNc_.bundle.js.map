{"version":3,"file":"GEOFenceViewController-ENnIpNc_.bundle.js","sources":["../../views/company/geo_fence/GEOFenceViewController.js"],"sourcesContent":["import '@/global/widgets/color-picker/TColorPicker';\nimport { TTMapHelper } from '@/framework/leaflet/leaflet-timetrex';\n// Note: If markers are ever used in GeoFence Editor/Viewer, then see image fix in leaflet-timetrex. https://github.com/Leaflet/Leaflet/issues/4968\n\nexport class GEOFenceViewController extends BaseViewController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tel: '#geo_fence_view_container',\n\n\t\t\ttype_array: null,\n\n\t\t\tcompany_api: null,\n\t\t\tdrawControl: null,\n\t\t\tbounds: null,\n\t\t\tdrawnItems: null,\n\t\t\tsearch_key_delay: 0,\n\t\t\tstart_coordinates: null,\n\t\t\tmap_html_id: null\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinit() {\n\t\t//this._super('initialize' );\n\t\tthis.edit_view_tpl = 'GEOFenceEditView.html';\n\t\tthis.permission_id = 'geo_fence';\n\t\tthis.viewId = 'GEOFence';\n\t\tthis.script_name = 'GEOFenceView';\n\t\tthis.table_name_key = 'geo_fence';\n\t\tthis.context_menu_name = $.i18n._( 'GEO Fence' );\n\t\tthis.navigation_label = $.i18n._( 'GEO Fence' );\n\t\tthis.api = TTAPI.APIGEOFence;\n\t\tthis.company_api = TTAPI.APICompany;\n\n\t\tif ( this.map ) {\n\t\t\tdelete ( this.map );\n\t\t}\n\n\t\tthis.render();\n\t\tthis.buildContextMenu();\n\t\tthis.initData();\n\t}\n\n\tgetCustomContextMenuModel() {\n\t\tvar context_menu_model = {\n\t\t\tgroups: {\n\t\t\t\tmap: {\n\t\t\t\t\tlabel: $.i18n._( 'Map' ),\n\t\t\t\t\tid: this.viewId + 'Navigation'\n\t\t\t\t}\n\t\t\t},\n\t\t\texclude: ['export_excel', 'mass_edit'],\n\t\t\tinclude: [{\n\t\t\t\tlabel: $.i18n._( 'Map' ),\n\t\t\t\tid: 'map',\n\t\t\t\tmenu_align: 'right',\n\t\t\t\tgroup: 'map',\n\t\t\t\tvue_icon: 'tticon tticon-map_black_24dp',\n\t\t\t\tsort_order: 8000,\n\t\t\t}]\n\t\t};\n\n\t\treturn context_menu_model;\n\t}\n\n\tonCustomContextClick( id ) {\n\t\tswitch ( id ) {\n\t\t\tcase 'map':\n\t\t\t\tthis.onMapClick();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tonSaveAndContinueClick() {\n\t\tsuper.onSaveAndContinueClick();\n\t}\n\n\tonMapClick() {\n\t\t// only trigger map load in specific product editions.\n\t\tif ( ( Global.getProductEdition() >= 15 ) ) {\n\t\t\tvar geo_fences;\n\t\t\tif ( this.edit_view ) {\n\t\t\t\tgeo_fences = [this.current_edit_record];\n\t\t\t} else if ( this.getGridSelectIdArray().length > 0 ) {\n\t\t\t\tgeo_fences = this.getSelectedItems();\n\t\t\t} else {\n\t\t\t\tgeo_fences = this.grid.getGridParam( 'data' );\n\t\t\t}\n\t\t\t// Currently not doing pre-processing for geofences, handling this directly in MapViewController\n\t\t\t// var processed_data_for_map = TTMapLib.TTConvertMapData.processBasicFromGenericViewController(geo_fences);\n\t\t\tIndexViewController.openEditView( this, 'Map', geo_fences );\n\t\t}\n\t}\n\n\tonAddClick() {\n\t\tTTPromise.add( 'init', 'init' );\n\t\tsuper.onAddClick();\n\n\t\tvar $this = this;\n\t\tTTPromise.wait( 'init', 'init', function() {\n\n\t\t\t// Clear the old record to prevent duplication on inserting an empty geofence record. See #2131\n\t\t\t$this._selectedShape = false;\n\t\t\t$this.current_edit_record = {};\n\t\t\tfor ( var key in $this.edit_view_ui_dic ) {\n\t\t\t\t$this.edit_view_ui_dic[key].setValue( '' );\n\t\t\t}\n\n\t\t\tif ( !$this.map_control ) {\n\t\t\t\t$this._initLeafletMap();\n\t\t\t}\n\n\t\t\t$this.map_control.setView( $this.start_coordinates, 10 );\n\t\t} );\n\t}\n\n\tgetFilterColumnsFromDisplayColumns() {\n\t\tvar column_filter = {};\n\t\tcolumn_filter.is_owner = true;\n\t\tcolumn_filter.id = true;\n\t\tcolumn_filter.is_child = true;\n\t\tcolumn_filter.in_use = true;\n\t\tcolumn_filter.first_name = true;\n\t\tcolumn_filter.last_name = true;\n\t\tcolumn_filter.geo_circle = true;\n\t\tcolumn_filter.geo_color = true;\n\t\tcolumn_filter.geo_polygon = true;\n\t\tcolumn_filter.geo_type_id = true;\n\n\t\t// Error: Unable to get property 'getGridParam' of undefined or null reference\n\t\tvar display_columns = [];\n\t\tif ( this.grid ) {\n\t\t\tdisplay_columns = this.grid.getGridParam( 'colModel' );\n\t\t}\n\t\t//Fixed possible exception -- Error: Unable to get property 'length' of undefined or null reference in /interface/html5/views/BaseViewController.js?v=7.4.3-20140924-090129 line 5031\n\t\tif ( display_columns ) {\n\t\t\tvar len = display_columns.length;\n\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\tvar column_info = display_columns[i];\n\t\t\t\tcolumn_filter[column_info.name] = true;\n\t\t\t}\n\t\t}\n\n\t\treturn column_filter;\n\t}\n\n\tbuildEditViewUI() {\n\n\t\tsuper.buildEditViewUI();\n\t\tvar $this = this;\n\n\t\tvar tab_model = {\n\t\t\t'tab_geo_fence': {\n\t\t\t\t'label': $.i18n._( 'GEO Fence' ),\n\t\t\t\t'html_template': this.getGeoFenceTabHtml()\n\t\t\t},\n\t\t\t'tab_audit': true,\n\t\t};\n\t\tthis.setTabModel( tab_model );\n\n\t\tvar form_item_input;\n\n\t\tthis.navigation.AComboBox( {\n\t\t\tapi_class: TTAPI.APIGEOFence,\n\t\t\tid: this.script_name + '_navigation',\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_geo_fence',\n\t\t\tnavigation_mode: true,\n\t\t\tshow_search_inputs: true\n\t\t} );\n\n\t\tthis.setNavigation();\n\n\t\t//Tab 0 start\n\n\t\tvar tab_geo_fence = this.edit_view_tab.find( '#tab_geo_fence' );\n\n\t\tvar tab_geo_fence_column1 = tab_geo_fence.find( '.first-column' );\n\n\t\tthis.edit_view_tabs[0] = [];\n\n\t\tthis.edit_view_tabs[0].push( tab_geo_fence_column1 );\n\n\t\t// Name\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\n\t\tform_item_input.TTextInput( { field: 'name', width: '100%' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Name' ), form_item_input, tab_geo_fence_column1 );\n\t\tform_item_input.parent().width( '45%' );\n\n\t\t//Color\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COLOR_PICKER );\n\t\tform_item_input.TColorPicker( { field: 'geo_color' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Color' ), form_item_input, tab_geo_fence_column1 );\n\n\t\t// Description\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\n\t\tform_item_input.TTextInput( { field: 'description', width: '100%' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Description' ), form_item_input, tab_geo_fence_column1 );\n\n\t\tform_item_input.parent().width( '45%' );\n\n\t\tthis._initLeafletMap();\n\t}\n\n\t_initLeafletMap() {\n\t\tthis.neeed_save_punches_dic = {};\n\t\tthis.layers = [];\n\t\tthis.line_layers = [];\n\t\tthis.circle_layers = [];\n\t\tthis.directions_displays = [];\n\t\tthis.info_panel_dic = {};\n\t\tthis.geo_layers = [];\n\t\t//init map\n\n\t\tif ( !this.map_control || this.map_control == undefined || $( '#tab_geo_fence:visible #map_container div.google-map' )[0] == undefined ) {\n\n\t\t\tvar layers;\n\t\t\tvar map_layers;\n\t\t\tif ( APIGlobal.pre_login_data.map_provider && APIGlobal.pre_login_data.map_provider == 'mapbox' ) {\n\t\t\t\tvar osmUrl = 'https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}';\n\t\t\t\tvar osmAttrib = '© <a href=\"https://www.mapbox.com/about/maps/\">Mapbox</a> © <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> <strong><a href=\"https://www.mapbox.com/map-feedback/\" target=\"_blank\">Improve this map</a></strong>';\n\n\t\t\t\tlayers = [ L.tileLayer( osmUrl, { attribution: osmAttrib, tileSize: 512, maxZoom: 18, zoomOffset: -1, id: 'mapbox/streets-v11', accessToken: APIGlobal.pre_login_data.map_api_key }), ]; //Street Maps\n\t\t\t\tmap_layers = { 'Streets': layers[0], 'Satellite': L.tileLayer( osmUrl, { attribution: osmAttrib, tileSize: 512, maxZoom: 18, zoomOffset: -1, id: 'mapbox/satellite-streets-v11', accessToken: APIGlobal.pre_login_data.map_api_key }) }; //Street+Satellite\n\t\t\t} else {\n\t\t\t\tvar osmUrl = APIGlobal.pre_login_data.map_tile_url + '/{z}/{x}/{y}.png?tt_key=' + APIGlobal.pre_login_data.registration_key;\n\t\t\t\tvar osmAttrib = 'Map data by ©<a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>.';\n\n\t\t\t\tlayers = [ new L.TileLayer( osmUrl, { minZoom: 3, maxZoom: 18, attribution: osmAttrib, noWrap: true } ) ];\n\t\t\t}\n\n\t\t\t//Avoid map is already initialized js exception by dynamically attaching the map element.\n\t\t\t// if (this.map_html_id && $('#' + this.map_html_id).length > 0) {\n\t\t\t// \t$( '#tab_geo_fence:visible #map_container #' + this.map_html_id ).off();\n\t\t\t// \tDebug.Text('Removed Lmap id: ' + this.map_html_id, 'GEOFenceViewController.js', 'GEOFenceViewController', '_initLeafletMap', 10);\n\t\t\t// }\n\n\t\t\tthis.map_html_id = 'map_' + ( new Date() ).getTime();\n\t\t\tDebug.Text( 'New Lmap id: ' + this.map_html_id, 'GEOFenceViewController.js', 'GEOFenceViewController', '_initLeafletMap', 10 );\n\n\t\t\t//append the map element, use then to ensure it's complete before initiallizing the map.\n\t\t\t$( '#tab_geo_fence:visible #map_container' ).html( '<div id=\"' + this.map_html_id + '\" class=\"google-map\"></div>' );\n\t\t\tthis.map_control = L.map( this.map_html_id, { layers: layers, minZoom: 2 } );\n\n\t\t\tDebug.Arr( this.map_control, 'Lmap var', 'GEOFenceViewController.js', 'GEOFenceViewController', '_initLeafletMap', 10 );\n\n\t\t\tif ( map_layers ) { //Add any Street/Satellite layers to the map if they are specified.\n\t\t\t\tL.control.layers( map_layers ).addTo( this.map_control );\n\t\t\t}\n\t\t}\n\n\t\tlayers[0].on( 'load', function() {\n\t\t\tTTPromise.resolve( 'Map', 'render' );\n\t\t} );\n\n\t\t//this.map_control.addLayer( layers[0] );\n\n\t\tthis.start_coordinates = this.startMapCoordinates();\n\n\t\tthis.map_control.setView( this.start_coordinates, 10 );\n\n\t\tthis.drawnItems = new L.FeatureGroup();\n\t\tthis.drawnItems.do_not_clear = true;\n\t\tthis.map_control.addLayer( this.drawnItems );\n\n\t\tthis.drawControl = new L.Control.Draw( {\n\t\t\tedit: {\n\t\t\t\tfeatureGroup: this.drawnItems,\n\t\t\t\tedit: false,\n\t\t\t\tremove: false\n\t\t\t},\n\t\t\tdraw: {\n\t\t\t\tpolygon: {\n\t\t\t\t\tshapeOptions: { color: '#0F820F' }\n\t\t\t\t},\n\t\t\t\tcircle: {\n\t\t\t\t\tshapeOptions: { color: '#0F820F' }\n\t\t\t\t},\n\t\t\t\tpolyline: false,\n\t\t\t\trectangle: false,\n\t\t\t\tmarker: false,\n\t\t\t\tcirclemarker: false\n\t\t\t}\n\t\t} );\n\n\t\tthis.map_control.addControl( this.drawControl );\n\n\t\tvar $this = this;\n\t\tthis.map_control.on( L.Draw.Event.DRAWSTART, function( e ) {\n\t\t\t$this.removeAllLayers();\n\t\t} );\n\n\t\tthis.map_control.on( L.Draw.Event.CREATED, function( e ) {\n\t\t\tvar type = e.layerType,\n\t\t\t\tnew_layer = e.layer;\n\t\t\tnew_layer.editable = true;\n\t\t\tnew_layer.removable = true;\n\n\t\t\t$this.removeAllLayers();\n\t\t\t$this._selectedShape = new_layer;\n\t\t\t$this.drawnItems.addLayer( new_layer );\n\t\t\tnew_layer.editing.enable();\n\t\t\t$this.is_changed = true;\n\t\t\t$this.setEditMenu();\n\t\t\t$this.validate();\n\t\t} );\n\n\t\tthis._initSearchBox();\n\n\t\t//Issue #3442 - Since switching to Vite all our JavaScript code is now ran as a module. Leaflet draw has undefined variables that throw exceptions now that strict mode is on for the file.\n\t\t//This suggested fix comes from https://stackoverflow.com/questions/47720555/can-not-adjust-radius-in-leaflet-draw as leaflet draw itself is an abandoned project, no update will be made to fix these problems in the repository.\n\t\tL.Edit.Circle = L.Edit.CircleMarker.extend( {\n\t\t\t_createResizeMarker: function() {\n\t\t\t\tvar center = this._shape.getLatLng(),\n\t\t\t\t\tresizemarkerPoint = this._getResizeMarkerPoint( center );\n\n\t\t\t\tthis._resizeMarkers = [];\n\t\t\t\tthis._resizeMarkers.push( this._createMarker( resizemarkerPoint, this.options.resizeIcon ) );\n\t\t\t},\n\n\t\t\t_getResizeMarkerPoint: function( latlng ) {\n\t\t\t\tvar delta = this._shape._radius * Math.cos( Math.PI / 4 ),\n\t\t\t\t\tpoint = this._map.project( latlng );\n\t\t\t\treturn this._map.unproject( [point.x + delta, point.y - delta] );\n\t\t\t},\n\n\t\t\t_resize: function( latlng ) {\n\t\t\t\tvar moveLatLng = this._moveMarker.getLatLng();\n\t\t\t\tvar radius;\n\n\t\t\t\tif ( L.GeometryUtil.isVersion07x() ) {\n\t\t\t\t\tradius = moveLatLng.distanceTo( latlng );\n\t\t\t\t} else {\n\t\t\t\t\tradius = this._map.distance( moveLatLng, latlng );\n\t\t\t\t}\n\n\t\t\t\t// **** This fixes the cicle resizing ****\n\t\t\t\tthis._shape.setRadius( radius );\n\n\t\t\t\tthis._map.fire( L.Draw.Event.EDITRESIZE, { layer: this._shape } );\n\t\t\t}\n\t\t} );\n\t}\n\n\t_onShapeUpdate( e ) {\n\t\tvar edit_layer = e.target;\n\t\tedit_layer.editable = true;\n\t\tedit_layer.removable = true;\n\t\tthis._selectedShape = edit_layer;\n\t\tthis.drawnItems.addLayer( edit_layer );\n\t\tedit_layer.editing.enable();\n\t\tthis.is_changed = true;\n\t\tthis.setEditMenu();\n\t}\n\n\tremoveAllLayers() {\n\t\tfor ( var layer in this.drawnItems._layers ) {\n\t\t\tif ( this.drawnItems._layers[layer].removable == true ) {\n\t\t\t\ttry { //try needed for intermittent low-level non-blocking error when users navigate faster than leaflet can draw\n\t\t\t\t\tthis.drawnItems.removeLayer( this.drawnItems._layers[layer] );\n\t\t\t\t} catch ( e ) {\n\t\t\t\t\tDebug.Text( e.message, 'GeoFenceController.js', 'GeoFenceController', 'GeoFenceController', 10 );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tonFormItemChange( target, doNotValidate ) {\n\t\tsuper.onFormItemChange( target, doNotValidate );\n\t\tvar key = target.getField();\n\t\tif ( key == 'geo_color' ) {\n\t\t\tthis.drawControl.options.draw.polygon.shapeOptions.color = this.edit_view_ui_dic[key].val();\n\t\t\tthis.drawControl.options.draw.circle.shapeOptions.color = this.edit_view_ui_dic[key].val();\n\n\t\t\tfor ( var layer in this.drawnItems._layers ) {\n\t\t\t\tif ( this.drawnItems._layers[layer].is_search_marker === undefined ) { // Only change the colours for layers that are not a search marker. Otherwise this will result in an error when changing colours after a search.\n\t\t\t\t\tthis.drawnItems._layers[layer].setStyle( {\n\t\t\t\t\t\tfillColor: this.edit_view_ui_dic[key].val(),\n\t\t\t\t\t\tcolor: this.edit_view_ui_dic[key].val()\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t_initSearchBox() {\n\t\tvar $this = this;\n\t\t$( '#pac-input' ).bind( 'focus', function( e ) {\n\t\t\t$( this ).select();\n\t\t} );\n\n\t\t$( '#pac-input' ).bind( 'keyup', function( e ) {\n\t\t\tif ( e.keyCode == 13 ) {\n\t\t\t\t$( '#suggestion-box div' ).first().click();\n\t\t\t} else {\n\t\t\t\t$this.search_key_delay = parseInt( Date.now() );\n\t\t\t\twindow.setTimeout( function() {\n\t\t\t\t\tif ( parseInt( Date.now() ) - $this.search_key_delay >= 250 ) {\n\t\t\t\t\t\t$this.stop_suggestions = false;\n\t\t\t\t\t\tTTMapHelper.searchSuggest( $this, true );\n\t\t\t\t\t}\n\t\t\t\t}, 300 );\n\t\t\t}\n\t\t} );\n\t}\n\n\tsaveLayout() {\n\t\tvar $this = this;\n\t\tthis.user_generic_data_api.setUserGenericData( this.select_layout, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tif ( result && result.isValid() ) {\n\t\t\t\t\tvar result_data = result.getResult();\n\t\t\t\t\tif ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) {\n\t\t\t\t\t\t$this.select_layout.id = result_data;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t}\n\n\tcenterMap() {\n\t\tthis.map_control.panTo( this.start_coordinates );\n\t}\n\n\tuniformVariable( record ) {\n\t\trecord.geo_circle = false;\n\t\trecord.geo_type_id = 10; // default to circle prevent \"Incorrect GEO type\" exception triggered.\n\t\trecord.map_level = false;\n\t\tif ( this._selectedShape && this._selectedShape._radius != undefined ) {\n\t\t\trecord.geo_circle = {};\n\t\t\trecord.geo_circle.center = [this._selectedShape.getLatLng().lat, this._selectedShape.getLatLng().lng];\n\t\t\trecord.geo_circle.radius = this._selectedShape._mRadius;\n\t\t\trecord.geo_type_id = 20;\n\t\t\trecord.map_level = this.map_control.getZoom();\n\t\t} else if ( this._selectedShape ) {\n\t\t\tvar latlngs = this._selectedShape.getLatLngs()[0]; //getPaths().getAt( 0 ).getArray();\n\t\t\tvar array = [];\n\t\t\tfor ( var i = 0; i < latlngs.length; i++ ) {\n\t\t\t\tarray.push( [latlngs[i].lat, latlngs[i].lng] );\n\t\t\t}\n\t\t\trecord.geo_polygon = array;\n\t\t\trecord.geo_type_id = 10;\n\t\t\trecord.map_level = this.map_control.getZoom();\n\t\t}\n\t\treturn record;\n\t}\n\n\tsetCurrentEditRecordData() {\n\t\tvar $this = this;\n\t\tthis.user_generic_data_api.getUserGenericData( { filter_data: { script: 'MapView', deleted: false } }, {\n\t\t\tonResult: function( results ) {\n\t\t\t\tvar result_data = results.getResult();\n\t\t\t\tif ( result_data && result_data.length > 0 ) {\n\t\t\t\t\t$this.select_layout = result_data[0];\n\t\t\t\t} else {\n\t\t\t\t\t$this.select_layout = {\n\t\t\t\t\t\tscript: 'MapView',\n\t\t\t\t\t\tis_default: false,\n\t\t\t\t\t\tname: Global.default_item,\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tmarker_connection_type: 'LINE'\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\t//Set current edit record data to all widgets\n\t\t\t\t//$this._selectedShape && $this._deleteSelectShape();\n\t\t\t\tfor ( var key in $this.current_edit_record ) {\n\t\t\t\t\tif ( !$this.current_edit_record.hasOwnProperty( key ) ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tvar widget = $this.edit_view_ui_dic[key];\n\t\t\t\t\tif ( Global.isSet( widget ) ) {\n\t\t\t\t\t\tswitch ( key ) {\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\twidget.setValue( $this.current_edit_record[key] );\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( $this.drawnItems ) {\n\t\t\t\t\t$this.removeAllLayers();\n\t\t\t\t}\n\n\t\t\t\t$this.bounds = new L.LatLngBounds();\n\t\t\t\tif ( $this.current_edit_record.geo_type_id == 20 && $this.current_edit_record.geo_circle ) {\n\t\t\t\t\t$this._drawCircle( $this.current_edit_record.geo_circle );\n\t\t\t\t} else if ( $this.current_edit_record.geo_type_id == 10 && $this.current_edit_record.geo_polygon ) {\n\t\t\t\t\t$this._drawPolygon( $this.current_edit_record.geo_polygon );\n\t\t\t\t} else {\n\t\t\t\t\t$this.centerMap();\n\t\t\t\t}\n\n\t\t\t\t$this.current_edit_record.map_level = $this.map_control.getZoom();\n\n\t\t\t\t$this.collectUIDataToCurrentEditRecord();\n\t\t\t\t$this.setEditViewDataDone();\n\t\t\t}\n\t\t} );\n\t}\n\n\t_drawCircle( geo_circle ) {\n\t\tDebug.Text( 'drawing circle', 'GEOFenceViewController.js', 'GEOFenceViewController', '_drawCircle', 10 );\n\t\tvar layer = new L.Circle( [parseFloat( geo_circle.center[0] ), parseFloat( geo_circle.center[1] )], parseFloat( geo_circle.radius ), {\n\t\t\tstroke: true,\n\t\t\tfill: true,\n\t\t\topacity: 0.8,\n\t\t\tweight: 2,\n\t\t\tcolor: this.current_edit_record.geo_color ? '#' + this.current_edit_record.geo_color : '#0F820F',\n\t\t\tfillOpacity: 0.25,\n\t\t\tfillColor: this.current_edit_record.geo_color ? '#' + this.current_edit_record.geo_color : '#0F820F'\n\t\t} );\n\t\tlayer.removable = true;\n\t\tlayer.addTo( this.drawnItems );//.bindPopup(this.current_edit_record.name,{closeButton:false, className:'polypopup'}).openPopup();\n\n\t\tif ( this.is_edit ) {\n\t\t\tlayer.editing.enable();\n\t\t} else {\n\t\t\tlayer.editing.disable();\n\t\t}\n\n\t\tthis.map_control.fitBounds( layer.getBounds(), { padding: [20, 20] } );\n\t\tthis.geo_layers.push( layer );\n\t\tvar $this = this;\n\n\t\tlayer.on( 'edit', function( e ) {\n\t\t\t$this._onShapeUpdate( e );\n\t\t} );\n\t}\n\n\t_drawPolygon( triangleCoords ) {\n\t\tDebug.Text( 'drawing polygon', 'GEOFenceViewController.js', 'GEOFenceViewController', '_drawPolygon', 10 );\n\t\tvar latlngs = _.map( triangleCoords, function( item ) {\n\t\t\treturn { lat: parseFloat( item[0] ), lng: parseFloat( item[1] ) };\n\t\t} );\n\n\t\tvar layer = new L.Polygon( triangleCoords, {\n\t\t\tstroke: true,\n\t\t\tfill: true,\n\t\t\topacity: 0.8,\n\t\t\tweight: 2,\n\t\t\tcolor: this.current_edit_record.geo_color ? '#' + this.current_edit_record.geo_color : '#0F820F',\n\t\t\tfillOpacity: 0.25,\n\t\t\tfillColor: this.current_edit_record.geo_color ? '#' + this.current_edit_record.geo_color : '#0F820F'\n\t\t} );\n\t\tlayer.removable = true;\n\n\t\tif ( this.is_edit ) {\n\t\t\tlayer.editing.enable();\n\t\t} else {\n\t\t\tlayer.editing.disable();\n\t\t}\n\n\t\tlayer.addTo( this.drawnItems );//.bindPopup(this.current_edit_record.name,{closeButton:false, className:'polypopup'}).openPopup();\n\n\t\tthis.map_control.fitBounds( layer.getBounds(), { padding: [20, 20] } );\n\t\tthis.geo_layers.push( layer );\n\t\tvar $this = this;\n\n\t\tlayer.on( 'edit', function( e ) {\n\t\t\t$this._onShapeUpdate( e );\n\t\t} );\n\t}\n\n\tbuildSearchFields() {\n\n\t\tsuper.buildSearchFields();\n\t\tthis.search_fields = [\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Name' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'name',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tform_item_type: FormItemType.TEXT_INPUT\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Created By' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'created_by',\n\t\t\t\tlayout_name: 'global_user',\n\t\t\t\tapi_class: TTAPI.APIUser,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tscript_name: 'EmployeeView',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Updated By' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'updated_by',\n\t\t\t\tlayout_name: 'global_user',\n\t\t\t\tapi_class: TTAPI.APIUser,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tscript_name: 'EmployeeView',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} )\n\n\t\t];\n\t}\n\n\tsetEditMenuMapIcon( context_btn ) {\n\n\t\tif ( Global.getProductEdition() <= 10 ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t}\n\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t}\n\n\tsetDefaultMenuMapIcon( context_btn, grid_selected_length ) {\n\t\tif ( Global.getProductEdition() <= 10 ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t}\n\n\t\tif ( grid_selected_length > 0 ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t} else {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tsetEditViewDataDone() {\n\t\tthis.is_edit = true;\n\t\tsuper.setEditViewDataDone();\n\t\tvar $this = this;\n\t\tTTPromise.wait( null, null, function() {\n\t\t\t//set the color of the polygon at the start\n\t\t\tif ( $this.edit_view_ui_dic.geo_color ) {\n\t\t\t\t$this.drawControl.options.draw.polygon.shapeOptions.color = $this.edit_view_ui_dic.geo_color.val();\n\t\t\t\t$this.drawControl.options.draw.circle.shapeOptions.color = $this.edit_view_ui_dic.geo_color.val();\n\t\t\t}\n\n\t\t} );\n\t}\n\n\tonSaveAndContinue( ignoreWarning ) {\n\t\tthis.removeAllLayers();\n\t\tsuper.onSaveAndContinue();\n\t}\n\n\tsetNavigation() {\n\n\t\tvar $this = this;\n\n\t\t//Error: Unable to get value of the property 'getGridParam': object is null or undefined in /interface/html5/views/BaseViewController.js?v=8.0.0-20141230-103725 line 2575\n\t\tif ( !this.grid ) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.navigation.setPossibleDisplayColumns( this.buildDisplayColumnsByColumnModel( this.grid.grid.getGridParam( 'colModel' ) ),\n\t\t\tthis.buildDisplayColumns( this.default_display_columns ) );\n\n\t\tthis.navigation.unbind( 'formItemChange' ).bind( 'formItemChange', function( e, target ) {\n\n\t\t\tvar key = target.getField();\n\t\t\tvar next_select_item_id = target.getValue();\n\n\t\t\tif ( !next_select_item_id ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( next_select_item_id !== $this.current_edit_record.id ) {\n\t\t\t\tProgressBar.showOverlay();\n\t\t\t\tTTPromise.add( 'Map', 'render' );\n\t\t\t\tif ( $this.is_viewing ) {\n\t\t\t\t\t$this.onViewClick( next_select_item_id ); //Dont refresh UI\n\t\t\t\t} else {\n\t\t\t\t\t$this.onEditClick( next_select_item_id ); //Dont refresh UI\n\t\t\t\t}\n\n\t\t\t}\n\t\t\t//wait for map to render and prevent js exception from moving too fast.\n\t\t\tTTPromise.wait( 'Map', 'render', function() {\n\t\t\t\t$this.setNavigationArrowsEnabled();\n\t\t\t} );\n\n\t\t} );\n\n\t}\n\n\tgetGeoFenceTabHtml() {\n\t\treturn `<div id=\"tab_geo_fence\" class=\"edit-view-tab-outside\" style=\"height: 85%\">\n\t\t\t\t\t<div class=\"edit-view-tab\" id=\"tab_geo_fence_content_div\">\n\t\t\t\t\t\t<div class=\"first-column full-width-column\"></div>\n\t\t\t\t\t\t<input id=\"pac-input\" class=\"controls\" type=\"text\" placeholder=\"Address Search\" autocomplete=\"new-password\"> <!-- Use 'new-password' as it disables auto-complete when 'off' does not -->\n\t\t\t\t\t\t<div id=\"suggestion-box\"></div>\n\t\t\t\t\t\t<div id=\"map_container\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>`;\n\t}\n}"],"names":["GEOFenceViewController","options","_","$","context_menu_model","id","geo_fences","$this","key","column_filter","display_columns","len","column_info","tab_model","form_item_input","tab_geo_fence","tab_geo_fence_column1","layers","map_layers","osmUrl","osmAttrib","e","new_layer","center","resizemarkerPoint","latlng","delta","point","moveLatLng","radius","edit_layer","layer","target","doNotValidate","TTMapHelper","result","result_data","record","latlngs","array","results","widget","geo_circle","triangleCoords","item","context_btn","grid_selected_length","ignoreWarning","next_select_item_id"],"mappings":"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"}