import{_ as m,j as i}from"./vendor-tTApdY0Y.bundle.js";class b extends BaseViewController{constructor(a={}){m.defaults(a,{el:"#find_available_view_container",status_array:null,sex_array:null,user_group_array:null,country_array:null,province_array:null,company_api:null}),super(a)}init(a){this.permission_id="user",this.viewId="FindAvailable",this.script_name="PopUpEmployeeView",this.api=TTAPI.APIScheduleAdvanced,this.company_api=TTAPI.APICompany,i(this.el).css("opacity",0),this.render(),this.initData()}initRightClickMenu(a){}showNoResultCover(a){super.showNoResultCover(!1)}setGridSize(){var a=this;this.grid.setGridWidth(i(this.el).width()),this.grid.setGridColumnsWidth(),this.grid.setGridHeight(this.getAvailableHeightForGrid(this.el)),i(window).off("resize.find_available_grid").on("resize.find_available_grid",function(){i(a.el)&&(a.grid.setGridWidth(i(a.el).width()),a.grid.setGridColumnsWidth(),a.grid.setGridHeight(a.getAvailableHeightForGrid(a.el)))})}search(a,r,_){this.setGridSize(),Global.isSet(a)||(a=!0);var e=this,t={};if(t.filter_data={},t.filter_sort={},t.filter_columns=this.getFilterColumnsFromDisplayColumns(),t.filter_items_per_page=0,this.pager_data)if(LocalCacheData.paging_type===0)r==="next"?t.filter_page=this.pager_data.next_page:t.filter_page=1;else switch(r){case"next":t.filter_page=this.pager_data.next_page;break;case"last":t.filter_page=this.pager_data.previous_page;break;case"start":t.filter_page=1;break;case"end":t.filter_page=this.pager_data.last_page_number;break;case"go_to":t.filter_page=_;break;default:t.filter_page=this.pager_data.current_page;break}else t.filter_page=1;this.sub_view_mode&&this.parent_key&&(this.select_layout.data.filter_data[this.parent_key]=this.parent_value),Global.isSet(this.getSubViewFilter)&&(this.select_layout.data.filter_data=this.getSubViewFilter(this.select_layout.data.filter_data)),t.filter_data=Global.convertLayoutFilterToAPIFilter(this.select_layout),t.filter_sort=this.select_layout.data.filter_sort,TTUUID.isUUID(this.refresh_id)&&(t.filter_data={},t.filter_data.id=[this.refresh_id]),this.api.getScheduleAvailableUsers(t,{onResult:function(o){var l=o.getResult();if(Global.isArray(l)?(e.removeNoResultCover(),Global.isSet(e.__createRowId)&&(l=e.__createRowId(l)),l=Global.formatGridData(l,e.api.key_name)):e.showNoResultCover(),TTUUID.isUUID(e.refresh_id)){e.refresh_id=null;var s=e.grid.getData(),u=s.length;i.type(s)!=="array"&&(s=[]);for(var d=!1,n=l[0],c=0;c<u;c++){var h=s[c];if(h.id==n.id){e.grid.setRowData(n.id,n),d=!0;break}}d||(s.push(n),e.grid.setData(s))}else{if(e.pager_data=o.getPagerData(),LocalCacheData.paging_type!==0&&(e.paging_widget.setPagerData(e.pager_data),e.paging_widget_2.setPagerData(e.pager_data)),LocalCacheData.paging_type===0&&r==="next"){var p=e.grid.getGridParam("data");l=p.concat(l)}e.grid.setData(l)}e.setGridCellBackGround(),ProgressBar.closeOverlay(),a&&e.setDefaultMenu(!0),LocalCacheData.paging_type===0&&(!e.pager_data||e.pager_data.is_last_page?e.paging_widget.css("display","none"):e.paging_widget.css("display","block")),e.autoOpenEditViewIfNecessary(),e.searchDone()}})}searchDone(){i(".button-rotate").removeClass("button-rotate"),this.setTotalDisplaySpan(),this.setGridSize(this.ui_id,this.sub_view_mode,this.sub_view_grid_autosize,this.pager_data),TTPromise.resolve("init","init"),i(this.el).css("opacity",1)}setCurrentViewPosition(){var a=this.search_panel.find(".layout-selector-div"),r=this.search_panel.find("a[ref='saved_layout']").parent(),_=r.offset().left-(Global.bodyWidth()/2-500);a.css("left",_+r.width()+20)}initOptions(a){var r=this,_=TTAPI.APIUser,e=TTAPI.APIUserGroup,t=[{option_name:"status",field_name:null,api:_},{option_name:"sex",field_name:null,api:_},{option_name:"country",field_name:"country",api:this.company_api}];this.initDropDownOptions(t,function(o){e.getUserGroup("",!1,!1,{onResult:function(l){l=l.getResult(),l=Global.buildTreeRecord(l),r.edit_only_mode||!r.sub_view_mode&&r.basic_search_field_ui_dic.group_id&&(r.basic_search_field_ui_dic.group_id.setSourceData(l),r.adv_search_field_ui_dic.group_id.setSourceData(l)),r.user_group_array=l,a&&a(o)}})})}onSetSearchFilterFinished(){if(this.search_panel.getSelectTabIndex()===1){var a=this.adv_search_field_ui_dic.country,r=a.getValue();this.setProvince(r)}}onBuildBasicUIFinished(){this.search_panel.find("div #basic_search")}onBuildAdvUIFinished(){this.adv_search_field_ui_dic.country.change(i.proxy(function(){var a=this.adv_search_field_ui_dic.country,r=a.getValue();this.setProvince(r),this.adv_search_field_ui_dic.province.setValue(null)},this))}setProvince(a,r){var _=this;!a||a==="-1"||a==="0"?(_.province_array=[],this.adv_search_field_ui_dic.province.setSourceData([])):this.company_api.getOptions("province",a,{onResult:function(e){e=e.getResult(),e||(e=[]),_.province_array=Global.buildRecordArray(e),_.adv_search_field_ui_dic.province.setSourceData(_.province_array)}})}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:i.i18n._("Status"),in_column:1,field:"status_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:i.i18n._("First Name"),in_column:1,field:"first_name",basic_search:!0,adv_search:!0,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:i.i18n._("Last Name"),field:"last_name",basic_search:!0,adv_search:!0,in_column:1,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:i.i18n._("Home Phone"),field:"home_phone",basic_search:!1,adv_search:!0,in_column:1,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:i.i18n._("Tags"),field:"tag",basic_search:!0,adv_search:!0,in_column:1,form_item_type:FormItemType.TAG_INPUT}),new SearchField({label:i.i18n._("Employee Number"),field:"employee_number",basic_search:!1,adv_search:!0,in_column:2,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:i.i18n._("Sex"),in_column:2,field:"sex_id",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:i.i18n._("Group"),in_column:2,multiple:!0,field:"group_id",layout_name:"global_tree_column",tree_mode:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:i.i18n._("Default Branch"),in_column:2,field:"default_branch_id",layout_name:"global_branch",api_class:TTAPI.APIBranch,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:i.i18n._("Default Department"),field:"default_department_id",in_column:2,layout_name:"global_department",api_class:TTAPI.APIDepartment,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:i.i18n._("Default Job"),field:"default_job_id",in_column:2,layout_name:"global_job",api_class:Global.getProductEdition()>=20?TTAPI.APIJob:null,multiple:!0,basic_search:!1,adv_search:Global.getProductEdition()>=20,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:i.i18n._("Default Task"),field:"default_job_item_id",in_column:2,layout_name:"global_job_item",api_class:Global.getProductEdition()>=20?TTAPI.APIJobItem:null,multiple:!0,basic_search:!1,adv_search:Global.getProductEdition()>=20,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:i.i18n._("Default Punch Tag"),field:"default_punch_tag_id",in_column:2,layout_name:"global_punch_tag",api_class:Global.getProductEdition()>=20?TTAPI.APIPunchTag:null,multiple:!0,basic_search:!1,adv_search:Global.getProductEdition()>=20,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:i.i18n._("Country"),in_column:1,field:"country",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.COMBO_BOX}),new SearchField({label:i.i18n._("Province/State"),in_column:1,field:"province",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:i.i18n._("City"),field:"city",basic_search:!1,adv_search:!0,in_column:1,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:i.i18n._("Title"),field:"title_id",in_column:2,layout_name:"global_job_title",api_class:TTAPI.APIUserTitle,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:i.i18n._("Min. Time Between Shifts"),field:"minimum_time_between_shift",basic_search:!0,adv_search:!0,in_column:2,form_item_type:FormItemType.TEXT_INPUT})]}}export{b as FindAvailableViewController};
//# sourceMappingURL=FindAvailableViewController-NdKEH7Ik.bundle.js.map
