import{_ as D,j as l}from"./vendor-tTApdY0Y.bundle.js";class f extends BaseWizardController{constructor(t={}){D.defaults(t,{el:".wizard-bg",user_generic_data_api:null,api_user_report:null,numArray:[{label:l.i18n._("Default"),value:0},{label:5,value:5},{label:10,value:10},{label:15,value:15},{label:20,value:20},{label:25,value:25},{label:50,value:50},{label:100,value:100},{label:250,value:250},{label:500,value:500},{label:1e3,value:1e3}]}),super(t)}init(t){this.title=l.i18n._("Dashlet Wizard"),this.steps=2,this.current_step=1,this.user_generic_data_api=TTAPI.APIUserGenericData,this.api_user_report=TTAPI.APIUserReportData,this.render()}render(){super.render(),this.initCurrentStep()}buildCurrentStepUI(){var t=this;this.stepsWidgetDic[this.current_step]={},this.content_div.empty();var e;switch(this.current_step){case 1:var a=this.getLabel();a.text(l.i18n._("Choose the type of dashlet")),this.content_div.append(a),e=this.getComboBox("dashlet_type",!1),e.unbind("formItemChange").bind("formItemChange",function(i,n){t.stepsDataDic[2]=null,t.stepsWidgetDic[2]=null}),e.off("change").on("change",function(i){t.step1ComboboxChanged(l(i.target).val())}),this.content_div.append(e),this.stepsWidgetDic[this.current_step][e.getField()]=e;break;case 2:a=this.getLabel();var p=this.stepsDataDic[1],s,r,d,o;p.dashlet_type=="custom_list"?(a.text(l.i18n._("Choose a list view and layout to display in the dashlet")),this.content_div.append(a),s=l(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html")),r=s.find(".form-item-label"),d=s.find(".form-item-input-div"),e=this.getComboBox("script",!1),e.unbind("formItemChange").bind("formItemChange",function(i,n){t.setLayout(t.getScriptNameByAPIViewKey(n.getValue())),t.setDefaultName(p.dashlet_type)}),r.text(l.i18n._("List View")),d.append(e),this.content_div.append(s),this.stepsWidgetDic[this.current_step][e.getField()]=e,s=l(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html")),r=s.find(".form-item-label"),d=s.find(".form-item-input-div"),o=this.getTextInput("name",!1),r.text(l.i18n._("Dashlet Title")),d.append(o),this.content_div.append(s),this.stepsWidgetDic[this.current_step][o.getField()]=o,s=l(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html")),r=s.find(".form-item-label"),d=s.find(".form-item-input-div"),e=this.getComboBox("layout",!1),e.setValueKey("id"),e.setLabelKey("name"),r.text(l.i18n._("Saved Layout")),d.append(e),this.content_div.append(s),this.stepsWidgetDic[this.current_step][e.getField()]=e,s=l(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html")),r=s.find(".form-item-label"),d=s.find(".form-item-input-div"),e=this.getComboBox("rows_per_page",!1),e.setSourceData(this.numArray),r.text(l.i18n._("Rows per page")),d.append(e),this.content_div.append(s),this.stepsWidgetDic[this.current_step][e.getField()]=e):p.dashlet_type=="custom_report"?(a.text(l.i18n._("Choose a saved report to display in the dashlet")),this.content_div.append(a),s=l(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html")),r=s.find(".form-item-label"),d=s.find(".form-item-input-div"),e=this.getComboBox("report",!1),e.unbind("formItemChange").bind("formItemChange",function(i,n){t.setTemplateSource(),t.stepsWidgetDic[2].template.setValue("saved_report"),t.setSavedReport(),t.setDefaultName(p.dashlet_type)}),r.text(l.i18n._("Report")),d.append(e),this.content_div.append(s),this.stepsWidgetDic[this.current_step][e.getField()]=e,s=l(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html")),r=s.find(".form-item-label"),d=s.find(".form-item-input-div"),e=this.getComboBox("template",!1),r.text(l.i18n._("Template")),d.append(e),this.content_div.append(s),this.stepsWidgetDic[this.current_step][e.getField()]=e,e.unbind("formItemChange").bind("formItemChange",function(i,n){t.setSavedReport()}),s=l(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html")),r=s.find(".form-item-label"),d=s.find(".form-item-input-div"),e=this.getComboBox("saved_report",!1),e.setValueKey("id"),e.setLabelKey("name"),r.text(l.i18n._("Saved Report")),d.append(e),this.content_div.append(s),this.stepsWidgetDic[this.current_step][e.getField()]=e,s=l(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html")),r=s.find(".form-item-label"),d=s.find(".form-item-input-div"),o=this.getTextInput("name",!1),r.text(l.i18n._("Dashlet Title")),d.append(o),this.content_div.append(s),this.stepsWidgetDic[this.current_step][o.getField()]=o):(a.text(l.i18n._("Choose dashlet specific settings")),this.content_div.append(a),s=l(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html")),r=s.find(".form-item-label"),d=s.find(".form-item-input-div"),o=this.getTextInput("name",!1),r.text(l.i18n._("Dashlet Title")),d.append(o),this.content_div.append(s),this.stepsWidgetDic[this.current_step][o.getField()]=o,s=l(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html")),r=s.find(".form-item-label"),d=s.find(".form-item-input-div"),e=this.getComboBox("rows_per_page",!1),e.setSourceData(this.numArray),r.text(l.i18n._("Rows per page")),d.append(e),this.content_div.append(s),this.stepsWidgetDic[this.current_step][e.getField()]=e),s=l(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html")),r=s.find(".form-item-label"),d=s.find(".form-item-input-div"),e=this.getComboBox("auto_refresh",!1),r.text(l.i18n._("Auto Refresh")),d.append(e),this.content_div.append(s),this.stepsWidgetDic[this.current_step][e.getField()]=e;break}}step1ComboboxChanged(t){Global.getProductEdition()<=10&&(t=="custom_list"||t=="custom_report")?(TAlertManager.showAlert(Global.getUpgradeMessage(),l.i18n._("Denied")),Global.setWidgetEnabled(this.next_btn,!1)):Global.setWidgetEnabled(this.next_btn,!0)}setDefaultName(t){var e=this.stepsWidgetDic[2],a=this.stepsWidgetDic[1];t==="custom_list"?e.name.setValue(e.script.getLabel()):t==="custom_report"?e.name.setValue(e.report.getLabel()):e.name.setValue(a.dashlet_type.getLabel())}buildCurrentStepData(){var t=this,e=this.stepsDataDic[this.current_step],a=this.stepsWidgetDic[this.current_step],p=TTAPI.APIDashboard;switch(this.current_step){case 1:p.getOptions("dashlets",{onResult:function(s){var r=Global.buildRecordArray(s.getResult());a.dashlet_type.setSourceData(r),e&&(e.dashlet_type?a.dashlet_type.setValue(e.dashlet_type):e.saved_dashlet_id&&t.user_generic_data_api.getUserGenericData({filter_data:{id:e.saved_dashlet_id,deleted:!1}},{onResult:function(d){Global.isArray(d.getResult())&&d.getResult().length>0&&(e.saved_dashlet=d.getResult()[0],a.dashlet_type.setValue(e.saved_dashlet.data.dashlet_type))}}))}});break;case 2:this.stepsDataDic[1].dashlet_type=="custom_list"?p.getOptions("custom_list",{onResult:function(s){var r=Global.buildRecordArray(s.getResult());a.script.setSourceData(r),e&&e.script?(a.script.setValue(e.script),a.name.setValue(e.name),a.rows_per_page.setValue(e.rows_per_page)):t.stepsDataDic[1].saved_dashlet?(a.script.setValue(t.stepsDataDic[1].saved_dashlet.data.view_name),a.name.setValue(t.stepsDataDic[1].saved_dashlet.name),a.rows_per_page.setValue(t.stepsDataDic[1].saved_dashlet.data.rows_per_page)):(a.script.setValue(r[0]),t.setDefaultName(t.stepsDataDic[1].dashlet_type)),t.setLayout(t.getScriptNameByAPIViewKey(a.script.getValue()),a.layout)}}):this.stepsDataDic[1].dashlet_type=="custom_report"?p.getOptions("custom_report",{onResult:function(s){var r=Global.buildRecordArray(s.getResult());if(r.length===0){Global.setWidgetEnabled(t.done_btn,!1);return}a.report.setSourceData(r),e&&e.report?(a.report.setValue(e.report),a.name.setValue(e.name)):t.stepsDataDic[1].saved_dashlet?(a.report.setValue(t.stepsDataDic[1].saved_dashlet.data.report),a.name.setValue(t.stepsDataDic[1].saved_dashlet.name)):(a.report.setValue(r.value),t.setDefaultName(t.stepsDataDic[1].dashlet_type)),t.setTemplateSource(a.report.getValue()),e&&e.report?a.template.setValue(e.template):t.stepsDataDic[1].saved_dashlet?a.template.setValue(t.stepsDataDic[1].saved_dashlet.data.template):a.template.setValue("saved_report"),t.setSavedReport(a.report.getValue(),a.template.getValue())}}):e?(a.name.setValue(e.name),a.rows_per_page.setValue(e.rows_per_page)):t.stepsDataDic[1].saved_dashlet?(a.name.setValue(t.stepsDataDic[1].saved_dashlet.name),a.rows_per_page.setValue(t.stepsDataDic[1].saved_dashlet.data.rows_per_page)):t.setDefaultName(t.stepsDataDic[1].dashlet_type),p.getOptions("auto_refresh",{onResult:function(s){var r=Global.buildRecordArray(s.getResult());a.auto_refresh.setSourceData(r),e&&e.auto_refresh?a.auto_refresh.setValue(e.auto_refresh):t.stepsDataDic[1].saved_dashlet&&a.auto_refresh.setValue(t.stepsDataDic[1].saved_dashlet.data.auto_refresh)}});break}}setTemplateSource(){var t=this.stepsWidgetDic[2],e=t.report.getValue(),a=t.template,p=TTAPI["API"+e],s=p.getOptions("templates",{async:!1}),r=s.getResult();r=Global.buildRecordArray(r),r.unshift({fullvalue:"saved_report",id:"saved_report",label:"-- "+l.i18n._("Saved Report")+" --",orderValue:0,value:"saved_report"}),a.setSourceData(r)}setSavedReport(){var t=this.stepsDataDic[2],e=this.stepsDataDic[1],a=this.stepsWidgetDic[2],p=a.saved_report,s=a.report.getValue(),r=a.template.getValue();if(r!=="saved_report"){p.hide(),p.parent().parent().hide();return}else p.parent().parent().show(),p.show();this.api_user_report.getUserReportData({filter_data:{script:s}},{onResult:function(d){var o=d.getResult();o&&o.length>0?o.sort(function(i,n){return Global.compare(i,n,"name")}):o=[{fullValue:0,id:0,name:Global.empty_item,label:Global.empty_item,orderValue:0,value:0}],p.setSourceData(o),t&&t.layout?p.setValue(t.layout):e.saved_dashlet&&p.setValue(e.saved_dashlet.data.saved_report)}})}setLayout(t){var e=this.stepsDataDic[2],a=this.stepsDataDic[1],p=this.stepsWidgetDic[2].layout;this.user_generic_data_api.getUserGenericData({filter_data:{script:t,deleted:!1}},{onResult:function(s){var r=s.getResult();r&&r.length>0?r.sort(function(d,o){return Global.compare(d,o,"name")}):r=[{id:0,name:"- "+l.i18n._("Default")+" -"}],p.setSourceData(r),e&&e.layout?p.setValue(e.layout):a.saved_dashlet&&p.setValue(a.saved_dashlet.data.layout_id)}})}getScriptNameByAPIViewKey(t){var e="";switch(t){case"Exception":e="exceptionView";break;case"Request":e="RequestView";break;case"User":e="EmployeeView";break;case"UserExpense":e="UserExpenseView";break;case"Schedule":e="ScheduleShiftView";break;case"Invoice":e="InvoiceView";break;case"Request-Authorization":e="RequestAuthorizationView";break;case"PayPeriodTimeSheetVerify":e="TimeSheetAuthorizationView";break;case"UserExpense-Authorization":e="ExpenseAuthorizationView";break;case"AccrualBalance":e="AccrualBalanceView";break;case"Accrual":e="AccrualView";break;case"RecurringScheduleControl":e="RecurringScheduleControlView";break;case"RecurringScheduleTemplateControl":e="RecurringScheduleTemplateControlView";break;case"Job":e="JobView";break;case"JobItem":e="JobItemView";break;case"UserContact":e="UserContactView";break;case"UserWage":e="WageView";break;case"PayStub":e="PayStubView";break;case"PayStubTransaction":e="PayStubTransactionView";break;case"PayPeriod":e="PayPeriodsView";break;case"PayStubAmendment":e="PayStubAmendmentView";break;case"Client":e="ClientView";break;case"ClientContact":e="ClientContactView";break;case"Transaction":e="InvoiceTransaction";break;case"UserReviewControl":e="UserReviewControlView";break;case"JobVacancy":e="JobVacancyView";break;case"JobApplicant":e="JobApplicantView";break;case"JobApplication":e="JobApplicationView";break}return e}onDoneClick(){var t=this;super.onDoneClick(),this.saveCurrentStep(),this.stepsWidgetDic[2].name.clearErrorStyle();var e=this.stepsDataDic[1].saved_dashlet,a=this.stepsDataDic[1].dashlet_type,p=this.stepsDataDic[2].name,s=this.stepsDataDic[2].auto_refresh,r=this.stepsDataDic[2].rows_per_page,d=200,o=33;a==="custom_report"&&(o=99);var i={};if(!p){this.stepsWidgetDic[2].name.setErrorStyle("Dashlet title can't be empty",!0);return}if(a=="custom_list"){var n=this.stepsDataDic[2].script,g=this.stepsDataDic[2].layout;e?(i=e,i.name=p,i.is_default="false",i.data.dashlet_type=a,i.data.view_name=n,i.data.layout_id=g,i.data.auto_refresh=s,i.data.rows_per_page=r):(i.script="global_dashboard",i.name=p,i.is_default="false",i.data={dashlet_type:a,view_name:n,layout_id:g,auto_refresh:s,height:d,width:o,rows_per_page:r})}else if(a=="custom_report"){var _=this.stepsDataDic[2].report,c=this.stepsDataDic[2].saved_report&&this.stepsDataDic[2].saved_report!=0?this.stepsDataDic[2].saved_report:!1,u=this.stepsDataDic[2].template;if(u==="saved_report"&&!c){TAlertManager.showAlert(l.i18n._("No saved report!"));return}e?(i=e,i.name=p,i.is_default="false",i.data.dashlet_type=a,i.data.report=_,i.data.template=u,i.data.saved_report_id=c,i.data.auto_refresh=s,i.data.rows_per_page=r):(i.script="global_dashboard",i.name=p,i.is_default="false",i.data={dashlet_type:a,report:_,template:u,saved_report_id:c,auto_refresh:s,height:d,width:o})}else e?(i=e,i.name=p,i.is_default="false",i.data.dashlet_type=a,i.data.auto_refresh=s,i.data.rows_per_page=r):(i.script="global_dashboard",i.name=p,i.is_default="false",i.data={dashlet_type:a,auto_refresh:s,rows_per_page:r,height:d,width:o});this.user_generic_data_api.setUserGenericData(i,{onResult:function(h){h&&h.isValid()?(t.onCloseClick(),t.call_back&&t.call_back()):TAlertManager.showErrorAlert(h)}})}saveCurrentStep(){this.stepsDataDic[this.current_step]||(this.stepsDataDic[this.current_step]={});var t=this.stepsDataDic[this.current_step],e=this.stepsWidgetDic[this.current_step];switch(this.current_step){case 1:t.dashlet_type=e.dashlet_type.getValue();break;case 2:var a=this.stepsDataDic[1];a.dashlet_type=="custom_list"?(t.script=e.script.getValue(),t.layout=e.layout.getValue(),t.rows_per_page=e.rows_per_page.getValue(),t.name=e.name.getValue()):a.dashlet_type=="custom_report"?(t.report=e.report.getValue(),t.saved_report=e.saved_report.getValue(),t.name=e.name.getValue(),t.template=e.template.getValue()):(t.name=e.name.getValue(),t.rows_per_page=e.rows_per_page.getValue()),t.auto_refresh=e.auto_refresh.getValue();break}}getProperDashletName(t){var e=t.dashlet_type,a="";switch(e){case"request_summary":a=l.i18n._("Request Summary");break;case"expense_summary":a=l.i18n._("Expense Summary");break;case"message_summary":a=l.i18n._("Message Summary");break;case"exception_summary":a=l.i18n._("Exception Summary");break}return a}setDefaultDataToSteps(){if(!this.default_data)return null;this.stepsDataDic[1]={},this.getDefaultData("saved_dashlet_id")?this.stepsDataDic[1].saved_dashlet_id=this.getDefaultData("saved_dashlet_id"):this.stepsDataDic[1].saved_dashlet_id=!1}}export{f as DashletWizardController};
//# sourceMappingURL=DashletWizardController-CFjNN_5J.bundle.js.map
