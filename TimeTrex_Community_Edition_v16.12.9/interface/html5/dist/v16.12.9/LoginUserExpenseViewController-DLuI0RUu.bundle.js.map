{"version":3,"file":"LoginUserExpenseViewController-DLuI0RUu.bundle.js","sources":["../../views/my_account/expense/LoginUserExpenseViewController.js"],"sourcesContent":["import '@/global/widgets/filebrowser/TImageBrowser';\n\nexport class LoginUserExpenseViewController extends BaseViewController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tel: '#login_user_expense_view_container',\n\n\t\t\tstatus_array: null,\n\n\t\t\tpayment_method_array: null,\n\n\t\t\tsub_document_view_controller: null,\n\n\t\t\tdocument_object_type_id: null,\n\n\t\t\trelatedExpenseArray: null,\n\n\t\t\tdocument_api: null\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinit( options ) {\n\t\t//this._super('initialize', options );\n\t\tthis.edit_view_tpl = 'LoginUserExpenseEditView.html';\n\t\tthis.permission_id = 'user_expense';\n\t\tthis.viewId = 'LoginUserExpense';\n\t\tthis.script_name = 'LoginUserExpenseView';\n\t\tthis.table_name_key = 'user_expense';\n\t\tthis.context_menu_name = $.i18n._( 'Expenses' );\n\t\tthis.navigation_label = $.i18n._( 'Expense' );\n\t\tthis.api = TTAPI.APIUserExpense;\n\n\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\tthis.job_api = TTAPI.APIJob;\n\t\t\tthis.job_item_api = TTAPI.APIJobItem;\n\t\t}\n\n\t\tthis.document_api = TTAPI.APIDocument;\n\n\t\tthis.document_object_type_id = 400;\n\t\tthis.hierarchy_type_id = 200;\n\n\t\tthis.render();\n\t\tthis.buildContextMenu();\n\n\t\tthis.initData();\n\t}\n\n\tgetCustomContextMenuModel() {\n\t\tvar context_menu_model = {\n\t\t\texclude: [ 'add', 'copy', 'mass_edit' ],\n\t\t\tinclude: [\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'New' ),\n\t\t\t\t\tid: 'add_user_expense',\n\t\t\t\t\taction_group: 'new',\n\t\t\t\t\tgroup: 'editor',\n\t\t\t\t\tvue_icon: 'tticon tticon-add_black_24dp',\n\t\t\t\t\tshow_on_right_click: true,\n\t\t\t\t\tsort_order: 910\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Upload Receipt' ),\n\t\t\t\t\tid: 'add_user_expense_receipt',\n\t\t\t\t\taction_group: 'new',\n\t\t\t\t\tgroup: 'editor',\n\t\t\t\t\tvue_icon: 'tticon tticon-add_black_24dp',\n\t\t\t\t\tshow_on_right_click: true,\n\t\t\t\t\tsort_order: 920\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Upload Invoice' ),\n\t\t\t\t\tid: 'add_user_expense_invoice',\n\t\t\t\t\taction_group: 'new',\n\t\t\t\t\tgroup: 'editor',\n\t\t\t\t\tvue_icon: 'tticon tticon-add_black_24dp',\n\t\t\t\t\tshow_on_right_click: true,\n\t\t\t\t\tsort_order: 920\n\t\t\t\t},\n\t\t\t]\n\t\t};\n\n\t\treturn context_menu_model;\n\t}\n\n\tonCustomContextClick( id ) {\n\t\tswitch ( id ) {\n\t\t\tcase 'add_user_expense':\n\t\t\t\tthis.onAddClick( true, [] );\n\t\t\t\tbreak;\n\t\t\tcase 'add_user_expense_receipt':\n\t\t\tcase 'add_user_expense_invoice':\n\t\t\t\tvar $this = this;\n\n\t\t\t\tIndexViewController.openWizard( 'UserPhotoWizard', null, function( form_data ) {\n\t\t\t\t\tlet type_id;\n\t\t\t\t\tif ( id.indexOf( 'add_user_expense_receipt' ) !== -1 ) {\n\t\t\t\t\t\ttype_id = 'receipt';\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttype_id = 'invoice';\n\t\t\t\t\t}\n\n\t\t\t\t\tlet api_args;\n\t\t\t\t\tif ( form_data instanceof FormData ) {\n\t\t\t\t\t\tapi_args = { 'form_data': form_data, 'type_id': type_id };\n\t\t\t\t\t} else {\n\t\t\t\t\t\tapi_args = {};\n\t\t\t\t\t}\n\n\t\t\t\t\t$this.onAddClick( true, api_args );\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tonAddClick( show_save_and_continue, get_default_api_args = null ) {\n\t\tthis.relatedExpenseArray = null;\n\t\tsuper.onAddClick( show_save_and_continue, get_default_api_args );\n\t}\n\n\tdoGetDefaultDataAPICall( args, show_save_and_continue ) {\n\t\tvar $this = this;\n\n\t\tlet current_api = this.getCurrentAPI();\n\n\t\tvar api_args;\n\t\tif ( args && args.form_data ) {\n\t\t\tapi_args = [ args.form_data.get( 'file_data' ), args.form_data.get( 'file_name' ), args.form_data.get( 'mime_type' ), args.type_id ];\n\t\t} else {\n\t\t\tapi_args = [];\n\t\t}\n\n\t\tcurrent_api['get' + $this.api.key_name + 'DefaultData']( ...api_args, {\n\t\t\tonResult: function( result ) {\n\t\t\t\t$this.onAddResult( result );\n\t\t\t\tif ( show_save_and_continue ) {\n\t\t\t\t\t//Issue #3111 - If user is on a subview the tab will appear blank and the Save and Continue button will not show unless user switches to another tab.\n\t\t\t\t\t//Because of that when coming from a \"Save & New\" action, we need to make sure to show the Save and Continue button.\n\t\t\t\t\t$this.showSaveAndContinueButton();\n\t\t\t\t}\n\n\t\t\t\tif ( args && args.form_data ) {\n\t\t\t\t\t$this.editor.setValue( [{ 'name': args.form_data.get( 'file_name' ).split(/[/\\\\]/).pop(), 'file': args.form_data }] );\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t}\n\n\t/* jshint ignore:start */\n\tonFormItemChange( target, doNotValidate ) {\n\t\tvar $this = this;\n\n\t\tthis.setIsChanged( target );\n\t\tthis.setMassEditingFieldsWhenFormChange( target );\n\n\t\tvar key = target.getField();\n\t\tvar c_value = target.getValue();\n\n\t\tthis.current_edit_record[key] = c_value;\n\n\t\tvar amount_arr = false;\n\t\tswitch ( key ) {\n\t\t\tcase 'expense_policy_id':\n\t\t\t\tthis.onExpensePolicyChange();\n\t\t\t\tbreak;\n\t\t\tcase 'gross_amount1':\n\t\t\t\tthis.calcRelatedExpenses();\n\t\t\t\tbreak;\n\t\t\tcase 'is_reimbursable':\n\t\t\t\tthis.calcRelatedExpenses();\n\t\t\t\tbreak;\n\t\t\tcase 'amount':\n\t\t\t\tthis.calcRelatedExpenses( target.attr( 'id' ), c_value ); //When a related expense amount is changed, we need to pass that through so the net amount can be updated.\n\t\t\t\tbreak;\n\t\t\tcase 'job_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.edit_view_ui_dic['job_quick_search'].setValue( target.getValue( true ) ? ( target.getValue( true ).manual_id ? target.getValue( true ).manual_id : '' ) : '' );\n\t\t\t\t\tthis.setJobItemValueWhenJobChanged( target.getValue( true ), 'job_item_id', { job_id: this.current_edit_record.job_id } );\n\t\t\t\t\tthis.edit_view_ui_dic['job_quick_search'].setCheckBox( true );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'job_item_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.edit_view_ui_dic['job_item_quick_search'].setValue( target.getValue( true ) ? ( target.getValue( true ).manual_id ? target.getValue( true ).manual_id : '' ) : '' );\n\t\t\t\t\tthis.edit_view_ui_dic['job_item_quick_search'].setCheckBox( true );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'job_quick_search':\n\t\t\tcase 'job_item_quick_search':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.onJobQuickSearch( key, c_value );\n\t\t\t\t\t//Don't validate immediately as onJobQuickSearch is doing async API calls, and it would cause a guaranteed validation failure.\n\t\t\t\t\tdoNotValidate = true;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tif ( !doNotValidate ) {\n\t\t\tthis.validate();\n\t\t}\n\t}\n\n\tcalcRelatedExpenses( override_expense_policy_id = null, override_amount = null ) {\n\t\t//This is also in ExpenseAuthorizationViewController.js\n\t\tvar $this = this;\n\n\t\tthis.current_edit_record['gross_amount1'] = ( this.current_edit_record['gross_amount1'] ? this.current_edit_record['gross_amount1'] : this.current_edit_record['gross_amount'] );\n\n\t\tvar amount_arr = this.relatedExpenseArray ? this.relatedExpenseArray : false;\n\n\t\tif ( override_expense_policy_id !== null && override_amount !== null && amount_arr['taxes'] && amount_arr['taxes'][override_expense_policy_id] ) {\n\t\t\tamount_arr['taxes'][override_expense_policy_id]['amount'] = override_amount;\n\t\t}\n\n\t\tthis.api['calcRelatedExpenses'](\n\t\t\tthis.current_edit_record['expense_policy_id'], this.current_edit_record['gross_amount1'], amount_arr, this.current_edit_record['is_reimbursable'],\n\t\t\t{\n\t\t\t\tonResult: function( res ) {\n\t\t\t\t\t$this.relatedExpenseArray = res.getResult();\n\t\t\t\t\t$this.setRelatedExpense( $this.relatedExpenseArray );\n\t\t\t\t}\n\t\t\t} );\n\n\t\treturn true;\n\t}\n\n\tonExpensePolicyChange() {\n\t\tvar expense_policies = this.edit_view_ui_dic['expense_policy_id'].getSourceData();\n\n\t\tvar unit_name = $.i18n._( 'Amount' );\n\t\tfor ( var n in expense_policies ) {\n\t\t\tif ( expense_policies[n].type_id == 30 && expense_policies[n].id == this.edit_view_ui_dic['expense_policy_id'].getValue() && expense_policies[n].unit_name && expense_policies[n].unit_name.length > 0 ) {\n\t\t\t\tunit_name = expense_policies[n].unit_name;\n\t\t\t}\n\t\t}\n\t\tthis.edit_view_ui_dic['gross_amount1'].parents( '.edit-view-form-item-div' ).find( '.edit-view-form-item-label' ).html( unit_name );\n\n\t\tthis.calcRelatedExpenses();\n\t}\n\n\tsetCurrentEditRecordData() {\n\t\tvar $this = this;\n\t\t//Set current edit record data to all widgets\n\t\tfor ( var key in this.current_edit_record ) {\n\n\t\t\tif ( !this.current_edit_record.hasOwnProperty( key ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar widget = this.edit_view_ui_dic[key];\n\n\t\t\tif ( Global.isSet( widget ) ) {\n\t\t\t\tswitch ( key ) {\n\t\t\t\t\tcase 'gross_amount1':\n\t\t\t\t\t\twidget.setValue( this.current_edit_record['gross_amount'] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'gross_amount':\n\t\t\t\t\tcase 'reimburse_amount':\n\t\t\t\t\tcase 'net_amount':\n\t\t\t\t\t\t// Don't do anything.\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_id':\n\t\t\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_item_id':\n\t\t\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\t\t\tvar args = {};\n\t\t\t\t\t\t\targs.filter_data = { job_id: this.current_edit_record.job_id };\n\t\t\t\t\t\t\twidget.setDefaultArgs( args );\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_quick_search':\n//\t\t\t\t\t\twidget.setValue( this.current_edit_record['job_id'] ? this.current_edit_record['job_id'] : 0 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_item_quick_search':\n//\t\t\t\t\t\twidget.setValue( this.current_edit_record['job_item_id'] ? this.current_edit_record['job_item_id'] : 0 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t\tthis.collectUIDataToCurrentEditRecord();\n\t\tthis.setEditViewDataDone();\n\t}\n\n\t/* jshint ignore:end */\n\tinitOptions() {\n\t\tvar $this = this;\n\n\t\tvar args = {};\n\t\tvar filter_data = {};\n\t\tfilter_data.type_id = [10, 20, 30];\n\t\tfilter_data.user_id = [LocalCacheData.getLoginUser().id];\n\n\t\tthis.initDropDownOption( 'status' );\n\t\tthis.initDropDownOption( 'payment_method' );\n\n\t\targs.filter_data = filter_data;\n\t\tif ( Global.isSet( $this.basic_search_field_ui_dic['expense_policy_id'] ) ) {\n\t\t\t$this.basic_search_field_ui_dic['expense_policy_id'].setDefaultArgs( args );\n\t\t}\n\t}\n\n\tbuildEditViewUI() {\n\n\t\tsuper.buildEditViewUI();\n\n\t\tvar $this = this;\n\n\t\tvar tab_model = {\n\t\t\t'tab_expense': {\n\t\t\t\t'label': $.i18n._( 'Expense' ),\n\t\t\t\t'html_template': this.getLoginUserExpenseTabHtml(),\n\t\t\t\t'is_multi_column': true\n\t\t\t},\n\t\t\t'tab_attachment': true,\n\t\t\t'tab_audit': true,\n\t\t};\n\t\tthis.setTabModel( tab_model );\n\n\t\tthis.navigation.AComboBox( {\n\t\t\tapi_class: TTAPI.APIUserExpense,\n\t\t\tid: this.script_name + '_navigation',\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_expense',\n\t\t\tnavigation_mode: true,\n\t\t\tshow_search_inputs: true\n\t\t} );\n\n\t\tthis.setNavigation();\n\n\t\t//Tab 0 start\n\n\t\tvar tab_expense = this.edit_view_tab.find( '#tab_expense' );\n\n\t\tvar tab_expense_column1 = tab_expense.find( '.first-column' );\n\t\tvar tab_expense_column2 = tab_expense.find( '.second-column' );\n\n\t\tthis.edit_view_tabs[0] = [];\n\n\t\tthis.edit_view_tabs[0].push( tab_expense_column1 );\n\t\tthis.edit_view_tabs[0].push( tab_expense_column2 );\n\n\t\tvar form_item_input;\n\t\tvar widgetContainer;\n\t\tvar label;\n\n\t\t// Date Incurred\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\n\t\tform_item_input.TDatePicker( { field: 'incurred_date' } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Date Incurred' ), form_item_input, tab_expense_column1, '', null );\n\n\t\t// Description\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_AREA );\n\t\tform_item_input.TTextArea( { field: 'description', width: '100%' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Description' ), form_item_input, tab_expense_column1, '', null, null, true );\n\n\t\tform_item_input.parent().width( '45%' );\n\n\t\t// Payment Method\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\n\t\tform_item_input.TComboBox( { field: 'payment_method_id' } );\n\t\tform_item_input.setSourceData( $this.payment_method_array );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Payment Method' ), form_item_input, tab_expense_column1 );\n\n\t\t// Type\n\n\t\tvar args = {};\n\t\tvar filter_data = {};\n\t\tfilter_data.type_id = [10, 20, 30];\n\t\tfilter_data.user_id = [LocalCacheData.getLoginUser().id];\n\n\t\targs.filter_data = filter_data;\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIExpensePolicy,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_expense_policy',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'expense_policy_id',\n\t\t\talways_include_columns: ['type_id', 'unit_name'],\n\t\t\tinit_data_immediately: false\n\t\t} );\n\n\t\tform_item_input.setDefaultArgs( args );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Type' ), form_item_input, tab_expense_column1 );\n\n\t\t//Amount\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\tform_item_input.TTextInput( { field: 'gross_amount1' } );\n\n\t\twidgetContainer = $( '<div class=\\'widget-h-box \\'></div>' );\n\t\tlabel = $( '<span class=\\'widget-right-label\\'> ' + $.i18n._( 'Reimburse' ) + ': </span>' );\n\n\t\tvar widget_checkbox = Global.loadWidgetByName( FormItemType.CHECKBOX );\n\t\twidget_checkbox.TCheckbox( { field: 'is_reimbursable' } );\n\n\t\twidgetContainer.append( form_item_input );\n\t\twidgetContainer.append( label );\n\t\twidgetContainer.append( widget_checkbox );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Amount' ), [form_item_input, widget_checkbox], tab_expense_column1, '', widgetContainer );\n\n\t\t// Currency\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APICurrency,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_currency',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'currency_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Currency' ), form_item_input, tab_expense_column2, '' );\n\n\t\t//Branch\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIBranch,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_branch',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'branch_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Branch' ), form_item_input, tab_expense_column2 );\n\n\t\t//Department\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIDepartment,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_department',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'department_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Department' ), form_item_input, tab_expense_column2 );\n\n\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t//Job\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIJob,\n\t\t\t\tallow_multiple_selection: false,\n\t\t\t\tlayout_name: 'global_job',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tsetRealValueCallBack: ( function( val ) {\n\n\t\t\t\t\tif ( val ) {\n\t\t\t\t\t\tjob_coder.setValue( val.manual_id );\n\t\t\t\t\t}\n\t\t\t\t} ),\n\t\t\t\tfield: 'job_id'\n\t\t\t} );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\tvar job_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tjob_coder.TTextInput( { field: 'job_quick_search', disable_keyup_event: true } );\n\t\t\tjob_coder.addClass( 'job-coder' );\n\n\t\t\twidgetContainer.append( job_coder );\n\t\t\twidgetContainer.append( form_item_input );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Job' ), [form_item_input, job_coder], tab_expense_column2, '', widgetContainer );\n\n\t\t\t// Task\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIJobItem,\n\t\t\t\tallow_multiple_selection: false,\n\t\t\t\tlayout_name: 'global_job_item',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tsetRealValueCallBack: ( function( val ) {\n\n\t\t\t\t\tif ( val ) {\n\t\t\t\t\t\tjob_item_coder.setValue( val.manual_id );\n\t\t\t\t\t}\n\t\t\t\t} ),\n\t\t\t\tfield: 'job_item_id'\n\t\t\t} );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\tvar job_item_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tjob_item_coder.TTextInput( { field: 'job_item_quick_search', disable_keyup_event: true } );\n\t\t\tjob_item_coder.addClass( 'job-coder' );\n\n\t\t\twidgetContainer.append( job_item_coder );\n\t\t\twidgetContainer.append( form_item_input );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Task' ), [form_item_input, job_item_coder], tab_expense_column2, '', widgetContainer );\n\t\t}\n\n\t\t//Tags\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TAG_INPUT );\n\n\t\tform_item_input.TTagInput( { field: 'tag', object_type_id: 930 } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Tags' ), form_item_input, tab_expense_column2, '', null, null, true );\n\n\t\t//Inside editor\n\n\t\tvar inside_editor_div = tab_expense.find( '.inside-editor-div' );\n\n\t\tvar inside_editor_args = {\n\t\t\tname: $.i18n._( 'Attachment Name' ),\n\t\t\taction: $.i18n._( 'Action' )\n\t\t};\n\n\t\tthis.editor = Global.loadWidgetByName( FormItemType.INSIDE_EDITOR );\n\t\tthis.editor.InsideEditor( {\n\t\t\taddRow: this.insideEditorAddRow,\n\t\t\tremoveRow: this.insideEditorRemoveRow,\n\t\t\tgetValue: this.insideEditorGetValue,\n\t\t\tsetValue: this.insideEditorSetValue,\n\t\t\tparent_controller: this,\n\t\t\tapi: this.document_api,\n\t\t\trender: getRender(),\n\t\t\trender_args: inside_editor_args,\n\t\t\trender_inline_html: true,\n\t\t\trow_render: getRowRender(),\n\n\t\t} );\n\n\t\tfunction getRender() {\n\t\t\treturn `\n\t\t\t<table class=\"inside-editor-render\">\n\t\t\t\t<tr class=\"title\" style=\"font-weight: bold\">\n\t\t\t\t\t<td style=\"width: 400px\"><%= name %></td>\n\t\t\t\t\t<td style=\"width: 300px\"><%= action %></td>\n\t\t\t\t</tr>\n\t\t\t</table>`;\n\t\t}\n\n\t\tfunction getRowRender() {\n\t\t\treturn `\n\t\t\t<tr class=\"inside-editor-row data-row\">\n\t\t\t\t<td></td>\n\t\t\t\t<td></td>\n\t\t\t\t<td class=\"cell control-icon\">\n\t\t\t\t\t<button class=\"plus-icon\" onclick=\"\"></button>\n\t\t\t\t</td>\n\t\t\t\t<td class=\"cell control-icon\">\n\t\t\t\t\t<button class=\"minus-icon \" onclick=\"\"></button>\n\t\t\t\t</td>\n\t\t\t</tr>`;\n\t\t}\n\n\t\tinside_editor_div.append( this.editor );\n\t}\n\n\tbuildSearchFields() {\n\n\t\tsuper.buildSearchFields();\n\t\tthis.search_fields = [\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Type' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'expense_policy_id',\n\t\t\t\tlayout_name: 'global_expense_policy',\n\t\t\t\tapi_class: TTAPI.APIExpensePolicy,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Tags' ),\n\t\t\t\tfield: 'tag',\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tin_column: 1,\n\t\t\t\tobject_type_id: 930,\n\t\t\t\tform_item_type: FormItemType.TAG_INPUT\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Status' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'status_id',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tlayout_name: 'global_option_column',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} )\n\t\t];\n\t}\n\n\tgetSubViewFilter( filter ) {\n\n\t\tif ( filter.length === 0 ) {\n\t\t\tfilter = {};\n\t\t}\n\n\t\tfilter['parent_id'] = 0;\n\t\tfilter['user_id'] = LocalCacheData.loginUser.id;\n\n\t\treturn filter;\n\t}\n\n\tsetEditViewDataDone() {\n\t\tsuper.setEditViewDataDone();\n\t\tif ( this.current_edit_record['related_expenses'] ) {\n\t\t\tthis.relatedExpenseArray = this.current_edit_record['related_expenses'];\n\t\t} else {\n\t\t\t//this.relatedExpenseArray = {};\n\t\t\tvar $this = this;\n\t\t\tvar amount_arr = this.relatedExpenseArray ? this.relatedExpenseArray : false;\n\t\t\tthis.api['calcRelatedExpenses'](\n\t\t\t\tthis.current_edit_record['expense_policy_id'], this.current_edit_record['gross_amount'], amount_arr, this.current_edit_record['is_reimbursable'],\n\t\t\t\t{\n\t\t\t\t\tonResult: function( res ) {\n\t\t\t\t\t\t$this.relatedExpenseArray = res.getResult();\n\t\t\t\t\t\t$this.setRelatedExpense( $this.relatedExpenseArray );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t}\n\n\t\tthis.setRelatedExpense( this.relatedExpenseArray );\n\n\t\tthis.initInsideEditorData();\n\t\tAuthorizationHistory.init( this );\n\n\t\tthis.onExpensePolicyChange();\n\n\t\t//Add/edit view drag and drop for files\n\t\tGlobal.initFileDragAndDrop( this.edit_view[0].firstElementChild, ( files ) => {\n\t\t\tthis.attachDragAndDropFiles( files );\n\t\t} );\n\t}\n\n\tinitInsideEditorData() {\n\t\tvar $this = this;\n\t\tvar args = {};\n\t\targs.filter_data = {};\n\n\t\tif ( !this.current_edit_record || !this.current_edit_record.id ) {\n\t\t\t$this.editor.removeAllRows();\n\t\t\t$this.editor.getDefaultData();\n\n\t\t} else {\n\n\t\t\targs.filter_data.object_type_id = this.document_object_type_id;\n\t\t\targs.filter_data.object_id = this.current_edit_record['id'];\n\n\t\t\t$this.api['getAttachment']( args, {\n\t\t\t\tonResult: function( res ) {\n\n\t\t\t\t\tif ( !$this.edit_view ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tvar data = res.getResult();\n\t\t\t\t\t$this.editor.setValue( data );\n\n\t\t\t\t}\n\t\t\t} );\n\n\t\t}\n\t}\n\n\tinsideEditorSetValue( val ) {\n\t\tvar len = val.length;\n\t\tthis.removeAllRows();\n\n\t\tif ( len > 0 ) {\n\t\t\tfor ( var i = 0; i < val.length; i++ ) {\n\t\t\t\tif ( Global.isSet( val[i] ) ) {\n\t\t\t\t\tvar row = val[i];\n\t\t\t\t\tthis.addRow( row );\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthis.getDefaultData();\n\t\t}\n\t}\n\n\tinsideEditorGetValue() {\n\n\t\tvar len = this.rows_widgets_array.length;\n\n\t\tvar result = [];\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar row = this.rows_widgets_array[i];\n\t\t\tif ( Global.isSet( row.file ) ) {\n\t\t\t\tvar data = {\n\t\t\t\t\tname: row.name.getValue(),\n\t\t\t\t\tfile: row.file.getValue()\n\t\t\t\t};\n\n\t\t\t\tif ( data.name === 'No File Selected' ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tresult.push( data );\n\t\t\t}\n\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tinsideEditorAddRow( data, index ) {\n\n\t\tif ( !data ) {\n\t\t\tthis.getDefaultData( index );\n\t\t} else {\n\t\t\tvar row = this.getRowRender(); //Get Row render\n\t\t\tvar render = this.getRender(); //get render, should be a table\n\t\t\tvar widgets = {}; //Save each row's widgets\n\n\t\t\t//Build row widgets\n\n\t\t\t// Attachment Name\n\t\t\tvar form_item_file_name = Global.loadWidgetByName( FormItemType.TEXT );\n\t\t\tform_item_file_name.TText( { field: 'name', width: 400 } );\n\t\t\tform_item_file_name.setValue( data.name ? data.name : $.i18n._( 'No File Selected' ) );\n\t\t\tform_item_file_name.setClassStyle( data.name ? { 'font-weight': 'bold' } : null );\n\t\t\twidgets[form_item_file_name.getField()] = form_item_file_name;\n\t\t\trow.children().eq( 0 ).append( form_item_file_name );\n\t\t\tform_item_file_name.attr( 'document_id', ( data.id && this.parent_controller.current_edit_record.id ) ? data.id : '' );\n\t\t\tform_item_file_name.attr( 'document_revision_id', ( data.document_revision_id && this.parent_controller.current_edit_record.id ) ? data.document_revision_id : '' );\n\n\t\t\t// Action\n\t\t\tif ( data.name && !data.file ) {\n\t\t\t\tvar widgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\t\t\t\tvar download = $( '<button type=\\'button\\' class=\\' download-button t-button widget-right-label\\'>' + $.i18n._( 'Download' ) + '</button>' );\n\t\t\t\tvar view = $( '<button type=\\'button\\' class=\\' view-button t-button widget-right-label\\'>' + $.i18n._( 'View' ) + '</button>' );\n\n\t\t\t\tdownload.attr( {\n\t\t\t\t\tdocument_id: data.id,\n\t\t\t\t\tdocument_revision_id: data.document_revision_id,\n\t\t\t\t\tobject_type_id: this.parent_controller.document_object_type_id\n\t\t\t\t} );\n\n\t\t\t\tview.attr( {\n\t\t\t\t\tdocument_id: data.id,\n\t\t\t\t\tdocument_revision_id: data.document_revision_id,\n\t\t\t\t\tobject_type_id: this.parent_controller.document_object_type_id\n\t\t\t\t} );\n\n\t\t\t\tdownload.bind( 'click', this.parent_controller.downloadFile );\n\t\t\t\tview.bind( 'click', this.parent_controller.downloadFile );\n\n\t\t\t\twidgetContainer.append( download );\n\t\t\t\twidgetContainer.append( view );\n\n\t\t\t\trow.children().eq( 1 ).append( widgetContainer );\n\t\t\t} else {\n\t\t\t\tvar form_item_file = Global.loadWidgetByName( FormItemType.FILE_BROWSER );\n\n\t\t\t\tvar $this = this.file_browser = form_item_file.TImageBrowser( {\n\t\t\t\t\t\tfield: 'file',\n\t\t\t\t\t\tname: 'file_data',\n\t\t\t\t\t\tfile: data?.file ?? null,\n\t\t\t\t\t\taccept_filter: '*',\n\t\t\t\t\t\tchangeHandler: function( a ) {\n\t\t\t\t\t\t\tvar file_name = $( this ).find( '.browser' )[0].files[0].name;\n\t\t\t\t\t\t\tform_item_file_name.setValue( file_name );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\twidgets[form_item_file.getField()] = form_item_file;\n\t\t\t\trow.children().eq( 1 ).append( form_item_file );\n\n\t\t\t}\n\n\t\t\t// end\n\n\t\t\tif ( typeof index != 'undefined' ) {\n\n\t\t\t\trow.insertAfter( $( render ).find( 'tr' ).eq( index ) );\n\t\t\t\tthis.rows_widgets_array.splice( ( index ), 0, widgets );\n\n\t\t\t} else {\n\t\t\t\t$( render ).append( row );\n\t\t\t\tthis.rows_widgets_array.push( widgets );\n\t\t\t}\n\t\t\tif ( this.parent_controller.is_viewing ) {\n\t\t\t\trow.find( '.control-icon' ).hide();\n\t\t\t}\n\n\t\t\tthis.addIconsEvent( row ); //Bind event to add and minus icon\n\t\t\tthis.removeLastRowLine();\n\t\t}\n\t}\n\n\tdownloadFile() {\n\t\tvar $this = $( this );\n\t\tvar document_attachment_id = $this.attr( 'document_id' );\n\t\tvar document_revision_id = $this.attr( 'document_revision_id' );\n\t\tvar object_type_id = $this.attr( 'object_type_id' );\n\n\t\tvar url = ServiceCaller.getURLByObjectType( 'file_download' ) + '&object_type=document&parent_id=' + document_attachment_id + '&parent_object_type_id=' + object_type_id + '&object_id=' + document_revision_id;\n\n\t\tGlobal.APIFileDownload( null, null, null, url );\n\t}\n\n\tinsideEditorRemoveRow( row ) {\n\n\t\tvar $this = this;\n\t\tvar index = row[0].rowIndex - 1;\n\t\tvar remove_id = this.rows_widgets_array[index].name.attr( 'document_id' );\n\t\tif ( TTUUID.isUUID( remove_id ) && remove_id != TTUUID.zero_id && remove_id != TTUUID.not_exist_id ) {\n\t\t\tTAlertManager.showConfirmAlert( $.i18n._( 'Are you sure you want to remove' ) + ': ' + this.rows_widgets_array[index].name.text() + '?', null, function( result ) {\n\t\t\t\tif ( result ) {\n\t\t\t\t\tProgressBar.showOverlay();\n\t\t\t\t\t$this.api['delete' + $this.api.key_name]( remove_id, $this.parent_controller.document_object_type_id, {\n\t\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\t\tProgressBar.closeOverlay();\n\t\t\t\t\t\t\tif ( result && result.isValid() ) {\n\t\t\t\t\t\t\t\trow.remove();\n\t\t\t\t\t\t\t\t$this.rows_widgets_array.splice( index, 1 );\n\t\t\t\t\t\t\t\tif ( $this.rows_widgets_array.length === 0 ) {\n\t\t\t\t\t\t\t\t\t$this.getDefaultData();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t} );\n\t\t} else {\n\t\t\trow.remove();\n\t\t\t$this.rows_widgets_array.splice( index, 1 );\n\t\t}\n\n\t\tthis.removeLastRowLine();\n\t}\n\n\t/**\n\t * this just sets the subform data\n\t * should be called in most cases\n\t *\n\t * @param expenses\n\t */\n\tsetRelatedExpenseData( expenses, selected_related_expense_policy_id ) {\n\t\tvar tab_expense = this.edit_view_tab.find( '#tab_expense' );\n\t\tvar tab_expense_column3 = tab_expense.find( '.third-column' );\n\n\t\ttab_expense_column3.find( '#net_amount' ).val( expenses['net_amount'] );\n\t\ttab_expense_column3.find( '#gross_amount' ).val( expenses['gross_amount'] );\n\t\ttab_expense_column3.find( '#reimburse_amount' ).val( expenses['reimburse_amount'] );\n\n\t\tvar tax_inputs = tab_expense_column3.find( '.tax_input' );\n\t\tfor ( var n = 0; n < tax_inputs.length; n++ ) {\n\t\t\tvar el = $( tax_inputs[n] );\n\t\t\tif ( el.length > 0 ) {\n\t\t\t\tvar id = el.attr( 'id' );\n\t\t\t\tif ( !selected_related_expense_policy_id || selected_related_expense_policy_id != id ) {\n\t\t\t\t\tel.val( expenses['taxes'][id].amount );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn;\n\t}\n\n\tsetRelatedExpense( expenses ) {\n\t\t// Third column start\n\t\tif ( this.edit_view_tab ) { //Fix: Uncaught TypeError: Cannot read property 'find' of null\n\t\t\tvar tab_expense = this.edit_view_tab.find( '#tab_expense' );\n\t\t\tvar tab_expense_column3 = tab_expense.find( '.third-column' ).empty();\n\n\t\t\tif ( this.edit_view_tabs[0].length < 3 ) {\n\t\t\t\tthis.edit_view_tabs[0].push( tab_expense_column3 );\n\t\t\t}\n\n\t\t\tif ( !expenses ) {\n\t\t\t\texpenses = {\n\t\t\t\t\tnet_amount: 0,\n\t\t\t\t\tgross_amount: 0,\n\t\t\t\t\treimburse_amount: this.current_edit_record.reimburse_amount\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif ( expenses && expenses['taxes'] && Object.keys( expenses['taxes'] ).length > 0 ) {\n\t\t\t\t// Net Amount\n\t\t\t\tvar form_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\t\tform_item_input.TTextInput( { field: 'net_amount' } );\n\t\t\t\tform_item_input.setValue( expenses['net_amount'] );\n\t\t\t\tform_item_input.setEnabled( !this.is_viewing );\n\t\t\t\tform_item_input.attr( 'id', 'net_amount' );\n\t\t\t\tform_item_input.setEnabled( false );\n\t\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Net Amount' ), form_item_input, tab_expense_column3, '', null, true );\n\t\t\t\tthis.edit_view_ui_dic['net_amount'].css( 'opacity', 1 );\n\n\t\t\t\tfor ( var key in expenses['taxes'] ) {\n\t\t\t\t\tvar item = expenses['taxes'][key];\n\n\t\t\t\t\t// taxes\n\t\t\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\t\t\tform_item_input.TTextInput( { field: 'amount' } );\n\t\t\t\t\tform_item_input.setValue( item['amount'] );\n\t\t\t\t\tform_item_input.attr( 'id', item['expense_policy_id'] );\n\t\t\t\t\tform_item_input.addClass( 'tax_input' );\n\t\t\t\t\tform_item_input.setEnabled( !this.is_viewing );\n\t\t\t\t\tthis.addEditFieldToColumn( $.i18n._( item['expense_policy_name'] ), form_item_input, tab_expense_column3, '', null, true );\n\n\t\t\t\t\tthis.edit_view_ui_dic['amount'].css( 'opacity', 1 );\n\t\t\t\t}\n\n\t\t\t\t// Amount\n\t\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\t\t\tform_item_input.TText( { field: 'gross_amount' } );\n\t\t\t\tform_item_input.setValue( expenses['gross_amount'] );\n\t\t\t\tform_item_input.attr( 'id', 'gross_amount' );\n\t\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Amount' ), form_item_input, tab_expense_column3, '', null, true );\n\t\t\t\tthis.edit_view_ui_dic['gross_amount'].css( 'opacity', 1 );\n\n\t\t\t}\n\t\t\t// Reimburse Amount\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\t\tform_item_input.TText( { field: 'reimburse_amount' } );\n\n\t\t\tif ( expenses && expenses['reimburse_amount'] && expenses['unit_amount'] && expenses['unit_name'] ) {\n\t\t\t\tform_item_input.setValue( expenses['reimburse_amount'] + ' (' + expenses['unit_amount'] + '/' + expenses['unit_name'] + ')' );\n\t\t\t} else {\n\t\t\t\tform_item_input.setValue( expenses['reimburse_amount'] );\n\t\t\t}\n\n\t\t\tform_item_input.attr( 'id', 'reimburse_amount' );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Reimburse Amount' ), form_item_input, tab_expense_column3, '', null, true );\n\n\t\t\tthis.edit_view_ui_dic['reimburse_amount'].css( 'opacity', 1 );\n\n\t\t\tthis.editFieldResize( 0 );\n\t\t}\n\t}\n\n\tuniformVariable( records ) {\n\t\tif ( this.relatedExpenseArray ) {\n\t\t\trecords.related_expenses = this.relatedExpenseArray;\n\t\t\trecords.gross_amount = this.relatedExpenseArray.gross_amount;\n\t\t\trecords.net_amount = this.relatedExpenseArray.net_amount;\n\t\t\trecords.reimburse_amount = this.relatedExpenseArray.reimburse_amount;\n\t\t}\n\t\treturn records;\n\t}\n\n\t_continueDoCopyAsNew() {\n\t\tthis.setCurrentEditViewState( 'new' );\n\t\tLocalCacheData.current_doing_context_action = 'copy_as_new';\n\n\t\tif ( Global.isSet( this.edit_view ) ) {\n\t\t\tthis.editor.removeAllRows();\n\t\t\tthis.editor.getDefaultData();\n\t\t}\n\t\tsuper._continueDoCopyAsNew();\n\t}\n\n\tonSaveAndCopyResult( result ) {\n\t\tvar $this = this;\n\t\tif ( result && result.isValid() ) {\n\t\t\tvar result_data = result.getResult();\n\t\t\tif ( result_data === true ) {\n\t\t\t\t$this.refresh_id = $this.current_edit_record.id;\n\n\t\t\t} else if ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) {\n\t\t\t\t$this.refresh_id = result_data;\n\t\t\t}\n\n\t\t\t$this.saveInsideEditorData( function() {\n\t\t\t\t$this.search( false );\n\n\t\t\t\t$this.onCopyAsNewClick();\n\n\t\t\t} );\n\n\t\t} else {\n\t\t\t$this.setErrorTips( result );\n\t\t\t$this.setErrorMenu();\n\t\t}\n\t}\n\n\tonSaveResult( result ) {\n\t\tvar $this = this;\n\t\tif ( result && result.isValid() ) {\n\t\t\tvar result_data = result.getResult();\n\t\t\tif ( result_data === true ) {\n\t\t\t\t$this.refresh_id = $this.current_edit_record.id;\n\t\t\t} else if ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) {\n\t\t\t\t$this.refresh_id = result_data;\n\t\t\t}\n\n\t\t\t$this.saveInsideEditorData( function() {\n\t\t\t\t$this.search();\n\t\t\t\t$this.onSaveDone( result );\n\n\t\t\t\t$this.removeEditView();\n\t\t\t} );\n\n\t\t} else {\n\t\t\t$this.setErrorMenu();\n\t\t\t$this.setErrorTips( result );\n\n\t\t}\n\t}\n\n\t/* jshint ignore:start */\n\tsaveInsideEditorData( callBack ) {\n\t\tvar $this = this;\n\t\tvar data = this.editor.getValue();\n\t\tvar files = data.length;\n\t\tif ( files > 0 ) {\n\t\t\tvar success = 0;\n\t\t\tfor ( var key in data ) {\n\t\t\t\tvar fileItem = data[key];\n\t\t\t\tif ( Global.isSet( fileItem.file ) ) {\n\t\t\t\t\tvar document_revision_id = this.api.addAttachment( fileItem.name, this.document_object_type_id, this.refresh_id, { async: false } ).getResult();\n\t\t\t\t\t$this.api.uploadFile( fileItem.file, 'object_type=document_revision&object_id=' + document_revision_id + '&parent_object_type_id=' + this.document_object_type_id, {} );\n\t\t\t\t\tsuccess++;\n\n\t\t\t\t} else {\n\t\t\t\t\tcallBack();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( success === files ) {\n\t\t\t\tcallBack();\n\t\t\t}\n\n\t\t} else {\n\t\t\tcallBack();\n\t\t}\n\t}\n\n\t/* jshint ignore:end */\n\tuploadFile( document_result, file_data ) {\n\t\tvar document_revision_id = document_result.getResult();\n\t\tvar $this = this;\n\n\t\t$this.api.uploadFile( file_data, 'object_type=document_revision&object_id=' + document_revision_id, {\n\t\t\tonResult: function( upload_file_result ) {\n\t\t\t}\n\t\t} );\n\t}\n\n\tonExportClick( method ) {\n\t\tvar args = {};\n\t\targs.filter_columns = this._getFilterColumnsFromDisplayColumns( null, false );\n\t\targs.filter_data = {};\n\t\targs.filter_data.type_id = [10, 20, 30];\n\t\targs.filter_data.user_id = [LocalCacheData.getLoginUser().id];\n\n\t\targs.filter_sort = this.getSearchPanelSortFilter();\n\t\tvar post_data = { 0: 'csv', 1: args, 2: true };\n\n\t\tif ( method == undefined ) {\n\t\t\tmethod = this.api['export' + this.api.key_name];\n\t\t}\n\t\tGlobal.APIFileDownload( this.api.className, method, post_data );\n\t}\n\n\tattachDragAndDropFiles( files ) {\n\t\tfor ( let file of files ) {\n\t\t\t//If every inside editor row already has a file, add a new row.\n\t\t\t//Adding an empty row triggers an API call to get the default data. So we need to wait for that to finish before adding the file.\n\t\t\tif ( this.editor.rows_widgets_array.every( row => !row.hasOwnProperty( 'file' ) || row.file[0].querySelector( 'input' ).files.length > 0 ) ) {\n\t\t\t\tthis.editor.getDefaultData( null, () => {\n\t\t\t\t\tthis.attachFileToEmptyRow( file );\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\t//There is an empty row already\n\t\t\t\tthis.attachFileToEmptyRow( file );\n\t\t\t}\n\t\t}\n\t}\n\n\tattachFileToEmptyRow( file ) {\n\t\t//Add the current file to the data transfer object\n\t\tlet data_transfer = new DataTransfer();\n\t\tdata_transfer.items.add( file );\n\n\t\t//Attach to the first inside editor row that doesn't have a file\n\t\tfor ( let row of this.editor.rows_widgets_array ) {\n\t\t\t//If editing an existing expense, the row will not have a file property and we can skip it.\n\t\t\tif ( !row.hasOwnProperty( 'file' ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t//Check if the row has a file attached\n\t\t\tlet file_input = row.file[0].querySelector( 'input' );\n\t\t\tif ( file_input.files.length === 0 ) {\n\t\t\t\tfile_input.files = data_transfer.files;\n\t\t\t\trow.name.setValue( file.name );\n\t\t\t\t$( file_input ).trigger( 'change' );\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tgetLoginUserExpenseTabHtml() {\n\t\treturn `<div id=\"tab_expense\" class=\"edit-view-tab-outside\">\n\t\t\t\t\t<div class=\"edit-view-tab\" id=\"tab_expense_content_div\">\n\t\t\t\t\t\t<div class=\"first-column\"></div>\n\t\t\t\t\t\t<div class=\"second-column\"></div>\n\t\t\t\t\t\t<div class=\"third-column full-width-column border-column\"></div>\n\t\t\t\t\t\t<div class=\"inside-editor-div full-width-column\"></div>\n\t\t\t\t\t\t<div class=\"authorization-grid-div inside-grid full-width-column\">\n\t\t\t\t\t\t\t<div class=\"grid-top-border\"></div>\n\t\t\t\t\t\t\t<div class=\"grid-title separated-box\"></div>\n\t\t\t\t\t\t\t<table id=\"grid\"></table>\n\t\t\t\t\t\t\t<div class=\"bottom-div\">\n\t\t\t\t\t\t\t\t<div class=\"grid-bottom-border\"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>`;\n\t}\n\n\t// onDeleteResult: function( result, remove_ids ) {\n\t// \tvar $this = this;\n\t// \tProgressBar.closeOverlay();\n\t// \t$this.search();\n\t// \tif ( result.isValid() ) {\n\t// \t\t$this.onDeleteDone( result );\n\t// \t\tif ( $this.edit_view ) {\n\t// \t\t\t$this.removeEditView();\n\t// \t\t}\n\t// \t} else {\n\t// \t\tTAlertManager.showErrorAlert( result );\n\t// \t}\n\t// },\n\n}"],"names":["LoginUserExpenseViewController","options","_","$","context_menu_model","id","$this","form_data","type_id","api_args","show_save_and_continue","get_default_api_args","args","current_api","result","target","doNotValidate","key","c_value","override_expense_policy_id","override_amount","amount_arr","res","expense_policies","unit_name","n","widget","filter_data","tab_model","tab_expense","tab_expense_column1","tab_expense_column2","form_item_input","widgetContainer","label","widget_checkbox","val","job_coder","job_item_coder","inside_editor_div","inside_editor_args","getRender","getRowRender","filter","files","data","len","i","row","index","render","widgets","form_item_file_name","download","view","form_item_file","a","file_name","document_attachment_id","document_revision_id","object_type_id","url","remove_id","expenses","selected_related_expense_policy_id","tab_expense_column3","tax_inputs","el","item","records","result_data","callBack","success","fileItem","document_result","file_data","upload_file_result","method","post_data","file","data_transfer","file_input"],"mappings":"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"}