const __vite__fileDeps=["./main_ui-CaF8IcSp.css","./leaflet-timetrex-DIHfnHxo.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{c as le,l as _e,G as d,g as V,d as Y,_ as ue}from"./main_ui-z76rxVqJ.entry.bundle.js";import{h as ie,o as de,c as oe,d as X,l as ae,n as ce,q as he,H as me,I as pe,w as se,v as re,t as ne,J as fe,F as ge,K as ve,_ as H,j as l}from"./vendor-tTApdY0Y.bundle.js";import"./TImage-D3G3HRb1.bundle.js";import{s as be}from"./selectbutton.esm-C0mFON0B.bundle.js";const ye={name:"TimeSheetControlBar",props:{component_id:{type:String,default:null},onPunchModeChange:{type:Function,default:null},onShowWageClick:{type:Function,default:null},onTimezoneClick:{type:Function,default:null}},data(){return{punch_mode_selected:"punch",punch_modes:[{label:$.i18n._("Punch"),value:"punch"},{label:$.i18n._("Manual"),value:"manual"}],timesheet_settings_options:[{label:$.i18n._("Show Wages"),id:"show_wages",no_group_label:!0,vue_icon:"tticon tticon-settings_black_24dp",action_group:"timesheet_settings",multi_select_group:1,visible:PermissionManager.checkTopLevelPermission("Wage"),command:()=>{this.onShowWageClick&&typeof this.onShowWageClick=="function"&&this.onShowWageClick(this.timesheet_settings_options[0].active)}},{label:$.i18n._("Use Employee Timezone"),id:"use_employee_timezone",no_group_label:!0,vue_icon:"tticon tticon-settings_black_24dp",action_group:"timesheet_settings",multi_select_group:2,visible:PermissionManager.validate("punch","view")||PermissionManager.validate("punch","view_child"),command:()=>{this.onTimezoneClick&&typeof this.onTimezoneClick=="function"&&this.onTimezoneClick(this.timesheet_settings_options[1].active)}}]}},computed:{getPunchMode(){return this.punch_mode_selected}},methods:{setPunchMode(k){return k==="punch"||k==="manual"?(this.punch_mode_selected=k,!0):(Debug.Error("Invalid parameters passed to function: ","TimeSheetControlBar.vue","TimeSheetControlBar","setPunchMode",1),!1)},getTimesheetSettingsState(k){var e=this.timesheet_settings_options.find(i=>i.id===k);if(e)return e.active;Debug.Error("Item not found ("+k+"). Check supplied id.","TimeSheetControlBar.vue","TimeSheetControlBar","getTimesheetSettingsState",1)},setTimesheetSettingsState(k,e){var i=this.timesheet_settings_options.find(t=>t.id===k);i?i.active=e:Debug.Error("Item not found ("+k+"). Check supplied id.","TimeSheetControlBar.vue","TimeSheetControlBar","setTimesheetSettingsState",1)}},components:{SelectButton:be,TTContextButton:_e}},we={class:"tt-horizontal-vue-bar"},Me=he('<div class="bar-column left" data-v-0eef5535></div><div class="bar-column center" data-v-0eef5535><div class="bar-column date-chooser-div" data-v-0eef5535></div><div class="bar-column employee-nav-div" data-v-0eef5535><span class="navigation-label" data-v-0eef5535></span><img class="left-click" data-v-0eef5535><div class="navigation-widget-div" data-v-0eef5535></div><img class="right-click" data-v-0eef5535></div></div>',2),Te={class:"bar-column right"},Ce={class:"bar-column punch-manual"},Pe={class:"bar-column menu-item"};function De(k,e,i,t,a,s){const r=ie("SelectButton"),n=ie("TTContextButton");return de(),oe("div",we,[Me,X("div",Te,[X("div",Ce,[ae(r,{modelValue:a.punch_mode_selected,"onUpdate:modelValue":e[0]||(e[0]=o=>a.punch_mode_selected=o),options:a.punch_modes,optionLabel:"label",optionValue:"value",onClick:e[1]||(e[1]=o=>{this.onPunchModeChange()})},null,8,["modelValue","options"])]),X("div",Pe,[ae(n,{class:ce(["no-wrap"]),items:a.timesheet_settings_options},null,8,["items"])])])])}const Ie=le(ye,[["render",De],["__scopeId","data-v-0eef5535"]]),Se={created(){this.event_bus=new TTEventBus({component_id:this.component_id}),this.event_bus.on("timesheet_note","close_other_notes",k=>{k.component_id!==this.component_id&&(this.visible=!1)})},mounted(){this.setNoneVueEvents()},data(){return{visible:!1,note:this.starting_note,label_save:$.i18n._("Save"),label_note:$.i18n._("Note"),show_add_note:!1}},props:{component_id:{type:String,default:null},id:{type:String,default:null},starting_note:{type:String,default:""},field_reference:{type:Object,default:null}},methods:{handleMouseOver(){this.show_add_note=!0},handleMouseLeave(){this.field_reference[0]!==document.activeElement&&(this.show_add_note=!1)},setNoneVueEvents(){let k=this.$refs.note_icon.closest("td");k.addEventListener("mouseover",this.handleMouseOver),k.addEventListener("mouseleave",this.handleMouseLeave);let e=k.querySelector("input");e.addEventListener("focus",this.handleMouseOver),e.addEventListener("blur",this.handleMouseLeave)},noteIconClicked(){this.visible=!0,this.event_bus.emit("timesheet_note","close_other_notes",{component_id:this.component_id})},saveNote(){this.event_bus.emit(this.component_id,"saveNote",{note:this.note}),this.visible=!1}},components:{TextArea:me,Button:pe}},Ae={class:"note-dialog p-component",ref:"dialog"},Ee={class:"note-label"},Ve={class:"blue-circle-icon",ref:"blue_circle"};function xe(k,e,i,t,a,s){const r=ie("TextArea"),n=ie("Button");return de(),oe(ge,null,[se(X("span",{class:"note-icon tticon tticon-add_black_24dp",onClick:e[0]||(e[0]=(...o)=>s.noteIconClicked&&s.noteIconClicked(...o)),ref:"note_icon"},null,512),[[re,a.show_add_note]]),se(X("div",Ae,[X("h5",Ee,ne(a.label_note),1),X("span",{onClick:e[1]||(e[1]=o=>this.visible=!1),class:"dialog-close"},"Ã—"),ae(r,{modelValue:a.note,"onUpdate:modelValue":e[2]||(e[2]=o=>a.note=o),rows:"4"},null,8,["modelValue"]),ae(n,{type:"submit",class:"save-button",onClick:s.saveNote},{default:fe(()=>[ve(ne(a.label_save),1)]),_:1},8,["onClick"])],512),[[re,a.visible]]),se(X("span",Ve,null,512),[[re,a.note!==""&&!a.show_add_note]])],64)}const Re=le(Se,[["render",xe],["__scopeId","data-v-5f2d00a1"]]);class P extends BaseViewController{constructor(e={}){H.defaults(e,{el:"#timesheet_view_container",status_array:null,type_array:null,employee_nav:null,start_date_picker:null,full_timesheet_data:null,full_format:"ddd-MMM-DD-YYYY",weekly_format:"ddd, MMM DD",day_format:"ddd",date_format:"MMM DD",start_date:null,end_date:null,select_cells_Array:[],select_punches_array:[],absence_select_cells_Array:[],accumulated_time_cells_array:[],premium_cells_array:[],timesheet_data_source:null,accumulated_time_source:null,accumulated_time_grid:null,accumulated_time_source_map:null,branch_grid:null,branch_source_map:null,branch_source:null,department_grid:null,department_source_map:null,department_source:null,job_grid:null,job_source_map:null,job_source:null,job_item_grid:null,job_item_source_map:null,job_item_source:null,punch_tag_source_map:null,punch_tag_source:null,premium_grid:null,premium_source_map:null,premium_source:null,absence_grid:null,absence_source:null,absence_original_source:null,accumulated_total_grid:null,accumulated_total_grid_source_map:null,accumulated_total_grid_source:null,punch_note_grid:null,punch_note_grid_source:null,verification_grid:null,verification_grid_source:null,grid_dic:null,pay_period_map:null,pay_period_data:null,timesheet_verify_data:null,api_timesheet:null,api_user_date_total:null,api_date:null,api_station:null,api_punch:null,absence_model:!1,select_drag_menu_id:"",is_mass_adding:!1,department_cell_count:0,branch_cell_count:0,premium_cell_count:0,job_cell_count:0,task_cell_count:0,punch_tag_cell_count:0,absence_cell_count:0,punch_note_account:0,show_navigation_box:!0,station:null,scroll_position:0,job_api:null,job_item_api:null,user_group_id:null,punch_tag_api:null,user_api:null,department_api:null,default_punch_tag:[],previous_punch_tag_selection:[],api_absence_policy:null,pre_total_time:null,absence_available_balance_dataList:{},available_balance_info:null,show_job_ui:!1,show_job_item_ui:!1,show_punch_tag_ui:!1,show_branch_ui:!1,show_department_ui:!1,show_good_quantity_ui:!1,show_bad_quantity_ui:!1,show_note_ui:!1,show_station_ui:!1,show_absence_job_ui:!1,show_absence_job_item_ui:!1,show_absence_punch_tag_ui:!1,show_absence_branch_ui:!1,show_absence_department_ui:!1,holiday_data_dic:{},grid_div:null,actual_time_label:null,column_maps:null,accmulated_order_map:{},url_args_before_set_date_url:{},allow_auto_switch:!0,vue_control_bar_id:"",previous_absence_policy_id:!1,events:{},force_get_select_layout:!0,location_mass_edit_check_box:null,manual_note_component_ids:[],marked_regular_row:{}}),super(e)}init(e){this.permission_id="punch",this.viewId="TimeSheet",this.script_name="TimeSheetView",this.context_menu_name=l.i18n._("TimeSheet"),this.navigation_label=l.i18n._("TimeSheet"),this.api=TTAPI.APIPunch,this.api_timesheet=TTAPI.APITimeSheet,this.api_user_date_total=TTAPI.APIUserDateTotal,this.api_date=TTAPI.APITTDate,this.api_station=TTAPI.APIStation,this.api_punch=TTAPI.APIPunch,d.getProductEdition()>=20&&(this.job_api=TTAPI.APIJob,this.job_item_api=TTAPI.APIJobItem,this.punch_tag_api=TTAPI.APIPunchTag,this.department_api=TTAPI.APIDepartment),this.api_absence_policy=TTAPI.APIAbsencePolicy,this.scroll_position=0,this.grid_dic={},this.event_bus=new TTEventBus({view_id:this.viewId}),this.initPermission(),this.render(),this.buildContextMenu(),this.initData()}initEditView(){TTPromise.resolve("TimeSheetViewController","addclick"),super.initEditView()}onSubViewRemoved(e){e||this.search(),this.edit_view?this.setEditMenu():this.setDefaultMenu()}setScrollPosition(){this.scroll_position>0&&this.grid_div.scrollTop(this.scroll_position)}punchModeValidate(e){return e||(e="punch"),!!(PermissionManager.validate(e,"punch_timesheet")&&PermissionManager.validate(e,"manual_timesheet"))}getPunchPermissionType(){return this.absence_model?"absence":"punch"}jobUIValidate(e){return e||(e="punch"),!!(d.getProductEdition()>=20&&PermissionManager.validate("job","enabled")&&PermissionManager.validate(e,"edit_job"))}jobItemUIValidate(e){return e||(e="punch"),!!(d.getProductEdition()>=20&&PermissionManager.validate(e,"edit_job_item"))}punchTagUIValidate(e){return e||(e="punch"),!!(d.getProductEdition()>=20&&PermissionManager.validate(e,"edit_punch_tag"))}updateSelectUserAndRefresh(e){this.employee_nav.updateSelectItem(e),this.search()}branchUIValidate(e){return e||(e="punch"),!!PermissionManager.validate(e,"edit_branch")}departmentUIValidate(e){return e||(e="punch"),!!PermissionManager.validate(e,"edit_department")}goodQuantityUIValidate(e){return e||(e="punch"),!!PermissionManager.validate(e,"edit_quantity")}badQuantityUIValidate(e){return e||(e="punch"),!!(PermissionManager.validate(e,"edit_quantity")&&PermissionManager.validate(e,"edit_bad_quantity"))}locationUIValidate(e){return e||(e="punch"),!!PermissionManager.validate(e,"edit_location")}noteUIValidate(e){return e||(e="punch"),!!PermissionManager.validate(e,"edit_note")}stationValidate(){return!!PermissionManager.validate("station","enabled")}initPermission(){super.initPermission(),!PermissionManager.validate("punch","view")&&!PermissionManager.validate("punch","view_child")?(this.show_navigation_box=!1,this.show_search_tab=!1):(this.show_navigation_box=!0,this.show_search_tab=!0),this.punchModeValidate()?this.show_punch_mode_ui=!0:this.show_punch_mode_ui=!1,this.allow_auto_switch&&this.show_punch_mode_ui&&(this.is_auto_switch=!0),this.jobUIValidate()?this.show_job_ui=!0:this.show_job_ui=!1,this.jobItemUIValidate()?this.show_job_item_ui=!0:this.show_job_item_ui=!1,this.punchTagUIValidate()?this.show_punch_tag_ui=!0:this.show_punch_tag_ui=!1,this.branchUIValidate()?this.show_branch_ui=!0:this.show_branch_ui=!1,this.departmentUIValidate()?this.show_department_ui=!0:this.show_department_ui=!1,this.goodQuantityUIValidate()?this.show_good_quantity_ui=!0:this.show_good_quantity_ui=!1,this.badQuantityUIValidate()?this.show_bad_quantity_ui=!0:this.show_bad_quantity_ui=!1,this.noteUIValidate()?this.show_note_ui=!0:this.show_note_ui=!1,this.locationUIValidate()?this.show_location_ui=!0:this.show_location_ui=!1,this.stationValidate()?this.show_station_ui=!0:this.show_station_ui=!1,this.jobUIValidate("absence")?this.show_absence_job_ui=!0:this.show_absence_job_ui=!1,this.jobItemUIValidate("absence")?this.show_absence_job_item_ui=!0:this.show_absence_job_item_ui=!1,this.punchTagUIValidate("absence")?this.show_absence_punch_tag_ui=!0:this.show_absence_punch_tag_ui=!1,this.branchUIValidate("absence")?this.show_absence_branch_ui=!0:this.show_absence_branch_ui=!1,this.departmentUIValidate("absence")?this.show_absence_department_ui=!0:this.show_absence_department_ui=!1}ownerOrChildPermissionValidate(e,i,t){var a;i&&i.indexOf("child")>-1?a="is_child":a="is_owner";var s=this.getSelectEmployee(!0);return!!(PermissionManager.validate(e,i)&&(!s||!d.isSet(s[a])||s&&s[a]))}initOptions(){var e=[{option_name:"type",api:this.api},{option_name:"status",api:this.api}];this.initDropDownOptions(e)}getCustomContextMenuModel(){var e={groups:{drag_and_drop:{label:l.i18n._("Drag & Drop"),id:this.viewId+"drag_and_drop"}},exclude:["export_excel","add","copy","copy_as_new"],include:[{label:l.i18n._("New Punch"),id:"add_punch",action_group:"new",group:"editor",vue_icon:"tticon tticon-add_black_24dp",show_on_right_click:!0,sort_order:910},{label:l.i18n._("New Absence"),id:"add_absence",action_group:"new",group:"editor",vue_icon:"tticon tticon-add_black_24dp",show_on_right_click:!0,sort_order:920},{label:l.i18n._("In/Out"),id:"in_out",action_group:"in_out",group:"editor",vue_icon:"tticon tticon-timer_black_24dp",show_on_right_click:!0,sort_order:1050},{label:l.i18n._("Drag & Drop: Move"),id:"move",menu_align:"right",action_group:"move_copy",multi_select_group:1},{label:l.i18n._("Drag & Drop: Copy"),id:"drag_copy",menu_align:"right",action_group:"move_copy",multi_select_group:1}]};return PermissionManager.validate("request","add")&&e.include.push({label:l.i18n._("Add Request"),id:"AddRequest",vue_icon:"tticon tticon-post_add_black_24dp",menu_align:"right",permission_result:!0,permission:!0,show_on_right_click:!0,sort_order:1e3}),d.getProductEdition()>=15&&e.include.push({label:l.i18n._("Map"),id:"map",menu_align:"right",vue_icon:"tticon tticon-map_black_24dp",show_on_right_click:!0,sort_order:2e3}),e.include.push({label:l.i18n._("Print"),id:"print",action_group_header:!0,action_group:"print_menu",sort_order:7e3,menu_align:"right",type:2,permission_result:!0,permission:!0},{label:l.i18n._("Summary"),id:"print_summary",action_group:"print_menu",sort_order:7e3,menu_align:"right"},{label:l.i18n._("Detailed"),id:"print_detailed",action_group:"print_menu",sort_order:7e3,menu_align:"right"},{label:l.i18n._("Jump To"),id:"jump_to_header",menu_align:"right",action_group:"jump_to",sort_order:8e3,action_group_header:!0,permission_result:!1},{label:l.i18n._("Schedules"),id:"schedule",menu_align:"right",action_group:"jump_to",sort_order:8e3},{label:l.i18n._("Pay Stubs"),id:"pay_stub",menu_align:"right",action_group:"jump_to",sort_order:8e3},{label:l.i18n._("Edit Employee"),id:"edit_employee",menu_align:"right",action_group:"jump_to",sort_order:8e3},{label:l.i18n._("Edit Pay Period"),id:"edit_pay_period",menu_align:"right",action_group:"jump_to",sort_order:8e3},{label:l.i18n._("Accumulated Time"),id:"accumulated_time",menu_align:"right",action_group:"jump_to",sort_order:8e3},{label:"",id:"other_header",menu_align:"right",action_group:"other",action_group_header:!0,vue_icon:"tticon tticon-more_vert_black_24dp"},{label:l.i18n._("ReCalculate TimeSheet"),id:"re_calculate_timesheet",menu_align:"right",action_group:"other"},{label:l.i18n._("Generate Pay Stub"),id:"generate_pay_stub",menu_align:"right",action_group:"other"}),e}parseCustomContextModelForEditViews(e){return e=super.parseCustomContextModelForEditViews(e),this.determineContextMenuMountAttributes().menu_type==="editview_contextmenu"&&e.exclude.push("move","drag_copy","re_calculate_timesheet","generate_pay_stub","print","print_detailed","print_summary"),e}openEditView(){this.previous_absence_policy_id=!1,d.setUINotready(),TTPromise.add("init","init"),TTPromise.wait(),this.edit_view||(this.is_edit=!0,this.initEditViewUI("TimeSheet","TimeSheetEditView.html"))}setEditViewWidgetsMode(){for(var e in this.edit_view_ui_dic)if(this.edit_view_ui_dic.hasOwnProperty(e)){var i=this.edit_view_ui_dic[e];this.edit_view_form_item_dic[e];var t=i.parent().parent().parent();if(t.hasClass("v-box"),this.absence_model)switch(e){case"punch_date":case"punch_time":case"status_id":case"type_id":case"quantity":case"station_id":case"has_image":case"latitude":case"split_punch_control":this.detachElement(e),i.css("opacity",0);break;case"punch_dates":this.is_mass_adding?(this.attachElement(e),i.css("opacity",1)):(this.detachElement(e),i.css("opacity",0));break;case"date_stamp":this.is_mass_adding?(this.detachElement(e),i.css("opacity",0)):(this.attachElement(e),i.css("opacity",1));break;case"total_time":case"src_object_id":case"override":this.attachElement(e),i.css("opacity",1);break;case"available_balance":this.detachElement(e),i.css("opacity",1);break;default:i.css("opacity",1);break}else switch(e){case"punch_dates":this.is_mass_adding?(this.attachElement(e),i.css("opacity",1)):(this.detachElement(e),i.css("opacity",0));break;case"punch_date":this.is_mass_adding?(this.detachElement(e),i.css("opacity",0)):(this.attachElement(e),i.css("opacity",1));break;case"quantity":this.show_good_quantity_ui&&this.show_bad_quantity_ui&&(this.attachElement(e),i.css("opacity",1));break;case"station":this.attachElement(e),i.css("opacity",1);break;case"punch_time":case"status_id":case"type_id":case"has_image":case"latitude":this.attachElement(e),i.css("opacity",1);break;case"date_stamp":case"total_time":case"src_object_id":case"override":this.detachElement(e),i.css("opacity",0);break;default:i.css("opacity",1);break}this.is_viewing?d.isSet(i.setEnabled)&&i.setEnabled(!1):d.isSet(i.setEnabled)&&i.setEnabled(!0)}}getCustomFieldReferenceField(){return"note"}setCustomFields(){this.getPunchPermissionType()==="punch"&&super.setCustomFields()}buildEditViewUI(){super.buildEditViewUI();var e=this,i={tab_punch:{label:this.absence_model?l.i18n._("Absence"):l.i18n._("Punch")},tab_audit:!0};this.setTabModel(i);var t,r,a=this.edit_view_tab.find("#tab_punch"),s=a.find(".first-column");t=d.loadWidgetByName(FormItemType.TEXT),t.TText({field:"first_last_name"}),this.addEditFieldToColumn(l.i18n._("Employee"),t,s,""),t=d.loadWidgetByName(FormItemType.TIME_PICKER),t.TTimePicker({field:"punch_time",validation_field:"time_stamp"}),r=l("<div class='widget-h-box'></div>"),this.actual_time_label=l("<span class='widget-right-label'></span>"),r.append(t),r.append(this.actual_time_label),this.addEditFieldToColumn(l.i18n._("Time"),t,s,"",r,!0),t=d.loadWidgetByName(FormItemType.AWESOME_BOX),t.AComboBox({api_class:TTAPI.APIAbsencePolicy,allow_multiple_selection:!1,layout_name:"global_absences",show_search_inputs:!0,set_empty:!0,field:"src_object_id",validation_field:"absence_policy_id"}),t.customSearchFilter=function(T){return e.setAbsencePolicyFilter(T)},this.addEditFieldToColumn(l.i18n._("Absence Policy"),t,s,"",null,!0),t=d.loadWidgetByName(FormItemType.TEXT),t.TText({field:"available_balance"}),r=l("<div class='widget-h-box available-balance-h-box'></div>"),this.available_balance_info=l('<span class="available-balance-info tticon tticon-info_black_24dp"></span>'),r.append(t),r.append(this.available_balance_info),this.addEditFieldToColumn(l.i18n._("Available Balance"),[t],s,"",r,!0),t=d.loadWidgetByName(FormItemType.DATE_PICKER),t.TDatePicker({field:"punch_date",validation_field:"date_stamp"}),this.addEditFieldToColumn(l.i18n._("Date"),t,s,"",null,!0),t=d.loadWidgetByName(FormItemType.DATE_PICKER),t.TRangePicker({field:"punch_dates",validation_field:"date_stamp"}),this.addEditFieldToColumn(l.i18n._("Date"),t,s,"",null,!0),t=d.loadWidgetByName(FormItemType.DATE_PICKER),t.TDatePicker({field:"date_stamp"}),this.addEditFieldToColumn(l.i18n._("Date"),t,s,"",null,!0),t=d.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"total_time",mode:"time_unit"});var r=l("<div class='widget-h-box'></div>"),n=l("<input id='release-balance-button' class='t-button' style='margin-left: 5px' type='button' value='"+l.i18n._("Available Balance")+"'>");n.css("display","none"),n.click(function(){e.getAvailableBalance(!0)}),r.append(t),r.append(n),this.addEditFieldToColumn(l.i18n._("Time"),t,s,"",r,!0),t=d.loadWidgetByName(FormItemType.COMBO_BOX),t.TComboBox({field:"type_id"}),t.setSourceData(e.type_array),r=l("<div class='widget-h-box'></div>");var o=d.loadWidgetByName(FormItemType.CHECKBOX);o.TCheckbox({field:"disable_rounding"});var _=l("<span class='widget-right-label'>"+l.i18n._("Disable Rounding")+"</span>");if(r.append(t),this.is_viewing||PermissionManager.validate("punch","edit_disable_rounding")==!1?this.addEditFieldToColumn(l.i18n._("Punch Type"),t,s,"",r,!0):(r.append(_),r.append(o),this.addEditFieldToColumn(l.i18n._("Punch Type"),[t,o],s,"",r,!0)),t=d.loadWidgetByName(FormItemType.COMBO_BOX),t.TComboBox({field:"status_id"}),t.setSourceData(e.status_array),this.addEditFieldToColumn(l.i18n._("In/Out"),t,s,"",null,!0),t=d.loadWidgetByName(FormItemType.AWESOME_BOX),t.AComboBox({api_class:TTAPI.APIBranch,allow_multiple_selection:!1,layout_name:"global_branch",show_search_inputs:!0,set_empty:!0,field:"branch_id"}),this.addEditFieldToColumn(l.i18n._("Branch"),t,s,"",null,!0),this.absence_model?this.show_absence_branch_ui||this.detachElement("branch_id"):this.show_branch_ui||this.detachElement("branch_id"),t=d.loadWidgetByName(FormItemType.AWESOME_BOX),t.AComboBox({api_class:TTAPI.APIDepartment,allow_multiple_selection:!1,layout_name:"global_department",show_search_inputs:!0,set_empty:!0,field:"department_id"}),this.addEditFieldToColumn(l.i18n._("Department"),t,s,"",null,!0),this.absence_model?this.show_absence_department_ui||this.detachElement("department_id"):this.show_department_ui||this.detachElement("department_id"),d.getProductEdition()>=20){t=d.loadWidgetByName(FormItemType.AWESOME_BOX),t.AComboBox({api_class:TTAPI.APIJob,allow_multiple_selection:!1,layout_name:"global_job",show_search_inputs:!0,set_empty:!0,setRealValueCallBack:function(T){T&&u.setValue(T.manual_id)},field:"job_id"}),r=l("<div class='widget-h-box'></div>");var u=d.loadWidgetByName(FormItemType.TEXT_INPUT);u.TTextInput({field:"job_quick_search",disable_keyup_event:!0}),u.addClass("job-coder"),r.append(u),r.append(t),this.addEditFieldToColumn(l.i18n._("Job"),[t,u],s,"",r,!0),this.absence_model?this.show_absence_job_ui||this.detachElement("job_id"):this.show_job_ui||this.detachElement("job_id"),t=d.loadWidgetByName(FormItemType.AWESOME_BOX),t.AComboBox({api_class:TTAPI.APIJobItem,allow_multiple_selection:!1,layout_name:"global_job_item",show_search_inputs:!0,set_empty:!0,setRealValueCallBack:function(T){T&&m.setValue(T.manual_id)},field:"job_item_id"}),r=l("<div class='widget-h-box'></div>");var m=d.loadWidgetByName(FormItemType.TEXT_INPUT);m.TTextInput({field:"job_item_quick_search",disable_keyup_event:!0}),m.addClass("job-coder"),r.append(m),r.append(t),this.addEditFieldToColumn(l.i18n._("Task"),[t,m],s,"",r,!0),this.absence_model?this.show_absence_job_item_ui||this.detachElement("job_item_id"):this.show_job_item_ui||this.detachElement("job_item_id"),t=d.loadWidgetByName(FormItemType.AWESOME_BOX),t.AComboBox({api_class:TTAPI.APIPunchTag,allow_multiple_selection:!0,layout_name:"global_punch_tag",show_search_inputs:!0,set_empty:!0,get_real_data_on_multi:!0,setRealValueCallBack:(T,S)=>{T&&this.setPunchTagQuickSearchManualIds(T,S)},field:"punch_tag_id"}),r=l("<div class='widget-h-box'></div>");var h=d.loadWidgetByName(FormItemType.TEXT_INPUT);h.TTextInput({field:"punch_tag_quick_search",disable_keyup_event:!0}),h.addClass("job-coder"),r.append(h),r.append(t),this.addEditFieldToColumn(l.i18n._("Tags"),[t,h],s,"",r,!0),this.absence_model?this.show_absence_punch_tag_ui||this.detachElement("punch_tag_id"):this.show_punch_tag_ui||this.detachElement("punch_tag_id")}if(d.getProductEdition()>=20){var c=d.loadWidgetByName(FormItemType.TEXT_INPUT);c.TTextInput({field:"quantity"}),c.addClass("quantity-input");var g=l("<span class='widget-right-label'>"+l.i18n._("Good")+": </span>"),p=d.loadWidgetByName(FormItemType.TEXT_INPUT);p.TTextInput({field:"bad_quantity"}),p.addClass("quantity-input");var b=l("<span class='widget-right-label'>/ "+l.i18n._("Bad")+": </span>");r=l("<div class='widget-h-box'></div>"),r.append(g),r.append(c),r.append(b),r.append(p),this.addEditFieldToColumn(l.i18n._("Quantity"),[c,p],s,"",r,!0),!this.show_bad_quantity_ui&&!this.show_good_quantity_ui?this.detachElement("quantity"):(this.show_bad_quantity_ui||(b.hide(),p.hide()),this.show_good_quantity_ui||(g.hide(),c.hide()))}if(t=d.loadWidgetByName(FormItemType.TEXT_AREA),t.TTextArea({field:"note",width:"100%"}),this.addEditFieldToColumn(l.i18n._("Note"),t,s,"",null,!0,!0),t.parent().width("45%"),this.show_note_ui||this.detachElement("note"),t=d.loadWidgetByName(FormItemType.CHECKBOX),t.TCheckbox({field:"override"}),this.addEditFieldToColumn(l.i18n._("Override"),t,s,"",null,!0,!0),d.getProductEdition()>=15){var v=d.loadWidgetByName(FormItemType.TEXT);v.TText({field:"latitude"});var f=d.loadWidgetByName(FormItemType.TEXT);f.TText({field:"longitude"}),r=l("<div class='widget-h-box link-widget-box'></div>");var A=d.loadWidgetByName(FormItemType.TEXT);A.TText({field:"position_accuracy"}),_=l("<span class='widget-right-label'>"+l.i18n._("Accuracy")+":</span>");var M=l('<img class="widget-h-box-mapIcon" src="framework/leaflet/images/marker-icon-red.png" >');if(this.location_wrapper=l('<div class="widget-h-box-mapLocationWrapper"></div>'),r.append(M),r.append(this.location_wrapper),this.location_wrapper.append(v),this.location_wrapper.append(l("<span>, </span>")),this.location_wrapper.append(f),this.location_wrapper.append(_),this.location_wrapper.append(A),this.location_wrapper.append(l("<span>m</span>")),this.is_mass_editing){this.location_mass_edit_check_box=l(' <div class="mass-edit-checkbox-wrapper"><input type="checkbox" class="mass-edit-checkbox"></input><label for="checkbox-input-1" class="input-helper input-helper--checkbox"></label></div>'),this.location_mass_edit_check_box.insertBefore(l(M)),this.location_mass_edit_check_box.change(()=>{this.trigger("formItemChange",[this.edit_view_ui_dic.longitude]),this.trigger("formItemChange"[this.edit_view_ui_dic.latitude]),this.trigger("position_accuracy"[this.edit_view_ui_dic.position_accuracy])});let T=()=>this.location_mass_edit_check_box.find(".mass-edit-checkbox")[0].checked,S=()=>!0;f.isChecked=v.isChecked=A.isChecked=T,f.getEnabled=v.getEnabled=A.getEnabled=S}this.addEditFieldToColumn(l.i18n._("Location"),[v,f,A],s,"",r,!0),r.click(T=>{T.target.className!="mass-edit-checkbox"&&this.onMapClick()}),(!this.is_edit&&!this.is_viewing&&!this.is_mass_editing||!this.show_location_ui)&&r.parents(".edit-view-form-item-div").hide()}t=d.loadWidgetByName(FormItemType.TEXT),t.TText({field:"station_id"}),this.addEditFieldToColumn(l.i18n._("Station"),t,s,"",null,!0,!0),t.click(function(){e.current_edit_record.station_id&&e.show_station_ui&&IndexViewController.openEditView(e,"Station",e.current_edit_record.station_id)}),t=d.loadWidgetByName(FormItemType.CHECKBOX),t.TCheckbox({field:"split_punch_control"}),this.addEditFieldToColumn(l.i18n._("Split Existing Punches"),t,s,"",null,!0,!0),this.is_mass_adding==!1&&this.detachElement("split_punch_control"),t=d.loadWidgetByName(FormItemType.IMAGE),t.TImage({field:"punch_image"}),this.addEditFieldToColumn(l.i18n._("Image"),t,s,"",null,!0,!0)}onEditStationDone(){this.setStation()}setAbsencePolicyFilter(e){var i;return e.filter_data||(e.filter_data={}),e.filter_data.user_id=(i=this.current_edit_record)==null?void 0:i.user_id,e.filter_columns&&(e.filter_columns.absence_policy=!0),e}onSetSearchFilterFinished(){}onBuildBasicUIFinished(){}onBuildAdvUIFinished(){}parserDatesRange(e){for(var i=e.split(" - "),t=[],a=d.strToDate(i[0]),s=d.strToDate(i[1]),r=a;r.getTime()<s.getTime();)t.push(r.format()),r=new Date(new Date(r.getTime()).setDate(r.getDate()+1));return t.push(i[1]),t}validate(){var e=this,i=this.current_edit_record,t;if(this.is_mass_editing){i=[];for(var a=this.mass_edit_record_ids.length,t=0;t<a;t++){var s=d.clone(this.current_edit_record);s.id=this.mass_edit_record_ids[t],i.push(s)}}if(this.is_mass_adding){i=[];var r=this.current_edit_record.punch_dates;r&&r.indexOf(" - ")>0&&(r=this.parserDatesRange(r));for(var t=0;t<r.length;t++){var n=d.clone(this.current_edit_record);delete n.punch_dates,this.absence_model?n.date_stamp=r[t]:n.punch_date=r[t],i.push(n)}}this.absence_model?this.api_user_date_total["validate"+this.api_user_date_total.key_name](i,{onResult:function(o){e.clearErrorTips(),o&&o.isValid()?e.setEditMenu():(e.setErrorMenu(),e.setErrorTips(o))}}):this.api["validate"+this.api.key_name](i,{onResult:function(o){e.validateResult(o)}})}onFormItemChange(e,i){var t=this;this.setIsChanged(e),this.setMassEditingFieldsWhenFormChange(e);var a=e.getField(),s=e.getValue();if(this.current_edit_record){switch(this.current_edit_record[a]=s,a){case"job_id":d.getProductEdition()>=20&&(this.edit_view_ui_dic.job_quick_search.setValue(e.getValue(!0)&&e.getValue(!0).manual_id?e.getValue(!0).manual_id:""),this.setJobItemValueWhenJobChanged(e.getValue(!0),"job_item_id",{status_id:10,job_id:this.current_edit_record.job_id}),this.edit_view_ui_dic.job_quick_search.setCheckBox(!0),this.setPunchTagValuesWhenCriteriaChanged(this.getPunchTagFilterData(),"punch_tag_id"));break;case"job_item_id":d.getProductEdition()>=20&&(this.edit_view_ui_dic.job_item_quick_search.setValue(e.getValue(!0)&&e.getValue(!0).manual_id?e.getValue(!0).manual_id:""),this.edit_view_ui_dic.job_item_quick_search.setCheckBox(!0),this.setPunchTagValuesWhenCriteriaChanged(this.getPunchTagFilterData(),"punch_tag_id"));break;case"punch_tag_id":d.getProductEdition()>=20&&(s!==V.zero_id&&s!==!1&&s.length>0?this.setPunchTagQuickSearchManualIds(e.getSelectItems()):this.edit_view_ui_dic.punch_tag_quick_search.setValue(""),t.previous_punch_tag_selection=s,this.edit_view_ui_dic.punch_tag_id.setSourceData(null));break;case"branch_id":d.getProductEdition()>=20&&(this.setPunchTagValuesWhenCriteriaChanged(this.getPunchTagFilterData(),"punch_tag_id"),this.setJobValueWhenCriteriaChanged("job_id",{status_id:10,user_id:this.current_edit_record.user_id,punch_branch_id:this.current_edit_record.branch_id,punch_department_id:this.current_edit_record.department_id}),this.setDepartmentValueWhenBranchChanged(e.getValue(!0),"department_id",{branch_id:this.current_edit_record.branch_id,user_id:this.current_edit_record.user_id}));break;case"user_id":case"department_id":d.getProductEdition()>=20&&(this.setPunchTagValuesWhenCriteriaChanged(this.getPunchTagFilterData(),"punch_tag_id"),this.setJobValueWhenCriteriaChanged("job_id",{status_id:10,user_id:this.current_edit_record.user_id,punch_branch_id:this.current_edit_record.branch_id,punch_department_id:this.current_edit_record.department_id}));break;case"job_quick_search":case"job_item_quick_search":d.getProductEdition()>=20&&(this.onJobQuickSearch(a,s),TTPromise.wait("BaseViewController","onJobQuickSearch",function(){t.setPunchTagValuesWhenCriteriaChanged(t.getPunchTagFilterData(),"punch_tag_id")}),i=!0);break;case"punch_tag_quick_search":d.getProductEdition()>=20&&(this.onPunchTagQuickSearch(s,this.getPunchTagFilterData(),"punch_tag_id"),i=!0);break;case"punch_dates":this.setEditMenu();break}this.absence_model?(a==="total_time"&&this.current_edit_record&&(this.current_edit_record[a]=d.parseTimeUnit(s),this.current_edit_record.start_time_stamp=!1,this.current_edit_record.end_time_stamp=!1),a!=="override"&&this.edit_view_ui_dic.override&&(this.edit_view_ui_dic.override.setValue(!0),this.current_edit_record.override=!0)):this.current_edit_record[a]=s,i||(this.absence_model&&(a==="total_time"||a==="date_stamp"||a==="punch_dates"||a==="src_object_id")&&this.onAvailableBalanceChange(),this.validate())}}buildSearchAndLayoutUI(){var e=this.search_panel.find("div #saved_layout_content_div"),i=l(l.fn.SearchPanel.html.form_item),t=i.find(".form-item-label"),a=i.find(".form-item-input-div");t.text(l.i18n._("Save Search As")),this.save_search_as_input=d.loadWidgetByName(FormItemType.TEXT_INPUT),this.save_search_as_input.TTextInput();var s=l(`<button class="tt-button p-button p-component small-search-panel-button" type="button">
<span class="tticon tticon-save_black_24dp"></span>
<span class="p-button-label">`+l.i18n._("Save")+`</span>
</button>`);a.append(this.save_search_as_input),a.append(s);var r=this;s.click(function(){r.onSaveNewLayout()}),this.previous_saved_layout_div=l("<div class='previous-saved-layout-div'></div>"),a.append(this.previous_saved_layout_div),t=l("<span style='margin-left: 5px' >"+l.i18n._("Previous Saved Searches")+":</span>"),this.previous_saved_layout_div.append(t),this.previous_saved_layout_selector=l("<select style='margin-left: 5px' class='t-select'>");var n=l(`<button class="tt-button p-button p-component small-search-panel-button" type="button">
<span class="tticon tticon-save_black_24dp"></span>
<span class="p-button-label">`+l.i18n._("Update")+`</span>
</button>`),o=l(`<button class="tt-button p-button p-component small-search-panel-button" type="button">
<span class="tticon tticon-delete_black_24dp"></span>
<span class="p-button-label">`+l.i18n._("Delete")+`</span>
</button>`);n.click(function(){r.onUpdateLayout()}),o.click(function(){r.onDeleteLayout()}),this.previous_saved_layout_div.append(this.previous_saved_layout_selector),this.previous_saved_layout_div.append(n),this.previous_saved_layout_div.append(o),e.append(i),this.previous_saved_layout_div.css("display","none")}checkTimesheetData(){return this.full_timesheet_data!==!0}render(){var e=this;super.render(),this.vue_control_bar_id="vue-timesheet-control-bar";var i={onPunchModeChange:function(){!e.getPunchMode()&&e.toggle_button&&e.toggle_button.setValue(LocalCacheData.getAllURLArgs().mode?LocalCacheData.getAllURLArgs().mode:"punch"),e.onWageOrModeChange("manual"),e.onSearch(!0)},onShowWageClick:function(){e.onWageOrModeChange("wage"),e.onSearch(!0)},onTimezoneClick:function(){e.onWageOrModeChange("timezone"),e.onSearch(!0)}},t=Y.mountComponent(this.vue_control_bar_id,Ie,i),a=l(".time-sheet-view .date-chooser-div"),s=l(".time-sheet-view .employee-nav-div");a.empty(),this.show_navigation_box?s.css("display",""):s.css("display","none"),this.wage_btn={id:this.vue_control_bar_id,show:function(){},hide:function(){},getValue:function(){if(t&&t._vue_component_instance)return t._vue_component_instance.getTimesheetSettingsState("show_wages")},setValue:function(p){t&&t._vue_component_instance&&t._vue_component_instance.setTimesheetSettingsState("show_wages",p)},remove:function(){}},this.timezone_btn={id:this.vue_control_bar_id,show:function(){},hide:function(){},getValue:function(){if(t&&t._vue_component_instance)return t._vue_component_instance.getTimesheetSettingsState("use_employee_timezone")},setValue:function(p){t&&t._vue_component_instance&&t._vue_component_instance.setTimesheetSettingsState("use_employee_timezone",p)},remove:function(){}},this.start_date_picker=d.loadWidgetByName(FormItemType.DATE_PICKER),this.start_date_picker.TDatePicker({field:"start_date"});var r=l("<span class='label'>"+l.i18n._("Date")+":</span><img class='left-arrow arrow' src="+d.getRealImagePath("images/left_arrow.svg")+"><div class='date-picker-div'></div><img class='right-arrow arrow' src="+d.getRealImagePath("images/right_arrow.svg")+">");a.append(r),a.find(".date-picker-div").append(this.start_date_picker);var n=a.find(".left-arrow"),o=a.find(".right-arrow");n.bind("click",function(){if(!(!e.checkTimesheetData()||!e.timesheet_columns)){var p=d.strToDate(e.getSelectDate()?e.getSelectDate():new Date().format()),b=new Date(new Date(p.getTime()).setDate(p.getDate()-7)).format();e.first_build=!0,_(b),e.setDefaultMenu()}}),o.bind("click",function(){if(!(!e.checkTimesheetData()||!e.timesheet_columns)){var p=d.strToDate(e.getSelectDate()?e.getSelectDate():new Date().format()),b=new Date(new Date(p.getTime()).setDate(p.getDate()+7)).format();e.first_build=!0,_(b),e.setDefaultMenu()}}),this.start_date_picker.bind("formItemChange",function(){var p=e.getSelectDate()?e.getSelectDate():new Date().format();e.first_build=!0,_(p)});function _(p){e.doNextIfNoValueChangeInManualGrid(v,b);function b(){e.setDatePickerValue(LocalCacheData.last_timesheet_selected_date)}function v(){e.setDatePickerValue(p),e.search()}}var u=s.find(".navigation-label"),m=s.find(".left-click"),h=s.find(".right-click"),c=s.find(".navigation-widget-div");c.empty(),this.employee_nav=d.loadWidgetByName(FormItemType.AWESOME_BOX);var g={permission_section:"punch"};if(this.employee_nav=this.employee_nav.AComboBox({id:"employee_navigation",api_class:TTAPI.APIUser,allow_multiple_selection:!1,layout_name:"global_user",init_data_immediately:!0,default_args:g,show_search_inputs:!0,always_include_columns:["default_branch_id","default_department_id","default_job_id","default_job_item_id","default_punch_tag_id"],width:200,is_static_width:!0,setRealValueCallBack:function(p){e.userValueSet(p)}}),c.append(this.employee_nav),c.bind("onClose",()=>{this.setEmployeeNavArrowsStatus()}),this.employee_nav.bind("formItemChange",function(){e.doNextIfNoValueChangeInManualGrid(p,b),d.triggerAnalyticsEditViewNavigation("navigation",e.viewId);function p(){var v=e.getSelectEmployee();e.edit_view||e.reSetURL(),e.allow_auto_switch&&(e.is_auto_switch=!0),e.first_build=!0,LocalCacheData.last_timesheet_selected_user!=v&&e.search(),e.absence_model=!1,e.setDefaultMenu()}function b(){e.employee_nav.setValue(LocalCacheData.last_timesheet_selected_user)}}),this.employee_nav.bind("initSourceComplete",function(){e.setEmployeeNavArrowsStatus()}),m.attr("src",d.getRealImagePath("images/left_arrow.svg")),h.attr("src",d.getRealImagePath("images/right_arrow.svg")),h.click(function(){if(h.hasClass("disabled"))return;e.doNextIfNoValueChangeInManualGrid(p),d.triggerAnalyticsEditViewNavigation("right-arrow",e.viewId);function p(){var v=e.employee_nav.getSelectIndex(),f=e.employee_nav.getSourceData(),A=e.employee_nav.getCurrentOpenPage(),M;f&&v<f.length-1?(M=e.employee_nav.getItemByIndex(v+1),e.employee_nav.setValue(M),b()):f&&v===f.length-1?e.employee_nav.onADropDownSearch("unselect_grid",A+1,"first",b,!1):(M=e.employee_nav.getItemByIndex(0),e.employee_nav.setValue(M),b())}function b(){e.edit_view||e.reSetURL(),e.allow_auto_switch&&(e.is_auto_switch=!0),e.first_build=!0,e.search(),e.setEmployeeNavArrowsStatus()}}),m.click(function(){if(m.hasClass("disabled"))return;e.doNextIfNoValueChangeInManualGrid(p),d.triggerAnalyticsEditViewNavigation("left-arrow",e.viewId);function p(){var b=e.employee_nav.getSelectIndex(),v=e.employee_nav.getCurrentOpenPage(),f;b>0?(f=e.employee_nav.getItemByIndex(b-1),e.employee_nav.setValue(f),A()):v>1?e.employee_nav.onADropDownSearch("unselect_grid",v-1,"last",A,!1):(f=e.employee_nav.getItemByIndex(0),e.employee_nav.setValue(f),A());function A(){e.edit_view||e.reSetURL(),e.allow_auto_switch&&(e.is_auto_switch=!0),e.first_build=!0,e.search(),e.setEmployeeNavArrowsStatus()}}}),u.text(l.i18n._("Employee")),this.show_punch_mode_ui)this.toggle_button={id:this.vue_control_bar_id,getValue:function(){if(t&&t._vue_component_instance)return t._vue_component_instance.getPunchMode},setValue:function(p){t&&t._vue_component_instance&&t._vue_component_instance.setPunchMode(p)},remove:function(){return Y.unmountComponent(this.vue_control_bar_id)}};else{let p="punch";const b=document.querySelector(".punch-manual");b&&(b.style.display="none"),d.getProductEdition()>=15&&PermissionManager.validate(this.permission_id,"manual_timesheet")&&(p="manual"),this.toggle_button={getValue:()=>p,setValue:function(v){}}}}doNextIfNoValueChangeInManualGrid(e,i,t){!t&&(t="manual");var a=this;if(this.getPunchMode()===t&&this.editor){var s=this.editor.getValue();s.length>0?TAlertManager.showConfirmAlert(d.modify_alert_message,"",function(r){r?(a.wait_auto_save&&clearTimeout(a.wait_auto_save),e()):i&&i()}):e()}else e()}getPunchMode(){return this.toggle_button?this.toggle_button.getValue():"punch"}handleOverrideUserPreferenceCookie(e){this.timezone_btn.getValue()==!0?setCookie("OverrideUserPreference",window.btoa('{ "user_id": "'+e+'"}')):deleteCookie("OverrideUserPreference")}onWageOrModeChange(e){this.first_build=!0;var i=this;e==="wage"?this.doNextIfNoValueChangeInManualGrid(r,t):e==="timezone"?(this.handleOverrideUserPreferenceCookie(this.getSelectEmployee()),this.doNextIfNoValueChangeInManualGrid(r,a)):e==="manual"&&this.doNextIfNoValueChangeInManualGrid(r,s,"punch");function t(){i.wage_btn.setValue(!i.wage_btn.getValue(!0))}function a(){i.timezone_btn.setValue(!i.timezone_btn.getValue(!0))}function s(){i.toggle_button.setValue("manual")}function r(){i.edit_view||i.reSetURL(),i.search(),i.setDefaultMenu()}}setEmployeeNavArrowsStatus(){var e=this,i=l(this.el).find(".employee-nav-div"),t=i.find(".left-click"),a=i.find(".right-click"),s=e.employee_nav.getSelectIndex(),r=e.employee_nav.getSourceData();a.removeClass("disabled"),t.removeClass("disabled");var n=e.employee_nav.getPagerData(),o=e.employee_nav.getCurrentOpenPage();(!r||s===r.length-1&&o===n.last_page_number)&&a.addClass("disabled"),(!r||s===0&&o===1)&&t.addClass("disabled")}onClearSearch(){var e=!1,i;if(this.search_panel.getLayoutsArray()&&this.search_panel.getLayoutsArray().length>0){i=l(this.previous_saved_layout_selector).children("option:contains('"+BaseViewController.default_layout_name+"')").attr("value");var t=BaseViewController.default_layout_name;this.clearSearchPanel(),this.filter_data=null,this.temp_adv_filter_data=null,this.temp_basic_filter_data=null,e=!0}else{this.clearSearchPanel(),this.filter_data=null,this.temp_adv_filter_data=null,this.temp_basic_filter_data=null,this.column_selector&&this.column_selector.setSelectGridData(this.default_display_columns),this.sort_by_selector&&this.sort_by_selector.setValue(null),this.onSaveNewLayout(BaseViewController.default_layout_name);return}var a=d.convertLayoutFilterToAPIFilter({data:{filter_data:this.getValidSearchFilter()}}),s;e&&(s={},s.id=i,s.data={},s.data.filter_data=a);var r=this;this.user_generic_data_api.setUserGenericData(s,{onResult:function(n){n&&n.isValid()&&(r.clearViewLayoutCache(),r.need_select_layout_name=t,r.initLayout())}})}onUpdateLayout(){var e=l(this.previous_saved_layout_selector).children("option:selected").attr("value"),i=l(this.previous_saved_layout_selector).children("option:selected").text(),t=d.convertLayoutFilterToAPIFilter({data:{filter_data:this.getValidSearchFilter()}}),a={};a.id=e,a.data={},a.data.filter_data=t,a.data.mode=this.toggle_button.getValue(),a.data.show_wage=this.wage_btn.getValue(),a.data.use_employee_timezone=this.timezone_btn.getValue();var s=this;this.user_generic_data_api.setUserGenericData(a,{onResult:function(r){r&&r.isValid()&&(s.clearViewLayoutCache(),s.need_select_layout_name=i,s.initLayout())}})}onSaveNewLayout(e){var i;if(d.isSet(e)?i=e:i=this.save_search_as_input.getValue(),!(!i||i.length<1)){var t=d.convertLayoutFilterToAPIFilter({data:{filter_data:this.getValidSearchFilter()}}),a={};a.script=this.script_name,a.name=i,a.is_default=!1,a.data={},a.data.filter_data=t,a.data.mode=this.toggle_button.getValue(),a.data.show_wage=this.wage_btn.getValue(),a.data.use_employee_timezone=this.timezone_btn.getValue();var s=this;this.user_generic_data_api.setUserGenericData(a,{onResult:function(r){r&&r.isValid()?(s.clearViewLayoutCache(),s.need_select_layout_name=i,s.initLayout()):TAlertManager.showErrorAlert(r)}})}}onSearch(e){d.setUINotready(),TTPromise.add("init","init"),TTPromise.wait(),this.temp_adv_filter_data=null,this.temp_basic_filter_data=null,this.getSearchPanelFilter();var i,t;if(this.search_panel.getLayoutsArray()&&this.search_panel.getLayoutsArray().length>0){if(i=l(this.previous_saved_layout_selector).children("option:contains('"+BaseViewController.default_layout_name+"')").attr("value"),t=BaseViewController.default_layout_name,!i){this.onSaveNewLayout(BaseViewController.default_layout_name);return}}else{this.onSaveNewLayout(BaseViewController.default_layout_name);return}var a=d.convertLayoutFilterToAPIFilter({data:{filter_data:this.getValidSearchFilter()}}),s={};s.id=i,s.data={},s.data.filter_data=a,s.data.mode=this.toggle_button.getValue(),s.data.show_wage=this.wage_btn.getValue(),s.data.use_employee_timezone=this.timezone_btn.getValue(),ProgressBar.showOverlay();var r=this;this.user_generic_data_api.setUserGenericData(s,{onResult:function(n){n&&n.isValid()&&(r.clearViewLayoutCache(),r.need_select_layout_name=t,e||r.initLayout())}})}updateManualGrid(){var e=this,i=this.start_date_picker.getValue(),t=this.getSelectEmployee();ProgressBar.noProgressForNextCall(),e.handleOverrideUserPreferenceCookie(t),e.api_timesheet.getTimeSheetData(t,i,{onResult:function(a){ProgressBar.removeNanobar(),e.full_timesheet_data=a.getResult(),!(e.full_timesheet_data===!0||!e.full_timesheet_data.hasOwnProperty("timesheet_dates"))&&(e.full_timesheet_data=e.mergeJobQueueIntoTimeSheetData(e.full_timesheet_data),e.start_date=d.strToDate(e.full_timesheet_data.timesheet_dates.start_display_date),e.end_date=d.strToDate(e.full_timesheet_data.timesheet_dates.end_display_date),e.setDefaultMenu(),e.initInsideEditorData(!0),e.accumulated_time_source_map={},e.branch_source_map={},e.department_source_map={},e.job_source_map={},e.job_item_source_map={},e.punch_tag_source_map={},e.premium_source_map={},e.accumulated_total_grid_source_map={},e.accumulated_time_source=[],e.branch_source=[],e.department_source=[],e.job_source=[],e.job_item_source=[],e.punch_tag_source=[],e.premium_source=[],e.accumulated_total_grid_source=[],e.verification_grid_source=[],e.onReloadSubGridResult(a))}})}search(e,i){this.accumulated_time_cells_array=[],this.premium_cells_array=[],this.accumulated_time_source_map={},this.branch_source_map={},this.department_source_map={},this.job_source_map={},this.job_item_source_map={},this.punch_tag_source_map={},this.premium_source_map={},this.accumulated_total_grid_source_map={},this.accumulated_time_source=[],this.branch_source=[],this.department_source=[],this.job_source=[],this.job_item_source=[],this.punch_tag_source=[],this.premium_source=[],this.absence_source=[],this.accumulated_total_grid_source=[],this.punch_note_grid_source=[],this.verification_grid_source=[],this.select_cells_Array=[],this.select_punches_array=[],this.branch_cell_count=0,this.department_cell_count=0,this.premium_cell_count=0,this.job_cell_count=0,this.task_cell_count=0,this.punch_tag_cell_count=0,this.absence_cell_count=0,this.punch_note_account=0,this.select_punches_array=[];var t=this,a=d.convertLayoutFilterToAPIFilter(this.select_layout),s=this.start_date_picker?this.start_date_picker.getValue():"",r=this.getSelectEmployee();i?o():this.doNextIfNoValueChangeInManualGrid(o,n);function n(){l(".button-rotate").removeClass("button-rotate")}function o(){if(LocalCacheData.last_timesheet_selected_date=s,LocalCacheData.last_timesheet_selected_user=t.getSelectEmployee(),LocalCacheData.last_timesheet_selected_user){LocalCacheData.last_timesheet_selected_show_wage=t.wage_btn?t.wage_btn.getValue(!0):!1,LocalCacheData.last_timesheet_selected_timezone=t.timezone_btn?t.timezone_btn.getValue(!0):!1,t.toggle_button&&(LocalCacheData.last_timesheet_selected_punch_mode=t.toggle_button.getValue());var _={filter_data:a};if(ProgressBar.showOverlay(),!t.api_timesheet||!t.api_timesheet||typeof t.api_timesheet.getTimeSheetData!="function")return;r&&(t.handleOverrideUserPreferenceCookie(r),t.api_timesheet.getTimeSheetData(r,s,_,{onResult:function(u){t.full_timesheet_data=u.getResult(),!(t.full_timesheet_data===!0||!t.full_timesheet_data.hasOwnProperty("timesheet_dates"))&&(t.full_timesheet_data=t.mergeJobQueueIntoTimeSheetData(t.full_timesheet_data),t.start_date=d.strToDate(t.full_timesheet_data.timesheet_dates.start_display_date),t.end_date=d.strToDate(t.full_timesheet_data.timesheet_dates.end_display_date),t.buildCalendars(),e&&t.setDefaultMenu(!0),t.searchDone())}}))}}}buildVerificationGrid(){var e=[];if(!d.isSet(this.verification_grid)){var i=l(this.el).find("#verification_grid");i.attr("id",this.ui_id+"_verification_grid")}var t=this.ui_id+"_verification_grid",a={name:"pay_period",index:"pay_period",label:l.i18n._("Pay Period"),width:100,sortable:!1,title:!1};e.push(a),a={name:"verification",index:"verification",label:l.i18n._("Window"),width:100,sortable:!1,title:!1},e.push(a),this.verification_grid&&(this.verification_grid.unload(),this.verification_grid=null,this.grid_dic.verification_grid=null),this.verification_grid=this.grid_dic.verification_grid=new TTGrid(t,{hoverrows:!1,multiselectPosition:"none",verticalResize:!1,onResizeGrid:!1,height:0},e)}buildPunchNoteGrid(){var e=this,i=[];if(!d.isSet(this.punch_note_grid)){var t=l(this.el).find("#punch_note_grid");t.attr("id",this.ui_id+"_punch_note_grid")}var a={name:"invisible_column",index:"invisible_column",label:" ",width:1,sortable:!1,title:!1,hidden:!0};i.push(a);var s={name:"note",index:"note",label:" ",width:100,sortable:!1,title:!1,cellattr:function(o,_){return'title="'+_+'"'}};i.push(s);var r=this.ui_id+"_punch_note_grid";this.punch_note_grid&&(this.punch_note_grid.unload(),this.punch_note_grid=null,this.grid_dic.punch_note_grid=null),this.punch_note_grid=this.grid_dic.punch_note_grid=new TTGrid(r,{hoverrows:!1,multiselectPosition:"none",verticalResize:!1,height:0,onResizeGrid:function(){e.setPunchNoteGridWidth()}},i),this.setGridHeaderBar("punch_note_grid","Punch Notes");var n=l(this.grid_dic.punch_note_grid.grid).parents(".ui-jqgrid-view").find(".ui-jqgrid-hbox table");n.css("width","100%")}getAccumulatedTotalGridPayperiodHeader(){this.pay_period_header=l.i18n._("No Pay Period");var e=this.timesheet_verify_data.pay_period_id;if(e&&this.pay_period_data)for(var i in this.pay_period_data){var t=this.pay_period_data[i];if(t.id===e){var a=d.strToDate(t.start_date).format(),s=d.strToDate(t.end_date).format();this.pay_period_header=a+" "+l.i18n._("to")+" "+s;break}}}buildAccumulatedTotalGrid(){var e=[];if(!d.isSet(this.accumulated_total_grid)){var i=l(this.el).find("#accumulated_total_grid");i.attr("id",this.ui_id+"_accumulated_total_grid"),i=l(this.el).find("#"+this.ui_id+"_accumulated_total_grid")}var t=500;this.wage_btn.getValue(!0)&&(t=600);var a=100;this.wage_btn.getValue(!0)&&(a=null);var s={name:"punch_info",index:"punch_info",label:" ",width:a,sortable:!1,title:!1,formatter:this.onCellFormat};e.push(s);var r=this.start_date.format(d.getLoginUserDateFormat()),n=this.end_date.format(d.getLoginUserDateFormat());this.getAccumulatedTotalGridPayperiodHeader();var o=100;this.wage_btn.getValue(!0)&&(o=150);var _={name:"week",index:"week",label:r+" "+l.i18n._("to")+" "+n,width:o,sortable:!1,title:!1,formatter:this.onCellFormat},u={name:"pay_period",index:"pay_period",label:this.pay_period_header,width:o,sortable:!1,title:!1,formatter:this.onCellFormat};e.push(_),e.push(u);var m=this.ui_id+"_accumulated_total_grid";d.isSet(this.accumulated_total_grid)==!0&&(this.accumulated_total_grid.unload(),this.accumulated_total_grid=null,this.grid_dic.accumulated_total_grid=null),this.accumulated_total_grid=this.grid_dic.accumulated_total_grid=new TTGrid(m,{hoverrows:!1,multiselectPosition:"none",verticalResize:!1,onResizeGrid:!1,width:t,height:0},e);var h=l(this.el).find(".accumulated-total-grid-title");h.css("display","block"),this.setAccumulatedTotalGridPayPeriodHeaders(t)}bindGridColumnEvents(){}bindTimeSheetGridColumnEvents(){var e=this.grid.getGridParam("colModel");if(!e)return;var i=e.length;this.t_grid_header_array=[];for(var t=0;t<i;t++){var a=e[t],s=l(l(this.el).find("#gbox_"+this.ui_id+"_grid").find("div #jqgh_"+this.ui_id+"_grid_"+a.name));this.t_grid_header_array.push(s.TGridHeader()),s.bind("click",n)}var r=this;function n(o){var _=l(this).attr("id");if(_=_.substring(10+r.ui_id.length+1,_.length),!(_==="cb"||_==="punch_info")){var u=d.strToDate(_,r.full_format);u&&u.getYear()>0&&(r.setDatePickerValue(u.format(d.getLoginUserDateFormat())),r.highLightSelectDay(),l(l(".timesheet-grid tr#1 td")[l("th.highlight-header").index()]).click())}}}checkIsSelectedAbsenceCell(e,i){for(var t=0,a=this.absence_select_cells_Array.length;t<a;t++){var s=this.absence_select_cells_Array[t];if(s.row_id==e&&s.cell_index===i)return!0}return!1}buildAbsenceGrid(){var e=this,i="absence_grid",t=l.i18n._("Absence");if(this[i])this[i].unload(),this[i]=null,this.grid_dic[i]=null;else{var a=l(this.el).find("#absence_grid");a.attr("id",this.ui_id+"_absence_grid"),a=l(this.el).find("#"+this.ui_id+"_absence_grid")}this[i]=this.grid_dic[i]=new TTGrid(this.ui_id+"_absence_grid",{sortable:!1,hoverrows:!1,height:0,ondblClickRow:function(){e.onGridDblClickRow("absence")},onRightClickRow:function(s,r,n,o){if(!e.checkIsSelectedAbsenceCell(s,n)){var _=l(o.target).closest("td,th").html();e.onCellSelect("absence_grid",s,n,_,this,o),e.onSelectRow("absence_grid",s,this),l(".edit-view:visible").length==0?e.setDefaultMenu():e.setEditMenu()}},onCellSelect:function(s,r,n,o){l(".edit-view:visible").length==0?e.setDefaultMenu():e.setEditMenu()},onResizeGrid:function(){e.absence_grid&&e.absence_grid.getGridWidth()!=e.getTimeSheetWidth()&&e.absence_grid.setGridWidth(e.getTimeSheetWidth())},beforeSelectRow:function(s,r){r.preventDefault();var n=0;l(r.target).attr("role")=="gridcell"?n=l(r.target).index():n=l(r.target).parents("td").index();var o=l(r.target).text();return e.onCellSelect("absence_grid",s,n,o,this,r),e.onSelectRow("absence_grid",s,this),!1},multiselectPosition:"none",winMultiSelect:!1,verticalResize:!1},this.timesheet_columns,l.i18n._("Absence")),this.bindTimeSheetGridColumnEvents(),this.setGridHeaderBar(i,t),this.grid_dic[i]&&this.grid_dic[i].grid&&this.grid_dic.absence_grid.grid.setGridWidth(this.getTimeSheetWidth())}checkIsSelectedPunchCell(e,i){for(var t=0,a=this.select_cells_Array.length;t<a;t++){var s=this.select_cells_Array[t];if(s.row_id==e&&s.cell_index==i)return!0}return!1}colorTimeSheetRows(){for(var e=l(".timesheet-grid-div .timesheet-grid tr"),i=0,t=0,a=1;a<e.length-1;a++)i==2&&t<2?(l(e[a]).addClass("ui-priority-secondary"),t++):t==2?(i=1,t=0):i++}buildTimeSheetGrid(){var e=this.ui_id+"_grid",i=this;if(this.timesheet_grid&&!this.first_build)l.jgrid.guid=1;else{this.timesheet_grid&&(this.timesheet_grid.unload(),this.timesheet_grid=null,l.jgrid.guid=1);var t=l(this.el).find("#timesheet_grid");t.attr("id",e);var a={container_selector:".context-border",altRows:!1,sortable:!1,hoverrows:!1,height:0,ondblClickRow:function(s,r,n,o){var _=i.getRowData("timesheet_grid",s);_.type!==P.REQUEST_ROW&&i.onGridDblClickRow()},onRightClickRow:function(s,r,n,o){if(!i.checkIsSelectedPunchCell(s,n)){var _=l(o.target).closest("td,th").html();i.onCellSelect("timesheet_grid",s,n,_,this,o),i.onSelectRow("timesheet_grid",s,this),l(".edit-view:visible").length==0?i.setDefaultMenu():i.setEditMenu()}},onCellSelect:function(s,r,n,o){l(".edit-view:visible").length==0?i.setDefaultMenu():i.setEditMenu()},onResizeGrid:function(){i.getPunchMode()==="manual"&&i.editor&&i.setManualTimeSheetGridSize(),i.setGridSize(),i.setTimeSheetGridPayPeriodHeaders(),i.setTimeSheetGridHolidayHeaders()},gridComplete:function(){i.colorTimeSheetRows()},beforeSelectRow:function(s,r){r.preventDefault();var n=0;l(r.target).attr("role")=="gridcell"?n=l(r.target).index():n=l(r.target).parents("td").index();var o=l(r.target).text();return i.onCellSelect("timesheet_grid",s,n,o,this,r),i.onSelectRow("timesheet_grid",s,this),!1},multiselectPosition:"none",winMultiSelect:!1,verticalResize:!1};this.timesheet_grid=this.grid_dic.timesheet_grid=this.grid=new TTGrid(e,a,this.timesheet_columns),this.grid_dic.timesheet_grid.grid.setGridWidth(this.getTimeSheetWidth())}this.grid_div.scroll(function(s){i.scroll_position=i.grid_div.scrollTop()})}onGridDblClickRow(e){for(var i=ContextMenuManager.getMenuModelByMenuId(this.determineContextMenuMountAttributes().id),t=i.length,a=!1,s=0;s<t&&!a;s++)switch(i[s].id){case"edit":if(!i[s].disabled&&i[s].visible){ProgressBar.showOverlay(),this.onEditClick();return}break}for(var s=0;s<t&&!a;s++)switch(i[s].id){case"view":if(a=!0,!i[s].disabled&&i[s].visible){ProgressBar.showOverlay(),this.onViewClick();return}break}for(var s=0;s<t;s++){let n=i[s].id;switch(n){case"add_absence":case"add":case"add_punch":if(e=="absence"&&n!="add_absence")continue;if(!i[s].disabled&&i[s].visible){this.isPunchCells()&&(ProgressBar.showOverlay(),this.onAddClick());return}break}}if(!this.addPermissionValidate("punch")){MenuManager.openSelectView("InOut");return}}isPunchCells(){var e=!1,i=this.select_cells_Array&&this.select_cells_Array.length>0&&this.select_cells_Array[0],t=i&&this.timesheet_data_source[parseInt(i.row_id)-1];return(t&&t.type===P.PUNCH_ROW||this.absence_select_cells_Array&&this.absence_select_cells_Array.length>0)&&(e=!0),e}buildAccumulatedGrid(){var e=this,i="accumulated_time_grid",t=l.i18n._("Accumulated Time");this[i]&&(this[i].unload(),this[i]=null,this.grid_dic[i]=null),this[i]=this.grid_dic[i]=new TTGrid("accumulated_time_grid",{sortable:!1,hoverrows:!1,height:0,ondblClickRow:function(){e.onAccumulatedTimeClick()},onRightClickRow:function(a,s,r,n){var o=l(n.target).closest("td,th").html();e.onCellSelect("accumulated_grid",a,r,o,this,n),e.onSelectRow("accumulated_grid",a,this)},onCellSelect:function(a,s,r,n){e.setDefaultMenu()},onResizeGrid:function(){e.grid_dic.accumulated_time_grid&&e.grid_dic.accumulated_time_grid.grid.setGridWidth(e.getTimeSheetWidth())},beforeSelectRow:function(a,s){s.preventDefault();var r=0;l(s.target).attr("role")=="gridcell"?r=l(s.target).index():r=l(s.target).parents("td").index();var n=l(s.target).text();return e.onCellSelect("accumulated_grid",a,r,n,this,s),e.onSelectRow("accumulated_grid",a,this),!1},multiselectPosition:"none",winMultiSelect:!1,verticalResize:!1},this.timesheet_columns),this.setGridHeaderBar(i,t),this.grid_dic[i]&&this.grid_dic[i].grid&&this.grid_dic[i].grid.setGridWidth(this.getTimeSheetWidth())}buildSubGrid(e,i){var t=this,a=this.ui_id+"_"+e;if(!d.isSet(this[e])){var s=l(this.el).find("#"+e);s.attr("id",a)}this[e]&&(this[e].unload(),this[e]=null,this.grid_dic[e]=null),e==="premium_grid"?(this[e]=this.grid_dic[e]=new TTGrid(a,{hoverrows:!1,multiselectPosition:"none",winMultiSelect:!1,height:0,onSelectRow:function(r,n,o){t.onSelectRow("premium_grid",r,this)},onRightClickRow:function(r,n,o,_){var u=l(_.target).closest("td,th").html();t.onCellSelect("premium_grid",r,o,u,this,_),t.onSelectRow("premium_grid",r,this)},onCellSelect:function(r,n,o,_){t.unsetSelectedCells("timesheet_grid"),t.unsetSelectedCells("absence_grid"),t.onCellSelect("premium_grid",r,n,o,this,_),t.select_punches_array=[],t.setDefaultMenu()},ondblClickRow:function(){e==="premium_grid"&&t.onAccumulatedTimeClick()},onResizeGrid:function(){t.grid_dic[e]&&t.grid_dic[e].grid.setGridWidth(t.getTimeSheetWidth())},verticalResize:!1},this.timesheet_columns),this[e]&&this[e].grid&&this[e].grid.addClass("premium-grid")):this[e]=this.grid_dic[e]=new TTGrid(a,{hoverrows:!1,multiselectPosition:"none",winMultiSelect:!1,height:0,onCellSelect:function(r,n,o,_){t.unsetSelectedCells("timesheet_grid"),t.unsetSelectedCells("absence_grid"),t.onCellSelect(e,r,n,o,this,_),t.select_punches_array=[],t.setDefaultMenu()},onResizeGrid:function(){t.grid_dic[e]&&t.grid_dic[e].grid.setGridWidth(t.getTimeSheetWidth())},verticalResize:!1},this.timesheet_columns),this.setGridHeaderBar(e,i),this.grid_dic[e]&&this.grid_dic[e].grid&&this.grid_dic[e].grid.setGridWidth(this.getTimeSheetWidth())}setGridSExpendOrCollapseStatus(e,i){if(this.grid_dic[e]){var t=this.grid_dic[e].grid,a=l(l(this.el).find("table[aria-labelledby=gbox_"+this.ui_id+"_"+e+"]")[0]);a.find(".title-bar"),this.setGridHeight(e),LocalCacheData.timesheet_sub_grid_expended_dic[e]!==!0&&t.setGridHeight(0),this.updateGridHeaderBar(e,i)}}setGridExpendButton(e,i){var t=this,a=l(l(this.el).find("table[aria-labelledby=gbox_"+this.ui_id+"_"+e+"]")[0]),s=a.find(".title-bar");if(s.find(".grid-expend-btn").length===0){var r=l("<img>");r.addClass("grid-expend-btn"),!d.isSet(LocalCacheData.timesheet_sub_grid_expended_dic[e])||LocalCacheData.timesheet_sub_grid_expended_dic[e]===!0?(r.attr("src",d.getRealImagePath("images/big_collapse.png")),LocalCacheData.timesheet_sub_grid_expended_dic[e]=!0):(r.attr("src",d.getRealImagePath("images/big_expand.png")),LocalCacheData.timesheet_sub_grid_expended_dic[e]=!1),s.append(r),this.setGridSExpendOrCollapseStatus(e,i),r.click(function(n){LocalCacheData.timesheet_sub_grid_expended_dic[e]===!0?(l(this).attr("src",d.getRealImagePath("images/big_expand.png")),LocalCacheData.timesheet_sub_grid_expended_dic[e]=!1,t.setGridSExpendOrCollapseStatus(e,i)):(l(this).attr("src",d.getRealImagePath("images/big_collapse.png")),LocalCacheData.timesheet_sub_grid_expended_dic[e]=!0,t.setGridSExpendOrCollapseStatus(e,i))})}}updateGridHeaderBar(e,i){var t=i,a=l(l(this.el).find("table[aria-labelledby=gbox_"+this.ui_id+"_"+e+"]")[0]),s=a.find(".title-span");if(LocalCacheData.timesheet_sub_grid_expended_dic[e]!==!0)switch(e){case"branch_grid":t=t+" ("+this.branch_cell_count+")";break;case"department_grid":t=t+" ("+this.department_cell_count+")";break;case"job_item_grid":t=t+" ("+this.task_cell_count+")";break;case"punch_tag_grid":t=t+" ("+this.punch_tag_cell_count+")";break;case"job_grid":t=t+" ("+this.job_cell_count+")";break;case"premium_grid":t=t+" ("+this.premium_cell_count+")";break;case"absence_grid":t=t+" ("+this.absence_cell_count+")";break;case"punch_note_grid":t=t+" ("+this.punch_note_account+")";break}s.text(t)}setGridHeaderBar(e,a){var t=l(this.grid_dic[e].grid).parents(".ui-jqgrid-view").find(".ui-jqgrid-hbox table");t.css("width","100vw");var a=l.i18n._(a);t.find("tr:first").hide();var s=l("<div class='title-bar'><span class='title-span'>"+a+"</span></div>");t.append(s)}buildManualTimeSheetsColumns(){this.day_dic={};for(var e=0;e<7;e++){var i=new Date(new Date(this.start_date.getTime()).setDate(this.start_date.getDate()+e)),t=i.format(this.day_format),a=i.format(this.date_format);this.day_dic["day_"+e]={value:t+"<br>"+a,field:i.format()}}}getManualTimeSheetData(e){var i=this,t=this.getSelectEmployee();if(t){var a={};a.filter_data={user_id:t,object_type_id:10,start_date:this.start_date.format(),end_date:this.end_date.format()},a.filter_columns={id:!0,date_stamp:!0,total_time:!0,object_type:!0,name:!0,branch_id:!0,department_id:!0,branch:!0,department:!0,job:!0,job_item:!0,job_id:!0,job_item_id:!0,punch_tag:!0,punch_tag_id:!0,note:!0,override:!0},this.api_user_date_total.getUserDateTotal(a,!0,{onResult:function(s){i.manual_timesheet_data=s.getResult(),e()}})}}buildManualTimeSheetData(){this.time_sheet_data_overrode_true_map={},this.time_sheet_data_overrode_false_map={};var e=["branch_id","department_id","job_id","job_item_id","punch_tag_id"],i=[],t=[],a=[];this.manual_timesheet_data.sort(d.m_sort_by(e)),i=H.groupBy(this.manual_timesheet_data,"override"),t=i[!0],a=i[!1],s(t,this.time_sheet_data_overrode_true_map),s(a,this.time_sheet_data_overrode_false_map);function s(r,n){!r&&(r=[]);for(var o=0,_=r.length;o<_;o++){var u=r[o],m=u.branch_id+"-"+u.department_id+"-"+u.job_id+"-"+u.job_item_id;if(!n[m])n[m]={},n[m].branch_id=u.branch_id,n[m].department_id=u.department_id,n[m].job_id=u.job_id,n[m].job_item_id=u.job_item_id,n[m].punch_tag_id=u.punch_tag_id,n[m].branch=u.branch,n[m].department=u.department,n[m].job=u.job,n[m].job_item=u.job_item,n[m].punch_tag=u.punch_tag,n[m].override=u.override,n[m][u.date_stamp]=u;else if(n[m][u.date_stamp])for(var h=1;;)if(n[m+"-"+h])if(n[m+"-"+h][u.date_stamp])h=h+1;else{n[m+"-"+h][u.date_stamp]=u;break}else{n[m+"-"+h]={},n[m+"-"+h].branch_id=u.branch_id,n[m+"-"+h].department_id=u.department_id,n[m+"-"+h].job_id=u.job_id,n[m+"-"+h].job_item_id=u.job_item_id,n[m+"-"+h].punch_tag_id=u.punch_tag_id,n[m+"-"+h].branch=u.branch,n[m+"-"+h].department=u.department,n[m+"-"+h].job=u.job,n[m+"-"+h].punch_tag=u.punch_tag,n[m+"-"+h].override=u.override,n[m+"-"+h][u.date_stamp]=u;break}else n[m][u.date_stamp]=u}}}buildManualNotes(e,i){for(let t in e){let a=e[t],s=!1;for(let r=0;r<7;r++){let n=new Date(new Date(this.start_date.getTime()).setDate(this.start_date.getDate()+r)).format();if(typeof a.getField=="function"&&a.getField()===n){i[n]||(s=!0);break}}if(typeof a.getField=="function"&&a.getEnabled()&&(s||i[a.getField()]&&i[a.getField()].id)){let r="";if(s?r="id-"+V.generateUUID():r="id-"+i[a.getField()].id,document.getElementById(r))continue;let n="";s||(n=i[a.getField()].note||"");let o=document.createElement("div");o.id=r,o.className="timesheet-manual-note",a[0].parentNode.prepend(o),a[0].style.position="inherit",Y.mountComponent(r,Re,{id:r,starting_note:n,field_reference:a}),this.manual_note_component_ids.push(r),this.event_bus.on(r,"saveNote",_=>{i[a.getField()]||(i[a.getField()]={}),i[a.getField()].note=_.note,e.is_changed=!0,this.onSaveClick()},TTEventBusStatics.AUTO_CLEAR_ON_EXIT)}}}initInsideEditorData(e){!e&&this.manual_note_component_ids.length>0&&this.manual_note_component_ids.forEach(s=>{Y.unmountComponent(s)});var i=this;for(var t in this.day_dic)this.$("#"+t+"_date").html(this.day_dic[t].value),this.$("#"+t+"_date").addClass("manual_grid_day_"+d.strToDate(this.day_dic[t].field).format(this.full_format)),this.$("#"+t+"_date").attr("current_date","manual_grid_day_"+d.strToDate(this.day_dic[t].field).format(this.full_format)),this.$("#"+t+"_date").unbind("click").bind("click",function(s){var r=s.currentTarget,n=l(r).attr("current_date");n=n.substring(16,n.length);var o=d.strToDate(n,i.full_format);o&&o.getYear()>0&&(i.setDatePickerValue(o.format(d.getLoginUserDateFormat())),i.highLightSelectDay(),i.reLoadSubGridsSource())}),this.$(".is-saving-manual-grid").removeClass("is-saving-manual-grid");this.is_auto_switch?(this.is_auto_switch=!1,a()):this.getManualTimeSheetData(function(){a()});function a(){if(i.is_saving_manual_grid=!1,i.setDefaultMenu(),!e)i.editor.removeAllRows(),i.manual_timesheet_data.length>0?(i.buildManualTimeSheetData(),H.map(i.time_sheet_data_overrode_false_map,function(m){i.editor.addRow(m)}),H.map(i.time_sheet_data_overrode_true_map,function(m){i.editor.addRow(m)}),H.isEmpty(i.time_sheet_data_overrode_true_map)&&i.editor.addRow()):i.editor.addRow();else if(i.manual_timesheet_data.length>0){i.buildManualTimeSheetData();for(var s in i.time_sheet_data_overrode_true_map){var r=i.time_sheet_data_overrode_true_map[s];for(var n in r){var o=r[n];if(!(Array.isArray(o)||!H.isObject(o))){var _=i.generateManualTimeSheetRecordKey(o),u=o.id+"-"+_;i.manual_grid_records_map[u]?(i.manual_grid_records_map[u][o.date_stamp].setValue(o.total_time),i.buildManualNotes(i.manual_grid_records_map[u],r)):i.manual_grid_records_map[_]&&(i.manual_grid_records_map[_].current_edit_item[o.date_stamp]=o,i.manual_grid_records_map[_][o.date_stamp].setValue(o.total_time),i.buildManualNotes(i.manual_grid_records_map[_],r))}}}}if(i.save_manual_grid_after_save){i.autoSaveManualPunch(),i.save_manual_grid_after_save=!1;return}}}insideEditorAddRow(e,i){var t=this;if(d.getProductEdition()>=20)var a=TTAPI.APIJobItem,s=TTAPI.APIJob,r=TTAPI.APIPunchTag,n=TTAPI.APIDepartment;var o;if(!e&&(e={},i>=0)){var _=this.rows_widgets_array[i-3];this.parent_controller.show_branch_ui&&(_.branch_id?e.branch_id=_.branch_id.getValue():_.current_edit_item&&_.current_edit_item.branch_id?e.branch_id=_.current_edit_item.branch_id:e.branch_id=!1),this.parent_controller.show_department_ui&&(_.department_id?e.department_id=_.department_id.getValue():_.current_edit_item&&_.current_edit_item.department_id?e.department_id=_.current_edit_item.department_id:e.department_id=!1),this.parent_controller.show_job_ui&&d.getProductEdition()>=20&&(_.job_id?e.job_id=_.job_id.getValue():_.current_edit_item&&_.current_edit_item.job_id?e.job_id=_.current_edit_item.job_id:e.job_id=!1),this.parent_controller.show_job_item_ui&&d.getProductEdition()>=20&&(_.job_item_id?e.job_item_id=_.job_item_id.getValue():_.current_edit_item&&_.current_edit_item.job_item_id?e.job_item_id=_.current_edit_item.job_item_id:e.job_item_id=!1),this.parent_controller.show_punch_tag_ui&&d.getProductEdition()>=20&&(_.punch_tag_id?e.punch_tag_id=_.punch_tag_id.getValue():_.current_edit_item&&_.current_edit_item.punch_tag_id?e.punch_tag_id=_.current_edit_item.punch_tag_id:e.punch_tag_id=!1)}var u=this.getRowRender(),m=this.getRender(),h={},c;if(this.parent_controller.show_branch_ui)if(e.hasOwnProperty("override")&&!e.override)c=d.loadWidgetByName(FormItemType.TEXT),c.TText({field:"branch"}),c.setValue(e.branch),u.children().eq(2).append(c);else{c=d.loadWidgetByName(FormItemType.AWESOME_BOX),c.AComboBox({api_class:TTAPI.APIBranch,width:90,layout_name:"global_branch",show_search_inputs:!0,set_empty:!0,field:"branch_id",is_static_width:!0}),h[c.getField()]=c,o={},o.filter_data={user_id:this.parent_controller.getSelectEmployee()},c.setDefaultArgs(o);var g=e.hasOwnProperty("branch_id")?e.branch_id:this.parent_controller.getSelectEmployee(!0).default_branch_id;c.setValue(e.hasOwnProperty("branch_id")?e.branch_id:this.parent_controller.getSelectEmployee(!0).default_branch_id),u.children().eq(2).append(c)}else u.children().eq(2).hide();if(this.parent_controller.show_department_ui)if(e.hasOwnProperty("override")&&!e.override)c=d.loadWidgetByName(FormItemType.TEXT),c.TText({field:"department"}),c.setValue(e.department),u.children().eq(3).append(c);else{c=d.loadWidgetByName(FormItemType.AWESOME_BOX),c.AComboBox({api_class:TTAPI.APIDepartment,width:90,layout_name:"global_department",show_search_inputs:!0,set_empty:!0,field:"department_id",is_static_width:!0}),h[c.getField()]=c,o={},o.filter_data={user_id:this.parent_controller.getSelectEmployee(),branch_id:g},c.setDefaultArgs(o);var p=e.hasOwnProperty("department_id")?e.department_id:this.parent_controller.getSelectEmployee(!0).default_department_id;c.setValue(e.hasOwnProperty("department_id")?e.department_id:this.parent_controller.getSelectEmployee(!0).default_department_id),u.children().eq(3).append(c)}else u.children().eq(3).hide();if(this.parent_controller.show_job_ui&&d.getProductEdition()>=20)if(e.hasOwnProperty("override")&&!e.override)c=d.loadWidgetByName(FormItemType.TEXT),c.TText({field:"job"}),c.setValue(e.job),u.children().eq(4).append(c);else{var b=d.loadWidgetByName(FormItemType.AWESOME_BOX);b.AComboBox({api_class:TTAPI.APIJob,width:90,layout_name:"global_job",show_search_inputs:!0,set_empty:!0,always_include_columns:["group_id"],field:"job_id",is_static_width:!0,setRealValueCallBack:function(C){C&&f.setValue(C.manual_id)}}),h[b.getField()]=b,o={},o.filter_data={status_id:10,user_id:this.parent_controller.getSelectEmployee()},b.setDefaultArgs(o);var v=e.hasOwnProperty("job_id")?e.job_id:this.parent_controller.getSelectEmployee(!0).default_job_id;b.setValue(v);var f=d.loadWidgetByName(FormItemType.TEXT_INPUT);f.TTextInput({field:"job_quick_search",disable_keyup_event:!0,width:30}),f.css("display","inline-block"),b.css("display","inline-block"),u.children().eq(4).append(f),u.children().eq(4).append(b),f.unbind("formItemChange").bind("formItemChange",function(C,w){j(w.getField(),w.getValue())})}else u.children().eq(4).hide();if(this.parent_controller.show_job_item_ui&&d.getProductEdition()>=20)if(e.hasOwnProperty("override")&&!e.override)c=d.loadWidgetByName(FormItemType.TEXT),c.TText({field:"job_item"}),c.setValue(e.job_item),u.children().eq(5).append(c);else{c=d.loadWidgetByName(FormItemType.AWESOME_BOX),c.AComboBox({api_class:TTAPI.APIJobItem,width:90,layout_name:"global_job_item",show_search_inputs:!0,set_empty:!0,always_include_columns:["group_id"],field:"job_item_id",is_static_width:!0,setRealValueCallBack:function(C){C&&M.setValue(C.manual_id)}}),o={},o.filter_data={status_id:10,job_id:v},c.setDefaultArgs(o);var A=e.hasOwnProperty("job_item_id")?e.job_item_id:this.parent_controller.getSelectEmployee(!0).default_job_item_id;c.setValue(e.hasOwnProperty("job_item_id")?e.job_item_id:this.parent_controller.getSelectEmployee(!0).default_job_item_id);var M=d.loadWidgetByName(FormItemType.TEXT_INPUT);M.TTextInput({field:"job_item_quick_search",disable_keyup_event:!0,width:30}),h[c.getField()]=c,M.css("display","inline-block"),c.css("display","inline-block"),u.children().eq(5).append(M),u.children().eq(5).append(c),M.unbind("formItemChange").bind("formItemChange",function(C,w){j(w.getField(),w.getValue())})}else u.children().eq(5).hide();this.parent_controller.show_punch_tag_ui&&d.getProductEdition()>=20?e.hasOwnProperty("override")&&!e.override?(c=d.loadWidgetByName(FormItemType.TEXT),c.TText({field:"punch_tag"}),c.setValue(e.punch_tag),u.children().eq(6).append(c)):(c=d.loadWidgetByName(FormItemType.AWESOME_BOX),c.AComboBox({api_class:TTAPI.APIPunchTag,allow_multiple_selection:!0,width:90,layout_name:"global_punch_tag",show_search_inputs:!0,set_empty:!0,always_include_columns:["group_id"],field:"punch_tag_id",is_static_width:!0}),o={},o.filter_data={status_id:10,user_id:this.parent_controller.getSelectEmployee(!0).id,branch_id:g,department_id:p,job_id:v,job_item_id:A},c.setDefaultArgs(o),c.setValue(e.hasOwnProperty("punch_tag_id")?e.punch_tag_id:this.parent_controller.getSelectEmployee(!0).default_punch_tag_id),h[c.getField()]=c,c.css("display","inline-block"),u.children().eq(6).append(c)):u.children().eq(6).hide(),c=d.loadWidgetByName(FormItemType.TEXT_INPUT),c.TTextInput({field:this.parent_controller.day_dic.day_0.field,width:55,mode:"time_unit",need_parser_sec:!0,do_validate:!1}),c.setValue(e[c.getField()]?e[c.getField()].total_time:0),h[c.getField()]=c,u.children().eq(7).append(c),c=d.loadWidgetByName(FormItemType.TEXT_INPUT),c.TTextInput({field:this.parent_controller.day_dic.day_1.field,width:55,mode:"time_unit",need_parser_sec:!0,do_validate:!1}),c.setValue(e[c.getField()]?e[c.getField()].total_time:0),h[c.getField()]=c,u.children().eq(8).append(c),c=d.loadWidgetByName(FormItemType.TEXT_INPUT),c.TTextInput({field:this.parent_controller.day_dic.day_2.field,width:55,mode:"time_unit",need_parser_sec:!0,do_validate:!1}),c.setValue(e[c.getField()]?e[c.getField()].total_time:0),h[c.getField()]=c,u.children().eq(9).append(c),c=d.loadWidgetByName(FormItemType.TEXT_INPUT),c.TTextInput({field:this.parent_controller.day_dic.day_3.field,width:55,mode:"time_unit",need_parser_sec:!0,do_validate:!1}),c.setValue(e[c.getField()]?e[c.getField()].total_time:0),h[c.getField()]=c,u.children().eq(10).append(c),c=d.loadWidgetByName(FormItemType.TEXT_INPUT),c.TTextInput({field:this.parent_controller.day_dic.day_4.field,width:55,mode:"time_unit",need_parser_sec:!0,do_validate:!1}),c.setValue(e[c.getField()]?e[c.getField()].total_time:0),h[c.getField()]=c,u.children().eq(11).append(c),c=d.loadWidgetByName(FormItemType.TEXT_INPUT),c.TTextInput({field:this.parent_controller.day_dic.day_5.field,width:55,mode:"time_unit",need_parser_sec:!0,do_validate:!1}),c.setValue(e[c.getField()]?e[c.getField()].total_time:0),h[c.getField()]=c,u.children().eq(12).append(c),c=d.loadWidgetByName(FormItemType.TEXT_INPUT),c.TTextInput({field:this.parent_controller.day_dic.day_6.field,width:55,mode:"time_unit",need_parser_sec:!0,do_validate:!1}),c.setValue(e[c.getField()]?e[c.getField()].total_time:0),h[c.getField()]=c,u.children().eq(13).append(c),e.hasOwnProperty("override")&&!e.override&&u.children().eq(1).children().hide();var T=!1,S=!1,D=!1;for(var I in h){var y=h[I],F=0;for(var J in this.parent_controller.full_timesheet_data.pay_period_data)this.parent_controller.full_timesheet_data.pay_period_data[J].status_id!=10&&this.parent_controller.full_timesheet_data.pay_period_data[J].status_id!=30&&F++;if(F>0&&F==Object.keys(this.parent_controller.full_timesheet_data.pay_period_data).length&&this.parent_controller.full_timesheet_data.punch_data.length!=0&&(T=!0,S=!0,Object.keys(e).length==0))return;if(this.parent_controller.full_timesheet_data.pay_period_data[this.parent_controller.full_timesheet_data.timesheet_dates.pay_period_date_map[y.getField()]]){var O=parseInt(this.parent_controller.full_timesheet_data.pay_period_data[this.parent_controller.full_timesheet_data.timesheet_dates.pay_period_date_map[y.getField()]].status_id);O!=10&&O!=30&&(y.setEnabled&&y.setEnabled(!1),y.getField()!="branch_id"&&y.getField()!="department_id"&&y.getField()!="job_id"&&y.getField()!="job_item_id"&&y.getField()!="punch_tag_id"&&typeof e[y.getField()]<"u"&&(D=!0,S=!0))}e.hasOwnProperty("override")&&!e.override&&(y.setEnabled&&y.setEnabled(!1),y.getValue()>0&&y.hasClass("t-text-input")>=0&&y.css("color","red")),y.unbind("formItemChange").bind("formItemChange",function(C,w){w.is_changed=!0,w.getField()==="job_id"?(h.is_changed=!0,f.setValue(w.getValue(!0)&&w.getValue(!0).manual_id?w.getValue(!0).manual_id:""),B(w.getValue(!0)),Q()):w.getField()==="job_item_id"?(h.is_changed=!0,M.setValue(w.getValue(!0)&&w.getValue(!0).manual_id?w.getValue(!0).manual_id:""),Q()):w.getField()==="branch_id"?(h.is_changed=!0,d.getProductEdition()>=20&&L()):(w.getField()==="department_id"||w.getField()==="punch_tag_id")&&(h.is_changed=!0),t.parent_controller.autoSaveManualPunch()})}if(D)for(var I in h){var y=h[I];(y.getField()=="branch_id"||y.getField()=="department_id"||y.getField()=="job_id"||y.getField()=="job_item_id")&&((y.getField()=="job_id"||y.getField()=="job_item_id"||y.getField()=="punch_tag_id")&&y.parents("td").find('input[type="text"]').hide(),y.setEnabled&&y.setEnabled(!1))}T==!0&&u.find(".plus-icon").hide(),S==!0&&u.find(".minus-icon").hide(),typeof i<"u"?(u.insertAfter(l(m).find("tr").eq(i)),this.rows_widgets_array.splice(i,0,h)):(l(m).append(u),this.rows_widgets_array.push(h)),t.parent_controller.buildManualNotes(h,e),h.current_edit_item=e,this.addIconsEvent(u);function j(C,w){var E={};C==="job_quick_search"?(E.filter_data={manual_id:w,user_id:t.parent_controller.getSelectEmployee(),status_id:"10"},s.getJob(E,{onResult:function(R){var x=R.getResult();h.is_changed=!0,t.parent_controller.autoSaveManualPunch(),x.length>0?(h.job_id.setValue(x[0].id),B(x[0])):(h.job_id.setValue(""),B(!1))}})):C==="job_item_quick_search"&&(E.filter_data={manual_id:w,job_id:h.job_id.getValue(),status_id:"10"},a.getJobItem(E,{onResult:function(R){var x=R.getResult();h.is_changed=!0,t.parent_controller.autoSaveManualPunch(),x.length>0?h.job_item_id.setValue(x[0].id):h.job_item_id.setValue("")}}))}function B(C){var w=h.job_item_id;if(!w)return;var E=w.getValue();w.setSourceData(null);var R={};if(R.filter_data={status_id:10,job_id:h.job_id.getValue()},w.setDefaultArgs(R),E){var x=d.clone(R);x.filter_data.id=E,x.filter_columns=w.getColumnFilter(),a.getJobItem(x,{onResult:function(N){var W=N.getResult();W.length>0?w.setValue(E):U()}})}else U();function U(){h.job_id.getValue()?(w.setValue(C.default_item_id),(C.default_item_id===!1||C.default_item_id===0)&&M.setValue("")):(w.setValue(""),M.setValue(""))}}function L(){var C=h.department_id;if(!C)return;C.setSourceData(null);var w={};w.filter_data={user_id:t.parent_controller.getSelectEmployee(!0).id,branch_id:h.branch_id.getValue()};var E=C.getValue();if(C.setDefaultArgs(w),E){var R=d.clone(w);R.filter_columns=C.getColumnFilter(),n.getDepartment(R,{onResult:function(U){var N=U.getResult();N.length>0&&N.some(W=>W.id===E)?C.setValue(E):x()}})}else x();function x(){C.setValue("")}}function Q(){if(d.getProductEdition()<=15)return;var C=h.punch_tag_id;if(!C)return;var w=C.getValue();C.setSourceData(null);var E={};if(E.filter_data={status_id:10,user_id:t.parent_controller.getSelectEmployee(!0).id,branch_id:h.branch_id?h.branch_id.getValue():V.zero_id,department_id:h.department_id?h.department_id.getValue():V.zero_id,job_id:h.job_id?h.job_id.getValue():V.zero_id,job_item_id:h.job_item_id?h.job_item_id.getValue():V.zero_id},C.setDefaultArgs(E),w&&w.length>0){var R=d.clone(E);R.manual_id=w,r.getPunchTag(R,{onResult:function(U){var N=U.getResult();if(N.length>0){if(w!==V.zero_id&&w.length>0&&q(w,N)){var W=w.filter(K=>N.some(Z=>K===Z.id));C.setValue(W)}}else x()}})}else x();function x(){C.setValue("")}}function q(C,w){if(C.every(E=>w.some(R=>R.id===E))===!1)return!0}if(this.parent_controller.getPunchMode()==="manual"&&this.parent_controller.timesheet_columns.length===9){var G=document.querySelectorAll(".control-icon");for(var z of G)z.style.textAlign="left"}}autoSaveManualPunch(){var e=this;if(this.is_saving_manual_grid){this.save_manual_grid_after_save=!0;return}this.wait_auto_save&&clearTimeout(this.wait_auto_save),this.wait_auto_save=setTimeout(function(){e.getPunchMode()==="manual"&&(ProgressBar.showOverlay(),e.onSaveClick())},2e3)}insideEditorGetValue(e){for(var i=this.rows_widgets_array.length,t=[],a=0;a<i;a++){for(var s=this.rows_widgets_array[a],r=0;r<7;r++){var n=new Date(new Date(this.parent_controller.start_date.getTime()).setDate(this.parent_controller.start_date.getDate()+r)),o=n.format(),_={};s[o]&&(_.total_time=s[o].getValue(),(s[o].is_changed||s.is_changed&&s.current_edit_item[o])&&(s.branch_id&&(_.branch_id=s.branch_id.getValue()),s.department_id&&(_.department_id=s.department_id.getValue()),s.job_id&&(_.job_id=s.job_id.getValue()),s.job_item_id&&(_.job_item_id=s.job_item_id.getValue()),s.punch_tag_id&&(_.punch_tag_id=s.punch_tag_id.getValue()),_.date_stamp=o,_.user_id=this.parent_controller.getSelectEmployee(),_.object_type_id=10,_.override=!0,s.current_edit_item[o]&&s.current_edit_item[o].hasOwnProperty("note")&&(_.note=s.current_edit_item[o].note),_.row=s,s.current_edit_item[o]&&(_.id=s.current_edit_item[o].id),t.push(_),e&&(s[o].is_changed=!1,s[o].addClass("is-saving-manual-grid"))))}e&&(s.is_changed=!1)}return t}insideEditorRemoveRow(e){for(var i=this,t=e[0].rowIndex-3,a=this.rows_widgets_array[t],s=!1,r=0;r<7;r++){var n=new Date(new Date(this.parent_controller.start_date.getTime()).setDate(this.parent_controller.start_date.getDate()+r)),o=n.format();if(a[o].getValue()>0||a.current_edit_item[o]){s=!0,TAlertManager.showConfirmAlert(l.i18n._("You are about to delete the entire week worth of time for this row. Are you sure you wish to continue?"),"",_);break}}!s&&_(!0);function _(u){if(u){for(var m=[],h=0;h<7;h++){var c=new Date(new Date(i.parent_controller.start_date.getTime()).setDate(i.parent_controller.start_date.getDate()+h)),g=c.format();a.current_edit_item[g]&&m.push(a.current_edit_item[g].id)}m.length>0&&(ProgressBar.noProgressForNextCall(),ProgressBar.showNanobar(),i.is_saving_manual_grid=!0,i.parent_controller.setDefaultMenu(),i.api.deleteUserDateTotal(m,{onResult:function(){i.parent_controller.reLoadSubGridsSource(!0),ProgressBar.removeNanobar(),i.parent_controller.setDefaultMenu()}})),e.remove(),i.rows_widgets_array.splice(t,1),i.rows_widgets_array.length===0&&i.addRow()}}}buildManualTimeSheetGrid(){var e={branch:l.i18n._("Branch"),department:l.i18n._("Department"),job:l.i18n._("Job"),task:l.i18n._("Task"),punch_tag:l.i18n._("Tags")};this.editor=d.loadWidgetByName(FormItemType.INSIDE_EDITOR),this.editor.InsideEditor({title:"",addRow:this.insideEditorAddRow,getValue:this.insideEditorGetValue,setValue:this.insideEditorSetValue,removeRow:this.insideEditorRemoveRow,parent_controller:this,render:i(),render_args:e,api:this.api_user_date_total,render_inline_html:!0,row_render:t()});function i(){return`<table class="inside-editor-render grid-inside-editor-render">
						<tr class="manual-timesheet-size-tr">
							<td style="width: 25px"></td>
							<td style="width: 25px"></td>
							<td class="branch-header" style="width: 120px"></td>
							<td class="department-header" style="width: 120px"></td>
							<td class="job-header" style="width: 120px"></td>
							<td class="job-item-header" style="width: 120px"></td>
							<td class="punch-tag-header" style="width: 120px"></td>
							<td style="width: 50px"></td>
							<td style="width: 50px"></td>
							<td style="width: 50px"></td>
							<td style="width: 50px"></td>
							<td style="width: 50px"></td>
							<td style="width: 50px"></td>
							<td style="width: 50px"></td>
						</tr>
						<tr class="title">
							<td></td>
							<td></td>
							<td class="branch-header"><%= branch %></td>
							<td class="department-header"><%= department %></td>
							<td class="job-header"><%= job %></td>
							<td class="job-item-header"><%= task %></td>
							<td class="punch-tag-header"><%= punch_tag %></td>
							<td id="day_0_date"></td>
							<td id="day_1_date"></td>
							<td id="day_2_date"></td>
							<td id="day_3_date"></td>
							<td id="day_4_date"></td>
							<td id="day_5_date"></td>
							<td id="day_6_date"></td>
						</tr>
					</table>`}function t(){return`<tr class="inside-editor-row data-row">
						<td class="cell control-icon">
							<button class="plus-icon" onclick=""></button>
						</td>
						<td class="cell control-icon">
							<button class="minus-icon " onclick=""></button>
						</td>
						<td class="branch "></td>
						<td class="department "></td>
						<td class="job "></td>
						<td class="task "></td>
						<td class="punch_tag "></td>
						<td class="day-0 "></td>
						<td class="day-1 "></td>
						<td class="day-2 "></td>
						<td class="day-3 "></td>
						<td class="day-4 "></td>
						<td class="day-5 "></td>
						<td class="day-6 "></td>
					</tr>`}var a=this.$(".manual-timesheet-inside-editor-div");a.append(this.editor)}buildCalendars(){var e=this;this.is_auto_switch?this.getManualTimeSheetData(function(){if(e.manual_timesheet_data.length>0){e.buildManualTimeSheetData();var t=H.isEmpty(e.time_sheet_data_overrode_true_map),a=H.isEmpty(e.time_sheet_data_overrode_false_map);t&&!a&&e.toggle_button.getValue()!=="manual"?(e.toggle_button.setValue("punch"),e.is_auto_switch=!1):!t&&a&&e.toggle_button.setValue("manual"),e.reSetURL(),i()}else e.getPunchMode()==="punch"&&(e.is_auto_switch=!1),i()}):i();function i(){if(e.pay_period_data=e.full_timesheet_data.pay_period_data,e.pay_period_map=e.full_timesheet_data.timesheet_dates.pay_period_date_map,e.timesheet_verify_data=e.full_timesheet_data.timesheet_verify_data,e.grid_div=l(e.el).find(".timesheet-grid-div"),e.buildTimeSheetsColumns(),e.buildTimeSheetGrid(),e.getPunchMode()==="manual"?(e.$(".timesheet-punch-grid-wrapper").hide(),e.$(".manual-timesheet-inside-editor-div").show(),e.editor?(e.buildManualTimeSheetsColumns(),e.initInsideEditorData()):(e.buildManualTimeSheetsColumns(),e.buildManualTimeSheetGrid(),e.initInsideEditorData()),(!e.show_job_ui||d.getProductEdition()<20)&&e.$(".job-header").hide(),(!e.show_job_item_ui||d.getProductEdition()<20)&&e.$(".job-item-header").hide(),(!e.show_punch_tag_ui||d.getProductEdition()<20)&&e.$(".punch-tag-header").hide(),e.show_branch_ui||e.$(".branch-header").hide(),e.show_department_ui||e.$(".department-header").hide()):(e.$(".timesheet-punch-grid-wrapper").show(),e.$(".manual-timesheet-inside-editor-div").hide()),e.buildAccumulatedGrid(),e.buildSubGrid("branch_grid","Branch"),e.buildSubGrid("department_grid","Department"),e.buildSubGrid("job_grid","Job"),e.buildSubGrid("job_item_grid","Task"),e.buildSubGrid("punch_tag_grid","Tags"),e.buildSubGrid("premium_grid","Premium"),e.buildAbsenceGrid(),e.showGridBorders(),e.buildAccumulatedTotalGrid(),e.buildPunchNoteGrid(),e.buildVerificationGrid(),e.buildTimeSheetSource(),e.buildTimeSheetRequests(),e.buildSubGridsSource(),e.buildTimeSheetExceptions(),e.buildAbsenceSource(),e.buildPunchNoteGridSource(),e.buildVerificationGridSource(),e.setGridExpendButton("accumulated_time_grid",l.i18n._("Accumulated Time")),e.setGridExpendButton("branch_grid",l.i18n._("Branch")),e.setGridExpendButton("department_grid",l.i18n._("Department")),e.setGridExpendButton("job_grid",l.i18n._("Job")),e.setGridExpendButton("job_item_grid",l.i18n._("Task")),e.setGridExpendButton("punch_tag_grid",l.i18n._("Tags")),e.setGridExpendButton("premium_grid",l.i18n._("Premium")),e.setGridExpendButton("absence_grid",l.i18n._("Absence")),e.setGridExpendButton("punch_note_grid",l.i18n._("Punch Notes")),e.getPunchMode()==="punch"&&e.grid.setData(e.timesheet_data_source,!0),typeof e.accumulated_time_grid.setData=="function"&&e.accumulated_time_grid.setData(e.accumulated_time_source,!1),typeof e.branch_grid.setData=="function"&&e.branch_grid.setData(e.branch_source,!1),typeof e.department_grid.setData=="function"&&e.department_grid.setData(e.department_source,!1),typeof e.job_grid.setData=="function"&&e.job_grid.setData(e.job_source,!1),typeof e.job_item_grid.setData=="function"&&e.job_item_grid.setData(e.job_item_source,!1),typeof e.punch_tag_grid.setData=="function"&&e.punch_tag_grid.setData(e.punch_tag_source,!1),typeof e.premium_grid.setData=="function"&&e.premium_grid.setData(e.premium_source,!1),e.absence_grid&&e.absence_grid.setData(e.absence_source,!1),e.accumulated_total_grid_source.length===0&&e.accumulated_total_grid_source.push(),e.accumulated_total_grid.setData(e.accumulated_total_grid_source,!1),e.punch_note_grid.setData(e.punch_note_grid_source,!1),e.verification_grid.setData(e.verification_grid_source,!1),e.setGridSize(),e.setTimeSheetGridPayPeriodHeaders(),e.setTimeSheetGridHolidayHeaders(),e.highLightSelectDay(),e.autoOpenEditViewIfNecessary(),e.setScrollPosition(),e.initRightClickMenu(),e.initRightClickMenu(RightClickMenuType.ABSENCE_GRID),e.showWarningMessageIfAny(),e.setPunchModeClass(),e.getPunchMode()!="punch")for(var t=e.getManualPayPeriodDefaultTrColspan(),a=0;a<t;a++)l(".sub-grid td:nth-child("+a+")").css("border-right","none")}}searchDone(){l(".button-rotate").removeClass("button-rotate"),TTPromise.resolve("init","init"),TTPromise.wait()}showWarningMessageIfAny(){var e=this,i,t=l(this.el).find(".timesheet-warning-title-bar");t.length>0&&t.remove()&&(t=l(this.el).find(".timesheet-warning-title-bar")),this.getPunchMode()==="punch"?i=l(this.el).find("#gbox_"+this.ui_id+"_grid"):i=l(this.el).find(".manual-timesheet-inside-editor-div");var a=this.getSelectEmployee(!0),s=r(a);if(d.isObject(a)&&Object.keys(a).length>1&&(a.hasOwnProperty("pay_period_schedule_id")&&a.pay_period_schedule_id==""||a.hasOwnProperty("policy_group_id")&&a.policy_group_id==""||s==!1)){if(t=l("<div class='timesheet-warning-title-bar'><span class='p-message'></span><span class='g-message'></span><span class='pp-message'></span></div>"),t.insertBefore(i),a.hasOwnProperty("pay_period_schedule_id")&&a.pay_period_schedule_id==""){//!user.pay_period_schedule_id
t.children().eq(0).html(l.i18n._("WARNING: Employee is not assigned to a pay period schedule."))}else t.children().eq(0).html("");if(a.hasOwnProperty("policy_group_id")&&a.policy_group_id==""){//!user.policy_group_id
t.children().eq(1).html(l.i18n._("WARNING: Employee is not assigned to a policy group."))}else t.children().eq(1).html("");s==!1?t.children().eq(2).html(l.i18n._("WARNING: Employee has day(s) not assigned to a pay period. Please perform a pay period import to correct.")):t.children().eq(2).html("")}else t.length>0&&t.remove();function r(n){if(e.start_date)for(var o=n.hire_date,_=n.termination_date,u=0;u<7;u++){var m=new Date(new Date(e.start_date.getTime()).setDate(e.start_date.getDate()+u)),h=m.format();if(m&&m.getTime()<new Date().getTime()&&!e.getPayPeriod(h)&&(!o||m.getTime()>=d.strToDate(o).getTime())&&(!_||m.getTime()<=d.strToDate(_).getTime()))return!1}return!0}}autoOpenEditViewIfNecessary(){switch(LocalCacheData.current_doing_context_action){case"edit":LocalCacheData.edit_id_for_next_open_view&&(this.onEditClick(LocalCacheData.edit_id_for_next_open_view,LocalCacheData.getAllURLArgs().t),LocalCacheData.edit_id_for_next_open_view=null);break;case"view":LocalCacheData.edit_id_for_next_open_view&&(this.onViewClick(LocalCacheData.edit_id_for_next_open_view,LocalCacheData.getAllURLArgs().t),LocalCacheData.edit_id_for_next_open_view=null);break;case"new":this.edit_view||(LocalCacheData.getAllURLArgs().t==="absence"?this.absence_model=!0:this.absence_model=!1,this.onAddClick());break}this.autoOpenEditOnlyViewIfNecessary()}getWeekDayIndexFromADate(e){for(var i=this.timesheet_columns.length,t=1;t<i;t++){var a=this.timesheet_columns[t],s=d.strToDate(a.index,this.full_format).format();if(e===s)return t}return 7}setAccumulatedTotalGridPayPeriodHeaders(e){var i=l(l(this.el).find("table[aria-labelledby=gbox_"+this.ui_id+"_accumulated_total_grid]")[0]);i.width(e);var t=l('<tr class="group-column-tr"  role="rowheader"  ></tr>'),a=l('<th class="group-column-th" ><span class="group-column-label"></span></th>'),s=a.clone(),r=a.clone(),n=a.clone();r.children(0).text(l.i18n._("Week")),n.children(0).text(l.i18n._("Pay Period")),t.append(s),t.append(r),t.append(n),i.find(".rowheader").remove(),i.find("thead").prepend(t)}setTimeSheetGridHolidayHeaders(){var e={};if(this.full_timesheet_data&&this.full_timesheet_data.holiday_data)for(var i=0;i<this.full_timesheet_data.holiday_data.length;i++){var t=this.full_timesheet_data.holiday_data[i],a=d.strToDate(t.date_stamp).format(this.full_format),s=l("<div></div>");this.getPunchMode()==="manual"?s=l(".manual_grid_day_"+a):s=l('div[id="jqgh_'+this.ui_id+"_grid_"+a+'"]'),s&&s.text().indexOf(t.name)==-1&&!e[t.name]&&(s.html(s.html()+"<br>"+d.htmlEncode(t.name)),e[t.name]=!0)}}getManualPayPeriodDefaultTrColspan(){var e=2;return this.show_branch_ui&&e++,this.show_department_ui&&e++,this.show_job_ui&&e++,this.show_job_item_ui&&e++,this.show_punch_tag_ui&&e++,e}setTimeSheetGridPayPeriodHeaders(){var e=this,i,t;this.getPunchMode()==="punch"?(i=l(l(this.el).find("table[aria-labelledby=gbox_"+this.ui_id+"_grid]")[0]),t=l('<tr class="size-tr" role="row" style="height: 0;" ></tr>')):(i=this.$(".grid-inside-editor-render"),i.find(".group-column-tr").remove(),t=l(this.$(".grid-inside-editor-render").find("tr")[0])),i.find(".group-column-tr").remove();var a=l('<tr class="group-column-tr pay_period_header_row"></tr>'),s=l('<th class="group-column-th"><span class="group-column-label"></span></th>'),r=i.find(".ui-jqgrid-labels");this.getPunchMode()==="punch"&&(A(),t.insertBefore(i.find("thead .ui-jqgrid-labels")));var n;if(Object.keys(this.pay_period_data).length===0){n=s.clone(),a.append(n),this.getPunchMode()==="manual"&&n.attr("colspan",this.getManualPayPeriodDefaultTrColspan()),f(7),a.insertAfter(t);return}for(var o,_=0,u,m=[],h=0;h<this.column_maps.length;h++){var c=this.column_maps[h],g=this.pay_period_map[c];g||(g=-1),m.push({date:c,time_stamp:d.strToDate(c).getTime(),id:g})}n=s.clone(),a.append(n),this.getPunchMode()==="manual"&&n.attr("colspan",this.getManualPayPeriodDefaultTrColspan());for(var p=0;p<m.length;p++)o?o!==m[p].id?(u?b():f(_),o=m[p].id,u=v(m[p].id),_=1):_=_+1:(o=m[p].id,u=v(m[p].id),_=_+1),p===m.length-1&&_>0&&(u?b():f(_));l(".pay_period_header_row").remove(),a.insertAfter(t);function b(){var M=d.strToDate(u.start_date).format(),T=d.strToDate(u.end_date).format(),S=_,D=s.clone();D.children(0).text(M+" "+l.i18n._("to")+" "+T),D.attr("colspan",S),u.status_id==12||u.status_id==20?D.css("background","#EC0000"):u.status_id==30&&D.css("background","#EED614"),a.append(D)}function v(M){for(var T in e.pay_period_data){var S=e.pay_period_data[T];if(S.id===M)return S}}function f(M){var T=s.clone();T.addClass("no_pay_period_header"),T.children(0).text(l.i18n._("No Pay Period")),T.attr("colspan",M),a.append(T)}function A(){for(var M=r.children().length,T=0;T<M;T++){var S=l('<td class=""  role="gridcell"></td>'),D=r.children().eq(T);S.height(0),S.css("width",D.css("width")),t.append(S)}}}setPayPeriodHeaderSize(){var e=l(l(this.el).find("table[aria-labelledby=gbox_"+this.ui_id+"_grid]")),i=e.find(".size-tr");if(i.length!==0)for(var t=e.find(".jqgfirstrow"),a=t.children().length,s=0;s<a;s++){var r=t.children().eq(s);i.children().eq(s).css("width",r.css("width"))}}highLightSelectDay(e){this.highlight_header&&this.highlight_header.removeClass("highlight-header");var i=d.strToDate(this.start_date_picker.getValue());!i&&(i=new Date),this.getPunchMode()==="punch"?(i=i.format(this.full_format),this.highlight_header=l("#"+this.ui_id+"_grid_"+i)):(i=i.format(this.full_format),this.highlight_header=l(".manual_grid_day_"+i)),this.highlight_header.addClass("highlight-header"),l(".timesheet-grid tr td.ui-state-highlight").length==0&&!e&&(l(l(".timesheet-grid tr#1 td")[this.highlight_header.index()]).addClass("ui-state-highlight"),l(l(".timesheet-grid tr#1 td")[this.highlight_header.index()]).click())}setGridHeight(e){var i=this.grid_dic[e];if(i.grid)i=i.grid;else return!1;var t=0;switch(e){case"timesheet_grid":t=this.timesheet_data_source.length;break;case"accumulated_time_grid":t=this.accumulated_time_source.length;break;case"branch_grid":t=this.branch_source.length;break;case"department_grid":t=this.department_source.length;break;case"job_grid":t=this.job_source.length;break;case"job_item_grid":t=this.job_item_source.length;break;case"punch_tag_grid":t=this.punch_tag_source.length;break;case"premium_grid":t=this.premium_source.length;break;case"absence_grid":t=this.absence_source.length;break;case"accumulated_total_grid":t=this.accumulated_total_grid_source.length;break;case"punch_note_grid":t=this.punch_note_grid_source.length;break;case"verification_grid":t=this.verification_grid_source.length}LocalCacheData.timesheet_sub_grid_expended_dic[e]===!0||e==="timesheet_grid"||e==="accumulated_total_grid"||e==="punch_note_grid"||e==="verification_grid"?i.setGridHeight(t*22):i.setGridHeight(0),i.parent().parent().css("overflow","hidden"),t===0&&e!=="accumulated_time_grid"&&e!=="verification_grid"?i.parent().parent().parent().parent().hide():i.parent().parent().parent().parent().show()}setGridColumnsWidth(){this.setGridSize()}setGridSize(){var e=this,i=this.grid;if(i.grid)i=i.grid;else return!1;if((!i||!l(i).is(":visible"))&&(!this.editor||!this.editor.is(":visible")))return;for(var t in this.grid_dic)if(t!="punch_note_grid"&&t!="accumulated_total_grid"&&t!="verification_grid"){if(!this.grid_dic[t].grid)continue;var a=this.grid_dic[t].grid;this.setGridHeight(t),a.setGridWidth(this.getTimeSheetWidth())}this.setGridHeight("accumulated_total_grid"),this.grid_dic.verification_grid.grid.setGridWidth(400),this.setGridHeight("verification_grid"),this.setPunchNoteGridWidth(this.grid_dic.punch_note_grid.grid),this.setGridHeight("punch_note_grid");let s=document.body.scrollHeight,r=s,n=document.querySelector("div.timesheet-grid-div");if(n&&(r-=n.getBoundingClientRect().top),document.querySelector("div.context-border")&&(r-=s-document.querySelector("div.context-border").getBoundingClientRect().bottom),r-=10,this.grid_div.height(r),this.grid.setGridWidth(this.getTimeSheetWidth()),this.setPayPeriodHeaderSize(),this.getPunchMode()==="manual"&&e.setManualTimeSheetGridSize(),d.isVerticalScrollBarRequired(l(".timesheet-grid-div")[0])){for(var t in this.grid_dic)if(t!="punch_note_grid"&&t!="accumulated_total_grid"&&t!="verification_grid"){if(!this.grid_dic[t].grid)continue;var a=this.grid_dic[t].grid;a.setGridWidth(this.getTimeSheetWidth())}}}setPunchNoteGridWidth(e){if(!e){if(!this.punch_note_grid||!this.punch_note_grid.grid)return!1;e=this.punch_note_grid.grid}var i=e.width(),t=this.accumulated_total_grid&&this.accumulated_total_grid.grid?this.accumulated_total_grid.getWidth():0,a=this.verification_grid&&this.verification_grid.grid?this.verification_grid.getWidth():0;this.verification_grid_source.length!==0?i=Math.floor(this.getTimeSheetWidth()-(t+a+7)):i=Math.floor(this.getTimeSheetWidth()-(7+t)),i=Math.abs(i),i!=e.width()&&(e.setGridWidth(i),l("td.notes_grid_td_container").css("width","100%"))}setManualTimeSheetGridSize(){for(var e=l(this.accumulated_time_grid.grid.find("tr:first-child")[0]),i=l(this.editor.find("table").find("tr:first-child")[0]),t=0,a=0,s=i.children().length;a<s;a++){var r=l(i.children()[a]);r.is(":visible")&&(l(r).css("width",l(e.children()[t]).css("width")),t++)}this.editor.width(this.accumulated_time_grid.getGridWidth())}onCellFormat(e,i,t){var a=i.colModel;i.rowid;var s=l("<div class='punch-content-div'></div>"),r,n,o,_,u,m,h,c,g,p,b,v,f,A=LocalCacheData.getCurrentCurrencySymbol();if(e=d.decodeCellValue(e),i.pos===0)return t.type===P.TOTAL_ROW?(r=l("<span class='total' style='font-size: 11px'></span>"),d.isSet(e)?r.text(e):r.text(""),r.get(0).outerHTML):t.type===P.REGULAR_ROW?(r=l("<span class='top-line-span' style='font-size: 11px'></span>"),d.isSet(e)?r.text(e):r.text(""),r.get(0).outerHTML):e;if(t.type===P.PUNCH_ROW){if(h=t[a.name+"_data"],g=t[a.name+"_related_data"],_=l("<span class='punch-prefix'></span>"),u=l("<span class='punch-time'></span>"),m=l("<span class='punch-suffix'></span>"),c=l("<span class='punch-break'></span>"),h){p=h.exception;var M="",T="";h.type_id==20?(M="L",T=l.i18n._("Lunch")):h.type_id==30&&(M="B",T=l.i18n._("Break"));var S="",D="";h.note!=""&&(S="*",D=l.i18n._("Note")+": "+h.note);var I="",y="";h.id==V.not_exist_id&&(I="P",y="P="+l.i18n._("Processing")),h.latitude&&h.latitude!=0&&h.longitude&&h.longitude!=0&&(I="G",y="G="+l.i18n._("GPS Location")),h.has_image&&(I=I+"F",y=y+" F="+l.i18n._("Punch Image")),h.tainted&&u.css("color","#ff0000")}else g&&(p=g.exception);if(d.isSet(S)&&S!=""&&(_.text(S),_.attr("title",D),s.append(_)),d.isSet(e)?u.text(e):u.text(""),s.append(u),d.isSet(I)&&I!=""&&(m.text(I),m.attr("title",y),s.append(m)),d.isSet(M)&&M!=""&&(c.text(M),c.attr("title",T),s.append(c)),p){b=p.length;for(var o=0;o<b;o++)v=p[o],n=l("<span class='punch-exceptions'></span>"),n.css("color",v.exception_color),n.text(v.exception_policy_type_id),n.attr("title",v.exception_policy_type_id+": "+v.exception_policy_type),s.prepend(n)}}else if(t.type===P.EXCEPTION_ROW){if(p=t[a.name+"_exceptions"],d.isSet(p)){b=p.length;for(var o=0;o<b;o++)v=p[o],n=l("<span class='punch-exceptions-center'></span>"),n.css("color",v.exception_color),n.text(v.exception_policy_type_id),n.attr("title",v.exception_policy_type_id+": "+v.exception_policy_type),s.append(n)}}else if(t.type===P.REQUEST_ROW)u=l("<span class='request'></span>"),d.isSet(e)?(u.text(e),u.attr("title",J(t[a.name+"_request"]))):u.text(""),s.prepend(u);else if(t.type===P.TOTAL_ROW)f=t[a.name+"_data"],u=l("<span class='total'></span>"),d.isSet(e)?(f&&(f.hasOwnProperty("note")&&f.note&&(e="*"+e),time_sheet_view_controller.wage_btn&&time_sheet_view_controller.wage_btn.getValue(!0)&&f.hasOwnProperty("total_time_amount")&&f.total_time_amount&&f.hasOwnProperty("hourly_rate")&&f.hourly_rate&&(u=l("<div class='total--bold time-sheet-view-wage-container'></div>"),e='<span class="time-sheet-view-wage-hour-rate">'+A+d.MoneyRound(f.hourly_rate)+'/hr @</span><span class="time-sheet-view-wage-value">'+e+'</span ><span class="time-sheet-view-wage-amount" >= '+A+d.MoneyRound(f.total_time_amount)+"</span>"),time_sheet_view_controller.getPunchMode()==="punch"?f.hasOwnProperty("override")&&f.override===!0&&u.addClass("absence-override"):!f.override&&t.key==="worked_time"&&u.addClass("absence-override")),u.html(e)):u.text(""),s.prepend(u);else if(t.type===P.REGULAR_ROW)s.addClass("top-line"),f=t[a.name+"_data"],u=l("<span></span>"),d.isSet(e)?(f&&(f.hasOwnProperty("note")&&f.note&&(e="*"+e),time_sheet_view_controller.wage_btn&&time_sheet_view_controller.wage_btn.getValue(!0)&&f.hasOwnProperty("total_time_amount")&&f.total_time_amount&&f.hasOwnProperty("hourly_rate")&&f.hourly_rate&&(u=l("<div class='time-sheet-view-wage-container'></div>"),e='<span class="time-sheet-view-wage-hour-rate">'+A+d.MoneyRound(f.hourly_rate)+'/hr @</span><span class="time-sheet-view-wage-value">'+e+'</span ><span class="time-sheet-view-wage-amount" >= '+A+d.MoneyRound(f.total_time_amount)+"</span>"),f.hasOwnProperty("override")&&f.override===!0&&u.addClass("absence-override")),u.html(e)):u.text(""),s.prepend(u);else if(t.type===P.ABSENCE_ROW){var F=t[a.name+"_data"];u=l("<span></span>"),d.isSet(e)?(F&&(F.override===!0&&u.addClass("absence-override"),F.note&&(e="*"+e)),u.text(e)):u.text(""),s.prepend(u)}else t.type===P.ACCUMULATED_TIME_ROW||t.type===P.PREMIUM_ROW?(f=t[a.name+"_data"],u=l("<span  style='width: 100%'></span>"),d.isSet(e)?(f&&(f.hasOwnProperty("note")&&f.note&&(e="*"+e),time_sheet_view_controller.wage_btn&&time_sheet_view_controller.wage_btn.getValue(!0)&&f.hasOwnProperty("total_time_amount")&&f.total_time_amount&&f.hasOwnProperty("hourly_rate")&&f.hourly_rate&&(u=l("<div class='time-sheet-view-wage-container'></div>"),e='<span class="time-sheet-view-wage-hour-rate">'+A+d.MoneyRound(f.hourly_rate)+'/hr @</span><span class="time-sheet-view-wage-value">'+e+'</span ><span class="time-sheet-view-wage-amount" >= '+A+d.MoneyRound(f.total_time_amount)+"</span>"),f.hasOwnProperty("override")&&f.override===!0&&u.addClass("absence-override")),u.html(e)):u.text(""),s.prepend(u)):(u=l("<span class='punch-time'></span>"),d.isSet(e)?u.text(e):u.text(""),s.prepend(u));function J(O){var j;d.isArray(O)?j=B(O):d.isObject(O)&&O.status&&(j=O.status);function B(L){for(var Q=L.length,q=0,G=0,z=0,C="",w=0;w<Q;w++){var E=L[w];E.status_id==50?q=q+1:E.status_id==55?G=G+1:E.status_id==30&&(z=z+1)}return q>0&&(C+=" "+l.i18n._("Authorized")+": "+q),z>0&&(C+=" "+l.i18n._("Pending")+": "+z),G>0&&(C+=" "+l.i18n._("Declined")+": "+G),C}return j}return s.addClass("date-column"),s.get(0).outerHTML}onSelectRow(e,i,t){var a=this,s=l(t).find("tr#"+i);a.timesheet_grid.grid.find("td.ui-state-highlight").removeClass("ui-state-highlight");var r=[],n=0;e==="timesheet_grid"?(r=a.select_cells_Array,n=a.select_cells_Array.length,a.absence_select_cells_Array=[]):e==="absence_grid"?(r=a.absence_select_cells_Array,n=a.absence_select_cells_Array.length,a.select_cells_Array=[]):e==="accumulated_grid"?(r=a.accumulated_time_cells_array,n=a.accumulated_time_cells_array.length):e==="premium_grid"&&(r=a.premium_cells_array,n=a.premium_cells_array.length),this.select_punches_array=[];for(var o=0;o<n;o++){var _=r[o];s=l(t).find("#"+_.row_id);var u=l(s.find("td")[_.cell_index]);if(u.addClass("ui-state-highlight").attr("aria-selected",!0),_.punch&&_.punch.id){if(d.isSet(_.punch.time_stamp)){var m=d.strToDate(_.punch.punch_date).format("MM-DD-YYYY"),h=m+" "+_.punch.punch_time;_.punch.time_stamp_num=d.strToDateTime(h).getTime()}else _.punch.time_stamp_num=_.time_stamp_num;this.select_punches_array.push(_.punch),this.select_punches_array.sort(function(c,g){return d.compare(c,g,"time_stamp_num")})}}}unsetSelectedCells(e){e=="accumulated_grid"&&(e="accumulated_time_grid"),this.last_clicked_grid_id&&e!=this.last_clicked_grid_id&&window.setTimeout(function(i,t){i.grid_dic[t].grid.trigger("reloadGrid")},0,this,this.last_clicked_grid_id),this.last_clicked_grid_id=e}getRowData(e,i){var t=this,a=null;e==="absence_grid"?a=t.absence_grid.getGridParam("data"):e==="accumulated_grid"?a=t.accumulated_time_grid.getGridParam("data"):e==="premium_grid"?a=t.premium_grid.getGridParam("data"):a=t.grid.getGridParam("data");var s=!1;for(var r in a)if(a[r].id==i){s=a[r];break}return s}onCellSelect(e,i,t,a,s,r){if(l("#ribbon_view_container .context-menu:visible a").click(),t<0)return this.unsetSelectedCells(e),this.setDefaultMenu(),!0;t=parseInt(t);var n=this,o,_,u,m,h,c=[],g;if(!this.is_edit&&!this.is_add&&(n.absence_model=!1),o=n.getRowData(e,i),e==="timesheet_grid"){if(c=n.select_cells_Array,_=n.grid.getGridParam("colModel"),u=_[t].name,o.type===P.REQUEST_ROW){var p={filter_data:{}};p.filter_data.user_id=this.getSelectEmployee(),p.filter_data.start_date=n.full_timesheet_data.timesheet_dates.start_display_date,p.filter_data.end_date=n.full_timesheet_data.timesheet_dates.end_display_date,p.filter_data.id=[],n.unsetSelectedCells(e);var b=0,v=0;if(d.isArray(o[u+"_request"]))for(var f in o[u+"_request"]){var A=o[u+"_request"][f];p.filter_data.id.push(A.id),A.status==l.i18n._("PENDING")&&(b+=1),v+=1}else if(o[u+"_request"])p.filter_data.id.push(o[u+"_request"].id),o[u+"_request"].status==l.i18n._("PENDING")&&(b=1),v=1;else return;d.addViewTab(this.viewId,l.i18n._("TimeSheet"),window.location.href),v>0&&(this.getSelectEmployee()!=LocalCacheData.getLoginUser().id&&b>0?this.ownerOrChildPermissionValidate("request","view_child",p.filter_data.id)?IndexViewController.goToView("RequestAuthorization",p):this.viewPermissionValidate("request",p.filter_data.id)&&IndexViewController.goToView("Request",p):this.viewPermissionValidate("request",p.filter_data.id)&&IndexViewController.goToView("Request",p));return}o&&o[u+"_data"]?m=o[u+"_data"]:m=null,h=o[u+"_related_data"],g=d.strToDate(u,this.full_format)}else e==="absence_grid"?(c=n.absence_select_cells_Array,_=n.absence_grid.getGridParam("colModel"),u=_[t].name,o?m=o[u+"_data"]:m=null,g=d.strToDate(u,this.full_format),n.absence_model=!0):e==="accumulated_grid"?(c=n.accumulated_time_cells_array,_=n.accumulated_time_grid.getGridParam("colModel"),u=_[t].name,o?m=o[u+"_data"]:m=null,g=d.strToDate(u,this.full_format)):e==="premium_grid"&&(c=n.premium_cells_array,_=n.premium_grid.getGridParam("colModel"),u=_[t].name,o?m=o[u+"_data"]:m=null,g=d.strToDate(u,this.full_format));if(d.isValidDate(g)==!1)return n.unsetSelectedCells(e),!1;for(var M,T,S,D=0;D<c.length;D++)M=c[D],T=l(s).find("#"+M.row_id),l(s).find("tr").removeClass("ui-state-highlight"),S=l(T.find("td")[M.cell_index]),S.removeClass("ui-state-highlight").attr("aria-selected",!1);var I,y;if(r.ctrlKey||r.metaKey){for(var F=!1,D=0;D<c.length;D++)if(M=c[D],i==M.row_id&&t==M.cell_index){c.splice(D,1),F=!0;break}I=g.format(),y=g.getTime(),F||(e==="timesheet_grid"?(m=N(i,t),h=W(i,t),c.push({row_id:i,cell_index:t,cell_val:a,punch:m,related_punch:h,date:I,time_stamp_num:y}),n.select_cells_Array=c,n.select_cells_Array.sort(d.m_sort_by(["time_stamp_num","row_id"]))):e==="absence_grid"?(c.push({row_id:i,cell_index:t,cell_val:a,punch:m,date:I,time_stamp_num:y,src_object_id:o.punch_info_id?o.punch_info_id:null}),n.absence_select_cells_Array=c,n.absence_select_cells_Array.sort(d.m_sort_by(["time_stamp_num","row_id"]))):e==="premium_grid"&&(c=[{row_id:i,cell_index:t,cell_val:a,date:I,time_stamp_num:y}],n.premium_cells_array=c))}else if(r.shiftKey&&c.length>0){var J=c[0].status_id,O=parseInt(c[0].row_id),j=parseInt(c[0].cell_index),B=i,L=t;if(O>B){var Q=O;O=B,B=Q}if(j>L){var q=j;j=L,L=q}for(var D=0;D<c.length;D++){M=c[D];var G=parseInt(M.row_id);G<O&&(O=G),G>B&&(B=G),M.cell_index<j&&(j=M.cell_index),M.cell_index>L&&(L=M.cell_index)}var z=parseInt(c[0].row_id),C=parseInt(c[c.length-1].row_id),w=parseInt(c[0].cell_index),E=parseInt(c[c.length-1].cell_index);c&&c.length>0&&c[c.length-1].cell_index&&c[0].cell_index&&E>=t&&w<=t&&C>=i&&z<=i&&(B=i,L=t),c=[];for(var D=O;D<=B;D++)for(var R=D,x=j;x<=L;x++){var U=x;T=l(s).find("tr#"+R),S=l(T.find("td")[U]),a=S[0].outerHTML,e==="timesheet_grid"?(m=N(D,x),h=W(D,x),g=d.strToDate(u,this.full_format),I=g.format(),y=g.getTime(),c.push({row_id:R,cell_index:U,cell_val:a,punch:m,status_id:J,related_punch:h,date:I,time_stamp_num:y})):e==="absence_grid"?(_=n.absence_grid.getGridParam("colModel"),u=_[U].name,m=o[u+"_data"],g=d.strToDate(u,this.full_format),I=g.format(),y=g.getTime(),c.push({row_id:R,cell_index:U,cell_val:a,punch:m,date:I,time_stamp_num:y,src_object_id:o.punch_info_id?o.punch_info_id:null})):e==="accumulated_grid"?(c=[{row_id:i,cell_index:t,cell_val:a,date:I,time_stamp_num:y}],n.accumulated_time_cells_array=c):e==="premium_grid"&&(c=[{row_id:i,cell_index:t,cell_val:a,date:I,time_stamp_num:y}],n.premium_cells_array=c)}e==="timesheet_grid"?(n.select_cells_Array=c,n.select_cells_Array.sort(d.m_sort_by(["time_stamp_num","row_id"]))):e==="absence_grid"?(n.absence_select_cells_Array=c,n.absence_select_cells_Array.sort(d.m_sort_by(["time_stamp_num","row_id"]))):e==="accumulated_grid"?(n.accumulated_time_cells_array=c,n.accumulated_time_cells_array.sort(d.m_sort_by(["time_stamp_num","row_id"]))):e==="premium_grid"&&(n.premium_cells_array=c,n.premium_cells_array.sort(d.m_sort_by(["time_stamp_num","row_id"])))}else I=g?g.format():"",y=g?g.getTime():0,e==="timesheet_grid"?(m=N(i,t),h=W(i,t),c=[{row_id:i,cell_index:t,cell_val:a,punch:m,status_id:o&&o.status_id?o.status_id:null,related_punch:h,date:I,time_stamp_num:y}],n.select_cells_Array=c):e==="absence_grid"?(c=[{row_id:i,cell_index:t,cell_val:a,punch:m,date:I,time_stamp_num:y,src_object_id:o.punch_info_id?o.punch_info_id:null}],n.absence_select_cells_Array=c):e==="accumulated_grid"?(c=[{row_id:i,cell_index:t,cell_val:a,date:I,time_stamp_num:y}],n.accumulated_time_cells_array=c):e==="premium_grid"&&(c=[{row_id:i,cell_index:t,cell_val:a,date:I,time_stamp_num:y}],n.premium_cells_array=c),g&&g.getYear()>0&&(this.setDatePickerValue(g.format(d.getLoginUserDateFormat())),this.highLightSelectDay(r),this.reLoadSubGridsSource()),this.unsetSelectedCells(e);this.select_punches_array=[];for(var f in c)c[f].punch&&this.select_punches_array.push(c[f].punch);this.setTimesheetGridDragAble();function N(K,Z){var ee=null;o=null;for(var te in n.timesheet_data_source)if(n.timesheet_data_source[te].id==K){o=n.timesheet_data_source[te];break}return o&&(_=n.grid.getGridParam("colModel"),u=_[Z].name,ee=o[u+"_data"]?o[u+"_data"]:null),ee}function W(K,Z){var ee=null;o=null;for(var te in n.timesheet_data_source)if(n.timesheet_data_source[te].id==K){o=n.timesheet_data_source[te];break}return o&&(_=n.grid.getGridParam("colModel"),u=_[Z].name,ee=o[u+"_related_data"]?o[u+"_related_data"]:null),ee}return!0}get_selected_punch_array(){}buildTimeSheetRequests(){for(var e=this.full_timesheet_data.request_data,i=e.length,t=null,a=0;a<i;a++){var s=e[a],r=d.strToDate(s.date_stamp).format(this.full_format),n;t?(n=this.timesheet_data_source[t],d.isSet(n[r+"_request"])?(l.type(n[r+"_request"])==="array"||(n[r+"_request"]=[n[r+"_request"]]),n[r+"_request"].push(s),n[r]=o(n[r+"_request"])):(n[r]=s.status,n[r+"_request"]=s)):(n={},n.punch_info=l.i18n._("Requests"),n.user_id=s.user_id,n[r]=s.status,n[r+"_request"]=s,n.type=P.REQUEST_ROW,this.timesheet_data_source.push(n),t=this.timesheet_data_source.length-1)}function o(_){for(var u=_.length,m=0,h=0,c=0,g="",p=0;p<u;p++){var b=_[p];b.status_id==50?m=m+1:b.status_id==55?h=h+1:b.status_id==30&&(c=c+1)}return m>0&&(g+=" A: "+m),c>0&&(g+=" P: "+c),h>0&&(g+=" D: "+h),g}}buildTimeSheetExceptions(){for(var e=this.full_timesheet_data.exception_data,i=e.length,t=this.timesheet_data_source.length,a=null,s=0;s<i;s++){var r=e[s],n=d.strToDate(r.date_stamp).format(this.full_format),o;a?(o=this.timesheet_data_source[a],d.isSet(o[n+"_exceptions"])?o[n+"_exceptions"].push(r):o[n+"_exceptions"]=[r]):(o={},o.punch_info=l.i18n._("Exceptions"),o.user_id=r.user_id,o[n]="",o[n+"_exceptions"]=[r],o.type=P.EXCEPTION_ROW,this.timesheet_data_source.push(o),a=this.timesheet_data_source.length-1);var _,u;if(d.isFalseOrNull(r.punch_id)){if(!d.isFalseOrNull(r.punch_control_id))for(var u=0;u<t;u++)o=this.timesheet_data_source[u],o[n]&&(o[n+"_data"]?_=o[n+"_data"]:o[n+"_related__data"]&&(_=o[n+"_related_data"]),_&&_.punch_control_id===r.punch_control_id&&!_.exception&&(_.exception=[r]))}else for(var u=0;u<t;u++)o=this.timesheet_data_source[u],o[n]&&(o[n+"_data"]?_=o[n+"_data"]:o[n+"_related__data"]&&(_=o[n+"_related_data"]),_&&_.id===r.punch_id&&!_.exception&&(_.exception=[r]))}}sortAccumulatedTotalData(){var e=["order","punch_info"];this.accumulated_total_grid_source.sort(d.m_sort_by(e))}sortAccumulatedTimeData(){var e=["order","punch_info"];this.accumulated_time_source.sort(d.m_sort_by(e))}reLoadSubGridsSource(e){if(!(!this.full_timesheet_data||!this.full_timesheet_data.timesheet_verify_data)&&!(!e&&(this.full_timesheet_data.timesheet_verify_data.pay_period_id===this.pay_period_map[this.getSelectDate()]||!d.isSet(this.full_timesheet_data.timesheet_verify_data.pay_period_id)&&!this.pay_period_map[this.getSelectDate()]))){this.accumulated_time_source_map={},this.branch_source_map={},this.department_source_map={},this.job_source_map={},this.job_item_source_map={},this.punch_tag_source_map={},this.premium_source_map={},this.accumulated_total_grid_source_map={},this.accumulated_time_source=[],this.branch_source=[],this.department_source=[],this.job_source=[],this.job_item_source=[],this.punch_tag_source=[],this.premium_source=[],this.accumulated_total_grid_source=[],this.verification_grid_source=[];var i=this,t=this.start_date_picker.getValue(),a=this.getSelectEmployee();this.api_timesheet.getTimeSheetTotalData(a,t,{onResult:function(s){i.onReloadSubGridResult(s)}})}}onReloadSubGridResult(e){var i=this;e=e.getResult(),i.full_timesheet_data.accumulated_user_date_total_data=e.accumulated_user_date_total_data,i.full_timesheet_data.meal_and_break_total_data=e.meal_and_break_total_data,i.full_timesheet_data.pay_period_accumulated_user_date_total_data=e.pay_period_accumulated_user_date_total_data,i.full_timesheet_data.timesheet_verify_data=e.timesheet_verify_data,i.full_timesheet_data.pay_period_data=e.pay_period_data,i.timesheet_verify_data=i.full_timesheet_data.timesheet_verify_data,i.buildSubGridsSource(),i.buildPunchNoteGridSource(),i.buildAccumulatedTotalGrid(),i.buildVerificationGridSource(),i.accumulated_time_grid.setData(i.accumulated_time_source,!1),i.branch_grid.setData(i.branch_source,!1),i.department_grid.setData(i.department_source,!1),i.job_grid.setData(i.job_source,!1),i.job_item_grid.setData(i.job_item_source,!1),i.punch_tag_grid.setData(i.punch_tag_source,!1),i.premium_grid.setData(i.premium_source,!1),i.accumulated_total_grid_source.length===0&&i.accumulated_total_grid_source.push(),i.accumulated_total_grid.setData(i.accumulated_total_grid_source,!1),i.punch_note_grid.setData(i.punch_note_grid_source,!1),i.verification_grid.setData(i.verification_grid_source,!1),i.setGridSize()}setDefaultMenuEditIcon(e,i){let t=this.getPunchPermissionType();(!this.editPermissionValidate(t)||this.edit_only_mode)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),i===1&&this.editOwnerOrChildPermissionValidate(t)&&(this.getPunchMode()==="punch"||t==="absence")?(ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0),ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0)):(ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),i!==0&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1))}setEditMenuAddIcon(e){let i=this.getPunchPermissionType();(!this.addPermissionValidate(i)||this.edit_only_mode)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),this.is_add==!0&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setEditMenuDeleteIcon(e){let i=this.getPunchPermissionType();(!this.deletePermissionValidate(i)||this.edit_only_mode)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),(!this.current_edit_record||!this.current_edit_record.id||!this.deleteOwnerOrChildPermissionValidate(i))&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setEditMenuDeleteAndNextIcon(e){let i=this.getPunchPermissionType();(!this.deletePermissionValidate(i)||this.edit_only_mode)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),(!this.current_edit_record||!this.current_edit_record.id||!this.deleteOwnerOrChildPermissionValidate(i))&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setEditMenuEditIcon(e,i){let t=this.getPunchPermissionType();(!this.editPermissionValidate(t)||this.edit_only_mode||this.is_mass_editing)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),(!this.is_viewing||!this.editOwnerOrChildPermissionValidate(t))&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuDeleteIcon(e,i){let t=this.getPunchPermissionType();(!this.deletePermissionValidate(t)||this.edit_only_mode)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),i>=1&&this.deleteOwnerOrChildPermissionValidate(t)&&(this.getPunchMode()==="punch"||t==="absence")?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuDeleteAndNextIcon(e,i){let t=this.getPunchPermissionType();(!this.deletePermissionValidate(t)||this.edit_only_mode)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuViewIcon(e,i){let t=this.getPunchPermissionType();(!this.viewPermissionValidate(t)||this.edit_only_mode)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),i===1&&this.viewOwnerOrChildPermissionValidate()&&(this.getPunchMode()==="punch"||t==="absence")?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuAddPunchIcon(e,i){let t="punch";(!this.addPermissionValidate(t)||this.edit_only_mode)&&(ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)),this.getPunchMode()==="manual"&&t!=="absence"&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuAddAbsenceIcon(e,i){let t="absence";(!this.addPermissionValidate(t)||this.edit_only_mode)&&(ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)),this.getPunchMode()==="manual"&&t!=="absence"&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuSaveIcon(e,i){let t=this.getPunchPermissionType();!this.addPermissionValidate(t)&&!this.editPermissionValidate(t)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),this.getPunchMode()==="manual"?(!this.addPermissionValidate(t)&&!this.editPermissionValidate(t)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),this.is_saving_manual_grid&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)):(ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1))}buildAccmulatedOrderMap(e){if(e)for(var i in e)for(var t in e[i])this.accmulated_order_map[t]=e[i][t].order}buildSubGridsSource(){var e=this.full_timesheet_data.accumulated_user_date_total_data,i=this.full_timesheet_data.meal_and_break_total_data,t=this.full_timesheet_data.pay_period_accumulated_user_date_total_data;this.accmulated_order_map={},e.total&&this.buildAccmulatedOrderMap(e.total),t&&this.buildAccmulatedOrderMap(t);var a=t.accumulated_time,s=t.premium_time,r=t.absence_time_taken;this.marked_regular_row={},d.isSet(a)?this.buildSubGridsData(a,"pay_period",this.accumulated_total_grid_source_map,this.accumulated_total_grid_source,"accumulated_time"):(a={total:{label:l.i18n._("Total Time"),total_time:"0"}},this.buildSubGridsData(a,"pay_period",this.accumulated_total_grid_source_map,this.accumulated_total_grid_source,"accumulated_time")),d.isSet(s)&&this.buildSubGridsData(s,"pay_period",this.accumulated_total_grid_source_map,this.accumulated_total_grid_source,"premium_time"),d.isSet(r)&&this.buildSubGridsData(r,"pay_period",this.accumulated_total_grid_source_map,this.accumulated_total_grid_source,"absence_time"),this.accumulated_time_grid.grid.clearGridData();var n=this.timesheet_columns.length;a={total:{label:l.i18n._("Total Time"),total_time:"0"}};for(var o,_,u=n-7-1,m=u;m<n;m++)o=this.timesheet_columns[m].name?this.timesheet_columns[m].name:"",!(o.indexOf("empty_cell")>=0||o.indexOf("punch_info")>=0)&&this.buildSubGridsData(a,o,this.accumulated_time_source_map,this.accumulated_time_source,"accumulated_time");this.buildSubGridsData(a,"week",this.accumulated_total_grid_source_map,this.accumulated_total_grid_source,"accumulated_time");for(var h in e){if(h==="total"){var c=e.total;a=c.accumulated_time,s=c.premium_time,r=c.absence_time_taken,d.isSet(a)&&this.buildSubGridsData(a,"week",this.accumulated_total_grid_source_map,this.accumulated_total_grid_source,"accumulated_time"),d.isSet(s)&&this.buildSubGridsData(s,"week",this.accumulated_total_grid_source_map,this.accumulated_total_grid_source,"premium_time"),d.isSet(r)&&this.buildSubGridsData(r,"week",this.accumulated_total_grid_source_map,this.accumulated_total_grid_source,"absence_time");continue}if(_=d.strToDate(h),!!_){if(o=_.format(this.full_format),typeof e[h]<"u"){a=e[h].accumulated_time;var g=e[h].branch_time,p=e[h].department_time,b=e[h].job_time,v=e[h].job_item_time,f=e[h].punch_tag_time;s=e[h].premium_time}else Debug.Text("ERROR: accumulated_user_date_total_data[key] is null or undefined!","TimesheetViewController.js","TimesheetViewController","buildSubGridsSource",1);d.isSet(a)&&this.buildSubGridsData(a,o,this.accumulated_time_source_map,this.accumulated_time_source,"accumulated_time"),d.isSet(g)&&this.buildSubGridsData(g,o,this.branch_source_map,this.branch_source,"branch_time"),d.isSet(p)&&this.buildSubGridsData(p,o,this.department_source_map,this.department_source,"department_time"),d.isSet(b)&&this.buildSubGridsData(b,o,this.job_source_map,this.job_source,"job_time"),d.isSet(v)&&this.buildSubGridsData(v,o,this.job_item_source_map,this.job_item_source,"job_item_time"),d.isSet(f)&&this.buildSubGridsData(f,o,this.punch_tag_source_map,this.punch_tag_source,"punch_tag_time"),d.isSet(s)&&this.buildSubGridsData(s,o,this.premium_source_map,this.premium_source,"premium_time")}}if(this.sortAccumulatedTotalData(),this.sortAccumulatedTimeData(),d.isSet(i))for(var h in i)_=d.strToDate(h),_&&(o=_.format(this.full_format),this.buildBreakAndLunchData(i[h],o))}buildBreakAndLunchData(e,i){var t;for(var a in e)this.accumulated_time_source_map[a]?(t=this.accumulated_time_source_map[a],t[i]||(e[a].key=a,t[i]=d.getTimeUnit(e[a].total_time)+" ("+e[a].total_breaks+")",t[i+"_data"]=e[a])):(t={},t.punch_info=e[a].break_name,e[a].key=a,t[i]=d.getTimeUnit(e[a].total_time)+" ("+e[a].total_breaks+")",t[i+"_data"]=e[a],this.timesheet_data_source.push(t),this.accumulated_time_source_map[a]=t)}addCellCount(e){switch(e){case"branch_time":this.branch_cell_count=this.branch_cell_count+1;break;case"department_time":this.department_cell_count=this.department_cell_count+1;break;case"premium_time":this.premium_cell_count=this.premium_cell_count+1;break;case"job_time":this.job_cell_count=this.job_cell_count+1;break;case"job_item_time":this.task_cell_count=this.task_cell_count+1;break;case"punch_tag_time":this.punch_tag_cell_count=this.punch_tag_cell_count+1;break}}buildSubGridsData(e,i,t,a,s){var r,n=this.start_date_picker.getValue();this.marked_regular_row[n]||(this.marked_regular_row[n]=!1);for(var o in e){if(t[o])r=t[o],r[i]&&o==="total"?(e[o].key=o,r[i]=d.getTimeUnit(e[o].total_time),r[i+"_data"]=e[o],r.parent_key==="accumulated_time"&&e[o].override&&(r.is_override_row=!0)):(e[o].key=o,r[i]=d.getTimeUnit(e[o].total_time),r[i+"_data"]=e[o],r.parent_key==="accumulated_time"&&e[o].override&&(r.is_override_row=!0));else{r={},r.parent_key=s,r.key=o,s==="accumulated_time"?(o==="total"||o==="worked_time"?r.type=P.TOTAL_ROW:(this.marked_regular_row[n]==!1||this.marked_regular_row[n]==o)&&o.indexOf("regular_time")===0?(r.type=P.REGULAR_ROW,this.marked_regular_row[n]=o):r.type=P.ACCUMULATED_TIME_ROW,e[o].override&&(r.is_override_row=!0)):s==="premium_time"&&(r.type=P.PREMIUM_ROW),this.accmulated_order_map[o]&&(r.order=this.accmulated_order_map[o]),r.punch_info=e[o].label;var _=o.split("_"),u=!1;_.length>1&&_[1]=="0"&&(u=!0),e[o].key=o,r[i]=d.getTimeUnit(e[o].total_time),r[i+"_data"]=e[o],u?a.unshift(r):a.push(r),t[o]=r}this.addCellCount(s)}}timeSheetVerifyPermissionValidate(){return!!(PermissionManager.validate("punch","verify_time_sheet")&&this.timesheet_verify_data.hasOwnProperty("pay_period_verify_type_id")&&this.timesheet_verify_data.pay_period_verify_type_id!=10)}buildVerificationGridSource(){this.verification_grid_source=[];var e=this,i=l(this.el).find(".verification-action-bar"),t=l(this.el).find(".verification-grid-div"),a=l(this.el).find(".verify-button"),s=l(this.el).find(".verification-grid-title"),r=l(this.el).find(".verify-description");if(this.timeSheetVerifyPermissionValidate()&&d.isSet(this.timesheet_verify_data.pay_period_id)&&d.isSet(this.timesheet_verify_data.pay_period_verify_type_id)&&this.timesheet_verify_data.pay_period_verify_type_id!=="10")this.timesheet_verify_data.display_verify_button?(a.css("display","inline-block"),s.css("display","block")):(a.css("display","none"),s.css("display","none")),t.css("display","block"),r.text(this.timesheet_verify_data.verification_status_display),this.timesheet_verify_data.verification_box_color?i.css("background",this.timesheet_verify_data.verification_box_color):i.css("background","#ffffff"),a.unbind("click").bind("click",d.debounce(function(u){l(u.target).prop("disabled",!0),TAlertManager.showConfirmAlert(e.timesheet_verify_data.verification_confirmation_message,l.i18n._("TimeSheet Verification Agreement"),function(m){m?e.api_timesheet.verifyTimeSheet(e.getSelectEmployee(),e.timesheet_verify_data.pay_period_id,{onResult:function(h){l(u.target).prop("disabled",!1),h&&h.isValid()?e.search():TAlertManager.showErrorAlert(h)},onError:function(){l(u.target).prop("disabled",!1)}}):l(u.target).prop("disabled",!1)},l.i18n._("I Agree"),l.i18n._("I Do Not Agree"))},d.calcDebounceWaitTimeBasedOnNetwork(),!0));else{a.css("display","none"),t.css("display","none");return}var n=this.timesheet_verify_data.verification_window_dates.start+" "+l.i18n._("to")+" "+this.timesheet_verify_data.verification_window_dates.end,o=this.pay_period_header;this.verification_grid_source.push({pay_period:o,verification:n}),e.setGridHeight("verification_grid")}buildPunchNoteGridSource(){this.punch_note_grid_source=[];for(var e=this.full_timesheet_data.punch_data,i=this.full_timesheet_data.user_date_total_data,t=e.length,a=i.length,s="",r,n,o=0;o<t;o++){var _=e[o];r=d.strToDate(_.date_stamp),n=r.format(),_.note&&_.punch_control_id!==s&&(this.punch_note_account=this.punch_note_account+1,this.punch_note_grid_source.push({note:n+" @ "+_.punch_time+": "+_.note.replace(/\n/g," ")}),s=_.punch_control_id)}for(var u=0;u<a;u++){var m=i[u];r=d.strToDate(m.date_stamp),n=r.format(),m.note&&(this.punch_note_account=this.punch_note_account+1,this.punch_note_grid_source.push({note:n+" @ "+d.getTimeUnit(m.total_time)+": "+m.note.replace(/\n/g," ")}))}}buildAbsenceSource(){var e={};this.absence_source=[],this.absence_original_source=[];for(var i=this.full_timesheet_data.user_date_total_data,t=i.length,a,s=1,r=0;r<t;r++){var n=i[r];if(n.object_type_id==50){this.absence_original_source.push(n);var o=d.strToDate(n.date_stamp),_=o.format(this.full_format),u=n.src_object_id+"-"+n.pay_code_id;e[u]?(a=e[u],a[_]?(a={},a.id=s,a.type=P.ABSENCE_ROW,a.punch_info=n.name,a.punch_info_id=n.src_object_id,a.user_id=n.user_id,a[_]=d.getTimeUnit(n.total_time),a[_+"_data"]=n,this.absence_source.push(a),e[u]=a):(this.lastDayIsOverride(o,a,n),a[_]=d.getTimeUnit(n.total_time),a[_+"_data"]=n)):(a={},a.id=s,a.type=P.ABSENCE_ROW,a.punch_info=n.name,a.punch_info_id=n.src_object_id,a.user_id=n.user_id,a[_]=d.getTimeUnit(n.total_time),a[_+"_data"]=n,this.absence_source.push(a),e[u]=a),s++,this.absence_cell_count=this.absence_cell_count+1}}this.absence_source.length===0&&(a={},a.id=1,a.punch_info="",a.user_id=this.getSelectEmployee(),this.absence_source.push(a))}lastDayIsOverride(e,i,t){var a=new Date(new Date(e.getTime()).setDate(e.getDate()-1)),s=a.format(this.full_format),r=i[s+"_data"];return!!(r&&r.override&&t.src_object_id===r.src_object_id)}buildTimeSheetSource(){this.select_punches_array=[],this.timesheet_data_source=[];for(var e=this.full_timesheet_data.punch_data,i=e.length,t,a,s=1,r=0;r<i;r++){var n=e[r];if(n.date_stamp){var o=d.strToDate(n.date_stamp),_=o.format(this.full_format),u=n.status_id;if(r===0)if(t={},t.id=s,s++,t.punch_info=n.status,t.status_id=u,t.user_id=n.user_id,t[_]=n.punch_time,t[_+"_data"]=n,t[_+"_related_data"]=null,t.status_id=u,t.type=P.PUNCH_ROW,this.timesheet_data_source.push(t),u==10){var m={};m.punch_info=l.i18n._("Out"),m.user_id=n.user_id,m[_]="",m[_+"_data"]=null,m[_+"_related_data"]=n,m.status_id=20,m.type=P.PUNCH_ROW,m.id=s,s++,this.timesheet_data_source.push(m)}else a={},a.punch_info=l.i18n._("In"),a.user_id=n.user_id,a[_]="",a[_+"_data"]=null,a[_+"_related_data"]=n,a.status_id=10,a.type=P.PUNCH_ROW,a.id=s,s++,this.timesheet_data_source.splice(this.timesheet_data_source.length-1,0,a);else{for(var h=!1,c=this.timesheet_data_source.length,g=0;g<c;g++)if(t=this.timesheet_data_source[g],!t[_]){if(!t[_]&&t[_+"_related_data"]){var p=t[_+"_related_data"];if(p.punch_control_id===n.punch_control_id){t[_]=n.punch_time,t[_+"_data"]=n,h=!0;break}}else if(!t[_]&&!t[_+"_related_data"]&&n.status_id==t.status_id){t[_]=n.punch_time,t[_+"_data"]=n,t[_+"_related_data"]=null,h=!0,n.status_id==10?(a=this.timesheet_data_source[g+1],a[_]="",a[_+"_data"]=null,a[_+"_related_data"]=n):(a=this.timesheet_data_source[g-1],a[_]="",a[_+"_data"]=null,a[_+"_related_data"]=n);break}}h||(t={},t.punch_info=n.status,t.user_id=n.user_id,t[_]=n.punch_time,t[_+"_data"]=n,t[_+"_related_data"]=null,t.status_id=u,t.type=P.PUNCH_ROW,t.id=s,s++,this.timesheet_data_source.push(t),u==10?(a={},a.punch_info=l.i18n._("Out"),a.user_id=n.user_id,a[_]="",a[_+"_data"]=null,a[_+"_related_data"]=n,a.status_id=20,a.type=P.PUNCH_ROW,a.id=s,s++,this.timesheet_data_source.push(a)):(a={},a.punch_info=l.i18n._("In"),a.user_id=n.user_id,a[_]="",a[_+"_data"]=null,a[_+"_related_data"]=n,a.status_id=10,a.type=P.PUNCH_ROW,a.id=s,s++,this.timesheet_data_source.splice(this.timesheet_data_source.length-1,0,a)))}}}t={},t.punch_info=l.i18n._("In"),t.user_id=this.getSelectEmployee(),t.status_id=10,t.type=P.PUNCH_ROW,t.id=s,s++,this.timesheet_data_source.push(t),t={},t.punch_info=l.i18n._("Out"),t.user_id=this.getSelectEmployee(),t.status_id=20,t.type=P.PUNCH_ROW,t.id=s,s++,this.timesheet_data_source.push(t)}buildTimeSheetsColumns(){if(this.timesheet_columns=[],this.getPunchMode()==="manual"){var e=[{name:"plus_sign",width:25},{name:"minus_sign",width:25}];this.show_branch_ui&&e.push({name:"branch",width:125}),this.show_department_ui&&e.push({name:"department",width:125}),d.getProductEdition()>=20&&(this.show_job_ui&&e.push({name:"job",width:170}),this.show_job_item_ui&&e.push({name:"job_item",width:170}),this.show_punch_tag_ui&&e.push({name:"punch_tag",width:170}));for(var i=e.length-1,t=0;t<e.length;t++){if(t==i)var a={name:"punch_info",index:"punch_info",label:" ",width:170,sortable:!1,title:!1,formatter:this.onCellFormat,fixed:!0};else var a={name:"empty_cell_"+t,index:"empty_cell_"+t,label:" ",width:e[t].width,sortable:!1,title:!1,fixed:!0};this.timesheet_columns.push(a)}}else{var s={name:"punch_info",index:"punch_info",label:" ",width:100,sortable:!1,title:!1,formatter:this.onCellFormat,fixed:!1};this.timesheet_columns.push(s)}this.column_maps=[];for(var t=0;t<7;t++){var r=new Date(new Date(this.start_date.getTime()).setDate(this.start_date.getDate()+t)),n=r.format(this.weekly_format);if(LocalCacheData.getLoginData().language!="en"&&d.isString(n)){var o=n.split(","),_=o[1].split(" ");n=l.i18n._(o[0])+", "+l.i18n._(_[1])+" "+_[2]}var u=r.format(this.full_format);this.column_maps.push(r.format());var m={resizable:!1,name:u,index:u,label:n,width:100,sortable:!1,title:!1,formatter:this.onCellFormat};this.timesheet_columns.push(m)}return this.timesheet_columns}getDefaultDisplayColumns(e){e()}setSelectLayout(){var e=this;if(!d.isSet(this.grid)){var i=l(this.el).find("#grid");i.attr("id",this.ui_id+"_grid"),i=l(this.el).find("#"+this.ui_id+"_grid")}if(this.select_layout||(this.select_layout={id:""},this.select_layout.data={filter_data:{},filter_sort:{}}),this.select_layout.data.mode&&this.toggle_button.setValue(this.select_layout.data.mode),this.wage_btn.setValue(!!this.select_layout.data.show_wage),this.timezone_btn.setValue(!!this.select_layout.data.use_employee_timezone),this.search_panel){var t=this.search_panel.getLayoutsArray();if(this.previous_saved_layout_selector&&this.previous_saved_layout_selector.empty(),t&&t.length>0){this.previous_saved_layout_div.css("display","inline");for(var a=t.length,s=0;s<a;s++){var r=t[s];this.previous_saved_layout_selector.append(l('<option value="'+r.id+'"></option>').text(r.name))}l(this.previous_saved_layout_selector.find("option")).filter(function(){return l(this).attr("value")===e.select_layout.id}).prop("selected",!0).attr("selected",!0)}else this.previous_saved_layout_div&&this.previous_saved_layout_div.css("display","none");LocalCacheData.default_filter_for_next_open_view&&(this.select_layout.data.filter_data=LocalCacheData.default_filter_for_next_open_view.filter_data,LocalCacheData.default_filter_for_next_open_view=null),this.filter_data=this.select_layout.data.filter_data,this.setSearchPanelFilter(!0)}}setTimesheetGridDragAble(){var e=this,i=0,t=this.grid.grid.find(".date-column").parents("td");t.attr("draggable",!0),t.off("dragstart").on("dragstart",function(a){var s=a.target;if(e.select_punches_array.length<1||!l(s).hasClass("ui-state-highlight")||!e.select_drag_menu_id)return!1;for(var r=l("<div class='drag-holder-div'></div>"),n=e.select_punches_array.length,o=0;o<n;o++){var _=e.select_punches_array[o],u=l("<span class='drag-span'></span>");u.text(_.status+": "+_.time_stamp),r.append(u)}return l("body").find(".drag-holder-div").remove(),l("body").append(r),a.originalEvent.dataTransfer.setData("Text","timesheet"),a.originalEvent.dataTransfer.setDragImage&&a.originalEvent.dataTransfer.setDragImage(r[0],0,0),!0}),t.off("dragover").on("dragover",function(a){var s=a.originalEvent;s.preventDefault();var r=this,n=l(this);l(".timesheet-drag-over").removeClass("timesheet-drag-over"),l(".drag-over-top").removeClass("drag-over-top"),l(".drag-over-center").removeClass("drag-over-center"),l(".drag-over-bottom").removeClass(" drag-over-bottom"),l(r).addClass("timesheet-drag-over"),s.pageY-n.offset().top<=8?(i=-1,n.removeClass("drag-over-top drag-over-center drag-over-bottom").addClass("drag-over-top")):s.pageY-n.offset().top>=n.height()-5?(i=1,n.removeClass("drag-over-top drag-over-center drag-over-bottom").addClass("drag-over-bottom")):(i=0,n.removeClass("drag-over-top drag-over-center drag-over-bottom").addClass("drag-over-center"))}),t.off("dragend").on("dragend",function(a){l(".timesheet-drag-over").removeClass("timesheet-drag-over"),l(".drag-over-top").removeClass("drag-over-top"),l(".drag-over-center").removeClass("drag-over-center"),l(".drag-over-bottom").removeClass(" drag-over-bottom"),l("body").find(".drag-holder-div").remove()}),t.off("drop").on("drop",function(a){a.preventDefault(),a.stopPropagation&&a.stopPropagation(),l(this).removeClass("drag-over-top drag-over-center drag-over-bottom timesheet-drag-over");var s=a.currentTarget,r=0;if(l(s).index()===0||!e.select_punches_array||!e.select_punches_array[r])return;var n=e.select_punches_array[r],o=d.strToDate(n.punch_date),_=e.timesheet_data_source[s.parentNode.rowIndex-1];if(!_)return;var u=e.grid.getGridParam("colModel"),m=u[s.cellIndex].name,h=_[m+"_data"],c=_[m+"_related_data"],g=d.strToDate(m,e.full_format),p=o,b=g.getTime()-o.getTime(),v=g.format();f();function f(){if(e.select_punches_array){var A=n.id,M=!1,T=_.status_id,S=e.select_drag_menu_id==="move"?1:0;h&&n.status_id==20?(M=h.id,T=!1):c&&(M=c.id,c.status_id==10?i=1:i=-1,T=!1);var D=TTAPI.APIPunchControl;D.dragNdropPunch(A,M,T,i,S,v,{onResult:function(I){var y=I.getResult();if(I&&I.isValid()&&e.select_punches_array&&e.select_punches_array.length>0){if(r=r+1,r>e.select_cells_Array.length-1){e.search(!0);return}if(!e.select_punches_array[r]){e.search(!0);return}for(;!e.select_punches_array[r].date_stamp;)if(r=r+1,r>e.select_cells_Array.length-1){e.search(!0);return}i=1;var F=v;n=e.select_punches_array[r],o=d.strToDate(n.punch_date),_=e.timesheet_data_source[s.parentNode.rowIndex-1],u=e.grid.getGridParam("colModel"),m=u[s.cellIndex].name,b=o.getTime()-p.getTime(),g=d.strToDate(m,e.full_format),v=new Date(g.getTime()+b).format(),h={id:y},c=null,v!==F&&(i=0,h=null),f()}else TAlertManager.showAlert(l.i18n._("Unable to drag and drop punch to the specified location")),r>0&&e.search(!0)}})}}})}setPunchModeClass(){this.$el.removeClass("timesheet-punch-mode"),this.$el.removeClass("timesheet-manual-mode"),this.getPunchMode()==="punch"?this.$el.addClass("timesheet-punch-mode"):this.$el.addClass("timesheet-manual-mode")}initData(){var e=this;d.removeViewTab(this.viewId);var i=LocalCacheData.getLoginUser();if(this.initOptions(),ProgressBar.showOverlay(),LocalCacheData.last_timesheet_selected_show_wage?this.wage_btn.setValue(LocalCacheData.last_timesheet_selected_show_wage):this.wage_btn.setValue(!1),d.isSet(LocalCacheData.getAllURLArgs())&&LocalCacheData.getAllURLArgs().show_wage&&this.wage_btn.setValue(LocalCacheData.getAllURLArgs().show_wage==="1"),LocalCacheData.last_timesheet_selected_timezone?this.timezone_btn.setValue(LocalCacheData.last_timesheet_selected_timezone):this.timezone_btn.setValue(!1),d.isSet(LocalCacheData.getAllURLArgs())&&LocalCacheData.getAllURLArgs().timezone&&this.timezone_btn.setValue(LocalCacheData.getAllURLArgs().timezone==="1"),this.show_punch_mode_ui?(LocalCacheData.last_timesheet_selected_punch_mode?this.toggle_button.setValue(LocalCacheData.last_timesheet_selected_punch_mode):this.toggle_button.setValue("punch"),LocalCacheData.getAllURLArgs().mode&&this.toggle_button.setValue(LocalCacheData.getAllURLArgs().mode==="manual"?"manual":"punch")):!PermissionManager.validate(this.permission_id,"punch_timesheet")&&!PermissionManager.validate(this.permission_id,"manual_timesheet")?this.toggle_button.setValue("punch"):(PermissionManager.validate(this.permission_id,"punch_timesheet")&&this.toggle_button.setValue("punch"),d.getProductEdition()>=15&&PermissionManager.validate(this.permission_id,"manual_timesheet")&&this.toggle_button.setValue("manual")),d.UNIT_TEST_MODE==!0&&(LocalCacheData.last_timesheet_selected_date="15-Feb-18"),LocalCacheData.default_filter_for_next_open_view)this.employee_nav.setValue(LocalCacheData.default_filter_for_next_open_view.user_id),this.setDatePickerValue(LocalCacheData.default_filter_for_next_open_view.base_date);else if(LocalCacheData.getAllURLArgs().user_id?this.employee_nav.setValue(LocalCacheData.getAllURLArgs().user_id):LocalCacheData.last_timesheet_selected_user?this.employee_nav.setValue(LocalCacheData.last_timesheet_selected_user):this.employee_nav.setValue(i),LocalCacheData.last_timesheet_selected_date)this.setDatePickerValue(LocalCacheData.last_timesheet_selected_date);else if(LocalCacheData.current_select_date&&d.strToDate(LocalCacheData.current_select_date,"YYYY-MM-DD"))this.setDatePickerValue(d.strToDate(LocalCacheData.current_select_date,"YYYY-MM-DD").format()),LocalCacheData.current_select_date="";else{var t=new Date,a=d.getLoginUserDateFormat(),s=t.format(a);this.setDatePickerValue(s)}TTPromise.wait("BaseViewController","getCustomFields",function(){e.initLayout()}),this.setMoveOrDropMode(this.select_drag_menu_id?this.select_drag_menu_id:"move")}setDatePickerValue(e){this.start_date_picker.setValue(e),this.start_date_picker.getDefaultFormatValue();var i=this.getSelectEmployee();if(i&&!this.edit_view&&window.location.href.indexOf("user_id="+i)===-1){var t=d.getBaseURL()+"#!m="+this.viewId+"&user_id="+i+"&show_wage="+this.wage_btn.getValue(!0)+"&mode="+this.toggle_button.getValue();if(LocalCacheData.getAllURLArgs())for(var a in LocalCacheData.getAllURLArgs())a==="m"||a==="user_id"||a==="show_wage"||a==="timezone"||a==="mode"||(t=t+"&"+a+"="+LocalCacheData.getAllURLArgs()[a]);d.setURLToBrowser(t)}LocalCacheData.last_timesheet_selected_date=e}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:l.i18n._("Punch Branch"),in_column:1,field:"branch_id",layout_name:"global_branch",api_class:TTAPI.APIBranch,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:l.i18n._("Punch Department"),field:"department_id",in_column:1,layout_name:"global_department",api_class:TTAPI.APIDepartment,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:l.i18n._("Job"),in_column:2,field:"job_id",layout_name:"global_job",api_class:d.getProductEdition()>=20?TTAPI.APIJob:null,multiple:!0,basic_search:this.show_job_item_ui&&d.getProductEdition()>=20,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:l.i18n._("Task"),in_column:2,field:"job_item_id",layout_name:"global_job_item",api_class:d.getProductEdition()>=20?TTAPI.APIJobItem:null,multiple:!0,basic_search:this.show_job_item_ui&&d.getProductEdition()>=20,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:l.i18n._("Tags"),in_column:2,field:"punch_tag_id",layout_name:"global_punch_tag",api_class:d.getProductEdition()>=20?TTAPI.APIPunchTag:null,multiple:!0,basic_search:this.show_punch_tag_ui&&d.getProductEdition()>=20,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX})]}getSelectEmployee(e){var i=!1;return this.show_navigation_box&&this.employee_nav&&typeof this.employee_nav.getValue=="function"&&(i=this.employee_nav.getValue(!0)),d.isObject(i)==!1&&(i={id:i}),(d.isObject(i)==!1||d.isObject(i)==!0&&(i.hasOwnProperty("id")==!1||V.isUUID(i.id)==!1))&&(i=LocalCacheData.getLoginUser(),d.isObject(i)==!1||d.isObject(i)==!0&&(i.hasOwnProperty("id")==!1||V.isUUID(i.id)==!1))?(MenuManager.doLogout(),!1):(e!=!0&&d.isObject(i)==!0&&i.hasOwnProperty("id")==!0&&V.isUUID(i.id)==!0&&(i=i.id),i)}getSelectDate(){if(this.start_date_picker){var e=this.start_date_picker.getValue();return e=="Invalid date"&&(e=new Date),e}return null}onDeleteResult(e){var i=this;i.timesheet_grid.grid.find("td.ui-state-highlight").removeClass("ui-state-highlight"),ProgressBar.closeOverlay(),e&&e.isValid()?i.edit_view?LocalCacheData.current_doing_context_action==="delete"?i.removeEditView():i.edit_view&&LocalCacheData.current_doing_context_action==="delete_and_next"&&i.onRightArrowClick():this.setCurrentEditViewState(""):(i.revertEditViewState(),TAlertManager.showErrorAlert(e)),i.first_build=!0,i.search(),i.setDefaultMenu()}getDeleteSelectedRecordId(){var e=[];if(this.edit_view)e.push(this.current_edit_record.id);else for(var i in this.select_punches_array){var t=this.select_punches_array[i];e.push(t.id)}return e}reSetURL(){var e="#!m="+this.viewId+"&user_id="+this.getSelectEmployee()+"&show_wage="+this.wage_btn.getValue(!0)+"&timezone="+this.timezone_btn.getValue(!0)+"&mode="+this.toggle_button.getValue();d.setURLToBrowser(d.getBaseURL()+e),LocalCacheData.setAllURLArgs(d.buildArgDic(e.split("&")))}onSaveAndContinue(e){var i=this;d.isSet(e)||(e=!1),this.is_changed=!1,LocalCacheData.current_doing_context_action="save_and_continue";var t=this.getCurrentAPI();this.is_mass_adding&&this.current_edit_record.punch_dates&&this.current_edit_record.punch_dates.length===1&&(this.current_edit_record.punch_date=this.current_edit_record.punch_dates[0]),t.setIsIdempotent(!0),t["set"+t.key_name](this.current_edit_record,!1,e,{onResult:function(a){if(a&&a.isValid()){var s=a.getResult(),r;s===!0?r=i.current_edit_record.id:V.isUUID(s)&&s!=V.zero_id&&s!=V.not_exist_id&&(r=s),i.search(),i.onEditClick(r,i.getPunchPermissionType()),i.previous_absence_policy_id=!1,i.onSaveAndContinueDone(a)}else i.setErrorMenu(),i.setErrorTips(a)}})}getSelectedRecordId(e){var i=!1;return d.isSet(e)?d.isObject(e)&&e.id?i=e.id:d.isString(e)&&V.isUUID(e)&&(i=e):this.select_punches_array.length>0?i=this.select_punches_array[0].id:i=null,i}getViewSelectedRecordId(e){return this.getSelectedRecordId(e)}doViewAPICall(e,i){var t=this.getCurrentAPI(),a={onResult:this.handleViewAPICallbackResult.bind(this)};return i?(i.push(a),t["get"+t.key_name].apply(t,i)):t["get"+t.key_name](e,a)}onViewClick(e,i){var t=this.getViewSelectedRecordId(e);if(d.isFalseOrNull(t)||t==V.not_exist_id){TAlertManager.showAlert(l.i18n._("This punch is still being processed, please try again later.")),ProgressBar.closeOverlay();return}i&&(i==="absence"?this.absence_model=!0:this.absence_model=!1),super.onViewClick(e)}buildOtherFieldUI(e,i){if(this.edit_view_tab){var t,a=this,s=this.edit_view_tab.find("#tab_punch"),r=s.find(".first-column");if(a.edit_view_ui_dic[e])t=a.edit_view_ui_dic[e],t.setValue(a.current_edit_record[e]);else{t=d.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:e});var n=a.addEditFieldToColumn(i,t,r);n.insertBefore(this.edit_view_form_item_dic.note),t.setValue(a.current_edit_record[e])}t.css("opacity",1),t.css("minWidth",300),a.is_viewing?t.setEnabled(!1):t.setEnabled(!0)}}onMassEditClick(){var e=this;LocalCacheData.current_doing_context_action="mass_edit",this.is_mass_editing=!0,e.openEditView(),this.is_mass_adding=!1,this.is_viewing=!1;var i=this.getCurrentAPI(),t={};this.mass_edit_record_ids=[],l.each(this.select_punches_array,function(a,s){e.mass_edit_record_ids.push(s.id)}),t.filter_data={},t.filter_data.id=this.mass_edit_record_ids,i["getCommon"+i.key_name+"Data"](t,{onResult:function(a){var s=a.getResult();i.getOptions("unique_columns",{onResult:function(r){e.unique_columns=r.getResult(),i.getOptions("linked_columns",{onResult:function(n){e.linked_columns=n.getResult(),e.sub_view_mode&&e.parent_key&&(s[e.parent_key]=e.parent_value),d.isSet(s.time_stamp)||(s.time_stamp=!1),e.current_edit_record=s,e.initEditView()}})}})}})}setSubLogViewFilter(){return this.sub_log_view_controller?(this.sub_log_view_controller.getSubViewFilter=function(e){return this.parent_view_controller.absence_model?(e.table_name="user_date_total",e.object_id=this.parent_edit_record.id):e.table_name_object_id={punch:[this.parent_edit_record.id],punch_control:[this.parent_edit_record.punch_control_id]},e},!0):!1}getEditSelectedRecordId(e){return this.getSelectedRecordId(e)}doEditAPICall(e,i){var t=this.getCurrentAPI(),a={onResult:this.handleEditAPICallbackResult.bind(this)};return i?(i.push(a),t["get"+t.key_name].apply(t,i)):t["get"+t.key_name](e,a)}onEditClick(e,i){var t=this.getViewSelectedRecordId(e);if(d.isFalseOrNull(t)||t==V.not_exist_id){TAlertManager.showAlert(l.i18n._("This punch is still being processed, please try again later.")),ProgressBar.closeOverlay();return}i&&(i==="absence"?this.absence_model=!0:this.absence_model=!1),super.onEditClick(e)}setURL(){var e=this.getPunchPermissionType(),i="";switch(LocalCacheData.current_doing_context_action){case"new":case"edit":case"view":i=LocalCacheData.current_doing_context_action;break;case"copy_as_new":i="new";break}var t=this.edit_view_tab?this.edit_view_tab.find(".edit-view-tab-bar-label").children().eq(this.getEditViewTabIndex()).text():"";t=t.replace(/\/|\s+/g,""),this.current_edit_record&&this.current_edit_record.id?(i?d.setURLToBrowser(d.getBaseURL()+"#!m="+this.viewId+"&user_id="+this.getSelectEmployee()+"&show_wage="+this.wage_btn.getValue(!0)+"&mode="+this.toggle_button.getValue()+"&a="+i+"&id="+this.current_edit_record.id+"&t="+e+"&tab="+t):d.setURLToBrowser(d.getBaseURL()+"#!m="+this.viewId+"&user_id="+this.getSelectEmployee()+"&show_wage="+this.wage_btn.getValue(!0)+"&mode="+this.toggle_button.getValue()+"&id="+this.current_edit_record.id+"&t="+e),d.trackView()):i?d.setURLToBrowser(d.getBaseURL()+"#!m="+this.viewId+"&user_id="+this.getSelectEmployee()+"&show_wage="+this.wage_btn.getValue(!0)+"&mode="+this.toggle_button.getValue()+"&a="+i+"&t="+e+"&tab="+t):d.setURLToBrowser(d.getBaseURL()+"#!m="+this.viewId+"&user_id="+this.getSelectEmployee()+"&show_wage="+this.wage_btn.getValue(!0)+"&mode="+this.toggle_button.getValue()+"&t="+e)}onCustomContextClick(e){switch(e){case"add":case"add_punch":this.absence_model=!1,this.onAddClick();break;case"add_absence":this.absence_model=!0,this.onAddClick();break;case"move":case"drag_copy":this.setMoveOrDropMode(e);break;case"in_out":MenuManager.openSelectView("InOut");break;case"schedule":case"pay_stub":case"edit_employee":case"edit_pay_period":this.onNavigationClick(e);break;case"re_calculate_timesheet":case"generate_pay_stub":this.onWizardClick(e);break;case"map":this.onMapClick(e);break;case"accumulated_time":this.onAccumulatedTimeClick(e);break;case"AddRequest":this.select_cells_Array.length>0&&this.addRequestFromTimesheetCell(e);break;case"print_summary":case"print_detailed":this.onReportMenuClick(e);break}}addRequestFromTimesheetCell(e){if(d.getProductEdition()<=10)return TAlertManager.showAlert(d.getUpgradeMessage()),!1;var i=d.strToDate(this.select_cells_Array[0].date?this.select_cells_Array[0].date:this.start_date_picker.getValue()).format(this.full_format);if(this.select_cells_Array[0].punch)var t=this.select_cells_Array[0].punch.punch_control_id,a=this.select_cells_Array[0].punch.id,s=this.select_cells_Array[0].punch.status_id,r=this.select_cells_Array[0].punch.type_id,n=this.select_cells_Array[0].punch.user_id;else var n=this.getSelectEmployee(),t=null,a=null,s=10,r=10;var o=null;if(!a){if(this.select_cells_Array[0].row_id>1&&this.timesheet_data_source[this.select_cells_Array[0].row_id-2]&&this.timesheet_data_source[this.select_cells_Array[0].row_id-2][i+"_data"]){o=this.timesheet_data_source[this.select_cells_Array[0].row_id-2][i+"_data"].id,r=this.timesheet_data_source[this.select_cells_Array[0].row_id-2][i+"_data"].type_id;var _=this.timesheet_data_source[this.select_cells_Array[0].row_id-2][i+"_data"].status_id;s==10&&_==10&&r!=10&&(r=10)}this.timesheet_data_source[this.select_cells_Array[0].row_id-1]&&(s=this.timesheet_data_source[this.select_cells_Array[0].row_id-1].status_id)}var u=this.select_cells_Array[0].time_stamp_num/1e3,m=this;this.api_punch.getRequestDefaultData(n,u,t,o,s,r,a,{onResult:function(h){var c=h.getResult();IndexViewController.openEditView(m,"Request",c,null,"openAddView")}})}getPayPeriod(e){var i=this.getSelectDate();return e&&(i=e),this.pay_period_map&&this.pay_period_map[i]&&this.pay_period_map[i]!=V.zero_id&&V.isUUID(this.pay_period_map[i])==!0?this.pay_period_map[i]:null}onNavigationClick(e){if(this.checkTimesheetData()){var i;switch(e){case"in_out":IndexViewController.openEditView(LocalCacheData.current_open_primary_controller,"InOut");break;case"edit_employee":IndexViewController.openEditView(this,"Employee",this.getSelectEmployee());break;case"edit_pay_period":var t=this.getPayPeriod();t&&IndexViewController.openEditView(this,"PayPeriods",t);break;case"schedule":var a={filter_data:{}},s={value:[this.getSelectEmployee()]};a.filter_data.include_user_ids=s,a.select_date=this.getSelectDate(),d.addViewTab(this.viewId,l.i18n._("TimeSheet"),window.location.href),IndexViewController.goToView("Schedule",a);break;case"pay_stub":a={filter_data:{}};var r={value:[this.getSelectEmployee()]};a.filter_data.user_id=r,d.addViewTab(this.viewId,l.i18n._("TimeSheet"),window.location.href),IndexViewController.goToView("PayStub",a);break;case"print_summary":a={time_period:{}},a.time_period.time_period="custom_pay_period",a.time_period.pay_period_id=this.timesheet_verify_data.pay_period_id,a.include_user_id=[this.getSelectEmployee()],i={0:a,1:"pdf_timesheet"},this.doFormIFrameCall(i);break;case"print_detailed":a={time_period:{}},a.time_period.time_period="custom_pay_period",a.time_period.pay_period_id=this.timesheet_verify_data.pay_period_id,a.include_user_id=[this.getSelectEmployee()],i={0:a,1:"pdf_timesheet_detail"},this.doFormIFrameCall(i);break}}}doFormIFrameCall(e){d.APIFileDownload("APITimesheetDetailReport","getTimesheetDetailReport",e)}onAccumulatedTimeClick(){if(PermissionManager.checkTopLevelPermission("AccumulatedTime")){var e=d.strToDate(this.getSelectDate()).format("YYYY-MM-DD");IndexViewController.openEditView(this,"UserDateTotalParent",e)}}onMapClick(){if(d.getProductEdition()>=15){var e={filter_columns:{id:!0,latitude:!0,longitude:!0,punch_date:!0,punch_time:!0,position_accuracy:!0,user_id:!0}},i=[],t={};if(this.edit_view)i.push(this.current_edit_record),this.is_viewing||(t.single_marker_draggable=!0);else if(this.select_punches_array&&this.select_punches_array.length>0){var a=[];this.select_punches_array.map(function(s){s.id&&a.push(s.id)}),e.filter_data=d.convertLayoutFilterToAPIFilter(this.select_layout),e.filter_data&&a.length>0&&(e.filter_data.id=a),e.filter_columns.first_name=!0,e.filter_columns.last_name=!0,e.filter_columns.user_id=!0,e.filter_columns.date_stamp=!0,e.filter_columns.punch_date=!0,e.filter_columns.punch_time=!0,e.filter_columns.time_stamp=!0,e.filter_columns.status=!0,e.filter_columns.punch_control_id=!0,e.filter_columns.branch=!0,e.filter_columns.branch_id=!0,e.filter_columns.department=!0,e.filter_columns.department_id=!0,e.filter_columns.job_manual_id=!0,e.filter_columns.job=!0,e.filter_columns.job_id=!0,e.filter_columns.job_item_manual_id=!0,e.filter_columns.job_item=!0,e.filter_columns.job_item_id=!0,e.filter_columns.punch_tag=!0,e.filter_columns.punch_tag_id=!0,e.filter_columns.total_time=!0,e.filter_columns.latitude=!0,e.filter_columns.longitude=!0,e.filter_columns.position_accuracy=!0,i=this.api.getPunch(e,{async:!1}).getResult()}d.isArray(i)?ue(()=>import("./leaflet-timetrex-D9Z7_Af6.bundle.js"),__vite__mapDeps([0,1]),import.meta.url).then(s=>{var r=s.TTConvertMapData.processPunchesFromViewController(i,t);IndexViewController.openEditView(this,"Map",r)}).catch(d.importErrorHandler):(Debug.Text("ERROR: Either punches is not an array, or data is empty","TimeSheetViewController.js","TimeSheetViewController","onMapClick",1),TAlertManager.showAlert(l.i18n._("Selected punches no longer exist, unable to map.")))}}onWizardClick(e){var i=this;switch(e){case"re_calculate_timesheet":var t={};t.user_id=this.getSelectEmployee();var a=this.getPayPeriod();a&&(t.pay_period_id=a),IndexViewController.openWizard("ReCalculateTimeSheetWizard",t,function(){i.onReCalTimeSheetDone()});break;case"generate_pay_stub":t={},t.user_id=this.getSelectEmployee(),a=this.getPayPeriod(),a?t.pay_period_id=[a]:t.pay_period_id=[],IndexViewController.openWizard("GeneratePayStubWizard",t,function(){i.search()});break}}onReCalTimeSheetDone(){MenuManager.isCurrentView("TimeSheet")&&MenuManager.goToView("TimeSheet",!0)}setMoveOrDropMode(e){var i=ContextMenuManager.getMenuModelByMenuId(this.determineContextMenuMountAttributes().id),t=i.find(o=>o.id==="drag_copy"),a=i.find(o=>o.id==="move");if(!(t===void 0||a===void 0)){ContextMenuManager.activateMenuItem(this.determineContextMenuMountAttributes().id,t.id,!0),ContextMenuManager.activateMenuItem(this.determineContextMenuMountAttributes().id,a.id,!0);var s=!1,r=!1;if(this.copyPermissionValidate()||(s=!0),this.movePermissionValidate()||(r=!0),r&&e==="move")ContextMenuManager.activateMenuItem(this.determineContextMenuMountAttributes().id,t.id,!1);else{var n=i.find(o=>o.id===e);ContextMenuManager.activateMenuItem(this.determineContextMenuMountAttributes().id,n.id,!1)}s&&r?this.select_drag_menu_id=null:this.select_drag_menu_id=e}}getSelectDateArray(){for(var e=[],i=this.absence_model?this.absence_select_cells_Array:this.select_cells_Array,t=i.length,a={},s=0;s<t;s++){var r=i[s];a[r.date]=!0}for(var n in a)e.push(n);return e.length===0&&(e=[this.getSelectDate()]),e}onAddClick(e){TTPromise.add("TimeSheetViewController","addclick"),TTPromise.wait();var i=this;this.setCurrentEditViewState("new"),this.is_mass_adding=!0;var t=null,a=null,s=this.getSelectDate(),r=10,n=10,o;if(this.absence_model)e&&(s=this.current_edit_record.date_stamp),i.setDefaultMenu(),i.openEditView(),this.api_user_date_total["get"+this.api_user_date_total.key_name+"DefaultData"](this.getSelectEmployee(),s,{onResult:function(b){var v=b.getResult();d.isSet(v.time_stamp)||(v.time_stamp=!1),d.isSet(i.absence_select_cells_Array[0])&&(v.src_object_id=i.absence_select_cells_Array[0].src_object_id),v.object_type_id=50,v.date_stamp=i.getSelectDate(),i.current_edit_record=v,i.initEditView()}});else{if(this.select_cells_Array.length===1){var _=this.select_cells_Array[0];if(_.related_punch)_.related_punch,t=_.related_punch.punch_control_id,a=_.related_punch.id;else{var u=d.strToDate(_.date?_.date:this.start_date_picker.getValue()).format(this.full_format);if(_&&_.punch&&_.punch.punch_control_id&&(t=_.punch.punch_control_id),this.timesheet_data_source&&this.timesheet_data_source[_.row_id-2])var m=this.timesheet_data_source[_.row_id-2][u+"_data"];m&&(a=m.id)}}if(this.setDefaultMenu(),i.openEditView(),e&&(s=this.current_edit_record.punch_date,this.current_edit_record.status_id==10?t=this.current_edit_record.punch_control_id:t=null),this.select_cells_Array.length===1){o=this.select_cells_Array[0],r=o.status_id;var h=d.strToDate(this.start_date_picker.getValue()),c=new Date(new Date(h.getTime()).setDate(h.getDate()-1));if(c.getTime()<this.start_date.getTime())n=10;else{var g=this.timesheet_data_source[o.row_id-1],p=g&&g[c.format(this.full_format)+"_data"];p?n=p.type_id:n=10}}else o=this.select_cells_Array[0],o&&o.status_id?r=o.status_id:r=10;this.api["get"+this.api.key_name+"DefaultData"](this.getSelectEmployee(),s,t,a,r,n,{onResult:function(b){var v=b.getResult();d.isSet(v.time_stamp)||(v.time_stamp=!1),v.punch_date=i.getSelectDate(),e&&(v.punch_date=i.current_edit_record.punch_date,i.current_edit_record.status_id==10?v.status_id=20:v.status_id=10),i.current_edit_record=v,i.initEditView()}})}}removeEditView(){super.removeEditView(),this.absence_select_cells_Array.length>0?this.absence_model=!0:this.absence_model=!1,this.setDefaultMenu()}isMassDate(){return!!(this.is_mass_adding&&this.current_edit_record&&this.current_edit_record.punch_dates&&this.current_edit_record.punch_dates.length>1)}setEditMenuSaveAndContinueIcon(e){this.saveAndContinueValidate(e,this.getPunchPermissionType()),(this.is_mass_editing||this.is_viewing||this.isMassDate())&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}onSaveAndNewClick(e){var i=this;d.isSet(e)||(e=!1);var t=this.getCurrentAPI();LocalCacheData.current_doing_context_action="new";var a=this.current_edit_record;if(this.is_mass_adding){a=[];var s=this.current_edit_record.punch_dates;s&&s.indexOf(" - ")>0&&(s=this.parserDatesRange(s));for(var r=0;r<s.length;r++){var n=d.clone(this.current_edit_record);delete n.punch_dates,this.absence_model?n.date_stamp=s[r]:n.punch_date=s[r],a.push(n)}}t.setIsIdempotent(!0),t["set"+t.key_name](a,!1,e,{onResult:function(o){o&&o.isValid()?(i.search(!1),i.onAddClick(!0)):(i.setErrorMenu(),i.setErrorTips(o))}})}_continueDoCopyAsNew(){if(LocalCacheData.current_doing_context_action="copy_as_new",this.is_mass_adding=!0,d.isSet(this.edit_view)){this.current_edit_record.id="",this.absence_model||(this.current_edit_record.punch_control_id="",this.current_edit_record.status_id==10?this.current_edit_record.status_id=20:this.current_edit_record.status_id=10,this.edit_view_ui_dic.status_id.setValue(this.current_edit_record.status_id));var e=this.edit_view.find(".navigation-div");e.css("display","none"),this.openEditView(),this.initEditView(),this.setEditMenu(),this.setTabStatus(),this.is_changed=!1,ProgressBar.closeOverlay()}}onSaveAndCopy(e){var i=this;d.isSet(e)||(e=!1);var t=this.getCurrentAPI();this.is_changed=!1,LocalCacheData.current_doing_context_action="save_and_copy";var a=this.current_edit_record;if(this.is_mass_adding){a=[];var s=this.current_edit_record.punch_dates;s&&s.indexOf(" - ")>0&&(s=this.parserDatesRange(s));for(var r=0;r<s.length;r++){var n=d.clone(this.current_edit_record);delete n.punch_dates,this.absence_model?n.date_stamp=s[r]:n.punch_date=s[r],a.push(n)}}this.clearNavigationData(),t.setIsIdempotent(!0),t["set"+t.key_name](a,!1,e,{onResult:function(o){o&&o.isValid()?(o.getResult(),i.search(!1),i.onCopyAsNewClick()):(i.setErrorMenu(),i.setErrorTips(o))}})}getCurrentAPI(){var e=this.api;return this.absence_model&&(e=this.api_user_date_total),e}generateManualTimeSheetRecordKey(e){var i=e.date_stamp+"-"+(this.show_branch_ui&&e.branch_id?e.branch_id:V.zero_id)+"-"+(this.show_department_ui&&e.department_id?e.department_id:V.zero_id)+"-"+(this.show_job_ui&&e.job_id&&d.getProductEdition()>=20?e.job_id:V.zero_id)+"-"+(this.show_job_item_ui&&e.job_item_id&&d.getProductEdition()>=20?e.job_item_id:V.zero_id)+"-"+(this.show_punch_tag_ui&&e.punch_tag_id&&e.punch_tag_id.length>0&&d.getProductEdition()>=20?e.punch_tag_id:V.zero_id)+"-"+e.total_time;return i}createCurrentManualGridRecordsMap(e){this.manual_grid_records_map={};for(var i=0,t=e.length;i<t;i++){var a=e[i],s=this.generateManualTimeSheetRecordKey(a);a.id&&(s=a.id+"-"+s),this.manual_grid_records_map[s]=a.row,delete a.row}}filterManualGridRecords(e){for(var i=Array(),t=0;t<e.length;t++){var a=e[t];(a.id||!a.id&&a.hasOwnProperty("total_time")&&(a.total_time!=0||a.note))&&i.push(a)}return i}onSaveClick(e){var i=this,t;if(this.getPunchMode()==="manual"&&!this.edit_view){var a=this.editor.getValue(!0);a.length>0&&(this.wait_auto_save&&clearTimeout(this.wait_auto_save),this.createCurrentManualGridRecordsMap(a),ProgressBar.noProgressForNextCall(),this.is_saving_manual_grid=!0,this.setDefaultMenu(),a=this.filterManualGridRecords(a),a.length>0?this.api_user_date_total["set"+this.api_user_date_total.key_name](a,{onResult:function(h){h.isValid()||TAlertManager.showErrorAlert(h),i.updateManualGrid()}}):i.updateManualGrid(),ProgressBar.showNanobar()),ProgressBar.closeOverlay();return}d.isSet(e)||(e=!1),LocalCacheData.current_doing_context_action="save";var s=this.getCurrentAPI();if(this.is_mass_editing){var r={};for(var n in this.edit_view_ui_dic){var o=this.edit_view_ui_dic[n];d.isSet(o.isChecked)&&o.isChecked()&&(r[n]=this.current_edit_record[n])}t=[],l.each(this.mass_edit_record_ids,function(h,c){var g=d.clone(r);g.id=c,t.push(g)})}else t=this.current_edit_record;if(this.is_mass_adding&&this.current_edit_record){t=[];var _=this.current_edit_record.punch_dates;_&&_.indexOf(" - ")>0&&(_=this.parserDatesRange(_));for(var u=0;u<_.length;u++){var m=d.clone(this.current_edit_record);delete m.punch_dates,this.absence_model?m.date_stamp=_[u]:m.punch_date=_[u],t.push(m)}}s.setIsIdempotent(!0),s["set"+s.key_name](t,!1,e,{onResult:function(h){h&&h.isValid()?(i.first_build=!0,i.search(),i.removeEditView(),i.previous_absence_policy_id=!1):(i.setErrorMenu(),i.setErrorTips(h))}})}onMapSaveClick(e,i){this.savePunchPosition(e,i)}savePunchPosition(e,i){return!e||e.length!==1?(Debug.Text("ERROR: Invalid params/data passed to function.","TimesheetViewConroller.js","TimesheetViewConroller","savePunchPosition",1),!1):(this.is_mass_editing==!0&&(this.location_mass_edit_check_box.find(".mass-edit-checkbox")[0].checked=!0),this.setLocationValue(e[0]),i(),this.is_changed=!0,!0)}getOtherFieldTypeId(){var e=15;return this.absence_model&&(e=0),e}setEditViewData(){var e=this,i=this.edit_view.find(".navigation-div"),t=i.find(".navigation-widget-div");this.is_changed=!1,d.isSet(this.current_edit_record.id)&&this.current_edit_record.id?(i.css("display","block"),this.navigation=d.loadWidgetByName(FormItemType.AWESOME_BOX),this.absence_model?(this.navigation.AComboBox({id:this.script_name+"_navigation",layout_name:"global_absence"}),this.absence_original_source&&(this.navigation.setSourceData(this.absence_original_source),this.navigation.is_punch_nav=!1)):(this.navigation.AComboBox({id:this.script_name+"_navigation",layout_name:"global_timesheet"}),this.full_timesheet_data&&(this.navigation.setSourceData(this.full_timesheet_data.punch_data),this.navigation.is_punch_nav=!0)),this.navigation.setValue(this.current_edit_record),t.html(this.navigation),this.setNavigation()):i.css("display","none");for(var a in this.edit_view_ui_dic)!d.isSet(e.current_edit_record[a])&&!this.is_mass_editing&&(e.current_edit_record[a]=!1);if(this.is_mass_editing){for(var a in this.edit_view_ui_dic){var s=this.edit_view_ui_dic[a];d.isSet(s.setMassEditMode)&&s.setMassEditMode(!0)}l.each(this.unique_columns,function(r,n){d.isSet(e.edit_view_ui_dic[n])&&d.isSet(e.edit_view_ui_dic[n].setEnabled)&&e.edit_view_ui_dic[n].setEnabled(!1)})}this.setNavigationArrowsEnabled(),this.setCurrentEditRecordData(),this.edit_view.find(".save-and-continue-div").SaveAndContinueBox({related_view_controller:this}),this.edit_view.find(".save-and-continue-div").css("display","none"),this.initTabData(),this.switchToProperTab()}setCurrentEditRecordData(){var e=this,i=this.edit_view.find("a[ref=tab_punch]");i&&(this.absence_model?i.text(l.i18n._("Absence")):i.text(l.i18n._("Punch"))),this.current_edit_record.user_id=this.getSelectEmployee();for(var t in this.current_edit_record)if(this.current_edit_record.hasOwnProperty(t)){var a=this.edit_view_ui_dic[t],s;if(d.isSet(a))switch(t){case"punch_dates":var r;this.current_edit_record.punch_dates?r=this.current_edit_record.punch_dates:(r=this.getSelectDateArray(),this.current_edit_record.punch_dates=r),a.setValue(r);break;case"first_last_name":var n=this.getSelectEmployee(!0);n&&a.setValue(n.first_name+" "+n.last_name);break;case"total_time":if(this.absence_model){var o=d.getTimeUnit(this.current_edit_record[t]);a.setValue(o)}break;case"station_id":this.current_edit_record[t]?this.setStation():(a.setValue("N/A"),a.css("cursor","default"));break;case"punch_image":this.edit_view_form_item_dic.station_id,this.current_edit_record.has_image?(this.attachElement("punch_image"),a.setValue(ServiceCaller.getURLByObjectType("file_download")+"&object_type=punch_image&parent_id="+this.current_edit_record.user_id+"&object_id="+this.current_edit_record.id)):this.detachElement("punch_image");break;case"job_id":d.getProductEdition()>=20&&(s={},s.filter_data={status_id:10,user_id:this.current_edit_record.user_id,punch_branch_id:this.current_edit_record.branch_id,punch_department_id:this.current_edit_record.department_id},a.setDefaultArgs(s),a.setValue(this.current_edit_record[t]));break;case"job_item_id":d.getProductEdition()>=20&&(s={},s.filter_data={status_id:10,job_id:this.current_edit_record.job_id},a.setDefaultArgs(s),a.setValue(this.current_edit_record[t]));break;case"punch_tag_id":if(d.getProductEdition()>=20){a.setValue(this.current_edit_record[t]),this.previous_punch_tag_selection=this.current_edit_record[t];var _=a;TTPromise.wait(null,null,function(){var m={};m.filter_data=e.getPunchTagFilterData(),_.setDefaultArgs(m)})}break;case"branch_id":if(d.getProductEdition()>=20){var s={};s.filter_data={user_id:this.current_edit_record.user_id},a.setDefaultArgs(s)}a.setValue(this.current_edit_record[t]);break;case"department_id":if(d.getProductEdition()>=20){var s={};s.filter_data={user_id:this.current_edit_record.user_id,branch_id:this.current_edit_record.branch_id},a.setDefaultArgs(s)}a.setValue(this.current_edit_record[t]);break;case"job_quick_search":break;case"job_item_quick_search":break;case"punch_tag_quick_search":break;case"latitude":case"longitude":case"position_accuracy":break;default:a.setValue(this.current_edit_record[t]);break}}this.absence_model?this.current_edit_record.id?this.pre_total_time=this.current_edit_record.total_time:this.pre_total_time=0:this.pre_total_time=0;var u;this.current_edit_record.id&&(this.current_edit_record.actual_time_stamp?u=l.i18n._("Actual Time")+": "+this.current_edit_record.actual_time_stamp:u="N/A"),this.setLocationValue(this.current_edit_record),this.actual_time_label.text(u),this.onAvailableBalanceChange(),this.setEditMenu(),this.setEditViewDataDone()}setEditViewDataDone(){super.setEditViewDataDone(),this.is_viewing==!0&&(this.current_edit_record.latitude==0||this.current_edit_record.longitude==0)?l(".widget-h-box-mapLocationWrapper").parents(".edit-view-form-item-div").hide():this.show_location_ui&&l(".widget-h-box-mapLocationWrapper").parents(".edit-view-form-item-div").show()}setLocationValue(e){d.getProductEdition()>=15&&this.edit_view_ui_dic.latitude&&this.edit_view_ui_dic.longitude&&this.edit_view_ui_dic.position_accuracy&&(e&&(this.current_edit_record.latitude=e.latitude,this.current_edit_record.longitude=e.longitude,this.current_edit_record.position_accuracy=e.position_accuracy),this.edit_view_ui_dic.latitude.setValue(this.current_edit_record.latitude),this.edit_view_ui_dic.longitude.setValue(this.current_edit_record.longitude),this.edit_view_ui_dic.position_accuracy.setValue(this.current_edit_record.position_accuracy?this.current_edit_record.position_accuracy:0),!this.current_edit_record.latitude&&!this.is_mass_editing?this.location_wrapper.hide():this.show_location_ui&&this.location_wrapper.show())}onAvailableBalanceChange(){this.current_edit_record.hasOwnProperty("src_object_id")&&this.current_edit_record.src_object_id&&!this.is_mass_editing?this.getAvailableBalance(!1):this.detachElement("available_balance"),this.editFieldResize()}getAvailableBalance(e){if(d.isSet(this.current_edit_record)!=!1){var i=this;if(this.previous_absence_policy_id==!1&&(this.previous_absence_policy_id=this.current_edit_record.src_object_id),this.absence_model){var t=this.current_edit_record.date_stamp,a=this.current_edit_record.total_time;this.is_mass_adding&&(t=this.current_edit_record.punch_dates,l.type(t)==="string"&&t.indexOf(" - ")>0&&(t=this.parserDatesRange(t)),l.type(t)==="array"&&t.length>0&&(a=a*t.length,t=t[t.length-1])),this.api_absence_policy.getProjectedAbsencePolicyBalance(this.current_edit_record.src_object_id,this.getSelectEmployee(),t,a,this.pre_total_time,this.previous_absence_policy_id,{onResult:function(s){if(e)i.releaseBalance(s.getResult().available_balance);else if(i.getBalanceHandler(s,t),i.is_viewing==!0)l("#release-balance-button").css("display","none");else if(d.isObject(s)){var r=s.getResult();r?l("#release-balance-button").css("display",""):l("#release-balance-button").css("display","none")}else l("#release-balance-button").css("display","none")}})}}}setStation(){var e=this,i={filter_data:{id:this.current_edit_record.station_id}};this.api_station.getStation(i,{onResult:function(t){e.station=t.getResult()[0];var a=e.edit_view_ui_dic.station_id;if(e.station)a&&a.setValue(e.station.type+"-"+e.station.description);else{a&&a.setValue("N/A");return}PermissionManager.validate("station","view")||PermissionManager.validate("station","view_child")&&e.station.is_child||PermissionManager.validate("station","view_own")&&e.station.is_owner?e.show_station_ui=!0:e.show_station_ui=!1,e.show_station_ui&&a&&a.css("cursor","pointer")}})}getSelectedItems(){return this.edit_view?[this.current_edit_record]:this.select_punches_array.length>0?this.select_punches_array:[]}getSelectedItem(){var e=null;return this.edit_view?e=this.current_edit_record:this.select_punches_array.length>0?e=this.select_punches_array[0]:e=null,d.clone(e)}addPermissionValidate(e){return d.isSet(e)||(e=this.permission_id),!!(e==="report"||PermissionManager.validate(e,"add")&&this.editPermissionValidate(e))}setDefaultMenu(e){super.setDefaultMenu(e,this.select_punches_array.length),this.setMoveOrDropMode(this.select_drag_menu_id?this.select_drag_menu_id:"move")}setCustomDefaultMenuIcon(e,i,t){switch(e){case"add_punch":this.setDefaultMenuAddPunchIcon(i,t),this.getPunchPermissionType()==="punch"&&ContextMenuManager.activateSplitButtonItem(this.determineContextMenuMountAttributes().id,i.id);break;case"add_absence":this.setDefaultMenuAddAbsenceIcon(i,t),this.getPunchPermissionType()==="absence"&&ContextMenuManager.activateSplitButtonItem(this.determineContextMenuMountAttributes().id,i.id);break;case"in_out":this.setDefaultMenuInOutIcon(i,t);break;case"move":this.movePermissionValidate(this.getPunchPermissionType())||ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,i.id,!1),this.getPunchMode()=="manual"?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,i.id,!1):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,i.id,!0);break;case"edit_pay_period":this.setDefaultMenuEditPayPeriodIcon(i,t);break;case"print":this.setDefaultMenuPrintIcon(i,t);break;case"edit_employee":this.setDefaultMenuEditEmployeeIcon(i,t);break;case"pay_stub":this.setDefaultMenuPayStubIcon(i,t);break;case"re_calculate_timesheet":this.setDefaultMenuReCalculateTimesheet(i,t);break;case"generate_pay_stub":this.setDefaultMenuGeneratePayStubIcon(i,t);break;case"schedule":this.setDefaultMenuScheduleIcon(i,t);break;case"accumulated_time":this.setDefaultMenuAccumulatedTimeIcon(i);break;case"AddRequest":this.setAddRequestIcon(i);break}}setEditMenuDragCopyIcon(e,i){(!this.copyPermissionValidate(this.getPunchPermissionType())||this.edit_only_mode)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),this.getPunchMode()=="manual"?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0)}setDefaultMenuDragCopyIcon(e,i){(!this.copyPermissionValidate(this.getPunchPermissionType())||this.edit_only_mode)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),this.getPunchMode()=="manual"?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0)}setDefaultMenuScheduleIcon(e,i){(!PermissionManager.checkTopLevelPermission("Schedule")||this.edit_only_mode)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}reCalculateEditPermissionValidate(){var e=this.permission_id;if(PermissionManager.validate(e,"edit")||this.ownerOrChildPermissionValidate(e,"edit_child"))return!0}setDefaultMenuReCalculateTimesheet(e,i){this.reCalculateEditPermissionValidate()||ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuGeneratePayStubIcon(e,i){PermissionManager.checkTopLevelPermission("GeneratePayStubs")||ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuPayStubIcon(e,i){PermissionManager.checkTopLevelPermission("PayStub")||ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuEditPayPeriodIcon(e,i){this.editPermissionValidate("pay_period_schedule")||ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1);var t=this;ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),t.getPayPeriod()&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0)}setDefaultMenuAccumulatedTimeIcon(e){(!PermissionManager.checkTopLevelPermission("AccumulatedTime")||this.edit_only_mode)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuEditEmployeeIcon(e,i){this.editChildPermissionValidate("user")||ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuInOutIcon(e){this.addPermissionValidate("punch")?(ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)):(ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0),ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0))}setEditMenuInOutIcon(e){ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}editOwnerOrChildPermissionValidate(e,i){return e||(e=this.permission_id),i||(i=this.getSelectEmployee(!0)),!!(e==="report"||PermissionManager.validate(e,"edit")||i&&i.is_owner&&PermissionManager.validate(e,"edit_own")||i&&i.is_child&&PermissionManager.validate(e,"edit_child"))}viewOwnerOrChildPermissionValidate(e,i){return e||(e=this.permission_id),!!(e==="report"||(i||(i=this.getSelectEmployee(!0)),PermissionManager.validate(e,"view")||i&&i.is_owner&&PermissionManager.validate(e,"view_own")||i&&i.is_child&&PermissionManager.validate(e,"view_child")))}deleteOwnerOrChildPermissionValidate(e,i){return e||(e=this.permission_id),i||(i=this.getSelectEmployee(!0)),!!(e==="report"||PermissionManager.validate(e,"delete")||i&&i.is_owner&&PermissionManager.validate(e,"delete_own")||i&&i.is_child&&PermissionManager.validate(e,"delete_child"))}editChildPermissionValidate(e,i){return d.isSet(e)||(e=this.permission_id),d.isSet(i)||(i=this.getSelectEmployee(!0)),e==="report"?!0:PermissionManager.validate(e,"enabled")?!!(PermissionManager.validate(e,"edit")||this.ownerOrChildPermissionValidate(e,"edit_child",i)):!1}onReportMenuClick(e){this.onNavigationClick(e)}setDefaultMenuPrintIcon(e,i){ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0)}setEditMenuMapIcon(e){super.setDefaultMenuMapIcon(e),e.disabled==!0&&(this.absence_model||this.getPunchMode()=="manual")&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setEditMenuSaveAndAddIcon(e){this.saveAndNewValidate(e,this.getPunchPermissionType()),(this.is_viewing||this.is_mass_editing)&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuMapIcon(e,i){super.setDefaultMenuMapIcon(e),e.disabled==!0&&(this.absence_model||this.getPunchMode()=="manual")&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setEditMenuSaveAndNextIcon(e){(!this.editPermissionValidate(this.getPunchPermissionType())||this.edit_only_mode)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),(!this.current_edit_record||!this.current_edit_record.id||this.is_viewing||this.is_mass_adding)&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setEditMenuSaveAndCopyIcon(e){this.saveAndNewValidate(e,this.getPunchPermissionType()),(this.is_viewing||this.is_mass_editing)&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setEditMenuCopyAndAddIcon(e){this.addPermissionValidate(this.getPunchPermissionType())||ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),(!this.current_edit_record||!this.current_edit_record.id||this.is_viewing||this.is_mass_adding)&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setCustomEditMenuIcon(e,i){switch(e){case"add":case"add_punch":this.setEditMenuAddIcon(i),this.getPunchPermissionType()==="punch"&&ContextMenuManager.activateSplitButtonItem(this.determineContextMenuMountAttributes().id,i.id);break;case"add_absence":this.setEditMenuAddIcon(i),this.getPunchPermissionType()==="absence"&&ContextMenuManager.activateSplitButtonItem(this.determineContextMenuMountAttributes().id,i.id);break;case"view":this.setEditMenuViewIcon(i);break;case"in_out":this.setEditMenuInOutIcon(i);break;case"drag_copy":this.setEditMenuDragCopyIcon(i);break;case"move":this.movePermissionValidate(this.getPunchPermissionType())||ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,i.id,!1);break;case"accumulated_time":this.setDefaultMenuAccumulatedTimeIcon(i);break;case"export_excel":this.setDefaultMenuExportIcon(i);break;case"edit_employee":this.setDefaultMenuEditEmployeeIcon(i);break;case"edit_pay_period":this.setDefaultMenuEditPayPeriodIcon(i);break;case"re_calculate_timesheet":this.setDefaultMenuReCalculateTimesheet(i);break;case"generate_pay_stub":this.setDefaultMenuGeneratePayStubIcon(i);break;case"AddRequest":this.setAddRequestIcon(i);break}}enableAddRequestButton(){var e=this.select_cells_Array,i=e.length;return i==1}cleanWhenUnloadView(e){Y.unmountComponent(this.vue_control_bar_id),this.manual_note_component_ids.length>0&&this.manual_note_component_ids.forEach(i=>{Y.unmountComponent(i)}),l("#timesheet_view_container").remove(),super.cleanWhenUnloadView(e)}setAddRequestIcon(e,i){(d.getProductEdition()<=10||!this.addPermissionValidate("request")||this.edit_only_mode)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),this.enableAddRequestButton()===!0?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}userValueSet(e){typeof e>"u"&&(this.employee_nav.setValue(LocalCacheData.getLoginUser()),Debug.Text("ERROR: Invalid User ID in URL. Switching to current User ID.","TimesheetViewConroller.js","TimesheetViewConroller","userValueSet",10))}releaseBalance(e){d.parseTimeUnit('"'+d.getTimeUnit(e)+'"')==e?this.edit_view_ui_dic.total_time.setValue(d.getTimeUnit(e)):this.edit_view_ui_dic.total_time.setValue('"'+d.getTimeUnit(e,12)+'"'),this.edit_view_ui_dic.total_time.trigger("change")}mergeJobQueueIntoTimeSheetData(e){if(LocalCacheData.getJobQueuePunchData()&&LocalCacheData.getJobQueuePunchData().user_id===this.getSelectEmployee()&&new Date().getTime()/1e3-LocalCacheData.getJobQueuePunchData().epoch<60*15){let i=!1;for(let t=0;t<e.punch_data.length;t++)e.punch_data[t].actual_time_stamp==LocalCacheData.getJobQueuePunchData().actual_time_stamp&&e.punch_data[t].status_id==LocalCacheData.getJobQueuePunchData().status_id&&e.punch_data[t].type_id==LocalCacheData.getJobQueuePunchData().type_id&&(i=!0);i===!0?LocalCacheData.setJobQueuePunchData(null):e.punch_data.push(LocalCacheData.getJobQueuePunchData())}return e}getTimeSheetWidth(){let e=d.isVerticalScrollBarRequired(l(".timesheet-grid-div")[0])?d.getScrollbarWidth():0;return l(".context-border").width()-e}}P.PUNCH_ROW=1;P.EXCEPTION_ROW=2;P.REQUEST_ROW=3;P.TOTAL_ROW=4;P.REGULAR_ROW=5;P.ABSENCE_ROW=6;P.ACCUMULATED_TIME_ROW=7;P.PREMIUM_ROW=8;P.html_template=`
	<div class="view time-sheet-view" id="timesheet_view_container">
		<div class="clear-both-div"></div>
		<div class="control-bar">
			<div id="vue-timesheet-control-bar"></div>
		</div>
		<div class="clear-both-div"></div>
		<div class="grid-top-border"></div>
		<div class="timesheet-grid-div">
			<div class="timesheet-punch-grid-wrapper">
				<table id="grid" class="timesheet-grid"></table>
			</div>
			<div class="inside-editor-div manual-timesheet-inside-editor-div"></div>
			<table class="accumulated-time-grid sub-grid" id="accumulated_time_grid"></table>
			<table class=" sub-grid" id="branch_grid"></table>
			<table class=" sub-grid" id="department_grid"></table>
			<table class=" sub-grid" id="job_grid"></table>
			<table class=" sub-grid" id="job_item_grid"></table>
			<table class=" sub-grid" id="premium_grid"></table>
			<table class=" sub-grid" id="absence_grid"></table>
			<table class="total_grids_div" id="total_grids_table">
				<tr style="vertical-align:top;">
					<td>
						<div class="accumulated-total-grid-title" style="display: none"><%=accumulated_time%></div>
						<table id="accumulated_total_grid"></table>
					</td>
					<td class="notes_grid_td_container">
						<table id="punch_note_grid" class="float-right"></table>
					</td>
					<td>
						<div class="verification-grid-div">
							<div class="verification-grid-title" style="display: none"><%=timesheet_verification%></div>
							<table id="verification_grid" class="float-right"></table>
							<div class="verification-action-bar">
								<span class="verify-description"></span>
								<button class="verify-button t-button" style="display: none"><%=verify%></button>
							</div>
						</div>
					</td>
				</tr>
			</table>
		</div>
		<div class="bottom-div">
			<div class="grid-bottom-border"></div>
		</div>
	</div>
`;export{P as TimeSheetViewController};
//# sourceMappingURL=TimeSheetViewController-B9QVJiKc.bundle.js.map
