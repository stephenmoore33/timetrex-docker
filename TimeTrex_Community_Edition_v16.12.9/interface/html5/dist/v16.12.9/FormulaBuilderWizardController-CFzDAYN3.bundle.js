import{_ as v,j as s}from"./vendor-tTApdY0Y.bundle.js";class C extends BaseWizardController{constructor(e={}){v.defaults(e,{el:".wizard-bg",formula_selection_pos:0}),super(e)}init(e){this.title=s.i18n._("Formula Builder"),this.steps=1,this.current_step=1,this.render()}render(){super.render(),s(this.el).find(".progress-bar").hide(),this.next_btn.hide(),this.back_btn.hide(),s(this.el).css("max-height",500),this.content_div.css("top",20),this.initCurrentStep()}buildCurrentStepUI(){var e=this;switch(this.content_div.empty(),this.stepsWidgetDic[this.current_step]={},this.current_step){case 1:var r=this.getLabel();r.text(""),this.content_div.append(r);var t=s(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html")),l=t.find(".form-item-label"),a=t.find(".form-item-input-div");t.css("margin-left",0);var d=this.getAComboBox(null,null,"global_option_column","custom_variables",!1);if(l.text(s.i18n._("Custom Variables")),a.append(d),d.setSourceData(this.default_data.variables),d.unbind("mousedown").bind("mousedown",function(){e.formula_selection_pos=i[0].selectionStart}),d.unbind("formItemChange").bind("formItemChange",p),this.content_div.append(t),!this.default_data.do_not_show_functions){t=s(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html")),l=t.find(".form-item-label"),a=t.find(".form-item-input-div"),t.css("margin-left",0);var n=this.getComboBox("formula_function",!0);l.text(s.i18n._("Formula Functions")),a.append(n),n.setSourceData(this.default_data.functions),n.unbind("mousedown").bind("mousedown",function(){e.formula_selection_pos=i[0].selectionStart}),n.unbind("formItemChange").bind("formItemChange",p),this.content_div.append(t)}t=s(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html")),l=t.find(".form-item-label"),a=t.find(".form-item-input-div"),t.css("margin-left",0);var i=this.getTextArea("formula",730);l.text(s.i18n._("Formula")),a.append(i),this.content_div.append(t),this.stepsWidgetDic[this.current_step][d.getField()]=d,this.default_data.do_not_show_functions||(this.stepsWidgetDic[this.current_step][n.getField()]=n),this.stepsWidgetDic[this.current_step][i.getField()]=i,i.focus();break}function p(o,u){var c=u.getValue();if(c!==0){var _=i.getValue(),h=e.formula_selection_pos,g=_.substring(0,h),f=_.substring(h,_.length);i.setValue(g+c+f),i.focus(),i[0].selectionStart=h+c.length,i[0].selectionEnd=h+c.length}}}buildCurrentStepData(){this.stepsDataDic[this.current_step];var e=this.stepsWidgetDic[this.current_step];switch(this.current_step){case 1:e.formula.setValue(this.default_data.formula);break}}onDoneClick(){var e=this;super.onDoneClick(),this.saveCurrentStep();var r=this.default_data.current_edit_record,t=this.stepsDataDic[1].formula,l=this.stepsWidgetDic[1].formula;this.default_data.api.key_name==="CompanyDeduction"?r.company_value1=t:r.formula=t;function a(){s(e.el).remove(),e.call_back(t)}this.default_data.do_not_validate?a():this.default_data.api["validate"+this.default_data.api.key_name](r,{onResult:function(d){if(d&&d.isValid())s(e.el).remove(),e.call_back(t),a();else{var n=d.getDetails();if(!n){a();return}if(Global.isArray(n)||typeof n=="object"){var i=!1;s.each(n,function(p,o){for(var u in o)e.default_data.api.key_name==="CompanyDeduction"?u==="company_value1"&&(l.setErrorStyle(o[u],!0),i=!0):u==="formula"&&(l.setErrorStyle(o[u],!0),i=!0);i||a()})}else a()}}})}saveCurrentStep(){this.stepsDataDic[this.current_step]={};var e=this.stepsDataDic[this.current_step],r=this.stepsWidgetDic[this.current_step];switch(this.current_step){default:for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t].getValue());break}}setDefaultDataToSteps(){if(!this.default_data)return null}}export{C as FormulaBuilderWizardController};
//# sourceMappingURL=FormulaBuilderWizardController-CFzDAYN3.bundle.js.map
