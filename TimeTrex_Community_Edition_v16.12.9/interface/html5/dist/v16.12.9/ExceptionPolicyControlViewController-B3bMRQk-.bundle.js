import{_ as s,j as r}from"./vendor-tTApdY0Y.bundle.js";class v extends BaseViewController{constructor(i={}){s.defaults(i,{el:"#exception_policy_control_view_container",severity_array:null,email_notification_array:null,punch_notification_array:null,original_exception_data:[],editor:null,api_exception_policy:null,date_api:null}),super(i)}init(i){this.edit_view_tpl="ExceptionPolicyControlEditView.html",this.permission_id="exception_policy",this.viewId="ExceptionPolicyControl",this.script_name="ExceptionPolicyControlView",this.table_name_key="exception_policy_control",this.context_menu_name=r.i18n._("Exception Policy"),this.navigation_label=r.i18n._("Exception Policy"),this.api=TTAPI.APIExceptionPolicyControl,this.api_exception_policy=TTAPI.APIExceptionPolicy,this.date_api=TTAPI.APITTDate,this.render(),this.buildContextMenu(),this.initData()}getCustomContextMenuModel(){var i={exclude:["mass_edit"],include:[]};return i}initOptions(){this.initDropDownOption("severity","severity_id",this.api_exception_policy),this.initDropDownOption("punch_notification","punch_notification_id",this.api_exception_policy),this.initDropDownOption("email_notification","email_notification_id",this.api_exception_policy)}buildEditViewUI(){super.buildEditViewUI();var i={tab_exception_policy:{label:r.i18n._("Exception Policy"),html_template:this.getExceptionPolicyTabHtml()},tab_audit:!0};this.setTabModel(i),this.navigation.AComboBox({api_class:TTAPI.APIExceptionPolicyControl,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_hierarchy",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation();var n=this.edit_view_tab.find("#tab_exception_policy"),t=n.find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(t);var a=Global.loadWidgetByName(FormItemType.TEXT_INPUT);a.TTextInput({field:"name",width:"100%"}),this.addEditFieldToColumn(r.i18n._("Name"),a,t,"first_last"),a.parent().width("45%"),a=Global.loadWidgetByName(FormItemType.TEXT_AREA),a.TTextArea({field:"description",width:"100%"}),this.addEditFieldToColumn(r.i18n._("Description"),a,t,"",null,null,!0),a.parent().width("45%");var o=n.find(".inside-editor-div"),e={active:r.i18n._("Active"),code:r.i18n._("Code"),name:r.i18n._("Name"),severity:r.i18n._("Severity"),grace:r.i18n._("Grace"),watch_window:r.i18n._("Watch Window"),demerit:r.i18n._("Demerit Points"),punch_notification:r.i18n._("Punch Notice"),email_notification:r.i18n._("Notify")};this.editor=Global.loadWidgetByName(FormItemType.INSIDE_EDITOR),this.editor.InsideEditor({title:"",addRow:this.insideEditorAddRow,getValue:this.insideEditorGetValue,setValue:this.insideEditorSetValue,updateAllRows:this.insideEditorUpdateAllRows,parent_controller:this,render:d(),render_args:e,render_inline_html:!0,row_render:l()});function d(){return`
			<table class="inside-editor-render">
				<tr class="title">
					<td style="width: 50px"><%= active %></td>
					<td style="width: 50px"><%= code %></td>
					<td style="width: 250px"><%= name %></td>
					<td style="width: 90px"><%= severity %></td>
					<td style="width: 90px"><%= grace %></td>
					<td style="width: 140px"><%= watch_window %></td>
					<td style="width: 140px"><%= demerit %></td>
					<td style="width: 140px"><%= punch_notification %></td>
					<td style="width: 140px"><%= email_notification %></td>
				</tr>
			</table>`}function l(){return`
			<tr class="inside-editor-row data-row">
				<td class="level cell"></td>
				<td class="code cell"></td>
				<td class="name cell"></td>
				<td class="severity cell"></td>
				<td class="grace cell"></td>
				<td class="watch-window cell"></td>
				<td class="demerit cell"></td>
				<td class="punch-notification cell"></td>
				<td class="email-notification cell"></td>
			</tr>`}o.append(this.editor)}_continueDoCopyAsNew(){if(this.setCurrentEditViewState("new"),LocalCacheData.current_doing_context_action="copy_as_new",Global.isSet(this.edit_view))for(var i=0;i<this.editor.rows_widgets_array.length;i++)this.editor.rows_widgets_array[i].current_edit_item.id="";super._continueDoCopyAsNew()}onCopyAsNewResult(i){var n=this,t=i.getResult();if(!t){TAlertManager.showAlert(r.i18n._("Record does not exist")),n.onCancelClick();return}n.openEditView(),t=t[0],this.copied_record_id=t.id,t.id="",n.sub_view_mode&&n.parent_key&&(t[n.parent_key]=n.parent_value),n.current_edit_record=t,n.initEditView()}setEditViewDataDone(){super.setEditViewDataDone(),this.initInsideEditorData()}initInsideEditorData(){var i=this,n={};n.filter_data={};var t=this.current_edit_record.id?this.current_edit_record.id:this.copied_record_id;this.copied_record_id="",t?(n.filter_data.exception_policy_control_id=t,this.api_exception_policy.getExceptionPolicyDefaultData(n,!0,{onResult:function(a){if(i.edit_view){var o=a.getResult(),e=[];for(var d in o)o.hasOwnProperty(d)&&(o[d].id="",e.push(o[d]));e=e.sort(function(_,c){return Global.compare(_,c,"type_id")}),i.original_exception_data=s.map(e,s.clone),i.editor.setValue(e);var l={};l.filter_data={exception_policy_control_id:t},i.api_exception_policy.getExceptionPolicy(l,!0,{onResult:function(_){if(i.edit_view){var c=_.getResult(),p=[];for(var h in c)c.hasOwnProperty(h)&&p.push(c[h]);p=p.sort(function(u,m){return Global.compare(u,m,"type_id")}),i.original_exception_data=s.map(p,s.clone),i.editor.setValue(p)}}})}}})):this.api_exception_policy.getExceptionPolicyDefaultData(n,!0,{onResult:function(a){if(i.edit_view){var o=a.getResult(),e=[];for(var d in o)o.hasOwnProperty(d)&&(o[d].id="",e.push(o[d]));e=e.sort(function(l,_){return Global.compare(l,_,"type_id")}),i.original_exception_data=s.map(e,s.clone),i.editor.setValue(e)}}})}insideEditorUpdateAllRows(i){for(var n=this.rows_widgets_array.length,t=0;t<n;t++)for(var a=this.rows_widgets_array[t],o=a.current_edit_item,e=i.length,d=0;d<e;d++){var l=i[d];if(l.type_id===o.type_id){a.current_edit_item=l,this.parent_controller.current_edit_record.id||(a.current_edit_item.id=""),a.active.setValue(l.active),a.severity_id.setValue(l.severity_id),l.is_enabled_grace&&a.grace.setValue(l.grace),l.is_enabled_watch_window&&a.watch_window.setValue(l.watch_window),a.demerit.setValue(l.demerit),l.is_enabled_punch_notice&&a.punch_notification_id.setValue(l.punch_notification_id),a.email_notification_id.setValue(l.email_notification_id),i.splice(d,1);break}}}insideEditorSetValue(i){var n=i.length;if(n!==0)if(i[0].id)this.updateAllRows(i);else{this.removeAllRows();for(var t=0;t<i.length;t++)if(Global.isSet(i[t])){var a=i[t];this.addRow(a)}}}insideEditorAddRow(i,n){i||(i={});var t=this.getRowRender(),a=this.getRender(),o={},e=Global.loadWidgetByName(FormItemType.CHECKBOX);e.TCheckbox({field:"active"}),e.setValue(i.active),o[e.getField()]=e,t.children().eq(0).append(e),e.attr("exception_policy_id",i.id&&this.parent_controller.current_edit_record.id?i.id:""),this.setWidgetEnableBaseOnParentController(e),e=Global.loadWidgetByName(FormItemType.TEXT),e.TText({field:"type_id"}),e.setValue(i.type_id),o[e.getField()]=e,t.children().eq(1).append(e),e=Global.loadWidgetByName(FormItemType.TEXT),e.TText({field:"name"}),e.setValue(i.name),o[e.getField()]=e,t.children().eq(2).append(e),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"severity_id",set_empty:!1}),this.setWidgetEnableBaseOnParentController(e),e.setSourceData(this.parent_controller.severity_array),e.setValue(i.severity_id),o[e.getField()]=e,t.children().eq(3).append(e),i.is_enabled_grace&&(e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"grace",width:90,need_parser_sec:!0}),e.setValue(i.grace),o[e.getField()]=e,t.children().eq(4).append(e),this.setWidgetEnableBaseOnParentController(e)),i.is_enabled_watch_window&&(e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"watch_window",width:90,need_parser_sec:!0}),e.setValue(i.watch_window),o[e.getField()]=e,t.children().eq(5).append(e),this.setWidgetEnableBaseOnParentController(e)),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"demerit",width:50,need_parser_sec:!1}),e.setValue(i.demerit),o[e.getField()]=e,t.children().eq(6).append(e),this.setWidgetEnableBaseOnParentController(e),i.is_enabled_punch_notice&&(e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"punch_notification_id",set_empty:!1}),e.setSourceData(this.parent_controller.punch_notification_array),e.setValue(i.punch_notification_id),o[e.getField()]=e,t.children().eq(7).append(e),this.setWidgetEnableBaseOnParentController(e)),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"email_notification_id",set_empty:!1}),e.setSourceData(this.parent_controller.email_notification_array),e.setValue(i.email_notification_id),o[e.getField()]=e,t.children().eq(8).append(e),this.setWidgetEnableBaseOnParentController(e),o.current_edit_item=i,typeof n<"u"?(t.insertAfter(r(a).find("tr").eq(n)),this.rows_widgets_array.splice(n,0,o)):(r(a).append(t),this.rows_widgets_array.push(o)),this.parent_controller.is_viewing&&t.find(".control-icon").hide(),this.removeLastRowLine()}insideEditorGetValue(i){for(var n=this.rows_widgets_array.length,t=[],a=0;a<n;a++){var o=this.rows_widgets_array[a],e=o.current_edit_item;e.exception_policy_control_id=i,e.active=o.active.getValue(),e.severity_id=o.severity_id.getValue(),e.is_enabled_grace&&(e.grace=o.grace.getValue()),e.is_enabled_watch_window&&(e.watch_window=o.watch_window.getValue()),e.demerit=o.demerit.getValue(),e.is_enabled_punch_notice&&(e.punch_notification_id=o.punch_notification_id.getValue()),e.email_notification_id=o.email_notification_id.getValue(),t.push(e)}return t}onSaveResult(i){var n=this;if(i&&i.isValid()){var t=i.getResult();t===!0?n.refresh_id=n.current_edit_record.id:TTUUID.isUUID(t)&&t!=TTUUID.zero_id&&t!=TTUUID.not_exist_id&&(n.refresh_id=t),n.saveInsideEditorData(function(){n.search(),n.onSaveDone(i),n.removeEditView()})}else n.setErrorMenu(),n.setErrorTips(i)}onSaveAndCopyResult(i){var n=this;if(i&&i.isValid()){var t=i.getResult();t===!0?n.refresh_id=n.current_edit_record.id:TTUUID.isUUID(t)&&t!=TTUUID.zero_id&&t!=TTUUID.not_exist_id&&(n.refresh_id=t),n.saveInsideEditorData(function(){n.search(!1),n.onCopyAsNewClick()})}else n.setErrorTips(i),n.setErrorMenu()}saveInsideEditorData(i){var n=this.editor.getValue(this.refresh_id);let t=this.getChangedRecords(n,this.original_exception_data,[]);Array.isArray(t)&&t.length>0?this.api_exception_policy.setExceptionPolicy(t,{onResult:function(a){Global.isSet(i)&&i()}}):Global.isSet(i)&&i()}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:r.i18n._("Name"),in_column:1,field:"name",multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:r.i18n._("Created By"),in_column:2,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:r.i18n._("Updated By"),in_column:2,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX})]}getExceptionPolicyTabHtml(){return`<div id="tab_exception_policy" class="edit-view-tab-outside">
					<div class="edit-view-tab" id="tab_exception_policy_content_div">
						<div class="first-column full-width-column"></div>
						<div class="inside-editor-div full-width-column">
						</div>
					</div>
				</div>`}}export{v as ExceptionPolicyControlViewController};
//# sourceMappingURL=ExceptionPolicyControlViewController-B3bMRQk-.bundle.js.map
