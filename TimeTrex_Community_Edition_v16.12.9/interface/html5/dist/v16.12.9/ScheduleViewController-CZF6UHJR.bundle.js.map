{"version":3,"file":"ScheduleViewController-CZF6UHJR.bundle.js","sources":["../../components/schedule/ScheduleControlBar.vue","../../views/attendance/schedule/ScheduleViewController.js"],"sourcesContent":["<template>\n    <div class=\"tt-horizontal-vue-bar\">\n        <div class=\"bar-column left\"></div>\n        <div class=\"bar-column center\">\n            <div class=\"date-chooser-div\">\n            </div>\n        </div>\n        <div class=\"bar-column right\">\n            <div class=\"bar-column schedule-mode\">\n                <SelectButton v-model=\"schedule_mode_options_selected\" :options=\"schedule_mode_options\" optionLabel=\"label\" optionValue=\"value\" @click=\"this.onScheduleModeChange();\"/>\n            </div>\n            <div class=\"bar-column menu-item\">\n                <TTContextButton :class=\"['no-wrap']\" :items=\"schedule_settings_options\" />\n            </div>\n        </div>\n    </div>\n</template>\n\n<script>\nimport SelectButton from 'primevue/selectbutton';\nimport TTContextButton from '@/components/context_menu/TTContextButton';\n\nexport default {\n    name: \"ScheduleControlBar\",\n    created() {\n        this.event_bus = new TTEventBus( {\n            component_id: this.component_id\n        } );\n        this.event_bus.on( this.component_id, 'getValue', this.getValue, TTEventBusStatics.AUTO_CLEAR_ON_EXIT );\n        this.event_bus.on( this.component_id, 'setValue', this.setValue, TTEventBusStatics.AUTO_CLEAR_ON_EXIT );\n        this.event_bus.on( this.component_id, 'setScheduleSettingsState', this.setScheduleSettingsState, TTEventBusStatics.AUTO_CLEAR_ON_EXIT );\n        this.event_bus.on( this.component_id, 'setSettingActive', this.setSettingActive, TTEventBusStatics.AUTO_CLEAR_ON_EXIT );\n        this.event_bus.on( this.component_id, 'setSettingDeactivated', this.setSettingDeactivated, TTEventBusStatics.AUTO_CLEAR_ON_EXIT );\n    },\n    unmounted() {\n        Debug.Text( 'Vue control bar component unmounted ('+ this.component_id +').', 'ScheduleControlBar.vue', 'ScheduleControlBar', 'unmounted', 2 );\n        this.event_bus.autoClear();\n    },\n    props: { // passed in via root props from TimeSheetViewController\n        view_id: {\n            type: String,\n            default: null\n        },\n        component_id: { /* Note: This is passed in via TTVueUtils.mountComponent param, and auto added to root_props. */\n            type: String,\n            default: null\n        },\n        schedule_mode_options: {\n            type: Array,\n            default: []\n        },\n        schedule_settings_options: {\n            type: Array,\n            default: []\n        },\n    },\n    data() {\n        return {\n            removeEventsOnUnmount: [],\n            schedule_mode_options_selected: 'week',\n        }\n    },\n    // watch: {\n    //     schedule_mode_options_selected: function ( val ) {\n    //         this.event_bus.emit( this.component_id, 'scheduleModeOnChange', {\n    //             key: 'schedule_mode_options_selected',\n    //             value: val\n    //         });\n    //     },\n    // },\n    computed: {\n    },\n    methods: {\n        // getValue( event_data ) {\n        //     // Validate\n        //     if ( event_data.key && ['schedule_mode_options_selected'].includes( event_data.key) ) {\n        //         EventBus.emit( this.vue_control_bar_id +'.getValueReturn', {\n        //             key: event_data.key,\n        //             value: this[ event_data.key ]\n        //         });\n        //         return this[ event_data.key ];\n        //     } else if ( event_data.key && ['all_employee_btn', 'daily_totals_btn', 'weekly_totals_btn', 'strict_range_btn'].includes( event_data.key) ) {\n        //\n        //     } else {\n        //         // invalid\n        //     }\n        // },\n        setValue( event_data ) {\n            var valid_editable_fields = ['schedule_mode_options_selected'];\n            // Validate\n            if( event_data.key && event_data.key && valid_editable_fields.includes( event_data.key) ) {\n                this[ event_data.key ] = event_data.value;\n            } else {\n                // invalid\n                Debug.Error( 'Invalid parameters passed to function.', 'ScheduleControlBar.vue', 'ScheduleControlBar', 'setValue', 1 );\n\n            }\n        },\n        getScheduleSettingsState( item_id ) {\n            var item = this.schedule_settings_options.find( element => element.id === item_id );\n            if( item ) {\n                return item.active;\n            } else {\n                Debug.Error( 'Item not found ('+ item_id +'). Check supplied id.', 'ScheduleControlBar.vue', 'ScheduleControlBar', 'getScheduleSettingsState', 1 );\n                return undefined;\n            }\n        },\n        setScheduleSettingsState( event_data ) {\n            var item = this.schedule_settings_options.find( element => element.id === event_data.item_id );\n            if( item ) {\n                item[ event_data.item_field ] = event_data.item_value;\n            } else {\n                Debug.Error( 'Item not found ('+ event_data.item_id +'). Check supplied id.', 'ScheduleControlBar.vue', 'ScheduleControlBar', 'setScheduleSettingsState', 1 );\n            }\n        },\n        setSettingActive( event_data ) {\n            var item = this.schedule_settings_options.find( element => element.id === event_data.item_id );\n            if( item ) {\n                item.setOnlySelfActive();\n            } else {\n                Debug.Error( 'Item not found ('+ event_data.item_id +'). Check supplied id.', 'ScheduleControlBar.vue', 'ScheduleControlBar', 'setSettingActive', 1 );\n            }\n        },\n        setSettingDeactivated( event_data ) {\n            var item = this.schedule_settings_options.find( element => element.id === event_data.item_id );\n            if( item ) {\n                item.setOnlySelfDeactivated();\n            } else {\n                Debug.Error( 'Item not found ('+ event_data.item_id +'). Check supplied id.', 'ScheduleControlBar.vue', 'ScheduleControlBar', 'setOnlySelfDeactivated', 1 );\n            }\n        },\n        onScheduleModeChange() {\n            this.event_bus.emit( this.component_id, 'scheduleModeOnChange', {\n                key: 'schedule_mode_options_selected',\n                value: this.schedule_mode_options_selected\n            });\n        },\n    },\n    components: {\n        SelectButton: SelectButton,\n        TTContextButton: TTContextButton\n    }\n};\n</script>\n\n<style scoped>\n    .tt-horizontal-vue-bar {\n        display: flex;\n        flex-direction: row;\n        justify-content: space-between;\n        align-items: center;\n        margin-top: 3px;\n    }\n    .bar-column {\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        padding: 0 5px;\n    }\n    .bar-column.left,\n    .bar-column.right {\n        width: 25%;\n    }\n    .bar-column.right {\n        justify-content: flex-end;\n    }\n    ::v-deep(.schedule-mode .p-button) {\n        padding: .55rem .6rem;\n    }\n    ::v-deep(.p-button-label) {\n        font-size: 14px;\n    }\n</style>","import TTVueUtils from '@/services/TTVueUtils';\nimport ScheduleControlBar from '@/components/schedule/ScheduleControlBar';\nimport { Global } from '@/global/Global';\n\nexport class ScheduleViewController extends BaseViewController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tel: '#schedule_view_container', //Must set el here and can only set string, so events can work\n\n\t\t\tuser_group_api: null,\n\n\t\t\tstatus_array: null,\n\n\t\t\tuser_group_array: null,\n\n\t\t\ttoggle_button: null,\n\n\t\t\tstart_date_picker: null,\n\n\t\t\tstart_date: null,\n\n\t\t\tend_date: null,\n\n\t\t\tfull_schedule_data: null,\n\n\t\t\tschedule_columns: null,\n\n\t\t\tfull_format: 'ddd-MMM-DD-YYYY',\n\n\t\t\tweekly_format: 'ddd, MMM DD',\n\n\t\t\tfinal_schedule_data_array: [],\n\n\t\t\thas_date_array: [],\n\n\t\t\tno_date_array: [],\n\n\t\t\tshift_key_name_array: [],\n\n\t\t\tselect_cells_Array: [], //Timesheet grid\n\n\t\t\tselect_all_shifts_array: [], //Timesheet grid.\n\n\t\t\tselect_shifts_array: [], //Timesheet grid.\n\n\t\t\tselect_recurring_shifts_array: [], //Timesheet grid.\n\n\t\t\tall_employee_btn: null,\n\n\t\t\tdaily_totals_btn: null,\n\n\t\t\tweekly_totals_btn: null,\n\n\t\t\tstrict_range_btn: null,\n\n\t\t\tmonth_date_row_array: null,\n\n\t\t\tmonth_date_row_tr_ids: null, // month date tr id in grid table\n\n\t\t\tmonth_date_row_position: null, //month date tr position in table\n\n\t\t\tmonth_current_header_number: 0, //0 is default column header\n\n\t\t\tday_header_width: 0,\n\n\t\t\tday_hour_width: 40,\n\n\t\t\tselect_drag_menu_id: '', //Do drag move or copy\n\n\t\t\tis_override: false,\n\n\t\t\tnotify_user_schedule_change: false,\n\n\t\t\tscroll_position: 0,\n\n\t\t\tselected_user_ids: [],\n\n\t\t\tprev_total_time: 0,\n\n\t\t\tprev_status_id: null,\n\n\t\t\tis_mass_adding: false,\n\n\t\t\tcalculate_cell_number: 0,\n\n\t\t\tscroll_interval: null,\n\n\t\t\tscroll_unit: 0,\n\n\t\t\tholiday_data_dic: {},\n\n\t\t\tabsence_policy_api: null,\n\n\t\t\tjob_api: null,\n\t\t\tjob_item_api: null,\n\t\t\tuser_api: null,\n\t\t\tdepartment_api: null,\n\t\t\tpunch_tag_api: null,\n\t\t\tdefault_punch_tag: [],\n\t\t\tprevious_punch_tag_selection: [],\n\n\t\t\tyear_mode_original_date: null, //set this when search for yer mode with use_date_picker true, so Keep select date in ritict mode\n\t\t\tevents: {},\n\t\t\tvue_control_bar_id: ''\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinit( options ) {\n\t\t//this._super('initialize', options );\n\t\tthis.permission_id = 'schedule';\n\t\tthis.script_name = 'ScheduleView';\n\t\tthis.viewId = 'Schedule';\n\t\tthis.table_name_key = 'schedule';\n\t\tthis.context_menu_name = $.i18n._( 'Schedules' );\n\t\tthis.navigation_label = $.i18n._( 'Schedule' );\n\t\tthis.api = TTAPI.APISchedule;\n\t\tthis.user_group_api = TTAPI.APIUserGroup;\n\t\tthis.absence_policy_api = TTAPI.APIAbsencePolicy;\n\t\tthis.company_api = TTAPI.APICompany;\n\t\tthis.user_api = TTAPI.APIUser;\n\t\tthis.currency_api = TTAPI.APICurrency;\n\t\tthis.event_bus = new TTEventBus({ view_id: this.viewId });\n\n\n\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\tthis.job_api = TTAPI.APIJob;\n\t\t\tthis.job_item_api = TTAPI.APIJobItem;\n\t\t\tthis.punch_tag_api = TTAPI.APIPunchTag;\n\t\t\tthis.department_api = TTAPI.APIDepartment;\n\t\t}\n\n\t\tthis.api_absence_policy = TTAPI.APIAbsencePolicy;\n\n\t\tthis.scroll_position = 0;\n\n\t\tthis.initPermission();\n\t\tthis.render();\n\t\tthis.buildContextMenu();\n\n\t\tthis.initData();\n\t}\n\n\tjobUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = this.permission_id;\n\t\t}\n\n\t\tif ( PermissionManager.validate( 'job', 'enabled' ) &&\n\t\t\tPermissionManager.validate( p_id, 'edit_job' ) &&\n\t\t\t( Global.getProductEdition() >= 20 ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tjobItemUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = this.permission_id;\n\t\t}\n\n\t\tif ( PermissionManager.validate( 'job_item', 'enabled' ) &&\n\t\t\tPermissionManager.validate( p_id, 'edit_job_item' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tpunchTagUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = this.permission_id;\n\t\t}\n\n\t\tif ( PermissionManager.validate( 'punch_tag', 'enabled' ) &&\n\t\t\tPermissionManager.validate( p_id, 'edit_job_item' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tbranchUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = this.permission_id;\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'edit_branch' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tdepartmentUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = this.permission_id;\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'edit_department' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tunscheduledEmployeeUIValidate() {\n\n\t\tif ( PermissionManager.validate( 'schedule', 'view' ) || PermissionManager.validate( 'schedule', 'view_child' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t//Speical permission check for views, need override\n\tinitPermission() {\n\t\tsuper.initPermission();\n\n\t\tthis.show_search_tab = true;\n\t\t//See buildSearchFields() for additional permission checks.\n\t\t// if ( PermissionManager.validate( this.permission_id, 'view' ) || PermissionManager.validate( this.permission_id, 'view_child' ) ) {\n\t\t// \tthis.show_search_tab = true;\n\t\t// } else {\n\t\t// \tthis.show_search_tab = false;\n\t\t// }\n\n\t\tif ( this.jobUIValidate() ) {\n\t\t\tthis.show_job_ui = true;\n\t\t} else {\n\t\t\tthis.show_job_ui = false;\n\t\t}\n\n\t\tif ( this.jobItemUIValidate() ) {\n\t\t\tthis.show_job_item_ui = true;\n\t\t} else {\n\t\t\tthis.show_job_item_ui = false;\n\t\t}\n\n\t\tif ( this.punchTagUIValidate() ) {\n\t\t\tthis.show_punch_tag_ui = true;\n\t\t} else {\n\t\t\tthis.show_punch_tag_ui = false;\n\t\t}\n\n\t\tif ( this.branchUIValidate() ) {\n\t\t\tthis.show_branch_ui = true;\n\t\t} else {\n\t\t\tthis.show_branch_ui = false;\n\t\t}\n\n\t\tif ( this.departmentUIValidate() ) {\n\t\t\tthis.show_department_ui = true;\n\t\t} else {\n\t\t\tthis.show_department_ui = false;\n\t\t}\n\t}\n\n\t//only be call once when open this view\n\tinitData() {\n\t\tvar $this = this;\n\n\t\t//Remove tab if any\n\t\tGlobal.removeViewTab( this.viewId );\n\t\tProgressBar.showOverlay();\n\t\tthis.initOptions();\n\n\t\t//For regular employees who currently can't see the \"Saved Search and Layout\" tab, try to be smarter about what columns they do see by default.\n\t\tthis.default_display_columns = [];\n\t\tif ( PermissionManager.validate( this.permission_id, 'edit_branch' ) ) {\n\t\t\tthis.default_display_columns.push( 'branch' );\n\t\t}\n\t\tif ( PermissionManager.validate( this.permission_id, 'edit_department' ) ) {\n\t\t\tthis.default_display_columns.push( 'department' );\n\t\t}\n\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\tif ( PermissionManager.validate( this.permission_id, 'edit_job' ) ) {\n\t\t\t\tthis.default_display_columns.push( 'job' );\n\t\t\t}\n\t\t\tif ( PermissionManager.validate( this.permission_id, 'edit_job_item' ) ) {\n\t\t\t\tthis.default_display_columns.push( 'job_item' );\n\t\t\t}\n\t\t}\n\n\t\tvar date = new Date();\n\n\t\tif ( Global.UNIT_TEST_MODE == true ) {\n\t\t\tLocalCacheData.last_schedule_selected_date = '15-Feb-18';\n\t\t}\n\n\t\tvar format = Global.getLoginUserDateFormat();\n\t\tvar dateStr = date.format( format );\n\n\t\tif ( !LocalCacheData.last_schedule_selected_date ) {\n\t\t\tif ( LocalCacheData.current_select_date && Global.strToDate( LocalCacheData.current_select_date, 'YYYY-MM-DD' ) ) { //Select date get from URL.\n\t\t\t\tthis.setDatePickerValue( Global.strToDate( LocalCacheData.current_select_date, 'YYYY-MM-DD' ).format() );\n\t\t\t\tLocalCacheData.current_select_date = '';\n\t\t\t} else {\n\t\t\t\tthis.setDatePickerValue( dateStr );\n\t\t\t}\n\t\t} else {\n\t\t\tthis.setDatePickerValue( LocalCacheData.last_schedule_selected_date );\n\t\t}\n\n\t\tthis.setMoveOrDropMode( this.select_drag_menu_id ? this.select_drag_menu_id : 'move' );\n\t\t//Issue #3280 - Race condition where previous search layout will not exist in UI when expected as API for custom field data has not returned yet.\n\t\t//ScheduleViewController overrides initData() from BaseViewController that waits on the custom field promise to resolve before continuing.\n\t\tTTPromise.wait( 'BaseViewController', 'getCustomFields', function() {\n\t\t\t$this.getAllColumns( function() {\n\t\t\t\t$this.initLayout();\n\t\t\t} );\n\t\t} );\n\t}\n\n\tsetToggleButtonValue( val ) {\n\n\t\tif ( this.toggle_button ) {\n\t\t\tthis.toggle_button.setValue( val );\n\n\t\t\tthis.setToggleButtonUrl();\n\t\t}\n\t}\n\n\tsetToggleButtonUrl() {\n\n\t\tvar mode = this.getMode();\n\t\tvar default_date = this.start_date_picker.getDefaultFormatValue();\n\t\tif ( !this.edit_view ) {\n\t\t\tGlobal.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&mode=' + mode );\n\t\t}\n\t}\n\n\tsetDatePickerValue( val ) {\n\n\t\tthis.start_date_picker.setValue( val );\n\n\t\t//this.setDateUrl();\n\n\t\tLocalCacheData.last_schedule_selected_date = val;\n\t}\n\n\tgetAllColumns( callBack ) {\n\n\t\tvar $this = this;\n\t\tthis.api.getOptions( 'columns', {\n\t\t\tonResult: function( columns_result ) {\n\t\t\t\tvar columns_result_data = columns_result.getResult();\n\t\t\t\t$this.all_columns = Global.buildColumnArray( columns_result_data );\n\n\t\t\t\t$this.api.getOptions( 'group_columns', {\n\t\t\t\t\tonResult: function( group_columns_result ) {\n\n\t\t\t\t\t\tvar all_columns = Global.buildColumnArray( columns_result_data );\n\t\t\t\t\t\tvar group_columns_result_data = group_columns_result.getResult();\n\n\t\t\t\t\t\tvar final_all_columns = [];\n\n\t\t\t\t\t\tvar all_len = all_columns.length;\n\t\t\t\t\t\tvar group_len = group_columns_result_data.length;\n\n\t\t\t\t\t\tfor ( var i = 0; i < group_len; i++ ) {\n\t\t\t\t\t\t\tvar group_column_id = group_columns_result_data[i];\n\t\t\t\t\t\t\tfor ( var j = 0; j < all_len; j++ ) {\n\t\t\t\t\t\t\t\tvar column = all_columns[j];\n\t\t\t\t\t\t\t\tif ( column.value === group_column_id ) {\n\t\t\t\t\t\t\t\t\tfinal_all_columns.push( column );\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$this.all_columns = final_all_columns;\n\n\t\t\t\t\t\t$this.column_selector.setUnselectedGridData( $this.all_columns );\n\t\t\t\t\t\tif ( callBack ) {\n\t\t\t\t\t\t\tcallBack();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tinitLayout() {\n\t\tvar $this = this;\n\t\t$this.getAllLayouts( function() {\n\t\t\t$this.setSelectLayout();\n\t\t\t$this.search( true, false ); //Make sure we setDefaultMenu is TRUE so autoOpenEditViewIfNecessary() is called.\n\t\t} );\n\t}\n\n\tinitOptions() {\n\t\tvar $this = this;\n\n\t\tthis.initDropDownOption( 'status', '', this.api );\n\n\t\tthis.user_group_api.getUserGroup( '', false, false, {\n\t\t\tonResult: function( res ) {\n\t\t\t\tres = res.getResult();\n\n\t\t\t\tres = Global.buildTreeRecord( res );\n\t\t\t\t$this.user_group_array = res;\n\n\t\t\t\tif ( $this.basic_search_field_ui_dic['group_ids'] ) {\n\t\t\t\t\t$this.basic_search_field_ui_dic['group_ids'].setSourceData( res );\n\t\t\t\t}\n\t\t\t\tif ( $this.adv_search_field_ui_dic['group_ids'] ) {\n\t\t\t\t\t$this.adv_search_field_ui_dic['group_ids'].setSourceData( res );\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t}\n\n\tgetSelectDate() {\n\t\tvar retval = this.start_date_picker?.getValue() ?? 'Invalid date';\n\n\t\tif ( retval == 'Invalid date' ) {\n\t\t\tretval = new Date();\n\t\t}\n\n\t\treturn retval;\n\t}\n\n\tgetGridSelectIdArray() {\n\n\t\tvar result = [];\n\t\tvar len = this.select_all_shifts_array.length;\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar item = this.select_all_shifts_array[i];\n\t\t\tif ( item.id && item.id != TTUUID.zero_id && item.id != TTUUID.not_exist_id ) {\n\t\t\t\tresult.push( item.id );\n\t\t\t}\n\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetSelectedItem() {\n\n\t\tvar selected_item = null;\n\t\tif ( this.edit_view ) {\n\t\t\tselected_item = this.current_edit_record;\n\t\t} else {\n\n\t\t\tif ( this.select_all_shifts_array.length > 0 ) {\n\t\t\t\tselected_item = this.select_all_shifts_array[0];\n\t\t\t}\n\n\t\t}\n\n\t\tif ( selected_item ) {\n\t\t\treturn Global.clone( selected_item );\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t_continueDoCopyAsNew() {\n\t\tvar $this = this;\n\t\tthis.setCurrentEditViewState( 'new' );\n\t\tLocalCacheData.current_doing_context_action = 'copy_as_new';\n\n\t\tif ( Global.isSet( this.edit_view ) ) {\n\n\t\t\tthis.current_edit_record.id = '';\n\t\t\tvar navigation_div = this.edit_view.find( '.navigation-div' );\n\t\t\tnavigation_div.css( 'display', 'none' );\n\t\t\tthis.setCurrentEditRecordData(); // Reset data to widgets to reset all widgets stat\n\t\t\tthis.setEditMenu();\n\t\t\tthis.setTabStatus();\n\t\t\tthis.is_changed = false;\n\t\t\tProgressBar.closeOverlay();\n\n\t\t} else {\n\n\t\t\tvar filter = {};\n\t\t\tvar grid_selected_id_array = this.getGridSelectIdArray();\n\t\t\tvar grid_selected_length = grid_selected_id_array.length;\n\n\t\t\tif ( grid_selected_length > 0 ) {\n\t\t\t\tvar selectedId = grid_selected_id_array[0];\n\t\t\t} else {\n\t\t\t\tvar select_shift = Global.clone( $this.select_all_shifts_array[0] );\n\t\t\t\tselect_shift = $this.resetSomeFields( select_shift );\n\t\t\t\t$this.current_edit_record = select_shift;\n\t\t\t\t$this.openEditView();\n\t\t\t\t$this.initEditView();\n\t\t\t\treturn;\n\n\t\t\t}\n\n\t\t\tfilter.filter_data = {};\n\t\t\tfilter.filter_data.id = [selectedId];\n\n\t\t\tthis.api['get' + this.api.key_name]( filter, {\n\t\t\t\tonResult: function( result ) {\n\n\t\t\t\t\tvar result_data = result.getResult();\n\n\t\t\t\t\t//#2571 - result_data is undefined (when result_data === true there is no result[0])\n\t\t\t\t\tif ( !result_data || result_data === true ) {\n\t\t\t\t\t\tTAlertManager.showAlert( $.i18n._( 'Record does not exist' ) );\n\t\t\t\t\t\t$this.onCancelClick();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t$this.openEditView(); // Put it here is to avoid if the selected one is not existed in data or have deleted by other pragram. in this case, the edit view should not be opend.\n\n\t\t\t\t\tresult_data = result_data[0];\n\n\t\t\t\t\tresult_data.id = '';\n\n\t\t\t\t\tif ( $this.sub_view_mode && $this.parent_key ) {\n\t\t\t\t\t\tresult_data[$this.parent_key] = $this.parent_value;\n\t\t\t\t\t}\n\n\t\t\t\t\t$this.current_edit_record = result_data;\n\t\t\t\t\t$this.initEditView();\n\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t}\n\n\tonViewClick( record, noRefreshUI ) {\n\t\tthis.setCurrentEditViewState( 'view' );\n\n\t\tvar record_id = this.getViewSelectedRecordId( record );\n\t\tif ( Global.isFalseOrNull( record_id ) ) {\n\t\t\tTTPromise.add( 'Schedule', 'init' );\n\t\t\tthis.openEditView();\n\t\t\tvar select_shift = Global.clone( this.select_all_shifts_array[0] );\n\t\t\tselect_shift = this.resetSomeFields( select_shift );\n\t\t\tthis.current_edit_record = select_shift;\n\n\t\t\tvar $this = this;\n\t\t\tTTPromise.wait( 'Schedule', 'init', function() {\n\t\t\t\t$this.initEditView();\n\t\t\t} );\n\t\t\treturn;\n\t\t}\n\t\tthis.setCurrentSelectedRecord( record_id );\n\n\t\tthis.openEditView();\n\n\t\tvar filter = this.getAPIFilters();\n\n\t\treturn this.doViewAPICall( filter );\n\t}\n\n\tgetCommonFields() {\n\t\tvar baseRecord;\n\t\t$.each( this.select_all_shifts_array, function( index, value ) {\n\t\t\tif ( !baseRecord ) {\n\t\t\t\tbaseRecord = Global.clone( value );\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tfor ( var key in value ) {\n\t\t\t\tbaseRecord[key] !== value[key] && delete baseRecord[key];\n\t\t\t}\n\t\t} );\n\n\t\treturn baseRecord;\n\t}\n\n\tonMassEditClick() {\n\t\tvar $this = this;\n\t\tvar filter = {};\n\t\tvar grid_selected_id_array = [];\n\t\tthis.setCurrentEditViewState( 'mass_edit' );\n\t\tthis.mass_edit_record_ids = [];\n\n\t\tgrid_selected_id_array = this.getGridSelectIdArray();\n\t\t$this.openEditView();\n\n\t\t$.each( grid_selected_id_array, function( index, value ) {\n\t\t\t$this.mass_edit_record_ids.push( value );\n\t\t} );\n\n\t\t$this.selected_user_ids = [];\n\t\t$.each( this.select_all_shifts_array, function( index, value ) {\n\t\t\tvar shift = value;\n\t\t\tif ( shift.hasOwnProperty( 'user_id' ) ) {\n\t\t\t\t$this.selected_user_ids.push( shift.user_id );\n\t\t\t}\n\n\t\t} );\n\n\t\tfilter.filter_data = {};\n\t\tfilter.filter_data.id = this.mass_edit_record_ids;\n\n\t\tif ( this.mass_edit_record_ids.length !== this.select_all_shifts_array.length ) {\n\t\t\tonMassEditResult( this.getCommonFields() );\n\t\t\treturn;\n\t\t}\n\n\t\tthis.api['getCommon' + this.api.key_name + 'Data']( filter, {\n\t\t\tonResult: function( result ) {\n\n\t\t\t\tvar result_data = result.getResult();\n\n\t\t\t\tif ( !result_data ) {\n\t\t\t\t\tresult_data = [];\n\t\t\t\t}\n\t\t\t\tonMassEditResult( result_data );\n\n\t\t\t}\n\t\t} );\n\n\t\tfunction onMassEditResult( result_data ) {\n\t\t\t$this.api['getOptions']( 'unique_columns', {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t$this.unique_columns = result.getResult();\n\t\t\t\t\t$this.api['getOptions']( 'linked_columns', {\n\t\t\t\t\t\tonResult: function( result1 ) {\n\n\t\t\t\t\t\t\t$this.linked_columns = result1.getResult();\n\n\t\t\t\t\t\t\tif ( $this.sub_view_mode && $this.parent_key ) {\n\t\t\t\t\t\t\t\tresult_data[$this.parent_key] = $this.parent_value;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t$this.current_edit_record = result_data;\n\t\t\t\t\t\t\t$this.is_mass_editing = true;\n\t\t\t\t\t\t\t$this.initEditView();\n\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t}\n\n\tonEditClick( record_id, noRefreshUI ) {\n\t\t// #2644: Note: This code fixes a bug where the edit screen is not opened on first try, but is on second. Likely due to the TTPromise and potential race conditions. See commit history for details.\n\t\tTTPromise.add( 'Schedule', 'init' );\n\t\tthis.setCurrentEditViewState( 'edit' );\n\t\tthis.openEditView();\n\n\t\trecord_id = this.getEditSelectedRecordId( record_id );\n\t\tif ( Global.isFalseOrNull( record_id ) ) {\n\t\t\tthis.openEditView();\n\t\t\tvar select_shift = Global.clone( this.select_all_shifts_array[0] );\n\t\t\tselect_shift = this.resetSomeFields( select_shift );\n\t\t\tthis.current_edit_record = select_shift;\n\t\t\tthis.current_edit_record.user_ids = [this.current_edit_record.user_id]; //#2610 - ensure that edit record is properly formed in respect to user_ids\n\t\t\tthis.is_viewing = false;\n\n\t\t\tvar $this = this;\n\t\t\tTTPromise.wait( 'Schedule', 'init', function() {\n\t\t\t\t$this.initEditView();\n\t\t\t} );\n\t\t\treturn;\n\t\t}\n\t\tthis.setCurrentSelectedRecord( record_id );\n\n\t\tvar filter = this.getAPIFilters();\n\n\t\treturn this.doEditAPICall( filter );\n\t}\n\n\tdoDeleteAPICall( remove_ids, callback ) {\n\t\tif ( !callback ) {\n\t\t\tcallback = {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\tProgressBar.closeOverlay();\n\t\t\t\t\tdoNext.call( this, result );\n\t\t\t\t\tif ( result && result.isValid() ) {\n\t\t\t\t\t\tthis.onDeleteDone( result );\n\t\t\t\t\t\tif ( this.edit_view ) {\n\t\t\t\t\t\t\tthis.removeEditView();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.setCurrentEditViewState( '' );\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tTAlertManager.showErrorAlert( result );\n\t\t\t\t\t}\n\t\t\t\t}.bind( this )\n\t\t\t};\n\t\t}\n\t\tif ( remove_ids && remove_ids.length > 0 ) {\n\t\t\treturn this.api['delete' + this.api.key_name]( remove_ids, callback );\n\t\t} else {\n\t\t\tdoNext.call( this, {\n\t\t\t\tisValid: function() {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\tfunction doNext( result ) {\n\t\t\t//Issue #3034 - TypeError: Cannot read properties of undefined (reading 'id').\n\t\t\t//Because deleting recurring schedules does not go through the normal pathway, we need to reset state\n\t\t\t//so that Vue does not decide we on an edit view and retrieve the wrong context menu array.\n\t\t\t//Otherwise JavaScript exceptions may trigger when reading an empty context menu array during other actions.\n\t\t\tif ( this.edit_view ) {\n\t\t\t\tthis.removeEditView();\n\t\t\t} else {\n\t\t\t\tthis.setCurrentEditViewState( '' );\n\t\t\t}\n\n\t\t\t//Since we can't delete recurring schedules, we need to override them as absent without a absence policy instead.\n\t\t\tvar recurring_delete_shifts_array = [];\n\t\t\tfor ( var i = 0; i < this.select_cells_Array.length; i++ ) {\n\t\t\t\tif ( this.select_cells_Array[i].shift ) {\n\t\t\t\t\tthis.select_cells_Array[i].shift.status_id = '20'; //Set shift to absent.\n\t\t\t\t\trecurring_delete_shifts_array.push( this.select_cells_Array[i].shift );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( recurring_delete_shifts_array.length > 0 ) {\n\t\t\t\tthis.api.setSchedule( recurring_delete_shifts_array, {\n\t\t\t\t\tonResult: function() {\n\t\t\t\t\t\tthis.search();\n\t\t\t\t\t}.bind( this )\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\tif ( result && result.isValid() ) {\n\t\t\t\t\tthis.search();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tgetCustomContextMenuModel() {\n\t\tvar context_menu_model = {\n\t\t\tgroups: {\n\t\t\t\tdrag_and_drop: {\n\t\t\t\t\tlabel: $.i18n._( 'Drag & Drop' ),\n\t\t\t\t\tid: this.viewId + 'drag_and_drop'\n\t\t\t\t}\n\t\t\t},\n\t\t\texclude: [\n\t\t\t\t'export_excel',\n\t\t\t\t'save_and_next',\n\t\t\t\t'delete_and_next',\n\t\t\t\t'copy'\n\t\t\t],\n\t\t\tinclude: [\n\t\t\t\t// Note Drag&Drop icons will be conditionally prepended here later in code for list view modes.\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Jump To' ),\n\t\t\t\t\tid: 'jump_to_header',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\taction_group: 'jump_to',\n\t\t\t\t\taction_group_header: true,\n\t\t\t\t\tpermission_result: false, // to hide it in legacy context menu and avoid errors in legacy parsers.\n\t\t\t\t\tsort_order: 9030\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'TimeSheet' ),\n\t\t\t\t\tid: 'timesheet',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\taction_group: 'jump_to',\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\tpermission_result: true,\n\t\t\t\t\tsort_order: 9030\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Edit Employee' ),\n\t\t\t\t\tid: 'edit_employee',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\taction_group: 'jump_to',\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\tpermission_result: true,\n\t\t\t\t\tsort_order: 9030\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Import' ),\n\t\t\t\t\tid: 'import_icon',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\taction_group: 'import_export',\n\t\t\t\t\tgroup: 'other',\n\t\t\t\t\tvue_icon: 'tticon tticon-file_download_black_24dp',\n\t\t\t\t\tpermission_result: PermissionManager.checkTopLevelPermission( 'ImportCSVSchedule' ),\n\t\t\t\t\tsort_order: 9025\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\t// Edit Views\n\n\t\tcontext_menu_model.include.push( {\n\t\t\tlabel: $.i18n._( 'Print' ),\n\t\t\tid: 'print',\n\t\t\taction_group_header: true,\n\t\t\taction_group: 'print',\n\t\t\tmenu_align: 'right',\n\t\t\tsort_order: 9020,\n\t\t\t} );\n\n\t\tcontext_menu_model.include.push( {\n\t\t\tlabel: $.i18n._( 'Individual Schedules' ),\n\t\t\tid: 'pdf_schedule',\n\t\t\taction_group: 'print',\n\t\t\tmenu_align: 'right',\n\t\t\tsort_order: 9020\n\t\t} );\n\n\t\tcontext_menu_model.include.push(\n\t\t\t{\n\t\t\t\tlabel: $.i18n._( 'Find Available' ),\n\t\t\t\tid: 'find_available',\n\t\t\t\tvue_icon: 'tticon tticon-search_black_24dp',\n\t\t\t\tmenu_align: 'right',\n\t\t\t\tpermission_result: true,\n\t\t\t\tshow_on_right_click: true,\n\t\t\t\tsort_order: 7000\n\t\t\t}\n\t\t);\n\n\t\tif ( PermissionManager.validate( 'request', 'add' ) ) {\n\t\t\tcontext_menu_model.include.push( {\n\t\t\t\tlabel: $.i18n._( 'Add Request' ),\n\t\t\t\tid: 'AddRequest',\n\t\t\t\tvue_icon: 'tticon tticon-post_add_black_24dp',\n\t\t\t\tmenu_align: 'right',\n\t\t\t\tpermission_result: true,\n\t\t\t\tpermission: true,\n\t\t\t\tshow_on_right_click: true,\n\t\t\t\tsort_order: 7010\n\t\t\t} );\n\t\t}\n\n\t\tif ( !this.is_edit && !this.is_mass_editing && !this.is_viewing ) {\n\t\t\tcontext_menu_model.include.unshift( // Add to begginning of array to preserve item order.\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Drag & Drop: Move' ),\n\t\t\t\t\tid: 'move',\n\t\t\t\t\taction_group: 'drag_and_drop',\n\t\t\t\t\tmulti_select_group: 1,\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\tgroup: 'drag_and_drop',\n\t\t\t\t\tpermission_result: true,\n\t\t\t\t\tsort_order: 8050\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Drag & Drop: Copy' ),\n\t\t\t\t\tid: 'drag_copy',\n\t\t\t\t\taction_group: 'drag_and_drop',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\tmulti_select_group: 1,\n\t\t\t\t\tgroup: 'drag_and_drop',\n\t\t\t\t\tpermission_result: true,\n\t\t\t\t\tsort_order: 8060\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Drag & Drop: Swap' ),\n\t\t\t\t\tid: 'swap',\n\t\t\t\t\taction_group: 'drag_and_drop',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\tmulti_select_group: 1,\n\t\t\t\t\tgroup: 'drag_and_drop',\n\t\t\t\t\tpermission_result: true,\n\t\t\t\t\tsort_order: 8070\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'separator_drag_and_drop_1',\n\t\t\t\t\taction_group: 'drag_and_drop',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\tseparator: true,\n\t\t\t\t\tsort_order: 8080\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Drag & Drop: Overwrite' ),\n\t\t\t\t\tid: 'override',\n\t\t\t\t\taction_group: 'drag_and_drop',\n\t\t\t\t\tmulti_select_group: 2,\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\tgroup: 'drag_and_drop',\n\t\t\t\t\tpermission_result: true,\n\t\t\t\t\tsort_order: 8090\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tif ( Global.getProductEdition() >= 15 ) {\n\t\t\t\tcontext_menu_model.include.unshift(\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: $.i18n._( 'Drag & Drop: Notify Employee' ),\n\t\t\t\t\t\tid: 'notify_user_schedule_change',\n\t\t\t\t\t\taction_group: 'drag_and_drop',\n\t\t\t\t\t\tmulti_select_group: 3,\n\t\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\t\tgroup: 'drag_and_drop',\n\t\t\t\t\t\tpermission_result: true,\n\t\t\t\t\t\tsort_order: 8100\n\t\t\t\t\t} );\n\t\t\t}\n\n\t\t}\n\n\t\tif ( PermissionManager.validate( 'schedule', 'view' ) || PermissionManager.validate( 'schedule', 'view_child' ) ) {\n\t\t\tcontext_menu_model.include.push(\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Group - Combined' ),\n\t\t\t\t\tid: 'pdf_schedule_group_combined',\n\t\t\t\t\taction_group: 'print',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\tsort_order: 9020,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Group - Separated' ),\n\t\t\t\t\tid: 'pdf_schedule_group',\n\t\t\t\t\taction_group: 'print',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\tsort_order: 9020,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Group - Separated (Page Breaks)' ),\n\t\t\t\t\tid: 'pdf_schedule_group_pagebreak',\n\t\t\t\t\taction_group: 'print',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\tsort_order: 9020,\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tcontext_menu_model.include.push(\n\t\t);\n\n\t\tif ( ( PermissionManager.validate( 'punch', 'add' ) && ( PermissionManager.validate( 'punch', 'edit' ) || PermissionManager.validate( 'punch', 'edit_child' ) ) ) ) {\n\t\t\tcontext_menu_model.include.push(\n\t\t\t\t{\n\t\t\t\t\tlabel: '', //Empty label. vue_icon is displayed instead of text.\n\t\t\t\t\tid: 'other_header',\n\t\t\t\t\taction_group: 'other',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\taction_group_header: true,\n\t\t\t\t\tvue_icon: 'tticon tticon-more_vert_black_24dp',\n\t\t\t\t\tsort_order: 9050\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Auto Punch' ),\n\t\t\t\t\tid: 'AutoPunch',\n\t\t\t\t\taction_group: 'other',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\tgroup: 'other',\n\t\t\t\t\tpermission_result: true,\n\t\t\t\t\tpermission: true,\n\t\t\t\t\tshow_on_right_click: true,\n\t\t\t\t\tsort_order: 9050\n\t\t\t\t} );\n\t\t}\n\n\t\treturn context_menu_model;\n\t}\n\n\tparseCustomContextModelForEditViews( context_menu_model ) {\n\n\t\tcontext_menu_model = super.parseCustomContextModelForEditViews( context_menu_model );\n\n\t\tif ( this.determineContextMenuMountAttributes().menu_type === 'editview_contextmenu' ) {\n\t\t\tcontext_menu_model.exclude.push(\n\t\t\t\t'move',\n\t\t\t\t'drag_copy',\n\t\t\t\t'swap',\n\t\t\t\t'override',\n\t\t\t\t'notify_user_schedule_change',\n\t\t\t\t'print',\n\t\t\t\t'pdf_schedule',\n\t\t\t\t'pdf_schedule_group_combined',\n\t\t\t\t'pdf_schedule_group',\n\t\t\t\t'pdf_schedule_group_pagebreak'\n\t\t\t);\n\t\t}\n\n\t\treturn context_menu_model;\n\t}\n\n\tonReportMenuClick( id ) {\n\t\tthis.onNavigationClick( id );\n\t}\n\n\tonCustomContextClick( id ) {\n\t\tswitch ( id ) {\n\t\t\tcase 'move':\n\t\t\tcase 'drag_copy':\n\t\t\tcase 'swap':\n\t\t\t\tthis.setMoveOrDropMode( id );\n\t\t\t\tbreak;\n\t\t\tcase 'override':\n\t\t\t\tthis.onOverrideClick();\n\t\t\t\tbreak;\n\t\t\tcase 'notify_user_schedule_change':\n\t\t\t\tthis.onNotifyUserScheduleChangeClick();\n\t\t\t\tbreak;\n\t\t\tcase 'edit_employee':\n\t\t\tcase 'timesheet':\n\t\t\t\tthis.onNavigationClick( id );\n\t\t\t\tbreak;\n\t\t\tcase 'find_available':\n\t\t\t\tthis.onFindAvailableClick( id );\n\t\t\t\tbreak;\n\t\t\tcase 'AutoPunch':\n\t\t\t\tthis.addPunchesFromScheduledShifts( id );\n\t\t\t\tbreak;\n\t\t\tcase 'AddRequest':\n\t\t\t\tthis.addRequestFromScheduledShifts( id );\n\t\t\t\tbreak;\n\t\t\tcase 'import_icon':\n\t\t\t\tthis.onImportClick();\n\t\t\t\tbreak;\n\t\t\tcase 'pdf_schedule':\n\t\t\tcase 'pdf_schedule_group':\n\t\t\tcase 'pdf_schedule_group_combined':\n\t\t\tcase 'pdf_schedule_group_pagebreak':\n\t\t\t\tthis.onReportMenuClick( id );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\taddRequestFromScheduledShifts( id ) {\n\t\tif ( Global.getProductEdition() <= 10 ) {\n\t\t\tTAlertManager.showAlert( Global.getUpgradeMessage() );\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( shift_array && shift_array.length <= 0 ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar shift_array = this.select_cells_Array;\n\t\tvar first_shift = ( shift_array[0] ) ? shift_array[0] : null;\n\t\tvar last_shift = ( shift_array[shift_array.length - 1] ) ? shift_array[shift_array.length - 1] : null;\n\t\tif ( !first_shift || !last_shift ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar request = this.api.getScheduleDefaultData( this.select_cells_Array, { async: false } ).getResult();\n\t\tvar shift_status = 10;\n\t\tvar type_id = 40;\n\n\t\tvar mon = false, tue = false, wed = false, thu = false, fri = false, sat = false, sun = false;\n\n\t\tfor ( var w in shift_array ) {\n\t\t\tif ( first_shift.shift == undefined && shift_array[w].shift ) {\n\t\t\t\t//Set the archetype to the first day with a shift.\n\t\t\t\tfirst_shift = shift_array[w];\n\t\t\t}\n\n\t\t\t//Set selected days of the week.\n\t\t\tvar d = new Date( shift_array[w].time_stamp_num );\n\t\t\tswitch ( d.getDay() ) {\n\t\t\t\tcase 0:\n\t\t\t\t\tsun = true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 1:\n\t\t\t\t\tmon = true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\ttue = true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3:\n\t\t\t\t\twed = true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 4:\n\t\t\t\t\tthu = true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 5:\n\t\t\t\t\tfri = true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 6:\n\t\t\t\t\tsat = true;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// delete ( d ); #2792 In the new ES6 conversion, delete is causing errors, but technically should never have worked anyway. Potentially never did anything. Could maybe delete. Try null first.\n\t\t\td = null;\n\t\t}\n\n\t\trequest.mon = mon;\n\t\trequest.tue = tue;\n\t\trequest.wed = wed;\n\t\trequest.thu = thu;\n\t\trequest.fri = fri;\n\t\trequest.sat = sat;\n\t\trequest.sun = sun;\n\n\t\tif ( first_shift && first_shift.date ) {\n\t\t\tvar start_date = first_shift.date;\n\t\t}\n\n\t\tif ( last_shift && last_shift.date ) {\n\t\t\tvar end_date = last_shift.date;\n\t\t}\n\n\t\tif ( first_shift ) {\n\t\t\tif ( first_shift.shift && first_shift.shift.status_id == 10 && first_shift.shift.user_id && first_shift.shift.user_id != TTUUID.zero_id ) {\n\t\t\t\tshift_status = 20;\n\t\t\t\ttype_id = 30;\n\t\t\t}\n\t\t}\n\n\t\trequest.status_id = shift_status;\n\t\trequest.type_id = type_id;\n\t\trequest.user_id = LocalCacheData.getLoginUser().id;\n\t\trequest.full_name = LocalCacheData.getLoginUser().full_name;\n\t\tif ( start_date ) {\n\t\t\trequest.date_stamp = start_date;\n\t\t\trequest.start_date = start_date;\n\t\t}\n\n\t\tif ( end_date ) {\n\t\t\trequest.end_date = end_date;\n\t\t}\n\n\t\tif ( first_shift.start_time ) {\n\t\t\trequest.start_time = first_shift.start_time;\n\t\t}\n\n\t\tif ( first_shift.end_time ) {\n\t\t\trequest.end_time = first_shift.end_time;\n\t\t}\n\n\t\tif ( first_shift.branch_id ) {\n\t\t\trequest.branch_id = first_shift.branch_id;\n\t\t}\n\n\t\tif ( first_shift.department_id ) {\n\t\t\trequest.department_id = first_shift.department_id;\n\t\t}\n\n\t\tif ( first_shift.job_id ) {\n\t\t\trequest.job_id = first_shift.job_id;\n\t\t}\n\n\t\tif ( first_shift.job_item_id ) {\n\t\t\trequest.job_item_id = first_shift.job_item_id;\n\t\t}\n\n\t\tif ( first_shift.punch_tag_id ) {\n\t\t\trequest.punch_tag_id = first_shift.punch_tag_id;\n\t\t}\n\n\t\tIndexViewController.openEditView( this, 'Request', request, 'openAddView' );\n\t}\n\n\taddPunchesFromScheduledShifts( id ) {\n\n\t\tif ( Global.getProductEdition() <= 10 ) {\n\t\t\tTAlertManager.showAlert( Global.getUpgradeMessage() );\n\t\t\treturn false;\n\t\t}\n\t\tif ( this.select_cells_Array == undefined || this.select_cells_Array.length < 1 ) {\n\t\t\tTAlertManager.showAlert( 'No schedules selected. You can\\'t autopunch no schedules.' );\n\t\t\treturn false;\n\t\t}\n\n\t\tvar shift_array = this.select_cells_Array;\n\t\tvar schedules = {};\n\t\tvar users = [];\n\t\tschedules.schedule = [];\n\t\tschedules.recurring = [];\n\n\t\tfor ( var i = 0; i < shift_array.length; i++ ) {\n\t\t\tif ( shift_array[i].shift != undefined ) { //avoid when no user scheduled.\n\t\t\t\tif ( shift_array[i].shift.id\n\t\t\t\t\t&& shift_array[i].shift.id != TTUUID.zero_id\n\t\t\t\t\t&& shift_array[i].shift.id != TTUUID.not_exist_id\n\t\t\t\t) {\n\t\t\t\t\tschedules.schedule.push( shift_array[i].shift.id );\n\t\t\t\t} else if ( shift_array[i].shift.recurring_schedule_id\n\t\t\t\t\t&& shift_array[i].shift.recurring_schedule_id != TTUUID.not_exist_id\n\t\t\t\t) {\n\t\t\t\t\tschedules.recurring.push( shift_array[i].shift.recurring_schedule_id );\n\t\t\t\t}\n\t\t\t\tusers.push( shift_array[i].shift.user_id );\n\t\t\t}\n\t\t}\n\n\t\tthis.api.addPunchesFromScheduledShifts( schedules, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tif ( result && result.isValid() ) {\n\t\t\t\t\tUserGenericStatusWindowController.open( result.getAttributeInAPIDetails( 'user_generic_status_batch_id' ), [LocalCacheData.getLoginUser().id] );\n\t\t\t\t} else {\n\t\t\t\t\tTAlertManager.showErrorAlert( result );\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t}\n\n\tgetSelectEmployee() {\n\t\tvar shift = this.select_cells_Array[0];\n\n\t\t//Error: Uncaught TypeError: Cannot read property 'user_id' of undefined in /interface/html5/#!m=Schedule&date=20141117&mode=week&a=new&tab=Schedule line 1116\n\t\tif ( !shift || shift.user_id == TTUUID.zero_id ) {\n\t\t\tshift = { user_id: LocalCacheData.getLoginUser().id };\n\t\t} else if ( shift.user_id && shift.user_id != TTUUID.zero_id ) {\n\t\t\tshift = { user_id: shift.user_id };\n\t\t}\n\n\t\tif ( this.edit_view && this.current_edit_record ) {\n\t\t\tshift.user_id = this.current_edit_record.user_id;\n\t\t}\n\n\t\treturn shift.user_id;\n\t}\n\n\tonFindAvailableClick() {\n\t\tif ( Global.getProductEdition() <= 10 ) {\n\t\t\tTAlertManager.showAlert( Global.getUpgradeMessage() );\n\t\t\treturn;\n\t\t}\n\n\t\tvar $this = this;\n\t\tvar args = {};\n\t\targs.selected = [];\n\t\tvar len = this.select_all_shifts_array.length;\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar item = this.select_all_shifts_array[i];\n\t\t\targs.selected.push( item );\n\t\t}\n\n\t\tLocalCacheData.extra_filter_for_next_open_view = {};\n\t\tLocalCacheData.extra_filter_for_next_open_view.filter_data = args;\n\n\t\tIndexViewController.openWizard( 'FindAvailableWizard', null, function( employee_id, notify_users ) {\n\t\t\t$this.onFindAvailableClose( employee_id, args.selected, notify_users );\n\t\t} );\n\t}\n\n\tonFindAvailableClose( employee_id, shift_array, notify_users ) {\n\t\tvar $this = this;\n\t\tvar len = shift_array.length;\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar item = shift_array[i];\n\t\t\titem.user_id = employee_id;\n\t\t\titem.replaced_id = item.id;\n\t\t\titem.notify_user_schedule_change = notify_users;\n\t\t\tdelete item.id;\n\t\t}\n\n\t\tthis.api.setSchedule( shift_array, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tif ( !result.isValid() ) {\n\t\t\t\t\tTAlertManager.showErrorAlert( result );\n\t\t\t\t}\n\t\t\t\t$this.search();\n\t\t\t}\n\t\t} );\n\t}\n\n\tonImportClick() {\n\t\tvar $this = this;\n\t\tIndexViewController.openWizard( 'ImportCSVWizard', 'Schedule', function() {\n\t\t\t$this.search();\n\t\t} );\n\t}\n\n\tonNavigationClick( iconName ) {\n\n\t\tif ( !this.checkScheduleData() ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar post_data;\n\n\t\tswitch ( iconName ) {\n\t\t\tcase 'edit_employee':\n\t\t\t\tIndexViewController.openEditView( this, 'Employee', this.getSelectEmployee() );\n\t\t\t\tbreak;\n\t\t\tcase 'timesheet':\n\t\t\t\tvar filter = { filter_data: {} };\n\t\t\t\tfilter.user_id = this.getSelectEmployee();\n\n\t\t\t\tif ( this.edit_view ) {\n\t\t\t\t\tfilter.base_date = this.current_edit_record.date_stamp;\n\t\t\t\t} else {\n\t\t\t\t\tfilter.base_date = this.start_date_picker.getValue();\n\t\t\t\t}\n\t\t\t\tGlobal.addViewTab( this.viewId, $.i18n._( 'Schedules' ), window.location.href );\n\t\t\t\tIndexViewController.goToView( 'TimeSheet', filter );\n\n\t\t\t\tbreak;\n\t\t\tcase 'pdf_schedule':\n\t\t\tcase 'pdf_schedule_group_combined':\n\t\t\tcase 'pdf_schedule_group':\n\t\t\tcase 'pdf_schedule_group_pagebreak':\n\t\t\t\tfilter = Global.convertLayoutFilterToAPIFilter( this.select_layout );\n\n\t\t\t\tif ( !filter ) {\n\t\t\t\t\tfilter = {};\n\t\t\t\t}\n\t\t\t\tfilter.time_period = {};\n\t\t\t\tfilter.time_period.time_period = 'custom_date';\n\t\t\t\tfilter.time_period.start_date = this.full_schedule_data.schedule_dates.start_display_date;\n\t\t\t\tfilter.time_period.end_date = this.full_schedule_data.schedule_dates.end_display_date;\n\n\t\t\t\tif ( filter.time_period.start_date == filter.time_period.end_date ) {\n\t\t\t\t\tvar new_end_date = new Date( new Date( this.start_date.getTime() ).setDate( this.start_date.getDate() + 6 ) );\n\t\t\t\t\tfilter.time_period.end_date = new_end_date.format();\n\t\t\t\t}\n\n\t\t\t\tpost_data = { 0: filter, 1: iconName };\n\t\t\t\tthis.doFormIFrameCall( post_data );\n\t\t\t\tbreak;\n\n\t\t}\n\t}\n\n\tdoFormIFrameCall( postData ) {\n\t\tGlobal.APIFileDownload( 'APIScheduleSummaryReport', 'getScheduleSummaryReport', postData );\n\t}\n\n\tsetScheduleGridDragAble() {\n\t\tvar mode = this.getMode();\n\n\t\tswitch ( mode ) {\n\t\t\tcase ScheduleViewControllerMode.DAY:\n\t\t\t\tthis.setWeekModeDragAble();\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerMode.WEEK:\n\t\t\t\tthis.setWeekModeDragAble();\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerMode.MONTH:\n\t\t\t\tthis.setWeekModeDragAble();\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerMode.YEAR:\n\t\t\t\tthis.setWeekModeDragAble();\n\t\t\t\tbreak;\n\t\t}\n\n\t\tvar $this = this;\n\t\t//set bottom drag to scroll area\n\t\t$( '.schedule-grid-div' ).off( 'dragover' ).on( 'dragover', function( e ) {\n\n\t\t\tvar grid_div = $( '.schedule-grid-div' );\n\t\t\tvar grid_pos = grid_div.offset().top;\n\n\t\t\tvar mouse_y = e.originalEvent.clientY;\n\t\t\tvar grid_height = grid_div.height();\n\n\t\t\tif ( mouse_y > ( grid_pos + grid_height ) ) {\n\t\t\t\t$this.scroll_unit = mouse_y - ( grid_pos + grid_height );\n\t\t\t\tif ( !$this.scroll_interval ) {\n\t\t\t\t\t$this.scroll_interval = setInterval( function() {\n\t\t\t\t\t\tvar div = $this.grid.grid.parent().parent();\n\t\t\t\t\t\tdiv.scrollTop( div.scrollTop() + $this.scroll_unit );\n\t\t\t\t\t}, 50 );\n\t\t\t\t}\n\t\t\t} else if ( mouse_y < ( grid_pos + 15 ) && mouse_y > ( grid_pos - 50 ) ) {\n\t\t\t\t$this.scroll_unit = ( grid_pos + 15 ) - mouse_y;\n\t\t\t\tif ( !$this.scroll_interval ) {\n\t\t\t\t\t$this.scroll_interval = setInterval( function() {\n\t\t\t\t\t\tvar div = $this.grid.grid.parent().parent();\n\t\t\t\t\t\tdiv.scrollTop( div.scrollTop() - $this.scroll_unit );\n\t\t\t\t\t}, 50 );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tclearInterval( $this.scroll_interval );\n\t\t\t\t$this.scroll_interval = null;\n\t\t\t}\n\n\t\t} );\n\n\t\t$( '.schedule-grid-div' ).off( 'dragend' ).on( 'dragend', function( e ) {\n\n\t\t\tif ( $this.scroll_interval ) {\n\t\t\t\tclearInterval( $this.scroll_interval );\n\t\t\t\t$this.scroll_interval = null;\n\t\t\t}\n\n\t\t} );\n\n\t\t$( '.schedule-grid-div td' ).unbind( 'dragenter' ).bind( 'dragenter', function( event ) {\n\t\t\tevent.preventDefault();\n\t\t\t$( '.schedule-drag-over' ).removeClass( 'schedule-drag-over' );\n\n\t\t\tif ( $( this ).attr( 'draggable' ) || $( this ).parents( 'td' ).attr( 'draggable' ) ) {\n\t\t\t\t$( this ).addClass( 'schedule-drag-over' );\n\t\t\t}\n\t\t} );\n\t}\n\n\tsetWeekModeDragAble() {\n\t\tvar $this = this;\n\t\tvar position = 0;\n\n\t\tvar cells = this.grid.grid.find( '.date-column' ).parents( 'td' );\n\n\t\tcells.attr( 'draggable', true );\n\n\t\tcells.unbind( 'dragstart' ).bind( 'dragstart', function( event ) {\n\t\t\tvar td = event.target;\n\t\t\tif ( $this.select_all_shifts_array.length < 1 || !$( td ).hasClass( 'ui-state-highlight' ) || !$this.select_drag_menu_id ) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tvar container = $( '<div class=\\'drag-holder-div\\'></div>' );\n\n\t\t\tvar len = $this.select_all_shifts_array.length;\n\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\tvar shift = $this.select_all_shifts_array[i];\n\t\t\t\tvar span = $( '<span class=\\'drag-span\\'></span>' );\n\n\t\t\t\tif ( shift.status_id == 20 ) {\n\t\t\t\t\tspan.text( $this.getAbsenceCellValue( shift ) );\n\t\t\t\t} else {\n\t\t\t\t\tspan.text( shift.start_time + ' - ' + shift.end_time );\n\t\t\t\t}\n\n\t\t\t\tcontainer.append( span );\n\t\t\t}\n\n\t\t\t$( 'body' ).find( '.drag-holder-div' ).remove();\n\n\t\t\t$( 'body' ).append( container );\n\n\t\t\tevent.originalEvent.dataTransfer.setData( 'Text', 'schedule' );//JUST ELEMENT references is ok here NO ID\n\n\t\t\tif ( event.originalEvent.dataTransfer.setDragImage ) {\n\t\t\t\tevent.originalEvent.dataTransfer.setDragImage( container[0], 0, 0 );\n\t\t\t}\n\n\t\t\treturn true;\n\t\t} );\n\n\t\tcells.unbind( 'drop' ).bind( 'drop', function( event ) {\n\t\t\tevent.preventDefault();\n\t\t\tif ( event.stopPropagation ) {\n\t\t\t\tevent.stopPropagation(); // stops the browser from redirecting.\n\t\t\t}\n\n\t\t\t$( '.drag-holder-div' ).remove();\n\n\t\t\tvar target_empty_row = false;\n\t\t\tvar delete_old_items = false;\n\n\t\t\tvar new_shifts_array = [];\n\t\t\tvar delete_shifts_array = [];\n\t\t\tvar recurring_delete_shifts_array = [];\n\n\t\t\tvar target_cell = event.currentTarget;\n\n\t\t\tvar selected_shifts = $this.select_cellls_and_shifts_array;\n\t\t\t//Error: Uncaught TypeError: Cannot read property 'length' of undefined in interface/html5/#!m=Schedule&date=20151213&mode=week line 1420\n\t\t\tif ( !selected_shifts ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar first_target_row_index;\n\t\t\tvar first_target_cell_index;\n\n\t\t\tfirst_target_row_index = target_cell.parentNode.rowIndex - 1;\n\t\t\tfirst_target_cell_index = target_cell.cellIndex;\n\n\t\t\tvar row_index_offset = 0;\n\t\t\tvar cell_index_offset = 0;\n\n\t\t\tvar first_selected_row_index;\n\t\t\tvar first_selected_cell_index;\n\n\t\t\tvar colModel = $this.grid.grid.getGridParam( 'colModel' );\n\n\t\t\tif ( $this.select_drag_menu_id === 'move' ) {\n\t\t\t\tdelete_old_items = true;\n\t\t\t} else {\n\t\t\t\tdelete_old_items = false;\n\t\t\t}\n\n\t\t\tvar len = selected_shifts.length;\n\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\tvar cell = selected_shifts[i];\n\t\t\t\tvar shift;\n\n\t\t\t\tif ( i === 0 ) {\n\t\t\t\t\tfirst_selected_row_index = cell.row_id;\n\t\t\t\t\tfirst_selected_cell_index = cell.cell_index;\n\t\t\t\t} else {\n\t\t\t\t\tif ( !target_empty_row ) {\n\t\t\t\t\t\trow_index_offset = cell.row_id - first_selected_row_index;\n\t\t\t\t\t}\n\t\t\t\t\tcell_index_offset = cell.cell_index - first_selected_cell_index;\n\t\t\t\t}\n\n\t\t\t\tif ( cell.shift ) {\n\t\t\t\t\tshift = cell.shift;\n\t\t\t\t} else {\n\t\t\t\t\tvar target_row_index = first_target_row_index + row_index_offset;\n\t\t\t\t\tvar target_cell_index = first_target_cell_index + cell_index_offset;\n\t\t\t\t\tif ( target_cell_index > colModel.length - 1 ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tvar target_data = $this.getDataByCellIndex( target_row_index, target_cell_index );\n\t\t\t\t\tvar target_row = $this.schedule_source[target_row_index];\n\n\t\t\t\t\tif ( !target_row || !target_row.user_id ) {\n\t\t\t\t\t\ttarget_empty_row = true;\n\t\t\t\t\t}\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tshift.branch_id = shift.branch ? shift.branch_id : '';\n\t\t\t\tshift.department_id = shift.department ? shift.department_id : '';\n\t\t\t\tshift.job_id = shift.job_id ? shift.job_id : '';\n\t\t\t\tshift.job_item_id = shift.job_item_id ? shift.job_item_id : '';\n\t\t\t\tshift.punch_tag_id = shift.punch_tag_id ? shift.punch_tag_id : '';\n\n\t\t\t\ttarget_row_index = first_target_row_index + row_index_offset;\n\t\t\t\ttarget_cell_index = first_target_cell_index + cell_index_offset;\n\n\t\t\t\tif ( target_cell_index > colModel.length - 1 ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\ttarget_data = $this.getDataByCellIndex( target_row_index, target_cell_index );\n\t\t\t\ttarget_row = $this.schedule_source[target_row_index];\n\n\t\t\t\tif ( !target_row || !target_row.user_id ) {\n\t\t\t\t\ttarget_empty_row = true;\n\t\t\t\t}\n\n\t\t\t\tif ( target_row ) {\n\t\t\t\t\tif ( target_row.type === ScheduleViewControllerRowType.DATE ) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( !target_data || target_empty_row ) {\n\t\t\t\t\t\tvar date_stamp;\n\n\t\t\t\t\t\t//Error: TypeError: colModel[target_cell_index] is undefined in /interface/html5/framework/jquery.min.js?v=8.0.0-20141230-153210 line 2 > eval line 1443\n\t\t\t\t\t\tif ( colModel ) {\n\t\t\t\t\t\t\tif ( $this.getMode() === ScheduleViewControllerMode.MONTH ) {\n\t\t\t\t\t\t\t\t//Error: \"TypeError: Cannot read property 'format' of null\"\n\t\t\t\t\t\t\t\t// when user drags a scedule to a non-date grid element we need to quietly fail\n\t\t\t\t\t\t\t\tvar related_date = $this.getCellRelatedDate( target_row_index, colModel, target_cell_index, colModel[target_cell_index].name );\n\t\t\t\t\t\t\t\tif ( related_date ) {\n\t\t\t\t\t\t\t\t\tdate_stamp = related_date.format();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdate_stamp = Global.strToDate( colModel[target_cell_index].name, $this.full_format ).format();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( !date_stamp || date_stamp == 'Invalid date' ) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttarget_data = {};\n\n\t\t\t\t\t\tif ( !target_row.user_id ) { //Only happens in month mode;\n\t\t\t\t\t\t\ttarget_data = shift;\n\t\t\t\t\t\t\ttarget_data.date_stamp = date_stamp;\n\t\t\t\t\t\t\ttarget_data.start_date_stamp = date_stamp;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttarget_data.user_id = target_row.user_id;\n\t\t\t\t\t\t\ttarget_data.branch = target_row.branch;\n\t\t\t\t\t\t\ttarget_data.branch_id = target_row.branch ? target_row.branch_id : '';\n\t\t\t\t\t\t\ttarget_data.schedule_policy_id = target_row.schedule_policy_id;\n\t\t\t\t\t\t\ttarget_data.department_id = target_row.department ? target_row.department_id : '';\n\t\t\t\t\t\t\ttarget_data.department = target_row.department;\n\t\t\t\t\t\t\ttarget_data.job_id = target_row.job_id ? target_row.job_id : '';\n\t\t\t\t\t\t\ttarget_data.job = target_row.job;\n\t\t\t\t\t\t\ttarget_data.job_item_id = target_row.job_item_id ? target_row.job_item_id : '';\n\t\t\t\t\t\t\ttarget_data.punch_tag_id = target_row.punch_tag_id ? target_row.punch_tag_id : '';\n\t\t\t\t\t\t\ttarget_data.job_item = target_row.job_item;\n\t\t\t\t\t\t\ttarget_data.date_stamp = date_stamp;\n\t\t\t\t\t\t\ttarget_data.start_date_stamp = date_stamp;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tvar new_shift = Global.clone( shift );\n\n\t\t\t\tif ( $this.select_drag_menu_id !== 'swap' ) {\n\t\t\t\t\tnew_shift.id = '';\n\t\t\t\t\tnew_shift.date_stamp = target_data.date_stamp;\n\t\t\t\t\tnew_shift.start_date_stamp = target_data.start_date_stamp;\n\t\t\t\t\tnew_shift.user_id = target_data.user_id;\n\t\t\t\t\t// When dragging an open shift to an empty cell in a user row with no branch column visible, the branch id value now defaults to user default branch id\n\t\t\t\t\tnew_shift.branch_id = target_data.branch ? target_data.branch_id : TTUUID.not_exist_id;\n\t\t\t\t\tnew_shift.department_id = target_data.department ? target_data.department_id : TTUUID.not_exist_id;\n\t\t\t\t\tnew_shift.job_id = target_data.job_id ? target_data.job_id : TTUUID.not_exist_id;\n\t\t\t\t\tnew_shift.job_item_id = target_data.job_item_id ? target_data.job_item_id : TTUUID.not_exist_id;\n\t\t\t\t\tnew_shift.punch_tag_id = target_data.punch_tag_id ? target_data.punch_tag_id : TTUUID.not_exist_id;\n\n\t\t\t\t\tif ( $this.is_override ) {\n\t\t\t\t\t\tnew_shift.overwrite = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( $this.notify_user_schedule_change ) {\n\t\t\t\t\t\tnew_shift.notify_user_schedule_change = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tnew_shifts_array.push( new_shift );\n\t\t\t\t\tif ( shift.id && shift.id != TTUUID.zero_id ) {\n\t\t\t\t\t\tdelete_shifts_array.push( shift.id );\n\t\t\t\t\t} else if ( shift.user_id != TTUUID.zero_id && shift.user_id != TTUUID.not_exist_id ) {\n\t\t\t\t\t\t//If dragging (move) a recurring shift assigned to a user and dropping on another user, switch the source shift to Absent in the process, otherwise both shifts will exist as being worked.\n\t\t\t\t\t\t//  However when dragging from a OPEN shift as the source, that isn't required, as the OPEN shift will automatically be filled.\n\t\t\t\t\t\tshift.status_id = '20';\n\t\t\t\t\t\trecurring_delete_shifts_array.push( shift );\n\t\t\t\t\t} else if ( shift.user_id == TTUUID.zero_id ) {\n\t\t\t\t\t\tdelete_old_items = false; //Never delete old items when the source is a OPEN shift.\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tvar temp_selected_data = Global.clone( new_shift );\n\t\t\t\t\tvar temp_target_data = Global.clone( target_data );\n\n\t\t\t\t\tif ( !temp_target_data.start_date ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tfor ( var key in target_data ) {\n\t\t\t\t\t\tif ( key !== 'id' &&\n\t\t\t\t\t\t\tkey !== 'user_id' &&\n\t\t\t\t\t\t\tkey !== 'date_stamp' &&\n\t\t\t\t\t\t\tkey !== 'start_date_stamp' &&\n\t\t\t\t\t\t\tkey !== 'branch_id' &&\n\t\t\t\t\t\t\tkey !== 'department_id' &&\n\t\t\t\t\t\t\tkey !== 'job_id' &&\n\t\t\t\t\t\t\tkey !== 'job_item_id' &&\n\t\t\t\t\t\t\tkey !== 'punch_tag_id' &&\n\t\t\t\t\t\t\tkey !== 'branch' &&\n\t\t\t\t\t\t\tkey !== 'department' &&\n\t\t\t\t\t\t\tkey !== 'job' &&\n\t\t\t\t\t\t\tkey !== 'job_item' &&\n\t\t\t\t\t\t\tkey !== 'schedule_policy_id' ) {\n\n\t\t\t\t\t\t\ttarget_data[key] = temp_selected_data[key];\n\t\t\t\t\t\t\tnew_shift[key] = temp_target_data[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// When dragging an open shift to an empty cell in a user row with no branch column visible, the branch id value now defaults to user default branch id\n\t\t\t\t\ttarget_data.branch_id = target_data.branch ? target_data.branch_id : TTUUID.not_exist_id;\n\t\t\t\t\ttarget_data.department_id = target_data.department ? target_data.department_id : TTUUID.not_exist_id;\n\t\t\t\t\ttarget_data.job_id = target_data.job_id ? target_data.job_id : TTUUID.not_exist_id;\n\t\t\t\t\ttarget_data.job_item_id = target_data.job_item_id ? target_data.job_item_id : TTUUID.not_exist_id;\n\t\t\t\t\ttarget_data.punch_tag_id = target_data.punch_tag_id ? target_data.punch_tag_id : TTUUID.not_exist_id;\n\n\t\t\t\t\tnew_shifts_array.push( target_data );\n\t\t\t\t\tnew_shifts_array.push( new_shift );\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( new_shifts_array.length > 0 ) {\n\t\t\t\t$this.api.setSchedule( new_shifts_array, {\n\t\t\t\t\tonResult: function( res ) {\n\t\t\t\t\t\tif ( res && res.isValid() ) {\n\t\t\t\t\t\t\tif ( delete_old_items ) {\n\t\t\t\t\t\t\t\tif ( delete_shifts_array.length > 0 ) {\n\t\t\t\t\t\t\t\t\t$this.api.deleteSchedule( delete_shifts_array, {\n\t\t\t\t\t\t\t\t\t\tonResult: function() {\n\t\t\t\t\t\t\t\t\t\t\tif ( recurring_delete_shifts_array.length > 0 ) {\n\t\t\t\t\t\t\t\t\t\t\t\t$this.api.setSchedule( recurring_delete_shifts_array, {\n\t\t\t\t\t\t\t\t\t\t\t\t\tonResult: function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$this.search();\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t$this.search();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t\t} else if ( recurring_delete_shifts_array.length > 0 ) {\n\t\t\t\t\t\t\t\t\t$this.api.setSchedule( recurring_delete_shifts_array, {\n\t\t\t\t\t\t\t\t\t\tonResult: function() {\n\t\t\t\t\t\t\t\t\t\t\t$this.search();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t$this.search();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$this.search();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tTAlertManager.showErrorAlert( res );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\n\t\t} );\n\n\t\tcells.unbind( 'dragenter' ).bind( 'dragenter', function( event ) {\n\t\t\tevent.preventDefault();\n\t\t} );\n\n\t\tcells.unbind( 'dragover' ).bind( 'dragover', function( event ) {\n\t\t\tevent.preventDefault(); //Must prevent tihs\n\n\t\t} );\n\t\tcells.unbind( 'dragend' ).bind( 'dragend', function( event ) {\n\n\t\t\t$( '.drag-holder-div' ).remove();\n\t\t\t$( '.schedule-drag-over' ).removeClass( 'schedule-drag-over' );\n\n\t\t} );\n\t}\n\n\tresetSomeFields( item ) {\n\t\titem.branch_id = item.branch ? item.branch_id : '';\n\t\titem.department_id = item.department ? item.department_id : '';\n\t\titem.job_id = item.job ? item.job_id : '';\n\t\titem.job_item_id = item.job_item ? item.job_item_id : '';\n\t\titem.punch_tag_id = item.punch_tag_id ? item.punch_tag_id : [];\n\n\t\treturn item;\n\t}\n\n\t_createParametersForAdd() {\n\t\tvar result = [], user;\n\t\tif ( this.select_cells_Array.length > 0 ) {\n\t\t\tfor ( var i = 0, n = this.select_cells_Array.length; i < n; i++ ) {\n\t\t\t\tvar item = this.select_cells_Array[i];\n\t\t\t\tuser = {};\n\t\t\t\tuser.user_id = item.user_id;\n\t\t\t\tuser.branch_id = item.branch_id;\n\t\t\t\tuser.department_id = item.department_id;\n\t\t\t\tuser.job_id = item.job_id;\n\t\t\t\tuser.job_item_id = item.job_item_id;\n\t\t\t\tuser.punch_tag_id = item.punch_tag_id;\n\t\t\t\tuser.date = item.date;\n\t\t\t\tresult.push( user );\n\t\t\t}\n\t\t}\n\n\t\tif ( result.length < 1 ) {\n\t\t\tvar login_user = LocalCacheData.getLoginUser();\n\t\t\tuser = {};\n\t\t\tuser.user_id = login_user.id;\n\t\t\tuser.branch_id = login_user.branch_id;\n\t\t\tuser.department_id = login_user.department_id;\n\t\t\tuser.job_id = login_user.job_id;\n\t\t\tuser.job_item_id = login_user.job_item_id;\n\t\t\tuser.punch_tag_id = login_user.punch_tag_id;\n\t\t\tuser.date = this.getSelectDate();\n\t\t\tresult.push( user );\n\t\t}\n\t\treturn result;\n\t}\n\n\tonAddClick( doing_save_and_new ) {\n\n\t\tvar $this = this;\n\t\tthis.setCurrentEditViewState( 'new' );\n\n\t\tif ( this.select_cells_Array.length > 1 ) {\n\t\t\tthis.is_mass_adding = true;\n\t\t}\n\n\t\t$this.openEditView();\n\n\t\tvar args;\n\t\tif ( !doing_save_and_new ) {\n\t\t\targs = this._createParametersForAdd();\n\t\t} else {\n\t\t\targs = [\n\t\t\t\t{\n\t\t\t\t\tuser_id: this.current_edit_record.user_id,\n\t\t\t\t\tbranch_id: this.current_edit_record.branch_id,\n\t\t\t\t\tdepartment_id: this.current_edit_record.department_id,\n\t\t\t\t\tjob_id: this.current_edit_record.job_id,\n\t\t\t\t\tjob_item_id: this.current_edit_record.job_item_id,\n\t\t\t\t\tpunch_tag_id: this.current_edit_record.punch_tag_id,\n\t\t\t\t\tdate: this.current_edit_record.date_stamp\n\t\t\t\t}\n\t\t\t];\n\t\t}\n\n\t\tthis.api['get' + this.api.key_name + 'DefaultData']( args, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tvar select_shift;\n\t\t\t\tvar result_data = result.getResult();\n\n\t\t\t\tselect_shift = result_data;\n\t\t\t\tif ( $this.select_cells_Array.length >= 1 ) {\n\t\t\t\t\tfor ( var i = 0, n = args.length; i < n; i++ ) {\n\t\t\t\t\t\tvar item = args[i];\n\t\t\t\t\t\tif ( i == 0 ) {\n\t\t\t\t\t\t\tselect_shift.branch_id = item.branch_id;\n\t\t\t\t\t\t\tselect_shift.department_id = item.department_id;\n\t\t\t\t\t\t\tselect_shift.job_id = item.job_id;\n\t\t\t\t\t\t\tselect_shift.job_item_id = item.job_item_id;\n\t\t\t\t\t\t\tselect_shift.punch_tag_id = item.punch_tag_id;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t( select_shift.branch_id !== item.branch_id && select_shift.branch_id !== '-2' ) ? select_shift.branch_id = '-2' : item.branch_id;\n\t\t\t\t\t\t\t( select_shift.department_id !== item.department_id && select_shift.department_id !== '-2' ) ? select_shift.department_id = '-2' : item.department_id;\n\t\t\t\t\t\t\t( select_shift.job_id !== item.job_id && select_shift.job_id !== '-2' ) ? select_shift.job_id = '-2' : item.job_id;\n\t\t\t\t\t\t\t( select_shift.job_item_id !== item.job_item_id && select_shift.job_item_id !== '-2' ) ? select_shift.job_item_id = '-2' : item.job_item_id;\n\t\t\t\t\t\t\t( select_shift.punch_tag_id !== item.punch_tag_id && select_shift.punch_tag_id !== '-2' ) ? select_shift.punch_tag_id = '-2' : item.punch_tag_id;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( !doing_save_and_new ) {\n\t\t\t\t\tselect_shift.date_stamp = $this.getSelectDate();\n\n\t\t\t\t} else {\n\t\t\t\t\tvar temp_date = Global.strToDate( $this.current_edit_record.date_stamp );\n\t\t\t\t\tselect_shift.date_stamp = new Date( new Date( temp_date.getTime() ).setDate( temp_date.getDate() + 1 ) ).format();\n\n\t\t\t\t}\n\n\t\t\t\tif ( !select_shift.start_date_stamp ) {\n\t\t\t\t\tselect_shift.start_date_stamp = select_shift.date_stamp;\n\t\t\t\t}\n\n\t\t\t\tselect_shift.id = '';\n\n\t\t\t\tif ( $this.sub_view_mode && $this.parent_key ) {\n\t\t\t\t\tresult_data[$this.parent_key] = $this.parent_value;\n\t\t\t\t}\n\n\t\t\t\t$this.current_edit_record = select_shift;\n\t\t\t\t$this.initEditView();\n\n\t\t\t}\n\t\t} );\n\t}\n\n\topenEditView() {\n\n\t\tif ( !this.edit_view ) {\n\t\t\tthis.initEditViewUI( 'Schedule', 'ScheduleEditView.html' );\n\t\t}\n\t\tthis.previous_absence_policy_id = false;\n\t}\n\n\t//set widget disablebility if view mode or edit mode\n\tsetEditViewWidgetsMode() {\n\t\tvar did_clean_dic = {};\n\t\tfor ( var key in this.edit_view_ui_dic ) {\n\t\t\tif ( !this.edit_view_ui_dic.hasOwnProperty( key ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tvar widget = this.edit_view_ui_dic[key];\n\t\t\twidget.css( 'opacity', 1 );\n\t\t\tvar column = widget.parent().parent().parent();\n\t\t\tvar tab_id = column.parent().attr( 'id' );\n\t\t\tif ( !column.hasClass( 'v-box' ) ) {\n\t\t\t\tif ( !did_clean_dic[tab_id] ) {\n\t\t\t\t\tdid_clean_dic[tab_id] = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ( this.is_viewing ) {\n\t\t\t\tif ( Global.isSet( widget.setEnabled ) ) {\n\t\t\t\t\twidget.setEnabled( false );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif ( Global.isSet( widget.setEnabled ) ) {\n\t\t\t\t\twidget.setEnabled( true );\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n\n\tsetJobValueWhenUserChanged( job, job_id_col_name, filter_data ) {\n\t\tvar $this = this;\n\n\t\t//Error: Uncaught TypeError: Cannot set property 'job_item_id' of null in /interface/html5/#!m=TimeSheet&date=20150126&user_id=54286 line 6785\n\t\tif ( !$this.current_edit_record ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( this.edit_view_ui_dic['user_ids'] && this.edit_view_ui_dic['user_ids'].is( ':visible' ) ) {\n\t\t\tfilter_data['user_id'] = this.edit_view_ui_dic['user_ids'].getValue();\n\n\t\t\t//If more than one user is selected, don't filter by user_id at all, show all jobs and let the validation system handle it.\n\t\t\tif ( filter_data['user_id'].length == 1 ) {\n\t\t\t\tfilter_data['user_id'] = filter_data['user_id'][0];\n\t\t\t} else {\n\t\t\t\tfilter_data['user_id'] = false;\n\t\t\t}\n\t\t} else {\n\t\t\tfilter_data['user_id'] = this.current_edit_record['user_id'];\n\t\t}\n\n\t\tvar job_widget = $this.edit_view_ui_dic[job_id_col_name];\n\t\tvar current_job_id = job_widget.getValue();\n\t\tjob_widget.setSourceData( null ); //Clear out source data so its reloaded when the Job dropdown is expanded again.\n\t\tjob_widget.setCheckBox( true );\n\t\tthis.edit_view_ui_dic['job_item_quick_search'].setCheckBox( true );\n\n\t\tvar args = {};\n\t\targs.filter_data = filter_data;\n\t\t$this.edit_view_ui_dic[job_id_col_name].setDefaultArgs( args );\n\n\t\treturn;\n\t}\n\n\tonFormItemChange( target, doNotValidate ) {\n\t\tvar $this = this;\n\t\tthis.setIsChanged( target );\n\t\tthis.setMassEditingFieldsWhenFormChange( target );\n\t\tvar key = target.getField();\n\t\tvar c_value = target.getValue();\n\t\tthis.current_edit_record[key] = c_value;\n\n\t\tswitch ( key ) {\n\t\t\tcase 'job_id':\n\t\t\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\t\t\tthis.edit_view_ui_dic['job_quick_search'].setValue( target.getValue( true ) ? ( target.getValue( true ).manual_id ? target.getValue( true ).manual_id : '' ) : '' );\n\t\t\t\t\tthis.setJobItemValueWhenJobChanged( target.getValue( true ), 'job_item_id', {\n\t\t\t\t\t\tstatus_id: 10,\n\t\t\t\t\t\tjob_id: this.current_edit_record.job_id\n\t\t\t\t\t} );\n\t\t\t\t\tthis.edit_view_ui_dic['job_quick_search'].setCheckBox( true );\n\t\t\t\t\tthis.setPunchTagValuesWhenCriteriaChanged( this.getPunchTagFilterData(), 'punch_tag_id' );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'job_item_id':\n\t\t\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\t\t\tthis.edit_view_ui_dic['job_item_quick_search'].setValue( target.getValue( true ) ? ( target.getValue( true ).manual_id ? target.getValue( true ).manual_id : '' ) : '' );\n\t\t\t\t\tthis.edit_view_ui_dic['job_item_quick_search'].setCheckBox( true );\n\t\t\t\t\tthis.setPunchTagValuesWhenCriteriaChanged( this.getPunchTagFilterData(), 'punch_tag_id' );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'punch_tag_id':\n\t\t\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\t\t\tif ( c_value !== TTUUID.zero_id && c_value !== false && c_value.length > 0 ) {\n\t\t\t\t\t\tthis.setPunchTagQuickSearchManualIds( target.getSelectItems() );\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.edit_view_ui_dic['punch_tag_quick_search'].setValue( '' );\n\t\t\t\t\t}\n\t\t\t\t\t$this.previous_punch_tag_selection = c_value;\n\t\t\t\t\t//Reset source data to make sure correct punch tags are always shown.\n\t\t\t\t\tthis.edit_view_ui_dic['punch_tag_id'].setSourceData( null );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'branch_id':\n\t\t\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\t\t\tthis.setPunchTagValuesWhenCriteriaChanged( this.getPunchTagFilterData(), 'punch_tag_id' );\n\t\t\t\t\tthis.setJobValueWhenCriteriaChanged( 'job_id', {\n\t\t\t\t\t\tstatus_id: 10,\n\t\t\t\t\t\tuser_id: this.current_edit_record.user_id,\n\t\t\t\t\t\tpunch_branch_id: this.current_edit_record.branch_id,\n\t\t\t\t\t\tpunch_department_id: this.current_edit_record.department_id\n\t\t\t\t\t} );\n\t\t\t\t\tthis.setDepartmentValueWhenBranchChanged( target.getValue( true ), 'department_id', {\n\t\t\t\t\t\tbranch_id: this.current_edit_record.branch_id,\n\t\t\t\t\t\tuser_id:   this.current_edit_record.user_id\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'department_id':\n\t\t\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\t\t\tthis.setPunchTagValuesWhenCriteriaChanged( this.getPunchTagFilterData(), 'punch_tag_id' );\n\t\t\t\t\tthis.setJobValueWhenCriteriaChanged( 'job_id', {\n\t\t\t\t\t\tstatus_id: 10,\n\t\t\t\t\t\tuser_id: this.current_edit_record.user_id,\n\t\t\t\t\t\tpunch_branch_id: this.current_edit_record.branch_id,\n\t\t\t\t\t\tpunch_department_id: this.current_edit_record.department_id\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'job_quick_search':\n\t\t\tcase 'job_item_quick_search':\n\t\t\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\t\t\tthis.onJobQuickSearch( key, c_value );\n\t\t\t\t\tthis.setPunchTagValuesWhenCriteriaChanged( this.getPunchTagFilterData(), 'punch_tag_id' );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'punch_tag_quick_search':\n\t\t\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\t\t\tthis.onPunchTagQuickSearch( c_value, this.getPunchTagFilterData(), 'punch_tag_id' );\n\n\t\t\t\t\t//Don't validate immediately as onPunchTagQuickSearch is doing async API calls, and it would cause a guaranteed validation failure.\n\t\t\t\t\tdoNotValidate = true;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'status_id':\n\t\t\t\tthis.onTypeChange( true );\n\t\t\t\tbreak;\n\t\t\tcase 'user_id':\n\t\t\tcase 'user_ids':\n\t\t\t\tthis.setEditMenu();\n\n\t\t\t\tthis.setAbsencePolicyWhenUserChanged();\n\n\t\t\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\t\t\tif ( this.edit_view_ui_dic['job_id'] ) {\n\t\t\t\t\t\tthis.setJobValueWhenUserChanged( this.edit_view_ui_dic['job_id'].getValue( true ), 'job_id', {\n\t\t\t\t\t\t\tstatus_id: 10,\n\t\t\t\t\t\t\tuser_id: this.edit_view_ui_dic[key].getValue(),\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.setPunchTagValuesWhenCriteriaChanged( this.getPunchTagFilterData(), 'punch_tag_id' );\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\tcase 'start_date_stamps':\n\t\t\t\tthis.setEditMenu();\n\t\t\t\tthis.current_edit_record['start_date_stamp'] = c_value;\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tif ( key == 'absence_policy_id' ) {\n\t\t\tthis.previous_absence_policy_id = this.current_edit_record.absence_policy_id;\n\t\t}\n\n\t\tif ( key === 'date_stamp' ||\n\t\t\tkey === 'start_date_stamps' ||\n\t\t\tkey === 'start_date_stamp' ||\n\t\t\tkey === 'start_time' ||\n\t\t\tkey === 'end_time' ||\n\t\t\tkey === 'schedule_policy_id' ||\n\t\t\tkey === 'absence_policy_id' ) {\n\n\t\t\tif ( this.current_edit_record['date_stamp'] !== '' &&\n\t\t\t\tthis.current_edit_record['start_time'] !== '' &&\n\t\t\t\tthis.current_edit_record['end_time'] !== '' ) {\n\n\t\t\t\tvar startTime = this.current_edit_record['date_stamp'] + ' ' + this.current_edit_record['start_time'];\n\t\t\t\tvar endTime = this.current_edit_record['date_stamp'] + ' ' + this.current_edit_record['end_time'];\n\t\t\t\tvar schedulePolicyId = this.current_edit_record['schedule_policy_id'];\n\t\t\t\tvar user_id = this.current_edit_record.user_id;\n\n\t\t\t\tthis.api.getScheduleTotalTime( startTime, endTime, schedulePolicyId, user_id, {\n\t\t\t\t\tonResult: function( total_time ) {\n\n\t\t\t\t\t\t//Uncaught TypeError: Cannot set property 'total_time' of null\n\t\t\t\t\t\t//Error: Uncaught TypeError: Cannot read property 'setValue' of undefined in interface/html5/#!m=Schedule&date=20160202&mode=week&a=new&tab=Schedule line 1799\n\t\t\t\t\t\tif ( !$this.edit_view || !$this.current_edit_record || !$this.edit_view_ui_dic['total_time'] ) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t//Fixed exception that total_time is null\n\t\t\t\t\t\tif ( total_time && total_time.isValid() && total_time.getResult() ) {\n\t\t\t\t\t\t\ttotal_time = total_time.getResult();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttotal_time = $this.current_edit_record.total_time ? $this.current_edit_record.total_time : 0;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$this.current_edit_record.total_time = total_time;\n\t\t\t\t\t\ttotal_time = Global.getTimeUnit( total_time );\n\t\t\t\t\t\t$this.edit_view_ui_dic['total_time'].setValue( total_time );\n\n\t\t\t\t\t\t$this.onAvailableBalanceChange();\n\n\t\t\t\t\t}\n\t\t\t\t} );\n//\n\n\t\t\t} else {\n\t\t\t\tthis.onAvailableBalanceChange();\n\t\t\t}\n\n\t\t}\n\n\t\tif ( !doNotValidate ) {\n\t\t\tthis.validate();\n\t\t}\n\t}\n\n\tsetAbsencePolicyWhenUserChanged() {\n\n\t\tvar $this = this;\n\t\tvar absence_widget = $this.edit_view_ui_dic['absence_policy_id'];\n\t\tabsence_widget.setSourceData( null );\n\t\tvar old_value = absence_widget.getValue();\n\n\t\tvar args = {};\n\t\targs.filter_data = { id: old_value };\n\n\t\targs = this.setAbsencePolicyFilter( args );\n\n\t\tif ( old_value ) {\n\n\t\t\t$this.absence_policy_api.getAbsencePolicy( args, {\n\t\t\t\tonResult: function( task_result ) {\n\n\t\t\t\t\t// Returning early to help mitigate #2889 - \"Error: Uncaught TypeError: Cannot set property 'absence_policy_id' of null\"\n\t\t\t\t\t// This can happen when the user saves or leaves the page before the API call is completed.\n\t\t\t\t\tif ( $this.current_edit_record === null || $this.current_edit_record === undefined ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar data = task_result.getResult();\n\n\t\t\t\t\tif ( data.length > 0 ) {\n\t\t\t\t\t\tabsence_widget.setValue( old_value );\n\t\t\t\t\t\t$this.current_edit_record.absence_policy_id = old_value;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tabsence_widget.setValue( false );\n\t\t\t\t\t\t$this.current_edit_record.absence_policy_id = false;\n\t\t\t\t\t}\n\t\t\t\t\t$this.onAvailableBalanceChange();\n\t\t\t\t\t$this.validate();\n\n\t\t\t\t}\n\t\t\t} );\n\t\t} else {\n\t\t\tthis.onAvailableBalanceChange();\n\t\t\tthis.validate();\n\t\t}\n\t}\n\n\t//Make sure this.current_edit_record is updated before validate\n\tvalidate() {\n\t\tvar $this = this;\n\t\tvar record = {};\n\t\tif ( this.is_mass_adding ) {\n\t\t\trecord = [];\n\t\t\t$.each( this.select_cells_Array, function( index, value ) {\n\t\t\t\tif ( value.hasOwnProperty( 'user_id' ) && value.hasOwnProperty( 'date' ) && value.date ) {\n\t\t\t\t\tvar commonRecord = Global.clone( $this.current_edit_record );\n\t\t\t\t\tdelete commonRecord.user_ids;\n\t\t\t\t\tdelete commonRecord.start_dates;\n\t\t\t\t\tcommonRecord.id = '';\n\t\t\t\t\tcommonRecord.user_id = value.user_id;\n\t\t\t\t\tcommonRecord.start_date_stamp = value.date;\n\t\t\t\t\tcommonRecord = $this.buildMassAddRecord( commonRecord );\n\t\t\t\t\trecord.push( commonRecord );\n\t\t\t\t}\n\t\t\t} );\n\t\t} else if ( this.is_mass_editing ) {\n\t\t\tfor ( var key in this.edit_view_ui_dic ) {\n\t\t\t\tif ( !this.edit_view_ui_dic.hasOwnProperty( key ) ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tvar widget = this.edit_view_ui_dic[key];\n\t\t\t\tif ( Global.isSet( widget.isChecked ) ) {\n\t\t\t\t\tif ( widget.isChecked() && widget.getEnabled() ) {\n\t\t\t\t\t\trecord[key] = widget.getValue();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( this.mass_edit_record_ids.length > 0 ) {\n\t\t\t\tvar checkFields = record;\n\t\t\t\trecord = [];\n\t\t\t\t$.each( this.mass_edit_record_ids, function( index, value ) {\n\t\t\t\t\tvar commonRecord = Global.clone( checkFields );\n\t\t\t\t\tcommonRecord.id = value;\n\t\t\t\t\tcommonRecord = $this.processAddRecord( commonRecord );\n\t\t\t\t\trecord.push( commonRecord );\n\t\t\t\t} );\n\t\t\t\t$.each( this.select_all_shifts_array, function( index, value ) {\n\t\t\t\t\tif ( !value.id || value.id == TTUUID.zero_id ) {\n\t\t\t\t\t\tvar commonRecord = Global.clone( value );\n\t\t\t\t\t\tfor ( var key in checkFields ) {\n\t\t\t\t\t\t\tcommonRecord[key] = checkFields[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcommonRecord = $this.processAddRecord( commonRecord );\n\t\t\t\t\t\trecord.push( commonRecord );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t\trecord = this.getRecordsFromUserIDs( record );\n\t\t\t} else {\n\t\t\t\tvar record_array = [];\n\t\t\t\t$.each( this.select_all_shifts_array, function( index, value ) {\n\t\t\t\t\tif ( !value.id || value.id == TTUUID.zero_id ) {\n\t\t\t\t\t\tvar commonRecord = Global.clone( value );\n\t\t\t\t\t\tfor ( var key in record ) {\n\t\t\t\t\t\t\tcommonRecord[key] = record[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcommonRecord = $this.processAddRecord( commonRecord );\n\t\t\t\t\t\trecord_array.push( commonRecord );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t\tif ( record_array.length < 1 ) {\n\t\t\t\t\tif ( this.select_cells_Array.length > 0 ) {\n\t\t\t\t\t\t$this.processAddRecord( record );\n\t\t\t\t\t\trecord = this.getRecordsFromUserIDs( [record] );\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\trecord = record_array;\n\t\t\t\t\trecord = this.getRecordsFromUserIDs( record );\n\t\t\t\t}\n\t\t\t}\n\n\t\t} else {\n\t\t\t//Error: Uncaught TypeError: Cannot read property 'indexOf' of undefined in interface/html5/#!m=Schedule&date=20151204&mode=day line 1954\n\t\t\tif ( this.current_edit_record && this.current_edit_record.start_date_stamp &&\n\t\t\t\t( this.current_edit_record.start_date_stamp.indexOf( ' - ' ) > 0 ||\n\t\t\t\t\t$.type( this.current_edit_record.start_date_stamp ) === 'array' ) ) {\n\t\t\t\tif ( this.current_edit_record.start_date_stamp.indexOf( ' - ' ) > 0 ) {\n\t\t\t\t\tthis.current_edit_record.start_date_stamp = this.parserDatesRange( this.current_edit_record.start_date_stamp );\n\t\t\t\t}\n\t\t\t\trecord = [];\n\t\t\t\tfor ( var i = 0; i < this.current_edit_record.start_date_stamp.length; i++ ) {\n\t\t\t\t\tvar commonRecord = Global.clone( $this.current_edit_record );\n\t\t\t\t\tcommonRecord.start_date_stamp = this.current_edit_record.start_date_stamp[i];\n\t\t\t\t\tif ( this.select_cells_Array.length > 0 ) {\n\t\t\t\t\t\t$this.processAddRecord( commonRecord );\n\t\t\t\t\t}\n\t\t\t\t\trecord.push( commonRecord );\n\t\t\t\t}\n\t\t\t\trecord = this.getRecordsFromUserIDs( record );\n\t\t\t} else {\n\t\t\t\trecord = Global.clone( this.current_edit_record );\n\t\t\t\tif ( this.select_cells_Array.length > 0 ) {\n\t\t\t\t\t$this.processAddRecord( record );\n\t\t\t\t}\n\t\t\t\trecord = this.getRecordsFromUserIDs( [record] );\n\t\t\t}\n\n\t\t}\n\t\tthis.api['validate' + this.api.key_name]( record, {\n\t\t\tonResult: function( result ) {\n\t\t\t\t$this.validateResult( result );\n\t\t\t}\n\t\t} );\n\t}\n\n\tgetRecordsFromUserIDs( record ) {\n\t\tvar result = [];\n\n\t\tfor ( var j = 0; j < record.length; j++ ) {\n\t\t\tvar common_record = record[j];\n\n\t\t\tif ( common_record.user_ids && common_record.user_ids.length > 0 ) {\n\t\t\t\tfor ( var y = 0; y < common_record.user_ids.length; y++ ) {\n\t\t\t\t\tvar user_id = common_record.user_ids[y];\n\t\t\t\t\tif ( Global.isObject( user_id ) && user_id.id ) {\n\t\t\t\t\t\tuser_id = user_id.id;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar new_common_record = Global.clone( common_record );\n\t\t\t\t\tnew_common_record.user_id = user_id;\n\t\t\t\t\tresult.push( new_common_record );\n\n\t\t\t\t}\n\t\t\t} else {\n\n\t\t\t\tif ( ( !this.current_edit_record || !this.current_edit_record.id || this.current_edit_record.id == TTUUID.zero_id ) && !this.is_mass_editing ) {\n\t\t\t\t\tcommon_record.user_id = TTUUID.zero_id;\n\t\t\t\t}\n\n\t\t\t\tresult.push( common_record );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tonSaveAndCopy( ignoreWarning ) {\n\t\tvar $this = this;\n\t\tif ( !Global.isSet( ignoreWarning ) ) {\n\t\t\tignoreWarning = false;\n\t\t}\n\t\tthis.is_add = true;\n\t\tthis.is_changed = false;\n\t\tLocalCacheData.current_doing_context_action = 'save_and_copy';\n\t\tvar record = this.current_edit_record;\n\t\trecord = this.processAddRecord( record );\n\t\trecord = this.getRecordsFromUserIDs( [record] );\n\n\t\tif ( this.current_edit_record.start_date_stamp.indexOf( ' - ' ) > 0 ||\n\t\t\t$.type( this.current_edit_record.start_date_stamp ) === 'array' ) {\n\n\t\t\tif ( this.current_edit_record.start_date_stamp.indexOf( ' - ' ) > 0 ) {\n\t\t\t\tthis.current_edit_record.start_date_stamp = this.parserDatesRange( this.current_edit_record.start_date_stamp );\n\t\t\t}\n\n\t\t\trecord = [];\n\t\t\tfor ( var i = 0; i < this.current_edit_record.start_date_stamp.length; i++ ) {\n\t\t\t\tvar commonRecord = Global.clone( $this.current_edit_record );\n\t\t\t\tcommonRecord.start_date_stamp = this.current_edit_record.start_date_stamp[i];\n\t\t\t\tcommonRecord = this.processAddRecord( commonRecord );\n\t\t\t\trecord.push( commonRecord );\n\t\t\t}\n\t\t\trecord = this.getRecordsFromUserIDs( record );\n\t\t}\n\n\t\tthis.clearNavigationData();\n\t\tthis.api['set' + this.api.key_name]( record, false, false, ignoreWarning, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tif ( $this.current_edit_record ) {\n\t\t\t\t\tvar current_date_str = $this.current_edit_record.start_date_stamp;\n\n\t\t\t\t\tif ( $.type( current_date_str ) === 'array' ) {\n\t\t\t\t\t\tcurrent_date_str = current_date_str[current_date_str.length - 1];\n\t\t\t\t\t}\n\n\t\t\t\t\tvar current_date = Global.strToDate( current_date_str );\n\t\t\t\t\tvar next_date = new Date( new Date( current_date.getTime() ).setDate( current_date.getDate() + 1 ) );\n\n\t\t\t\t\t$this.current_edit_record.start_date_stamp = next_date.format();\n\n\t\t\t\t\t$this.onSaveAndCopyResult( result );\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t}\n\n\tonSaveAndNewClick( ignoreWarning ) {\n\t\tvar $this = this;\n\t\tif ( !Global.isSet( ignoreWarning ) ) {\n\t\t\tignoreWarning = false;\n\t\t}\n\t\tthis.setCurrentEditViewState( 'new' );\n\t\tvar record = this.current_edit_record;\n\t\trecord = this.processAddRecord( record );\n\t\trecord = this.getRecordsFromUserIDs( [record] );\n\n\t\tif ( this.current_edit_record.start_date_stamp.indexOf( ' - ' ) > 0 ||\n\t\t\t$.type( this.current_edit_record.start_date_stamp ) === 'array' ) {\n\n\t\t\tif ( this.current_edit_record.start_date_stamp.indexOf( ' - ' ) > 0 ) {\n\t\t\t\tthis.current_edit_record.start_date_stamp = this.parserDatesRange( this.current_edit_record.start_date_stamp );\n\t\t\t}\n\n\t\t\trecord = [];\n\t\t\tfor ( var i = 0; i < this.current_edit_record.start_date_stamp.length; i++ ) {\n\t\t\t\tvar commonRecord = Global.clone( $this.current_edit_record );\n\t\t\t\tcommonRecord.start_date_stamp = this.current_edit_record.start_date_stamp[i];\n\t\t\t\tcommonRecord = this.processAddRecord( commonRecord );\n\t\t\t\trecord.push( commonRecord );\n\t\t\t}\n\t\t\trecord = this.getRecordsFromUserIDs( record );\n\t\t}\n\n\t\tthis.api['set' + this.api.key_name]( record, false, ignoreWarning, {\n\t\t\tonResult: function( result ) {\n\t\t\t\t$this.onSaveAndNewResult( result );\n\t\t\t}\n\t\t} );\n\t}\n\n\tbuildSelectedCellsRecord() {\n\t\tvar $this = this;\n\t\tvar retval = [];\n\t\t$.each( this.select_cells_Array, function( index, value ) {\n\t\t\tif ( value.hasOwnProperty( 'user_id' ) && value.hasOwnProperty( 'date' ) && value.date ) {\n\t\t\t\tvar commonRecord = Global.clone( $this.current_edit_record );\n\t\t\t\tdelete commonRecord.user_ids;\n\t\t\t\tdelete commonRecord.start_dates;\n\t\t\t\tcommonRecord.id = '';\n\t\t\t\tcommonRecord.user_id = value.user_id;\n\t\t\t\tcommonRecord.start_date_stamp = value.date;\n\t\t\t\tcommonRecord = $this.buildMassAddRecord( commonRecord );\n\n\t\t\t\tretval.push( commonRecord );\n\t\t\t}\n\n\t\t} );\n\n\t\treturn retval;\n\t}\n\n\tbuildMassAddRecord( record ) {\n\t\tvar massAddArgs = this._createParametersForAdd();\n\t\tfor ( var i = 0, n = massAddArgs.length; i < n; i++ ) {\n\t\t\tvar item = massAddArgs[i];\n\t\t\tif ( record.user_id === item.user_id ) {\n\t\t\t\trecord.branch_id == '-2' ? ( record.branch_id = item.branch_id ) : record.branch_id;\n\t\t\t\trecord.department_id == '-2' ? ( record.department_id = item.department_id ) : record.department_id;\n\t\t\t\trecord.job_id == '-2' ? ( record.job_id = item.job_id ) : record.job_id;\n\t\t\t\trecord.job_item_id == '-2' ? ( record.job_item_id = item.job_item_id ) : record.job_item_id;\n\t\t\t\trecord.punch_tag_id == '-2' ? ( record.punch_tag_id = item.punch_tag_id ) : record.punch_tag_id;\n\t\t\t}\n\t\t}\n\t\treturn record;\n\t}\n\n\tprocessAddRecord( record ) {\n\t\tvar massAddArgs = this._createParametersForAdd();\n\t\tfor ( var i = 0, n = massAddArgs.length; i < n; i++ ) {\n\t\t\tvar item = massAddArgs[i];\n\t\t\trecord.branch_id == '-2' ? ( record.branch_id = item.branch_id ) : record.branch_id;\n\t\t\trecord.department_id == '-2' ? ( record.department_id = item.department_id ) : record.department_id;\n\t\t\trecord.job_id == '-2' ? ( record.job_id = item.job_id ) : record.job_id;\n\t\t\trecord.job_item_id == '-2' ? ( record.job_item_id = item.job_item_id ) : record.job_item_id;\n\t\t\trecord.punch_tag_id == '-2' ? ( record.punch_tag_id = item.punch_tag_id ) : record.punch_tag_id;\n\t\t\tbreak;\n\t\t}\n\t\treturn record;\n\t}\n\n\tgetSelectedId( record, field, massAddArgs ) {\n\t\tfor ( var i = 0, n = massAddArgs.length; i < n; i++ ) {\n\t\t\tvar item = massAddArgs[i];\n\t\t\tif ( record.user_id === item.user_id ) {\n\t\t\t\trecord[field] = item[field];\n\t\t\t}\n\t\t}\n\t}\n\n\tonSaveAndContinue( ignoreWarning ) {\n\t\tvar $this = this;\n\t\tif ( !Global.isSet( ignoreWarning ) ) {\n\t\t\tignoreWarning = false;\n\t\t}\n\t\tthis.is_changed = false;\n\t\tthis.is_add = false;\n\t\tLocalCacheData.current_doing_context_action = 'save_and_continue';\n\t\tvar record = this.current_edit_record;\n\t\trecord = this.processAddRecord( record );\n\t\trecord = this.uniformVariable( record );\n\n\t\tif ( this.current_edit_record.start_date_stamp && ( this.current_edit_record.start_date_stamp.indexOf( ' - ' ) > 0 || $.type( this.current_edit_record.start_date_stamp ) === 'array' ) ) {\n\t\t\tif ( this.current_edit_record.start_date_stamp.indexOf( ' - ' ) > 0 ) {\n\t\t\t\tthis.current_edit_record.start_date_stamp = this.parserDatesRange( this.current_edit_record.start_date_stamp );\n\t\t\t}\n\n\t\t\trecord = [];\n\t\t\tfor ( var i = 0; i < this.current_edit_record.start_date_stamp.length; i++ ) {\n\t\t\t\tvar commonRecord = Global.clone( $this.current_edit_record );\n\t\t\t\tcommonRecord.start_date_stamp = this.current_edit_record.start_date_stamp[i];\n\t\t\t\tcommonRecord = this.processAddRecord( commonRecord );\n\t\t\t\trecord.push( commonRecord );\n\t\t\t}\n\t\t\trecord = this.getRecordsFromUserIDs( record );\n\t\t} else {\n\t\t\trecord = this.getRecordsFromUserIDs( [record] );\n\t\t}\n\n\t\tthis.api['set' + this.api.key_name]( record, false, ignoreWarning, {\n\t\t\tonResult: function( result ) {\n\t\t\t\t$this.previous_absence_policy_id = false;\n\t\t\t\t$this.onSaveAndContinueResult( result );\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tonSaveClick( ignoreWarning ) {\n\t\tvar $this = this;\n\t\tvar record;\n\t\tif ( !Global.isSet( ignoreWarning ) ) {\n\t\t\tignoreWarning = false;\n\t\t}\n\t\tLocalCacheData.current_doing_context_action = 'save';\n\n\t\tif ( this.is_mass_adding ) {\n\t\t\trecord = this.buildSelectedCellsRecord();\n\t\t} else if ( this.is_mass_editing ) {\n\n\t\t\tvar checkFields = this.getChangedFields();\n\n\t\t\trecord = [];\n\n\t\t\t$.each( this.mass_edit_record_ids, function( index, value ) {\n\t\t\t\tvar commonRecord = Global.clone( checkFields );\n\t\t\t\tcommonRecord.id = value;\n\t\t\t\tcommonRecord = $this.processAddRecord( commonRecord );\n\t\t\t\trecord.push( commonRecord );\n\n\t\t\t} );\n\n\t\t\t$.each( this.select_all_shifts_array, function( index, value ) {\n\t\t\t\tif ( !value.id || value.id == TTUUID.zero_id ) {\n\t\t\t\t\tvar commonRecord = Global.clone( value );\n\t\t\t\t\tfor ( var key in checkFields ) {\n\t\t\t\t\t\tcommonRecord[key] = checkFields[key];\n\t\t\t\t\t}\n\t\t\t\t\tcommonRecord = $this.processAddRecord( commonRecord );\n\t\t\t\t\trecord.push( commonRecord );\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t} else if ( this.current_edit_record.start_date_stamp.indexOf( ' - ' ) > 0 ||\n\t\t\t$.type( this.current_edit_record.start_date_stamp ) === 'array' ) {\n\n\t\t\tif ( this.current_edit_record.start_date_stamp.indexOf( ' - ' ) > 0 ) {\n\t\t\t\tthis.current_edit_record.start_date_stamp = this.parserDatesRange( this.current_edit_record.start_date_stamp );\n\t\t\t}\n\n\t\t\trecord = [];\n\t\t\tfor ( var i = 0; i < this.current_edit_record.start_date_stamp.length; i++ ) {\n\t\t\t\tvar commonRecord = Global.clone( $this.current_edit_record );\n\t\t\t\tcommonRecord.start_date_stamp = this.current_edit_record.start_date_stamp[i];\n\t\t\t\tcommonRecord = $this.processAddRecord( commonRecord );\n\t\t\t\trecord.push( commonRecord );\n\t\t\t}\n\n\t\t\trecord = this.getRecordsFromUserIDs( record );\n\n\t\t} else {\n\n\t\t\trecord = this.current_edit_record;\n\t\t\trecord = $this.processAddRecord( record );\n\t\t\trecord = this.getRecordsFromUserIDs( [record] );\n\n\t\t}\n\n\t\tthis.api['set' + this.api.key_name]( record, false, ignoreWarning, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tif ( result && result.isValid() ) {\n\t\t\t\t\tvar result_data = result.getResult();\n\t\t\t\t\t//#2571 - Cannot read property 'id' of null\n\t\t\t\t\tif ( result_data === true && $this.current_edit_record ) {\n\t\t\t\t\t\t$this.refresh_id = $this.current_edit_record.id;\n\t\t\t\t\t} else if ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) {\n\t\t\t\t\t\t$this.refresh_id = result_data;\n\t\t\t\t\t}\n\t\t\t\t\t$this.search( false, false );\n\t\t\t\t\t$this.previous_absence_policy_id = false;\n\n\t\t\t\t\t$this.removeEditView();\n\n\t\t\t\t} else {\n\t\t\t\t\t//BUG#2073 - Pulled out the error message box that was showing the result array as its \"toString\" representation. ([object][object]);\n\t\t\t\t\t$this.setErrorTips( result );\n\t\t\t\t\t$this.setErrorMenu();\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tremoveEditView() {\n\t\tsuper.removeEditView();\n\n\t\tthis.setMoveOrDropMode( this.select_drag_menu_id ? this.select_drag_menu_id : 'move' );\n\t\tthis.selected_user_ids = [];\n\t\tthis.is_mass_adding = false;\n\t}\n\n\tsetEditMenuSaveAndContinueIcon( context_btn ) {\n\t\tthis.saveAndContinueValidate( context_btn );\n\n\t\tif ( this.is_mass_editing || this.is_viewing || this.is_mass_adding || this.isMassEmployeeOrDate() ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tisMassEmployeeOrDate() {\n\n\t\tif ( this.current_edit_record && this.current_edit_record.start_date_stamps && ( this.current_edit_record.start_date_stamps.indexOf( ' - ' ) > 0 ||\n\t\t\t$.type( this.current_edit_record.start_date_stamps ) === 'array' && this.current_edit_record.start_date_stamps.length > 1\n\t\t) ) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif ( this.current_edit_record && this.current_edit_record.user_ids && this.current_edit_record.user_ids.length > 1 ) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tsetEditMenuSaveAndAddIcon( context_btn ) {\n\t\tthis.saveAndNewValidate( context_btn );\n\n\t\tif ( this.is_viewing || this.is_mass_editing || this.is_mass_adding ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tsetEditMenuSaveAndCopyIcon( context_btn ) {\n\t\tthis.saveAndCopyValidate( context_btn );\n\n\t\tif ( this.is_viewing || this.is_mass_editing || this.is_mass_adding ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tonTypeChange( getRate ) {\n\t\tif ( this.current_edit_record.status_id == 20 ) {\n\t\t\tthis.attachElement( 'absence_policy_id' );\n\t\t} else {\n\t\t\tthis.detachElement( 'absence_policy_id' );\n\t\t}\n\t}\n\n\tsetEditViewData() {\n\n\t\tvar $this = this;\n\t\tsuper.setEditViewData(); //Set Navigation\n\t\t$this.onTypeChange( false );\n\t}\n\n\tcheckOpenPermission() {\n\t\tif ( Global.getProductEdition() >= 15 && PermissionManager.validate( 'schedule', 'view_open' ) ) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tgetCustomFieldReferenceField() {\n\t\treturn 'note';\n\t}\n\n\tbuildEditViewUI() {\n\n\t\tvar $this = this;\n\n\t\tvar form_item_input;\n\t\tvar widgetContainer;\n\n\t\t// #VueContextMenu# After we add the edit_view to the page in initEditViewUI(), add the context menu (Vue needs a valid id in dom)\n\t\tif( ContextMenuManager.getMenu( this.determineContextMenuMountAttributes().id ) === undefined ) {\n\t\t\tthis.buildContextMenu();\n\t\t} else {\n\t\t\tDebug.Warn( 'Context Menu ('+ this.determineContextMenuMountAttributes().id +') already exists for: '+ this.viewId, 'ScheduleViewController.js', 'ScheduleViewController', 'buildEditViewUI', 10 );\n\t\t}\n\n\t\tthis.edit_view_close_icon = this.edit_view.find( '.close-icon' );\n\t\tthis.edit_view_close_icon.hide();\n\t\tthis.edit_view_close_icon.click( function() {\n\t\t\t$this.onCloseIconClick();\n\t\t} );\n\n\t\tvar tab_model = {\n\t\t\t'tab_schedule': { 'label': $.i18n._( 'Schedule' ) },\n\t\t\t'tab_audit': true,\n\t\t};\n\t\tthis.setTabModel( tab_model );\n\n\t\t//Tab 0 start\n\n\t\tvar tab_schedule = this.edit_view_tab.find( '#tab_schedule' );\n\n\t\tvar tab_schedule_column1 = tab_schedule.find( '.first-column' );\n\n\t\t//Employee\n\n\t\tvar production_edition_id = Global.getProductEdition();\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIUser,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_user',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: !this.checkOpenPermission(),\n\t\t\tset_open: this.checkOpenPermission(),\n\t\t\tfield: 'user_id'\n\t\t} );\n\n\t\tvar default_args = {};\n\t\tdefault_args.permission_section = 'schedule';\n\t\tform_item_input.setDefaultArgs( default_args );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Employee' ), form_item_input, tab_schedule_column1, '', null, true );\n\n\t\t//Mass Add Employees\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIUser,\n\t\t\tallow_multiple_selection: true,\n\t\t\tlayout_name: 'global_user',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: !this.checkOpenPermission(),\n\t\t\tset_open: this.checkOpenPermission(),\n\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\treturn $this.onEmployeeSourceCreate( target, source_data );\n\t\t\t} ),\n\t\t\tfield: 'user_ids'\n\t\t} );\n\n\t\tdefault_args = {};\n\t\tdefault_args.permission_section = 'schedule';\n\t\tform_item_input.setDefaultArgs( default_args );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Employee' ), form_item_input, tab_schedule_column1, '', null, true );\n\n\t\t//Status\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\n\t\tform_item_input.TComboBox( { field: 'status_id' } );\n\t\tform_item_input.setSourceData( $this.status_array );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Status' ), form_item_input, tab_schedule_column1 );\n\n\t\t//Absence Policy\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIAbsencePolicy,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_absences',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'absence_policy_id'\n\t\t} );\n\n\t\tform_item_input.customSearchFilter = function( filter ) {\n\t\t\treturn $this.setAbsencePolicyFilter( filter );\n\t\t};\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Absence Policy' ), form_item_input, tab_schedule_column1, '', null, true );\n\n\t\t//Available Balance\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\tform_item_input.TText( { field: 'available_balance' } );\n\n\t\twidgetContainer = $( '<div class=\\'widget-h-box available-balance-h-box\\'></div>' );\n\t\tthis.available_balance_info = $( '<span class=\"available-balance-info tticon tticon-info_black_24dp\"></span>' );\n\n\t\twidgetContainer.append( form_item_input );\n\t\twidgetContainer.append( this.available_balance_info );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Available Balance' ), form_item_input, tab_schedule_column1, '', widgetContainer, true );\n\n\t\tif ( !this.current_edit_record || ( this.current_edit_record.user_ids && this.current_edit_record.user_ids.length > 1 ) ) {\n\t\t\tthis.detachElement( 'available_balance' );\n\t\t}\n\n\t\t//Date\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\n\t\tform_item_input.TDatePicker( { field: 'start_date_stamp', validation_field: 'date_stamp' } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Date' ), form_item_input, tab_schedule_column1, '', null, true );\n\n\t\t//Dates\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\n\t\tform_item_input.TRangePicker( { field: 'start_date_stamps' } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Date' ), form_item_input, tab_schedule_column1, '', null, true );\n\n\t\t//Mass Add Date\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tallow_multiple_selection: true,\n\t\t\tlayout_name: 'global_option_column',\n\t\t\tshow_search_inputs: false,\n\t\t\tset_empty: true,\n\t\t\tfield: 'start_dates'\n\t\t} );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Date' ), form_item_input, tab_schedule_column1, '', null, true );\n\n\t\t//Start Time\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TIME_PICKER );\n\t\tform_item_input.TTimePicker( { field: 'start_time' } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'In' ), form_item_input, tab_schedule_column1, '', null, true );\n\n\t\t//End Time\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TIME_PICKER );\n\t\tform_item_input.TTimePicker( { field: 'end_time' } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Out' ), form_item_input, tab_schedule_column1, '', null, true );\n\n\t\t//Total\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\tform_item_input.TText( { field: 'total_time' } );\n\t\tform_item_input.css( 'cursor', 'pointer' );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Total' ), form_item_input, tab_schedule_column1 );\n\n\t\t//Schedule Policy\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APISchedulePolicy,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_schedule',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'schedule_policy_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Schedule Policy' ), form_item_input, tab_schedule_column1 );\n\n\t\t//Default Branch\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIBranch,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_branch',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'branch_id',\n\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\treturn $this.onSourceDataCreate( target, source_data );\n\t\t\t} ),\n\t\t\t//FIXME: Follow -2 to the API do not switch to UUID unless absolutely necessary?\n\t\t\tadded_items: [\n\t\t\t\t{ value: TTUUID.not_exist_id, label: Global.default_item },\n\t\t\t\t{ value: '-2', label: Global.selected_item }\n\t\t\t]\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Branch' ), form_item_input, tab_schedule_column1, '', null, true );\n\n\t\tif ( !this.show_branch_ui ) {\n\t\t\tthis.detachElement( 'branch_id' );\n\n\t\t}\n\n\t\t//Department\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIDepartment,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_department',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'department_id',\n\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\treturn $this.onSourceDataCreate( target, source_data );\n\t\t\t} ),\n\t\t\tadded_items: [\n\t\t\t\t{ value: TTUUID.not_exist_id, label: Global.default_item },\n\t\t\t\t{ value: '-2', label: Global.selected_item }\n\t\t\t]\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Department' ), form_item_input, tab_schedule_column1, '', null, true );\n\n\t\tif ( !this.show_department_ui ) {\n\t\t\tthis.detachElement( 'department_id' );\n\n\t\t}\n\n\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\t//Job\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIJob,\n\t\t\t\tallow_multiple_selection: false,\n\t\t\t\tlayout_name: 'global_job',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tsetRealValueCallBack: ( function( val ) {\n\n\t\t\t\t\tif ( val ) {\n\t\t\t\t\t\tjob_coder.setValue( val.manual_id );\n\t\t\t\t\t}\n\t\t\t\t} ),\n\t\t\t\tfield: 'job_id',\n\t\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\t\treturn $this.onSourceDataCreate( target, source_data );\n\t\t\t\t} ),\n\t\t\t\tadded_items: [\n\t\t\t\t\t{ value: TTUUID.not_exist_id, label: Global.default_item },\n\t\t\t\t\t{ value: '-2', label: Global.selected_item }\n\t\t\t\t]\n\t\t\t} );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\tvar job_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tjob_coder.TTextInput( { field: 'job_quick_search', disable_keyup_event: true } );\n\t\t\tjob_coder.addClass( 'job-coder' );\n\n\t\t\twidgetContainer.append( job_coder );\n\t\t\twidgetContainer.append( form_item_input );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Job' ), [form_item_input, job_coder], tab_schedule_column1, '', widgetContainer, true );\n\n\t\t\tif ( !this.show_job_ui ) {\n\t\t\t\tthis.detachElement( 'job_id' );\n\t\t\t}\n\n\t\t\t//Job Item\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIJobItem,\n\t\t\t\tallow_multiple_selection: false,\n\t\t\t\tlayout_name: 'global_job_item',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tsetRealValueCallBack: ( function( val ) {\n\n\t\t\t\t\tif ( val ) {\n\t\t\t\t\t\tjob_item_coder.setValue( val.manual_id );\n\t\t\t\t\t}\n\t\t\t\t} ),\n\t\t\t\tfield: 'job_item_id',\n\t\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\t\treturn $this.onSourceDataCreate( target, source_data );\n\t\t\t\t} ),\n\t\t\t\tadded_items: [\n\t\t\t\t\t{ value: TTUUID.not_exist_id, label: Global.default_item },\n\t\t\t\t\t{ value: '-2', label: Global.selected_item }\n\t\t\t\t]\n\t\t\t} );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\tvar job_item_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tjob_item_coder.TTextInput( { field: 'job_item_quick_search', disable_keyup_event: true } );\n\t\t\tjob_item_coder.addClass( 'job-coder' );\n\n\t\t\twidgetContainer.append( job_item_coder );\n\t\t\twidgetContainer.append( form_item_input );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Task' ), [form_item_input, job_item_coder], tab_schedule_column1, '', widgetContainer, true );\n\n\t\t\tif ( !this.show_job_item_ui ) {\n\t\t\t\tthis.detachElement( 'job_item_id' );\n\t\t\t}\n\n\t\t\t//Punch Tag\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIPunchTag,\n\t\t\t\tallow_multiple_selection: true,\n\t\t\t\tlayout_name: 'global_punch_tag',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tget_real_data_on_multi: true,\n\t\t\t\tsetRealValueCallBack: ( ( punch_tags, get_real_data ) => {\n\t\t\t\t\tif ( punch_tags ) {\n\t\t\t\t\t\tthis.setPunchTagQuickSearchManualIds( punch_tags, get_real_data );\n\t\t\t\t\t}\n\t\t\t\t} ),\n\t\t\t\tfield: 'punch_tag_id',\n\t\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\t\treturn $this.onSourceDataCreatePunchTag( target, source_data );\n\t\t\t\t} ),\n\t\t\t\tadded_items: [\n\t\t\t\t\t{ value: TTUUID.not_exist_id, label: Global.default_item }\n\t\t\t\t]\n\t\t\t} );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\tvar punch_tag_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tpunch_tag_coder.TTextInput( { field: 'punch_tag_quick_search', disable_keyup_event: true } );\n\t\t\tpunch_tag_coder.addClass( 'job-coder' );\n\n\t\t\twidgetContainer.append( punch_tag_coder );\n\t\t\twidgetContainer.append( form_item_input );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Tags' ), [form_item_input, punch_tag_coder], tab_schedule_column1, '', widgetContainer, true );\n\n\n\t\t\tif ( !this.show_punch_tag_ui ) {\n\t\t\t\tthis.detachElement( 'punch_tag_id' );\n\t\t\t}\n\t\t}\n\n\t\t//Note\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_AREA );\n\t\tform_item_input.TTextArea( { field: 'note', width: '100%' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Note' ), form_item_input, tab_schedule_column1, '', null, null, true );\n\t\tform_item_input.parent().width( '45%' );\n\n\t\tif ( Global.getProductEdition() >= 15 && this.is_viewing == false ) {\n\t\t\t//Notify Employee\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.CHECKBOX );\n\t\t\tform_item_input.TCheckbox( { field: 'notify_user_schedule_change' } );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Notify Employee' ), form_item_input, tab_schedule_column1, '', null, true );\n\t\t}\n\n\t\tTTPromise.resolve( 'Schedule', 'init' );\n\t}\n\n\tsetDefaultMenuDeleteIcon( context_btn, grid_selected_length ) {\n\t\tif ( !this.deletePermissionValidate( 'schedule' ) || this.edit_only_mode ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t}\n\n\t\tif ( grid_selected_length > 0 && this.deleteOwnerOrChildPermissionValidate( 'schedule' ) ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t} else {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tonAvailableBalanceChange() {\n\t\tif ( this.current_edit_record.status_id == 20\n\t\t\t&& this.current_edit_record.hasOwnProperty( 'absence_policy_id' )\n\t\t\t&& this.current_edit_record.absence_policy_id && !this.is_mass_editing ) {\n\t\t\tthis.getAvailableBalance();\n\t\t} else {\n\t\t\tthis.detachElement( 'available_balance' );\n\t\t}\n\t}\n\n\tparserDatesRange( date ) {\n\t\tvar dates = date.split( ' - ' );\n\t\tvar resultArray = [];\n\t\tvar beginDate = Global.strToDate( dates[0] );\n\t\tvar endDate = Global.strToDate( dates[1] );\n\n\t\tvar nextDate = beginDate;\n\n\t\twhile ( nextDate.getTime() < endDate.getTime() ) {\n\t\t\tresultArray.push( nextDate.format() );\n\t\t\tnextDate = new Date( new Date( nextDate.getTime() ).setDate( nextDate.getDate() + 1 ) );\n\t\t}\n\n\t\tresultArray.push( dates[1] );\n\n\t\treturn resultArray;\n\t}\n\n\tgetSelectUsersArray() {\n\t\tvar result = [];\n\t\tvar cells_array = this.select_cells_Array;\n\t\tvar len = cells_array.length;\n\t\tvar date_dic = {};\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar item = cells_array[i];\n\n\t\t\t// If select empty cell with no user inside, set user_id to 0 as OPEN\n\t\t\tif ( !item.user_id ) {\n\t\t\t\titem.user_id = TTUUID.zero_id;\n\t\t\t}\n\n\t\t\tdate_dic[item.user_id] = true;\n\t\t}\n\n\t\tfor ( var key in date_dic ) {\n\t\t\tresult.push( key );\n\t\t}\n\n\t\tif ( result.length === 0 ) {\n\t\t\tresult.push( this.getDefaultUser() );\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetSelectDateArray() {\n\t\tvar result = [];\n\n\t\tvar cells_array = this.select_cells_Array;\n\n\t\tvar len = cells_array.length;\n\n\t\tvar date_dic = {};\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar item = cells_array[i];\n\n\t\t\tif ( item.date ) {\n\t\t\t\tdate_dic[item.date] = true;\n\t\t\t}\n\n\t\t}\n\n\t\tfor ( var key in date_dic ) {\n\t\t\tresult.push( key );\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetAvailableBalance() {\n\t\tif ( Global.isSet( this.current_edit_record ) == false ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar $this = this;\n\t\tvar user_id = this.current_edit_record.user_id;\n\t\tvar total_time = this.current_edit_record.total_time;\n\t\tvar last_date_stamp = this.current_edit_record.start_date_stamp;\n\n\t\t//On first run, set previous_absence_policy_id.\n\t\tif ( this.previous_absence_policy_id == false ) {\n\t\t\tthis.previous_absence_policy_id = this.current_edit_record.absence_policy_id;\n\t\t}\n\n\t\t//For mass adding case, select multiple cells and click new\n\t\tif ( this.is_mass_adding ) {\n\t\t\tif ( this.current_edit_record.user_ids.length > 1 ) {\n\t\t\t\tthis.detachElement( 'available_balance' );\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tuser_id = this.current_edit_record.user_ids[0];\n\t\t\t\tif ( !user_id ) {\n\t\t\t\t\tthis.detachElement( 'available_balance' );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttotal_time = total_time * this.current_edit_record.start_dates.length;\n\t\t\tlast_date_stamp = this.current_edit_record.start_dates[this.current_edit_record.start_dates.length - 1];\n\t\t} else {\n\t\t\t//get dates from date ranger\n\t\t\tif ( $.type( last_date_stamp ) === 'string'  && last_date_stamp.indexOf( ' - ' ) > 0 ) {\n\t\t\t\tlast_date_stamp = this.parserDatesRange( last_date_stamp ); //Converts last_date_stamp into an array.\n\t\t\t}\n\n\t\t\tif ( $.type( last_date_stamp ) === 'array' && last_date_stamp.length > 0 ) {\n\t\t\t\ttotal_time = ( total_time * last_date_stamp.length );\n\t\t\t\tlast_date_stamp = last_date_stamp[ ( last_date_stamp.length - 1 ) ];\n\t\t\t}\n\n\t\t\tif ( ( !this.current_edit_record || !this.current_edit_record.id || this.current_edit_record.id == TTUUID.zero_id ) && !this.is_mass_editing ) {\n\t\t\t\tif ( this.current_edit_record.user_ids.length < 1 || this.current_edit_record.user_ids.length > 1 ) {\n\t\t\t\t\tthis.detachElement( 'available_balance' );\n\t\t\t\t\treturn;\n\t\t\t\t} else {\n\t\t\t\t\tuser_id = this.current_edit_record.user_ids[0];\n\t\t\t\t\tif ( !user_id ) {\n\t\t\t\t\t\tthis.detachElement( 'available_balance' );\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t//Check if the user is editing a existing record that was originally Status=Working, and changing it to Status=Absent, in that case we can't adjust for the existing total time and must clear it out.\n\t\tif ( this.current_edit_record && this.current_edit_record.id && this.prev_status_id == 10 && this.edit_view_ui_dic['status_id'].getValue() == 20 ) {\n\t\t\tthis.prev_total_time = 0;\n\t\t}\n\n\t\tif ( this.current_edit_record.absence_policy_id != TTUUID.zero_id ) {\n\t\t\tthis.api_absence_policy.getProjectedAbsencePolicyBalance(\n\t\t\t\tthis.current_edit_record.absence_policy_id,\n\t\t\t\tuser_id,\n\t\t\t\tlast_date_stamp,\n\t\t\t\ttotal_time,\n\t\t\t\tthis.prev_total_time,\n\t\t\t\tthis.previous_absence_policy_id, {\n\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\t$this.getBalanceHandler( result, last_date_stamp );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t} else {\n\t\t\tthis.getBalanceHandler( false, last_date_stamp );\n\t\t}\n\t}\n\n\tbuildSearchAndLayoutUI() {\n\t\tvar layout_div = this.search_panel.find( 'div #saved_layout_content_div' );\n\n\t\t//Display Columns\n\n\t\tvar form_item = $( $.fn.SearchPanel.html.form_item );\n\t\tvar form_item_label = form_item.find( '.form-item-label' );\n\t\tvar form_item_input_div = form_item.find( '.form-item-input-div' );\n\n\t\tthis.column_selector = Global.loadWidgetByName( FormItemType.AWESOME_DROPDOWN );\n\n\t\tthis.column_selector = this.column_selector.ADropDown( {\n\t\t\tdisplay_show_all: false,\n\t\t\tid: 'column_selector',\n\t\t\tkey: 'value',\n\t\t\tallow_drag_to_order: true,\n\t\t\tdisplay_close_btn: false,\n\t\t\tdisplay_column_settings: false,\n\t\t\tstatic_height: 150\n\t\t} );\n\n\t\tform_item_label.text( $.i18n._( 'Display Columns' ) );\n\t\tform_item_input_div.append( this.column_selector );\n\n\t\tlayout_div.append( form_item );\n\n\t\tlayout_div.append( '<div class=\\'clear-both-div\\'></div>' );\n\n\t\tthis.column_selector.setColumns( [\n\t\t\t{ name: 'label', index: 'label', label: $.i18n._( 'Column Name' ), width: 100, sortable: false }\n\t\t] );\n\n\t\t//Save and update layout\n\n\t\tform_item = $( $.fn.SearchPanel.html.form_item );\n\t\tform_item_label = form_item.find( '.form-item-label' );\n\t\tform_item_input_div = form_item.find( '.form-item-input-div' );\n\n\t\tform_item_label.text( $.i18n._( 'Save Search As' ) );\n\n\t\tthis.save_search_as_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\tthis.save_search_as_input.TTextInput();\n\n\t\tvar save_btn = $( '<button class=\"tt-button p-button p-component small-search-panel-button\" type=\"button\">\\n' +\n\t\t\t'<span class=\"tticon tticon-save_black_24dp\"></span>\\n' +\n\t\t\t'<span class=\"p-button-label\">' + $.i18n._( 'Save' ) + '</span>\\n' +\n\t\t\t'</button>' );\n\n\t\tform_item_input_div.append( this.save_search_as_input );\n\t\tform_item_input_div.append( save_btn );\n\n\t\tvar $this = this;\n\t\tsave_btn.click( function() {\n\t\t\t$this.onSaveNewLayout();\n\t\t} );\n\n\t\t//Previous Saved Layout\n\n\t\tthis.previous_saved_layout_div = $( '<div class=\\'previous-saved-layout-div\\'></div>' );\n\n\t\tform_item_input_div.append( this.previous_saved_layout_div );\n\n\t\tform_item_label = $( '<span style=\\'margin-left: 5px\\' >' + $.i18n._( 'Previous Saved Searches' ) + ':</span>' );\n\t\tthis.previous_saved_layout_div.append( form_item_label );\n\n\t\tthis.previous_saved_layout_selector = $( '<select style=\\'margin-left: 5px\\' class=\\'t-select\\'>' );\n\t\tvar update_btn = $( '<button class=\"tt-button p-button p-component small-search-panel-button\" type=\"button\">\\n' +\n\t\t\t'<span class=\"tticon tticon-save_black_24dp\"></span>\\n' +\n\t\t\t'<span class=\"p-button-label\">' + $.i18n._( 'Update' ) + '</span>\\n' +\n\t\t\t'</button>' );\n\n\t\tvar del_btn = $( '<button class=\"tt-button p-button p-component small-search-panel-button\" type=\"button\">\\n' +\n\t\t\t'<span class=\"tticon tticon-delete_black_24dp\"></span>\\n' +\n\t\t\t'<span class=\"p-button-label\">' + $.i18n._( 'Delete' ) + '</span>\\n' +\n\t\t\t'</button>' );\n\n\t\tupdate_btn.click( function() {\n\t\t\t$this.onUpdateLayout();\n\t\t} );\n\n\t\tdel_btn.click( function() {\n\t\t\t$this.onDeleteLayout();\n\t\t} );\n\n\t\tthis.previous_saved_layout_div.append( this.previous_saved_layout_selector );\n\t\tthis.previous_saved_layout_div.append( update_btn );\n\t\tthis.previous_saved_layout_div.append( del_btn );\n\n\t\tlayout_div.append( form_item );\n\n\t\tthis.previous_saved_layout_div.css( 'display', 'none' );\n\t}\n\n\tsetCurrentEditRecordData() {\n\t\tvar $this = this;\n\t\tif ( this.is_mass_adding ) {\n\t\t\tthis.attachElement( 'start_dates' );\n\t\t\tthis.detachElement( 'start_date_stamp' );\n\t\t\tthis.detachElement( 'start_date_stamps' );\n\n\t\t\tthis.attachElement( 'user_ids' );\n\t\t\tthis.detachElement( 'user_id' );\n\n\t\t\tthis.edit_view_ui_dic.start_dates.setEnabled( false );\n\t\t\tthis.edit_view_ui_dic.user_ids.setEnabled( false );\n\n\t\t} else {\n\t\t\tthis.detachElement( 'start_dates' );\n\n\t\t\tif ( ( this.current_edit_record.id && this.current_edit_record.id != TTUUID.zero_id ) || this.is_mass_editing ) {\n\t\t\t\tthis.attachElement( 'start_date_stamp' );\n\t\t\t\tthis.detachElement( 'start_date_stamps' );\n\t\t\t\tthis.detachElement( 'user_ids' );\n\t\t\t\tthis.attachElement( 'user_id' );\n\n\t\t\t} else {\n\t\t\t\tthis.attachElement( 'start_date_stamps' );\n\t\t\t\tthis.detachElement( 'start_date_stamp' );\n\t\t\t\tthis.current_edit_record.start_date_stamps = this.current_edit_record.start_date_stamp;\n\n\t\t\t\tthis.attachElement( 'user_ids' );\n\t\t\t\tthis.detachElement( 'user_id' );\n\t\t\t}\n\n\t\t}\n\n\t\tthis.prev_total_time = 0;\n\n\t\t//When editing an existing record, store the original status_id so we can later use it when calculating available balance.\n\t\tif ( this.current_edit_record.id && this.current_edit_record.id != TTUUID.zero_id ) {\n\t\t\tthis.prev_status_id = this.current_edit_record['status_id'];\n\t\t}\n\n\t\t//Set current edit record data to all widgets\n\t\tfor ( var key in this.current_edit_record ) {\n\t\t\tvar widget = this.edit_view_ui_dic[key];\n\t\t\tif ( Global.isSet( widget ) ) {\n\t\t\t\tswitch ( key ) {\n\t\t\t\t\tcase 'user_ids':\n\t\t\t\t\t\tif ( widget.is( ':visible' ) ) {\n\t\t\t\t\t\t\tvar user_array = this.getSelectUsersArray();\n\t\t\t\t\t\t\tthis.current_edit_record[key] = user_array;\n\t\t\t\t\t\t\twidget.setValue( user_array );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'start_dates':\n\t\t\t\t\t\tvar date_array = this.getSelectDateArray();\n\t\t\t\t\t\tthis.current_edit_record[key] = date_array;\n\t\t\t\t\t\tdate_array = Global.buildRecordArray( date_array );\n\n\t\t\t\t\t\twidget.setSourceData( date_array );\n\t\t\t\t\t\twidget.setValue( date_array );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'total_time':\n\t\t\t\t\t\t//Don't set when copy as new\n\t\t\t\t\t\tif ( this.current_edit_record.id && this.current_edit_record.id != TTUUID.zero_id ) {\n\t\t\t\t\t\t\tthis.prev_total_time = this.current_edit_record[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar startTime = this.current_edit_record['date_stamp'] + ' ' + this.current_edit_record['start_time'];\n\t\t\t\t\t\tvar endTime = this.current_edit_record['date_stamp'] + ' ' + this.current_edit_record['end_time'];\n\t\t\t\t\t\tvar schedulePolicyId = this.current_edit_record['schedule_policy_id'];\n\t\t\t\t\t\tvar user_id = this.current_edit_record.user_id;\n\t\t\t\t\t\tvar total_time = this.api.getScheduleTotalTime( startTime, endTime, schedulePolicyId, user_id, { async: false } );\n\t\t\t\t\t\t// Error: Uncaught TypeError: Cannot read property 'getResult' of undefined in interface/html5/#!m=Schedule&date=20160201&mode=week&a=new&tab=Schedule\n\t\t\t\t\t\tif ( total_time && total_time.isValid() && total_time.getResult() ) {\n\t\t\t\t\t\t\ttotal_time = total_time.getResult();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttotal_time = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.current_edit_record.total_time = total_time;\n\t\t\t\t\t\twidget.setValue( Global.getTimeUnit( total_time ) );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_id':\n\t\t\t\t\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\t\t\t\t\tvar user_id = false;\n\t\t\t\t\t\t\tif ( this.edit_view_ui_dic['user_ids'] && this.edit_view_ui_dic['user_ids'].is( ':visible' ) ) {\n\t\t\t\t\t\t\t\tuser_id = this.getSelectUsersArray();\n\n\t\t\t\t\t\t\t\t//If more than one user is selected, don't filter by user_id at all, show all jobs and let the validation system handle it.\n\t\t\t\t\t\t\t\tif ( user_id.length == 1 ) {\n\t\t\t\t\t\t\t\t\tuser_id = user_id[0];\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tuser_id = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tuser_id = this.current_edit_record['user_id'];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tvar args = {};\n\t\t\t\t\t\t\targs.filter_data = {\n\t\t\t\t\t\t\t\tstatus_id: 10,\n\t\t\t\t\t\t\t\tuser_id: user_id,\n\t\t\t\t\t\t\t\tpunch_branch_id: this.current_edit_record.branch_id,\n\t\t\t\t\t\t\t\tpunch_department_id: this.current_edit_record.department_id\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\twidget.setDefaultArgs( args );\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_item_id':\n\t\t\t\t\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\t\t\t\t\tvar args = {};\n\t\t\t\t\t\t\targs.filter_data = { status_id: 10, job_id: this.current_edit_record.job_id };\n\t\t\t\t\t\t\twidget.setDefaultArgs( args );\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'punch_tag_id':\n\t\t\t\t\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t\tthis.previous_punch_tag_selection = this.current_edit_record[key];\n\n\t\t\t\t\t\t\tvar punch_tag_widget = widget;\n\t\t\t\t\t\t\tTTPromise.wait( null, null, function() {\n\t\t\t\t\t\t\t\t//Update default args for punch tags AComboBox last as they rely on data from job, job item and related fields.\n\t\t\t\t\t\t\t\tvar args = {};\n\t\t\t\t\t\t\t\targs.filter_data = $this.getPunchTagFilterData();\n\t\t\t\t\t\t\t\tpunch_tag_widget.setDefaultArgs( args );\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'branch_id':\n\t\t\t\t\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\t\t\t\t\tvar args = {};\n\t\t\t\t\t\t\targs.filter_data = { user_id: this.current_edit_record.user_id };\n\t\t\t\t\t\t\twidget.setDefaultArgs( args );\n\t\t\t\t\t\t}\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'department_id':\n\t\t\t\t\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\t\t\t\t\tvar args = {};\n\t\t\t\t\t\t\targs.filter_data = { user_id: this.current_edit_record.user_id, branch_id: this.current_edit_record.branch_id };\n\t\t\t\t\t\t\twidget.setDefaultArgs( args );\n\t\t\t\t\t\t}\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'punch_tag_quick_search':\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_quick_search':\n//\t\t\t\t\t\twidget.setValue( this.current_edit_record['job_id'] ? this.current_edit_record['job_id'] : 0 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_item_quick_search':\n//\t\t\t\t\t\twidget.setValue( this.current_edit_record['job_item_id'] ? this.current_edit_record['job_item_id'] : 0 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t\tthis.onAvailableBalanceChange();\n\t\tthis.setEditViewDataDone();\n\t}\n\n\tsetAbsencePolicyFilter( filter ) {\n\t\tif ( !filter.filter_data ) {\n\t\t\tfilter.filter_data = {};\n\t\t}\n\n\t\tif ( !this.is_mass_editing ) {\n\t\t\tif ( !this.current_edit_record || !this.current_edit_record.id || this.current_edit_record.id == TTUUID.zero_id ) {\n\t\t\t\tfilter.filter_data.user_id = this.current_edit_record?.user_ids || null;\n\t\t\t} else {\n\t\t\t\tfilter.filter_data.user_id = this.current_edit_record.user_id;\n\t\t\t}\n\t\t} else {\n\t\t\tif ( this.edit_view_ui_dic.user_id.isChecked() ) {\n\t\t\t\tfilter.filter_data.user_id = this.current_edit_record.user_id;\n\t\t\t} else {\n\t\t\t\tfilter.filter_data.user_id = this.selected_user_ids;\n\t\t\t}\n\t\t}\n\n\t\tif ( filter.filter_columns ) {\n\t\t\tfilter.filter_columns.absence_policy = true;\n\t\t}\n\n\t\treturn filter;\n\t}\n\n\tsetDefaultMenuCopyIcon( context_btn, grid_selected_length ) {\n\t\tif ( !this.copyPermissionValidate() ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t}\n\n\t\tif ( grid_selected_length >= 1 ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t} else {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tsetDefaultMenuCopyAsNewIcon( context_btn, grid_selected_length ) {\n\t\tif ( ( !this.copyAsNewPermissionValidate() ) ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t}\n\n\t\tif ( grid_selected_length === 1 ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t} else {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\n\tsetCustomEditMenuIcon( id, context_btn ) {\n\t\tswitch ( id ) {\n\t\t\tcase 'import_icon':\n\t\t\t\tthis.setEditMenuImportIcon( context_btn );\n\t\t\t\tbreak;\n\t\t\tcase 'AutoPunch':\n\t\t\t\tthis.setEditMenuAutoPunchIcon( context_btn );\n\t\t\t\tbreak;\n\t\t\tcase 'AddRequest':\n\t\t\t\tthis.setEditMenuAddRequestIcon( context_btn );\n\t\t\t\tbreak;\n\t\t\tcase 'find_available':\n\t\t\t\tthis.setEditMenuFindAvailableIcon( context_btn );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t_getGridSelectedLength() {\n\t\tvar result = 0;\n\t\tresult = this.select_all_shifts_array.length;\n\n\t\treturn result;\n\t}\n\n\tsetCustomDefaultMenuIcon( id, context_btn, grid_selected_length ) {\n\t\tswitch ( id ) {\n\t\t\tcase 'move':\n\t\t\t\tif ( !this.movePermissionValidate() ) {\n\t\t\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'drag_copy':\n\t\t\t\tif ( !this.copyPermissionValidate() ) {\n\t\t\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'swap':\n\t\t\t\tif ( !this.editPermissionValidate() ) {\n\t\t\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'override':\n\t\t\t\tif ( ( !this.editPermissionValidate() && !this.movePermissionValidate() && !this.copyPermissionValidate() ) ) {\n\t\t\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'edit_employee':\n\t\t\t\tthis.setDefaultMenuEditEmployeeIcon( context_btn, grid_selected_length );\n\t\t\t\tbreak;\n\t\t\tcase 'import_icon':\n\t\t\t\tthis.setDefaultMenuImportIcon( context_btn, grid_selected_length );\n\t\t\t\tbreak;\n\t\t\tcase 'timesheet':\n\t\t\t\tthis.setDefaultMenuEditTimesheetIcon( context_btn, grid_selected_length );\n\t\t\t\tbreak;\n\t\t\tcase 'find_available':\n\t\t\t\tthis.setDefaultMenuFindAvailabletIcon( context_btn, grid_selected_length );\n\t\t\t\tbreak;\n\t\t\tcase 'AutoPunch':\n\t\t\t\tthis.setAutoPunchIcon( context_btn, grid_selected_length );\n\t\t\t\tbreak;\n\t\t\tcase 'AddRequest':\n\t\t\t\tthis.setAddRequestIcon( context_btn, grid_selected_length );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tsetDefaultMenu( doNotSetFocus ) {\n\t\t//Schedule uses a different grid than other views and needs \"select_all_shifts_array.length\" instesd of \"this.getGridSelectIdArray()\" for grid_selected_length\n\t\tsuper.setDefaultMenu( doNotSetFocus, this._getGridSelectedLength() );\n\t\t//Set move or drop mode after rest of menu.\n\t\tthis.setMoveOrDropMode( this.select_drag_menu_id ? this.select_drag_menu_id : 'move' ); // Ensure Move/Copy selections are set when closing pop-up windows from Jump-To menu, like Add Request.\n\t}\n\n\tenableAddRequestButton() {\n\t\tvar schedules = [];\n\t\t//var grid_selected_id_array = this.getGridSelectIdArray();\n\t\tif ( !this.select_cellls_and_shifts_array ) {\n\t\t\treturn false;\n\t\t}\n\t\tvar grid_selected_id_array = this.select_cellls_and_shifts_array;\n\t\tvar grid_selected_length = grid_selected_id_array.length;\n\n\t\tif ( grid_selected_length == 1 ) {\n\t\t\treturn true;\n\t\t}\n\t\tif ( grid_selected_length == 0 ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar schedules = this.select_cells_Array;\n\t\tvar first = schedules[0];\n\n\t\tfor ( var n = 1; n < schedules.length; n++ ) {\n\t\t\tif ( schedules[n].user_id && first.user_id != schedules[n].user_id ) {\n\t\t\t\tDebug.Text( 'mismatch on user_id', 'ScheduleViewController.js', 'ScheduleViewController', 'enableAddRequestButton', 10 );\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t//do not test blank cells beyond user_id\n\t\t\tif ( schedules[n].shift == undefined ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif ( ( first.shift && schedules[n].shift ) ) {\n\t\t\t\tif ( first.shift.start_time != schedules[n].shift.start_time ) {\n\t\t\t\t\tDebug.Text( 'mismatch on start_time', 'ScheduleViewController.js', 'ScheduleViewController', 'enableAddRequestButton', 10 );\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif ( first.shift.end_time != schedules[n].shift.end_time ) {\n\t\t\t\t\tDebug.Text( 'mismatch on end_time', 'ScheduleViewController.js', 'ScheduleViewController', 'enableAddRequestButton', 10 );\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif ( first.shift.branch_id != schedules[n].shift.branch_id ) {\n\t\t\t\t\tDebug.Text( 'mismatch on branch_id', 'ScheduleViewController.js', 'ScheduleViewController', 'enableAddRequestButton', 10 );\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif ( first.shift.department_id != schedules[n].shift.department_id ) {\n\t\t\t\t\tDebug.Text( 'mismatch on department_id', 'ScheduleViewController.js', 'ScheduleViewController', 'enableAddRequestButton', 10 );\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif ( first.shift.job_id != schedules[n].shift.job_id ) {\n\t\t\t\t\tDebug.Text( 'mismatch on job_id', 'ScheduleViewController.js', 'ScheduleViewController', 'enableAddRequestButton', 10 );\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif ( first.shift.job_item_id != schedules[n].shift.job_item_id ) {\n\t\t\t\t\tDebug.Text( 'mismatch on job_item_id', 'ScheduleViewController.js', 'ScheduleViewController', 'enableAddRequestButton', 10 );\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif ( first.shift.punch_tag_id != schedules[n].shift.punch_tag_id ) {\n\t\t\t\t\tDebug.Text( 'mismatch on punch_tag_id', 'ScheduleViewController.js', 'ScheduleViewController', 'enableAddRequestButton', 10 );\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif ( first.shift.schedule_policy_id != schedules[n].shift.schedule_policy_id ) {\n\t\t\t\t\tDebug.Text( 'mismatch on schedule_policy_id', 'ScheduleViewController.js', 'ScheduleViewController', 'enableAddRequestButton', 10 );\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif ( first.shift.status_id != schedules[n].shift.status_id ) {\n\t\t\t\t\tDebug.Text( 'mismatch on status_id', 'ScheduleViewController.js', 'ScheduleViewController', 'enableAddRequestButton', 10 );\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif ( first.shift.status_id == 20 && first.shift.absence_policy_id != schedules[n].shift.absence_policy_id ) {\n\t\t\t\t\tDebug.Text( 'mismatch on absence_policy_id', 'ScheduleViewController.js', 'ScheduleViewController', 'enableAddRequestButton', 10 );\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\t//if the first one is a blank in a selection that includes shifts, we need to update the compared record to one with a shift.\n\t\t\t} else if ( first.shift == undefined && schedules[n].shift ) {\n\t\t\t\tfirst = schedules[n];\n\t\t\t}\n\t\t}\n\n\t\tDebug.Text( 'All Selected Schedules Match', 'ScheduleViewController.js', 'ScheduleViewController', 'enableAddRequestButton', 10 );\n\t\treturn true;\n\t}\n\n\tsetAutoPunchIcon( context_btn, grid_selected_length ) {\n\t\tif ( grid_selected_length > 0 ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t} else {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tsetEditMenuAutoPunchIcon( context_btn, grid_selected_length ) {\n\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t}\n\n\tsetEditMenuAddRequestIcon( context_btn, grid_selected_length ) {\n\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t}\n\n\tsetEditMenuFindAvailableIcon( context_btn, grid_selected_length ) {\n\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t}\n\n\tsetDefaultMenuFindAvailabletIcon( context_btn, grid_selected_length ) {\n\t\tif ( !this.editChildPermissionValidate() ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t}\n\n\t\tif ( grid_selected_length >= 1 ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t} else {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tsetDefaultMenuEditTimesheetIcon( context_btn, grid_selected_length ) {\n\n\t\tif ( this.select_cells_Array.length === 1 && TTUUID.isUUID( this.select_cells_Array[0].user_id ) && this.select_cells_Array[0].user_id != TTUUID.zero_id ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t} else {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tsetDefaultMenuImportIcon( context_btn, grid_selected_length, pId ) {\n\t\tif ( PermissionManager.checkTopLevelPermission( 'ImportCSVSchedule' ) === true ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t} else {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tsetDefaultMenuEditEmployeeIcon( context_btn, grid_selected_length ) {\n\n\t\tif ( !this.editChildPermissionValidate( 'user' ) ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t}\n\n\t\tif ( this.select_cells_Array.length === 1 && TTUUID.isUUID( this.select_cells_Array[0].user_id ) && this.select_cells_Array[0].user_id != TTUUID.zero_id ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t} else {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tonUpdateLayout() {\n\n\t\tvar selectId = $( this.previous_saved_layout_selector ).children( 'option:selected' ).attr( 'value' );\n\t\tvar layout_name = $( this.previous_saved_layout_selector ).children( 'option:selected' ).text();\n\n\t\tvar selected_display_columns = this.getSearchPanelDisplayColumns();\n\t\tvar filter_data =   Global.convertLayoutFilterToAPIFilter( { data: { filter_data:  this.getValidSearchFilter() } } );\n\n\t\tvar args = {};\n\t\targs.id = selectId;\n\t\targs.data = {};\n\t\targs.data.display_columns = selected_display_columns;\n\t\targs.data.filter_data = filter_data;\n\t\targs.data.mode = Global.upCaseFirstLetter( this.getMode() );\n\t\targs.data.strictRange = this.settings_menu.getButton( 'strict_range_btn' ).active;\n\t\targs.data.weeklyTotals = this.settings_menu.getButton( 'weekly_totals_btn' ).active;\n\t\targs.data.dailyTotals = this.settings_menu.getButton( 'daily_totals_btn' ).active;\n\t\targs.data.showAllEmp = this.settings_menu.getButton( 'all_employee_btn' ).active;\n\n\t\tvar $this = this;\n\t\tthis.user_generic_data_api.setUserGenericData( args, {\n\t\t\tonResult: function( res ) {\n\n\t\t\t\tif ( res && res.isValid() ) {\n\t\t\t\t\t$this.clearViewLayoutCache();\n\t\t\t\t\t$this.need_select_layout_name = layout_name;\n\t\t\t\t\t$this.initLayout();\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tonSaveNewLayout( default_layout_name ) {\n\n\t\tif ( Global.isSet( default_layout_name ) ) {\n\t\t\tvar layout_name = default_layout_name;\n\t\t} else {\n\t\t\tlayout_name = this.save_search_as_input.getValue();\n\t\t}\n\n\t\tif ( !layout_name || layout_name.length < 1 ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar selected_display_columns = this.getSearchPanelDisplayColumns();\n\t\tvar filter_data =  Global.convertLayoutFilterToAPIFilter( { data: { filter_data: this.getValidSearchFilter() } } );\n\n\t\tvar args = {};\n\t\targs.script = this.script_name;\n\t\targs.name = layout_name;\n\t\targs.is_default = false;\n\t\targs.data = {};\n\t\targs.data.display_columns = selected_display_columns;\n\t\targs.data.filter_data = filter_data;\n\t\targs.data.mode = Global.upCaseFirstLetter( this.getMode() );\n\t\targs.data.strictRange = this.settings_menu.getButton( 'strict_range_btn' ).active;\n\t\targs.data.weeklyTotals = this.settings_menu.getButton( 'weekly_totals_btn' ).active;\n\t\targs.data.dailyTotals = this.settings_menu.getButton( 'daily_totals_btn' ).active;\n\t\targs.data.showAllEmp = this.settings_menu.getButton( 'all_employee_btn' ).active;\n\n\t\tvar $this = this;\n\t\tthis.user_generic_data_api.setUserGenericData( args, {\n\t\t\tonResult: function( res ) {\n\n\t\t\t\tif ( res && res.isValid() ) {\n\t\t\t\t\t$this.clearViewLayoutCache();\n\t\t\t\t\t$this.need_select_layout_name = layout_name;\n\t\t\t\t\t$this.initLayout();\n\t\t\t\t} else {\n\t\t\t\t\tTAlertManager.showErrorAlert( res );\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tonClearSearch() {\n\t\tvar do_update = false;\n\t\tif ( this.search_panel.getLayoutsArray() && this.search_panel.getLayoutsArray().length > 0 ) {\n\t\t\tvar default_layout_id = $( this.previous_saved_layout_selector ).children( 'option:contains(\\'' + BaseViewController.default_layout_name + '\\')' ).attr( 'value' );\n\t\t\tvar layout_name = BaseViewController.default_layout_name;\n\t\t\tthis.clearSearchPanel();\n\t\t\tthis.filter_data = null;\n\t\t\tthis.temp_adv_filter_data = null;\n\t\t\tthis.temp_basic_filter_data = null;\n\t\t\tdo_update = true;\n\n\t\t} else {\n\n\t\t\tthis.clearSearchPanel();\n\t\t\tthis.filter_data = null;\n\t\t\tthis.temp_adv_filter_data = null;\n\t\t\tthis.temp_basic_filter_data = null;\n\n\t\t\tthis.column_selector.setSelectGridData( this.default_display_columns );\n\n\t\t\tthis.onSaveNewLayout( BaseViewController.default_layout_name );\n\t\t\treturn;\n\n\t\t}\n\n\t\tvar selected_display_columns = this.getSearchPanelDisplayColumns();\n\t\tvar filter_data =  Global.convertLayoutFilterToAPIFilter( { data: { filter_data: this.getValidSearchFilter() } } );\n\n\t\tif ( do_update ) {\n\t\t\tvar args = {};\n\t\t\targs.id = default_layout_id;\n\t\t\targs.data = {};\n\t\t\targs.data.display_columns = selected_display_columns;\n\t\t\targs.data.filter_data = filter_data;\n\t\t}\n\n\t\targs.data.mode = this.getMode();\n\n\t\tvar $this = this;\n\t\tthis.user_generic_data_api.setUserGenericData( args, {\n\t\t\tonResult: function( res ) {\n\n\t\t\t\tif ( res && res.isValid() ) {\n\t\t\t\t\t$this.clearViewLayoutCache();\n\t\t\t\t\t$this.need_select_layout_name = layout_name;\n\t\t\t\t\t$this.initLayout();\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tgetSearchPanelDisplayColumns() {\n\t\tvar display_columns = [];\n\n\t\tvar select_items = this.column_selector.getSelectItems();\n\n\t\tif ( select_items && select_items.length > 0 ) {\n\t\t\t$.each( select_items, function( index, content ) {\n\t\t\t\tdisplay_columns.push( content.value );\n\t\t\t} );\n\t\t}\n\n\t\treturn display_columns;\n\t}\n\n\tonSearch( save_only ) {\n\t\tthis.temp_adv_filter_data = null;\n\t\tthis.temp_basic_filter_data = null;\n\n\t\tthis.getSearchPanelFilter();\n\n\t\tif ( this.search_panel.getLayoutsArray() && this.search_panel.getLayoutsArray().length > 0 ) {\n\t\t\tvar default_layout_id = $( this.previous_saved_layout_selector ).children( 'option:contains(\\'' + BaseViewController.default_layout_name + '\\')' ).attr( 'value' );\n\n\t\t\tif ( !default_layout_id ) {\n\t\t\t\tthis.onSaveNewLayout( BaseViewController.default_layout_name );\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar layout_name = BaseViewController.default_layout_name;\n\n\t\t} else {\n\t\t\tthis.onSaveNewLayout( BaseViewController.default_layout_name );\n\t\t\treturn;\n\t\t}\n\n\t\tvar selected_display_columns = this.getSearchPanelDisplayColumns();\n\t\tvar filter_data =  Global.convertLayoutFilterToAPIFilter( { data: { filter_data: this.getValidSearchFilter() } } );\n\n\t\tvar args = {};\n\t\targs.id = default_layout_id;\n\t\targs.data = {};\n\t\targs.data.display_columns = selected_display_columns;\n\t\targs.data.filter_data = filter_data;\n\t\targs.data.mode = Global.upCaseFirstLetter( this.getMode() );\n\t\targs.data.strictRange = this.settings_menu.getButton( 'strict_range_btn' ).active;\n\t\targs.data.weeklyTotals = this.settings_menu.getButton( 'weekly_totals_btn' ).active;\n\t\targs.data.dailyTotals = this.settings_menu.getButton( 'daily_totals_btn' ).active;\n\t\targs.data.showAllEmp = this.settings_menu.getButton( 'all_employee_btn' ).active;\n\n\t\tProgressBar.showOverlay();\n\t\tvar $this = this;\n\t\tthis.user_generic_data_api.setUserGenericData( args, {\n\t\t\tonResult: function( res ) {\n\t\t\t\tif ( res && res.isValid() ) {\n\t\t\t\t\t$this.clearViewLayoutCache();\n\t\t\t\t\t$this.need_select_layout_name = layout_name;\n\t\t\t\t\tif ( !save_only ) {\n\t\t\t\t\t\t$this.initLayout();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t}\n\n\tsetSelectLayout() {\n\n\t\tvar $this = this;\n\n\t\tif ( !this.select_layout ) { //Set to defalt layout if no layout at all\n\t\t\tthis.select_layout = { id: '' };\n\t\t\tthis.select_layout.data = { filter_data: {}, filter_sort: {} };\n\t\t\tthis.select_layout.data.display_columns = this.default_display_columns;\n\t\t}\n\n\t\tvar layout_data = this.select_layout.data;\n\n\t\tvar display_columns = this.buildDisplayColumns( layout_data.display_columns );\n\n\t\tif ( Global.isSet( layout_data.mode ) && layout_data.mode != '' ) {\n\t\t\t$this.setToggleButtonValue( layout_data.mode.toLowerCase() );\n\t\t} else if ( LocalCacheData.getAllURLArgs() && LocalCacheData.getAllURLArgs().mode ) {\n\t\t\t$this.setToggleButtonValue( LocalCacheData.getAllURLArgs().mode );\n\t\t} else {\n\t\t\t$this.setToggleButtonValue( ScheduleViewControllerMode.WEEK );\n\t\t}\n\n\t\tif ( layout_data.hasOwnProperty( 'strictRange' ) ) {\n\t\t\tif ( layout_data.strictRange ) {\n\t\t\t\tthis.settings_menu.activateButton( 'strict_range_btn' );\n\t\t\t} else {\n\t\t\t\tthis.settings_menu.deactivateButton( 'strict_range_btn' );\n\t\t\t}\n\t\t} else {\n\t\t\tthis.settings_menu.activateButton( 'strict_range_btn' );\n\t\t}\n\n\t\tif ( layout_data.weeklyTotals ) {\n\t\t\tthis.settings_menu.activateButton( 'weekly_totals_btn' );\n\t\t} else {\n\t\t\tthis.settings_menu.deactivateButton( 'weekly_totals_btn' );\n\t\t}\n\n\t\tif ( layout_data.dailyTotals ) {\n\t\t\tthis.settings_menu.activateButton( 'daily_totals_btn' );\n\t\t} else {\n            this.settings_menu.deactivateButton( 'daily_totals_btn' );\n        }\n\n\t\tif ( layout_data.showAllEmp ) {\n\t\t\tthis.settings_menu.activateButton( 'all_employee_btn' );\n\t\t} else {\n            this.settings_menu.deactivateButton( 'all_employee_btn' );\n        }\n\n\t\t//Set Display Column in layout panel\n\t\tthis.column_selector.setSelectGridData( display_columns );\n\n\t\t//Set Previoous Saved layout combobox in layout panel\n\t\tvar layouts_array = this.search_panel.getLayoutsArray();\n\n\t\tthis.previous_saved_layout_selector.empty();\n\t\tif ( layouts_array && layouts_array.length > 0 ) {\n\t\t\tthis.previous_saved_layout_div.css( 'display', 'inline' );\n\n\t\t\tvar len = layouts_array.length;\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\tvar item = layouts_array[i];\n\t\t\t\tthis.previous_saved_layout_selector.append( $( '<option value=\"' + item.id + '\"></option>' ).text( item.name ) );\n\t\t\t}\n\t\t\t$( this.previous_saved_layout_selector.find( 'option' ) ).filter( function() {\n\t\t\t\treturn $( this ).attr( 'value' ) === $this.select_layout.id;\n\t\t\t} ).prop( 'selected', true ).attr( 'selected', true );\n\n\t\t} else {\n\t\t\tthis.previous_saved_layout_div.css( 'display', 'none' );\n\t\t}\n\n\t\tif ( LocalCacheData.default_filter_for_next_open_view ) {\n\t\t\tthis.select_layout.data.filter_data = LocalCacheData.default_filter_for_next_open_view.filter_data;\n\n\t\t\tthis.setDatePickerValue( LocalCacheData.default_filter_for_next_open_view.select_date );\n\n\t\t\tthis.select_layout.data.mode = 'Week';\n\t\t\t$this.setToggleButtonValue( layout_data.mode.toLowerCase() );\n\n\t\t\tLocalCacheData.default_filter_for_next_open_view = null;\n\t\t}\n\n\t\tthis.filter_data = this.select_layout.data.filter_data;\n\n\t\tthis.setSearchPanelFilter( true );\n\t}\n\n\tgetMode() {\n\t\tif ( this.toggle_button ) {\n\t\t\treturn this.toggle_button.getValue();\n\t\t}\n\t}\n\n\tsearch( setDefaultMenu, use_date_picker_date ) {\n\t\t//Issue #3095 - Race condition where a user switches views while the schedule is still loading can cause an exception.\n\t\tif ( !( LocalCacheData.current_open_primary_controller.viewId === 'Schedule' || LocalCacheData.current_open_primary_controller.viewId === 'FindAvailable' ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.clearSelection( setDefaultMenu ); //Clear selection on search, as we aren't re-populating it anyways, and causes a problem if you select 2 cells, click top-right refresh icon, then click New icon, it thinks the selection still exists.\n\t\tthis.setActionsButtonStatus();\n\t\tthis.final_schedule_data_array = [];\n\n\t\tvar $this = this;\n\t\tvar filter_data = Global.convertLayoutFilterToAPIFilter( this.select_layout );\n\t\tvar start_date_string;\n\n\t\tvar mode = this.getMode();\n\n\t\tif ( this.settings_menu.getButton( 'all_employee_btn' ).active ) {\n\t\t\tfilter_data.include_all_users = true;\n\t\t}\n\n\t\tvar strict = this.settings_menu.getButton( 'strict_range_btn' ).active;\n\n\t\tif ( use_date_picker_date || !this.end_date ) {\n\t\t\tif ( this.start_date === null || use_date_picker_date ) {\n\t\t\t\tstart_date_string = this.start_date_picker.getValue();\n\t\t\t} else {\n\t\t\t\tstart_date_string = $this.start_date.format();\n\t\t\t}\n\n\t\t\tif ( mode === ScheduleViewControllerMode.YEAR ) {\n\t\t\t\tthis.year_mode_original_date = start_date_string;\n\t\t\t}\n\t\t} else {\n\t\t\tif ( strict ) {\n\t\t\t\tif ( mode === ScheduleViewControllerMode.YEAR ) {\n\t\t\t\t\tstart_date_string = this.year_mode_original_date ? this.year_mode_original_date : this.start_date_picker.getValue();\n\t\t\t\t} else if ( mode === ScheduleViewControllerMode.MONTH ) {\n\t\t\t\t\tstart_date_string = new Date( new Date( $this.end_date.getTime() ).setDate( $this.end_date.getDate() - 15 ) ).format();\n\t\t\t\t} else {\n\t\t\t\t\tstart_date_string = $this.end_date.format();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tstart_date_string = $this.start_date.format();\n\t\t\t}\n\t\t}\n\n\t\tif ( mode === null || mode == '' || start_date_string == '' || start_date_string == 'Invalid date' ) {\n\t\t\t//Triggering an error report to hopefully gather more information on what is happening to cause this.\n\t\t\t//Used to cause: PHP ERROR - WARNING(2): Undefined variable $start_date\n\t\t\tGlobal.sendErrorReport( 'ScheduleViewController invalid mode/date detected.' );\n\t\t\tTAlertManager.showAlert( $.i18n._( 'Invalid schedule mode or date. Please try again.' ) );\n\t\t} else {\n\t\t\tLocalCacheData.last_schedule_selected_date = start_date_string;\n\n\t\t\tProgressBar.showOverlay();\n\t\t\tthis.api.getCombinedSchedule( { filter_data: filter_data }, start_date_string, mode, strict, {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t//Issue #3095 - Race condition where a user switches views while the schedule is still loading can cause an exception.\n\t\t\t\t\tif ( !( LocalCacheData.current_open_primary_controller.viewId === 'Schedule' || LocalCacheData.current_open_primary_controller.viewId === 'FindAvailable' ) ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t$this.full_schedule_data = result.getResult();\n\n\t\t\t\t\t//Error: Unable to get property 'start_display_date' of undefined or null reference in /interface/html5/ line 3805\n\t\t\t\t\tif ( $this.full_schedule_data === true || !$this.full_schedule_data || !$this.full_schedule_data.schedule_dates ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t$this.start_date = Global.strToDate( $this.full_schedule_data.schedule_dates.start_display_date );\n\t\t\t\t\t$this.end_date = Global.strToDate( $this.full_schedule_data.schedule_dates.end_display_date );\n\n\t\t\t\t\t$this.buildCalendars();\n\n\t\t\t\t\tif ( setDefaultMenu ) {\n\t\t\t\t\t\t$this.setDefaultMenu( true );\n\t\t\t\t\t\t$this.autoOpenEditViewIfNecessary();\n\t\t\t\t\t}\n\n\t\t\t\t\t$this.searchDone();\n\n\t\t\t\t\t$this.setWeekModeDragAble();\n\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t}\n\n\tsearchDone() {\n\t\t// this.setGridColumnsWidth();\n\t\t// this.setGridSize();\n\t\t$( '.button-rotate' ).removeClass( 'button-rotate' );\n\t\tTTPromise.resolve( 'init', 'init' );\n\t}\n\n\tgetLastDateOfRow( row ) {\n\t\tvar start_day = LocalCacheData.getLoginUserPreference().start_week_day == 0 ? 7 : LocalCacheData.getLoginUserPreference().start_week_day;\n\t\treturn row[( start_day - 1 ) + '_time'];\n\t}\n\n\tsetActionsButtonStatus() {\n\t\tif ( !this.settings_menu ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar mode = this.getMode();\n\n\t\tthis.settings_menu.enableButton( 'weekly_totals_btn' );\n\t\tthis.settings_menu.enableButton( 'strict_range_btn' );\n\t\tthis.settings_menu.enableButton( 'daily_totals_btn' );\n\t\tthis.settings_menu.enableButton( 'all_employee_btn' );\n\n\t\tswitch ( mode ) {\n\t\t\tcase ScheduleViewControllerMode.DAY:\n\t\t\t\tthis.settings_menu.disableButton( 'weekly_totals_btn' );\n\t\t\t\tthis.settings_menu.disableButton( 'strict_range_btn' );\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerMode.WEEK:\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerMode.MONTH:\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerMode.YEAR:\n\t\t\t\tthis.settings_menu.disableButton( 'weekly_totals_btn' );\n\t\t\t\tthis.settings_menu.disableButton( 'daily_totals_btn' );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tonOverrideClick() {\n\t\tvar context_menu_array = ContextMenuManager.getMenuModelByMenuId( this.determineContextMenuMountAttributes().id );\n\t\tvar override_icon = context_menu_array.find( icon => icon.id === 'override' );\n\n\t\tif ( override_icon.active ) {\n\t\t\tthis.is_override = true;\n\t\t} else {\n\t\t\tthis.is_override = false;\n\t\t}\n\t}\n\n\tonNotifyUserScheduleChangeClick() {\n\t\tvar context_menu_array = ContextMenuManager.getMenuModelByMenuId( this.determineContextMenuMountAttributes().id );\n\t\tvar notify_user_schedule_change_icon = context_menu_array.find( icon => icon.id === 'notify_user_schedule_change' );\n\n\t\tif ( notify_user_schedule_change_icon.active ) {\n\t\t\tthis.notify_user_schedule_change = true;\n\t\t} else {\n\t\t\tthis.notify_user_schedule_change = false;\n\t\t}\n\t}\n\n\tsetMoveOrDropMode( id ) {\n\t\t//Drag and drop context menu does not exist on edit view and thus this code does not need to be ran. Otherwise would cause JavaScript exception.\n\t\tif ( this.is_edit || this.is_mass_editing || this.is_add ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar context_menu_array = ContextMenuManager.getMenuModelByMenuId( this.determineContextMenuMountAttributes().id );\n\t\tvar drag_copy_icon = context_menu_array.find( icon => icon.id === 'drag_copy' );\n\t\tvar move_icon = context_menu_array.find( icon => icon.id === 'move' );\n\t\tvar swap_icon = context_menu_array.find( icon => icon.id === 'swap' );\n\n\t\tif ( drag_copy_icon === undefined || move_icon === undefined || swap_icon === undefined ) {\n\t\t\treturn;\n\t\t}\n\n\t\tContextMenuManager.activateMenuItem( this.determineContextMenuMountAttributes().id, drag_copy_icon.id, true );\n\t\tContextMenuManager.activateMenuItem( this.determineContextMenuMountAttributes().id, move_icon.id, true );\n\t\tContextMenuManager.activateMenuItem( this.determineContextMenuMountAttributes().id, swap_icon.id, true );\n\n\t\tvar drag_invisible = false;\n\t\tvar move_invisible = false;\n\t\tvar swap_invisible = false;\n\n\t\tif ( !this.copyPermissionValidate() ) {\n\t\t\tdrag_invisible = true;\n\t\t}\n\n\t\tif ( !this.movePermissionValidate() ) {\n\t\t\tmove_invisible = true;\n\t\t}\n\n\t\tif ( !this.editPermissionValidate() ) {\n\t\t\tswap_invisible = true;\n\t\t}\n\n\t\tif ( move_invisible && id === 'move' ) {\n\t\t\tContextMenuManager.activateMenuItem( this.determineContextMenuMountAttributes().id, drag_copy_icon.id, false );\n\t\t} else {\n\t\t\tvar icon = context_menu_array.find( icon => icon.id === id );\n\t\t\tContextMenuManager.activateMenuItem( this.determineContextMenuMountAttributes().id, icon.id, false );\n\t\t}\n\n\t\tif ( drag_invisible && move_invisible ) {\n\t\t\tthis.select_drag_menu_id = null;\n\t\t} else {\n\t\t\tthis.select_drag_menu_id = id;\n\t\t}\n\t}\n\n\tsetHolidayDataDic() {\n\n\t\tif ( this.full_schedule_data.holiday_data ) {\n\t\t\tfor ( var i = 0; i < this.full_schedule_data.holiday_data.length; i++ ) {\n\t\t\t\tvar item = this.full_schedule_data.holiday_data[i];\n\t\t\t\tvar standard_date = Global.strToDate( item.date_stamp ).format( this.weekly_format );\n\t\t\t\tthis.holiday_data_dic[standard_date] = item;\n\t\t\t}\n\t\t}\n\t}\n\n\tbuildCalendars( do_not_hide ) {\n\t\tvar $this = this;\n\t\tthis.grid_div = $( this.el ).find( '.schedule-grid-div' );\n\t\tthis.setHolidayDataDic();\n\n\t\tthis.buildScheduleColumns();\n\t\tthis.buildScheduleSource();\n\t\tthis.buildScheduleGrid();\n\n\t\tthis.setGridColumnsWidth(); //There is no grid data populated when this runs, so it only sizes columns to the label length, not longest row data length.\n\t\tthis.setGridSize();\n\n\t\t//Only work when year mode\n\t\tthis.setYearGroupHeader();\n\t\tthis.showGridBorders();\n\n\t\tvar start = 0;\n\t\tvar page = 1;\n\t\tvar page_num = 10;\n\n\t\t//this.grid will be empty when first time int this function, so put this judge here instead at begin.\n\t\t//Error: Uncaught TypeError: Cannot call method 'clearGridData' of null in /interface/html5/index.php?desktop=1#!m=Schedule&date=20150118&mode=week line 6944\n\t\tif ( !this.grid ) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.grid.clearGridData();\n\n\t\tvar j = 0;\n\n\t\tif ( !do_not_hide ) {\n\t\t\tthis.grid.grid.css( 'opacity', 0 );\n\t\t}\n\n\t\t//Error: TypeError: $this.schedule_source is undefined in interface/html5/framework/jquery.min.js?v=9.0.6-20151231-155042 line 2 > eval line 3904\n\t\tif ( !this.schedule_source ) {\n\t\t\treturn;\n\t\t}\n\t\tvar $this = this;\n\t\taddGridData();\n\n\t\t// Add 200 record a time so UI not block.\n\t\tvar interval = setInterval( function() {\n\t\t\tif ( j < $this.schedule_source.length ) {\n\t\t\t\taddGridData();\n\t\t\t} else {\n\t\t\t\tdoNext();\n\t\t\t}\n\t\t}, 10 );\n\n\t\tfunction addGridData() {\n\t\t\tfor ( var i = j; i < j + 200; i++ ) {\n\t\t\t\tif ( i < $this.schedule_source.length ) {\n\t\t\t\t\tvar item = $this.schedule_source[i];\n\t\t\t\t\t$this.grid.grid.addRowData( i + 1, item );\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tj = i;\n\t\t}\n\n\t\tfunction doNext() {\n\t\t\tif ( !do_not_hide ) {\n\t\t\t\t$this.grid.grid.css( 'opacity', 1 );\n\t\t\t}\n\t\t\tclearInterval( interval );\n\n\t\t\tif ( $this.getMode !== ScheduleViewControllerMode.YEAR ) {\n\t\t\t\t$this.setScheduleGridRowSpan();\n\t\t\t}\n\n\t\t\t$this.highLightSelectDay();\n\n\t\t\t//Only work when month mode\n\t\t\t$this.setMonthDateRowPosition();\n\n\t\t\t$this.setScheduleGridDragAble();\n\n\t\t\t$this.setScrollPosition();\n\n\t\t\t//$this.autoOpenEditViewIfNecessary();\n\n\t\t\t$this.setMonthDateRowBackGround();\n\n\t\t\t$this.setWeeklyTotalHeader();\n\t\t}\n\t}\n\n\tgetDefaultUser() {\n\t\tvar default_user_id = false;\n\t\tif ( this.schedule_source && this.schedule_source.length === 1 && this.schedule_source[0].user_id != '' ) {\n\t\t\t//case where only one user has a schedule on the sheet\n\t\t\tdefault_user_id = this.schedule_source[0].user_id;\n\t\t} else if ( this.schedule_source\n\t\t\t&& this.schedule_source.length === 1\n\t\t\t&& typeof this.filter_data == 'object' // #2571 - Uncaught TypeError: This.filter_data.include_user_id is undefined\n\t\t\t&& typeof this.filter_data.include_user_ids == 'object' // #2571 - Uncaught TypeError: Cannot read property 'value' of undefined\n\t\t\t&& this.filter_data.include_user_ids.value\n\t\t\t&& this.filter_data.include_user_ids.value.length === 1 ) {\n\t\t\t//case where one user is selected in include_users but does not have a schedule attributed to them (new users for example)\n\t\t\tdefault_user_id = this.filter_data.include_user_ids.value[0];\n\t\t} else {\n\t\t\t// #2740 Before defaulting to logged in user, check to see if user_id is set on the current_edit_record, as Save&Copy clears grid selection, so we need to re-set it.\n\t\t\tif ( this.current_edit_record.user_id && this.current_edit_record.user_id != '' ) {\n\t\t\t\tdefault_user_id = this.current_edit_record.user_id;\n\t\t\t} else {\n\t\t\t\tdefault_user_id = LocalCacheData.getLoginUser().id;\n\t\t\t}\n\t\t}\n\n\t\treturn default_user_id;\n\t}\n\n\tsetWeeklyTotalHeader() {\n\t\tvar show_weekly_total = this.settings_menu.getButton( 'weekly_totals_btn' ).active;\n\t\t$( '.size-tr' ).remove();\n\t\t$( '.group-tr' ).remove();\n\t\tif ( !show_weekly_total || this.settings_menu.getButton( 'weekly_totals_btn' ).disabled === true ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar table = $( $( this.el ).find( 'table[aria-labelledby=gbox_' + this.ui_id + '_grid]' ) );\n\n\t\tvar size_tr = $( '<tr class=\"size-tr\" >' +\n\t\t\t'</tr>' );\n\n\t\tvar new_tr = $( '<tr class=\"group-column-tr group-tr\" >' +\n\t\t\t'</tr>' );\n\n\t\tvar new_th = $( '<th class=\"group-column-th\"  >' +\n\t\t\t'<span class=\"group-column-label\"></span>' +\n\t\t\t'</th>' );\n\n\t\tvar current_trs = table.find( '.jqgfirstrow' );\n\t\tcreateSizeColumns();\n\n\t\tvar column_length = this.grid.grid.getGridParam( 'colModel' ).length;\n\t\tcreateColumn( column_length - 5, '' );\n\t\tcreateColumn( 5, $.i18n._( 'Total' ) );\n\n\t\tsize_tr.insertBefore( table.find( '.ui-jqgrid-labels' ) );\n\t\tnew_tr.insertBefore( table.find( '.ui-jqgrid-labels' ) );\n\n\t\tfunction createSizeColumns() {\n\t\t\tvar len = current_trs.children().length;\n\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\tvar td = $( '<th class=\"\" style=\"border-right: 1px solid #dddddd\" >' + '</th>' );\n\t\t\t\tvar item = current_trs.children().eq( i );\n\n\t\t\t\t/**\n\t\t\t\t * #2353 - schedule sizing fix\n\t\t\t\t *\n\t\t\t\t * Due to firefox reporting th  incorrectly via the $.width() function, the sizes must come from the (tr.jqgfirstrow) of the data table\n\t\t\t\t * firefox also refuses to set the width of the first row of th's via the $.width() function, so we need to ship the css values directly into the inline css using the css function\n\t\t\t\t */\n\t\t\t\ttd.css( 'width', item.css( 'width' ) );\n\n\t\t\t\ttd.height( 0 );\n\t\t\t\tsize_tr.append( td );\n\t\t\t}\n\n\t\t}\n\n\t\tfunction createColumn( end_index, text ) {\n\t\t\tvar pay_period_th = new_th.clone();\n\n\t\t\tpay_period_th.children( 0 ).text( text );\n\t\t\tpay_period_th.attr( 'colspan', end_index );\n\n\t\t\tnew_tr.append( pay_period_th );\n\t\t}\n\n\t\tthis.setGridHeight(); //Since we are changing the header height, resize the grid to fit.\n\t}\n\n\tsetMonthDateRowBackGround() {\n\t\tif ( this.getMode() === ScheduleViewControllerMode.MONTH ) {\n\t\t\t$( this.el ).find( '.month-date-cell' ).parent().css( 'background-color', '#375979' );\n\t\t}\n\t}\n\n\tsetScrollPosition() {\n\t\tif ( this.scroll_position > 0 ) {\n\t\t\tthis.grid.grid.parent().parent().scrollTop( this.scroll_position );\n\t\t}\n\t}\n\n\tsetYearGroupHeader() {\n\n\t\tif ( this.getMode() !== ScheduleViewControllerMode.YEAR ) {\n\t\t\treturn;\n\t\t}\n\n\t\t$( '.schedule-year-group-header' ).remove();\n\t\tvar table = $( $( this.el ).find( 'table[aria-labelledby=gbox_' + this.ui_id + '_grid]' )[0] );\n\t\tvar new_tr = $( '<tr class=\"group-column-tr schedule-year-group-header\" >' +\n\t\t\t'</tr>' );\n\n\t\tvar new_th = $( '<th class=\"group-column-th\"  >' +\n\t\t\t'<span class=\"group-column-label\"></span>' +\n\t\t\t'</th>' );\n\n\t\tvar default_tr = new_tr.clone();\n\n\t\t$( table.children()[0] ).prepend( default_tr );\n\n\t\t//Build first row to correct width for span columns which in second row, table width decided by first row\n\t\tvar datesTHs = table.find( 'th' );\n\t\tvar len = datesTHs.length;\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar th = $( datesTHs[i] );\n\n\t\t\tvar default_th = th.clone();\n\t\t\tdefault_th.attr( 'id', '' );\n\t\t\tdefault_th.empty();\n\t\t\tdefault_th.attr( 'row', '' );\n\t\t\tdefault_th.height( 0 );\n\t\t\tdefault_tr.append( default_th );\n\n\t\t}\n\n\t\tvar first_tr = $( $( table.children()[0] ).children()[0] );\n\n\t\tvar start = this.select_layout.data.display_columns.length + 1;\n\t\t//Create group column header\n\t\tdefault_tr = new_tr.clone();\n\t\tdefault_th = new_th.clone();\n\t\tdefault_th.attr( 'colspan', start );\n\t\tdefault_tr.append( default_th );\n\t\tdefault_tr.insertAfter( first_tr );\n\n\t\tvar current_month = null;\n\t\tvar current_date = null;\n\t\tvar same_month_count = 0;\n\n\t\tfor ( var i = start; i < len; i++ ) {\n\t\t\tth = $( datesTHs[i] );\n\t\t\tvar id_split_array = th.attr( 'id' ).split( '_' );\n\t\t\tvar date_str = id_split_array[id_split_array.length - 1];\n\n\t\t\tif ( date_str === 'shifts' || date_str === 'absences' || date_str === 'total_time' || date_str === 'total_time_wage' ) {\n\t\t\t\tvar month = '-1';\n\t\t\t} else {\n\t\t\t\tmonth = Global.strToDate( date_str, this.full_format ).getMonth();\n\t\t\t}\n\n\t\t\tif ( !Global.isSet( current_month ) ) {\n\t\t\t\tcurrent_month = month;\n\t\t\t\tcurrent_date = date_str;\n\t\t\t\tsame_month_count = 1;\n\n\t\t\t} else {\n\t\t\t\tvar month_header_text = Global.strToDate( current_date, this.full_format ).format( 'MMM' );\n\t\t\t\tif ( month === current_month && i !== len - 1 ) {\n\t\t\t\t\tsame_month_count = same_month_count + 1;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tif ( i === len - 1 ) {\n\t\t\t\t\t\tif ( month !== current_month && !isNaN( month ) ) {\n\t\t\t\t\t\t\tdefault_th.children( 0 ).text( month_header_text );\n\t\t\t\t\t\t\tdefault_th.attr( 'colspan', same_month_count );\n\t\t\t\t\t\t\tdefault_tr.append( default_th );\n\n\t\t\t\t\t\t\tcurrent_month = month;\n\t\t\t\t\t\t\tcurrent_date = date_str;\n\t\t\t\t\t\t\tsame_month_count = 1;\n\n\t\t\t\t\t\t\tdefault_th = new_th.clone();\n\t\t\t\t\t\t\tdefault_th.children( 0 ).text( month_header_text );\n\t\t\t\t\t\t\tdefault_th.attr( 'colspan', same_month_count );\n\t\t\t\t\t\t\tdefault_tr.append( default_th );\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsame_month_count = same_month_count + 1;\n\n\t\t\t\t\t\t\tdefault_th = new_th.clone();\n\t\t\t\t\t\t\tdefault_th.children( 0 ).text( month_header_text );\n\t\t\t\t\t\t\tdefault_th.attr( 'colspan', same_month_count );\n\t\t\t\t\t\t\tdefault_tr.append( default_th );\n\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdefault_th = new_th.clone();\n\t\t\t\t\t\tdefault_th.children( 0 ).text( month_header_text );\n\t\t\t\t\t\tdefault_th.attr( 'colspan', same_month_count );\n\t\t\t\t\t\tdefault_tr.append( default_th );\n\n\t\t\t\t\t\tcurrent_month = month;\n\t\t\t\t\t\tcurrent_date = date_str;\n\t\t\t\t\t\tsame_month_count = 1;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( month === '-1' ) {\n\t\t\t\t\t\tdefault_th = new_th.clone();\n\t\t\t\t\t\tdefault_th.children( 0 ).text( '' );\n\t\t\t\t\t\tdefault_th.attr( 'colspan', len - i );\n\t\t\t\t\t\tdefault_tr.append( default_th );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n\n\tsetMonthDateRowPosition() {\n\n\t\tif ( this.getMode() !== ScheduleViewControllerMode.MONTH ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar $this = this;\n\t\tthis.month_date_row_position = {};\n\t\tvar i = 0;\n\t\tfor ( var key in this.month_date_row_tr_ids ) {\n\t\t\tthis.month_date_row_position[i] = this.grid.grid.find( '#' + key ).position().top;\n\t\t\ti = i + 1;\n\t\t}\n\n\t\tthis.grid.grid.parent().parent().scroll( function() {\n\t\t\tvar top = $( this ).scrollTop();\n\n\t\t\tvar start_day = $this.start_date.getDay();\n\n\t\t\tif ( top < $this.month_date_row_position[0] && $this.month_current_header_number !== 0 ) {\n\n\t\t\t\t//Deal with header before first date row.\n\t\t\t\t$this.month_date_row_tr_ids = {};\n\t\t\t\t$this.month_current_header_number = 0;\n\t\t\t\tfor ( var i = 0; i < 7; i++ ) {\n\t\t\t\t\tvar current_date = new Date( new Date( $this.start_date.getTime() ).setDate( $this.start_date.getDate() + i ) );\n\t\t\t\t\tvar header_text = current_date.format( $this.weekly_format );\n\t\t\t\t\tvar header_container = $( $this.el ).find( '#' + $this.ui_id + '_grid_' + data_field );\n\t\t\t\t\tvar data_field = ( ( start_day + i ) % 7 );\n\t\t\t\t\tvar header = $( $this.el ).find( '#jqgh_' + $this.ui_id + '_grid_' + data_field );\n\t\t\t\t\theader.text( header_text );\n\t\t\t\t\theader_container.removeClass( 'highlight-header' );\n\n\t\t\t\t}\n\n\t\t\t\t$this.highLightSelectDay();\n\n\t\t\t} else if ( top > $this.month_date_row_position[0] && top < $this.month_date_row_position[1] && $this.month_current_header_number !== 1 ) {\n\t\t\t\tsetHeaderText( 0, 1 );\n\n\t\t\t} else if ( top > $this.month_date_row_position[1] && top < $this.month_date_row_position[2] && $this.month_current_header_number !== 2 ) {\n\t\t\t\tsetHeaderText( 1, 2 );\n\t\t\t} else if ( top > $this.month_date_row_position[2] && top < $this.month_date_row_position[3] && $this.month_current_header_number !== 3 ) {\n\t\t\t\tsetHeaderText( 2, 3 );\n\t\t\t} else if ( top > $this.month_date_row_position[3] && $this.month_current_header_number !== 4 ) {\n\t\t\t\tsetHeaderText( 3, 4 );\n\t\t\t}\n\n\t\t\tfunction setHeaderText( index, headerNumber ) {\n\t\t\t\t$this.month_date_row_tr_ids = {};\n\t\t\t\t$this.month_current_header_number = headerNumber;\n\t\t\t\tvar date_row = $this.month_date_row_array[index];\n\t\t\t\tfor ( var i = 0; i < 7; i++ ) {\n\t\t\t\t\tvar data_field = ( ( start_day + i ) % 7 );\n\t\t\t\t\tvar header = $( $this.el ).find( '#jqgh_' + $this.ui_id + '_grid_' + data_field );\n\t\t\t\t\tvar header_container = $( $this.el ).find( '#' + $this.ui_id + '_grid_' + data_field );\n\t\t\t\t\theader_container.removeClass( 'highlight-header' );\n\t\t\t\t\tvar full_date = date_row[data_field + '_full_date'];\n\t\t\t\t\tvar date_cell = $( $this.el ).find( '#' + $this.ui_id + '_grid_' + full_date );\n\n\t\t\t\t\tif ( date_cell.hasClass( 'highlight-header' ) ) {\n\t\t\t\t\t\theader_container.addClass( 'highlight-header' );\n\t\t\t\t\t}\n\t\t\t\t\theader.html( date_row[data_field] );\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t} );\n\t}\n\n\tsetGridHeight() {\n\t\tlet scroll_height = document.body.scrollHeight;\n\n\t\tlet height = scroll_height;\n\n\t\tlet table_body = document.querySelector( 'div.ui-jqgrid-bdiv.ui-corner-bottom' );\n\t\tlet context_border = document.querySelector( 'div.context-border' );\n\t\t//Issue #3060 - JavaScript exceptions of trying to read getBoundingClientRect of null elements.\n\t\tif ( !table_body || !context_border ) {\n\t\t\treturn scroll_height;\n\t\t}\n\n\t\theight -= table_body.getBoundingClientRect().top;\n\t\theight -= ( scroll_height - context_border.getBoundingClientRect().bottom );\n\t\theight -= 10; //Manual fine tuning to fit better.\n\n\t\tif ( this.getMode() != ScheduleViewControllerMode.DAY ) {\n\t\t\tvar grid_div = $( '.schedule-view .grid-div .ui-jqgrid-bdiv' );\n\t\t\tif ( grid_div && grid_div.length > 0 && grid_div[0].scrollWidth > ( $( '.context-border' ).width() + 2 ) ) { //this plus 2 is because sometimes the scroll width is larger than the view width with no scrollbar\n\t\t\t\theight -= Global.getScrollbarWidth(); //scrollbar compensation\n\t\t\t}\n\t\t}\n\n\t\tthis.grid.setGridHeight( height );\n\t\treturn height;\n\t}\n\n\tsetGridColumnsWidth() {\n\t\tvar $this = this;\n\t\tswitch ( this.getMode() ) {\n\t\t\tcase ScheduleViewControllerMode.DAY:\n\t\t\t\tvar day_column_index;\n\n\t\t\t\t//Calculate the exact width of each column that isn't where the shift times are displayed.\n\t\t\t\t//Then any remaining width can be allocated to the shift times column.\n\t\t\t\tvar column_padding = 10;\n\t\t\t\t//var grid_data = this.grid.getData();\n\t\t\t\tvar grid_data = $this.schedule_source; //Must use the original source data, as the this.grid.getData() is not populated yet.\n\t\t\t\tfor ( var i in this.schedule_columns ) {\n\t\t\t\t\tif ( this.schedule_columns[i].is_static_size == true || this.schedule_columns[i].name == 'scrollbar_spacer' ) {\n\t\t\t\t\t\tthis.schedule_columns[i].fixed = true;\n\t\t\t\t\t\tif ( this.schedule_columns[i].name != 'scrollbar_spacer' ) {\n\t\t\t\t\t\t\tday_column_index = i;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//size column based on text.\n\t\t\t\t\t\tvar column_width = Global.calculateTextWidth( this.schedule_columns[i].label ) + column_padding;\n\n\t\t\t\t\t\tif ( grid_data && grid_data.length > 0 ) {\n\t\t\t\t\t\t\tfor ( var row in grid_data ) {\n\t\t\t\t\t\t\t\tvar new_col_width = Global.calculateTextWidth( grid_data[row][this.schedule_columns[i].name] );\n\t\t\t\t\t\t\t\tif ( new_col_width > column_width ) {\n\t\t\t\t\t\t\t\t\tcolumn_width = new_col_width;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.schedule_columns[i].width = column_width;\n\t\t\t\t\t\tthis.schedule_columns[i].fixed = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.calculateScheduleWidth();\n\t\t\t\t$( '.day_hour_div .day_hour_span' ).width( this.day_hour_width );\n\t\t\t\tvar day_column_width = ( this.day_hour_width * $( '.day_hour_div .day_hour_span' ).length ); // 60 is desired width of each day span\n\n\t\t\t\tthis.schedule_columns[day_column_index].width = day_column_width;\n\n\t\t\t\tthis.grid.setGridColumnsWidth( this.schedule_columns );\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tvar column_padding = 15; //Slightly larger padding eliminates a problem with the YEAR mode schedule being off the screen when the employee name is long like: \"Franklin McMichaels\"\n\t\t\t\tvar columns_width = 0;\n\n\t\t\t\t//Day columns must always be the same width, only make the employee name and other static columns variable width.\n\t\t\t\tvar max_width = $( '.context-border' ).width();\n\n\t\t\t\tvar grid_data = $this.schedule_source; //Must use the original source data, as the this.grid.getData() is not populated yet.\n\t\t\t\tfor ( var i in this.schedule_columns ) {\n\t\t\t\t\tif ( !this.schedule_columns[i].is_static_size || this.schedule_columns[i].is_static_size == false ) {\n\t\t\t\t\t\t//size column based on text.\n\t\t\t\t\t\tvar column_width = Global.calculateTextWidth( this.schedule_columns[i].label, { padding: column_padding } );\n\n\t\t\t\t\t\tif ( grid_data && grid_data.length > 0 ) {\n\t\t\t\t\t\t\tvar label_cache = [];\n\n\t\t\t\t\t\t\tfor ( var row in grid_data ) {\n\t\t\t\t\t\t\t\tvar label = grid_data[row][this.schedule_columns[i].name];\n\t\t\t\t\t\t\t\tif ( !label_cache[label]) { //Cache labels we have already calculated the size on, so we don't do it over and over again.\n\t\t\t\t\t\t\t\t\tvar new_col_width = Global.calculateTextWidth( label, { padding: column_padding } );\n\t\t\t\t\t\t\t\t\tif ( new_col_width > column_width ) {\n\t\t\t\t\t\t\t\t\t\tcolumn_width = new_col_width;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tlabel_cache[label] = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlabel_cache = null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.schedule_columns[i].width = column_width;\n\t\t\t\t\t\tthis.schedule_columns[i].fixed = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tcolumns_width += this.schedule_columns[i].width;\n\t\t\t\t}\n\n\t\t\t\t//Resize first column to fill screen.\n\t\t\t\tif ( this.schedule_columns[0] && columns_width < max_width ) {\n\t\t\t\t\tthis.schedule_columns[0].width += ( max_width - columns_width );\n\t\t\t\t}\n\n\t\t\t\tthis.grid.setGridColumnsWidth( this.schedule_columns );\n\n\t\t\t\tif ( this.getMode() == ScheduleViewControllerMode.YEAR ) {\n\t\t\t\t\tthis.setYearGroupHeader(); //Must go after the column widths are changed.\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t}\n\n\t\tthis.setGridHeight();\n\t}\n\n\tbuildScheduleSource() {\n\t\tthis.no_date_array = [];\n\t\tthis.has_date_array = [];\n\t\tthis.final_schedule_data_array = [];\n\t\tvar mode = this.getMode();\n\n\t\tthis.no_date_array = this.buildNoDateArray();\n\t\tthis.has_date_array = this.buildHasDateArray();\n\t\tvar has_date_temp_array_length = this.has_date_array.length;\n\t\tvar sort_fields = this.buildSortFields();\n\t\tthis.has_date_array.sort( Global.m_sort_by( sort_fields ) );\n\t\tthis.no_date_array.sort( Global.m_sort_by( sort_fields ) );\n\n\t\tif ( mode !== ScheduleViewControllerMode.MONTH ) {\n\t\t\tthis.final_schedule_data_array = this.no_date_array.concat( this.has_date_array );\n\t\t}\n\n\t\tswitch ( this.getMode() ) {\n\t\t\tcase ScheduleViewControllerMode.WEEK:\n\t\t\t\tthis.buildWeeklySource();\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerMode.MONTH:\n\t\t\t\tthis.buildMonthSource();\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerMode.YEAR:\n\t\t\t\tthis.buildYearlySource();\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerMode.DAY:\n\t\t\t\tthis.buildDailySource();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tbuildShiftKey( shift ) {\n\n\t\tvar key = '';\n\t\tfor ( var i = 0; i < this.shift_key_name_array.length; i++ ) {\n\t\t\tvar field_name = this.shift_key_name_array[i];\n\t\t\tvar column_name = this.shift_key_name_array[i].replace( '_id', '' ); //judge if shit has correct field value\n\t\t\tif ( column_name !== 'user' ) {\n\t\t\t\tif ( shift[column_name] ) {\n\t\t\t\t\tkey = shift[field_name] + '-' + key;\n\t\t\t\t} else {\n\t\t\t\t\tkey = 0 + '-' + key;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tkey = shift[field_name] + '-' + key;\n\t\t\t}\n\t\t}\n\t\treturn key;\n\t}\n\n\tbuildMonthSource() {\n\t\tvar $this = this;\n\t\tvar date_row_index = 0;\n\t\tvar month_week_data_index = 0;\n\t\tvar date_row = this.month_date_row_array[date_row_index];\n\t\tvar start_day = this.start_date.getDay(); //start from first date row, not include column\n\t\tvar first_day_time = date_row[start_day + '_time'];\n\t\tvar month_week_data_array = [];\n\t\tvar has_date_array = this.has_date_array.slice();\n\t\tfor ( var j = 0; j < 5; j++ ) {\n\t\t\tvar current_week_array = [];\n\t\t\tvar len = has_date_array.length;\n\t\t\tvar is_last_row = false;\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\n\t\t\t\tvar shift = has_date_array[i];\n\t\t\t\tvar date = Global.strToDate( shift.date_stamp );\n\t\t\t\tvar time = date.getTime();\n\n\t\t\t\tif ( time < first_day_time ) {\n\n\t\t\t\t\thas_date_array.splice( i, 1 );\n\n\t\t\t\t\ti = i - 1;\n\t\t\t\t\tlen = len - 1;\n\n\t\t\t\t\tcurrent_week_array.push( shift );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( this.settings_menu.getButton( 'all_employee_btn' ).active ) {\n\t\t\t\tif ( j === 0 ) {\n\t\t\t\t\tcurrent_week_array = this.no_date_array.slice().concat( current_week_array );\n\t\t\t\t} else {\n\t\t\t\t\t// only first week empty users are comming from API, calculate all other weeks data\n\t\t\t\t\tvar no_date_array = this.buildMonthWeekNoDateArray( current_week_array );\n\t\t\t\t\tcurrent_week_array = no_date_array.slice().concat( current_week_array );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tmonth_week_data_array[month_week_data_index] = current_week_array;\n\t\t\tif ( date_row_index > 2 ) {\n\t\t\t\tis_last_row = true;\n\t\t\t} else if ( date_row_index === 2 && !this.month_date_row_array[3].hasOwnProperty( 0 ) ) {\n\t\t\t\tis_last_row = true;\n\t\t\t}\n\t\t\tif ( !is_last_row ) {\n\t\t\t\tdate_row_index = date_row_index + 1;\n\t\t\t\tmonth_week_data_index = month_week_data_index + 1;\n\t\t\t\tdate_row = this.month_date_row_array[date_row_index];\n\t\t\t\tfirst_day_time = date_row[start_day + '_time'];\n\t\t\t} else {\n\t\t\t\tmonth_week_data_index = month_week_data_index + 1;\n\n\t\t\t\t//Don't use this.end_date because the end date may larger than the last day of this month. Use the last date in date row\n\t\t\t\tvar end_date_time = this.getLastDateOfRow( this.month_date_row_array[date_row_index] );\n\t\t\t\tvar end_date = new Date( end_date_time );\n\t\t\t\tfirst_day_time = new Date( end_date.setDate( end_date.getDate() + 1 ) ).getTime();\n\t\t\t}\n\t\t}\n\n\t\tbuildMonthWeeklyData( -1, month_week_data_array[0] );\n\t\tbuildMonthWeeklyData( 0, month_week_data_array[1] );\n\t\tbuildMonthWeeklyData( 1, month_week_data_array[2] );\n\t\tbuildMonthWeeklyData( 2, month_week_data_array[3] );\n\t\tbuildMonthWeeklyData( 3, month_week_data_array[4] );\n\n\t\tfunction buildMonthWeeklyData( rowIndex, source_array ) {\n\t\t\tif ( source_array.length < 1 ) {\n\t\t\t\tbuildEmptyRow( rowIndex );\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar map = {};\n\t\t\tvar len = source_array.length;\n\t\t\tvar push_to_last = false;\n\n\t\t\tif ( rowIndex === $this.month_date_row_array.length - 1 ) {\n\t\t\t\tpush_to_last = true;\n\t\t\t} else {\n\t\t\t\tvar date_row = $this.month_date_row_array[rowIndex + 1];\n\t\t\t\tvar index = 0;\n\t\t\t}\n\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\tvar shift = source_array[i];\n\t\t\t\tvar date_string;\n\t\t\t\tif ( shift.date_stamp ) {\n\t\t\t\t\tvar date = Global.strToDate( shift.date_stamp );\n\n\t\t\t\t\tdate_string = date.getDay();\n\t\t\t\t}\n\n\t\t\t\tvar key = $this.buildShiftKey( shift );\n\n\t\t\t\t// each row of schedule data, start from first row\n\t\t\t\tif ( !map[key] ) {\n\t\t\t\t\tvar row = {};\n\t\t\t\t\trow.user_full_name = shift.user_full_name;\n\t\t\t\t\trow.last_name = shift.last_name;\n\t\t\t\t\trow.user_id = shift.user_id;\n\t\t\t\t\trow.branch_id = shift.branch_id;\n\t\t\t\t\trow.department_id = shift.department_id;\n\t\t\t\t\trow.schedule_policy_id = shift.schedule_policy_id;\n\t\t\t\t\trow.job_id = shift.job_id;\n\t\t\t\t\trow.job_item_id = shift.job_item_id;\n\t\t\t\t\trow.punch_tag_id = shift.punch_tag_id;\n\n\t\t\t\t\tvar display_columns = $this.select_layout.data.display_columns;\n\t\t\t\t\tvar display_columns_len = display_columns.length;\n\n\t\t\t\t\tfor ( var j = 0; j < display_columns_len; j++ ) {\n\t\t\t\t\t\tvar field_name = display_columns[j];\n\t\t\t\t\t\trow[field_name] = shift[field_name] ? shift[field_name] : '';\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( date_string >= 0 ) {\n\t\t\t\t\t\tif ( shift.status_id == 20 ) {\n\n\t\t\t\t\t\t\trow[date_string] = $this.getAbsenceCellValue( shift );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trow[date_string] = shift.start_time + ' - ' + shift.end_time;\n\t\t\t\t\t\t}\n\t\t\t\t\t\trow[date_string + '_data'] = shift;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( !push_to_last ) {\n\t\t\t\t\t\tindex = $this.schedule_source.indexOf( date_row );\n\t\t\t\t\t\t$this.schedule_source.splice( index, 0, row );\n\t\t\t\t\t\tmap[key] = [index];\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$this.schedule_source.push( row );\n\t\t\t\t\t\tmap[key] = [$this.schedule_source.length - 1];\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\t// if one row already created, go to here to create cells in this row\n\n\t\t\t\t\tvar find_position = false;\n\t\t\t\t\tfor ( var x = 0; x < map[key].length; x++ ) {\n\t\t\t\t\t\tvar row_index = map[key][x];\n\t\t\t\t\t\trow = $this.schedule_source[row_index];\n\t\t\t\t\t\tif ( row[date_string] ) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tif ( date_string >= 0 ) {\n\t\t\t\t\t\t\t\tif ( shift.status_id == 20 ) {\n\n\t\t\t\t\t\t\t\t\trow[date_string] = $this.getAbsenceCellValue( shift );\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\trow[date_string] = shift.start_time + ' - ' + shift.end_time;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\trow[date_string + '_data'] = shift;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tfind_position = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( !find_position ) {\n\t\t\t\t\t\trow = {};\n\t\t\t\t\t\trow.user_full_name = shift.user_full_name;\n\t\t\t\t\t\trow.last_name = shift.last_name;\n\t\t\t\t\t\trow.user_id = shift.user_id;\n\t\t\t\t\t\trow.branch_id = shift.branch_id;\n\t\t\t\t\t\trow.department_id = shift.department_id;\n\t\t\t\t\t\trow.schedule_policy_id = shift.schedule_policy_id;\n\t\t\t\t\t\trow.job_id = shift.job_id;\n\t\t\t\t\t\trow.job_item_id = shift.job_item_id;\n\t\t\t\t\t\trow.punch_tag_id = shift.punch_tag_id;\n\n\t\t\t\t\t\tdisplay_columns = $this.select_layout.data.display_columns;\n\t\t\t\t\t\tdisplay_columns_len = display_columns.length;\n\n\t\t\t\t\t\tfor ( var j = 0; j < display_columns_len; j++ ) {\n\t\t\t\t\t\t\tfield_name = display_columns[j];\n\t\t\t\t\t\t\trow[field_name] = shift[field_name] ? shift[field_name] : '';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( date_string >= 0 ) {\n\t\t\t\t\t\t\tif ( shift.status_id == 20 ) {\n\n\t\t\t\t\t\t\t\trow[date_string] = $this.getAbsenceCellValue( shift );\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\trow[date_string] = shift.start_time + ' - ' + shift.end_time;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\trow[date_string + '_data'] = shift;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( !push_to_last ) {\n\t\t\t\t\t\t\tindex = $this.schedule_source.indexOf( date_row );\n\t\t\t\t\t\t\t$this.schedule_source.splice( index, 0, row );\n\t\t\t\t\t\t\tmap[key].push( index );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$this.schedule_source.push( row );\n\t\t\t\t\t\t\tmap[key].push( $this.schedule_source.length - 1 );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t\tif ( source_array.length > 0 ) {\n\t\t\t\tbuildEmptyRow( rowIndex, true );\n\t\t\t}\n\t\t}\n\n\t\tfunction buildEmptyRow( date_row_index, add_last ) {\n\t\t\tif ( add_last ) {\n\t\t\t\tdate_row_index = date_row_index + 1;\n\t\t\t}\n\t\t\tif ( date_row_index === -1 ) {\n\t\t\t\tvar index = 0;\n\t\t\t} else {\n\t\t\t\tvar date_row = $this.month_date_row_array[date_row_index];\n\t\t\t\tif ( add_last ) {\n\t\t\t\t\tif ( date_row ) {\n\t\t\t\t\t\tindex = $this.schedule_source.indexOf( date_row );\n\t\t\t\t\t} else {\n\t\t\t\t\t\tindex = $this.schedule_source.length;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tindex = $this.schedule_source.indexOf( date_row ) + 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar row = $this.getEmptyWeeklyRow();\n\t\t\trow.type = ScheduleViewControllerRowType.EMPTY;\n\t\t\t$this.schedule_source.splice( index, 0, row );\n\t\t}\n\n\t\tthis.showDailyTotal();\n\t\tthis.showWeeklyTotal();\n\t}\n\n\tbuildYearlySource() {\n\t\tvar $this = this;\n\t\tvar map = {};\n\t\tthis.schedule_source = [];\n\n\t\tvar len = this.final_schedule_data_array.length;\n\n\t\tif ( len < 1 ) {\n\t\t\tbuildEmptyRow();\n\t\t\treturn;\n\t\t}\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar shift = this.final_schedule_data_array[i];\n\t\t\tvar date_string = '';\n\t\t\tif ( shift.date_stamp ) {\n\t\t\t\tvar date = Global.strToDate( shift.date_stamp );\n\t\t\t\tdate_string = date.format( this.full_format );\n\t\t\t}\n\n\t\t\tvar key = this.buildShiftKey( shift );\n\n\t\t\t// each row of schedule data, start from first row\n\t\t\tif ( !map[key] ) {\n\t\t\t\tvar row = {};\n\t\t\t\trow.user_full_name = shift.user_full_name;\n\t\t\t\trow.last_name = shift.last_name;\n\t\t\t\trow.user_id = shift.user_id;\n\t\t\t\trow.branch_id = shift.branch_id;\n\t\t\t\trow.department_id = shift.department_id;\n\t\t\t\trow.schedule_policy_id = shift.schedule_policy_id;\n\t\t\t\trow.job_id = shift.job_id;\n\t\t\t\trow.job_item_id = shift.job_item_id;\n\t\t\t\trow.punch_tag_id = shift.punch_tag_id;\n\n\t\t\t\tvar display_columns = this.select_layout.data.display_columns;\n\t\t\t\tvar display_columns_len = display_columns.length;\n\n\t\t\t\tfor ( var j = 0; j < display_columns_len; j++ ) {\n\t\t\t\t\tvar field_name = display_columns[j];\n\t\t\t\t\trow[field_name] = shift[field_name] ? shift[field_name] : '';\n\t\t\t\t}\n\n\t\t\t\tif ( date_string ) {\n\t\t\t\t\trow[date_string] = shift.status_id == 10 ? 'S' : 'A';\n\t\t\t\t\trow[date_string + '_data'] = shift;\n\t\t\t\t}\n\n\t\t\t\tthis.schedule_source.push( row );\n\t\t\t\tmap[key] = [this.schedule_source.length - 1];\n\t\t\t} else {\n\n\t\t\t\tvar find_position = false;\n\t\t\t\tfor ( var x = 0; x < map[key].length; x++ ) {\n\t\t\t\t\tvar row_index = map[key][x];\n\t\t\t\t\trow = this.schedule_source[row_index];\n\t\t\t\t\tif ( row[date_string] ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tif ( date_string ) {\n\t\t\t\t\t\t\trow[date_string] = shift.status_id == 10 ? 'S' : 'A';\n\t\t\t\t\t\t\trow[date_string + '_data'] = shift;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfind_position = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( !find_position ) {\n\t\t\t\t\trow = {};\n\t\t\t\t\trow.user_full_name = shift.user_full_name;\n\t\t\t\t\trow.last_name = shift.last_name;\n\t\t\t\t\trow.user_id = shift.user_id;\n\t\t\t\t\trow.branch_id = shift.branch_id;\n\t\t\t\t\trow.department_id = shift.department_id;\n\t\t\t\t\trow.schedule_policy_id = shift.schedule_policy_id;\n\t\t\t\t\trow.job_id = shift.job_id;\n\t\t\t\t\trow.job_item_id = shift.job_item_id;\n\t\t\t\t\trow.punch_tag_id = shift.punch_tag_id;\n\n\t\t\t\t\tdisplay_columns = this.select_layout.data.display_columns;\n\t\t\t\t\tdisplay_columns_len = display_columns.length;\n\n\t\t\t\t\tfor ( var j = 0; j < display_columns_len; j++ ) {\n\t\t\t\t\t\tfield_name = display_columns[j];\n\t\t\t\t\t\trow[field_name] = shift[field_name] ? shift[field_name] : '';\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( date_string ) {\n\t\t\t\t\t\trow[date_string] = shift.status_id == 10 ? 'S' : 'A';\n\t\t\t\t\t\trow[date_string + '_data'] = shift;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.schedule_source.push( row );\n\t\t\t\t\tmap[key].push( this.schedule_source.length - 1 );\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction buildEmptyRow() {\n\n\t\t\tvar row = {};\n\t\t\trow.user_full_name = '';\n\t\t\trow.last_name = '';\n\t\t\trow.user_id = '';\n\t\t\trow.branch_id = '';\n\t\t\trow.type = ScheduleViewControllerRowType.EMPTY;\n\t\t\t$this.schedule_source.push( row );\n\t\t}\n\n\t\tthis.showWeeklyTotal();\n\t}\n\n\tbuildDailyHeaders() {\n\t\tvar $this = this;\n\t\tvar col_model = this.schedule_columns;\n\t\tvar label_column = col_model[this.select_layout.data.display_columns.length + 1];\n\t\tvar first_time = -1;\n\t\tvar last_time = -1;\n\t\tvar first_date_time = '';\n\t\tvar last_date_time = '';\n\t\tvar first_time_str = '';\n\t\tvar last_time_str = '';\n\t\tvar len = this.has_date_array.length;\n\t\tif ( len === 0 ) {\n\t\t\tvar res = this.api.getScheduleDefaultData( { async: false } );\n\t\t\tvar data = res.getResult();\n\t\t\tvar selected_date_str = $this.getSelectDate();\n\t\t\tfirst_date_time = selected_date_str + ' ' + data.start_time;\n\t\t\tlast_date_time = selected_date_str + ' ' + data.end_time;\n\t\t\tdoNext();\n\t\t\treturn;\n\t\t}\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar item = this.has_date_array[i];\n\n\t\t\tif ( first_time === -1 ) {\n\t\t\t\tfirst_time = item.start_time_stamp;\n\t\t\t\tfirst_date_time = item.start_date;\n\t\t\t\tfirst_time_str = item.start_time;\n\t\t\t} else if ( item.start_time_stamp < first_time ) {\n\t\t\t\tfirst_time = item.start_time_stamp;\n\t\t\t\tfirst_date_time = item.start_date;\n\t\t\t\tfirst_time_str = item.start_time;\n\t\t\t}\n\n\t\t\tif ( last_time === -1 ) {\n\t\t\t\tlast_time = item.end_time_stamp;\n\t\t\t\tlast_date_time = item.end_date;\n\t\t\t\tlast_time_str = item.end_time;\n\t\t\t} else if ( item.end_time_stamp > last_time ) {\n\t\t\t\tlast_time = item.end_time_stamp;\n\t\t\t\tlast_date_time = item.end_date;\n\t\t\t\tlast_time_str = item.end_time;\n\t\t\t}\n\t\t}\n\n\t\tfirst_date_time = Global.getStandardDateTimeStr( first_date_time, first_time_str );\n\t\tlast_date_time = Global.getStandardDateTimeStr( last_date_time, last_time_str );\n\n\t\tdoNext();\n\n\t\tfunction doNext() {\n\t\t\tvar current_date_time = new Date( Global.strToDateTime( first_date_time ).getTime() - 3600000 );\n\t\t\tlast_date_time = Global.strToDateTime( last_date_time );\n\t\t\tvar min = current_date_time.getMinutes() * 60000;\n\t\t\tvar time_span = $( '<div class=\\'day_hour_span\\'></div>' );\n\t\t\tif ( min > 0 ) {\n\t\t\t\tcurrent_date_time = new Date( current_date_time.getTime() - min );\n\t\t\t}\n\t\t\t$this.day_mode_start_date_time = current_date_time;\n\t\t\tvar time_offset = ( last_date_time.getTime() - current_date_time.getTime() ) / 3600000;\n\t\t\tvar header_container = $( '<div class=\\'day_hour_div\\'></div>' );\n\t\t\tvar day_column = $( '<div class=\\'day-column\\'></div>' );\n\t\t\tvar day = $this.start_date.format( $this.weekly_format );\n\t\t\tday = $this.setHolidayHeader( day, true );\n\t\t\tday_column.text( day );\n\t\t\tvar time_columns = $( '<div style=\"padding:0px !important\"></div>' );\n\t\t\tvar time_string = '';\n\n\t\t\t//var time_format_string = 'hh:mm A';\n\t\t\t// var time_format_string = 'h A';\n\t\t\tvar time_format_string = 'hA';\n\t\t\tfor ( var i = 0; i < time_offset; i++ ) {\n\t\t\t\tvar current_hour_text = time_span.clone();\n\t\t\t\tcurrent_hour_text = current_hour_text.text( current_date_time.format( time_format_string ) );\n\t\t\t\tif ( i < time_offset - 1 ) {\n\t\t\t\t\ttime_string = time_string + current_date_time.format( time_format_string ) + '|';\n\t\t\t\t} else {\n\t\t\t\t\ttime_string = time_string + current_date_time.format( time_format_string );\n\t\t\t\t}\n\t\t\t\ttime_columns.append( current_hour_text );\n\t\t\t\tcurrent_date_time = new Date( current_date_time.getTime() + 3600000 );\n\t\t\t}\n\t\t\theader_container.append( day_column );\n\t\t\theader_container.append( time_columns );\n\t\t\t$this.buildTotalShiftDic( time_string );\n\t\t\tlabel_column.label = header_container[0].outerHTML;\n\t\t\t// Include padding.\n\t\t\tlabel_column.width = $this.day_hour_width * time_offset + 40;\n\t\t\t$this.day_header_width = label_column.width;\n\n\t\t}\n\t}\n\n\t//Build dic that contains all daily hours\n\tbuildTotalShiftDic( timeHeader ) {\n\t\tvar label_array = timeHeader.split( '|' );\n\t\tthis.total_shifts_dic = {};\n\t\tfor ( var i = 0; i < label_array.length; i++ ) {\n\t\t\tvar shift_item = { sort_order: i, key: label_array[i], value: 0 };\n\t\t\tthis.total_shifts_dic[label_array[i]] = shift_item;\n\t\t}\n\t}\n\n\tbuildDailySource() {\n\n\t\tvar $this = this;\n\t\tthis.buildDailyHeaders();\n\n\t\tvar map = {};\n\t\tthis.schedule_source = [];\n\n\t\tvar len = this.final_schedule_data_array.length;\n\n\t\tif ( len < 1 ) {\n\t\t\tbuildEmptyRow();\n\t\t\treturn;\n\t\t}\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar shift = this.final_schedule_data_array[i];\n\t\t\tvar date_string = '';\n\t\t\tif ( shift.date_stamp ) {\n\t\t\t\tvar date = Global.strToDate( shift.date_stamp );\n\t\t\t\tdate_string = date.format( this.full_format );\n\t\t\t}\n\n\t\t\tvar key = this.buildShiftKey( shift );\n\n\t\t\t// each row of schedule data, start from first row\n\t\t\tif ( !map[key] ) {\n\t\t\t\tvar row = {};\n\t\t\t\trow.user_full_name = shift.user_full_name;\n\t\t\t\trow.last_name = shift.last_name;\n\t\t\t\trow.user_id = shift.user_id;\n\t\t\t\trow.branch_id = shift.branch_id;\n\t\t\t\trow.department_id = shift.department_id;\n\t\t\t\trow.schedule_policy_id = shift.schedule_policy_id;\n\t\t\t\trow.job_id = shift.job_id;\n\t\t\t\trow.job_item_id = shift.job_item_id;\n\t\t\t\trow.punch_tag_id = shift.punch_tag_id;\n\t\t\t\trow.total = Global.getTimeUnit( shift.total_time );\n\n\t\t\t\tvar display_columns = this.select_layout.data.display_columns;\n\t\t\t\tvar display_columns_len = display_columns.length;\n\n\t\t\t\tfor ( var j = 0; j < display_columns_len; j++ ) {\n\t\t\t\t\tvar field_name = display_columns[j];\n\t\t\t\t\trow[field_name] = shift[field_name] ? shift[field_name] : '';\n\t\t\t\t}\n\n\t\t\t\tif ( date_string ) {\n\t\t\t\t\tif ( shift.status_id == 20 ) {\n\n\t\t\t\t\t\trow[date_string] = $this.getAbsenceCellValue( shift );\n\t\t\t\t\t} else {\n\t\t\t\t\t\trow[date_string] = shift.start_time + ' - ' + shift.end_time;\n\t\t\t\t\t}\n\t\t\t\t\trow[date_string + '_data'] = shift;\n\t\t\t\t}\n\n\t\t\t\tthis.schedule_source.push( row );\n\t\t\t\tmap[key] = [this.schedule_source.length - 1];\n\t\t\t} else {\n\t\t\t\t// if one row already created, go to here to create cells in this row\n\n\t\t\t\tvar find_position = false;\n\t\t\t\tfor ( var x = 0; x < map[key].length; x++ ) {\n\t\t\t\t\tvar row_index = map[key][x];\n\t\t\t\t\trow = this.schedule_source[row_index];\n\t\t\t\t\tif ( row[date_string] ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tif ( date_string ) {\n\t\t\t\t\t\t\tif ( shift.status_id == 20 ) {\n\n\t\t\t\t\t\t\t\trow[date_string] = $this.getAbsenceCellValue( shift );\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\trow[date_string] = shift.start_time + ' - ' + shift.end_time;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\trow[date_string + '_data'] = shift;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfind_position = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( !find_position ) {\n\t\t\t\t\trow = {};\n\t\t\t\t\trow.user_full_name = shift.user_full_name;\n\t\t\t\t\trow.last_name = shift.last_name;\n\t\t\t\t\trow.user_id = shift.user_id;\n\t\t\t\t\trow.branch_id = shift.branch_id;\n\t\t\t\t\trow.department_id = shift.department_id;\n\t\t\t\t\trow.schedule_policy_id = shift.schedule_policy_id;\n\t\t\t\t\trow.job_id = shift.job_id;\n\t\t\t\t\trow.job_item_id = shift.job_item_id;\n\t\t\t\t\trow.punch_tag_id = shift.punch_tag_id;\n\t\t\t\t\trow.total = Global.getTimeUnit( shift.total_time );\n\n\t\t\t\t\tdisplay_columns = this.select_layout.data.display_columns;\n\t\t\t\t\tdisplay_columns_len = display_columns.length;\n\n\t\t\t\t\tfor ( var j = 0; j < display_columns_len; j++ ) {\n\t\t\t\t\t\tvar field_name = display_columns[j];\n\t\t\t\t\t\trow[field_name] = shift[field_name] ? shift[field_name] : '';\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( date_string ) {\n\t\t\t\t\t\tif ( shift.status_id == 20 ) {\n\n\t\t\t\t\t\t\trow[date_string] = $this.getAbsenceCellValue( shift );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trow[date_string] = shift.start_time + ' - ' + shift.end_time;\n\t\t\t\t\t\t}\n\t\t\t\t\t\trow[date_string + '_data'] = shift;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.schedule_source.push( row );\n\t\t\t\t\tmap[key].push( this.schedule_source.length - 1 );\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction buildEmptyRow() {\n\n\t\t\tvar row = $this.getEmptyWeeklyRow();\n\t\t\trow.type = ScheduleViewControllerRowType.EMPTY;\n\t\t\t$this.schedule_source.push( row );\n\t\t}\n\n\t\tthis.showDailyTotal();\n\t}\n\n\tbuildWeeklySource() {\n\t\tvar $this = this;\n\t\tvar map = {};\n\t\tthis.schedule_source = [];\n\n\t\tvar len = this.final_schedule_data_array.length;\n\n\t\tif ( len < 1 ) {\n\t\t\tbuildEmptyRow();\n\t\t\treturn;\n\t\t}\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar shift = this.final_schedule_data_array[i];\n\t\t\tvar date_string = '';\n\t\t\tif ( shift.date_stamp ) {\n\t\t\t\tvar date = Global.strToDate( shift.date_stamp );\n\t\t\t\tdate_string = date ? date.format( this.full_format ) : null;\n\t\t\t}\n\n\t\t\tvar key = this.buildShiftKey( shift );\n\n\t\t\t// each row of schedule data, start from first row\n\t\t\tif ( !map[key] ) {\n\t\t\t\tvar row = {};\n\t\t\t\trow.user_full_name = shift.user_full_name;\n\t\t\t\trow.last_name = shift.last_name;\n\t\t\t\trow.user_id = shift.user_id;\n\t\t\t\trow.branch_id = shift.branch_id;\n\t\t\t\trow.department_id = shift.department_id;\n\t\t\t\trow.schedule_policy_id = shift.schedule_policy_id;\n\t\t\t\trow.job_id = shift.job_id;\n\t\t\t\trow.job_item_id = shift.job_item_id;\n\t\t\t\trow.punch_tag_id = shift.punch_tag_id;\n\n\t\t\t\tvar display_columns = this.select_layout.data.display_columns;\n\t\t\t\tvar display_columns_len = display_columns.length;\n\n\t\t\t\tfor ( var j = 0; j < display_columns_len; j++ ) {\n\t\t\t\t\tvar field_name = display_columns[j];\n\t\t\t\t\trow[field_name] = shift[field_name] ? shift[field_name] : '';\n\t\t\t\t}\n\n\t\t\t\tif ( date_string ) {\n\n\t\t\t\t\tif ( shift.status_id == 20 ) {\n\n\t\t\t\t\t\trow[date_string] = $this.getAbsenceCellValue( shift );\n\t\t\t\t\t} else {\n\t\t\t\t\t\trow[date_string] = shift.start_time + ' - ' + shift.end_time;\n\t\t\t\t\t}\n\n\t\t\t\t\trow[date_string + '_data'] = shift;\n\t\t\t\t}\n\n\t\t\t\tthis.schedule_source.push( row );\n\t\t\t\tmap[key] = [this.schedule_source.length - 1];\n\t\t\t} else {\n\t\t\t\t// if one row already created, go to here to create cells in this row\n\n\t\t\t\tvar find_position = false;\n\t\t\t\tfor ( var x = 0; x < map[key].length; x++ ) {\n\t\t\t\t\tvar row_index = map[key][x];\n\t\t\t\t\trow = this.schedule_source[row_index];\n\t\t\t\t\tif ( row[date_string] ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tif ( date_string ) {\n\t\t\t\t\t\t\tif ( shift.status_id == 20 ) {\n\n\t\t\t\t\t\t\t\trow[date_string] = $this.getAbsenceCellValue( shift );\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\trow[date_string] = shift.start_time + ' - ' + shift.end_time;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\trow[date_string + '_data'] = shift;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfind_position = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( !find_position ) {\n\t\t\t\t\trow = {};\n\t\t\t\t\trow.user_full_name = shift.user_full_name;\n\t\t\t\t\trow.last_name = shift.last_name;\n\t\t\t\t\trow.user_id = shift.user_id;\n\t\t\t\t\trow.branch_id = shift.branch_id;\n\t\t\t\t\trow.department_id = shift.department_id;\n\t\t\t\t\trow.schedule_policy_id = shift.schedule_policy_id;\n\t\t\t\t\trow.job_id = shift.job_id;\n\t\t\t\t\trow.job_item_id = shift.job_item_id;\n\t\t\t\t\trow.punch_tag_id = shift.punch_tag_id;\n\n\t\t\t\t\tdisplay_columns = this.select_layout.data.display_columns;\n\t\t\t\t\tdisplay_columns_len = display_columns.length;\n\n\t\t\t\t\tfor ( var j = 0; j < display_columns_len; j++ ) {\n\t\t\t\t\t\tfield_name = display_columns[j];\n\t\t\t\t\t\trow[field_name] = shift[field_name] ? shift[field_name] : '';\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( date_string ) {\n\n\t\t\t\t\t\tif ( shift.status_id == 20 ) {\n\n\t\t\t\t\t\t\trow[date_string] = $this.getAbsenceCellValue( shift );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trow[date_string] = shift.start_time + ' - ' + shift.end_time;\n\t\t\t\t\t\t}\n\t\t\t\t\t\trow[date_string + '_data'] = shift;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.schedule_source.push( row );\n\t\t\t\t\tmap[key].push( this.schedule_source.length - 1 );\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction buildEmptyRow() {\n\n\t\t\tvar row = $this.getEmptyWeeklyRow();\n\t\t\trow.type = ScheduleViewControllerRowType.EMPTY;\n\t\t\t$this.schedule_source.push( row );\n\t\t}\n\n\t\tthis.showDailyTotal();\n\t\tthis.showWeeklyTotal();\n\t}\n\n\tgetAbsenceCellValue( shift ) {\n\n\t\tvar result;\n\t\tif ( shift.absence_policy ) {\n\t\t\tif ( shift.note ) {\n\t\t\t\tresult = '*' + shift.absence_policy;\n\t\t\t} else {\n\t\t\t\tresult = shift.absence_policy;\n\t\t\t}\n\t\t} else {\n\t\t\tif ( shift.note ) {\n\t\t\t\tresult = '*' + 'N/A';\n\t\t\t} else {\n\t\t\t\tresult = 'N/A';\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tbuildSortFields() {\n\t\tvar sort_by_fields = [];\n\n\t\t//Error: Uncaught TypeError: Cannot read property 'data' of null in /interface/html5/#!m=Schedule line 5169\n\t\tif ( this.select_layout && this.select_layout.data ) {\n\t\t\tvar display_columns = this.select_layout.data.display_columns;\n\t\t\tvar display_columns_len = display_columns.length;\n\t\t\tif ( display_columns_len > 0 ) {\n\t\t\t\tsort_by_fields = display_columns.slice();\n\t\t\t}\n\t\t}\n\n\t\tsort_by_fields.push( 'user_full_name' );\n\n\t\tsort_by_fields.push( { name: 'start_time_stamp', primer: parseFloat, reverse: false } );\n\n\t\treturn sort_by_fields;\n\t}\n\n\tbuildMonthWeekNoDateArray( current_week_array ) {\n\t\tvar has_date_user_map = {};\n\t\tvar result = [];\n\n\t\tfor ( var i = 0, ii = current_week_array.length; i < ii; i++ ) {\n\t\t\tvar item = Global.clone( current_week_array[i] );\n\t\t\thas_date_user_map[item.user_id] = true;\n\t\t}\n\n\t\tfor ( var key in this.all_user_map ) {\n\t\t\tif ( !has_date_user_map[key] ) {\n\t\t\t\tvar item = Global.clone( this.all_user_map[key] );\n\t\t\t\titem.date_stamp = false;\n\t\t\t\tresult.push( item );\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tbuildNoDateArray() {\n\t\tvar records = [];\n\t\tvar sort_array = [];\n\t\tvar sort_item;\n\t\tvar schedule_data = this.full_schedule_data.schedule_data;\n\t\tfor ( var date_key in schedule_data ) {\n\t\t\tsort_item = {};\n\t\t\tsort_item.value = schedule_data[date_key];\n\t\t\tsort_item.sort_key = date_key;\n\t\t\tsort_array.push( sort_item );\n\t\t}\n\n\t\tvar len = sort_array.length;\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar date_item = sort_array[i];\n\t\t\tfor ( var item_key in date_item.value ) {\n\t\t\t\tvar item = date_item.value[item_key];\n\t\t\t\titem = this.replaceFalseToEmptyStringForSortFields( item );\n\t\t\t\tif ( !item.date_stamp ) {\n\t\t\t\t\trecords.push( date_item.value[item_key] );\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\t\treturn records;\n\t}\n\n\tbuildHasDateArray() {\n\t\tvar records = [];\n\t\tthis.all_user_map = {};\n\t\tvar sort_array = [];\n\t\tvar sort_item;\n\t\tvar schedule_data = this.full_schedule_data.schedule_data;\n\n\t\tfor ( var date_key in schedule_data ) {\n\t\t\tsort_item = {};\n\t\t\tsort_item.value = schedule_data[date_key];\n\t\t\tsort_item.sort_key = date_key;\n\t\t\tsort_array.push( sort_item );\n\t\t}\n\t\tvar len = sort_array.length;\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar date_item = sort_array[i];\n\t\t\tfor ( var item_key in date_item.value ) {\n\t\t\t\tvar item = date_item.value[item_key];\n\t\t\t\titem = this.replaceFalseToEmptyStringForSortFields( item );\n\t\t\t\tthis.all_user_map[item.user_id] = Global.clone( item );\n\t\t\t\tif ( item.date_stamp ) {\n\t\t\t\t\trecords.push( date_item.value[item_key] );\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\t\treturn records;\n\t}\n\n\treplaceFalseToEmptyStringForSortFields( item ) {\n\t\tif ( !item.branch ) {\n\t\t\titem.branch = '';\n\t\t}\n\n\t\tif ( !item.department ) {\n\t\t\titem.department = '';\n\t\t}\n\n\t\tif ( !item.default_branch ) {\n\t\t\titem.default_branch = '';\n\t\t}\n\n\t\tif ( !item.default_department ) {\n\t\t\titem.default_department = '';\n\t\t}\n\n\t\tif ( !item.job ) {\n\t\t\titem.job = '';\n\t\t}\n\n\t\tif ( !item.job_item ) {\n\t\t\titem.job_item = '';\n\t\t}\n\n\t\tif ( !item.title ) {\n\t\t\titem.title = '';\n\t\t}\n\n\t\treturn item;\n\t}\n\n\tcheckIsSelectedCell( row_id, cell_index ) {\n\t\tfor ( var i = 0, m = this.select_cells_Array.length; i < m; i++ ) {\n\t\t\tvar cell = this.select_cells_Array[i];\n\t\t\tif ( cell.row_id.toString() === row_id.toString() && cell.cell_index.toString() === cell_index.toString() ) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tbuildScheduleGrid() {\n\t\tvar $this = this;\n\t\tvar grid;\n\t\tvar grid_id = 'grid';\n\n\t\tif ( !this.grid ) {\n\t\t\tgrid = $( this.el ).find( '#grid' );\n\n\t\t\tgrid.attr( 'id', this.ui_id + '_grid' );  //Grid's id is ScriptName + _grid\n\n\t\t\tgrid_id = this.ui_id + '_grid';\n\t\t} else {\n\t\t\tthis.grid.grid.jqGrid( 'GridUnload', true );\n\t\t\tdelete this.grid;\n\t\t\tthis.grid = null;\n\t\t}\n\n\t\tgrid_id = this.ui_id + '_grid';\n\n\t\tif ( !this.schedule_columns || this.schedule_columns.length == 0 ) {\n\t\t\tthis.buildScheduleColumns();\n\t\t}\n\n\t\tthis.grid = new TTGrid( grid_id, {\n\t\t\tdraggble: true,\n\t\t\taltRows: true,\n\t\t\tdata: [],\n\t\t\tdatatype: 'local',\n\t\t\tsortable: false,\n\t\t\tscrollOffset: 0,\n\t\t\trowNum: 10000,\n\t\t\thoverrows: false,\n\t\t\tmultiselectPosition: 'none',\n\t\t\tondblClickRow: function() {\n\t\t\t\t$this.onGridDblClickRow();\n\t\t\t},\n\t\t\tonSelectRow: function( row_id, flag, e ) {\n\t\t\t\tvar row_tr = $( this ).find( '#' + row_id );\n\t\t\t\trow_tr.removeClass( 'ui-state-highlight' ).attr( 'aria-selected', true );\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tonRightClickRow: function( row_id, iRow, cell_index, e ) {\n\t\t\t\tif ( !$this.checkIsSelectedCell( row_id, cell_index ) ) {\n\t\t\t\t\tvar cell_val = $( e.target ).closest( 'td,th' ).html();\n\t\t\t\t\tvar row_tr = $( this ).find( '#' + row_id );\n\t\t\t\t\trow_tr.removeClass( 'ui-state-highlight' ).attr( 'aria-selected', true );\n\t\t\t\t\t$this.onCellSelect( 'timesheet_grid', row_id, cell_index, cell_val, this, e );\n\t\t\t\t}\n\t\t\t},\n\t\t\tonCellSelect: function( row_id, cell_index, cell_val, e ) {\n\t\t\t\t$this.onCellSelect( 'timesheet_grid', row_id, cell_index, cell_val, this, e );\n\t\t\t},\n\t\t\tcolNames: [],\n\t\t\t//colModel: this.schedule_columns,\n\t\t\tviewrecords: true,\n\t\t\twinMultiSelect: false,\n\t\t\tsetGridSize: function() {\n\t\t\t\t$this.setGridHeight();\n\t\t\t},\n\t\t\tonResizeGrid: function() {\n\t\t\t\t$this.onResizeGrid(); //Because we have the daily/weekly totals and mode buttons, we need custom grid height logic.\n\t\t\t}\n\t\t}, this.schedule_columns );\n\n\t\tthis.grid.grid.parent().parent().scrollLeft( 1000 );\n\n\t\tthis.grid.grid.parent().parent().scroll( function( e ) {\n\t\t\t$this.scroll_position = $( e.target ).scrollTop();\n\t\t} );\n\n\t\tthis.bindGridColumnEvents();\n\t}\n\n\tonResizeGrid() {\n\t\tif ( this.getMode() == ScheduleViewControllerMode.DAY ) {\n\t\t\t//Rebuild the special shift sizes\n\t\t\tthis.buildCalendars();\n\t\t} else {\n\t\t\tthis.setGridColumnsWidth();\n\t\t}\n\n\t\tthis.setGridHeight();\n\t}\n\n\t//Bind column click event to change sort type and save columns to t_grid_header_array to use to set column style (asc or desc)\n\tbindGridColumnEvents() {\n\t\tvar display_columns = this.grid.getGridParam( 'colModel' );\n\n\t\t//Exception taht display column not existed, not sure when this will happen, but may there will be a second time load if this happen\n\t\tif ( !display_columns ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar len = display_columns.length;\n\n\t\tthis.t_grid_header_array = [];\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar column_info = display_columns[i];\n\t\t\tvar column_header = $( $( this.el ).find( '#gbox_' + this.ui_id + '_grid' ).find( 'div #jqgh_' + this.ui_id + '_grid_' + column_info.name ) );\n\n\t\t\tthis.t_grid_header_array.push( column_header.TGridHeader() );\n\t\t\tcolumn_header.bind( 'click', onColumnHeaderClick );\n\t\t}\n\n\t\tvar $this = this;\n\n\t\tfunction onColumnHeaderClick( e ) {\n\t\t\tvar field = $( this ).attr( 'id' );\n\t\t\tfield = field.substring( 10 + $this.ui_id.length + 1, field.length );\n\n\t\t\tif ( field === 'cb' || field === 'punch_info' ) { //first column, check box column.\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar date;\n\t\t\tvar mode = $this.getMode();\n\n\t\t\tif ( mode === ScheduleViewControllerMode.MONTH ) {\n\t\t\t\tvar colModel = $this.grid.getGridParam( 'colModel' );\n\t\t\t\tdate = $this.getCellRelatedDate( 1, colModel, $( this ).parent().index(), field );\n\t\t\t} else {\n\t\t\t\tdate = Global.strToDate( field, $this.full_format );\n\t\t\t}\n\n\t\t\tif ( date && date.getYear() > 0 ) {\n\t\t\t\t$this.setDatePickerValue( date.format( Global.getLoginUserDateFormat() ) );\n\t\t\t\t$this.highLightSelectDay();\n\t\t\t}\n\n\t\t}\n\t}\n\n\tbuildMonthCell( cell_value, related_data, row, is_day_column ) {\n\t\tvar col_models = this.grid.getGridParam( 'colModel' );\n\t\tvar col_model = related_data.colModel;\n\t\tvar content_div = $( '<div class=\\'schedule-content-div\\'></div>' );\n\t\tif ( is_day_column ) {\n\t\t\tcontent_div.addClass( 'date-column' );\n\t\t}\n\t\tvar time_span = $( '<span class=\\'schedule-time\\' ></span>' );\n\t\tvar item = row[col_model.name + '_data'];\n\t\tvar full_date_str = row[col_model.name + '_full_date'];\n\n\t\tswitch ( row.type ) {\n\t\t\tcase ScheduleViewControllerRowType.TOTAL:\n\t\t\t\ttime_span = $( '<span class=\\'schedule-time total\\'></span>' );\n\t\t\t\tif ( this.select_layout.data.display_columns.indexOf( col_model.index ) === -1 && ['user_full_name', 'shifts', 'absences', 'total_time', 'total_time_wage'].indexOf( col_model.index ) === -1 ) {\n\t\t\t\t\tif ( !cell_value ) {\n\t\t\t\t\t\tvar cell_value = { shifts: 0, absences: 0, total_time: 0, total_time_wage: 0 };\n\t\t\t\t\t}\n\n\t\t\t\t\tvar total_span = $( '<span class=\\'schedule-time total\\'></span>' );\n\t\t\t\t\tvar currency = LocalCacheData.getCurrentCurrencySymbol();\n\t\t\t\t\ttime_span.text( 'S: ' + cell_value.shifts + ' A: ' + cell_value.absences );\n\t\t\t\t\ttotal_span.text( Global.getTimeUnit( cell_value.total_time ) + ' = ' + currency + Global.MoneyRound( cell_value.total_time_wage ) );\n\n\t\t\t\t\tcontent_div.prepend( total_span );\n\t\t\t\t\tcontent_div.prepend( time_span );\n\t\t\t\t\tcontent_div.css( 'height', 'auto' );\n\t\t\t\t} else {\n\t\t\t\t\ttime_span.text( cell_value );\n\t\t\t\t\tcontent_div.prepend( time_span );\n\n\t\t\t\t\tif ( related_data.pos === col_models.length - 1 ) {\n\t\t\t\t\t\tcontent_div.css( 'padding-right', '15px' );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerRowType.DATE:\n\t\t\t\ttime_span.addClass( 'date' );\n\t\t\t\tcontent_div.addClass( 'month-date-cell' );\n\t\t\t\tif ( cell_value ) {\n\n\t\t\t\t\ttime_span.html( cell_value );\n\n\t\t\t\t\tcontent_div.attr( 'id', this.ui_id + '_grid_' + full_date_str );\n\n\t\t\t\t} else {\n\t\t\t\t\ttime_span.addClass( 'empty-date' );\n\t\t\t\t\ttime_span.text( '.' );\n\t\t\t\t}\n\n\t\t\t\tcontent_div.prepend( time_span );\n\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerRowType.EMPTY:\n\n\t\t\t\tif ( !Global.isSet( cell_value ) ) {\n\t\t\t\t\ttime_span.text( '' );\n\t\t\t\t}\n\n\t\t\t\ttime_span.addClass( 'empty' );\n\n\t\t\t\tcontent_div.prepend( time_span );\n\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tif ( Global.isSet( item ) ) {\n\n\t\t\t\t\tif ( !Global.isSet( item.id ) || !item.id || ( item.id && item.id == TTUUID.zero_id ) ) {\n\t\t\t\t\t\ttime_span.addClass( 'no-id' );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( item.status_id == 20 ) {\n\t\t\t\t\t\ttime_span.addClass( 'red' );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( item.user_id === TTUUID.zero_id ) {\n\t\t\t\t\t\tcontent_div.addClass( 'yellow-outline' );\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( Global.isSet( cell_value ) ) {\n\t\t\t\t\tif ( Global.isSet( item ) && item.note && cell_value.indexOf( '*' ) == -1 ) {\n\t\t\t\t\t\tcell_value = '*' + cell_value;\n\t\t\t\t\t}\n\t\t\t\t\ttime_span.text( cell_value );\n\n\t\t\t\t\tif ( related_data.pos === col_models.length - 1 ) {\n\t\t\t\t\t\tcontent_div.css( 'padding-right', '15px' );\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\ttime_span.text( '' );\n\t\t\t\t}\n\t\t\t\tcontent_div.prepend( time_span );\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn content_div.get( 0 ).outerHTML;\n\t}\n\n\tbuildYearCell( cell_value, related_data, row, is_day_column ) {\n\t\tvar col_models = this.grid.getGridParam( 'colModel' );\n\t\tvar col_model = related_data.colModel;\n\t\tvar content_div = $( '<div class=\\'schedule-content-div\\'></div>' );\n\n\t\tif ( cell_value && cell_value.length == 1 && row.user_full_name == $.i18n._( 'OPEN' ) ) { //#2353 - only way to match open shifts.\n\t\t\tcontent_div.addClass( 'yellow-outline' );\n\t\t}\n\n\t\tif ( is_day_column ) {\n\t\t\tcontent_div.addClass( 'date-column' );\n\t\t}\n\n\t\tif ( !cell_value ) {\n\t\t\t//performance hack to speed up dom and rendering of year mode sheet\n\t\t\treturn content_div.get( 0 ).outerHTML;\n\t\t}\n\t\tvar time_span = $( '<span class=\\'schedule-time\\'></span>' );\n\t\tvar item = row[col_model.name + '_data'];\n\n\t\tswitch ( row.type ) {\n\t\t\tcase ScheduleViewControllerRowType.EMPTY:\n\t\t\t\ttime_span.addClass( 'empty' );\n\n\t\t\t\tcontent_div.prepend( time_span );\n\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tif ( col_model.index >= 0 ) {\n\t\t\t\t\tif ( item && ( !item.id || ( item.id && item.id == TTUUID.zero_id ) ) ) {\n\t\t\t\t\t\ttime_span.addClass( 'no-id' );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( cell_value === 'A' ) {\n\t\t\t\t\t\ttime_span.addClass( 'absence-cell' );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( Global.isSet( cell_value ) ) {\n\t\t\t\t\ttime_span.text( cell_value );\n\t\t\t\t} else {\n\t\t\t\t\ttime_span.text( '' );\n\t\t\t\t}\n\n\t\t\t\t// if ( related_data.pos === col_models.length - 1 ) {\n\t\t\t\t// \tcontent_div.css( 'padding-right', '15px' );\n\t\t\t\t// }\n\n\t\t\t\t//\n\t\t\t\t// if ( item && row.full_user_name == $.i18n._('OPEN') ) {\n\t\t\t\t// \tcontent_div.removeClass('date-column')\n\t\t\t\t// \tcontent_div.addClass( 'yellow-outline' );\n\t\t\t\t// }\n\n\t\t\t\tcontent_div.prepend( time_span );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\treturn content_div[0].outerHTML;\n\t}\n\n\tcalculateScheduleWidth() {\n\t\t//Calculate width of all static columns like employee name, departments, total, etc... So we know how much room is left for the hours.\n\t\tvar static_width = 0;\n\t\tfor ( var i in this.schedule_columns ) {\n\t\t\tif ( !this.schedule_columns[i].is_static_size || this.schedule_columns[i].name == 'total' || this.schedule_columns[i].name == 'scrollbar_spacer' ) {\n\t\t\t\tstatic_width += this.schedule_columns[i].width;\n\t\t\t}\n\t\t}\n\n\t\tif ( this.grid_div[0] && this.grid && ( Global.isVerticalScrollBarRequired( this.grid_div[0] ) || this.grid.getGridParam().height < this.grid_div[0].offsetHeight ) ) {\n\t\t\t//This stops showing a redundant horizontal scrollbar that only exists to show the vertical scrollbar.\n\t\t\tstatic_width += Global.getScrollbarWidth();\n\t\t}\n\n\t\tthis.day_hour_width = Math.floor( ( $( '.context-border' ).innerWidth() - static_width ) / $( '.day_hour_div .day_hour_span' ).length );\n\t\tDebug.Text( 'Day Hour Width: ' + this.day_hour_width + ' Static Width: ' + static_width, 'ScheduleViewController.js', 'ScheduleViewController', 'calculateScheduleWidth', 10 );\n\n\t\tif ( this.day_hour_width < 40 ) {\n\t\t\tthis.day_hour_width = 40;\n\t\t}\n\t\treturn this.day_hour_width;\n\t}\n\n\tbuildDayCell( cell_value, related_data, row, is_day_column ) {\n\t\tvar $this = this;\n\t\tvar col_model = related_data.colModel;\n\t\tvar content_div = $( '<div class=\\'schedule-content-div\\'></div>' );\n\t\tif ( is_day_column ) {\n\t\t\tcontent_div.addClass( 'date-column' );\n\t\t}\n\t\tvar time_span = $( '<span class=\\'schedule-time\\'></span>' );\n\t\tvar item = row[col_model.index + '_data'];\n\n\t\tswitch ( row.type ) {\n\t\t\tcase ScheduleViewControllerRowType.TOTAL:\n\n\t\t\t\tif ( cell_value && Global.isSet( cell_value.total_time ) ) {\n\t\t\t\t\tvar total_div = $( '<div  style=\\'text-align: left\\'></div>' );\n\t\t\t\t\tvar currency = LocalCacheData.getCurrentCurrencySymbol();\n\t\t\t\t\ttime_span = $( '<span class=\\'schedule-time total\\'></span>' );\n\t\t\t\t\ttime_span.text( 'S: ' + cell_value.shifts + ' A: ' + cell_value.absences + ' ' + Global.getTimeUnit( cell_value.total_time ) + ' = ' + currency + cell_value.total_time_wage );\n\t\t\t\t\tcontent_div.prepend( time_span );\n\n\t\t\t\t\tif ( cell_value.total_shifts_dic ) {\n\t\t\t\t\t\tvar shifts_array = [];\n\t\t\t\t\t\tfor ( var key in cell_value.total_shifts_dic ) {\n\t\t\t\t\t\t\tshifts_array.push( cell_value.total_shifts_dic[key] );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tshifts_array = shifts_array.sort( function( a, b ) {\n\n\t\t\t\t\t\t\treturn Global.compare( a, b, 'sort_order' );\n\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t\tfor ( var i = 0; i < shifts_array.length; i++ ) {\n\t\t\t\t\t\t\tvar item = shifts_array[i];\n\t\t\t\t\t\t\tvar span = $( '<span class=\"day_hour_span\"></span>' );\n\t\t\t\t\t\t\tspan.text( item.value );\n\t\t\t\t\t\t\tspan.width( this.day_hour_width );\n\t\t\t\t\t\t\ttotal_div.append( span );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcontent_div.prepend( total_div );\n\t\t\t\t\t}\n\n\t\t\t\t\tcontent_div.css( 'height', 'auto' );\n\n\t\t\t\t} else if ( cell_value ) {\n\t\t\t\t\ttime_span = $( '<span class=\\'schedule-time total\\'></span>' );\n\t\t\t\t\ttime_span.text( cell_value );\n\t\t\t\t\tcontent_div.prepend( time_span );\n\t\t\t\t} else if ( col_model.display_total_column == true ) {\n\t\t\t\t\tcurrency = LocalCacheData.getCurrentCurrencySymbol();\n\t\t\t\t\ttime_span = $( '<span class=\\'schedule-time total\\'></span>' );\n\t\t\t\t\ttime_span.text( 'S: 0 A: 0 00:00 = ' + currency + '0.00' );\n\n\t\t\t\t\tcontent_div.prepend( time_span );\n\t\t\t\t\tcontent_div.css( 'height', 'auto' );\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerRowType.EMPTY:\n\t\t\t\tif ( !Global.isSet( cell_value ) ) {\n\t\t\t\t\ttime_span.text( '' );\n\t\t\t\t}\n\n\t\t\t\ttime_span.addClass( 'empty' );\n\n\t\t\t\tcontent_div.prepend( time_span );\n\n\t\t\t\tbreak;\n\t\t\tdefault:\n\n\t\t\t\tif ( Global.isSet( item ) ) {\n\t\t\t\t\tcontent_div.removeClass( 'schedule-content-div' ).addClass( 'schedule-content-day-div' );\n\n\t\t\t\t\tif ( related_data.rowId % 2 === 0 ) {\n\t\t\t\t\t\ttime_span.removeClass( 'schedule-time' ).addClass( 'schedule-day-time even' );\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttime_span.removeClass( 'schedule-time' ).addClass( 'schedule-day-time' );\n\t\t\t\t\t}\n\n\t\t\t\t\tvar width = $this.getDayShiftWidth( item );\n\t\t\t\t\ttime_span.width( width );\n\t\t\t\t\ttime_span.css( 'left', $this.getDayShiftOffset( item ) );\n\n\t\t\t\t\tif ( !Global.isSet( item.id ) || !item.id || item.id == TTUUID.zero_id ) {\n\t\t\t\t\t\ttime_span.addClass( 'no-day-id' );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( item.status_id == 20 ) {\n\t\t\t\t\t\ttime_span.removeClass( 'even' );\n\t\t\t\t\t\ttime_span.addClass( 'red-bg' );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( item.user_id === TTUUID.zero_id ) {\n\t\t\t\t\t\tcontent_div.addClass( 'yellow-outline' );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( Global.isSet( cell_value ) ) {\n\t\t\t\t\tif ( Global.isSet( item ) && item.note && cell_value.indexOf( '*' ) == -1 ) {\n\t\t\t\t\t\tcell_value = '*' + cell_value;\n\t\t\t\t\t}\n\t\t\t\t\ttime_span.text( cell_value );\n\t\t\t\t} else {\n\t\t\t\t\ttime_span.text( '' );\n\t\t\t\t}\n\t\t\t\tcontent_div.prepend( time_span );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\treturn content_div.get( 0 ).outerHTML;\n\t}\n\n\tgetDayShiftOffset( shift ) {\n\n\t\tvar start_date_time = Global.strToDateTime( Global.getStandardDateTimeStr( shift.start_date, shift.start_time ) );\n\t\tvar offset = ( start_date_time.getTime() - this.day_mode_start_date_time.getTime() ) / 3600000;\n\n\t\treturn ( offset * this.day_hour_width );\n\t}\n\n\tgetDayShiftWidth( shift ) {\n\t\tvar start_date_time = Global.strToDateTime( Global.getStandardDateTimeStr( shift.start_date, shift.start_time ) );\n\t\tvar end_date_time = Global.strToDateTime( Global.getStandardDateTimeStr( shift.end_date, shift.end_time ) );\n\t\tvar offset = ( end_date_time.getTime() - start_date_time.getTime() ) / 3600000;\n\n\t\t//Debug.Text( 'Using Day Hour Width: '+ this.day_hour_width , 'ScheduleViewController.js', 'ScheduleViewController', 'getDayShiftWidth', 10 );\n\t\treturn ( offset * this.day_hour_width );\n\t}\n\n\tbuildWeekCell( cell_value, related_data, row, is_day_column ) {\n\t\tvar col_models = this.grid.getGridParam( 'colModel' );\n\n\t\tvar col_model = related_data.colModel;\n\t\tvar content_div = $( '<div class=\\'schedule-content-div\\'></div>' );\n\t\tif ( is_day_column ) {\n\t\t\tcontent_div.addClass( 'date-column' );\n\t\t}\n\t\tvar time_span = $( '<span class=\\'schedule-time\\'></span>' );\n\t\tvar item = row[col_model.index + '_data'];\n\n\t\tswitch ( row.type ) {\n\t\t\tcase ScheduleViewControllerRowType.TOTAL:\n\t\t\t\ttime_span = $( '<span class=\\'schedule-time total\\'></span>' );\n\t\t\t\tif ( this.select_layout.data.display_columns.indexOf( col_model.index ) === -1 && ['user_full_name', 'shifts', 'absences', 'total_time', 'total_time_wage'].indexOf( col_model.index ) === -1 ) {\n\t\t\t\t\tif ( !cell_value ) {\n\t\t\t\t\t\tvar cell_value = { shifts: 0, absences: 0, total_time: 0, total_time_wage: 0 };\n\t\t\t\t\t}\n\n\t\t\t\t\tvar total_span = $( '<span class=\\'schedule-time total\\'></span>' );\n\t\t\t\t\tvar currency = LocalCacheData.getCurrentCurrencySymbol();\n\t\t\t\t\ttime_span.text( 'S: ' + cell_value.shifts + ' A: ' + cell_value.absences );\n\t\t\t\t\ttotal_span.text( Global.getTimeUnit( cell_value.total_time ) + ' = ' + currency + Global.MoneyRound( cell_value.total_time_wage ) );\n\n\t\t\t\t\tcontent_div.prepend( total_span );\n\t\t\t\t\tcontent_div.prepend( time_span );\n\t\t\t\t\tcontent_div.css( 'height', 'auto' );\n\t\t\t\t} else {\n\t\t\t\t\ttime_span.text( cell_value );\n\t\t\t\t\tcontent_div.prepend( time_span );\n\n\t\t\t\t\tif ( related_data.pos === col_models.length - 1 ) {\n\t\t\t\t\t\tcontent_div.css( 'padding-right', '15px' );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerRowType.EMPTY:\n\t\t\t\tif ( !Global.isSet( cell_value ) ) {\n\t\t\t\t\ttime_span.text( '' );\n\t\t\t\t}\n\n\t\t\t\ttime_span.addClass( 'empty' );\n\n\t\t\t\tcontent_div.prepend( time_span );\n\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tif ( Global.isSet( item ) ) {\n\t\t\t\t\tif ( !Global.isSet( item.id ) || !item.id || ( item.id && item.id == TTUUID.zero_id ) ) {\n\t\t\t\t\t\ttime_span.addClass( 'no-id' );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( item.status_id == 20 ) {\n\t\t\t\t\t\ttime_span.addClass( 'red' );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( item.user_id === TTUUID.zero_id ) {\n\t\t\t\t\t\tcontent_div.addClass( 'yellow-outline' );\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( Global.isSet( cell_value ) ) {\n\n\t\t\t\t\tif ( Global.isSet( item ) && item.note && cell_value.indexOf( '*' ) == -1 ) {\n\t\t\t\t\t\tcell_value = '*' + cell_value;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( related_data.pos === col_models.length - 1 ) {\n\t\t\t\t\t\tcontent_div.css( 'padding-right', '15px' );\n\t\t\t\t\t}\n\n\t\t\t\t\ttime_span.text( cell_value );\n\t\t\t\t} else {\n\t\t\t\t\ttime_span.text( '' );\n\t\t\t\t}\n\n\t\t\t\tcontent_div.prepend( time_span );\n\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\treturn content_div.get( 0 ).outerHTML;\n\t}\n\n\tonCellFormat( cell_value, related_data, row ) {\n\t\t//cell_value = Global.decodeCellValue( cell_value );\n\t\t/**\n\t\t * FIXES BUG #1999: removed because it was double-encoding values in an attempt to avoid xss attacks.\n\t\t * the following functions handle the needed encoding using a pseudo div element and .outerHTML()\n\t\t * with this function in place, html encoded values come through to jqgrid double-encoded in the schedule view.\n\t\t **/\n\n\t\tvar retval = '';\n\t\tvar $this = this;\n\t\tvar is_day_column = true;\n\n\t\tif ( related_data.colModel.index == 'user_full_name' ) { //always part of grid.\n\t\t\tis_day_column = false;\n\t\t} else {\n\t\t\tfor ( var n in this.all_columns ) {\n\t\t\t\tif ( related_data.colModel.label == this.all_columns[n].label ) {\n\t\t\t\t\tis_day_column = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tswitch ( this.getMode() ) {\n\t\t\tcase ScheduleViewControllerMode.WEEK:\n\t\t\t\treturn this.buildWeekCell( cell_value, related_data, row, is_day_column );\n\t\t\tcase ScheduleViewControllerMode.MONTH:\n\t\t\t\treturn this.buildMonthCell( cell_value, related_data, row, is_day_column );\n\t\t\tcase ScheduleViewControllerMode.YEAR:\n\t\t\t\treturn this.buildYearCell( cell_value, related_data, row, is_day_column );\n\t\t\tcase ScheduleViewControllerMode.DAY:\n\t\t\t\treturn this.buildDayCell( cell_value, related_data, row, is_day_column );\n\t\t}\n\n\t\treturn '';\n\t}\n\n\tonSelectRow( grid_id, row_id, target ) {\n\t\tvar $this = this;\n\t\tvar row_tr = $( target ).find( '#' + row_id );\n\t\trow_tr.removeClass( 'ui-state-highlight' ).attr( 'aria-selected', true );\n\n\t\tvar cells_array = $this.select_cells_Array;\n\t\tvar len = $this.select_cells_Array.length;\n\n\t\tthis.select_all_shifts_array = [];\n\t\tthis.select_shifts_array = [];\n\t\tthis.select_recurring_shifts_array = [];\n\t\tthis.select_cellls_and_shifts_array = [];\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar info = cells_array[i];\n\t\t\trow_tr = $( target ).find( '#' + info.row_id );\n\t\t\tvar cell_td = $( row_tr.find( 'td' )[info.cell_index] );\n\t\t\tcell_td.addClass( 'ui-state-highlight' ).attr( 'aria-selected', true );\n\t\t\tinfo.row_id = info.row_id - 0;\n\t\t\tif ( info.shift ) {\n\t\t\t\tif ( Global.isSet( info.shift.start_date ) ) { //date + time number\n\t\t\t\t\tinfo.shift.start_date_num = Global.strToDateTime( info.shift.start_date ).getTime();\n\n\t\t\t\t} else {\n\t\t\t\t\tinfo.shift.start_date_num = info.time_stamp_num; //Uer time_stamp_num from cell select setting, a date number\n\t\t\t\t}\n\t\t\t\tinfo.shift.row_index = info.row_id - 1;\n\t\t\t\tinfo.shift.cell_index = info.cell_index - 1;\n\n\t\t\t\tinfo.shift.orginal_row_index = info.row_id;\n\t\t\t\tinfo.shift.orginal_cell_index = info.cell_index;\n\n\t\t\t\tthis.select_all_shifts_array.push( info.shift );\n\t\t\t\tthis.select_cellls_and_shifts_array.push( info );\n\n\t\t\t\tif ( info.shift.id && info.shift_id != TTUUID.zero_id ) {\n\t\t\t\t\tthis.select_shifts_array.push( info.shift );\n\t\t\t\t} else {\n\t\t\t\t\tthis.select_recurring_shifts_array.push( info.shift );\n\t\t\t\t}\n\n\t\t\t\tthis.select_all_shifts_array.sort( function( a, b ) {\n\t\t\t\t\tif ( a.cell_index < b.cell_index ) {\n\t\t\t\t\t\treturn -1;\n\t\t\t\t\t}\n\t\t\t\t\tif ( a.cell_index > b.cell_index ) {\n\t\t\t\t\t\treturn 1;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( a.cell_index === b.cell_index ) {\n\t\t\t\t\t\tif ( a.row_index < b.row_index ) {\n\t\t\t\t\t\t\treturn -1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ( a.row_index > b.row_index ) {\n\t\t\t\t\t\t\treturn 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn 0;\n\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\tthis.select_cellls_and_shifts_array.push( info );\n\t\t\t}\n\n\t\t\tthis.select_cellls_and_shifts_array.sort( function( a, b ) {\n\t\t\t\tif ( a.cell_index < b.cell_index ) {\n\t\t\t\t\treturn -1;\n\t\t\t\t}\n\t\t\t\tif ( a.cell_index > b.cell_index ) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\tif ( a.cell_index === b.cell_index ) {\n\t\t\t\t\tif ( a.row_id < b.row_id ) {\n\t\t\t\t\t\treturn -1;\n\t\t\t\t\t}\n\t\t\t\t\tif ( a.row_id > b.row_id ) {\n\t\t\t\t\t\treturn 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn 0;\n\n\t\t\t} );\n\n\t\t}\n\n\t\tthis.setDefaultMenu();\n\t}\n\n\tgetCellRelatedDate( row_index, col_model, cell_index, data_field ) {\n\t\tvar date;\n\t\tvar date_row_1_index = this.schedule_source.indexOf( this.month_date_row_array[0] );\n\t\tvar date_row_2_index = this.schedule_source.indexOf( this.month_date_row_array[1] );\n\t\tvar date_row_3_index = this.schedule_source.indexOf( this.month_date_row_array[2] );\n\t\tvar date_row_4_index = this.schedule_source.indexOf( this.month_date_row_array[3] );\n\n\t\tif ( row_index < date_row_1_index ) {\n\t\t\tdate = Global.strToDate( col_model[cell_index].index, this.full_format );\n\t\t} else if ( row_index >= date_row_1_index && row_index < date_row_2_index ) {\n\t\t\tdate = Global.strToDate( this.month_date_row_array[0][data_field + '_full_date'], this.full_format );\n\t\t} else if ( row_index >= date_row_2_index && row_index < date_row_3_index ) {\n\t\t\tdate = Global.strToDate( this.month_date_row_array[1][data_field + '_full_date'], this.full_format );\n\t\t} else if ( row_index >= date_row_3_index && row_index < date_row_4_index ) {\n\t\t\tdate = Global.strToDate( this.month_date_row_array[2][data_field + '_full_date'], this.full_format );\n\t\t} else if ( row_index >= date_row_4_index ) {\n\t\t\tdate = Global.strToDate( this.month_date_row_array[3][data_field + '_full_date'], this.full_format );\n\t\t}\n\n\t\treturn date;\n\t}\n\n\tgetDataByCellIndex( row_index, cell_index ) {\n\t\tvar $this = this;\n\t\tvar row = $this.schedule_source[row_index];\n\t\tvar colModel = $this.grid.getGridParam( 'colModel' );\n\n\t\t//Error: TypeError: row is undefined in /interface/html5/framework/jquery.min.js?v=8.0.0-20141117-134330 line 2 > eval line 5952\n\t\t//Error: TypeError: colModel[cell_index] is undefined in /interface/html5/framework/jquery.min.js?v=8.0.0-20141117-134330 line 2 > eval line 5951\n\t\tif ( !colModel || !colModel[cell_index] || !row ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tvar data_field = colModel[cell_index].name;\n\t\tvar data = row[data_field + '_data'];\n\n\t\treturn data;\n\t}\n\n\tonCellSelect( grid_id, row_id, cell_index, cell_val, target, e ) {\n\t\t$( '#ribbon_view_container .context-menu:visible a' ).click();\n\n\t\tif ( cell_index < 0 ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar $this = this;\n\t\tvar len = 0;\n\t\tvar row;\n\t\tvar colModel;\n\t\tvar data_field;\n\t\tvar shift;\n\t\tvar cells_array = [];\n\t\tvar date;\n\t\tvar mode = this.getMode();\n\n\t\tcells_array = $this.select_cells_Array;\n\n\t\tlen = $this.select_cells_Array.length;\n\n\t\trow = $this.schedule_source[row_id - 1];\n\n\t\tvar row_index = $this.schedule_source.indexOf( row );\n\n\t\tcolModel = $this.grid.getGridParam( 'colModel' );\n\n\t\tdata_field = colModel[cell_index].name;\n\n\t\tshift = row[data_field + '_data'];\n\n\t\tif ( mode === ScheduleViewControllerMode.MONTH ) {\n\t\t\tdate = $this.getCellRelatedDate( row_index, colModel, cell_index, data_field );\n\t\t} else {\n\t\t\tdate = Global.strToDate( data_field, this.full_format );\n\t\t}\n\n\t\tif ( !date || date.getTime() < -1 ) {\n\t\t\tdate = new Date();\n\t\t}\n\n\t\t//Clean all select cells first\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar info = cells_array[i];\n\t\t\tvar row_tr = $( target ).find( '#' + info.row_id );\n\t\t\tvar cell_td = $( row_tr.find( 'td' )[info.cell_index] );\n\t\t\tcell_td.removeClass( 'ui-state-highlight' ).attr( 'aria-selected', false );\n\t\t}\n\n\t\tif ( date ) {\n\t\t\tvar date_str = date.format();\n\t\t\tvar time_stamp_num = Global.strToDate( date_str ).getTime();\n\t\t} else {\n\t\t\tdate_str = '';\n\t\t\ttime_stamp_num = 0;\n\t\t}\n\t\t// Add multiple selection if click cell and hold ctrl or command\n\t\tif ( e.ctrlKey || e.metaKey ) {\n\t\t\tvar found = false;\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\tinfo = cells_array[i];\n\t\t\t\t// row id should be number\n\t\t\t\tif ( parseInt( row_id ) === info.row_id && cell_index === info.cell_index ) {\n\t\t\t\t\tcells_array.splice( i, 1 );\n\t\t\t\t\tfound = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( !found ) {\n\n\t\t\t\tcells_array.push( {\n\t\t\t\t\trow_id: row_id,\n\t\t\t\t\tcell_index: cell_index,\n\t\t\t\t\tcell_val: cell_val,\n\t\t\t\t\tshift: shift,\n\t\t\t\t\tdate: date_str,\n\t\t\t\t\ttime_stamp_num: time_stamp_num,\n\t\t\t\t\tuser_id: row.user_id,\n\t\t\t\t\tbranch_id: row.branch_id,\n\t\t\t\t\tdepartment_id: row.department_id,\n\t\t\t\t\tjob_id: row.job_id,\n\t\t\t\t\tjob_item_id: row.job_item_id,\n\t\t\t\t\tpunch_tag_id: row.punch_tag_id\n\t\t\t\t} );\n\n\t\t\t\t$this.select_cells_Array = cells_array;\n\n\t\t\t\tthis.select_cells_Array.sort( function( a, b ) {\n\n\t\t\t\t\treturn Global.compare( a, b, 'time_stamp_num' );\n\n\t\t\t\t} );\n\n\t\t\t}\n\t\t} else if ( e.shiftKey ) {\n\t\t\tvar start_row_index = row_id;\n\t\t\tvar start_cell_index = cell_index;\n\n\t\t\tvar end_row_index = row_id;\n\t\t\tvar end_cell_index = cell_index;\n\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\tinfo = cells_array[i];\n\n\t\t\t\tif ( parseInt( info.row_id ) < parseInt( start_row_index ) ) {\n\t\t\t\t\tstart_row_index = info.row_id;\n\t\t\t\t} else if ( parseInt( info.row_id ) > parseInt( end_row_index ) ) {\n\t\t\t\t\tend_row_index = info.row_id;\n\t\t\t\t}\n\n\t\t\t\tif ( parseInt( info.cell_index ) < parseInt( start_cell_index ) ) {\n\t\t\t\t\tstart_cell_index = info.cell_index;\n\t\t\t\t} else if ( parseInt( info.cell_index ) > parseInt( end_cell_index ) ) {\n\t\t\t\t\tend_cell_index = info.cell_index;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//If the click is inside the existing selection, truncate the existing selection to the click.\n\t\t\t//Check in TimeSheetViewController.js for related change\n\t\t\tif ( cells_array[cells_array.length - 1] && cells_array[0] && cells_array[cells_array.length - 1].cell_index >= cell_index && cells_array[0].cell_index <= cell_index && cells_array[cells_array.length - 1].row_id >= row_id && cells_array[0].row_id <= row_id ) {\n\t\t\t\tend_row_index = row_id;\n\t\t\t\tend_cell_index = cell_index;\n\t\t\t}\n\n\t\t\tstart_row_index = parseInt( start_row_index );\n\t\t\tend_row_index = parseInt( end_row_index );\n\t\t\tcells_array = [];\n\n\t\t\tfor ( var i = start_row_index; i <= end_row_index; i++ ) {\n\t\t\t\tvar r_index = i;\n\t\t\t\tfor ( var j = start_cell_index; j <= end_cell_index; j++ ) {\n\t\t\t\t\tvar c_index = j;\n\n\t\t\t\t\trow_tr = $( target ).find( '#' + r_index );\n\n\t\t\t\t\tcell_td = $( row_tr.find( 'td' )[c_index] );\n\n\t\t\t\t\tcell_val = cell_td[0].outerHTML;\n\n\t\t\t\t\trow = $this.schedule_source[r_index - 1];\n\n\t\t\t\t\trow_index = $this.schedule_source.indexOf( row );\n\n\t\t\t\t\tcolModel = $this.grid.getGridParam( 'colModel' );\n\n\t\t\t\t\tdata_field = colModel[c_index].name;\n\n\t\t\t\t\tshift = row[data_field + '_data'];\n\n\t\t\t\t\tif ( mode === ScheduleViewControllerMode.MONTH ) {\n\t\t\t\t\t\tdate = $this.getCellRelatedDate( row_index, colModel, c_index, data_field );\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdate = Global.strToDate( data_field, this.full_format );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( date && date.getTime() > 0 ) {\n\t\t\t\t\t\tdate_str = date.format();\n\t\t\t\t\t\ttime_stamp_num = Global.strToDate( date_str ).getTime();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdate_str = '';\n\t\t\t\t\t\ttime_stamp_num = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tcells_array.push( {\n\t\t\t\t\t\trow_id: r_index.toString(),\n\t\t\t\t\t\tcell_index: c_index,\n\t\t\t\t\t\tcell_val: cell_val,\n\t\t\t\t\t\tshift: shift,\n\t\t\t\t\t\tdate: date_str,\n\t\t\t\t\t\ttime_stamp_num: time_stamp_num,\n\t\t\t\t\t\tuser_id: row.user_id,\n\t\t\t\t\t\tbranch_id: row.branch_id,\n\t\t\t\t\t\tdepartment_id: row.department_id,\n\t\t\t\t\t\tjob_id: row.job_id,\n\t\t\t\t\t\tjob_item_id: row.job_item_id,\n\t\t\t\t\t\tpunch_tag_id: row.punch_tag_id\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t$this.select_cells_Array = cells_array;\n\n\t\t\tthis.select_cells_Array.sort( function( a, b ) {\n\n\t\t\t\treturn Global.compare( a, b, 'time_stamp_num' );\n\n\t\t\t} );\n\n\t\t} else {\n\n\t\t\tcells_array = [\n\t\t\t\t{\n\t\t\t\t\trow_id: row_id,\n\t\t\t\t\tcell_index: cell_index,\n\t\t\t\t\tcell_val: cell_val,\n\t\t\t\t\tshift: shift,\n\t\t\t\t\tdate: date_str,\n\t\t\t\t\ttime_stamp_num: time_stamp_num,\n\t\t\t\t\tuser_id: row.user_id,\n\t\t\t\t\tbranch_id: row.branch_id,\n\t\t\t\t\tdepartment_id: row.department_id,\n\t\t\t\t\tjob_id: row.job_id,\n\t\t\t\t\tjob_item_id: row.job_item_id,\n\t\t\t\t\tpunch_tag_id: row.punch_tag_id\n\t\t\t\t}\n\t\t\t];\n\n\t\t\t$this.select_cells_Array = cells_array;\n\n\t\t\tif ( date && date.getYear() > 0 ) {\n\t\t\t\tthis.setDatePickerValue( date.format( Global.getLoginUserDateFormat() ) );\n\t\t\t\tthis.highLightSelectDay();\n\t\t\t}\n\n\t\t}\n\n\t\t$this.onSelectRow( grid_id, row_id, target );\n\n\t\tvar target_row_tr = $( target ).find( '#' + row_id );\n\t\tvar target_row_td = $( target_row_tr.find( 'td' )[cell_index] );\n\n\t\tif ( target_row_td.attr( 'infor_column' ) ) {\n\t\t\tvar target_row_index = target_row_tr.index();\n\t\t\tvar rowspan = parseInt( target_row_td.attr( 'rowspan' ) );\n\n\t\t\tif ( isNaN( rowspan ) ) {\n\t\t\t\trowspan = 1;\n\t\t\t}\n\n\t\t\tvar last_row = target_row_tr.parent().children().eq( ( target_row_index + rowspan - 1 ) );\n\t\t\tvar last_td = last_row.children().eq( ( last_row.children().length - 1 ) );\n\n\t\t\tvar last_row_id = last_row.attr( 'id' );\n\t\t\tvar last_cell_id = ( last_row.children().length - 1 );\n\t\t\tvar last_cell_value = last_td.find( '.schedule-time' ).text();\n\n\t\t\t$this.onCellSelect( 'timesheet_grid', last_row_id,\n\t\t\t\tlast_cell_id,\n\t\t\t\tlast_cell_value,\n\t\t\t\tthis.grid.grid,\n\t\t\t\t{ shiftKey: true } );\n\n\t\t}\n\t}\n\n\thighLightSelectDay() {\n\n\t\tvar mode = this.getMode();\n\n\t\t$( '.highlight-header' ).removeClass( 'highlight-header' ); //Clean all hight light header or date row\n\n\t\tif ( mode === ScheduleViewControllerMode.MONTH ) {\n\t\t\tvar select_date = Global.strToDate( this.start_date_picker.getValue() );\n\t\t\tvar select_day = select_date.getDay(); // column index is day number for month mode\n\t\t\tselect_date = select_date.format( this.full_format );\n\n\t\t\tvar header = $( '#' + this.ui_id + '_grid_' + select_day );\n\t\t\tvar header_text = $( header.children()[1] ).text();\t //get current column header value\n\n\t\t\tthis.highlight_header = $( '#' + this.ui_id + '_grid_' + select_date ); //get date row\n\n\t\t\tif ( this.highlight_header.length !== 1 ) {\n\t\t\t\tthis.highlight_header = $( '#' + this.ui_id + '_grid_' + select_day ); //get header\n\t\t\t} else {\n\t\t\t\tif ( header_text === this.highlight_header.text() ) {\n\t\t\t\t\t$( '.highlight-header' ).removeClass( 'highlight-header' );\n\t\t\t\t\theader.addClass( 'highlight-header' );\n\t\t\t\t}\n\t\t\t}\n\n\t\t} else {\n\t\t\tselect_date = Global.strToDate( this.start_date_picker.getValue() );\n\t\t\t//Error: Uncaught TypeError: Cannot read property 'format' of null in interface/html5/#!m=Schedule&date=null&mode=week line 6295\n\t\t\tif ( !select_date ) {\n\t\t\t\tselect_date = new Date();\n\t\t\t\tthis.setDatePickerValue( select_date.format() );\n\t\t\t}\n\t\t\tselect_date = select_date.format( this.full_format );\n\t\t\tthis.highlight_header = $( '#' + this.ui_id + '_grid_' + select_date );\n\t\t}\n\n\t\tif ( mode !== ScheduleViewControllerMode.DAY ) {\n\n\t\t\tif ( mode === ScheduleViewControllerMode.MONTH ) {\n\t\t\t\tthis.highlight_header.parent().addClass( 'highlight-header' );\n\t\t\t}\n\n\t\t\tthis.highlight_header.addClass( 'highlight-header' );\n\n\t\t}\n\t}\n\n\tbuildAllModeCommonColumns() {\n\t\tvar $this = this;\n\t\tthis.shift_key_name_array = ['user_id'];\n\t\tvar display_columns = this.buildDisplayColumns( this.select_layout.data.display_columns );\n\n\t\tvar len = display_columns.length;\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar column = display_columns[i];\n\t\t\tvar column_info = {\n\t\t\t\tname: column.value,\n\t\t\t\tindex: column.value,\n\t\t\t\tlabel: column.label,\n\t\t\t\twidth: 122,\n\t\t\t\tsortable: false,\n\t\t\t\ttitle: false,\n\t\t\t\tfixed: true,\n\t\t\t\tresizable: false,\n\t\t\t\tformatter: function() {\n\n\t\t\t\t\treturn $this.onCellFormat( arguments[0], arguments[1], arguments[2], arguments[3] );\n\t\t\t\t},\n\t\t\t\tcellattr: function( rowId, tv, rawObject, cm, rdata ) {\n\t\t\t\t\tvar field_name = cm.index;\n\t\t\t\t\treturn 'class=\"' + field_name + '_cell\" infor_column=\"true\"';\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.schedule_columns.push( column_info );\n\t\t\tthis.shift_key_name_array.push( column.value + '_id' );\n\t\t}\n\n\t\tvar employee_column = {\n\t\t\tname: 'user_full_name',\n\t\t\tindex: 'user_full_name',\n\t\t\tlabel: $.i18n._( 'Employee' ),\n\t\t\twidth: 122,\n\t\t\tsortable: false,\n\t\t\ttitle: false,\n\t\t\tfixed: true,\n\t\t\tresizable: false,\n\t\t\tformatter: function() {\n\n\t\t\t\treturn $this.onCellFormat( arguments[0], arguments[1], arguments[2], arguments[3] );\n\t\t\t},\n\t\t\tcellattr: function( rowId, tv, rawObject, cm, rdata ) {\n\t\t\t\tvar field_name = cm.index;\n\t\t\t\treturn 'class=\"' + field_name + '_cell\" infor_column=\"true\"';\n\t\t\t}\n\t\t};\n\n\t\tthis.schedule_columns.push( employee_column );\n\t}\n\n\tbuildMonthRows() {\n\n\t\tvar month_days = ( this.end_date.getTime() - this.start_date.getTime() ) / 86400000 + 1;\n\t\tvar start_day = new Date( this.start_date.getTime() ).getDay();\n\t\tthis.schedule_source = [];\n\t\tvar start_date = new Date( new Date( this.start_date.getTime() ).setDate( this.start_date.getDate() + 7 ) );\n\n\t\tthis.month_date_row_array = [];\n\n\t\tvar row_num = 1;\n\t\tvar z = 0; //day offset\n\n\t\twhile ( row_num < 5 ) {\n\t\t\tvar current_day = start_day;\n\t\t\tvar row = this.getEmptyWeeklyRow();\n\t\t\trow.type = ScheduleViewControllerRowType.DATE;\n\n\t\t\tfor ( var i = 0; i < 7; i++ ) {\n\t\t\t\tvar current_date = new Date( new Date( start_date.getTime() ).setDate( start_date.getDate() + z ) );\n\n\t\t\t\tif ( current_date.getTime() > this.end_date.getTime() ) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\trow[current_day] = current_date.format( this.weekly_format );\n\n\t\t\t\trow[current_day] = this.setHolidayHeader( row[current_day] );\n\t\t\t\trow[current_day + '_full_date'] = current_date.format( this.full_format );\n\t\t\t\trow[current_day + '_time'] = current_date.getTime();\n\n\t\t\t\tcurrent_day = current_day + 1;\n\n\t\t\t\tif ( current_day === 7 ) {\n\t\t\t\t\tcurrent_day = 0;\n\t\t\t\t}\n\n\t\t\t\tz = z + 1;\n\t\t\t}\n\n\t\t\tthis.month_date_row_array.push( row );\n\t\t\trow_num = row_num + 1;\n\n\t\t\tthis.schedule_source.push( row );\n\n\t\t}\n\t}\n\n\tgetEmptyWeeklyRow() {\n\t\tvar row = {};\n\t\trow.user_full_name = '';\n\t\trow.last_name = '';\n\t\trow.user_id = '';\n\t\trow.branch_id = '';\n\t\trow.department_id = '';\n\t\trow.schedule_policy_id = '';\n\t\trow.job_id = '';\n\t\trow.job_item_id = '';\n\t\trow.punch_tag_id = [];\n\n\t\tvar display_columns = this.select_layout.data.display_columns;\n\t\tvar display_columns_len = display_columns.length;\n\n\t\tfor ( var j = 0; j < display_columns_len; j++ ) {\n\t\t\tvar field_name = display_columns[j];\n\t\t\trow[field_name] = '';\n\t\t}\n\n\t\treturn row;\n\t}\n\n\tbuildMonthColumns() {\n\t\tvar $this = this;\n\t\tthis.schedule_columns = [];\n\t\tthis.buildAllModeCommonColumns();\n\n//\t\tvar current_date = new Date( this.start_date.getTime() );\n\n\t\tthis.month_date_row_tr_ids = {};\n\t\tfor ( var i = 0; i < 7; i++ ) {\n\t\t\tvar temp_start_date = new Date( this.start_date.getTime() );\n\t\t\tvar current_date = new Date( temp_start_date.setDate( temp_start_date.getDate() + i ) );\n\t\t\tvar start_day = current_date.getDay();\n\t\t\tvar header_text = current_date.format( this.weekly_format );\n\t\t\tvar data_field = start_day;\n\t\t\tif ( data_field === 7 ) {\n\t\t\t\tdata_field = 0;\n\t\t\t}\n\n\t\t\theader_text = this.setHolidayHeader( header_text );\n\n\t\t\tvar full_data_field = current_date.format( this.full_format );\n\n\t\t\tvar column_info = {\n\t\t\t\tresizable: false,\n\t\t\t\tname: data_field.toString(), //Needed for jqgrid otherwise it thinks its an index lookup.\n\t\t\t\tindex: full_data_field,\n\t\t\t\tlabel: header_text,\n\t\t\t\twidth: 150,\n\t\t\t\tfixed: true,\n\t\t\t\tsortable: false,\n\t\t\t\ttitle: false,\n\t\t\t\tformatter: function() {\n\t\t\t\t\treturn $this.onCellFormat( arguments[0], arguments[1], arguments[2], arguments[3] );\n\t\t\t\t},\n\t\t\t\tcellattr: function( rowId, tv, rawObject, cm, rdata ) {\n\t\t\t\t\tif ( rawObject.type === ScheduleViewControllerRowType.DATE ) {\n\t\t\t\t\t\t$this.month_date_row_tr_ids[rowId] = true;\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tis_static_size: true\n\t\t\t};\n\t\t\tthis.schedule_columns.push( column_info );\n\n\t\t}\n\n\t\tthis.buildWeeklyTotalColumns();\n\n\t\tthis.schedule_columns.push( {\n\t\t\tname: 'scrollbar_spacer',\n\t\t\tindex: 'scrollbar_spacer',\n\t\t\tlabel: '',\n\t\t\twidth: Global.getScrollbarWidth(),\n\t\t\tsortable: false,\n\t\t\ttitle: false,\n\t\t\tfixed: true,\n\t\t\tis_static_size: true, //Used to skip our own auto-sizing.\n\t\t} );\n\n\t\tthis.buildMonthRows();\n\t}\n\n\tgetDayByDayNum( day ) {\n\n\t\tvar day;\n\t\tswitch ( day ) {\n\t\t\tcase 0:\n\t\t\t\tday = $.i18n._( 'S' );\n\t\t\t\tbreak;\n\t\t\tcase 1:\n\t\t\t\tday = $.i18n._( 'M' );\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tday = $.i18n._( 'T' );\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\t\tday = $.i18n._( 'W' );\n\t\t\t\tbreak;\n\t\t\tcase 4:\n\t\t\t\tday = $.i18n._( 'T' );\n\t\t\t\tbreak;\n\t\t\tcase 5:\n\t\t\t\tday = $.i18n._( 'F' );\n\t\t\t\tbreak;\n\t\t\tcase 6:\n\t\t\t\tday = $.i18n._( 'S' );\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn day;\n\t}\n\n\tbuildYearColumns() {\n\t\tvar $this = this;\n\t\tthis.schedule_columns = [];\n\n\t\tthis.buildAllModeCommonColumns();\n\n\t\tvar current_date = new Date( this.start_date.getTime() );\n\t\tvar end_date = new Date( this.end_date.getTime() );\n\n\t\tvar i = 0;\n\t\twhile ( current_date.format( this.full_format ) !== end_date.format( this.full_format ) ) {\n\n\t\t\tcurrent_date = new Date( new Date( this.start_date.getTime() ).setDate( this.start_date.getDate() + i ) );\n\t\t\tvar header_text = current_date.format( this.weekly_format );\n\t\t\tvar data_field = current_date.format( this.full_format );\n\n\t\t\tvar day = this.getDayByDayNum( current_date.getDay() );\n\n\t\t\tvar column_info = {\n\t\t\t\tname: data_field,\n\t\t\t\tindex: i,\n\t\t\t\tlabel: day + '<br>' + current_date.getDate(),\n\t\t\t\twidth: 22,\n\t\t\t\tsortable: false,\n\t\t\t\ttitle: false,\n\t\t\t\tfixed: true,\n\t\t\t\tis_static_size: true, //Used to skip our own auto-sizing.\n\n\t\t\t\tformatter: function() {\n\n\t\t\t\t\treturn $this.onCellFormat( arguments[0], arguments[1], arguments[2], arguments[3] );\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.schedule_columns.push( column_info );\n\n\t\t\ti = i + 1;\n\t\t}\n\n\t\tthis.schedule_columns.push( {\n\t\t\tname: 'scrollbar_spacer',\n\t\t\tindex: i,\n\t\t\tlabel: '',\n\t\t\twidth: Global.getScrollbarWidth(),\n\t\t\tsortable: false,\n\t\t\ttitle: false,\n\t\t\tfixed: true,\n\t\t\tis_static_size: true, //Used to skip our own auto-sizing.\n\t\t} );\n\n\t\t//this.buildWeeklyTotalColumns();\n\t}\n\n\tbuildDayColumns() {\n\t\tvar $this = this;\n\t\tthis.schedule_columns = [];\n\n\t\tthis.buildAllModeCommonColumns();\n\n\t\tvar current_date = new Date( this.start_date.getTime() );\n\t\tvar header_text = current_date.format( this.weekly_format );\n\t\tvar data_field = current_date.format( this.full_format );\n\n\t\tvar column_info = {\n\t\t\tfixed: true,\n\t\t\tresizable: false,\n\t\t\twidth: 500,\n\t\t\tname: data_field,\n\t\t\tindex: data_field,\n\t\t\tlabel: 'daily_header_replace',\n\t\t\tis_static_size: true,\n\t\t\tsortable: false,\n\t\t\ttitle: false,\n\t\t\tdisplay_total_column: true,\n\t\t\tformatter: function() {\n\n\t\t\t\treturn $this.onCellFormat( arguments[0], arguments[1], arguments[2], arguments[3] );\n\t\t\t}\n\t\t};\n\t\tthis.schedule_columns.push( column_info );\n\n\t\tcolumn_info = {\n\t\t\tfixed: true,\n\t\t\tresizable: false,\n\t\t\twidth: 122,\n\t\t\tname: 'total',\n\t\t\tindex: 'total',\n\t\t\tlabel: 'Total Time',\n\t\t\tsortable: false,\n\t\t\ttitle: false,\n\t\t\tformatter: function() {\n\n\t\t\t\treturn $this.onCellFormat( arguments[0], arguments[1], arguments[2], arguments[3] );\n\t\t\t}\n\t\t};\n\t\tthis.schedule_columns.push( column_info );\n\n\t\tthis.schedule_columns.push( {\n\t\t\tname: 'scrollbar_spacer',\n\t\t\tindex: 'scrollbar_spacer',\n\t\t\tlabel: '',\n\t\t\twidth: Global.getScrollbarWidth(),\n\t\t\tsortable: false,\n\t\t\ttitle: false,\n\t\t\tfixed: true,\n\t\t\t//is_static_size: false, //Used to skip our own auto-sizing.\n\t\t} );\n\t}\n\n\tbuildWeekColumns() {\n\n\t\tvar $this = this;\n\t\tthis.schedule_columns = [];\n\n\t\tthis.buildAllModeCommonColumns();\n\n\t\t//Error: Uncaught TypeError: Cannot read property 'getTime' of null in /interface/html5/#!m=Schedule&date=20141208&mode=week line 6580\n\t\tif ( !this.start_date ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar current_date = new Date( this.start_date.getTime() );\n\t\tvar end_date = new Date( this.end_date.getTime() );\n\n\t\tvar i = 0;\n\t\tvar set_fixed_width = false;\n//\t\tif ( this.schedule_columns.length === 1 ) {\n//\t\t\tset_fixed_width = false;\n//\t\t}\n\n\t\twhile ( current_date.format( this.full_format ) !== end_date.format( this.full_format ) ) {\n\n\t\t\tcurrent_date = new Date( new Date( this.start_date.getTime() ).setDate( this.start_date.getDate() + i ) );\n\n\t\t\tvar header_text = current_date.format( this.weekly_format );\n\t\t\tvar data_field = current_date.format( this.full_format );\n\n\t\t\theader_text = this.setHolidayHeader( header_text );\n\n\t\t\tvar column_info = {\n\t\t\t\tresizable: false,\n\t\t\t\tname: data_field.toString(), //Needed for jqgrid otherwise it thinks its an index lookup.\n\t\t\t\tindex: data_field,\n\t\t\t\tlabel: header_text,\n\t\t\t\twidth: 150,\n\t\t\t\tfixed: true,\n\t\t\t\tsortable: false,\n\t\t\t\ttitle: false,\n\t\t\t\tformatter: function() {\n\n\t\t\t\t\treturn $this.onCellFormat( arguments[0], arguments[1], arguments[2], arguments[3] );\n\t\t\t\t},\n\t\t\t\tis_static_size: true\n\t\t\t};\n\n\t\t\tthis.schedule_columns.push( column_info );\n\n\t\t\ti = i + 1;\n\n\t\t}\n\n\t\tthis.buildWeeklyTotalColumns();\n\n\t\tthis.schedule_columns.push( {\n\t\t\tname: 'scrollbar_spacer',\n\t\t\tindex: 'scrollbar_spacer',\n\t\t\tlabel: '',\n\t\t\twidth: Global.getScrollbarWidth(),\n\t\t\tsortable: false,\n\t\t\ttitle: false,\n\t\t\tfixed: true,\n\t\t\tis_static_size: true, //Used to skip our own auto-sizing.\n\t\t} );\n\n\t\treturn this.schedule_columns;\n\t}\n\n\tsetHolidayHeader( header_text, inLine ) {\n\n\t\tif ( this.holiday_data_dic ) {\n\t\t\tif ( this.holiday_data_dic[header_text] ) {\n\n\t\t\t\tif ( inLine ) {\n\t\t\t\t\theader_text = header_text + ' (' + Global.htmlEncode( this.holiday_data_dic[header_text].name ) + ')';\n\t\t\t\t} else {\n\t\t\t\t\theader_text = header_text + '<br>' + Global.htmlEncode( this.holiday_data_dic[header_text].name );\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t\treturn header_text;\n\t}\n\n\tbuildWeeklyTotalColumns() {\n\t\tvar $this = this;\n\t\tvar show_weekly_total = this.settings_menu.getButton( 'weekly_totals_btn' ).active;\n\n\t\tvar is_fixed = false;\n\n\t\tif ( show_weekly_total ) {\n\t\t\tvar shifts_column = {\n\t\t\t\tname: 'shifts',\n\t\t\t\tindex: 'shifts',\n\t\t\t\tlabel: $.i18n._( 'Shifts' ),\n\t\t\t\twidth: 50,\n\t\t\t\tsortable: false,\n\t\t\t\ttitle: false,\n\t\t\t\tformatter: function() {\n\t\t\t\t\treturn $this.onCellFormat( arguments[0], arguments[1], arguments[2], arguments[3] );\n\t\t\t\t},\n\t\t\t\tfixed: true\n\t\t\t};\n\n\t\t\tvar absences_column = {\n\t\t\t\tname: 'absences',\n\t\t\t\tindex: 'absences',\n\t\t\t\tlabel: $.i18n._( 'Absences' ),\n\t\t\t\twidth: 70,\n\t\t\t\tsortable: false,\n\t\t\t\ttitle: false,\n\t\t\t\tformatter: function() {\n\t\t\t\t\treturn $this.onCellFormat( arguments[0], arguments[1], arguments[2], arguments[3] );\n\t\t\t\t},\n\t\t\t\tfixed: true\n\t\t\t};\n\n\t\t\tvar total_time = {\n\t\t\t\tname: 'total_time',\n\t\t\t\tindex: 'total_time',\n\t\t\t\tlabel: $.i18n._( 'Total Time' ),\n\t\t\t\twidth: 70,\n\t\t\t\tsortable: false,\n\t\t\t\ttitle: false,\n\t\t\t\tformatter: function() {\n\t\t\t\t\treturn $this.onCellFormat( arguments[0], arguments[1], arguments[2], arguments[3] );\n\t\t\t\t},\n\t\t\t\tfixed: true\n\t\t\t};\n\n\t\t\tvar total_time_wage = {\n\t\t\t\tname: 'total_time_wage',\n\t\t\t\tindex: 'total_time_wage',\n\t\t\t\tlabel: $.i18n._( 'Wages' ),\n\t\t\t\twidth: 90,\n\t\t\t\tsortable: false,\n\t\t\t\ttitle: false,\n\t\t\t\tformatter: function() {\n\t\t\t\t\treturn $this.onCellFormat( arguments[0], arguments[1], arguments[2], arguments[3] );\n\t\t\t\t},\n\t\t\t\tfixed: true\n\t\t\t};\n\n\t\t\tthis.schedule_columns.push( shifts_column );\n\t\t\tthis.schedule_columns.push( absences_column );\n\t\t\tthis.schedule_columns.push( total_time );\n\t\t\tthis.schedule_columns.push( total_time_wage );\n\t\t}\n\t}\n\n\tbuildScheduleColumns() {\n\t\tthis.shift_key_name_array = ['user_id'];\n\t\tthis.schedule_columns = [];\n\n\t\tvar mode = this.getMode();\n\n\t\tswitch ( mode ) {\n\t\t\tcase ScheduleViewControllerMode.WEEK:\n\t\t\t\tthis.buildWeekColumns();\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerMode.MONTH:\n\t\t\t\tthis.buildMonthColumns();\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerMode.YEAR:\n\t\t\t\tthis.buildYearColumns();\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerMode.DAY:\n\t\t\t\tthis.buildDayColumns();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tsetScheduleGridRowSpan() {\n\n\t\tvar $this = this;\n\n\t\tvar display_columns = this.select_layout.data.display_columns;\n\n\t\tvar display_columns_len = display_columns.length;\n\n\t\tfor ( var i = 0; i < display_columns_len; i++ ) {\n\t\t\tvar column_name = display_columns[i];\n\n\t\t\tstartSet( column_name );\n\t\t}\n\n\t\tstartSet( 'user_full_name' );\n\n\t\tfunction startSet( key ) {\n\t\t\tvar cells = $this.grid.grid.find( '[aria-describedby=' + $this.ui_id + '_grid_' + key + ']' );\n\n\t\t\tvar len = cells.length;\n\n\t\t\tvar count = 0;\n\n\t\t\tvar last_val = null;\n\n\t\t\tvar last_cell = null;\n\n\t\t\tvar need_remove_cells = [];\n\n\t\t\tvar start = len - 1;\n\n\t\t\tsetRows();\n\n\t\t\tfunction setRows() {\n\t\t\t\tfor ( var i = start; i >= 0; i-- ) {\n\t\t\t\t\tvar cell = $( cells[i] );\n\t\t\t\t\tvar cell_val = $( cells[i] ).children().eq( 0 ).children().eq( 0 ).text();\n\n\t\t\t\t\tif ( i === len - 1 ) {\n\t\t\t\t\t\tlast_val = cell_val;\n\t\t\t\t\t\tcount = count + 1;\n\t\t\t\t\t\tlast_cell = cell;\n\t\t\t\t\t} else if ( last_val !== cell_val ) {\n\t\t\t\t\t\tlast_val = cell_val;\n\t\t\t\t\t\tlast_cell.attr( 'rowspan', count );\n\n\t\t\t\t\t\tfor ( var j = 0; j < need_remove_cells.length; j++ ) {\n\t\t\t\t\t\t\tvar need_removed_cell = need_remove_cells[j];\n//\t\t\t\t\t\t\tneed_removed_cell.addClass( 'need-remove' );\n\t\t\t\t\t\t\tvar node = need_removed_cell[0];\n\t\t\t\t\t\t\tif ( node.parentNode ) {\n\t\t\t\t\t\t\t\tnode.style.display = 'none';\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tneed_removed_cell = [];\n\t\t\t\t\t\tcount = 1;\n\t\t\t\t\t\tlast_cell = cell;\n\n\t\t\t\t\t} else if ( i === 0 ) {\n\t\t\t\t\t\tcount = count + 1;\n\t\t\t\t\t\tneed_remove_cells.push( last_cell );\n\t\t\t\t\t\tif ( count > 1 ) {\n\t\t\t\t\t\t\tcell.attr( 'rowspan', count );\n\t\t\t\t\t\t\tfor ( var j = 0; j < need_remove_cells.length; j++ ) {\n\t\t\t\t\t\t\t\tneed_removed_cell = need_remove_cells[j];\n//\t\t\t\t\t\t\t\tneed_removed_cell.addClass( 'need-remove' );\n\t\t\t\t\t\t\t\tnode = need_removed_cell[0];\n\t\t\t\t\t\t\t\tif ( node.parentNode ) {\n\t\t\t\t\t\t\t\t\tnode.style.display = 'none';\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcount = count + 1;\n\t\t\t\t\t\tneed_remove_cells.push( last_cell );\n\t\t\t\t\t\tlast_cell = cell;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\t}\n\n\tonSetSearchFilterFinished() {\n\t}\n\n\tonBuildBasicUIFinished() {\n\t}\n\n\tonBuildAdvUIFinished() {\n\t}\n\n\t// setDateUrl() {\n\t// \tvar $this = this;\n\t// \tif ( !$this.edit_view ) {\n\t//\n\t// \t\tvar mode = this.getMode();\n\t// \t\tvar default_date = $this.start_date_picker.getDefaultFormatValue();\n\t//\n\t// \t\tif ( mode ) {\n\t// \t\t\twindow.location = Global.getBaseURL() + '#!m=' + $this.viewId + '&date=' + default_date + '&mode=' + mode;\n\t// \t\t} else {\n\t// \t\t\tif ( LocalCacheData.getAllURLArgs() && LocalCacheData.getAllURLArgs().mode ) {\n\t// \t\t\t\t$this.setToggleButtonValue( LocalCacheData.getAllURLArgs().mode );\n\t// \t\t\t\tmode = this.getMode();\n\t// \t\t\t\twindow.location = Global.getBaseURL() + '#!m=' + $this.viewId + '&date=' + default_date + '&mode=' + mode;\n\t// \t\t\t} else {\n\t// \t\t\t\twindow.location = Global.getBaseURL() + '#!m=' + $this.viewId + '&date=' + default_date;\n\t// \t\t\t}\n\t// \t\t}\n\t//\n\t// \t}\n\t// },\n\n\treSetURL() {\n\t\tvar mode = this.getMode();\n\t\tvar args;\n\t\tif ( mode ) {\n\t\t\t//args = '#!m=' + this.viewId + '&date=' + this.start_date_picker.getDefaultFormatValue() + '&mode=' + mode;\n\t\t\targs = '#!m=' + this.viewId + '&mode=' + mode;\n\t\t\tGlobal.setURLToBrowser( Global.getBaseURL() + args );\n\t\t} else {\n\t\t\t//args = '#!m=' + this.viewId + '&date=' + this.start_date_picker.getDefaultFormatValue();\n\t\t\targs = '#!m=' + this.viewId;\n\t\t\tGlobal.setURLToBrowser( Global.getBaseURL() + args );\n\t\t}\n\t\tLocalCacheData.setAllURLArgs( Global.buildArgDic( args.split( '&' ) ) );\n\t}\n\n\tsetURL() {\n\t\tvar a = '';\n\t\tswitch ( LocalCacheData.current_doing_context_action ) {\n\t\t\tcase 'new':\n\t\t\tcase 'edit':\n\t\t\tcase 'view':\n\t\t\t\ta = LocalCacheData.current_doing_context_action;\n\t\t\t\tbreak;\n\t\t\tcase 'copy_as_new':\n\t\t\t\ta = 'new';\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif ( this.canSetURL() ) {\n\t\t\tvar tab_name = this.edit_view_tab ? this.edit_view_tab.find( '.edit-view-tab-bar-label' ).children().eq( this.getEditViewTabIndex() ).text() : '';\n\t\t\ttab_name = tab_name.replace( /\\/|\\s+/g, '' );\n\n\t\t\tvar mode = this.getMode();\n\n\t\t\tif ( this.current_edit_record && this.current_edit_record.id && this.current_edit_record.id != TTUUID.zero_id ) {\n\t\t\t\tif ( a ) {\n\n\t\t\t\t\t//Global.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&date=' + this.start_date_picker.getDefaultFormatValue() + '&mode=' + mode + '&a=' + a + '&id=' + this.current_edit_record.id +\n\t\t\t\t\tGlobal.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&mode=' + mode + '&a=' + a + '&id=' + this.current_edit_record.id +\n\t\t\t\t\t\t'&tab=' + tab_name );\n\n\t\t\t\t} else {\n\t\t\t\t\t//Global.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&date=' + this.start_date_picker.getDefaultFormatValue() + '&mode=' + mode + '&id=' + this.current_edit_record.id );\n\t\t\t\t\tGlobal.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&mode=' + mode + '&id=' + this.current_edit_record.id );\n\n\t\t\t\t}\n\n\t\t\t\tGlobal.trackView( this.viewId, LocalCacheData.current_doing_context_action );\n\n\t\t\t} else {\n\t\t\t\tif ( a ) {\n\n\t\t\t\t\t//Edit a record which don't have id, schedule view Recurring Scedule\n\t\t\t\t\tif ( a === 'edit' ) {\n\t\t\t\t\t\t//Global.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&date=' + this.start_date_picker.getDefaultFormatValue() + '&mode=' + mode + '&a=' + 'new' +\n\t\t\t\t\t\tGlobal.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&mode=' + mode + '&a=' + 'new' +\n\t\t\t\t\t\t\t'&tab=' + tab_name );\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//Global.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&date=' + this.start_date_picker.getDefaultFormatValue() + '&mode=' + mode + '&a=' + a +\n\t\t\t\t\t\tGlobal.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&mode=' + mode + '&a=' + a +\n\t\t\t\t\t\t\t'&tab=' + tab_name );\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\t//Global.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&date=' + this.start_date_picker.getDefaultFormatValue() + '&mode=' + mode );\n\t\t\t\t\tGlobal.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&mode=' + mode );\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n\n\tclearSelection( set_default_menu ) {\n\t\tif ( this.grid && this.grid.grid ) {\n\t\t\tthis.grid.grid.jqGrid( 'resetSelection' );\n\t\t}\n\n\t\tthis.select_cells_Array = [];\n\t\tthis.select_cellls_and_shifts_array = [];\n\t\tthis.select_all_shifts_array = [];\n\n\t\t//Issue #3067 - Causes incorrect context menu to be set when saving a schedule which produces context menu flashing\n\t\t//and button state to change. However this call is required to properly reset mass edit and other context menu buttons.\n\t\tif ( set_default_menu || set_default_menu === undefined ) {\n\t\t\tthis.setDefaultMenu();\n\t\t}\n\t}\n\n\trender() {\n\t\tvar $this = this;\n\t\tsuper.render();\n\n\t\t// Vue Schedule Settings Initialization\n\n\t\tvar schedule_settings_options = [\n\t\t\t{\n\t\t\t\tlabel: $.i18n._( 'Daily Totals' ),\n\t\t\t\tid: 'daily_totals_btn',\n\t\t\t\tno_group_label: true,\n\t\t\t\tvue_icon: 'tticon tticon-settings_black_24dp',\n\t\t\t\taction_group: 'schedule_settings',\n\t\t\t\tmulti_select_group: 2,\n\t\t\t\tvisible: true,\n\t\t\t\tcommand: () => {\n\t\t\t\t\t//Error: Uncaught TypeError: Cannot call method 'clearGridData' of null in /interface/html5/index.php?desktop=1#!m=Schedule&date=20150118&mode=week line 6944\n\t\t\t\t\tif ( !this.checkScheduleData() || !this.grid || !this.grid.grid ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.buildCalendars( true );\n\t\t\t\t\tthis.onResizeGrid();\n\t\t\t\t\tthis.setScheduleGridRowSpan();\n\t\t\t\t\tthis.setMonthDateRowPosition();\n\t\t\t\t\tthis.setGridColumnsWidth();\n\t\t\t\t\tthis.onSearch( true ); //Trigger saving of saved search & layout.\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: $.i18n._( 'Weekly Totals' ),\n\t\t\t\tid: 'weekly_totals_btn',\n\t\t\t\tno_group_label: true,\n\t\t\t\tvue_icon: 'tticon tticon-settings_black_24dp',\n\t\t\t\taction_group: 'schedule_settings',\n\t\t\t\tmulti_select_group: 3,\n\t\t\t\tvisible: true,\n\t\t\t\tcommand: () => {\n\t\t\t\t\tif ( !this.checkScheduleData() ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.buildCalendars();\n\t\t\t\t\tthis.onResizeGrid();\n\t\t\t\t\tthis.onSearch( true ); //Trigger saving of saved search & layout.\n\t\t\t\t}\n\t\t\t},\n\t\t\t{   //Moved to second last item in dropdown as errors were triggering on the VueJS side when visible was set to false, and it was first item in the dropdown.\n\t\t\t\tlabel: $.i18n._( 'Show Unscheduled Employees' ),\n\t\t\t\tid: 'all_employee_btn',\n\t\t\t\tno_group_label: true,\n\t\t\t\tvue_icon: 'tticon tticon-settings_black_24dp',\n\t\t\t\taction_group: 'schedule_settings',\n\t\t\t\tmulti_select_group: 1,\n\t\t\t\tvisible: this.unscheduledEmployeeUIValidate(),\n\t\t\t\t// visible: PermissionManager.checkTopLevelPermission( 'Wage' ),\n\t\t\t\tcommand: () => {\n\t\t\t\t\tthis.search();\n\t\t\t\t\tthis.onSearch( true ); //Trigger saving of saved search & layout.\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: $.i18n._( 'Strict Range' ),\n\t\t\t\tid: 'strict_range_btn',\n\t\t\t\tactive: true,\n\t\t\t\tno_group_label: true,\n\t\t\t\tvue_icon: 'tticon tticon-settings_black_24dp',\n\t\t\t\taction_group: 'schedule_settings',\n\t\t\t\tmulti_select_group: 4,\n\t\t\t\tvisible: true,\n\t\t\t\tcommand: () => {\n\t\t\t\t\t$this.search( false, true );\n\t\t\t\t\t$this.onSearch( true ); //Trigger saving of saved search & layout.\n\t\t\t\t}\n\t\t\t},\n\t\t];\n\n\t\tvar schedule_mode_options = [\n\t\t\t{ label: $.i18n._( 'Day' ), value: 'day' },\n\t\t\t{ label: $.i18n._( 'Week' ), value: 'week' },\n\t\t\t{ label: $.i18n._( 'Month' ), value: 'month' },\n\t\t\t{ label: $.i18n._( 'Year' ), value: 'year' }\n\t\t];\n\n\t\t// Init Vue control bar\n\n\t\tthis.vue_control_bar_mount_id = 'vue-schedule-control-bar';\n\t\tvar root_props = {\n\t\t\tview_id: this.viewId,\n\t\t\tschedule_settings_options: schedule_settings_options,\n\t\t\tschedule_mode_options: schedule_mode_options,\n\t\t}\n\n\t\tTTVueUtils.mountComponent( this.vue_control_bar_mount_id, ScheduleControlBar, root_props );\n\n\t\tvar date_chooser_div = $( '.schedule-view .date-chooser-div' );\n\n\t\t//The Vue ScheduleControlBar may already contain a date picker from a previous page load.\n\t\t//The parent div needs all children removed to prevent multiple date pickers from being added.\n\t\tdate_chooser_div.empty(); //TODO: Temp hack until root cause is found. Seems to happen on webpack prod but not build:dev:watch.\n\n\t\t//Create Start Date Picker\n\t\tthis.start_date_picker = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\t\tthis.start_date_picker.TDatePicker( { field: 'start_date' } );\n\t\tvar date_chooser = $( '<span class=\\'label\\'>' + $.i18n._( 'Date' ) + ':</span>' +\n\t\t\t'<img class=\\'left-arrow arrow\\' src=' + Global.getRealImagePath( 'images/left_arrow.svg' ) + '>' +\n\t\t\t'<div class=\\'date-picker-div\\'></div>' +\n\t\t\t'<img class=\\'right-arrow arrow\\' src=' + Global.getRealImagePath( 'images/right_arrow.svg' ) + '>' );\n\n\t\tdate_chooser_div.append( date_chooser );\n\t\tdate_chooser_div.find( '.date-picker-div' ).append( this.start_date_picker );\n\n\t\tvar date_left_arrow = date_chooser_div.find( '.left-arrow' );\n\t\tvar date_right_arrow = date_chooser_div.find( '.right-arrow' );\n\n\t\tdate_left_arrow.bind( 'click', function() {\n\t\t\tvar mode = $this.getMode();\n\t\t\tvar new_date;\n\t\t\tvar select_date = $this.start_date;\n\n\t\t\t$this.clearSelection();\n\n\t\t\tif ( !select_date ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tswitch ( mode ) {\n\t\t\t\tcase ScheduleViewControllerMode.WEEK:\n\t\t\t\t\tvar select_date = Global.strToDate( ( ( $this.getSelectDate() ) ? $this.getSelectDate() : new Date().format() ) );\n\t\t\t\t\tnew_date = new Date( new Date( select_date.getTime() ).setDate( select_date.getDate() - 7 ) );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ScheduleViewControllerMode.YEAR:\n\t\t\t\t\tnew_date = new Date( new Date( select_date.getTime() ).setDate( select_date.getDate() - 56 ) ); //8 weeks.\n\t\t\t\t\tbreak;\n\t\t\t\tcase ScheduleViewControllerMode.DAY:\n\t\t\t\t\tnew_date = new Date( new Date( select_date.getTime() ).setDate( select_date.getDate() - 1 ) );\n\t\t\t\t\tbreak\n\t\t\t\tcase ScheduleViewControllerMode.MONTH:\n\t\t\t\t\tif ( $this.settings_menu.getButton( 'strict_range_btn' ).active ) {\n\t\t\t\t\t\tnew_date = new Date( new Date( select_date.getTime() ).setDate( select_date.getDate() - 1 ) );\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnew_date = new Date( new Date( select_date.getTime() ).setDate( select_date.getDate() - 36 ) ); //5 weeks + 1 day same as going forward\n                    }\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tnew_date = new Date( new Date( select_date.getTime() ).setDate( select_date.getDate() - 1 ) );\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t$this.setDatePickerValue( new_date.format() );\n\t\t\t//$this.setDateUrl();\n\n\t\t\t//$this.buildCalendars();\n\t\t\t$this.search( false, true );\n\t\t} );\n\n\t\tdate_right_arrow.bind( 'click', function() {\n\t\t\tvar mode = $this.getMode();\n\t\t\tvar select_date = $this.end_date;\n\t\t\tvar new_date;\n\t\t\tif ( !select_date ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$this.clearSelection();\n\n\t\t\tswitch ( mode ) {\n\t\t\t\tcase ScheduleViewControllerMode.WEEK:\n\t\t\t\t\tvar select_date = Global.strToDate( ( ( $this.getSelectDate() ) ? $this.getSelectDate() : new Date().format() ) );\n\t\t\t\t\tnew_date = new Date( new Date( select_date.getTime() ).setDate( select_date.getDate() + 7 ) );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ScheduleViewControllerMode.YEAR:\n\t\t\t\t\tnew_date = new Date( new Date( select_date.getTime() ).setDate( select_date.getDate() + 56 ) ); //8 weeks\n\t\t\t\t\tbreak;\n\t\t\t\tcase ScheduleViewControllerMode.DAY:\n\t\t\t\t\tif ( $this.settings_menu.getButton( 'strict_range_btn' ).active ) {\n                        new_date = new Date( new Date( select_date.getTime() ).setDate( select_date.getDate() + 1 ) );\n                    } else {\n                        new_date = new Date( new Date( select_date.getTime() ).setDate( select_date.getDate() ) );\n                    }\n\t\t\t\t\tbreak;\n\t\t\t\tcase ScheduleViewControllerMode.MONTH:\n\t\t\t\tdefault:\n\t\t\t\t\tnew_date = new Date( new Date( select_date.getTime() ).setDate( select_date.getDate() + 1 ) );\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t$this.setDatePickerValue( new_date.format() );\n\t\t\t//$this.setDateUrl();\n\n\t\t\t//$this.buildCalendars();\n\t\t\t$this.search( false, true );\n\t\t} );\n\n\t\tthis.start_date_picker.bind( 'formItemChange', function() {\n\t\t\t//$this.setDateUrl();\n\t\t\t$this.clearSelection();\n\t\t\t$this.search( false, true );\n\t\t} );\n\n\t\t//Overwrite event listener on layout selector to prevent wrong start date issues by passing true on user_date_picker_date in search().\n\t\t$( this.search_panel.find( '#layout_selector' ) ).off( 'change' ).on( 'change', function() {\n\t\t\t$this.layout_changed = true;\n\n\t\t\tvar selectId = $this.search_panel.find( '#layout_selector' ).find( 'option:selected' ).attr( 'value' );\n\t\t\tvar layouts_array = $this.search_panel.getLayoutsArray();\n\t\t\tvar len = layouts_array.length;\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\tvar item = layouts_array[i];\n\n\t\t\t\tif ( item.id == selectId ) {\n\t\t\t\t\t$this.select_layout = item;\n\t\t\t\t\t$this.setSelectLayout();\n\t\t\t\t\t$this.search( false, true );\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t}\n\t\t\tGlobal.triggerAnalyticsNavigationOther( 'searchpanel:layout_change', 'click', $this.viewId );\n\t\t} );\n\n\t\t// Vue dummy interface objects for legacy<->new vue menus.\n\t\t// TODO: Improve this by replacing with ES6 classes, and have a parent class of jQueryDummy, with methods for get, set etc, but tie them in with the view id / option bar id, and button id.\n\n\t\tthis.toggle_button = (function( context ) {\n\t\t\tvar _value = 'week';\n\t\t\tcontext.event_bus.on( context.vue_control_bar_mount_id, 'scheduleModeOnChange', updateValueOnChange, TTEventBusStatics.AUTO_CLEAR_ON_EXIT );\n\n\n\t\t\tfunction updateValueOnChange( event_data ) {\n\t\t\t\tDebug.Text( 'Toggle button value update! Change event received. ('+ event_data +').', 'ScheduleViewController.js', 'ScheduleViewController', 'updateValueOnChange', 10 );\n\t\t\t\t//Issue #3376 - Selecting the same date mode twice in a row causes null to be set as date mode value causing later exceptions.\n\t\t\t\t//This can happen due to double clicks or other yet discovered reasons. I have only reproduced the bug by selecting the same date mode twice in a row.\n\t\t\t\t//However, it is possible that the bug can be reproduced by other means and this fix should hopefully catch them.\n\t\t\t\tif ( !event_data.value ) {\n\t\t\t\t\t$this.toggle_button.setValue( $this.getMode() );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t_value = event_data.value;\n\t\t\t}\n\n\t\t\tfunction getValue() {\n\t\t\t\treturn _value;\n\t\t\t}\n\n\t\t\tfunction setValue( new_value ) {\n\t\t\t\t_value = new_value; // Set locally in the button immediately, because setToggleButtonValue triggers setToggleButtonUrl which gets the value before the original set command has a chance to send the update to vue and back again to the dummy interface.\n\n\t\t\t\tcontext.event_bus.emit( context.vue_control_bar_mount_id, 'setValue', {\n\t\t\t\t\tkey: 'schedule_mode_options_selected',\n\t\t\t\t\tvalue: new_value\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tgetValue: getValue,\n\t\t\t\tsetValue: setValue\n\t\t\t}\n\t\t})(this);\n\n\t\t// schedule_settings_options\n\n\t\tthis.settings_menu = {\n\t\t\t//If issues happen with race conditions and execution ordeer, you can locally set the array value to the same\n\t\t\t// as what you are about to set the Vue component to, but this might have unexpected effects on the Vue reactive data.\n\t\t\tgetButton( id ) {\n\t\t\t\treturn schedule_settings_options.find( element => element.id === id );\n\t\t\t},\n\t\t\tenableButton( id ) {\n\t\t\t\t// set disable to false\n\t\t\t\t$this.event_bus.emit( $this.vue_control_bar_mount_id, 'setScheduleSettingsState', {\n\t\t\t\t\titem_id: id,\n\t\t\t\t\titem_field: 'disabled',\n\t\t\t\t\titem_value: false\n\t\t\t\t});\n\t\t\t},\n\t\t\tdisableButton( id ) {\n\t\t\t\t// set disable to true\n\t\t\t\t$this.event_bus.emit( $this.vue_control_bar_mount_id, 'setScheduleSettingsState', {\n\t\t\t\t\titem_id: id,\n\t\t\t\t\titem_field: 'disabled',\n\t\t\t\t\titem_value: true\n\t\t\t\t});\n\t\t\t},\n\t\t\tactivateButton( id ) {\n\t\t\t\t// set active to true\n\t\t\t\t$this.event_bus.emit( $this.vue_control_bar_mount_id, 'setSettingActive', {\n\t\t\t\t\titem_id: id\n\t\t\t\t});\n\t\t\t},\n\t\t\tdeactivateButton( id ) {\n\t\t\t\t// set active to false\n\t\t\t\t$this.event_bus.emit( $this.vue_control_bar_mount_id, 'setSettingDeactivated', {\n\t\t\t\t\titem_id: id\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tfunction scheduleModeOnChangeHandler( event_data ) {\n\t\t\tDebug.Text( 'Schedule mode change event received. ('+ event_data +').', 'ScheduleViewController.js', 'ScheduleViewController', 'scheduleModeOnChangeHandler', 10 );\n\n\t\t\t$this.scroll_position = 0;\n\t\t\t$this.select_all_shifts_array = [];\n\t\t\t$this.select_shifts_array = [];\n\t\t\t$this.select_recurring_shifts_array = [];\n\n\t\t\t$this.setToggleButtonUrl();\n\t\t\t$this.search( true, true );\n\t\t\t$this.onSearch( true ); //Trigger saving of saved search & layout, but do not search to stop double search calls.\n\t\t}\n\n\t\tthis.event_bus.on( this.vue_control_bar_mount_id, 'scheduleModeOnChange', scheduleModeOnChangeHandler, TTEventBusStatics.AUTO_CLEAR_ON_EXIT );\n\n\t}\n\n\tcheckScheduleData() {\n\t\tif ( this.full_schedule_data === true ) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tshowWeeklyTotal() {\n\t\tvar show_weekly_total = this.settings_menu.getButton( 'weekly_totals_btn' ).active && !this.settings_menu.getButton( 'weekly_totals_btn' ).disabled;\n\n\t\tif ( !show_weekly_total ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar shifts = 0;\n\t\tvar absences = 0;\n\t\tvar total_time = 0;\n\t\tvar total_wage = 0;\n//\t\t  var is_date_row = false;\n//\t\t  var current_key = [];\n\n\t\tvar mode = this.getMode();\n\n\t\tvar len = this.schedule_source.length;\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar row = this.schedule_source[i];\n\n\t\t\tif ( row.type === ScheduleViewControllerRowType.DATE ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tfor ( var key in row ) {\n\n\t\t\t\t//As data comes from the grid, we can't be sure of the types of any data within it. (Same goes for item below)\n\t\t\t\tvar data = Global.isSet( row[key] ) ? row[key] : '';\n\n\t\t\t\tif ( Global.isSet( data.user_id ) || ( Global.isArray( data ) && mode === ScheduleViewControllerMode.YEAR && data.every( item => item.total_time_wage ) ) ) {\n\n\t\t\t\t\tif ( mode === ScheduleViewControllerMode.YEAR ) {\n\t\t\t\t\t\tvar data_len = data.length;\n\t\t\t\t\t\tfor ( var j = 0; j < data_len; j++ ) {\n\t\t\t\t\t\t\tvar item = data[j];\n\t\t\t\t\t\t\titem.total_time_wage = parseFloat( item.total_time_wage );\n\t\t\t\t\t\t\titem.total_time = parseFloat( item.total_time );\n\n\t\t\t\t\t\t\tif ( Global.isSet( item.user_id ) ) {\n\t\t\t\t\t\t\t\ttotal_wage = ( item.total_time_wage + total_wage );\n\t\t\t\t\t\t\t\tif ( item.status_id == 10 ) {\n\t\t\t\t\t\t\t\t\ttotal_time = ( item.total_time + total_time );\n\t\t\t\t\t\t\t\t\tshifts = shifts + 1;\n\t\t\t\t\t\t\t\t} else if ( data.status_id == 20 && data.absence_policy_id != TTUUID.zero_id && data.absence_policy_id != TTUUID.not_exist_id ) { //&& data.total_time_wage != 0\n\t\t\t\t\t\t\t\t\ttotal_time = ( item.total_time + total_time );\n\t\t\t\t\t\t\t\t\tabsences = absences + 1;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdata.total_time_wage = parseFloat( data.total_time_wage );\n\t\t\t\t\t\tdata.total_time = parseFloat( data.total_time );\n\t\t\t\t\t\ttotal_wage = ( data.total_time_wage + total_wage );\n\t\t\t\t\t\tif ( data.status_id == 10 ) {\n\t\t\t\t\t\t\ttotal_time = ( data.total_time + total_time );\n\t\t\t\t\t\t\tshifts = shifts + 1;\n\t\t\t\t\t\t} else if ( data.status_id == 20 && data.absence_policy_id != TTUUID.zero_id && data.absence_policy_id != TTUUID.not_exist_id ) { //&& data.total_time_wage != 0\n\t\t\t\t\t\t\ttotal_time = ( data.total_time + total_time );\n\t\t\t\t\t\t\tabsences = absences + 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( Global.isSet( data.shifts ) ) {\n\t\t\t\t\tdata.total_time_wage = parseFloat( data.total_time_wage );\n\t\t\t\t\tdata.total_time = parseFloat( data.total_time );\n\n\t\t\t\t\ttotal_time = ( data.total_time + total_time );\n\t\t\t\t\ttotal_wage = ( data.total_time_wage + total_wage );\n\n\t\t\t\t\tshifts = shifts + data.shifts;\n\t\t\t\t\tabsences = absences + data.absences;\n\t\t\t\t} else if ( row.type !== ScheduleViewControllerRowType.DATE ) {\n\n\t\t\t\t} else {\n//\t\t\t\t\t  current_key[key] = row[key];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trow.total_time = Global.getTimeUnit( total_time );\n\t\t\trow.total_time_wage = LocalCacheData.getCurrentCurrencySymbol() + Global.MoneyRound( total_wage );\n\t\t\t//ViewManagerUtil.getTimeUnit(totalTime);\n\t\t\trow.shifts = shifts;\n\t\t\trow.absences = absences;\n\n\t\t\ttotal_time = 0;\n\t\t\ttotal_wage = 0;\n\t\t\tshifts = 0;\n\t\t\tabsences = 0;\n\t\t}\n\t}\n\n\tbuildTotalShiftsValues( total_shifts_dic, currentItem ) {\n\t\tvar start_date = Global.strToDateTime( currentItem.start_date );\n\t\tvar end_date = Global.strToDateTime( currentItem.end_date );\n\t\tvar start_time_min = start_date.getMinutes();\n\t\tvar end_time_min = end_date.getMinutes();\n\n\t\tstart_date.setMinutes( 0 );\n\t\tend_date.setMinutes( 0 );\n\n\t\tvar start_time = start_date.format( 'hA' );\n\t\tvar end_time = end_date.format( 'hA' );\n\n\t\tvar time_offset = Math.ceil( getTimeOffset( start_date, end_date ) / 60 / 60 );\n\n\t\tvar rest_time;\n\t\tif ( time_offset < 1 ) {\n\n\t\t\ttotal_shifts_dic[end_time].value = total_shifts_dic[end_time].value + Number( ( end_time_min / 60 ).toFixed( 0 ) );\n\t\t} else {\n\t\t\tif ( start_time_min == 0 ) {\n\n\t\t\t\ttotal_shifts_dic[start_time].value = total_shifts_dic[start_time].value + 1;\n\t\t\t} else {\n\t\t\t\ttotal_shifts_dic[start_time].value = total_shifts_dic[start_time].value + Number( ( ( 60 - start_time_min ) /\n\t\t\t\t\t60 ).toFixed( 2 ) );\n\t\t\t}\n\n\t\t\tfor ( var i = 1; i < time_offset; i++ ) {\n\t\t\t\tstart_date.setHours( start_date.getHours() + 1 );\n\t\t\t\t//start_time = start_date.format( 'hh:mm A' );\n\t\t\t\tstart_time = start_date.format( 'hA' );\n\n\t\t\t\tif ( !total_shifts_dic.hasOwnProperty( start_time ) ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif ( i == time_offset - 1 ) {\n\t\t\t\t\tif ( end_time_min > 0 ) {\n\t\t\t\t\t\ttotal_shifts_dic[start_time].value = total_shifts_dic[start_time].value + Number( ( end_time_min /\n\t\t\t\t\t\t\t60 ).toFixed( 2 ) );\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttotal_shifts_dic[start_time].value = total_shifts_dic[start_time].value + 1;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\ttotal_shifts_dic[start_time].value = total_shifts_dic[start_time].value + 1;\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction getTimeOffset( startDate, endDate ) {\n\t\t\tif ( !startDate ) {\n\t\t\t\tstartDate = new Date();\n\t\t\t}\n\t\t\tvar sec = ( endDate.getTime() - startDate.getTime() ) / 1000;\n\t\t\treturn sec.toFixed( 0 );\n\t\t}\n\t}\n\n\tshowDailyTotal() {\n\t\tvar show_daily_total = this.settings_menu.getButton( 'daily_totals_btn' ).active && !this.settings_menu.getButton( 'daily_totals_btn' ).disabled;\n\n\t\tif ( !show_daily_total ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar start = true;\n\t\tvar total_row = null;\n\t\tvar column_keys = [];\n\t\tvar over_all_total_row = {};\n\n\t\tvar display_columns = this.select_layout.data.display_columns;\n\t\tvar display_columns_len = display_columns.length;\n\n\t\tfor ( var i = 0; i < display_columns_len; i++ ) {\n\t\t\tvar column_name = display_columns[i];\n\n\t\t\tcolumn_keys.push( { key: column_name, row: null, value: null } );\n\n\t\t}\n\n\t\tvar column_keys_len = column_keys.length;\n\n\t\tfor ( var i = 0; i < this.schedule_source.length; i++ ) {\n\t\t\tvar row = this.schedule_source[i];\n\t\t\tif ( start ) {\n\n\t\t\t\tfor ( var j = 0; j < column_keys_len; j++ ) {\n\t\t\t\t\tvar column_key = column_keys[j];\n\t\t\t\t\ttotal_row = { type: ScheduleViewControllerRowType.TOTAL };\n\t\t\t\t\ttotal_row[column_key.key] = $.i18n._( 'Totals' );\n\t\t\t\t\tcolumn_key.row = total_row;\n\t\t\t\t\tcolumn_key.value = row[column_key.key];\n\n\t\t\t\t}\n\n\t\t\t\tover_all_total_row = { type: ScheduleViewControllerRowType.TOTAL };\n\t\t\t\tover_all_total_row.user_full_name = $.i18n._( 'Overall Totals' );\n\t\t\t}\n\n\t\t\tfor ( var y = column_keys_len - 1; y >= 0; y-- ) {\n\n\t\t\t\tcolumn_key = column_keys[y];\n\n\t\t\t\tif ( ( row[column_key.key] !== column_key.value && i > 0 ) && !start && i !== 0 ) {\n\n\t\t\t\t\tthis.schedule_source.splice( i, 0, column_key.row );\n\t\t\t\t\ti = i + 1;\n\t\t\t\t\ttotal_row = { type: ScheduleViewControllerRowType.TOTAL };\n\t\t\t\t\ttotal_row[column_key.key] = $.i18n._( 'Totals' );\n\t\t\t\t\tcolumn_key.row = total_row;\n\t\t\t\t\tcolumn_key.value = row[column_key.key];\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( start ) {\n\t\t\t\tstart = false;\n\t\t\t}\n\t\t\tif ( row.type === ScheduleViewControllerRowType.DATE ) { //do not calculate date row\n\t\t\t\tthis.schedule_source.splice( i, 0, over_all_total_row );\n\t\t\t\tover_all_total_row = { type: ScheduleViewControllerRowType.TOTAL };\n\t\t\t\tover_all_total_row.user_full_name = $.i18n._( 'Overall Totals' );\n\t\t\t\ti = i + 1;\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tfor ( var key in row ) {\n\n\t\t\t\tvar data = Global.isSet( row[key] ) ? row[key] : '';\n\t\t\t\tfor ( var x = 0; x < column_keys_len; x++ ) {\n\n\t\t\t\t\tcolumn_key = column_keys[x];\n\t\t\t\t\ttotal_row = column_key.row;\n\n\t\t\t\t\t//Total rows for each columns\n\t\t\t\t\tif ( data && Global.isSet( data.user_id ) ) {\n\n\t\t\t\t\t\tvar no_data_key = key.replace( '_data', '' );\n\n\t\t\t\t\t\tvar total_row_key_data = total_row[no_data_key];\n\n\t\t\t\t\t\tif ( !total_row_key_data || !Global.isSet( total_row_key_data.total_time ) ) {\n\t\t\t\t\t\t\ttotal_row[no_data_key] = {};\n\t\t\t\t\t\t\ttotal_row_key_data = total_row[no_data_key];\n\t\t\t\t\t\t\ttotal_row_key_data.total_time = 0;\n\t\t\t\t\t\t\ttotal_row_key_data.total_shifts_dic = Global.clone( this.total_shifts_dic );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t//#2381 - total_time can be a string from the API\n\t\t\t\t\t\t\ttotal_row_key_data.total_time = parseInt( total_row_key_data.total_time );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( !Global.isSet( total_row_key_data.shifts ) ) {\n\t\t\t\t\t\t\ttotal_row_key_data.shifts = 0;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( !Global.isSet( total_row_key_data.absences ) ) {\n\t\t\t\t\t\t\ttotal_row_key_data.absences = 0;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( !Global.isSet( total_row_key_data.total_time_wage ) ) {\n\t\t\t\t\t\t\ttotal_row_key_data.total_time_wage = 0;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar row_data = row[no_data_key + '_data'];\n\t\t\t\t\t\t//#2381 - total_time can be a string from the API\n\t\t\t\t\t\trow_data.total_time = parseInt( row_data.total_time );\n\n\t\t\t\t\t\ttotal_row_key_data.total_time_wage = Global.MoneyRound( parseFloat( parseFloat( row_data.total_time_wage ) + parseFloat( total_row_key_data.total_time_wage ) ) );\n\t\t\t\t\t\tif ( row_data.status_id == 10 ) {\n\t\t\t\t\t\t\ttotal_row_key_data.total_time = parseFloat( row_data.total_time ) + parseFloat( total_row_key_data.total_time );\n\t\t\t\t\t\t\ttotal_row_key_data.shifts = total_row_key_data.shifts + 1;\n\t\t\t\t\t\t\tif ( this.getMode() === ScheduleViewControllerMode.DAY ) {\n\t\t\t\t\t\t\t\tthis.buildTotalShiftsValues( total_row_key_data.total_shifts_dic, row[key] );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if ( row_data.status_id == 20 && row_data.absence_policy_id != TTUUID.zero_id && row_data.absence_policy_id != TTUUID.not_exist_id ) { //&& row_data.total_time_wage != 0\n\t\t\t\t\t\t\ttotal_row_key_data.total_time = parseFloat( row_data.total_time ) + parseFloat( total_row_key_data.total_time );\n\t\t\t\t\t\t\ttotal_row_key_data.absences = total_row_key_data.absences + 1;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t//Total rows for all employees\n\n\t\t\t\tif ( data && Global.isSet( data.user_id ) ) {\n\n\t\t\t\t\tno_data_key = key.replace( '_data', '' );\n\n\t\t\t\t\ttotal_row_key_data = over_all_total_row[no_data_key];\n\n\t\t\t\t\tif ( !total_row_key_data || !Global.isSet( total_row_key_data.total_time ) ) {\n\t\t\t\t\t\tover_all_total_row[no_data_key] = {};\n\t\t\t\t\t\ttotal_row_key_data = over_all_total_row[no_data_key];\n\t\t\t\t\t\ttotal_row_key_data.total_time = 0;\n\t\t\t\t\t\ttotal_row_key_data['total_shifts_dic'] = Global.clone( this.total_shifts_dic );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( !Global.isSet( total_row_key_data.shifts ) ) {\n\t\t\t\t\t\ttotal_row_key_data.shifts = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( !Global.isSet( total_row_key_data.absences ) ) {\n\t\t\t\t\t\ttotal_row_key_data.absences = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( !Global.isSet( total_row_key_data.total_time_wage ) ) {\n\t\t\t\t\t\ttotal_row_key_data.total_time_wage = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\trow_data = row[no_data_key + '_data'];\n\n\t\t\t\t\ttotal_row_key_data.total_time_wage = Global.MoneyRound( parseFloat( parseFloat( row_data.total_time_wage ) + parseFloat( total_row_key_data.total_time_wage ) ) );\n\t\t\t\t\tif ( row_data.status_id == 10 ) {\n\t\t\t\t\t\ttotal_row_key_data.total_time = parseFloat( row_data.total_time ) + parseFloat( total_row_key_data.total_time );\n\t\t\t\t\t\ttotal_row_key_data.shifts = total_row_key_data.shifts + 1;\n\t\t\t\t\t\tif ( this.getMode() === ScheduleViewControllerMode.DAY ) {\n\t\t\t\t\t\t\tthis.buildTotalShiftsValues( total_row_key_data.total_shifts_dic, row[key] );\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if ( row_data.status_id == 20 && row_data.absence_policy_id != TTUUID.zero_id && row_data.absence_policy_id != TTUUID.not_exist_id ) { //&& row_data.total_time_wage != 0\n\t\t\t\t\t\ttotal_row_key_data.total_time = parseFloat( row_data.total_time ) + parseFloat( total_row_key_data.total_time );\n\t\t\t\t\t\ttotal_row_key_data.absences = total_row_key_data.absences + 1;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( i === this.schedule_source.length - 1 ) {\n\t\t\t\tfor ( var j = column_keys.length - 1; j >= 0; j-- ) {\n\t\t\t\t\tthis.schedule_source.push( column_keys[j].row );\n\t\t\t\t}\n\t\t\t\tthis.schedule_source.push( over_all_total_row );\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tbuildSearchFields() {\n\t\tsuper.buildSearchFields();\n\t\tvar $this = this;\n\n\t\tvar default_args = { permission_section: 'schedule' };\n\n\t\tif ( PermissionManager.validate( this.permission_id, 'view' ) || PermissionManager.validate( this.permission_id, 'view_child' ) ) {\n\t\t\tthis.search_fields = [\n\t\t\t\tnew SearchField( {\n\t\t\t\t\tlabel: $.i18n._( 'Status' ),\n\t\t\t\t\tin_column: 1,\n\t\t\t\t\tfield: 'status_id',\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tbasic_search: true,\n\t\t\t\t\tadv_search: true,\n\t\t\t\t\tlayout_name: 'global_option_column',\n\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t} ),\n\n\t\t\t\tnew SearchField( {\n\t\t\t\t\tlabel: $.i18n._( 'Schedule Branch' ),\n\t\t\t\t\tin_column: 1,\n\t\t\t\t\tfield: 'schedule_branch_ids',\n\t\t\t\t\tlayout_name: 'global_branch',\n\t\t\t\t\tapi_class: TTAPI.APIBranch,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tbasic_search: true,\n\t\t\t\t\tadv_search: true,\n\t\t\t\t\tscript_name: 'BranchView',\n\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t} ),\n\n\t\t\t\tnew SearchField( {\n\t\t\t\t\tlabel: $.i18n._( 'Schedule Department' ),\n\t\t\t\t\tin_column: 1,\n\t\t\t\t\tfield: 'department_ids',\n\t\t\t\t\tlayout_name: 'global_department',\n\t\t\t\t\tapi_class: TTAPI.APIDepartment,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tbasic_search: true,\n\t\t\t\t\tadv_search: true,\n\t\t\t\t\tscript_name: 'DepartmentView',\n\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t} ),\n\n\t\t\t\tnew SearchField( {\n\t\t\t\t\tlabel: $.i18n._( 'Default Branch' ),\n\t\t\t\t\tin_column: 1,\n\t\t\t\t\tfield: 'default_branch_ids',\n\t\t\t\t\tlayout_name: 'global_branch',\n\t\t\t\t\tapi_class: TTAPI.APIBranch,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tbasic_search: false,\n\t\t\t\t\tadv_search: true,\n\t\t\t\t\tscript_name: 'BranchView',\n\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t} ),\n\n\t\t\t\tnew SearchField( {\n\t\t\t\t\tlabel: $.i18n._( 'Default Department' ),\n\t\t\t\t\tin_column: 1,\n\t\t\t\t\tfield: 'default_department_ids',\n\t\t\t\t\tlayout_name: 'global_department',\n\t\t\t\t\tapi_class: TTAPI.APIDepartment,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tbasic_search: false,\n\t\t\t\t\tadv_search: true,\n\t\t\t\t\tscript_name: 'DepartmentView',\n\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t} ),\n\n\t\t\t\tnew SearchField( {\n\t\t\t\t\tlabel: $.i18n._( 'Group' ),\n\t\t\t\t\tin_column: 2,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tfield: 'group_ids',\n\t\t\t\t\tlayout_name: 'global_tree_column',\n\t\t\t\t\ttree_mode: true,\n\t\t\t\t\tbasic_search: true,\n\t\t\t\t\tadv_search: true,\n\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t} ),\n\n\t\t\t\tnew SearchField( {\n\t\t\t\t\tlabel: $.i18n._( 'Title' ),\n\t\t\t\t\tfield: 'title_id',\n\t\t\t\t\tin_column: 2,\n\t\t\t\t\tlayout_name: 'global_job_title',\n\t\t\t\t\tapi_class: TTAPI.APIUserTitle,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tbasic_search: true,\n\t\t\t\t\tadv_search: true,\n\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t} ),\n\n\t\t\t\tnew SearchField( {\n\t\t\t\t\tlabel: $.i18n._( 'Job' ),\n\t\t\t\t\tin_column: 2,\n\t\t\t\t\tfield: 'job_id',\n\t\t\t\t\tlayout_name: 'global_job',\n\t\t\t\t\tapi_class: ( Global.getProductEdition() >= 20 ) ? TTAPI.APIJob : null,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tbasic_search: false,\n\t\t\t\t\tadv_search: ( this.show_job_ui && ( Global.getProductEdition() >= 20 ) ),\n\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t} ),\n\n\t\t\t\tnew SearchField( {\n\t\t\t\t\tlabel: $.i18n._( 'Task' ),\n\t\t\t\t\tin_column: 2,\n\t\t\t\t\tfield: 'job_item_id',\n\t\t\t\t\tlayout_name: 'global_job_item',\n\t\t\t\t\tapi_class: ( Global.getProductEdition() >= 20 ) ? TTAPI.APIJobItem : null,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tbasic_search: false,\n\t\t\t\t\tadv_search: ( this.show_job_item_ui && ( Global.getProductEdition() >= 20 ) ),\n\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t} ),\n\n\t\t\t\tnew SearchField( {\n\t\t\t\t\tlabel: $.i18n._( 'Punch Tags' ),\n\t\t\t\t\tin_column: 2,\n\t\t\t\t\tfield: 'punch_tag_id',\n\t\t\t\t\tlayout_name: 'global_punch_tag',\n\t\t\t\t\tapi_class: ( Global.getProductEdition() >= 20 ) ? TTAPI.APIPunchTag : null,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tbasic_search: false,\n\t\t\t\t\tadv_search: ( this.show_punch_tag_ui && ( Global.getProductEdition() >= 20 ) ),\n\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t} ),\n\n\t\t\t\tnew SearchField( {\n\t\t\t\t\tlabel: $.i18n._( 'Recurring Template' ),\n\t\t\t\t\tfield: 'recurring_schedule_template_control_id',\n\t\t\t\t\tin_column: 3,\n\t\t\t\t\tlayout_name: 'global_recurring_schedule_control',\n\t\t\t\t\tapi_class: TTAPI.APIRecurringScheduleTemplateControl,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tbasic_search: false,\n\t\t\t\t\tadv_search: true,\n\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t} ),\n\n\t\t\t\tnew SearchField( {\n\t\t\t\t\tlabel: $.i18n._( 'Absence Policy' ),\n\t\t\t\t\tfield: 'absence_policy_id',\n\t\t\t\t\tin_column: 3,\n\t\t\t\t\tlayout_name: 'global_absences',\n\t\t\t\t\tapi_class: TTAPI.APIAbsencePolicy,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tbasic_search: false,\n\t\t\t\t\tadv_search: true,\n\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t} ),\n\n\t\t\t\tnew SearchField( {\n\t\t\t\t\tlabel: $.i18n._( 'Include Employees' ),\n\t\t\t\t\tin_column: 3,\n\t\t\t\t\tfield: 'include_user_ids',\n\t\t\t\t\tlayout_name: 'global_user',\n\t\t\t\t\tapi_class: TTAPI.APIUser,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tbasic_search: false,\n\t\t\t\t\tadv_search: true,\n\t\t\t\t\tdefault_args: default_args,\n\t\t\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\t\t\treturn $this.onEmployeeSourceCreate( target, source_data );\n\t\t\t\t\t} ),\n\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t} ),\n\n\t\t\t\tnew SearchField( {\n\t\t\t\t\tlabel: $.i18n._( 'Exclude Employees' ),\n\t\t\t\t\tin_column: 3,\n\t\t\t\t\tfield: 'exclude_user_ids',\n\t\t\t\t\tlayout_name: 'global_user',\n\t\t\t\t\tapi_class: TTAPI.APIUser,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tbasic_search: false,\n\t\t\t\t\tadv_search: true,\n\t\t\t\t\tdefault_args: default_args,\n\t\t\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\t\t\treturn $this.onEmployeeSourceCreate( target, source_data );\n\t\t\t\t\t} ),\n\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t} )\n\t\t\t];\n\t\t} else {\n\t\t\t//Allow regular employees to add job/task columns if needed, and do some other basic searches.\n\t\t\tthis.search_fields = [];\n\n\t\t\tthis.search_fields.push(\n\t\t\t\tnew SearchField( {\n\t\t\t\t\tlabel: $.i18n._( 'Status' ),\n\t\t\t\t\tin_column: 1,\n\t\t\t\t\tfield: 'status_id',\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tbasic_search: true,\n\t\t\t\t\tadv_search: false,\n\t\t\t\t\tlayout_name: 'global_option_column',\n\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t} ) );\n\n\t\t\t//Check punch permissions rather than schedule, since this is a regular employee who likely wouldn't have\n\t\t\tif ( PermissionManager.validate( 'punch', 'edit_branch' ) || PermissionManager.validate( this.permission_id, 'edit_branch' ) ) {\n\t\t\t\tthis.search_fields.push(\n\t\t\t\t\tnew SearchField( {\n\t\t\t\t\t\tlabel: $.i18n._( 'Schedule Branch' ),\n\t\t\t\t\t\tin_column: 1,\n\t\t\t\t\t\tfield: 'schedule_branch_ids',\n\t\t\t\t\t\tlayout_name: 'global_branch',\n\t\t\t\t\t\tapi_class: TTAPI.APIBranch,\n\t\t\t\t\t\tmultiple: true,\n\t\t\t\t\t\tbasic_search: true,\n\t\t\t\t\t\tadv_search: false,\n\t\t\t\t\t\tscript_name: 'BranchView',\n\t\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t\t} ) );\n\t\t\t}\n\n\t\t\tif ( PermissionManager.validate( 'punch', 'edit_department' ) || PermissionManager.validate( this.permission_id, 'edit_department' ) ) {\n\t\t\t\tthis.search_fields.push(\n\t\t\t\t\tnew SearchField( {\n\t\t\t\t\t\tlabel: $.i18n._( 'Schedule Department' ),\n\t\t\t\t\t\tin_column: 1,\n\t\t\t\t\t\tfield: 'department_ids',\n\t\t\t\t\t\tlayout_name: 'global_department',\n\t\t\t\t\t\tapi_class: TTAPI.APIDepartment,\n\t\t\t\t\t\tmultiple: true,\n\t\t\t\t\t\tbasic_search: true,\n\t\t\t\t\t\tadv_search: false,\n\t\t\t\t\t\tscript_name: 'DepartmentView',\n\t\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t\t} ) );\n\t\t\t}\n\n\t\t\t//Could be permission issues with this, so disable for now.\n\t\t\t// if ( Global.getProductEdition() >= 20 && ( PermissionManager.validate( 'punch', 'edit_job' ) || PermissionManager.validate( this.permission_id, 'edit_job' ) ) ) {\n\t\t\t// \tthis.search_fields.push(\n\t\t\t// \t\tnew SearchField( {\n\t\t\t// \t\t\tlabel: $.i18n._( 'Job' ),\n\t\t\t// \t\t\tin_column: 2,\n\t\t\t// \t\t\tfield: 'job_id',\n\t\t\t// \t\t\tlayout_name: 'global_job',\n\t\t\t// \t\t\tapi_class: ( Global.getProductEdition() >= 20 ) ? TTAPI.APIJob : null,\n\t\t\t// \t\t\tmultiple: true,\n\t\t\t// \t\t\tbasic_search: true,\n\t\t\t// \t\t\tadv_search: false,\n\t\t\t// \t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t// \t\t} ) );\n\t\t\t// }\n\t\t\t//\n\t\t\t// if ( Global.getProductEdition() >= 20 && ( PermissionManager.validate( 'punch', 'edit_job_item' ) || PermissionManager.validate( this.permission_id, 'edit_job_item' ) ) ) {\n\t\t\t// \tthis.search_fields.push(\n\t\t\t// \t\tnew SearchField( {\n\t\t\t// \t\t\tlabel: $.i18n._( 'Task' ),\n\t\t\t// \t\t\tin_column: 2,\n\t\t\t// \t\t\tfield: 'job_item_id',\n\t\t\t// \t\t\tlayout_name: 'global_job_item',\n\t\t\t// \t\t\tapi_class: ( Global.getProductEdition() >= 20 ) ? TTAPI.APIJobItem : null,\n\t\t\t// \t\t\tmultiple: true,\n\t\t\t// \t\t\tbasic_search: true,\n\t\t\t// \t\t\tadv_search: false,\n\t\t\t// \t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t// \t\t} ) );\n\t\t\t// }\n\n\t\t}\n\t}\n\n\tonSourceDataCreate( target, source_data ) {\n\n\t\t//if ( !this.is_mass_adding ) {\n\t\t//\treturn source_data;\n\t\t//}\n\t\tvar $this = this;\n\t\tvar display_columns = target.getDisplayColumns();\n\t\tvar first_item = {};\n\t\tvar second_item = {};\n\n\t\t//FIXME: what should we do about -2?\n\n\t\t$.each( display_columns, function( index, content ) {\n\t\t\tfirst_item.id = TTUUID.not_exist_id;\n\t\t\tfirst_item[content.name] = Global.default_item;\n\t\t\tif ( $this.select_cells_Array.length > 0 && !$this.is_mass_editing ) {\n\t\t\t\tsecond_item.id = '-2';\n\t\t\t\tsecond_item[content.name] = Global.selected_item;\n\t\t\t}\n\t\t\treturn false;\n\t\t} );\n\n\t\t//Error: Object doesn't support property or method 'unshift' in /interface/html5/line 6953\n\t\tif ( !source_data || $.type( source_data ) !== 'array' ) {\n\t\t\tsource_data = [];\n\t\t}\n\t\tif ( this.select_cells_Array.length > 0 && !$this.is_mass_editing ) {\n\t\t\tsource_data.unshift( second_item );\n\t\t}\n\t\tsource_data.unshift( first_item );\n\n\t\treturn source_data;\n\t}\n\n\tonSourceDataCreatePunchTag( target, source_data ) {\n\n\t\t//if ( !this.is_mass_adding ) {\n\t\t//\treturn source_data;\n\t\t//}\n\t\tvar $this = this;\n\t\tvar display_columns = target.getDisplayColumns();\n\t\tvar first_item = {};\n\n\t\t$.each( display_columns, function( index, content ) {\n\t\t\tfirst_item.id = TTUUID.not_exist_id;\n\t\t\tfirst_item[content.name] = Global.default_item;\n\t\t\treturn false;\n\t\t} );\n\n\t\t//Error: Object doesn't support property or method 'unshift' in /interface/html5/line 6953\n\t\tif ( !source_data || $.type( source_data ) !== 'array' ) {\n\t\t\tsource_data = [];\n\t\t}\n\n\t\tsource_data.unshift( first_item );\n\n\t\treturn source_data;\n\t}\n\n\tonEmployeeSourceCreate( target, source_data ) {\n\n\t\tif ( !this.checkOpenPermission() ) {\n\t\t\treturn source_data;\n\t\t}\n\n\t\tvar display_columns = target.getDisplayColumns();\n\n\t\tvar first_item = {};\n\t\t$.each( display_columns, function( index, content ) {\n\n\t\t\tfirst_item.id = TTUUID.zero_id;\n\t\t\tfirst_item[content.name] = Global.open_item;\n\n\t\t\treturn false;\n\t\t} );\n\n\t\t//Error: Object doesn't support property or method 'unshift' in /interface/html5/line 6953\n\t\tif ( !source_data || $.type( source_data ) !== 'array' ) {\n\t\t\tsource_data = [];\n\t\t}\n\t\tsource_data.unshift( first_item );\n\n\t\treturn source_data;\n\t}\n\n\taddOPenField( target, source_data ) {\n\t\tvar open_field = {};\n\t}\n\n\tcleanWhenUnloadView( callBack ) {\n\t\tthis.event_bus.autoClear(); // TODO: Once Schedule proof of concept works, move this to the BaseView function to apply to all views.\n\t\tTTVueUtils.unmountComponent( this.vue_control_bar_mount_id );\n\t\t$( '#schedule_view_container' ).remove();\n\t\tsuper.cleanWhenUnloadView( callBack );\n\t}\n\n\tsetAddRequestIcon( context_btn, grid_selected_length ) {\n\t\tif ( Global.getProductEdition() <= 10 || !this.addPermissionValidate( 'request' ) || this.edit_only_mode ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t}\n\n\t\tif ( this.enableAddRequestButton() === true ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t} else {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n}\n\nScheduleViewController.html_template = `\n<div class=\"view schedule-view\" id=\"schedule_view_container\">\n\t<div class=\"clear-both-div\"></div>\n\t<div id=\"vue-schedule-control-bar\"></div>\n\t<div class=\"clear-both-div\"></div>\n\t<div class=\"grid-top-border schedule-top-border\"></div>\n\t<div class=\"grid-div schedule-grid-div\">\n\t\t<table id=\"grid\"></table>\n\t</div>\n\t<div class=\"grid-bottom-border\"></div>\n</div>`;\n\nvar ScheduleViewControllerRowType = function() {\n\n};\n\nScheduleViewControllerRowType.TOTAL = 1;\nScheduleViewControllerRowType.DATE = 2;\nScheduleViewControllerRowType.EMPTY = 3;\n\nvar ScheduleViewControllerMode = function() {\n\n};\n\nScheduleViewControllerMode.DAY = 'day';\nScheduleViewControllerMode.WEEK = 'week';\nScheduleViewControllerMode.MONTH = 'month';\nScheduleViewControllerMode.YEAR = 'year';\n\n"],"names":["_sfc_main","event_data","valid_editable_fields","item_id","item","element","SelectButton","TTContextButton","_hoisted_1","_createElementVNode","_hoisted_4","_hoisted_5","_hoisted_6","_openBlock","_createElementBlock","_hoisted_2","_hoisted_3","_createVNode","_component_SelectButton","$data","_cache","$event","$props","_component_TTContextButton","_normalizeClass","ScheduleViewController","options","_","$","Global","p_id","$this","date","format","dateStr","val","mode","callBack","columns_result","columns_result_data","group_columns_result","all_columns","group_columns_result_data","final_all_columns","all_len","group_len","i","group_column_id","j","column","res","retval","_a","result","len","selected_item","navigation_div","filter","grid_selected_id_array","grid_selected_length","selectedId","select_shift","result_data","record","noRefreshUI","record_id","baseRecord","index","value","key","shift","onMassEditResult","result1","remove_ids","callback","doNext","recurring_delete_shifts_array","context_menu_model","id","shift_array","first_shift","last_shift","request","shift_status","type_id","mon","tue","wed","thu","fri","sat","sun","w","d","start_date","end_date","schedules","users","args","employee_id","notify_users","iconName","post_data","new_end_date","postData","ScheduleViewControllerMode","e","grid_div","grid_pos","mouse_y","grid_height","div","event","cells","td","container","span","target_empty_row","delete_old_items","new_shifts_array","delete_shifts_array","target_cell","selected_shifts","first_target_row_index","first_target_cell_index","row_index_offset","cell_index_offset","first_selected_row_index","first_selected_cell_index","colModel","cell","target_row_index","target_cell_index","target_data","target_row","ScheduleViewControllerRowType","date_stamp","related_date","new_shift","temp_selected_data","temp_target_data","user","n","login_user","doing_save_and_new","temp_date","did_clean_dic","widget","tab_id","job","job_id_col_name","filter_data","job_widget","target","doNotValidate","c_value","startTime","endTime","schedulePolicyId","user_id","total_time","absence_widget","old_value","task_result","data","commonRecord","checkFields","record_array","common_record","y","new_common_record","ignoreWarning","current_date_str","current_date","next_date","massAddArgs","field","context_btn","getRate","form_item_input","widgetContainer","tab_model","tab_schedule","tab_schedule_column1","default_args","source_data","job_coder","job_item_coder","punch_tags","get_real_data","punch_tag_coder","dates","resultArray","beginDate","endDate","nextDate","cells_array","date_dic","last_date_stamp","layout_div","form_item","form_item_label","form_item_input_div","save_btn","update_btn","del_btn","user_array","date_array","punch_tag_widget","doNotSetFocus","first","pId","selectId","layout_name","selected_display_columns","default_layout_name","do_update","default_layout_id","display_columns","select_items","content","save_only","layout_data","layouts_array","setDefaultMenu","use_date_picker_date","start_date_string","strict","row","start_day","context_menu_array","override_icon","icon","notify_user_schedule_change_icon","drag_copy_icon","move_icon","swap_icon","drag_invisible","move_invisible","standard_date","do_not_hide","addGridData","interval","default_user_id","show_weekly_total","table","size_tr","new_tr","new_th","current_trs","createSizeColumns","column_length","createColumn","end_index","text","pay_period_th","default_tr","datesTHs","th","default_th","first_tr","start","current_month","same_month_count","id_split_array","date_str","month","month_header_text","top","header_text","header_container","data_field","header","setHeaderText","headerNumber","date_row","full_date","date_cell","scroll_height","height","table_body","context_border","day_column_index","column_padding","grid_data","column_width","new_col_width","day_column_width","columns_width","max_width","label_cache","label","sort_fields","field_name","column_name","date_row_index","month_week_data_index","first_day_time","month_week_data_array","has_date_array","current_week_array","is_last_row","time","no_date_array","end_date_time","buildMonthWeeklyData","rowIndex","source_array","buildEmptyRow","map","push_to_last","date_string","find_position","x","row_index","display_columns_len","add_last","col_model","label_column","first_time","last_time","first_date_time","last_date_time","first_time_str","last_time_str","selected_date_str","current_date_time","min","time_span","time_offset","day_column","day","time_columns","time_string","time_format_string","current_hour_text","timeHeader","label_array","shift_item","sort_by_fields","has_date_user_map","ii","records","sort_array","sort_item","schedule_data","date_key","date_item","item_key","row_id","cell_index","m","grid","grid_id","flag","row_tr","iRow","cell_val","column_info","column_header","onColumnHeaderClick","cell_value","related_data","is_day_column","col_models","content_div","full_date_str","total_span","currency","static_width","total_div","shifts_array","a","b","width","start_date_time","offset","info","cell_td","date_row_1_index","date_row_2_index","date_row_3_index","date_row_4_index","time_stamp_num","found","start_row_index","start_cell_index","end_row_index","end_cell_index","r_index","c_index","target_row_tr","target_row_td","rowspan","last_row","last_td","last_row_id","last_cell_id","last_cell_value","select_date","select_day","rowId","tv","rawObject","cm","rdata","employee_column","row_num","z","current_day","temp_start_date","full_data_field","inLine","shifts_column","absences_column","total_time_wage","startSet","count","last_val","last_cell","need_remove_cells","setRows","need_removed_cell","node","tab_name","set_default_menu","schedule_settings_options","schedule_mode_options","root_props","TTVueUtils","ScheduleControlBar","date_chooser_div","date_chooser","date_left_arrow","date_right_arrow","new_date","context","_value","updateValueOnChange","getValue","setValue","new_value","scheduleModeOnChangeHandler","shifts","absences","total_wage","data_len","total_shifts_dic","currentItem","start_time_min","end_time_min","start_time","end_time","getTimeOffset","startDate","sec","show_daily_total","total_row","column_keys","over_all_total_row","column_keys_len","column_key","no_data_key","total_row_key_data","row_data","first_item","second_item"],"mappings":"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"}