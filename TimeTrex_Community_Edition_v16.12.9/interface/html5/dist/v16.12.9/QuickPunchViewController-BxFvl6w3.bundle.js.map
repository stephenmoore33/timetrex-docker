{"version":3,"file":"QuickPunchViewController-BxFvl6w3.bundle.js","sources":["../../quick_punch/IndexController.js","../../views/quick_punch/punch/QuickPunchViewController.js"],"sourcesContent":["import { HeaderViewController } from '@/views/quick_punch/header/HeaderViewController';\nimport { QuickPunchLoginViewController } from '@/views/quick_punch/login/QuickPunchLoginViewController';\nimport { QuickPunchViewController } from '@/views/quick_punch/punch/QuickPunchViewController';\nimport '@/theme/default/css/quickPunch.css';\n\nexport class ApplicationRouter extends Backbone.Router {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tcontroller: null,\n\t\t\theaderView: null,\n\t\t\troutes: {\n\t\t\t\t'': 'onViewChange',\n\t\t\t\t'!:viewName': 'onViewChange',\n\t\t\t\t'*notFound': 'notFound'\n\t\t\t}\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tloadView( view_id ) {\n\t\tGlobal.loadViewSource( view_id, view_id + 'View.html', function( result ) {\n\t\t\tvar template = _.template( result );\n\t\t\tGlobal.contentContainer().html( template );\n\n\t\t\tLocalCacheData.current_open_view_id = view_id;\n\n\t\t\tGlobal.trackView( view_id );\n\t\t} );\n\t}\n\n\treloadView( view_id ) {\n\t\t//error: Uncaught ReferenceError: XXXXViewController is not defined ininterface/html5/#!m=TimeSheet line 3\n\t\t// Happens when quickly click on context menu and network is slow.\n\t\tif ( typeof window[view_id] === 'function' ) { //Was ES5: window[view_id + 'ViewController'] &&\n\t\t\tthis.loadView( view_id );\n\t\t}\n\t}\n\n\tnotFound( url ) {\n\t\tvar new_url = Global.getBaseURL();\n\n\t\tGlobal.setURLToBrowser( new_url + '#!m=QuickPunchLogin' );\n\t}\n\n\t/* jshint ignore:start */\n\tonViewChange( viewName ) {\n\t\tvar $this = this;\n\t\tvar args = {};\n\t\tvar view_id;\n\n\t\tif ( Global.needReloadBrowser ) {\n\t\t\tGlobal.needReloadBrowser = false;\n\t\t\twindow.location.reload();\n\t\t\treturn;\n\t\t}\n\n\t\tif ( viewName ) {\n\t\t\targs = Global.buildArgDic( viewName.split( '&' ) );\n\t\t}\n\t\tif ( viewName && viewName.indexOf( 'm=' ) >= 0 && viewName.indexOf( 'QuickPunch' ) >= 0 ) {\n\t\t\tview_id = Global.sanitizeViewId( args.m );\n\t\t} else {\n\t\t\tview_id = 'QuickPunchLogin';\n\t\t\tGlobal.setURLToBrowser( Global.getBaseURL() + '#!m=QuickPunchLogin' );\n\t\t}\n\n\t\tLocalCacheData.fullUrlParameterStr = viewName;\n\n\t\tLocalCacheData.setAllURLArgs( args );\n\t\tvar reg = new RegExp( '^[0-9]*$' );\n\t\tvar timeout_count;\n\t\ttimeout_count = 0;\n\t\t// $('link[title=\"application css\"]').prop('disabled', true);\n\t\tif ( LocalCacheData.loadViewRequiredJSReady ) {\n\t\t\tshowRibbonMenuAndLoadView();\n\t\t} else {\n\t\t\tvar auto_login_timer = setInterval( function() {\n\t\t\t\tif ( timeout_count == 100 ) {\n\t\t\t\t\tclearInterval( auto_login_timer );\n\t\t\t\t}\n\t\t\t\ttimeout_count = timeout_count + 1;\n\t\t\t\tif ( LocalCacheData.loadViewRequiredJSReady ) {\n\t\t\t\t\tshowRibbonMenuAndLoadView();\n\t\t\t\t\tclearInterval( auto_login_timer );\n\t\t\t\t}\n\t\t\t}, 600 );\n\t\t}\n\n\t\tfunction showRibbonMenuAndLoadView() {\n\t\t\t$( 'body' ).removeClass( 'login-bg' );\n\t\t\t// Global.loadStyleSheet( '../theme/default/css/quickPunch.css' + '?v=' + APIGlobal.pre_login_data.application_build ); // #2844 quickpunch css will now be loaded at start.\n\t\t\tif ( !$this.headerView ) {\n\t\t\t\t$this.headerView = new HeaderViewController();\n\t\t\t\t$( '#topContainer' ).html( $this.headerView.el );\n\t\t\t}\n\t\t\tloadViewController();\n\t\t}\n\n\t\tfunction loadViewController() {\n\t\t\t//Hard code all view controllers as there is only two. This avoids Vite's dynamic imports trying to import everything into the bundles.\n\t\t\tswitch ( view_id ) {\n\t\t\t\tcase 'QuickPunchLogin':\n\t\t\t\t\tvar view_controller = new QuickPunchLoginViewController();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'QuickPunch':\n\t\t\t\t\tvar view_controller = new QuickPunchViewController();\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tGlobal.trackView( view_id );\n\t\t\t/* jshint ignore:end */\n\n\t\t\t// Only show the top and bottom containers until after the view html is loaded, otherwise the download app links flash up at the top of the page, where the login header should be.\n\t\t\t// TODO: Improve this with Vue to be smoother and more structured, rather than trial and error.\n\t\t\tGlobal.topContainer().css( 'display', 'block' );\n\t\t\tGlobal.bottomContainer().css( 'display', 'block' );\n\t\t}\n\t}\n\n\t/* jshint ignore:end */\n\n\tcleanAnySubViewUI() {\n\t\tvar children = Global.contentContainer().children();\n\n\t\tif ( children.length > 1 ) {\n\t\t\tfor ( var i = 1; i < children.length; i++ ) {\n\t\t\t\t// Object doesn't support property or method 'remove', Not sure why, add try catch to ingore this error since this should no harm\n\t\t\t\ttry {\n\n\t\t\t\t\tif ( $( children[i] ).attr( 'id' ) === LocalCacheData.current_open_primary_controller.ui_id ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tchildren[i].remove();\n\t\t\t\t\t}\n\n\t\t\t\t} catch ( e ) {\n\t\t\t\t\t//Do nothing\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\t}\n\n\tsetContentDivHeight() {\n\t\tGlobal.contentContainer().removeClass( 'content-container' );\n\t\tGlobal.contentContainer().addClass( 'content-container-after-login' );\n\t\tGlobal.topContainer().addClass( 'top-container-after-login' );\n\n\t}\n\n\taddTopMenu() {\n\t\tGlobal.loadScript( 'global/widgets/top_menu/TopMenuController.js' );\n\t\tif ( TopMenuController ) {\n\t\t\tTopMenuController.loadView();\n\t\t}\n\n\t}\n\n\tremoveCurrentView( callBack ) {\n\t\tif ( LocalCacheData.current_open_edit_only_controller ) {\n\t\t\tclean( LocalCacheData.current_open_edit_only_controller );\n\t\t\tLocalCacheData.current_open_edit_only_controller = null;\n\t\t}\n\n\t\tif ( LocalCacheData.current_open_primary_controller ) {\n\t\t\tif ( LocalCacheData.current_open_primary_controller.edit_view ) {\n\t\t\t\tclean( LocalCacheData.current_open_primary_controller );\n\t\t\t}\n\t\t\tGlobal.contentContainer().empty();\n\t\t\tLocalCacheData.current_open_primary_controller.cleanWhenUnloadView( callBack );\n\t\t} else {\n\n\t\t\tif ( Global.isSet( callBack ) ) {\n\t\t\t\tcallBack();\n\t\t\t}\n\t\t}\n\n\t\tfunction clean( viewController ) {\n\t\t\tviewController.clearErrorTips();\n\t\t\t// Cannot read property 'remove' of null in interface/html5/IndexController.js?v=9.0.0-20151016-153057 line 439\n\t\t\tif ( viewController.edit_view ) {\n\t\t\t\tviewController.edit_view.remove();\n\t\t\t}\n\t\t\tviewController.sub_log_view_controller = null;\n\t\t\tviewController.edit_view_ui_dic = {};\n\t\t\tviewController.edit_view_ui_validation_field_dic = {};\n\t\t\tviewController.edit_view_form_item_dic = {};\n\t\t\tviewController.edit_view_error_ui_dic = {};\n\t\t\tLocalCacheData.current_doing_context_action = '';\n\t\t}\n\t}\n}\n\nexport class IndexViewController extends Backbone.View {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tel: 'body', //So we can add event listener for all elements\n\t\t\trouter: null,\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinitialize( options ) {\n\t\tIndexViewController.instance = this;\n\t\tthis.router = new ApplicationRouter();\n\t\t//Set title in index.php instead.\n\t\t//$( 'title' ).html( '' );\n\t\tthis.router.controller = this;\n\t\t//Error: Backbone.history has already been started in interface/html5/framework/backbone/backbone-min.js?v=9.0.1-20151022-162110 line 28\n\t\tif ( !Backbone.History.started ) {\n\t\t\tBackbone.history.start();\n\t\t}\n\t}\n}\n\nIndexViewController.instance = null;","import { QuickPunchBaseViewController } from '@/views/quick_punch/QuickPunchBaseViewController';\nimport { IndexViewController } from '@/quick_punch/IndexController';\nimport { TTAPI } from '@/services/TimeTrexClientAPI';\nimport { TAlertManager } from '@/global/TAlertManager';\nimport { TTUUID } from '@/global/TTUUID';\nimport { Global } from '@/global/Global';\nimport { getFingerprint as ThumbmarkGetFingerprint, setOption as ThumbmarkSetOption } from '@thumbmarkjs/thumbmarkjs';\n\nexport class QuickPunchViewController extends QuickPunchBaseViewController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\ttype_array: null,\n\t\t\tstatus_array: null,\n\t\t\tbranch_array: null,\n\t\t\tdepartment_array: null,\n\t\t\tjob_array: null,\n\t\t\tjob_item_array: null,\n\t\t\tpunch_tag_array: null,\n\n\t\t\tjob_api: null,\n\t\t\tjob_item_api: null,\n\t\t\tpunch_tag_api: null,\n\n\t\t\tdefault_punch_tag: [],\n\t\t\tprevious_punch_tag_selection: [],\n\n\t\t\told_type_status: {},\n\n\t\t\tshow_job_ui: false,\n\t\t\tshow_job_item_ui: false,\n\t\t\tshow_punch_tag_ui: false,\n\t\t\tshow_branch_ui: false,\n\t\t\tshow_department_ui: false,\n\t\t\tshow_good_quantity_ui: false,\n\t\t\tshow_bad_quantity_ui: false,\n\t\t\tshow_transfer_ui: false,\n\t\t\tshow_node_ui: false,\n\t\t\tel: '#quick_punch_container',\n\t\t\tevents: {\n\t\t\t\t'change input[type=\"text\"]': 'onFormItemChange',\n\t\t\t\t'change input[type=\"number\"]': 'onFormItemChange',\n\t\t\t\t'change input[type=\"checkbox\"]': 'onFormItemChange',\n\t\t\t\t'change select.form-control': 'onFormItemChange',\n\t\t\t\t'change textarea.form-control': 'onFormItemChange'\n\t\t\t}\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinitialize( options ) {\n\t\tsuper.initialize( options );\n\n\t\tif ( !LocalCacheData.getPunchLoginUser() ) {\n\t\t\tIndexViewController.instance.router.navigate( 'QuickPunchLogin', true );\n\t\t\treturn false;\n\t\t}\n\t\tthis.current_edit_record = null;\n\t\tthis.edit_view_error_ui_dic = {};\n\t\tthis.permission_id = 'punch';\n\t\tthis.custom_fields = [];\n\n\t\tthis.api = TTAPI.APIPunch;\n\t\tthis.branch_api = TTAPI.APIBranch;\n\t\tthis.department_api = TTAPI.APIDepartment;\n\t\tthis.custom_field_api = TTAPI.APICustomField;\n\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\tthis.job_api = TTAPI.APIJob;\n\t\t\tthis.job_item_api = TTAPI.APIJobItem;\n\t\t\tthis.punch_tag_api = TTAPI.APIPunchTag;\n\t\t}\n\t\tthis.company_api = TTAPI.APICompany;\n\t\tthis.api_station = TTAPI.APIStation;\n\t\tthis.current_user_api = TTAPI.APIAuthentication;\n\t\tthis.initPermission();\n\t\tProgressBar.showOverlay();\n\n\t\tTTPromise.add( 'QuickPunch', 'CurrentEditRecordComplete' );\n\n\t\tthis.initOptions();\n\t\tthis.getUserPunch();\n\n\t\tvar $this = this;\n\t\tthis.getCustomFields( function() {\n\t\t\tTTPromise.wait( 'QuickPunch', 'CurrentEditRecordComplete', function() {\n\t\t\t\t$this.render();\n\t\t\t} );\n\t\t} );\n\t}\n\n\tinitPermission() {\n\t\tif ( this.jobUIValidate() ) {\n\t\t\tthis.show_job_ui = true;\n\t\t} else {\n\t\t\tthis.show_job_ui = false;\n\t\t}\n\n\t\tif ( this.jobItemUIValidate() ) {\n\t\t\tthis.show_job_item_ui = true;\n\t\t} else {\n\t\t\tthis.show_job_item_ui = false;\n\t\t}\n\n\t\tif ( this.punchTagUIValidate() ) {\n\t\t\tthis.show_punch_tag_ui = true;\n\t\t} else {\n\t\t\tthis.show_punch_tag_ui = false;\n\t\t}\n\n\t\tif ( this.branchUIValidate() ) {\n\t\t\tthis.show_branch_ui = true;\n\t\t} else {\n\t\t\tthis.show_branch_ui = false;\n\t\t}\n\n\t\tif ( this.departmentUIValidate() ) {\n\t\t\tthis.show_department_ui = true;\n\t\t} else {\n\t\t\tthis.show_department_ui = false;\n\t\t}\n\n\t\tif ( this.goodQuantityUIValidate() ) {\n\t\t\tthis.show_good_quantity_ui = true;\n\t\t} else {\n\t\t\tthis.show_good_quantity_ui = false;\n\t\t}\n\n\t\tif ( this.badQuantityUIValidate() ) {\n\t\t\tthis.show_bad_quantity_ui = true;\n\t\t} else {\n\t\t\tthis.show_bad_quantity_ui = false;\n\t\t}\n\n\t\tif ( this.transferUIValidate() ) {\n\t\t\tthis.show_transfer_ui = true;\n\t\t} else {\n\t\t\tthis.show_transfer_ui = false;\n\t\t}\n\n\t\tif ( this.noteUIValidate() ) {\n\t\t\tthis.show_node_ui = true;\n\t\t} else {\n\t\t\tthis.show_node_ui = false;\n\t\t}\n\n\t\t// Error: Uncaught TypeError: (intermediate value).isBranchAndDepartmentAndJobAndJobItemAndPunchTagEnabled is not a function on line 207\n\t\tif ( this.company_api && _.isFunction( this.company_api.isBranchAndDepartmentAndJobAndJobItemAndPunchTagEnabled ) ) {\n\t\t\tvar $this = this;\n\t\t\tthis.company_api.isBranchAndDepartmentAndJobAndJobItemAndPunchTagEnabled( {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t//tried to fix Unable to get property 'getResult' of undefined or null reference, added if(!result)\n\t\t\t\t\tif ( !result ) {\n\t\t\t\t\t\t$this.show_branch_ui = false;\n\t\t\t\t\t\t$this.show_department_ui = false;\n\t\t\t\t\t\t$this.show_job_ui = false;\n\t\t\t\t\t\t$this.show_job_item_ui = false;\n\t\t\t\t\t\t$this.show_punch_tag_ui = false;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult = result.getResult();\n\t\t\t\t\t\tif ( !result.branch ) {\n\t\t\t\t\t\t\t$this.show_branch_ui = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( !result.department ) {\n\t\t\t\t\t\t\t$this.show_department_ui = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( !result.job ) {\n\t\t\t\t\t\t\t$this.show_job_ui = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( !result.job_item ) {\n\t\t\t\t\t\t\t$this.show_job_item_ui = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( !result.punch_tag ) {\n\t\t\t\t\t\t\t$this.punch_tag_ui = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t}\n\n\tjobUIValidate() {\n\t\tif ( PermissionManager.validate( 'job', 'enabled' ) &&\n\t\t\tPermissionManager.validate( 'punch', 'edit_job' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tjobItemUIValidate() {\n\t\tif ( PermissionManager.validate( 'job', 'enabled' ) &&\n\t\t\tPermissionManager.validate( 'punch', 'edit_job_item' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tpunchTagUIValidate() {\n\t\tif ( PermissionManager.validate( 'punch', 'edit_punch_tag' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tbranchUIValidate() {\n\t\tif ( PermissionManager.validate( 'punch', 'edit_branch' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tdepartmentUIValidate() {\n\t\tif ( PermissionManager.validate( 'punch', 'edit_department' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tgoodQuantityUIValidate() {\n\t\tif ( PermissionManager.validate( 'job', 'enabled' ) &&\n\t\t\tPermissionManager.validate( 'punch', 'edit_quantity' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tbadQuantityUIValidate() {\n\t\tif ( PermissionManager.validate( 'job', 'enabled' ) &&\n\t\t\tPermissionManager.validate( 'punch', 'edit_bad_quantity' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\ttransferUIValidate() {\n\t\tif ( PermissionManager.validate( 'punch', 'edit_transfer' ) || PermissionManager.validate( 'punch', 'default_transfer' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tnoteUIValidate() {\n\t\tif ( PermissionManager.validate( 'punch', 'edit_note' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tpreRender( callBack ) {\n\t\tvar $this = this;\n\t\tTTPromise.wait( 'QuickPunch_options', null, function() {\n\t\t\t$this.setSourceData( 'status_id', $this.status_array, true );\n\t\t\t$this.setSourceData( 'type_id', $this.type_array, true );\n\t\t\t$this.setSourceData( 'branch_id', $this.branch_array, true );\n\t\t\t$this.setSourceData( 'department_id', $this.department_array, true );\n\t\t\t$this.setSourceData( 'job_id', $this.job_array, true );\n\t\t\t$this.setSourceData( 'job_item_id', $this.job_item_array, true );\n\t\t\t$this.setSourceData( 'punch_tag_id', $this.punch_tag_array, true );\n\n\t\t\t$this.custom_fields.forEach( ( custom_field ) => {\n\t\t\t\tif ( custom_field.type_id == 2100 || custom_field.type_id == 2110 ) {\n\t\t\t\t\t$this.setSourceData( custom_field.field, custom_field.meta_data.validation.multi_select_items, true );\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\tGlobal.contentContainer().html( $this.$el );\n\n\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t//Set defaults for punch tags.\n\t\t\t\t$this.$( 'select[name=\"punch_tag_id\"]' ).val( $this.current_edit_record.punch_tag_id );\n\t\t\t\t$this.setPunchTagQuickSearchManualIds( $this.current_edit_record.punch_tag_id );\n\t\t\t}\n\n\t\t\tTTPromise.wait( null, null, function() {\n\t\t\t\tvar field = $this.getFirstAvailableField();\n\t\t\t\tfield.setAttribute( 'tab-start', '' );\n\t\t\t\tfield.focus();\n\t\t\t\tvar quick_punch_success_controller = new QuickPunchModalController( {\n\t\t\t\t\tel: $this.el,\n\t\t\t\t\t_timedRedirect: 10,\n\t\t\t\t\tis_modal: false,\n\t\t\t\t\t_delegateCallback: function() {\n\t\t\t\t\t\t$this.onSaveClick();\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} );\n\t\t} );\n\t}\n\n\tinitOptions() {\n\t\tvar $this = this;\n\t\tvar user = LocalCacheData.getPunchLoginUser();\n\t\tvar args = {};\n\t\targs.filter_columns = {\n\t\t\tid: true,\n\t\t\tname: true\n\t\t};\n\t\tTTPromise.add( 'QuickPunch_options', 'Status' );\n\t\tTTPromise.add( 'QuickPunch_options', 'Type' );\n\t\tTTPromise.add( 'QuickPunch_options', 'Branch' );\n\t\tTTPromise.add( 'QuickPunch_options', 'Department' );\n\t\tthis.api.getOptions( 'status', {\n\t\t\tonResult: function( result ) {\n\t\t\t\t$this.status_array = result.getResult();\n\t\t\t\tTTPromise.resolve( 'QuickPunch_options', 'Status' );\n\t\t\t}\n\t\t} );\n\t\tthis.api.getOptions( 'type', {\n\t\t\tonResult: function( result ) {\n\t\t\t\t$this.type_array = result.getResult();\n\t\t\t\tTTPromise.resolve( 'QuickPunch_options', 'Type' );\n\t\t\t}\n\t\t} );\n\n\t\tvar $this = this;\n\t\tTTPromise.wait( 'QuickPunch', 'CurrentEditRecordComplete', function() {\n\t\t\t//Branch and Department require the current record to be set to create the proper filter data.\n\n\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\targs.filter_data = { status_id: 10, include_id: $this.current_edit_record.branch_id, user_id: user.id };\n\t\t\t} else {\n\t\t\t\targs.filter_data = { status_id: 10 };\n\t\t\t}\n\t\t\t$this.branch_api.getBranch( args, true, {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t$this.branch_array = result.getResult();\n\n\t\t\t\t\tTTPromise.resolve( 'QuickPunch_options', 'Branch' );\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\targs.filter_data = { status_id: 10, include_id: $this.current_edit_record.department_id, user_id: user.id, branch_id: $this.current_edit_record.branch_id };\n\t\t\t} else {\n\t\t\t\targs.filter_data = { status_id: 10 };\n\t\t\t}\n\t\t\t$this.department_api.getDepartment( args, true, {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t$this.department_array = result.getResult();\n\t\t\t\t\tTTPromise.resolve( 'QuickPunch_options', 'Department' );\n\t\t\t\t}\n\t\t\t} );\n\t\t} );\n\n\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\tTTPromise.add( 'QuickPunch_options', 'Job' );\n\t\t\tTTPromise.add( 'QuickPunch_options', 'JobItem' );\n\t\t\tTTPromise.add( 'QuickPunch_options', 'PunchTag' );\n\n\t\t\tvar $this = this;\n\t\t\tTTPromise.wait( 'QuickPunch', 'CurrentEditRecordComplete', function() {\n\t\t\t\targs.filter_data = {\n\t\t\t\t\tstatus_id: 10,\n\t\t\t\t\tuser_id: user.id,\n\t\t\t\t\tpunch_branch_id: $this.current_edit_record.branch_id,\n\t\t\t\t\tpunch_department_id: $this.current_edit_record.department_id\n\t\t\t\t};\n\t\t\t\targs.filter_columns.manual_id = args.filter_columns.default_item_id = true;\n\t\t\t\t$this.job_api.getJob( args, true, {\n\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\t$this.job_array = result.getResult();\n\t\t\t\t\t\tTTPromise.resolve( 'QuickPunch_options', 'Job' );\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t\targs.filter_data = { status_id: 10, job_id: $this.current_edit_record.job_id };\n\t\t\t\targs.filter_columns.default_item_id = false;\n\t\t\t\t$this.job_item_api.getJobItem( args, true, {\n\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\t$this.job_item_array = result.getResult();\n\t\t\t\t\t\tTTPromise.resolve( 'QuickPunch_options', 'JobItem' );\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t\tvar punch_tag_args = {};\n\t\t\t\tpunch_tag_args.filter_data = $this.getPunchTagFilterData();\n\t\t\t\t$this.punch_tag_api.getPunchTag( punch_tag_args, true, {\n\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\t$this.punch_tag_array = result.getResult();\n\t\t\t\t\t\tTTPromise.resolve( 'QuickPunch_options', 'PunchTag' );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} );\n\t\t}\n\t}\n\n\tgetFirstAvailableField() {\n\t\treturn _.min( this.$( 'input[tabindex], select[tabindex], textarea[tabindex]' ), function( el ) {\n\t\t\tif ( $( el ).attr( 'tabindex' ) ) {\n\t\t\t\treturn parseInt( $( el ).attr( 'tabindex' ) );\n\t\t\t}\n\t\t} );\n\t}\n\n\tgetCustomFields( callBack ) {\n\t\tvar $this = this;\n\t\t//text, textarea, currency, integer, decimal, time unit, single/multi-select dropdown\n\t\tvar filter = {\n\t\t\tfilter_data: {\n\t\t\t\tparent_table: 'punch_control',\n\t\t\t\ttype_id: [\n\t\t\t\t\t100, //Text\n\t\t\t\t\t110, //Textarea\n\t\t\t\t\t400, //Integer\n\t\t\t\t\t410, //Decimal\n\t\t\t\t\t420, //Currency\n\t\t\t\t\t500, //Checkbox\n\t\t\t\t\t1100, //Time\n\t\t\t\t\t1300, //Time Unit\n\t\t\t\t\t2100, //Single-select\n\t\t\t\t\t2110, //Multi-select\n\t\t\t\t]\n\t\t\t}\n\t\t};\n\t\tthis.custom_field_api.getCustomField( filter, true, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tvar res_data = result.getResult();\n\t\t\t\tif ( Array.isArray( res_data ) && res_data.length > 0 ) {\n\t\t\t\t\tTTPromise.wait( 'QuickPunch', 'CurrentEditRecordComplete', function() {\n\t\t\t\t\t\tres_data.forEach( ( custom_field ) => {\n\t\t\t\t\t\t\tvar permission = PermissionManager.getPermissionData();\n\t\t\t\t\t\t\t//Permissions are for the non-'_id' custom fields.\n\t\t\t\t\t\t\tlet custom_field_id_parsed_suffix = custom_field.id.replace( '_id', '' );\n\t\t\t\t\t\t\tif ( Global.isSet( permission[$this.permission_id]['edit_custom_field-' + custom_field_id_parsed_suffix] ) ) {\n\t\t\t\t\t\t\t\tif ( PermissionManager.validate( $this.permission_id, 'edit_custom_field-' + custom_field_id_parsed_suffix ) === true ) {\n\t\t\t\t\t\t\t\t\t$this.custom_fields.push( {\n\t\t\t\t\t\t\t\t\t\tfield: 'custom_field-' + custom_field.id,\n\t\t\t\t\t\t\t\t\t\tlabel: custom_field.name,\n\t\t\t\t\t\t\t\t\t\tvalue: $this.current_edit_record['custom_field-' + custom_field.id],\n\t\t\t\t\t\t\t\t\t\ttype_id: custom_field.type_id,\n\t\t\t\t\t\t\t\t\t\tmeta_data: custom_field.meta_data\n\t\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} );\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t\tcallBack();\n\t\t\t}\n\t\t} );\n\t}\n\n\trender() {\n\t\tvar $this = this;\n\t\tvar row = Global.loadWidget( 'views/quick_punch/punch/QuickPunchView.html' );\n\n\t\t//#2571 exception: null is not an object (evaluating 'this.current_edit_record['first_name']')\n\t\t//cancel when error case is hit\n\t\tif ( !this.current_edit_record ) {\n\t\t\tthis.onCancelClick();\n\t\t}\n\n\t\tthis.setElement( _.template( row )( {\n\t\t\tshow_job_ui: this.show_job_ui,\n\t\t\tshow_job_item_ui: this.show_job_item_ui,\n\t\t\tshow_punch_tag_ui: this.show_punch_tag_ui,\n\t\t\tshow_branch_ui: this.show_branch_ui,\n\t\t\tshow_department_ui: this.show_department_ui,\n\t\t\tshow_good_quantity_ui: this.show_good_quantity_ui,\n\t\t\tshow_bad_quantity_ui: this.show_bad_quantity_ui,\n\t\t\tshow_transfer_ui: this.show_transfer_ui,\n\t\t\tshow_node_ui: this.show_node_ui,\n\t\t\tfirst_name: this.current_edit_record['first_name'],\n\t\t\tlast_name: this.current_edit_record['last_name'],\n\t\t\tpunch_time: this.current_edit_record['punch_time'],\n\t\t\tpunch_date: this.current_edit_record['punch_date'],\n\t\t\ttransfer: this.current_edit_record['transfer'],\n\t\t\tquantity: this.current_edit_record['quantity'],\n\t\t\tbad_quantity: this.current_edit_record['bad_quantity'],\n\t\t\tnote: this.current_edit_record['note'],\n\t\t\tcustom_fields: this.custom_fields\n\t\t} ) );\n\t\tthis.save_btn = this.$( '#save_btn' );\n\t\tthis.save_btn.on( 'click', function() {\n\t\t\t$this.onSaveClick();\n\t\t} );\n\t\tthis.cancel_btn = this.$( '#cancel_btn' );\n\t\tthis.cancel_btn.on( 'click', function() {\n\t\t\t$this.onCancelClick();\n\t\t} );\n\n\t\tthis.preRender();\n\n\t\t//this.initOptions();\n\t\t$( document ).off( 'keydown' ).on( 'keydown', function( event ) {\n\t\t\tvar attrs = event.target.attributes;\n\t\t\tif ( event.keyCode === 13 && $( event.target ).attr( 'id' ) != 'cancel_btn' ) {\n\t\t\t\tif ( $this.save_btn.attr( 'disabled' ) == 'disabled' ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif ( event.target.name == 'note' ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t$this.onSaveClick();\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn;\n\t\t\t} else if ( ( event.keyCode === 13 || event.keyCode === 32 ) && $( event.target ).attr( 'id' ) == 'cancel_btn' ) {\n\t\t\t\t$this.onCancelClick();\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( event.keyCode === 9 && event.shiftKey ) {\n\t\t\t\t//ensure the first editable item is selected.\n\t\t\t\tif ( $( event.target ).parents( '.form-group' ).index() == $( $( '.quick-punch-form-container select,input,textarea' )[0] ).parents( '.form-group' ).index() ) {\n\n\t\t\t\t\t$( '#cancel_btn' ).focus();\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ( attrs['tab-end'] && event.shiftKey === false ) {\n\t\t\t\tvar button = $this.$( 'input[tab-start]', $this.$el );\n\t\t\t\tif ( button.length > 0 ) { //Uncaught TypeError: Cannot read property 'focus' of undefined\n\t\t\t\t\tbutton[0].focus();\n\t\t\t\t}\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t} );\n\t\treturn this;\n\t}\n\n\tgetUserPunch() {\n\t\tvar $this = this;\n\n\t\t// Station cookie should already be set in getCurrentStation() called from QuickPunchLoginViewController.\n\t\t// var station_id = Global.getStationID();\n\t\t//\n\t\t// var api_station = TTAPI.APIStation;\n\t\t//\n\t\t// if ( station_id ) {\n\t\t// \tapi_station.getCurrentStation( station_id, '10', {\n\t\t// \t\tonResult: function( result ) {\n\t\t// \t\t\tdoNext( result );\n\t\t// \t\t}\n\t\t// \t} );\n\t\t// } else {\n\t\t// \t//This is also done in QuickPunchViewController.js and InOutViewController.js\n\t\t// \tThumbmarkSetOption( 'exclude', [ 'audio', 'canvas', 'webgl', 'system.browser.version' ] );\n\t\t// \tThumbmarkGetFingerprint( true ).then( ( browser_fingerprint ) => {\n\t\t// \t\tDebug.Text( 'Browser Fingerprint: ' + browser_fingerprint.hash, 'InOutViewController.js', 'InOutViewController', 'getUserPunch', 10 );\n\t\t// \t\tif ( browser_fingerprint && browser_fingerprint.hash != '' ) {\n\t\t// \t\t\tstation_id = 'BFP-'+ browser_fingerprint.hash;\n\t\t// \t\t}\n\t\t//\n\t\t// \t\tapi_station.getCurrentStation( station_id, '10', { //BFP = Browser FingerPrint prefix.\n\t\t// \t\t\tonResult: function( result ) {\n\t\t// \t\t\t\tdoNext( result );\n\t\t// \t\t\t}\n\t\t// \t\t} );\n\t\t// \t} ).catch( error => {\n\t\t// \t\tapi_station.getCurrentStation( '', '10', {\n\t\t// \t\t\tonResult: function( result ) {\n\t\t// \t\t\t\tdoNext( result );\n\t\t// \t\t\t}\n\t\t// \t\t} );\n\t\t// \t});\n\t\t// }\n\t\t//\n\t\t// function doNext( result ) {\n\t\t// \tif ( !$this.api || typeof $this.api['getUserPunch'] !== 'function' ) {\n\t\t// \t\treturn;\n\t\t// \t}\n\t\t// \tvar res_data = result.getResult();\n\t\t// \tGlobal.setStationID( res_data );\n\t\t// }\n\n\t\t$this.api.getUserPunch( {\n\t\t\tonResult: function( result ) {\n\t\t\t\tvar result_data = result.getResult();\n\t\t\t\tif ( !result.isValid() ) {\n\t\t\t\t\t$this.showErrorAlert( result, function() {\n\t\t\t\t\t\tsetTimeout( function() {\n\t\t\t\t\t\t\t$this.doLogout();\n\t\t\t\t\t\t}, 5000 );\n\t\t\t\t\t} );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif ( Global.isSet( result_data ) ) {\n\t\t\t\t\t$this.current_edit_record = result_data;\n\t\t\t\t\t$this.old_type_status.status_id = result_data.status_id;\n\t\t\t\t\t$this.old_type_status.type_id = result_data.type_id;\n\t\t\t\t\tTTPromise.resolve( 'QuickPunch', 'CurrentEditRecordComplete' );\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t}\n\n\tshowErrorAlert( result, callback ) {\n\t\tvar error_list = result.getDetails() ? result.getDetails()[0] : {};\n\t\tif ( error_list && error_list.hasOwnProperty( 'error' ) ) {\n\t\t\terror_list = error_list.error;\n\t\t}\n\t\tvar container = $( '<div>' ).addClass( 'alert' ).addClass( 'alert-danger' ).attr( 'role', 'alert' );\n\t\tfor ( var key in error_list ) {\n\t\t\tif ( !error_list.hasOwnProperty( key ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tvar error_obj = $( '<p>' ).addClass( 'text-center' );\n\t\t\tvar error_string;\n\t\t\tif ( _.isArray( error_list[key] ) ) {\n\t\t\t\terror_string = error_list[key][0];\n\t\t\t} else {\n\t\t\t\terror_string = error_list[key];\n\t\t\t}\n\t\t\terror_obj.text( $.i18n._( error_string ) );\n\t\t\tcontainer.append( error_obj );\n\t\t}\n\t\tif ( _.size( error_list ) > 0 ) {\n\t\t\tGlobal.contentContainer().html( container );\n\t\t}\n\t\tcallback();\n\t}\n\n\tonFormItemChange( e, doNotValidate ) {\n\t\tvar key = e.currentTarget.name;\n\t\tvar c_value = $( e.currentTarget ).val();\n\t\tthis.current_edit_record[key] = c_value;\n\t\tswitch ( key ) {\n\t\t\tcase 'job_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tvar manual_id = $( $( e.currentTarget ).find( 'option[value=\\'' + c_value + '\\']' ) ).attr( 'manual_id' );\n\t\t\t\t\tthis.$( 'input[name=\"job_quick_search\"]' ).val( manual_id ? manual_id : '' );\n\t\t\t\t\tthis.setJobItemValueWhenJobChanged( c_value );\n\t\t\t\t\tthis.setPunchTagValuesWhenCriteriaChanged( this.getPunchTagFilterData(), 'punch_tag_id' );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'job_item_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tvar manual_id = $( $( e.currentTarget ).find( 'option[value=\\'' + c_value + '\\']' ) ).attr( 'manual_id' );\n\t\t\t\t\tthis.$( 'input[name=\"job_item_quick_search\"]' ).val( manual_id ? manual_id : '' );\n\t\t\t\t\tthis.setPunchTagValuesWhenCriteriaChanged( this.getPunchTagFilterData(), 'punch_tag_id' );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'punch_tag_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tvar selected_punch_tags = [...e.target.selectedOptions].map( element => element.getAttribute( 'manual_id' ) ).filter( manual_id => manual_id != null && manual_id !== '' && manual_id !== 0 ).join();\n\t\t\t\t\tthis.$( 'input[name=\"punch_tag_quick_search\"]' ).val( selected_punch_tags );\n\n\t\t\t\t\tthis.previous_punch_tag_selection = c_value;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'transfer':\n\t\t\t\tvar c_value;\n\t\t\t\tif ( $( e.currentTarget ).is( ':checked' ) ) {\n\t\t\t\t\tc_value = true;\n\t\t\t\t} else {\n\t\t\t\t\tc_value = false;\n\t\t\t\t}\n\t\t\t\tthis.current_edit_record[key] = c_value;\n\t\t\t\tthis.onTransferChanged( c_value );\n\t\t\t\tbreak;\n\t\t\tcase 'branch_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.setDepartmentValueWhenBranchChanged( c_value );\n\t\t\t\t\tthis.setJobValueWhenCriteriaChanged();\n\t\t\t\t\tthis.setPunchTagValuesWhenCriteriaChanged( this.getPunchTagFilterData(), 'punch_tag_id' );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'user_id':\n\t\t\tcase 'department_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.setJobValueWhenCriteriaChanged( c_value );\n\t\t\t\t\tthis.setPunchTagValuesWhenCriteriaChanged( this.getPunchTagFilterData(), 'punch_tag_id' );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'job_quick_search':\n\t\t\tcase 'job_item_quick_search':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.onJobQuickSearch( key, c_value );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'punch_tag_quick_search':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.onPunchTagQuickSearch( key, c_value );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tif ( key.includes( 'custom_field-' ) ) {\n\t\t\t\t\tthis.onCustomFieldChange( key, c_value, e );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t\tif ( !doNotValidate ) {\n\t\t\tthis.validate();\n\t\t}\n\t}\n\n\tonCustomFieldChange( key, value, e ) {\n\t\tlet custom_field = this.custom_fields.find( custom_field => custom_field.field === key );\n\n\t\tif ( custom_field ) {\n\t\t\tswitch ( parseInt( custom_field.type_id ) ) {\n\t\t\t\tcase 500:\n\t\t\t\t\tif ( $( e.currentTarget ).is( ':checked' ) ) {\n\t\t\t\t\t\tvalue = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvalue = false;\n\t\t\t\t\t}\n\t\t\t\t\tthis.current_edit_record[key] = value;\n\t\t\t}\n\t\t}\n\t}\n\n\tvalidate() {\n\t\tvar $this = this;\n\t\tthis.api.setUserPunch( this.current_edit_record, true, {\n\t\t\tonResult: function( result ) {\n\t\t\t\t$this.validateResult( result );\n\t\t\t}\n\t\t} );\n\t}\n\n\tvalidateResult( result ) {\n\t\tvar $this = this;\n\t\tif ( !result.isValid() ) {\n\t\t\t$this.setErrorTips( result );\n\t\t}\n\t}\n\n\tsetErrorTips( result ) {\n\t\tthis.clearErrorTips( true );\n\t\tvar error_list = {};\n\t\tvar no_obj_error_string = '';\n\t\tif ( result.getDetails() ) {\n\t\t\terror_list = result.getDetails()[0];\n\t\t} else {\n\t\t\tvar error = result.getDescription();\n\t\t\tTAlertManager.showAlert( error, 'Error' );\n\t\t\tthis.save_btn.removeAttr( 'disabled' );\n\t\t\treturn;\n\t\t}\n\t\tif ( error_list && error_list.hasOwnProperty( 'error' ) ) {\n\t\t\terror_list = error_list.error;\n\t\t}\n\t\tfor ( var key in error_list ) {\n\t\t\tif ( !error_list.hasOwnProperty( key ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tvar field_obj;\n\t\t\tvar error_string;\n\t\t\tswitch ( key ) {\n\t\t\t\t// case 'time_stamp':\n\t\t\t\t//     field_obj = this.$('p[name=\"punch_time\"]');\n\t\t\t\t//     break;\n\t\t\t\t// case 'lic_obj':\n\t\t\t\t//     field_obj = this.$('p[name=\"user_full_name\"]');\n\t\t\t\t//     break;\n\t\t\t\tdefault:\n\t\t\t\t\tif ( this.$( 'input[name=\"' + key + '\"]' )[0] ) {\n\t\t\t\t\t\tfield_obj = this.$( 'input[name=\"' + key + '\"]' );\n\t\t\t\t\t} else if ( this.$( 'select[name=\"' + key + '\"]' )[0] ) {\n\t\t\t\t\t\tfield_obj = this.$( 'select[name=\"' + key + '\"]' );\n\t\t\t\t\t} else if ( this.$( 'textarea[name=\"' + key + '\"]' )[0] ) {\n\t\t\t\t\t\tfield_obj = this.$( 'textarea[name=\"' + key + '\"]' );\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif ( _.isArray( error_list[key] ) ) {\n\t\t\t\terror_string = error_list[key][0];\n\t\t\t} else {\n\t\t\t\terror_string = error_list[key];\n\t\t\t}\n\t\t\tif ( field_obj ) {\n\t\t\t\tthis.showErrorTips( field_obj, error_string );\n\t\t\t\tthis.edit_view_error_ui_dic[key] = field_obj;\n\t\t\t} else {\n\t\t\t\tno_obj_error_string += error_string + '</br>';\n\t\t\t}\n\t\t}\n\t\tif ( _.size( this.edit_view_error_ui_dic ) > 0 ) {\n\t\t\tthis.save_btn.removeAttr( 'disabled' );\n\t\t\tvar focus_obj = _.min( this.edit_view_error_ui_dic, function( item ) {\n\t\t\t\tif ( item.attr( 'tabindex' ) ) {\n\t\t\t\t\treturn parseInt( item.attr( 'tabindex' ) );\n\t\t\t\t}\n\t\t\t} );\n\t\t\tif ( typeof focus_obj.focus !== 'undefined' ) {\n\t\t\t\tfocus_obj.focus();\n\t\t\t} else {\n\t\t\t\tvar field = this.getFirstAvailableField();\n\t\t\t\tfield.focus();\n\t\t\t}\n\t\t}\n\t\tif ( no_obj_error_string != '' ) {\n\t\t\tthis.save_btn.removeAttr( 'disabled' );\n\t\t\tTAlertManager.showAlert( no_obj_error_string, 'Error' );\n\t\t}\n\t}\n\n\tshowErrorTips( field_obj, error_msg ) {\n\t\tfield_obj.addClass( 'is-invalid' );\n\t\tfield_obj.attr( 'data-bs-toggle', 'tooltip' );\n\t\tfield_obj.attr( 'data-bs-placement', 'top' );\n\t\tfield_obj.attr( 'title', error_msg );\n\t\tvar tooltip = new bootstrap.Tooltip( field_obj );\n\t\ttooltip.show();\n\t}\n\n\tclearErrorTips( clear_all, destroy ) {\n\t\tfor ( var key in this.edit_view_error_ui_dic ) {\n\t\t\tif ( this.edit_view_error_ui_dic[key].val() !== '' || clear_all ) {\n\t\t\t\tthis.edit_view_error_ui_dic[key].removeClass( 'is-invalid' );\n\t\t\t\tthis.edit_view_error_ui_dic[key].removeAttr( 'data-bs-toggle' );\n\t\t\t\tthis.edit_view_error_ui_dic[key].removeAttr( 'data-bs-placement' );\n\t\t\t\tthis.edit_view_error_ui_dic[key].removeAttr( 'data-bs-original-title' );\n\t\t\t\tthis.edit_view_error_ui_dic[key].removeAttr( 'aria-label' );\n\t\t\t\tthis.edit_view_error_ui_dic[key].removeAttr( 'title' );\n\t\t\t}\n\n\t\t\tif ( destroy ) {\n\t\t\t\tlet tooltips = document.querySelectorAll( '.tooltip');\n\t\t\t\tfor ( let i = 0; i < tooltips.length; i++ ) {\n\t\t\t\t\ttooltips[i].remove();\n\t\t\t\t}\n\n\t\t\t\t// This causes a JS exception on Chrome on Linux when validation error appears twice. (Click Login button twice)\n\t\t\t\t// Uncaught TypeError: Cannot convert undefined or null to object\n\t\t\t\t// var tooltip = bootstrap.Tooltip.getInstance( this.edit_view_error_ui_dic[key] );\n\t\t\t\t// if ( tooltip ) {\n\t\t\t\t// \ttooltip.dispose();\n\t\t\t\t// }\n\t\t\t}\n\t\t}\n\t\tthis.edit_view_error_ui_dic = {};\n\t}\n\n\tonJobQuickSearch( key, value ) {\n\t\tvar args = {};\n\t\tvar $this = this;\n\t\targs.filter_columns = {\n\t\t\tid: true,\n\t\t\tname: true,\n\t\t\tmanual_id: true\n\t\t};\n\t\tif ( key === 'job_quick_search' ) {\n\t\t\targs.filter_data = { manual_id: value, user_id: this.current_edit_record.user_id, status_id: '10' };\n\t\t\targs.filter_columns.default_item_id = true;\n\t\t\tthis.job_api.getJob( args, {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\tvar result_data = result.getResult();\n\t\t\t\t\tif ( result_data.length > 0 ) {\n\t\t\t\t\t\t$this.$( 'select[name=\"job_id\"]' ).val( result_data[0].id );\n\t\t\t\t\t\t$this.current_edit_record.job_id = result_data[0].id;\n\t\t\t\t\t\t$this.setJobItemValueWhenJobChanged( result_data[0].id );\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$this.$( 'select[name=\"job_id\"]' ).val( '' );\n\t\t\t\t\t\t$this.current_edit_record.job_id = false;\n\t\t\t\t\t\t$this.setJobItemValueWhenJobChanged( null );\n\t\t\t\t\t}\n\t\t\t\t\t// $this.$( 'select[name=\"job_id\"]' ).selectpicker('refresh');\n\t\t\t\t}\n\t\t\t} );\n\t\t} else if ( key === 'job_item_quick_search' ) {\n\t\t\targs.filter_data = { manual_id: value, job_id: this.current_edit_record.job_id, status_id: '10' };\n\t\t\tthis.job_item_api.getJobItem( args, {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\tvar result_data = result.getResult();\n\t\t\t\t\tif ( result_data.length > 0 ) {\n\t\t\t\t\t\t$this.$( 'select[name=\"job_item_id\"]' ).val( result_data[0].id );\n\t\t\t\t\t\t$this.current_edit_record.job_item_id = result_data[0].id;\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$this.$( 'select[name=\"job_item_id\"]' ).val( '' );\n\t\t\t\t\t\t$this.current_edit_record.job_item_id = false;\n\t\t\t\t\t}\n\t\t\t\t\t// $this.$( 'select[name=\"job_item_id\"]' ).selectpicker('refresh');\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t}\n\n\tonTransferChanged( value ) {\n\t\tif ( value ) {\n\n\t\t\tthis.$( 'select[name=\"type_id\"]' ).attr( 'disabled', true );\n\t\t\tthis.$( 'select[name=\"status_id\"]' ).attr( 'disabled', true );\n\n\t\t\tthis.old_type_status.type_id = this.$( 'select[name=\"type_id\"]' ).val();\n\t\t\tthis.old_type_status.status_id = this.$( 'select[name=\"status_id\"]' ).val();\n\n\t\t\tthis.$( 'select[name=\"type_id\"]' ).val( 10 );\n\t\t\tthis.$( 'select[name=\"status_id\"]' ).val( 10 );\n\n\t\t\tthis.current_edit_record.type_id = 10;\n\t\t\tthis.current_edit_record.status_id = 10;\n\n\t\t} else {\n\t\t\tthis.$( 'select[name=\"type_id\"]' ).removeAttr( 'disabled' );\n\t\t\tthis.$( 'select[name=\"status_id\"]' ).removeAttr( 'disabled' );\n\n\t\t\tif ( this.old_type_status.hasOwnProperty( 'type_id' ) ) {\n\t\t\t\tthis.$( 'select[name=\"type_id\"]' ).val( this.old_type_status.type_id );\n\t\t\t\tthis.$( 'select[name=\"status_id\"]' ).val( this.old_type_status.status_id );\n\n\t\t\t\tthis.current_edit_record.type_id = this.old_type_status.type_id;\n\t\t\t\tthis.current_edit_record.status_id = this.old_type_status.status_id;\n\t\t\t}\n\t\t}\n\t}\n\n\tsetJobItemValueWhenJobChanged( job, job_item_id_col_name, filter_data ) {\n\t\tif ( !this.show_job_item_ui ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar $this = this;\n\t\tif ( job_item_id_col_name == undefined ) {\n\t\t\tjob_item_id_col_name = 'job_item_id';\n\t\t}\n\t\tif ( filter_data == undefined ) {\n\t\t\tfilter_data = { status_id: 10, job_id: job };\n\t\t}\n\t\tvar args = {};\n\t\targs.filter_data = filter_data;\n\t\targs.filter_columns = {\n\t\t\tid: true,\n\t\t\tname: true,\n\t\t\tmanual_id: true\n\t\t};\n\t\tvar job_item_widget = $this.$( 'select[name=\"' + job_item_id_col_name + '\"]' );\n\t\tvar current_job_item_id = job_item_widget.val();\n\n\t\tif ( TTUUID.isUUID( current_job_item_id ) && current_job_item_id != TTUUID.zero_id && current_job_item_id != TTUUID.not_exist_id ) {\n\t\t\tvar new_arg = Global.clone( args );\n\t\t\tnew_arg.filter_data.job_id = job;\n\t\t\t$this.job_item_api.getJobItem( new_arg, {\n\t\t\t\tonResult: function( task_result ) {\n\t\t\t\t\tvar data = task_result.getResult();\n\t\t\t\t\tif ( Array.isArray( data ) && data.length > 0 && data.some( ( job_item ) => job_item.id === current_job_item_id ) ) {\n\t\t\t\t\t\t$this.current_edit_record[job_item_id_col_name] = current_job_item_id;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetDefaultData( job_item_id_col_name );\n\t\t\t\t\t}\n\t\t\t\t\t$this.setSourceData( job_item_id_col_name, data, true );\n\t\t\t\t}\n\t\t\t} );\n\n\t\t} else {\n\t\t\tsetDefaultData( job_item_id_col_name );\n\t\t\t$this.job_item_api.getJobItem( args, true, {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t$this.setSourceData( job_item_id_col_name, result.getResult(), true );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\tfunction setDefaultData( job_item_id_col_name ) {\n\t\t\tif ( job_item_id_col_name == undefined ) {\n\t\t\t\tjob_item_id_col_name = 'job_item_id';\n\t\t\t}\n\t\t\tif ( $this.current_edit_record.job_id ) {\n\t\t\t\t// job_item_widget.val( $this.$('select[name=\"job_id\"] option[value=\"'+ job +'\"]').attr('default_item_id') );\n\t\t\t\tvar default_item_id = $this.$( 'select[name=\"job_id\"] option[value=\"' + job + '\"]' ).attr( 'default_item_id' );\n\t\t\t\t$this.current_edit_record[job_item_id_col_name] = default_item_id;\n\t\t\t\tif ( default_item_id === false || default_item_id === 0 || default_item_id === TTUUID.zero_id ) {\n\t\t\t\t\t$this.$( 'input[name=\"job_item_quick_search\"]' ).val( '' );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tjob_item_widget.val( '' );\n\t\t\t\t$this.current_edit_record[job_item_id_col_name] = false;\n\t\t\t\t$this.$( 'input[name=\"job_item_quick_search\"]' ).val( '' );\n\t\t\t}\n\t\t}\n\t}\n\n\tsetJobValueWhenCriteriaChanged() {\n\t\tif ( !this.show_job_ui ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar $this = this;\n\t\tvar job_id_col_name = 'job_id';\n\t\tvar user = LocalCacheData.getPunchLoginUser();\n\t\tvar filter_data = {\n\t\t\tstatus_id: 10,\n\t\t\tuser_id: user.id,\n\t\t\tpunch_branch_id: this.current_edit_record.branch_id,\n\t\t\tpunch_department_id: this.current_edit_record.department_id\n\t\t};\n\t\tvar args = {};\n\t\targs.filter_data = filter_data;\n\t\targs.filter_columns = {\n\t\t\tid: true,\n\t\t\tname: true,\n\t\t\tmanual_id: true,\n\t\t};\n\t\tvar job_widget = $this.$( 'select[name=\"' + job_id_col_name + '\"]' );\n\t\tvar current_job_id = job_widget.val();\n\n\t\tif ( TTUUID.isUUID( current_job_id ) && current_job_id != TTUUID.zero_id && current_job_id != TTUUID.not_exist_id ) {\n\t\t\tvar new_arg = Global.clone( args );\n\t\t\t$this.job_api.getJob( new_arg, {\n\t\t\t\tonResult: function( task_result ) {\n\t\t\t\t\tvar data = task_result.getResult();\n\t\t\t\t\tif ( Array.isArray( data ) && data.length > 0 && data.some( ( job ) => job.id === current_job_id ) ) {\n\t\t\t\t\t\t$this.current_edit_record[job_id_col_name] = current_job_id;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetDefaultData( job_id_col_name );\n\t\t\t\t\t}\n\t\t\t\t\t$this.setSourceData( job_id_col_name, data, true );\n\t\t\t\t}\n\t\t\t} );\n\n\t\t} else {\n\t\t\tsetDefaultData( job_id_col_name );\n\t\t\t$this.job_api.getJob( args, true, {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t$this.setSourceData( job_id_col_name, result.getResult(), true );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\tfunction setDefaultData( job_id_col_name ) {\n\t\t\t$this.current_edit_record[job_id_col_name] = false;\n\t\t\t$this.$( 'input[name=\"job_quick_search\"]' ).val( '' );\n\t\t}\n\t}\n\n\tsetDepartmentValueWhenBranchChanged( branch ) {\n\t\tif ( !this.show_department_ui ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar $this = this;\n\t\tvar department_id_col_name = 'department_id';\n\t\tvar user = LocalCacheData.getPunchLoginUser();\n\t\tvar filter_data = { status_id: 10, user_id: user.id, branch_id: branch };\n\t\tvar args = {};\n\t\targs.filter_data = filter_data;\n\t\targs.filter_columns = {\n\t\t\tid: true,\n\t\t\tname: true\n\t\t};\n\t\tvar department_widget = $this.$( 'select[name=\"' + department_id_col_name + '\"]' );\n\t\tvar current_department_id = department_widget.val();\n\n\t\tif ( TTUUID.isUUID( current_department_id ) && current_department_id != TTUUID.zero_id && current_department_id != TTUUID.not_exist_id ) {\n\t\t\tvar new_arg = Global.clone( args );\n\t\t\tnew_arg.filter_data.branch_id = branch;\n\t\t\t$this.department_api.getDepartment( new_arg, {\n\t\t\t\tonResult: function( task_result ) {\n\t\t\t\t\tvar data = task_result.getResult();\n\t\t\t\t\tif ( Array.isArray( data ) && data.length > 0 && data.some( ( department ) => department.id === current_department_id ) ) {\n\t\t\t\t\t\t$this.current_edit_record[department_id_col_name] = current_department_id;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetDefaultData( department_id_col_name );\n\t\t\t\t\t}\n\t\t\t\t\t$this.setSourceData( department_id_col_name, data, true );\n\t\t\t\t}\n\t\t\t} );\n\n\t\t} else {\n\t\t\tsetDefaultData( department_id_col_name );\n\t\t\t$this.department_api.getDepartment( args, true, {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t$this.setSourceData( department_id_col_name, result.getResult(), true );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\tfunction setDefaultData( department_id_col_name ) {\n\t\t\t$this.current_edit_record[department_id_col_name] = false;\n\t\t}\n\t}\n\n\tsetPunchTagValuesWhenCriteriaChanged( filter_data, punch_tag_id_col_name ) {\n\t\tif ( !this.show_punch_tag_ui ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar $this = this;\n\n\t\tif ( !$this.current_edit_record ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar punch_tag_widget = $this.$( 'select[name=\"' + punch_tag_id_col_name + '\"]' );\n\t\tvar current_punch_tag_ids = punch_tag_widget.val();\n\n\t\tvar args = {};\n\t\targs.filter_data = filter_data;\n\n\t\tvar new_arg = Global.clone( args );\n\n\t\tnew_arg.manual_id = current_punch_tag_ids;\n\t\t$this.punch_tag_api.getPunchTag( new_arg, {\n\t\t\tonResult: function( punch_tag_result ) {\n\t\t\t\tif ( !$this.current_edit_record ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar data = punch_tag_result.getResult();\n\n\t\t\t\t$this.setSourceData( 'punch_tag_id', data, true );\n\n\t\t\t\tif ( data.length > 0 ) {\n\t\t\t\t\tif ( current_punch_tag_ids !== TTUUID.zero_id && current_punch_tag_ids.length > 0 && $this.shouldUpdatePunchTags( current_punch_tag_ids, data ) ) {\n\t\t\t\t\t\t//Merge in users last selected punch tags in case they switched back to that selection.\n\t\t\t\t\t\t//Example: They have selected a New York branch punch tag but switch their selection to a different branch\n\t\t\t\t\t\t//and then back to New York. In that case we should reselect the New York punch tag.\n\t\t\t\t\t\tcurrent_punch_tag_ids = _.union( current_punch_tag_ids, $this.previous_punch_tag_selection );\n\t\t\t\t\t\t//Compare current selected punch tags and the list of punch tags from the API and remove invalid punch tags.\n\t\t\t\t\t\tvar intersected_values = current_punch_tag_ids.filter( punch_tag_id => data.some( punch_tag => punch_tag_id === punch_tag.id ) );\n\n\t\t\t\t\t\t$this.$( 'select[name=\"punch_tag_id\"]' ).val( intersected_values );\n\t\t\t\t\t\t$this.current_edit_record[punch_tag_id_col_name] = intersected_values;\n\n\t\t\t\t\t\t//Update manual IDs in punch_tag_quick_search.\n\t\t\t\t\t\tvar punch_tag_manual_ids = data.filter( punch_tag => intersected_values.includes( punch_tag.id ) ).map( ( { manual_id } ) => manual_id );\n\t\t\t\t\t\t$this.$( 'input[name=\"punch_tag_quick_search\"]' ).val( punch_tag_manual_ids.join() );\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tsetDefaultData( punch_tag_id_col_name );\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\n\t\tfunction setDefaultData( punch_tag_id_col_name ) {\n\t\t\tif ( $this.current_edit_record.hasOwnProperty( punch_tag_id_col_name ) ) {\n\t\t\t\t$this.$( 'select[name=\"punch_tag_id\"]' ).val( $this.default_punch_tag );\n\t\t\t\t$this.current_edit_record[punch_tag_id_col_name] = $this.default_punch_tag;\n\n\t\t\t\tif ( $this.default_punch_tag.length === 0 ) {\n\t\t\t\t\t$this.$( 'input[name=\"punch_tag_quick_search\"]' ).val( '' );\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\t$this.current_edit_record[punch_tag_id_col_name] = false;\n\t\t\t\t$this.$( 'input[name=\"punch_tag_quick_search\"]' ).val( '' );\n\t\t\t}\n\t\t}\n\t}\n\n\tshouldUpdatePunchTags( current_punch_tag_ids, data ) {\n\t\t//If the current selected punch tags and previously user selected punch tags do not match we should check and update.\n\t\tif ( this.previous_punch_tag_selection.every( punch_tag => current_punch_tag_ids.includes( punch_tag ) ) === false ) {\n\t\t\treturn true;\n\t\t}\n\t\t//If the data returned from the API does not contain every currently selected punch tag then we need to remove invalid tags.\n\t\tif ( current_punch_tag_ids.every( punch_tag_id => data.some( punch_tag => punch_tag.id === punch_tag_id ) ) === false ) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tsetPunchTagQuickSearchManualIds( punch_tag_ids ) {\n\t\tif ( !punch_tag_ids || !this.show_punch_tag_ui || ( Array.isArray( punch_tag_ids ) === true && punch_tag_ids.length === 0 ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar $this = this;\n\t\tvar args = {};\n\t\targs.filter_data = { id: punch_tag_ids };\n\t\tthis.punch_tag_api.getPunchTag( args, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tvar data = result.getResult();\n\t\t\t\tvar manual_ids = [];\n\n\t\t\t\tfor ( var i = 0; i < data.length; i++ ) {\n\t\t\t\t\tmanual_ids.push( data[i].manual_id );\n\t\t\t\t}\n\n\t\t\t\t$this.$( 'input[name=\"punch_tag_quick_search\"]' ).val( manual_ids.join() );\n\t\t\t}\n\t\t} );\n\t}\n\n\tonPunchTagQuickSearch( key, value ) {\n\t\tvar args = {};\n\t\tvar $this = this;\n\t\targs.filter_columns = {\n\t\t\tid: true,\n\t\t\tname: true,\n\t\t\tmanual_id: true\n\t\t};\n\n\t\targs.filter_data = this.getPunchTagFilterData();\n\t\targs.filter_data.manual_id = value.split( ',' );\n\t\tthis.punch_tag_api.getPunchTag( args, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tvar result_data = result.getResult();\n\t\t\t\tif ( result_data.length > 0 ) {\n\t\t\t\t\t$this.$( 'select[name=\"punch_tag_id\"]' ).val( result_data.map( punch_tag => punch_tag.id ) );\n\t\t\t\t\t$this.current_edit_record.punch_tag_id = result_data.map( punch_tag => punch_tag.id );\n\t\t\t\t} else {\n\t\t\t\t\t$this.$( 'select[name=\"punch_tag_id\"]' ).val( '' );\n\t\t\t\t\t$this.current_edit_record.punch_tag_id = false;\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t}\n\n\tsetSourceData( field, source_data, set_empty ) {\n\t\tvar $this = this;\n\t\tvar field_selector = 'select[name=\"' + field + '\"]';\n\t\tif ( $( this.$el ).find( field_selector ) && $( this.$el ).find( field_selector )[0] ) {\n\t\t\t$( this.$el ).find( field_selector ).empty();\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\t\tif ( _.size( source_data ) == 0 ) {\n\t\t\tset_empty = true;\n\t\t}\n\t\tif ( set_empty === true ) {\n\t\t\tvar $field = $( $this.$el ).find( field_selector );\n\t\t\tswitch ( field ) {\n\t\t\t\tcase 'status_id':\n\t\t\t\tcase 'type_id':\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\t$field.append( $( '<option></option>' ).prop( 'value', '0' ).text( '-- ' + $.i18n._( 'None' ) + ' --' ) ).attr( 'selected', 'selected' );\n\t\t\t\t// $($this.$el).find(field_selector).selectpicker();\n\t\t\t}\n\t\t}\n\t\tif ( _.size( source_data ) > 0 ) {\n\t\t\tif ( _.isArray( source_data ) ) {\n\t\t\t\t_.each( source_data, function( option ) {\n\t\t\t\t\tlet label = '';\n\t\t\t\t\tif ( option.hasOwnProperty( 'name' ) ) {\n\t\t\t\t\t\tlabel = option.name;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlabel = option.label;\n\t\t\t\t\t}\n\t\t\t\t\tvar optionEl = $( '<option></option>' ).prop( 'value', option.id ).text( label );\n\t\t\t\t\tif ( field == 'job_id' || field == 'job_item_id' || field == 'punch_tag_id' ) {\n\t\t\t\t\t\toptionEl.attr( 'manual_id', option.manual_id );\n\t\t\t\t\t}\n\t\t\t\t\tif ( field == 'job_id' ) {\n\t\t\t\t\t\toptionEl.attr( 'default_item_id', option.default_item_id );\n\t\t\t\t\t}\n\t\t\t\t\t$( $this.$el ).find( field_selector ).append( optionEl );\n\t\t\t\t\tif ( $this.current_edit_record[field] == option.id ) {\n\t\t\t\t\t\t$( $this.$el ).find( field_selector ).val( option.id );\n\t\t\t\t\t\tif ( field == 'job_id' ) {\n\t\t\t\t\t\t\t$this.$( 'input[name=\"job_quick_search\"]' ).val( option.manual_id );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ( field == 'job_item_id' ) {\n\t\t\t\t\t\t\t$this.$( 'input[name=\"job_item_quick_search\"]' ).val( option.manual_id );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\t$.each( source_data, function( value, label ) {\n\t\t\t\t\t$( $this.$el ).find( field_selector ).append( $( '<option></option>' ).prop( 'value', value ).text( label ) );\n\t\t\t\t\tif ( field == 'status_id' || field == 'type_id' ) {\n\t\t\t\t\t\tif ( $this.current_edit_record.transfer == true ) {\n\t\t\t\t\t\t\t$this.current_edit_record[field] = 10;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif ( $this.current_edit_record[field] == value ) {\n\t\t\t\t\t\t$( $this.$el ).find( field_selector ).val( value );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t\t// $this.$($this.el).find(field_selector).selectpicker('refresh');\n\t\t} else {\n\t\t\tswitch ( field ) {\n\t\t\t\tcase 'branch_id':\n\t\t\t\tcase 'department_id':\n\t\t\t\t\t$( $this.$el ).find( 'div.' + field ).hide();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'job_id':\n\t\t\t\t\t$( $this.$el ).find( 'div.' + field ).hide();\n\t\t\t\t\t$( $this.$el ).find( 'div.job_item_id' ).hide();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'punch_tag_id':\n\t\t\t\t\t$( $this.$el ).find( 'div.' + field ).hide();\n\t\t\t\t\t$( $this.$el ).find( 'div.punch_tag_id' ).hide();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tonCancelClick() {\n\t\twindow.history.back();\n\t}\n\n\tonSaveClick() {\n\t\tvar $this = this;\n\t\tvar record = this.current_edit_record;\n\t\tthis.save_btn.attr( 'disabled', 'disabled' );\n\t\tthis.clearErrorTips( true, true );\n\n\t\tthis.api.setIsIdempotent( true ); //Force to idempotent API call to avoid duplicate network requests from causing errors displayed to the user.\n\t\tthis.api.setUserPunch( record, false, false, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tif ( result && result.isValid() ) {\n\t\t\t\t\tvar result_data = result.getResult();\n\t\t\t\t\tvar quick_punch_success_controller = new QuickPunchModalController( {\n\t\t\t\t\t\tel: _.template( Global.loadWidget( 'views/quick_punch/punch/QuickPunchSuccessView.html' ) )( {\n\t\t\t\t\t\t\tuser_full_name: $this.current_edit_record['first_name'] + ' ' + $this.current_edit_record['last_name'],\n\t\t\t\t\t\t\tlabel: $this.current_edit_record['status_id'] == 10 ? $.i18n._( 'In' ) : $.i18n._( 'Out' ),\n\t\t\t\t\t\t\treturn_date: $this.current_edit_record['time_stamp'],\n\t\t\t\t\t\t\tis_mobile: ( _.isUndefined( window.is_mobile ) == false )\n\t\t\t\t\t\t} ),\n\t\t\t\t\t\t_timedRedirect: 5,\n\t\t\t\t\t\tis_modal: true,\n\t\t\t\t\t\t_delegateCallback: function() {\n\t\t\t\t\t\t\t$this.doLogout();\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t} else {\n\t\t\t\t\t$this.setErrorTips( result );\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t}\n\n\tdoLogout() {\n\t\t//Don't wait for result of logout in case of slow or disconnected internet. Just clear local cookies and move on.\n\t\tthis.current_user_api.Logout( {\n\t\t\tonResult: function() {\n\t\t\t}\n\t\t} );\n\n\t\tGlobal.setAnalyticDimensions();\n\n\t\t//A bare \"if\" wrapped around lh_inst doesn't work here for some reason.\n\t\tif ( typeof ( lh_inst ) != 'undefined' ) {\n\t\t\t//stop the update loop for live chat with support\n\t\t\tclearTimeout( lh_inst.timeoutStatuscheck );\n\t\t}\n\t\tdeleteCookie( 'SessionID-QP' );\n\t\tLocalCacheData.setPunchLoginUser( null );\n\t\tLocalCacheData.setCurrentCompany( null );\n\t\tsessionStorage.clear();\n\t\tif ( window.location.href === Global.getBaseURL() + '#!m=QuickPunchLogin' ) {\n\t\t\tIndexViewController.instance.router.reloadView( 'QuickPunchLogin' );\n\t\t} else {\n\t\t\tGlobal.setURLToBrowser( Global.getBaseURL() + '#!m=QuickPunchLogin' );\n\t\t}\n\t}\n\n\tgetPunchTagFilterData() {\n\t\tvar filter_data = {\n\t\t\tstatus_id: 10,\n\t\t\tuser_id: this.current_edit_record.user_id,\n\t\t\tbranch_id: this.current_edit_record.branch_id,\n\t\t\tdepartment_id: this.current_edit_record.department_id,\n\t\t\tjob_id: this.current_edit_record.job_id,\n\t\t\tjob_item_id: this.current_edit_record.job_item_id,\n\t\t};\n\n\t\treturn filter_data;\n\t}\n\n}\n\nexport class QuickPunchModalController extends Backbone.View { //Must extend Backbone.View rather than TTBackbone otherwise Quick Punch success modal fails.\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\ttimed_redirect_time: 0\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinitialize( options ) {\n\t\t//super.initialize( options );\n\t\tvar $this = this;\n\t\tthis._delegateCallback = options._delegateCallback || null;\n\t\tthis._timedRedirect = options._timedRedirect;\n\t\tthis.is_modal = options.is_modal;\n\t\tthis.render();\n\n\t\t//Back button or Forward button\n\t\twindow.onpopstate = function() {\n\t\t\tclearTimeout( $this.timer );\n\t\t};\n\t}\n\n\trender() {\n\t\tvar $this = this;\n\t\t$( document ).off( 'keyup' ).on( 'keyup', function() {\n\t\t\t$this.stopTimedRedirect();\n\t\t} );\n\n\t\t//must use core Javascript as the jquery function did not catch the event properly and did not stop the timer when opening selects.\n\t\t// $(document).on('mouseup', function () {\n\t\t// \t$this.stopTimedRedirect();\n\t\t// });\n\t\t$( document ).off( 'mousedown' ).on( 'mousedown', function() {\n\t\t\t$this.stopTimedRedirect();\n\t\t} );\n\t\tif ( this.is_modal ) {\n\t\t\t$( this.el ).on( 'hidden.bs.modal', function() {\n\t\t\t\t$this.remove();\n\t\t\t\t$this.delegateCallback();\n\t\t\t} );\n\t\t\t$( this.el ).on( 'shown.bs.modal', function() {\n\t\t\t\t$this.timedRedirect( $this._timedRedirect );\n\t\t\t} );\n\t\t\tvar modal = new bootstrap.Modal( $( this.el )[0], {\n\t\t\t\tbackdrop: 'static',\n\t\t\t} );\n\t\t\tmodal.show();\n\t\t\tdocument.body.appendChild( $( this.el )[0] );\n\t\t} else {\n\t\t\t$this.timedRedirect( $this._timedRedirect );\n\t\t}\n\n\t\t// Eliminate the need for CTRL to be pressed when selecting multiple options in a select element. So the user shouldn't need to use the keyboard at all.\n\t\t// This essentially behaves as if CTRL is always held down.\n\t\t// NOTE: However this then breaks the likely more common case of a user wanting to switch from ONE selected option to a different ONE selected item, as both would be selected.\n\t\t//       Therefore I believe this should not be implemented, unless checkboxes are shown beside each item.\n\t\t// $( '#punch_tag_id' ).mousedown( function( e ) {\n\t\t// \te.preventDefault();\n\t\t//\n\t\t// \tvar select = this;\n\t\t// \tvar scroll = select.scrollTop;\n\t\t//\n\t\t// \te.target.selected = !e.target.selected;\n\t\t//\n\t\t// \tif (e.target.value === '0') { //0=-- NONE --\n\t\t// \t\t$(this.parentNode).find('option').prop('selected', false); // Deselect all options\n\t\t// \t\t$(this.parentNode).find('option[value=\"0\"]').prop('selected', true); // Select only the '0' option\n\t\t// \t} else {\n\t\t// \t\t$(this.parentNode).find('option[value=\"0\"]').prop('selected', false); // Deselect the '0' option\n\t\t// \t}\n\t\t//\n\t\t// \tsetTimeout( function() {\n\t\t// \t\tselect.scrollTop = scroll;\n\t\t// \t}, 0 );\n\t\t//\n\t\t// \t$( select ).focus();\n\t\t// \t$( select ).trigger('change'); //Triggers onFormItemChange( e );\n\t\t// } ).mousemove( function( e ) {\n\t\t// \te.preventDefault();\n\t\t// } );\n\n\t\treturn this;\n\t}\n\n\tdelegateCallback() {\n\t\tif ( this._delegateCallback ) {\n\t\t\tthis._delegateCallback();\n\t\t}\n\t}\n\n\tstopTimedRedirect() {\n\t\tif ( this.is_modal === false ) {\n\t\t\tthis._delegateCallback = null;\n\t\t}\n\t\tthis.removeTimedRedirect();\n\t}\n\n\tupdateTimedRedirect( time ) {\n\t\tif ( time != 'undefined' && time > 0 ) {\n\t\t\tthis.timed_redirect_time = time;\n\t\t}\n\t}\n\n\tremoveTimedRedirect() {\n\t\tclearTimeout( this.timer );\n\t\tif ( this.is_modal ) {\n\t\t\tvar modal_el = bootstrap.Modal.getInstance( this.$el );\n\t\t\tif ( modal_el ) {\n\t\t\t\tmodal_el.hide();\n\t\t\t}\n\t\t} else {\n\t\t\tthis.$( '#timedRedirect' ).remove();\n\t\t\tthis.delegateCallback();\n\t\t}\n\t}\n\n\ttimedRedirect( time ) {\n\t\tvar $this = this;\n\t\tthis.updateTimedRedirect( time );\n\t\tif ( this.timed_redirect_time > 0 ) {\n\t\t\tthis.$( '#timedRedirect' ).html( '( ' + this.timed_redirect_time + ' )' );\n\t\t\tthis.timed_redirect_time--;\n\t\t\tthis.timer = setTimeout( function() {\n\t\t\t\t$this.timedRedirect( null );\n\t\t\t}, 1000 );\n\t\t} else if ( this.timed_redirect_time == 0 ) {\n\t\t\tthis.removeTimedRedirect();\n\t\t}\n\t}\n}\n"],"names":["ApplicationRouter","Backbone","options","_","view_id","result","template","url","new_url","viewName","$this","args","timeout_count","showRibbonMenuAndLoadView","auto_login_timer","$","HeaderViewController","loadViewController","QuickPunchLoginViewController","QuickPunchViewController","children","callBack","clean","viewController","IndexViewController","QuickPunchBaseViewController","TTAPI","Global","custom_field","field","QuickPunchModalController","user","punch_tag_args","el","filter","res_data","permission","custom_field_id_parsed_suffix","row","event","attrs","button","result_data","callback","error_list","container","key","error_obj","error_string","doNotValidate","c_value","manual_id","selected_punch_tags","element","value","e","no_obj_error_string","error","TAlertManager","field_obj","focus_obj","item","error_msg","tooltip","clear_all","destroy","tooltips","i","job","job_item_id_col_name","filter_data","job_item_widget","current_job_item_id","TTUUID","new_arg","task_result","data","job_item","setDefaultData","default_item_id","job_id_col_name","job_widget","current_job_id","branch","department_id_col_name","department_widget","current_department_id","department","punch_tag_id_col_name","punch_tag_widget","current_punch_tag_ids","punch_tag_result","intersected_values","punch_tag_id","punch_tag","punch_tag_manual_ids","punch_tag_ids","manual_ids","source_data","set_empty","field_selector","$field","option","label","optionEl","record","modal","time","modal_el"],"mappings":"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"}