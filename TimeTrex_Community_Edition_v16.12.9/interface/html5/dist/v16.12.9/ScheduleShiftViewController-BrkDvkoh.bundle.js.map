{"version":3,"file":"ScheduleShiftViewController-BrkDvkoh.bundle.js","sources":["../../views/attendance/schedule/ScheduleShiftViewController.js"],"sourcesContent":["export class ScheduleShiftViewController extends BaseViewController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tel: '#schedule_shift_view_container',\n\n\n\t\t\tschedule_status_array: null,\n\n\t\t\tuser_status_array: null,\n\n\t\t\tuser_group_array: null,\n\n\t\t\tuser_api: null,\n\t\t\tuser_group_api: null,\n\t\t\tdate_api: null,\n\t\t\tabsence_policy_api: null,\n\n\t\t\tjob_api: null,\n\t\t\tjob_item_api: null,\n\t\t\tdepartment_api: null,\n\t\t\tdefault_punch_tag: [],\n\t\t\tprevious_punch_tag_selection: [],\n\n\t\t\ttotal_time: null,\n\t\t\tpre_total_time: 0,\n\n\t\t\tis_mass_adding: false\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinit( options ) {\n\t\t//this._super('initialize', options );\n\t\tthis.edit_view_tpl = 'ScheduleShiftEditView.html';\n\t\tthis.permission_id = 'schedule';\n\t\tthis.viewId = 'ScheduleShift';\n\t\tthis.script_name = 'ScheduleShiftView';\n\t\tthis.table_name_key = 'schedule';\n\t\tthis.context_menu_name = $.i18n._( 'Schedule Shift' );\n\t\tthis.navigation_label = $.i18n._( 'Schedule' );\n\t\tthis.api = TTAPI.APISchedule;\n\t\tthis.absence_policy_api = TTAPI.APIAbsencePolicy;\n\t\tthis.user_api = TTAPI.APIUser;\n\t\tthis.user_group_api = TTAPI.APIUserGroup;\n\n\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\tthis.job_api = TTAPI.APIJob;\n\t\t\tthis.job_item_api = TTAPI.APIJobItem;\n\t\t\tthis.punch_tag_api = TTAPI.APIPunchTag;\n\t\t\tthis.department_api = TTAPI.APIDepartment;\n\t\t}\n\n\t\tthis.date_api = TTAPI.APITTDate;\n\n\t\tthis.initPermission();\n\t\tthis.render();\n\t\tthis.buildContextMenu();\n\n\t\tthis.initData();\n\t}\n\n\tgetCustomContextMenuModel() {\n\t\tvar context_menu_model = {\n\t\t\texclude: ['copy'],\n\t\t\tinclude: []\n\t\t};\n\n\t\treturn context_menu_model;\n\t}\n\n\tonSaveClick( ignoreWarning ) {\n\t\t// this function will shortly be deprecated and replaced by BaseViewController.onViewClick(), but this intermediatiary step of reorganizing the code\n\t\t// is to help debug in future by seeing how the current function was updated to match baseview.\n\t\t// initially, the code looped over all the mass edit records, and then for each record, it would loop over the changed fields and set them on that record.\n\t\t// instead, we will now just loop over the changed fields once, and then loop over the mass edit records, cloning this changed set of fields.\n\t\t// The clone itself is probably yet another loop internally, but this at least makes it easier to read and also allows the merge to use the common base view controller function.\n\n\t\tvar $this = this;\n\t\tvar record;\n\t\tif ( this.is_mass_editing ) {\n\t\t\trecord = [];\n\n\t\t\t// loop over all fields on the form, and track the ones that have changed\n\t\t\tvar mass_record_shared = {};\n\t\t\tfor ( var key in this.edit_view_ui_dic ) {\n\n\t\t\t\tif ( !this.edit_view_ui_dic.hasOwnProperty( key ) ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tvar widget = this.edit_view_ui_dic[key];\n\t\t\t\tif ( Global.isSet( widget.isChecked ) ) {\n\t\t\t\t\tif ( widget.isChecked() && widget.getEnabled() ) {\n\t\t\t\t\t\tmass_record_shared[key] = widget.getValue();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// loop over all the selected id's for the mass edit, and apply a copy of the changed fields to each\n\n\t\t\tfor ( var i = 0; i < this.mass_edit_record_ids.length; i++ ) {\n\t\t\t\t//create new copy of the fields that have changed.\n\t\t\t\tvar mass_record_single = Global.clone( mass_record_shared );\n\t\t\t\tmass_record_single['id'] = $this.mass_edit_record_ids[i];\n\n\t\t\t\t// push the single record into the array of mass edit records to be saved\n\t\t\t\trecord.push( mass_record_single );\n\t\t\t}\n\t\t} else {\n\t\t\tthis.collectUIDataToCurrentEditRecord();\n\t\t\trecord = this.uniformVariable( this.current_edit_record );\n\t\t}\n\n\t\tthis.api['set' + this.api.key_name]( record, false, ignoreWarning, {\n\t\t\tonResult: function( result ) {\n\n\t\t\t\t$this.onSaveResult( result );\n\n\t\t\t}\n\t\t} );\n\t}\n\n\t//Make sure this.current_edit_record is updated before validate\n\tvalidate() {\n\t\tvar $this = this;\n\t\tvar record = {};\n\t\tif ( this.is_mass_editing ) {\n\t\t\tvar record = [];\n\t\t\tfor ( var i = 0; i < this.mass_edit_record_ids.length; i++ ) {\n\t\t\t\tvar mass_record = {};\n\t\t\t\tmass_record['id'] = $this.mass_edit_record_ids[i];\n\t\t\t\tfor ( var key in this.edit_view_ui_dic ) {\n\n\t\t\t\t\tif ( !this.edit_view_ui_dic.hasOwnProperty( key ) ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tvar widget = this.edit_view_ui_dic[key];\n\t\t\t\t\tif ( Global.isSet( widget.isChecked ) ) {\n\t\t\t\t\t\tif ( widget.isChecked() && widget.getEnabled() ) {\n\t\t\t\t\t\t\tmass_record[key] = widget.getValue();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\trecord.push( mass_record );\n\t\t\t}\n\t\t} else {\n\t\t\tthis.collectUIDataToCurrentEditRecord();\n\t\t\trecord = this.uniformVariable( this.current_edit_record );\n\t\t}\n\n\t\tthis.api['validate' + this.api.key_name]( record, {\n\t\t\tonResult: function( result ) {\n\t\t\t\t$this.validateResult( result );\n\t\t\t}\n\t\t} );\n\t}\n\n\tjobUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = this.permission_id;\n\t\t}\n\n\t\tif ( PermissionManager.validate( 'job', 'enabled' ) &&\n\t\t\tPermissionManager.validate( p_id, 'edit_job' ) &&\n\t\t\t( Global.getProductEdition() >= 20 ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tjobItemUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'schedule';\n\t\t}\n\n\t\tif ( PermissionManager.validate( 'job_item', 'enabled' ) &&\n\t\t\tPermissionManager.validate( p_id, 'edit_job_item' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tpunchTagUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'schedule';\n\t\t}\n\n\t\tif ( PermissionManager.validate( 'punch_tag', 'enabled' ) &&\n\t\t\tPermissionManager.validate( p_id, 'edit_punch_tag' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tbranchUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'schedule';\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'edit_branch' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tdepartmentUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'schedule';\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'edit_department' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tinitPermission() {\n\t\tsuper.initPermission();\n\n\t\tif ( PermissionManager.validate( this.permission_id, 'view' ) || PermissionManager.validate( this.permission_id, 'view_child' ) ) {\n\t\t\tthis.show_search_tab = true;\n\t\t} else {\n\t\t\tthis.show_search_tab = false;\n\t\t}\n\n\t\tif ( this.jobUIValidate() ) {\n\t\t\tthis.show_job_ui = true;\n\t\t} else {\n\t\t\tthis.show_job_ui = false;\n\t\t}\n\n\t\tif ( this.jobItemUIValidate() ) {\n\t\t\tthis.show_job_item_ui = true;\n\t\t} else {\n\t\t\tthis.show_job_item_ui = false;\n\t\t}\n\n\t\tif ( this.punchTagUIValidate() ) {\n\t\t\tthis.show_punch_tag_ui = true;\n\t\t} else {\n\t\t\tthis.show_punch_tag_ui = false;\n\t\t}\n\n\t\tif ( this.branchUIValidate() ) {\n\t\t\tthis.show_branch_ui = true;\n\t\t} else {\n\t\t\tthis.show_branch_ui = false;\n\t\t}\n\n\t\tif ( this.departmentUIValidate() ) {\n\t\t\tthis.show_department_ui = true;\n\t\t} else {\n\t\t\tthis.show_department_ui = false;\n\t\t}\n\t}\n\n\tinitOptions() {\n\t\tvar $this = this;\n\n\t\tthis.initDropDownOption( 'status', 'status_id', this.api, function( res ) {\n\t\t\tres = res.getResult();\n\n\t\t\t$this.schedule_status_array = Global.buildRecordArray( res );\n\n\t\t} );\n\n\t\tthis.initDropDownOption( 'status', 'user_status_id', this.user_api, function( res ) {\n\t\t\tres = res.getResult();\n\n\t\t\t$this.user_status_array = Global.buildRecordArray( res );\n\t\t} );\n\n\t\tthis.user_group_api.getUserGroup( '', false, false, {\n\t\t\tonResult: function( res ) {\n\t\t\t\tres = res.getResult();\n\n\t\t\t\tres = Global.buildTreeRecord( res );\n\t\t\t\t$this.user_group_array = res;\n\n\t\t\t\t$this.adv_search_field_ui_dic['group_ids'].setSourceData( res );\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tcheckOpenPermission() {\n\t\tif ( Global.getProductEdition() >= 15 && PermissionManager.validate( 'schedule', 'view_open' ) ) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tgetCustomFieldReferenceField() {\n\t\treturn 'note';\n\t}\n\n\tbuildEditViewUI() {\n\n\t\tsuper.buildEditViewUI();\n\n\t\tvar $this = this;\n\n\t\tvar tab_model = {\n\t\t\t'tab_schedule': { 'label': $.i18n._( 'Schedule' ) },\n\t\t\t'tab_audit': true,\n\t\t};\n\t\tthis.setTabModel( tab_model );\n\n\t\tvar form_item_input;\n\t\tvar widgetContainer;\n\n\t\tthis.navigation.AComboBox( {\n\t\t\tapi_class: TTAPI.APISchedule,\n\t\t\tid: this.script_name + '_navigation',\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_schedule_schedule',\n\t\t\tnavigation_mode: true,\n\t\t\tshow_search_inputs: true\n\t\t} );\n\n\t\tthis.setNavigation();\n\n\t\t//Tab 0 start\n\n\t\tvar tab_schedule = this.edit_view_tab.find( '#tab_schedule' );\n\n\t\tvar tab_schedule_column1 = tab_schedule.find( '.first-column' );\n\n\t\tthis.edit_view_tabs[0] = [];\n\n\t\tthis.edit_view_tabs[0].push( tab_schedule_column1 );\n\n\t\t// Employee\n\t\t// Employees\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIUser,\n\t\t\tallow_multiple_selection: true,\n\t\t\tlayout_name: 'global_user',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: !this.checkOpenPermission(),\n\t\t\tset_special_empty: true,\n\t\t\tfield: 'user_id',\n\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\treturn $this.onEmployeeSourceCreate( target, source_data );\n\t\t\t} )\n\n\t\t} );\n\t\tvar default_args = {};\n\t\tdefault_args.permission_section = 'schedule';\n\t\tform_item_input.setDefaultArgs( default_args );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Employee' ), form_item_input, tab_schedule_column1, '' );\n\n\t\t// Status\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\t\tform_item_input.TComboBox( { field: 'status_id' } );\n\t\tform_item_input.setSourceData( $this.schedule_status_array );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Status' ), form_item_input, tab_schedule_column1 );\n\n\t\t//Absence Policy\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIAbsencePolicy,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_absences',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'absence_policy_id'\n\t\t} );\n\n\t\tform_item_input.customSearchFilter = function( filter ) {\n\t\t\treturn $this.setAbsencePolicyFilter( filter );\n\t\t};\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Absence Policy' ), form_item_input, tab_schedule_column1, '', null, true );\n\n\t\t// Available Balance\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\tform_item_input.TText( { field: 'available_balance' } );\n\n\t\twidgetContainer = $( '<div class=\\'widget-h-box available-balance-h-box\\'></div>' );\n\t\tthis.available_balance_info = $( '<span class=\"available-balance-info tticon tticon-info_black_24dp\"></span>' );\n\n\t\twidgetContainer.append( form_item_input );\n\t\twidgetContainer.append( this.available_balance_info );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Available Balance' ), form_item_input, tab_schedule_column1, '', widgetContainer, true );\n\n\t\t// Date\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\t\tform_item_input.TDatePicker( { field: 'start_date_stamp', validation_field: 'date_stamp' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Date' ), form_item_input, tab_schedule_column1, '', null );\n\n\t\t//Mass Add Date\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\t\tform_item_input.TRangePicker( { field: 'start_date_stamps', validation_field: 'date_stamp' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Date' ), form_item_input, tab_schedule_column1, '', null, true );\n\n\t\t// In\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TIME_PICKER );\n\n\t\tform_item_input.TTimePicker( { field: 'start_time' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'In' ), form_item_input, tab_schedule_column1, '', null );\n\n\t\t// Out\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TIME_PICKER );\n\n\t\tform_item_input.TTimePicker( { field: 'end_time' } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Out' ), form_item_input, tab_schedule_column1, '', null );\n\n\t\t// Total\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\tform_item_input.TText( { field: 'total_time' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Total' ), form_item_input, tab_schedule_column1 );\n\n\t\t// Schedule Policy\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APISchedulePolicy,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_schedule',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'schedule_policy_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Schedule Policy' ), form_item_input, tab_schedule_column1 );\n\n\t\t// Branch\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIBranch,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_branch',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'branch_id',\n\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\treturn $this.onSourceDataCreate( target, source_data );\n\t\t\t} ),\n\t\t\tadded_items: [\n\t\t\t\t{ value: TTUUID.not_exist_id, label: Global.default_item },\n\t\t\t]\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Branch' ), form_item_input, tab_schedule_column1, '', null, true );\n\n\t\tif ( !this.show_branch_ui ) {\n\t\t\tthis.detachElement( 'branch_id' );\n\n\t\t}\n\n\t\t// Department\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIDepartment,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_department',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'department_id',\n\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\treturn $this.onSourceDataCreate( target, source_data );\n\t\t\t} ),\n\t\t\tadded_items: [\n\t\t\t\t{ value: TTUUID.not_exist_id, label: Global.default_item },\n\t\t\t]\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Department' ), form_item_input, tab_schedule_column1, '', null, true );\n\n\t\tif ( !this.show_department_ui ) {\n\t\t\tthis.detachElement( 'department_id' );\n\t\t}\n\n\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\t//Job\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIJob,\n\t\t\t\tallow_multiple_selection: false,\n\t\t\t\tlayout_name: 'global_job',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tsetRealValueCallBack: ( function( val ) {\n\t\t\t\t\tif ( val ) {\n\t\t\t\t\t\tjob_coder.setValue( val.manual_id );\n\t\t\t\t\t}\n\t\t\t\t} ),\n\t\t\t\tfield: 'job_id',\n\t\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\t\treturn $this.onSourceDataCreate( target, source_data );\n\t\t\t\t} ),\n\t\t\t\tadded_items: [\n\t\t\t\t\t{ value: TTUUID.not_exist_id, label: Global.default_item },\n\t\t\t\t]\n\t\t\t} );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\tvar job_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tjob_coder.TTextInput( { field: 'job_quick_search', disable_keyup_event: true } );\n\t\t\tjob_coder.addClass( 'job-coder' );\n\n\t\t\twidgetContainer.append( job_coder );\n\t\t\twidgetContainer.append( form_item_input );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Job' ), [form_item_input, job_coder], tab_schedule_column1, '', widgetContainer, true );\n\n\t\t\tif ( !this.show_job_ui ) {\n\t\t\t\tthis.detachElement( 'job_id' );\n\t\t\t}\n\n\t\t\t// Task\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIJobItem,\n\t\t\t\tallow_multiple_selection: false,\n\t\t\t\tlayout_name: 'global_job_item',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tsetRealValueCallBack: ( function( val ) {\n\t\t\t\t\tif ( val ) {\n\t\t\t\t\t\tjob_item_coder.setValue( val.manual_id );\n\t\t\t\t\t}\n\t\t\t\t} ),\n\t\t\t\tfield: 'job_item_id',\n\t\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\t\treturn $this.onSourceDataCreate( target, source_data );\n\t\t\t\t} ),\n\t\t\t\tadded_items: [\n\t\t\t\t\t{ value: TTUUID.not_exist_id, label: Global.default_item },\n\t\t\t\t]\n\t\t\t} );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\tvar job_item_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tjob_item_coder.TTextInput( { field: 'job_item_quick_search', disable_keyup_event: true } );\n\t\t\tjob_item_coder.addClass( 'job-coder' );\n\n\t\t\twidgetContainer.append( job_item_coder );\n\t\t\twidgetContainer.append( form_item_input );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Task' ), [form_item_input, job_item_coder], tab_schedule_column1, '', widgetContainer, true );\n\n\t\t\tif ( !this.show_job_item_ui ) {\n\t\t\t\tthis.detachElement( 'job_item_id' );\n\t\t\t}\n\n\t\t\t//Punch Tag\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIPunchTag,\n\t\t\t\tallow_multiple_selection: true,\n\t\t\t\tlayout_name: 'global_punch_tag',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tget_real_data_on_multi: true,\n\t\t\t\tsetRealValueCallBack: ( ( punch_tags, get_real_data ) => {\n\t\t\t\t\tif ( punch_tags ) {\n\t\t\t\t\t\tthis.setPunchTagQuickSearchManualIds( punch_tags, get_real_data );\n\t\t\t\t\t}\n\t\t\t\t} ),\n\t\t\t\tfield: 'punch_tag_id',\n\t\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\t\treturn $this.onSourceDataCreate( target, source_data );\n\t\t\t\t} ),\n\t\t\t\tadded_items: [\n\t\t\t\t\t{ value: TTUUID.not_exist_id, label: Global.default_item },\n\t\t\t\t]\n\t\t\t} );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\tvar punch_tag_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tpunch_tag_coder.TTextInput( { field: 'punch_tag_quick_search', disable_keyup_event: true } );\n\t\t\tpunch_tag_coder.addClass( 'job-coder' );\n\n\t\t\twidgetContainer.append( punch_tag_coder );\n\t\t\twidgetContainer.append( form_item_input );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Tags' ), [form_item_input, punch_tag_coder], tab_schedule_column1, '', widgetContainer, true );\n\n\t\t\tif ( !this.show_punch_tag_ui ) {\n\t\t\t\tthis.detachElement( 'punch_tag_id' );\n\t\t\t}\n\t\t}\n\n\t\t//Note\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_AREA );\n\t\tform_item_input.TTextArea( { field: 'note', width: '100%' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Note' ), form_item_input, tab_schedule_column1, '', null, null, true );\n\t\tform_item_input.parent().width( '45%' );\n\n\t\tif ( Global.getProductEdition() >= 15 && this.is_viewing == false ) {\n\t\t\t//Notify Employee\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.CHECKBOX );\n\t\t\tform_item_input.TCheckbox( { field: 'notify_user_schedule_change' } );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Notify Employee' ), form_item_input, tab_schedule_column1, '', null, true );\n\t\t}\n\n\t\tif ( this.is_mass_editing ) {\n\t\t\tthis.detachElement( 'total_time' );\n\t\t} else {\n\t\t\tthis.attachElement( 'total_time' );\n\t\t}\n\t}\n\n\tonSourceDataCreate( target, source_data ) {\n\t\tvar display_columns = target.getDisplayColumns();\n\t\tvar first_item = {};\n\n\t\t$.each( display_columns, function( index, content ) {\n\t\t\tfirst_item.id = TTUUID.not_exist_id;\n\t\t\tfirst_item[content.name] = Global.default_item;\n\t\t\treturn false;\n\t\t} );\n\n\t\t//Error: Object doesn't support property or method 'unshift' in /interface/html5/line 6953\n\t\tif ( !source_data || $.type( source_data ) !== 'array' ) {\n\t\t\tsource_data = [];\n\t\t}\n\t\tsource_data.unshift( first_item );\n\n\t\treturn source_data;\n\t}\n\n\tsetEditViewWidgetsMode() {\n\t\tvar did_clean_dic = {};\n\t\tfor ( var key in this.edit_view_ui_dic ) {\n\t\t\tif ( !this.edit_view_ui_dic.hasOwnProperty( key ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tvar widget = this.edit_view_ui_dic[key];\n\t\t\tvar widgetContainer = this.edit_view_form_item_dic[key];\n\t\t\tvar column = widget.parent().parent().parent();\n\t\t\tvar tab_id = column.parent().attr( 'id' );\n\t\t\tif ( !column.hasClass( 'v-box' ) ) {\n\t\t\t\tif ( !did_clean_dic[tab_id] ) {\n\t\t\t\t\tdid_clean_dic[tab_id] = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tswitch ( key ) {\n\t\t\t\tcase 'start_date_stamps':\n\t\t\t\t\tif ( ( !this.current_edit_record.id || this.current_edit_record.id == TTUUID.zero_id ) && !this.is_mass_editing && !this.is_edit ) {\n\t\t\t\t\t\tthis.attachElement( key );\n\t\t\t\t\t\twidget.parents( '.edit-view-form-item-div' ).show();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.detachElement( key );\n\t\t\t\t\t\twidget.parents( '.edit-view-form-item-div' ).hide();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'start_date_stamp':\n\t\t\t\t\tif ( ( !this.current_edit_record.id || this.current_edit_record.id == TTUUID.zero_id ) && !this.is_mass_editing && !this.is_edit ) {\n\t\t\t\t\t\tthis.detachElement( key );\n\t\t\t\t\t\twidget.parents( '.edit-view-form-item-div' ).hide();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.attachElement( key );\n\t\t\t\t\t\twidget.parents( '.edit-view-form-item-div' ).show();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\twidget.css( 'opacity', 1 );\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// #2831 Must check is_viewing, otherwise all fields are editable in View mode. Bug originated in 886a33c71174c10c0699cbf869a3cf2ebd200591\n\t\t\tif ( this.is_viewing ) {\n\t\t\t\tif ( Global.isSet( widget.setEnabled ) ) {\n\t\t\t\t\twidget.setEnabled( false );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif ( Global.isSet( widget.setEnabled ) ) {\n\t\t\t\t\twidget.setEnabled( true );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\texchangeBalance() {\n\n\t\tvar b_div = $( $( this ).next() );\n\t\tif ( b_div.css( 'display' ) === 'block' ) {\n\t\t\tb_div.css( 'display', 'none' );\n\t\t} else if ( b_div.css( 'display' ) === 'none' ) {\n\t\t\tb_div.css( 'display', 'block' );\n\n\t\t}\n\t}\n\n\tonAddResult( result ) {\n\t\tvar $this = this;\n\t\tvar result_data = result.getResult();\n\t\tif ( !result_data ) {\n\t\t\tresult_data = [];\n\t\t}\n\t\tresult_data.company = LocalCacheData.current_company.name;\n\t\tif ( $this.sub_view_mode && $this.parent_key ) {\n\t\t\tresult_data[$this.parent_key] = $this.parent_value;\n\t\t}\n\t\t// Default to Open\n\t\tresult_data === true && ( result_data = { user_id: TTUUID.zero_id } );\n\t\t!result_data.user_id && ( result_data.user_id = TTUUID.zero_id );\n\t\t$this.current_edit_record = result_data;\n\t\t$this.initEditView();\n\t}\n\n\tsetAbsencePolicyFilter( filter ) {\n\t\tif ( !filter.filter_data ) {\n\t\t\tfilter.filter_data = {};\n\t\t}\n\n\t\tfilter.filter_data.user_id = this.current_edit_record.user_id;\n\t\tif ( filter.filter_columns ) {\n\t\t\tfilter.filter_columns.absence_policy = true;\n\t\t}\n\n\t\treturn filter;\n\t}\n\n\tonEmployeeSourceCreate( target, source_data ) {\n\n\t\tif ( !this.checkOpenPermission() ) {\n\t\t\treturn source_data;\n\t\t}\n\n\t\tvar display_columns = target.getDisplayColumns();\n\n\t\tvar first_item = {};\n\t\t$.each( display_columns, function( index, content ) {\n\n\t\t\tfirst_item.id = TTUUID.zero_id;\n\t\t\tfirst_item[content.name] = Global.open_item;\n\n\t\t\treturn false;\n\t\t} );\n\n\t\t//Error: Object doesn't support property or method 'unshift' in /interface/html5/line 6953\n\t\tif ( !source_data || $.type( source_data ) !== 'array' ) {\n\t\t\tsource_data = [];\n\t\t}\n\t\tsource_data.unshift( first_item );\n\n\t\treturn source_data;\n\t}\n\n\tbuildSearchFields() {\n\n\t\tsuper.buildSearchFields();\n\t\tvar $this = this;\n\t\tthis.search_fields = [\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Status' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'status_id',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tlayout_name: 'global_option_column',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Employee' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'user_id',\n\t\t\t\tlayout_name: 'global_user',\n\t\t\t\tapi_class: TTAPI.APIUser,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\t\treturn $this.onEmployeeSourceCreate( target, source_data );\n\t\t\t\t} ),\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Pay Period' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'pay_period_id',\n\t\t\t\tlayout_name: 'global_Pay_period',\n\t\t\t\tapi_class: TTAPI.APIPayPeriod,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Start Date' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'start_date',\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.DATE_PICKER\n\t\t\t} ),\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'End Date' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'end_date',\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.DATE_PICKER\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Employee Status' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'user_status_id',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tlayout_name: 'global_option_column',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Default Branch' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'default_branch_id',\n\t\t\t\tlayout_name: 'global_branch',\n\t\t\t\tapi_class: TTAPI.APIBranch,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tscript_name: 'BranchView',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Default Department' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'default_department_id',\n\t\t\t\tlayout_name: 'global_department',\n\t\t\t\tapi_class: TTAPI.APIDepartment,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tscript_name: 'DepartmentView',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Group' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tmultiple: true,\n\t\t\t\tfield: 'group_ids',\n\t\t\t\tlayout_name: 'global_tree_column',\n\t\t\t\ttree_mode: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Title' ),\n\t\t\t\tfield: 'title_id',\n\t\t\t\tin_column: 2,\n\t\t\t\tlayout_name: 'global_job_title',\n\t\t\t\tapi_class: TTAPI.APIUserTitle,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Job' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'job_id',\n\t\t\t\tlayout_name: 'global_job',\n\t\t\t\tapi_class: ( Global.getProductEdition() >= 20 ) ? TTAPI.APIJob : null,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: ( this.show_job_ui && ( Global.getProductEdition() >= 20 ) ),\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Task' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'job_item_id',\n\t\t\t\tlayout_name: 'global_job_item',\n\t\t\t\tapi_class: ( Global.getProductEdition() >= 20 ) ? TTAPI.APIJobItem : null,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: ( this.show_job_item_ui && ( Global.getProductEdition() >= 20 ) ),\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Punch Tags' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'punch_tag_id',\n\t\t\t\tlayout_name: 'global_punch_tag',\n\t\t\t\tapi_class: ( Global.getProductEdition() >= 20 ) ? TTAPI.APIPunchTag : null,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: ( this.show_punch_tag_ui && ( Global.getProductEdition() >= 20 ) ),\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Schedule Branch' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'branch_id',\n\t\t\t\tlayout_name: 'global_branch',\n\t\t\t\tapi_class: TTAPI.APIBranch,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tscript_name: 'BranchView',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Schedule Department' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'department_id',\n\t\t\t\tlayout_name: 'global_department',\n\t\t\t\tapi_class: TTAPI.APIDepartment,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tscript_name: 'DepartmentView',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Schedule Policy' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'schedule_policy_id',\n\t\t\t\tlayout_name: 'global_schedule',\n\t\t\t\tapi_class: TTAPI.APISchedulePolicy,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} )\n\t\t];\n\t}\n\n\tonFormItemChange( target, doNotValidate ) {\n\t\tvar $this = this;\n\t\tthis.setIsChanged( target );\n\t\tthis.setMassEditingFieldsWhenFormChange( target );\n\n\t\tvar key = target.getField();\n\t\tvar c_value = target.getValue();\n\n\t\tthis.current_edit_record[key] = c_value;\n\n\t\tswitch ( key ) {\n\t\t\tcase 'job_id':\n\t\t\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\t\t\tthis.edit_view_ui_dic['job_quick_search'].setValue( target.getValue( true ) ? ( target.getValue( true ).manual_id ? target.getValue( true ).manual_id : '' ) : '' );\n\t\t\t\t\tthis.setJobItemValueWhenJobChanged( target.getValue( true ), 'job_item_id', {\n\t\t\t\t\t\tstatus_id: 10,\n\t\t\t\t\t\tjob_id: this.current_edit_record.job_id\n\t\t\t\t\t} );\n\t\t\t\t\tthis.edit_view_ui_dic['job_quick_search'].setCheckBox( true );\n\t\t\t\t\tthis.setPunchTagValuesWhenCriteriaChanged( this.getPunchTagFilterData(), 'punch_tag_id' );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'job_item_id':\n\t\t\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\t\t\tthis.edit_view_ui_dic['job_item_quick_search'].setValue( target.getValue( true ) ? ( target.getValue( true ).manual_id ? target.getValue( true ).manual_id : '' ) : '' );\n\t\t\t\t\tthis.edit_view_ui_dic['job_item_quick_search'].setCheckBox( true );\n\t\t\t\t\tthis.setPunchTagValuesWhenCriteriaChanged( this.getPunchTagFilterData(), 'punch_tag_id' );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'punch_tag_id':\n\t\t\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\t\t\tif ( c_value !== TTUUID.zero_id && c_value !== false && c_value.length > 0 ) {\n\t\t\t\t\t\tthis.setPunchTagQuickSearchManualIds( target.getSelectItems() );\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.edit_view_ui_dic['punch_tag_quick_search'].setValue( '' );\n\t\t\t\t\t}\n\t\t\t\t\t$this.previous_punch_tag_selection = c_value;\n\t\t\t\t\t//Reset source data to make sure correct punch tags are always shown.\n\t\t\t\t\tthis.edit_view_ui_dic['punch_tag_id'].setSourceData( null );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'branch_id':\n\t\t\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\t\t\tthis.setPunchTagValuesWhenCriteriaChanged( this.getPunchTagFilterData(), 'punch_tag_id' );\n\t\t\t\t\tthis.setJobValueWhenCriteriaChanged( 'job_id', {\n\t\t\t\t\t\tstatus_id: 10,\n\t\t\t\t\t\tuser_id: this.current_edit_record.user_id,\n\t\t\t\t\t\tpunch_branch_id: this.current_edit_record.branch_id,\n\t\t\t\t\t\tpunch_department_id: this.current_edit_record.department_id\n\t\t\t\t\t} );\n\t\t\t\t\tthis.setDepartmentValueWhenBranchChanged( target.getValue( true ), 'department_id', {\n\t\t\t\t\t\tbranch_id: this.current_edit_record.branch_id,\n\t\t\t\t\t\tuser_id:   this.current_edit_record.user_id\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'department_id':\n\t\t\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\t\t\tthis.setPunchTagValuesWhenCriteriaChanged( this.getPunchTagFilterData(), 'punch_tag_id' );\n\t\t\t\t\tthis.setJobValueWhenCriteriaChanged( 'job_id', {\n\t\t\t\t\t\tstatus_id: 10,\n\t\t\t\t\t\tuser_id: this.current_edit_record.user_id,\n\t\t\t\t\t\tpunch_branch_id: this.current_edit_record.branch_id,\n\t\t\t\t\t\tpunch_department_id: this.current_edit_record.department_id\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'job_quick_search':\n\t\t\tcase 'job_item_quick_search':\n\t\t\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\t\t\tthis.onJobQuickSearch( key, c_value );\n\t\t\t\t\tthis.setPunchTagValuesWhenCriteriaChanged( this.getPunchTagFilterData(), 'punch_tag_id' );\n\t\t\t\t\t//Don't validate immediately as onJobQuickSearch is doing async API calls, and it would cause a guaranteed validation failure.\n\t\t\t\t\tdoNotValidate = true;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'punch_tag_quick_search':\n\t\t\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\t\t\tthis.onPunchTagQuickSearch( c_value, this.getPunchTagFilterData(), 'punch_tag_id' );\n\n\t\t\t\t\t//Don't validate immediately as onPunchTagQuickSearch is doing async API calls, and it would cause a guaranteed validation failure.\n\t\t\t\t\tdoNotValidate = true;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'absence_policy_id':\n\t\t\tcase 'status_id':\n\t\t\t\tthis.onStatusChange();\n\t\t\t\tbreak;\n\t\t\tcase 'user_id':\n\t\t\t\tthis.edit_view_ui_dic['absence_policy_id'].setSourceData( null );\n\t\t\t\tthis.edit_view_ui_dic['absence_policy_id'].setValue( false );\n\t\t\t\tthis.current_edit_record['absence_policy_id'] = false;\n\t\t\t\tthis.getAbsencePolicy( this.current_edit_record[key] );\n\n\t\t\t\tif ( $.isArray( this.current_edit_record[key] ) && this.current_edit_record[key].length > 1 ) {\n\t\t\t\t\tthis.is_mass_adding = true;\n\t\t\t\t} else {\n\t\t\t\t\tthis.is_mass_adding = false;\n\t\t\t\t}\n\t\t\t\tthis.setEditMenu();\n\n\t\t\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\t\t\tthis.setPunchTagValuesWhenCriteriaChanged( this.getPunchTagFilterData(), 'punch_tag_id' )\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\n\t\tthis.getScheduleTotalTime();\n\t\tthis.getProjectedAbsencePolicyBalance();\n\n\t\tif ( !doNotValidate ) {\n\t\t\tthis.validate();\n\t\t}\n\t}\n\n\tgetProjectedAbsencePolicyBalance() {\n\t\t$( this.edit_view_form_item_dic['available_balance'].find( '.schedule-view-balance-info' ) ).css( 'display', 'none' );\n\n\t\tif ( this.current_edit_record['absence_policy_id'] && this.edit_view_form_item_dic['absence_policy_id'].css( 'display' ) === 'block' && !this.is_mass_editing ) {\n\t\t\tvar user_id;\n\t\t\tif ( Global.isArray( this.current_edit_record['user_id'] ) && this.current_edit_record['user_id'].length === 1 ) {\n\t\t\t\tuser_id = this.current_edit_record['user_id'][0];\n\t\t\t} else if ( this.current_edit_record['user_id'] ) {\n\t\t\t\tuser_id = this.current_edit_record['user_id'];\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar date_stamp = this.current_edit_record['date_stamp'];\n\t\t\tvar result_data = this.absence_policy_api.getProjectedAbsencePolicyBalance( this.current_edit_record['absence_policy_id'], user_id, date_stamp, this.total_time, this.pre_total_time, { async: false } );\n\n\t\t\tresult_data = result_data ? result_data : {\n\t\t\t\tavailable_balance: 0,\n\t\t\t\tcurrent_time: 0,\n\t\t\t\tremaining_balance: 0,\n\t\t\t\tprojected_balance: 0,\n\t\t\t\tprojected_remaining_balance: 0\n\t\t\t};\n\n\t\t\tthis.getBalanceHandler( result_data, date_stamp );\n\t\t}\n\t\tthis.onStatusChange();\n\t}\n\n\tgetAbsencePolicy( user_ids ) {\n\t\tvar args = { filter_data: {} };\n\t\targs.filter_data.user_id = user_ids;\n\t\tthis.edit_view_ui_dic['absence_policy_id'].setDefaultArgs( args );\n\t}\n\n\tuniformVariable( records ) {\n\t\tvar new_records = [];\n\t\tif ( Global.isArray( records.user_id ) && records.user_id.length > 0 ) {\n\t\t\tvar user_ids = records.user_id;\n\t\t\tfor ( var key in user_ids ) {\n\t\t\t\tvar tmp_records = Global.clone( records );\n\t\t\t\ttmp_records.user_id = user_ids[key];\n\t\t\t\tnew_records.push( tmp_records );\n\t\t\t}\n\t\t} else {\n\t\t\tnew_records.push( this.current_edit_record );\n\t\t}\n\n\t\tif ( this.current_edit_record.start_date_stamps && new_records.length > 1 ) {\n\t\t\t//Allowing multiple dates\n\t\t\tvar edit_record = [];\n\t\t\tfor ( var ur in new_records ) {\n\t\t\t\tvar dates = this.uniformDates( new_records[ur].start_date_stamps, new_records[ur] );\n\n\t\t\t\tif ( Array.isArray( new_records[ur].start_date_stamps ) ) {\n\t\t\t\t\tdates = new_records[ur].start_date_stamps;\n\t\t\t\t} else {\n\t\t\t\t\tdates = this.parserDatesRange( new_records[ur].start_date_stamps );\n\t\t\t\t}\n\n\t\t\t\tfor ( var d in dates ) {\n\t\t\t\t\tvar new_record = {};\n\t\t\t\t\tfor ( var er in new_records[ur] ) {\n\t\t\t\t\t\tif ( er == 'start_date_stamps' ) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnew_record[er] = new_records[ur][er];\n\t\t\t\t\t}\n\t\t\t\t\tnew_record.start_date_stamp = dates[d];\n\t\t\t\t\tnew_record.date_stamp = dates[d];\n\t\t\t\t\tedit_record.push( new_record );\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tedit_record = this.current_edit_record;\n\t\t\tif ( $.isArray( edit_record.start_date_stamp ) && edit_record.start_date_stamp.length == 1 ) {\n\t\t\t\tedit_record.start_date_stamp = edit_record.start_date_stamp[0];\n\t\t\t}\n\t\t}\n\n\t\treturn edit_record;\n\t}\n\n\tparserDatesRange( date ) {\n\t\tvar dates = date.split( ' - ' );\n\t\tvar resultArray = [];\n\t\tvar beginDate = Global.strToDate( dates[0] );\n\t\tvar endDate = Global.strToDate( dates[1] );\n\n\t\tvar nextDate = beginDate;\n\n\t\twhile ( nextDate.getTime() < endDate.getTime() ) {\n\t\t\tresultArray.push( nextDate.format() );\n\t\t\tnextDate = new Date( new Date( nextDate.getTime() ).setDate( nextDate.getDate() + 1 ) );\n\t\t}\n\t\treturn dates;\n\t}\n\n\tuniformDates( date_range, record ) {\n\t\tvar dates = [];\n\t\tif ( !Array.isArray( date_range ) && date_range.indexOf( ' - ' ) == -1 ) {\n\t\t\tdates = [date_range];\n\t\t} else if ( Array.isArray( date_range ) ) {\n\t\t\tdates = date_range;\n\t\t} else {\n\t\t\tdates = this.parserDatesRange( date_range );\n\t\t}\n\n\t\treturn dates;\n\t}\n\n\tsetCurrentEditRecordData() {\n\t\tvar $this = this;\n\t\t// When mass editing, these fields may not be the common data, so their value will be undefined, so this will cause their change event cannot work properly.\n\t\tthis.setDefaultData( {\n\t\t\t'status_id': 10\n\t\t} );\n\n\t\tif ( this.current_edit_record.id || this.is_mass_editing ) {\n\t\t\tthis.edit_view_ui_dic.user_id.setAllowMultipleSelection( false );\n\t\t} else {\n\t\t\tthis.edit_view_ui_dic.user_id.setAllowMultipleSelection( true );\n\t\t}\n\n\t\t//Set current edit record data to all widgets\n\t\tfor ( var key in this.current_edit_record ) {\n\t\t\tvar widget = this.edit_view_ui_dic[key];\n\t\t\tif ( Global.isSet( widget ) || key === 'date_stamp' ) {\n\t\t\t\tswitch ( key ) {\n\t\t\t\t\tcase 'start_date_stamp':\n\t\t\t\t\tcase 'start_date_stamps':\n\t\t\t\t\t\tif ( !this.current_edit_record[key] ) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar date_array;\n\t\t\t\t\t\tif ( !this.current_edit_record.id ) {\n\t\t\t\t\t\t\tdate_array = this.current_edit_record.start_date_stamps;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif ( Array.isArray( this.current_edit_record.start_date_stamp ) == false ) {\n\t\t\t\t\t\t\t\tdate_array = [this.current_edit_record.start_date_stamp];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.current_edit_record.start_date_stamp = date_array;\n\t\t\t\t\t\twidget.setValue( date_array );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'total_time':\n\t\t\t\t\t\tthis.pre_total_time = ( this.is_add ) ? 0 : this.current_edit_record[key];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_id':\n\t\t\t\t\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\t\t\t\t\tvar args = {};\n\t\t\t\t\t\t\targs.filter_data = {\n\t\t\t\t\t\t\t\tstatus_id: 10,\n\t\t\t\t\t\t\t\tuser_id: this.current_edit_record.user_id,\n\t\t\t\t\t\t\t\tpunch_branch_id: this.current_edit_record.branch_id,\n\t\t\t\t\t\t\t\tpunch_department_id: this.current_edit_record.department_id\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\twidget.setDefaultArgs( args );\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_item_id':\n\t\t\t\t\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\t\t\t\t\tvar args = {};\n\t\t\t\t\t\t\targs.filter_data = { status_id: 10, job_id: this.current_edit_record.job_id };\n\t\t\t\t\t\t\twidget.setDefaultArgs( args );\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'punch_tag_id':\n\t\t\t\t\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t\tthis.previous_punch_tag_selection = this.current_edit_record[key];\n\n\t\t\t\t\t\t\tvar args = {};\n\t\t\t\t\t\t\targs.filter_data = $this.getPunchTagFilterData();\n\t\t\t\t\t\t\twidget.setDefaultArgs( args );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'branch_id':\n\t\t\t\t\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\t\t\t\t\tvar args = {};\n\t\t\t\t\t\t\targs.filter_data = { user_id: this.current_edit_record.user_id };\n\t\t\t\t\t\t\twidget.setDefaultArgs( args );\n\t\t\t\t\t\t}\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'department_id':\n\t\t\t\t\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\t\t\t\t\tvar args = {};\n\t\t\t\t\t\t\targs.filter_data = { user_id: this.current_edit_record.user_id, branch_id: this.current_edit_record.branch_id };\n\t\t\t\t\t\t\twidget.setDefaultArgs( args );\n\t\t\t\t\t\t}\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'punch_tag_quick_search':\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'user_id':\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tthis.getAbsencePolicy( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'date_stamp':\n\t\t\t\t\t\tthis.current_edit_record['start_date_stamp'] = this.current_edit_record[key];\n\t\t\t\t\t\tthis.current_edit_record['start_date_stamps'] = this.current_edit_record[key];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t\tthis.collectUIDataToCurrentEditRecord();\n\t\tthis.setEditViewDataDone();\n\t}\n\n\tgetScheduleTotalTime() {\n\t\tif ( this.is_mass_editing ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar startTime, endTime, date_stamp;\n\t\tif ( this.current_edit_record['start_date_stamps'] ) {\n\t\t\tdate_stamp = this.uniformDates( this.current_edit_record['start_date_stamps'], this.current_edit_record )[0];\n\t\t} else {\n\t\t\tdate_stamp = this.current_edit_record['date_stamp'];\n\t\t}\n\n\t\tvar startTime = date_stamp + ' ' + this.current_edit_record['start_time'];\n\t\tvar endTime = date_stamp + ' ' + this.current_edit_record['end_time'];\n\t\tvar schedulePolicyId = ( this.current_edit_record['schedule_policy_id'] ) ? this.current_edit_record['schedule_policy_id'] : '';\n\n\t\tif ( !schedulePolicyId ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar user_id = this.current_edit_record.user_id;\n\n\t\tvar result = this.api.getScheduleTotalTime( startTime, endTime, schedulePolicyId, user_id, { async: false } );\n\t\tif ( result.isValid() && result.getResult() ) {\n\t\t\tthis.total_time = result.getResult();\n\n\t\t\tvar total_time = Global.getTimeUnit( this.total_time );\n\n\t\t\tthis.edit_view_ui_dic['total_time'].setValue( total_time );\n\n\t\t\tthis.current_edit_record['total_time'] = total_time;\n\t\t}\n\t}\n\n\tsetEditViewDataDone() {\n\t\tsuper.setEditViewDataDone();\n\t\tthis.onStatusChange();\n\t\tthis.getScheduleTotalTime();\n\t\tthis.setEditViewWidgetsMode();\n\t\tthis.getProjectedAbsencePolicyBalance();\n\t}\n\n\tonStatusChange() {\n\t\tif ( this.current_edit_record['status_id'] == 20 ) {\n\t\t\tthis.attachElement( 'absence_policy_id' );\n\t\t\tif ( this.current_edit_record['absence_policy_id'] && this.current_edit_record['absence_policy_id'] != TTUUID.zero_id ) {\n\t\t\t\tthis.attachElement( 'available_balance' );\n\t\t\t} else {\n\t\t\t\tthis.detachElement( 'available_balance' );\n\t\t\t}\n\t\t} else {\n\t\t\tthis.detachElement( 'absence_policy_id' );\n\t\t\tthis.detachElement( 'available_balance' );\n\t\t}\n\n\t\tthis.editFieldResize();\n\n\t}\n}\n"],"names":["ScheduleShiftViewController","options","_","$","context_menu_model","ignoreWarning","$this","record","mass_record_shared","key","widget","i","mass_record_single","result","mass_record","p_id","res","tab_model","form_item_input","widgetContainer","tab_schedule","tab_schedule_column1","target","source_data","default_args","filter","val","job_coder","job_item_coder","punch_tags","get_real_data","punch_tag_coder","display_columns","first_item","index","content","did_clean_dic","column","tab_id","b_div","result_data","doNotValidate","c_value","user_id","date_stamp","user_ids","args","records","new_records","tmp_records","edit_record","ur","dates","d","new_record","er","date","resultArray","beginDate","endDate","nextDate","date_range","date_array","startTime","endTime","schedulePolicyId","total_time"],"mappings":"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"}