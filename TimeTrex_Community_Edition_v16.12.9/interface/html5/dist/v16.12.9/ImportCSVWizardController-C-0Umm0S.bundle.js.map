{"version":3,"file":"ImportCSVWizardController-C-0Umm0S.bundle.js","sources":["../../views/wizard/import_csv/ImportCSVWizardController.js"],"sourcesContent":["import '@/global/widgets/filebrowser/TImageBrowser';\n\nexport class ImportCSVWizardController extends BaseWizardController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tel: '.wizard-bg',\n\n\t\t\tapi_import: null,\n\n\t\t\tparse_hint_source: null,\n\n\t\t\tfield_source: null,\n\n\t\t\tselect_grid_last_row: null,\n\n\t\t\tlast_id: 0, // Last grid id\n\n\t\t\tsaved_layout_array: null,\n\n\t\t\tcolumn_map_data: null, //Used to build grid data\n\n\t\t\tdata_grid_error_source: [],\n\n\t\t\t// _required_files: ['TImageBrowser']\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinit( options ) {\n\t\t//this._super('initialize', options );\n\n\t\tthis.title = $.i18n._( 'Import Wizard' );\n\t\tthis.steps = 6;\n\t\tthis.current_step = 1;\n\t\tthis.wizard_id = 'ProcessPayrollWizard';\n\t\tthis.api_import = TTAPI.APIImport;\n\n\t\tthis.render();\n\t}\n\n\trender() {\n\t\tsuper.render();\n\n\t\tthis.initCurrentStep();\n\t}\n\n\t//Create each page UI\n\tbuildCurrentStepUI() {\n\n\t\tvar $this = this;\n\t\tthis.content_div.empty();\n\t\tswitch ( this.current_step ) {\n\t\t\tcase 1:\n\t\t\t\tvar label = this.getLabel();\n\t\t\t\tlabel.text( $.i18n._( 'Select the type of objects that you wish to import' ) );\n\n\t\t\t\tvar combo_box = this.getComboBox( 'import_class' );\n\n\t\t\t\tvar example_label = this.getLabel();\n\t\t\t\texample_label.text( $.i18n._( 'Download example CSV file' ) );\n\t\t\t\texample_label.css( 'text-decoration', 'underline' );\n\t\t\t\texample_label.css( 'cursor', 'pointer' );\n\t\t\t\texample_label.css( 'margin-top', '25px' );\n\n\t\t\t\tthis.stepsWidgetDic[this.current_step] = {};\n\t\t\t\tthis.stepsWidgetDic[this.current_step][combo_box.getField()] = combo_box;\n\n\t\t\t\texample_label.unbind( 'click' ).bind( 'click', function() {\n\n\t\t\t\t\tvar current_step_ui = $this.stepsWidgetDic[$this.current_step];\n\t\t\t\t\tvar current_value = current_step_ui.import_class.getValue().toLowerCase();\n\t\t\t\t\tvar url = ServiceCaller.getURLByObjectType( 'import_csv_example' ) + 'import_' + current_value + '_example.csv';\n\t\t\t\t\twindow.open( url, '_blank' );\n\t\t\t\t} );\n\n\t\t\t\tthis.stepsWidgetDic[this.current_step]['example_label'] = example_label;\n\n\t\t\t\tcombo_box.unbind( 'change' ).bind( 'change', function( e ) {\n\t\t\t\t\texample_label.text( $.i18n._( 'Download example' ) + ' ' + combo_box.getLabel() + ' ' + $.i18n._( 'CSV file' ) );\n\t\t\t\t} );\n\n\t\t\t\tthis.content_div.append( label );\n\t\t\t\tthis.content_div.append( combo_box );\n\t\t\t\tthis.content_div.append( example_label );\n\n\t\t\t\tthis.removeDropZone();\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tlabel = this.getLabel();\n\t\t\t\tlabel.text( $.i18n._( 'Upload .CSV (Comma Separated Value) or .XLSX (Spreadsheet) file.' ) );\n\n\t\t\t\tvar file_browser = this.getFileBrowser( 'file_uploader', '.csv, .txt, .xls, .xlsx, .ods' );\n\n\t\t\t\tthis.stepsWidgetDic[this.current_step] = {};\n\t\t\t\tthis.stepsWidgetDic[this.current_step][file_browser.getField()] = file_browser;\n\n\t\t\t\tthis.content_div.append( label );\n\t\t\t\tthis.content_div.append( file_browser );\n\n\t\t\t\tfile_browser.unbind( 'imageChange' ).bind( 'imageChange', function() {\n\t\t\t\t\tif ( file_browser.getValue() ) {\n\t\t\t\t\t\tGlobal.setWidgetEnabled( $this.back_btn, true );\n\t\t\t\t\t\tGlobal.setWidgetEnabled( $this.next_btn, true );\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t\tGlobal.initFileDragAndDrop( this.$el.find( '.wizard' )[0], ( files ) => {\n\t\t\t\t\tthis.attachDragAndDropFile( files );\n\t\t\t\t} );\n\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\t\tlabel = this.getLabel();\n\t\t\t\tlabel.text( $.i18n._( 'Map columns from the uploaded file' ) );\n\n\t\t\t\tthis.stepsWidgetDic[this.current_step] = {};\n\n\t\t\t\t//Saved layout\n\n\t\t\t\tvar saved_layout_div = $( '<div></div>' );\n\n\t\t\t\tvar form_item_label = $( '<span></span>' );\n\n\t\t\t\tsaved_layout_div.append( form_item_label );\n\n\t\t\t\tform_item_label.text( $.i18n._( 'Save Mapping As' ) );\n\n\t\t\t\tvar save_mapping_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT ).TTextInput();\n\n\t\t\t\tvar save_btn = $( '<input class=\\'t-button\\' style=\\'margin-left: 5px\\' type=\\'button\\' value=\\'' + $.i18n._( 'Save' ) + '\\'></input>' );\n\n\t\t\t\tsaved_layout_div.append( save_mapping_input );\n\t\t\t\tsaved_layout_div.append( save_btn );\n\n\t\t\t\tform_item_label = $( '<span style=\\'margin-left: 5px\\' >' + $.i18n._( 'Saved Mapping' ) + ':</span>' );\n\n\t\t\t\tvar previous_saved_layout_selector = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\t\t\t\tprevious_saved_layout_selector = previous_saved_layout_selector.TComboBox();\n\t\t\t\tprevious_saved_layout_selector.setValueKey( 'id' );\n\t\t\t\tprevious_saved_layout_selector.setLabelKey( 'name' );\n\n\t\t\t\tvar update_btn = $( '<input class=\\'t-button\\' style=\\'margin-left: 5px\\' type=\\'button\\' value=\\'' + $.i18n._( 'Update' ) + '\\'></input>' );\n\t\t\t\tvar del_btn = $( '<input class=\\'t-button\\' style=\\'margin-left: 5px\\' type=\\'button\\' value=\\'' + $.i18n._( 'Delete' ) + '\\'></input>' );\n\n\t\t\t\tsave_btn.unbind( 'click' ).bind( 'click', function() {\n\t\t\t\t\tvar name = save_mapping_input.getValue();\n\t\t\t\t\tif ( !name ) {\n\t\t\t\t\t\tTAlertManager.showAlert( $.i18n._( 'Mapping Name is blank' ) );\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t$this.saveNewMapping( save_mapping_input.getValue() );\n\t\t\t\t} );\n\n\t\t\t\tupdate_btn.unbind( 'click' ).bind( 'click', function() {\n\t\t\t\t\t$this.updateSelectMapping( previous_saved_layout_selector.getValue() );\n\t\t\t\t} );\n\n\t\t\t\tdel_btn.unbind( 'click' ).bind( 'click', function() {\n\t\t\t\t\t$this.deleteSelectMapping( previous_saved_layout_selector.getValue() );\n\t\t\t\t} );\n\n\t\t\t\tsaved_layout_div.append( form_item_label );\n\t\t\t\tsaved_layout_div.append( previous_saved_layout_selector );\n\t\t\t\tsaved_layout_div.append( update_btn );\n\t\t\t\tsaved_layout_div.append( del_btn );\n\n\t\t\t\tthis.stepsWidgetDic[this.current_step]['saved_mapping'] = previous_saved_layout_selector;\n\n\t\t\t\tprevious_saved_layout_selector.bind( 'formItemChange', function( e, target ) {\n\t\t\t\t\t$this.onSavedLayoutChange( target.getValue() );\n\t\t\t\t} );\n\n\t\t\t\t//add minus buttons\n\t\t\t\tvar action_button_div = $( '<div style=\"margin-left: 15px;text-align: left; margin-bottom: 5px;\"></div>' );\n\t\t\t\tvar add_icon = $( '<button class=\"plus-icon\" style=\"margin-right: 5px;\"></button>' );\n\t\t\t\tvar minus_icon = $( '<button class=\"minus-icon\"></button>' );\n\n\t\t\t\taction_button_div.append( add_icon );\n\t\t\t\taction_button_div.append( minus_icon );\n\n\t\t\t\tthis.content_div.append( label );\n\t\t\t\tthis.content_div.append( saved_layout_div );\n\t\t\t\tthis.content_div.append( action_button_div );\n\n\t\t\t\tvar grid_id = 'import_data';\n\t\t\t\tvar grid_div = $( '<div class=\\'grid-div wizard-grid-div\\'> <table id=\\'' + grid_id + '\\'></table></div>' );\n\t\t\t\tthis.setImportGrid( grid_id, grid_div );\n\n\t\t\t\tadd_icon.bind( 'click', function() {\n\t\t\t\t\t$this.addRow();\n\t\t\t\t} );\n\n\t\t\t\tminus_icon.bind( 'click', function() {\n\t\t\t\t\t$this.minusRow();\n\t\t\t\t} );\n\n\t\t\t\tthis.removeDropZone();\n\t\t\t\tbreak;\n\t\t\tcase 4:\n\t\t\t\tlabel = this.getLabel();\n\t\t\t\tlabel.text( $.i18n._( 'Select import settings' ) );\n\n\t\t\t\tthis.content_div.append( label );\n\n\t\t\t\tthis.stepsWidgetDic[this.current_step] = {};\n\n\t\t\t\tvar export_button = $( this.content_div ).find( '#export-import-result' );\n\t\t\t\tif ( export_button.length > 0 ) {\n\t\t\t\t\texport_button.css( 'visibility', 'hidden' );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 5:\n\t\t\t\tthis.content_div.append( `\n\t\t\t\t\t<button id=\"export-import-result\" class=\"tt-button p-button p-component\" type=\"button\" style=\"visibility: hidden; margin: 0.5rem; float: right\">\n\t\t\t\t\t\t<span class=\"tticon tticon-file_upload_black_24dp\"></span>\n\t\t\t\t\t\t<span class=\"p-button-label\">${$.i18n._( 'Export' )}</span>\n\t\t\t\t\t</button>` );\n\n\t\t\t\tvar export_button = $( this.content_div ).find( '#export-import-result' );\n\n\t\t\t\texport_button.unbind( 'click' ).bind( 'click', function() {\n\t\t\t\t\t$this.onExportClick( $this.data_grid_error_source );\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\tcase 6:\n\t\t\t\tvar export_button = $( this.content_div ).find( '#export-import-result' );\n\t\t\t\tif ( export_button.length > 0 ) {\n\t\t\t\t\texport_button.css( 'visibility', 'hidden' );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tonExportClick( data ) {\n\t\tProgressBar.showOverlay();\n\n\t\tDebug.Text( 'Exporting...', 'ImportWizardViewController.js', 'ImportWizardViewController', 'onExportClick', 10 );\n\n\t\tlet args = {\n\t\t\tfilter_columns: {\n\t\t\t\trowIndex: $.i18n._( 'Row' ),\n\t\t\t\trow: $.i18n._( 'File Column' ),\n\t\t\t\tcolumn: $.i18n._( 'Field' ),\n\t\t\t\tmessage: $.i18n._( 'Message' ),\n\t\t\t},\n\t\t\tfilter_data: null,\n\t\t\tfilter_sort: null,\n\t\t\tresult: data\n\t\t};\n\n\t\tlet post_data = { 0: 'csv', 1: args, 2: true };\n\n\t\tGlobal.APIFileDownload( this.api_import.className, 'exportImportResults', post_data );\n\t}\n\n\tonSavedLayoutChange( value ) {\n\t\tvar grid = this.stepsWidgetDic[this.current_step].import_data;\n\n\t\tvar len = this.saved_layout_array.length;\n\n\t\tvar id = 1;\n\n\t\tvar select_data = {};\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar layout = this.saved_layout_array[i];\n\n\t\t\tif ( layout.id === value ) {\n\t\t\t\tselect_data = layout.data;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tfor ( var i = 0; i < select_data.length; i++ ) {\n\t\t\tvar item = select_data[i];\n\t\t\titem.id = 'csv' + id;\n\t\t\titem.field = item.field ? item.field : TTUUID.zero_id; //Make sure any blank fields are converted to zero_ids to prevent \"undefined\" from appearing in place of the dropdown box.\n\t\t\tid = id + 1;\n\t\t}\n\n\t\tthis.last_id = id;\n\n\t\t//Clone this array because its currently a reference to the raw grid data itself and grid.setData() clears out the grid before rendering it again, which results in a blank grid when switching from a saved mapping, then back to the original.\n\t\tselect_data = this.setSampleRowBaseOnImportFile( select_data ).slice( 0 );\n\n\t\tgrid.setData( select_data );\n\n\t\tthis.bindGridRenderEvents( grid );\n\t}\n\n\tsetSampleRowBaseOnImportFile( grid_data ) {\n\t\tif ( !this.import_data || !grid_data ) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor ( var i = 0; i < grid_data.length; i++ ) {\n\t\t\tvar item = grid_data[i];\n\t\t\titem.row_1 = '';\n\t\t\tfor ( var j = 0; j < this.import_data.length; j++ ) {\n\t\t\t\tvar import_data = this.import_data[j];\n\n\t\t\t\t//#2132 - match based on map_column_name\n\t\t\t\tif ( item && item.map_column_name && import_data && import_data.map_column_name ) {\n\t\t\t\t\tif ( item.map_column_name.trim() === import_data.map_column_name.trim() ) {\n\t\t\t\t\t\titem.row_1 = import_data.row_1;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn grid_data;\n\t}\n\n\tgetSavedMapping( select_layout_id ) {\n\t\tvar $this = this;\n\t\tvar args = {};\n\t\tvar filter_data = {};\n\t\tfilter_data.script = 'import_wizard' + this.stepsDataDic[1].import_class;\n\t\tfilter_data.deleted = false;\n\t\targs.filter_data = filter_data;\n\t\tTTAPI.APIUserGenericData.getUserGenericData( args, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tvar res_data = result.getResult();\n\t\t\t\tif ( $.type( res_data ) !== 'array' ) {\n\t\t\t\t\t$this.saveNewMapping( BaseViewController.default_layout_name, true );\n\t\t\t\t} else {\n\t\t\t\t\t//Force sorting by name so -- DEFAULT -- record appears at the top.\n\t\t\t\t\tres_data.sort( function( a, b ) {\n\t\t\t\t\t\t\treturn Global.compare( a, b, 'name' );\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\t$this.saved_layout_array = res_data;\n\n\t\t\t\t\t//If not set select layout, default to first one and update it to current upload columns\n\t\t\t\t\tif ( !select_layout_id ) {\n\t\t\t\t\t\tselect_layout_id = res_data[0].id;\n\n\t\t\t\t\t\t//Only update the first saved import data record if it is infact the DEFAULT one, otherwise it could overwrite some other random saved mapping, especially if they happen to the delete the default one.\n\t\t\t\t\t\t//  It has to update the DEFAULT saved mapping, otherwise if the user changes to a different mapping, then changes back, all the settings will be lost.\n\t\t\t\t\t\tif ( res_data[0].is_default == true || res_data[0].name == BaseViewController.default_layout_name ) {\n\t\t\t\t\t\t\t$this.updateSelectMapping( select_layout_id );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$this.saveNewMapping( BaseViewController.default_layout_name, true );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t$this.setSavedMappingOptions( res_data, select_layout_id );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tgetLayoutById( select_id ) {\n\t\tvar len = this.saved_layout_array.length;\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar layout = this.saved_layout_array[i];\n\n\t\t\tif ( layout.id === select_id ) {\n\t\t\t\treturn layout;\n\t\t\t}\n\t\t}\n\t}\n\n\tdeleteSelectMapping( select_id ) {\n\t\tvar $this = this;\n\t\tvar select_layout = this.getLayoutById( select_id );\n\n\t\tif ( select_layout.is_default == true || select_layout.name === BaseViewController.default_layout_name ) {\n\t\t\tTAlertManager.showAlert( $.i18n._( 'Can\\'t delete default layout' ) );\n\t\t\treturn;\n\t\t}\n\n\t\tTAlertManager.showConfirmAlert( $.i18n._( 'Are you sure you wish to continue?' ), null, function( flag ) {\n\t\t\tif ( flag ) {\n\t\t\t\tTTAPI.APIUserGenericData.deleteUserGenericData( select_id, {\n\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\t$this.onSavedLayoutChange( $this.saved_layout_array[0].id );\n\t\t\t\t\t\t$this.getSavedMapping();\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t} );\n\t}\n\n\tupdateSelectMapping( select_id ) {\n\t\tvar $this = this;\n\n\t\tthis.saveCurrentStep();\n\t\tvar select_layout = this.getLayoutById( select_id );\n\n\t\tselect_layout.data = this.stepsDataDic[this.current_step].import_data_for_layout;\n\n\t\tTTAPI.APIUserGenericData.setUserGenericData( select_layout, {\n\t\t\tonResult: function( result ) {\n\t\t\t\t//Refresh saved mapping data once it has been saved on the server.\n\t\t\t\t// This makes it so if the user clicks the UPDATE button, then switches to another saved mapping, then switches back, they will see their most recent settings.\n\t\t\t\t$this.getSavedMapping( select_id );\n\t\t\t}\n\t\t} );\n\t}\n\n\tsaveNewMapping( name, is_default ) {\n\t\tthis.saveCurrentStep();\n\n\t\tvar $this = this;\n\t\tvar args = {};\n\t\targs.script = 'import_wizard' + this.stepsDataDic[1].import_class;\n\t\targs.name = name;\n\t\targs.is_default = ( is_default && is_default == true ? true : false );\n\t\targs.data = this.stepsDataDic[this.current_step].import_data_for_layout;\n\n\t\tTTAPI.APIUserGenericData.setUserGenericData( args, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tif ( !result.isValid() ) {\n\t\t\t\t\tTAlertManager.showErrorAlert( result );\n\t\t\t\t} else {\n\t\t\t\t\t$this.getSavedMapping( result.getResult() );\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tsetSavedMappingOptions( array, select_layout_id ) {\n\t\tvar $this = this;\n\n\t\tif ( Global.isSet( $this.stepsWidgetDic[$this.current_step]['saved_mapping'] ) == true ) {\n\t\t\tvar selector = $this.stepsWidgetDic[$this.current_step]['saved_mapping'];\n\n\t\t\tselector.setSourceData( array );\n\n\t\t\tif ( select_layout_id ) {\n\t\t\t\tselector.setValue( select_layout_id );\n\t\t\t}\n\t\t}\n\t\t$this.saved_layout_array = array;\n\t}\n\n\taddRow() {\n\t\tvar grid = this.stepsWidgetDic[this.current_step].import_data;\n\t\tvar all_data = grid.getData();\n\n\t\tvar data = {};\n\t\tdata.id = 'csv' + this.last_id;\n\t\tdata.field = TTUUID.zero_id;\n\t\tdata.default_value = '';\n\t\tdata.parse_hint = '';\n\t\tdata.map_column_name = $.i18n._( 'New Field Column' );\n\t\tdata.row_1 = '';\n\n\t\tthis.last_id = this.last_id + 1;\n\n\t\tall_data.push( data );\n\n\t\tgrid.setData( all_data, false );\n\n\t\tgrid.grid.jqGrid( 'setSelection', data.id );\n\n\t\tthis.bindGridRenderEvents( grid );\n\t}\n\n\tminusRow() {\n\n\t\tvar grid = this.stepsWidgetDic[this.current_step].import_data;\n\t\tvar sel_id = grid.getGridParam( 'selrow' );\n\n\t\tif ( !sel_id ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar all_data = grid.getGridParam( 'data' );\n\n\t\tfor ( var i = all_data.length - 1; i >= 0; i-- ) {\n\t\t\tvar data = all_data[i];\n\n\t\t\tif ( data.id === sel_id ) {\n\t\t\t\tall_data.splice( i, 1 );\n\t\t\t}\n\t\t}\n\n\t\tgrid.setData( all_data, false );\n\n\t\tgrid.grid.jqGrid( 'setSelection', all_data[all_data.length - 1].id );\n\t}\n\n\tgetGridColumns( gridId, callBack ) {\n\t\tvar column_info_array = [];\n\t\tvar $this = this;\n\n\t\tswitch ( gridId ) {\n\t\t\tcase 'import_data':\n\n\t\t\t\tvar column_info = {\n\t\t\t\t\tname: 'map_column_name',\n\t\t\t\t\tindex: 'map_column_name',\n\t\t\t\t\tlabel: $.i18n._( 'File Column' ),\n\t\t\t\t\twidth: 100,\n\t\t\t\t\tsortable: false,\n\t\t\t\t\ttitle: false,\n\t\t\t\t\tformatter: function( cell_value, related_data, row ) {\n\t\t\t\t\t\treturn $this.onTextInputRender( cell_value, related_data, row );\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tcolumn_info_array.push( column_info );\n\n\t\t\t\tcolumn_info = {\n\t\t\t\t\tname: 'field',\n\t\t\t\t\tindex: 'field',\n\t\t\t\t\tlabel: $.i18n._( 'Field' ),\n\t\t\t\t\twidth: 100,\n\t\t\t\t\tsortable: false,\n\t\t\t\t\ttitle: false,\n\t\t\t\t\tformatter: function( cell_value, related_data, row ) {\n\t\t\t\t\t\treturn $this.onFieldRender( cell_value, related_data, row );\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tcolumn_info_array.push( column_info );\n\n\t\t\t\tcolumn_info = {\n\t\t\t\t\tname: 'default_value',\n\t\t\t\t\tindex: 'default_value',\n\t\t\t\t\tlabel: $.i18n._( 'Default Value' ),\n\t\t\t\t\twidth: 100,\n\t\t\t\t\tsortable: false,\n\t\t\t\t\ttitle: false,\n\t\t\t\t\tformatter: function( cell_value, related_data, row ) {\n\t\t\t\t\t\treturn $this.onTextInputRender( cell_value, related_data, row );\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tcolumn_info_array.push( column_info );\n\n\t\t\t\tcolumn_info = {\n\t\t\t\t\tname: 'parse_hint',\n\t\t\t\t\tindex: 'parse_hint',\n\t\t\t\t\tlabel: $.i18n._( 'Parse Hint' ),\n\t\t\t\t\twidth: 100,\n\t\t\t\t\tsortable: false,\n\t\t\t\t\ttitle: false,\n\t\t\t\t\tformatter: function( cell_value, related_data, row ) {\n\t\t\t\t\t\treturn $this.onParseHintRender( cell_value, related_data, row );\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tcolumn_info_array.push( column_info );\n\n\t\t\t\tcolumn_info = {\n\t\t\t\t\tname: 'row_1',\n\t\t\t\t\tindex: 'row_1',\n\t\t\t\t\tlabel: $.i18n._( 'Sample Row' ),\n\t\t\t\t\twidth: 100,\n\t\t\t\t\tsortable: false,\n\t\t\t\t\ttitle: false\n\t\t\t\t};\n\t\t\t\tcolumn_info_array.push( column_info );\n\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tcallBack( column_info_array );\n\t}\n\n\tonParseHintRender( cell_value, related_data, row ) {\n\t\tvar widget;\n\t\tvar col_model = related_data.colModel;\n\t\tvar row_id = related_data.rowId;\n\n\t\tif ( this.parse_hint_source[row.field] ) {\n\t\t\twidget = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\t\t\twidget = widget.TComboBox( { set_empty: false } );\n\n\t\t\twidget.attr( 'custom_cell', 'true' );\n\t\t\twidget.attr( 'render_type', 'combobox' );\n\t\t\twidget.attr( 'id', row_id + '_' + col_model.name );\n\t\t\twidget.width( '97%' );\n\n\t\t\tvar source = Global.buildRecordArray( this.parse_hint_source[row.field] );\n\t\t\twidget.setSourceData( source );\n\n\t\t\tif ( cell_value ) {\n\t\t\t\twidget.setValue( cell_value );\n\t\t\t} else {\n\t\t\t\twidget.setValue( source[0].value );\n\t\t\t\trow.parse_hint = source[0].value;\n\t\t\t}\n\n\t\t} else {\n\t\t\twidget = $( '<input custom_cell=\"true\" ' +\n\t\t\t\t'render_type=\"text\" ' +\n\t\t\t\t'id=\"' + row_id + '_' + col_model.name + '\" ' +\n\t\t\t\t'type=\"text\" ' +\n\t\t\t\t'class=\"t-text-input\" ' +\n\t\t\t\t'style=\"width: 97%\">' );\n\n\t\t\twidget.text( cell_value );\n\t\t}\n\n\t\treturn widget.get( 0 ).outerHTML;\n\t}\n\n\tonFieldRender( cell_value, related_data, row ) {\n\t\tif ( !cell_value ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar col_model = related_data.colModel;\n\t\tvar row_id = related_data.rowId;\n\n\t\tvar acombobox = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\t\tacombobox = acombobox.TComboBox( { set_empty: true } );\n\n\t\tacombobox.attr( 'custom_cell', 'true' );\n\t\tacombobox.attr( 'render_type', 'combobox' );\n\t\tacombobox.attr( 'id', row_id + '_' + col_model.name );\n\t\tacombobox.width( '97%' );\n\n\t\tacombobox.setSourceData( this.field_source );\n\n\t\t$( acombobox[0] ).find( '[value=' + cell_value + ']' ).attr( 'selected', true );\n\n\t\treturn acombobox.get( 0 ).outerHTML;\n\t}\n\n\tonTextInputRender( cell_value, related_data, row ) {\n\n\t\tvar col_model = related_data.colModel;\n\t\tvar row_id = related_data.rowId;\n\n\t\treturn '<input custom_cell=\"true\" render_type=\"text\" id=\"' + row_id + '_' + col_model.name + '\" value=\"' + cell_value + '\" type=\"text\" class=\"t-text-input\" style=\"width: 97%\">';\n\t}\n\n\tbuildCurrentStepData() {\n\n\t\tvar grid;\n\t\tvar $this = this;\n\n\t\tvar current_step_data = this.stepsDataDic[this.current_step];\n\t\tvar current_step_ui = this.stepsWidgetDic[this.current_step];\n\n\t\tswitch ( this.current_step ) {\n\t\t\tcase 1:\n\t\t\t\tthis.api_import.getImportObjects( {\n\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\tvar combo_box = current_step_ui['import_class'];\n\t\t\t\t\t\tvar array = Global.buildRecordArray( result.getResult() );\n\t\t\t\t\t\tcombo_box.setSourceData( array );\n\n\t\t\t\t\t\tif ( current_step_data ) {\n\t\t\t\t\t\t\tcombo_box.setValue( current_step_data.import_class );\n\t\t\t\t\t\t} else if ( $this.default_data ) {\n\t\t\t\t\t\t\tcombo_box.setValue( $this.default_data );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar example_label = current_step_ui.example_label;\n\t\t\t\t\t\texample_label.text( $.i18n._( 'Download example' ) + ' ' + combo_box.getLabel() + ' ' + $.i18n._( 'CSV file' ) );\n\t\t\t\t\t\t$this.setButtonsStatus(); // set button enabled or disabled\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\n\t\t\t\tgrid = current_step_ui.import_data;\n\t\t\t\tif ( current_step_data && current_step_data.import_data_for_layout ) {\n\n\t\t\t\t\tcurrent_step_data.import_data_for_layout = this.setSampleRowBaseOnImportFile( current_step_data.import_data_for_layout );\n\n\t\t\t\t\tgrid.setData( current_step_data.import_data_for_layout );\n\n\t\t\t\t\t$this.bindGridRenderEvents( grid );\n\n\t\t\t\t\t$this.setSavedMappingOptions( $this.saved_layout_array, current_step_data.saved_mapping );\n\n\t\t\t\t\t$this.setButtonsStatus(); // set button enabled or disabled\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.api_import.getOptions( 'parse_hint', {\n\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\t$this.parse_hint_source = result.getResult();\n\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t\tthis.api_import.getOptions( 'columns', {\n\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\t$this.field_source = Global.buildRecordArray( result.getResult() );\n\t\t\t\t\t\t$this.api_import.getRawData( 1, {\n\t\t\t\t\t\t\tonResult: function( getRawDataRes ) {\n\n\t\t\t\t\t\t\t\tvar raw_data = getRawDataRes.getResult();\n\t\t\t\t\t\t\t\traw_data = $this.buildMappingGridDataArray( raw_data[0] );\n\n\t\t\t\t\t\t\t\t$this.api_import.generateColumnMap( {\n\t\t\t\t\t\t\t\t\tonResult: function( generateColumnMapRes ) {\n\t\t\t\t\t\t\t\t\t\t$this.column_map_data = generateColumnMapRes.getResult();\n\n\t\t\t\t\t\t\t\t\t\tvar len = raw_data.length;\n\t\t\t\t\t\t\t\t\t\tfor ( var key in $this.column_map_data ) {\n\t\t\t\t\t\t\t\t\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\t\t\t\t\t\t\t\t\tvar raw_data_item = raw_data[i];\n\t\t\t\t\t\t\t\t\t\t\t\tvar col_map_data_item = $this.column_map_data[key];\n\t\t\t\t\t\t\t\t\t\t\t\tif ( raw_data_item.map_column_name == col_map_data_item.map_column_name ) {\n\t\t\t\t\t\t\t\t\t\t\t\t\traw_data_item.field = key;\n\t\t\t\t\t\t\t\t\t\t\t\t\traw_data_item.default_value = $this.column_map_data[key].default_value ? $this.column_map_data[key].default_value : '';\n\t\t\t\t\t\t\t\t\t\t\t\t\traw_data_item.parse_hint = $this.column_map_data[key].parse_hint ? $this.column_map_data[key].parse_hint : '';\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\traw_data.sort( function( a, b ) {\n\t\t\t\t\t\t\t\t\t\t\t\treturn Global.compare( a, b, 'map_column_name' );\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t\t\t// use to set Sample row to same layout\n\t\t\t\t\t\t\t\t\t\t$this.import_data = raw_data;\n\n\t\t\t\t\t\t\t\t\t\tgrid.setData( raw_data );\n\n\t\t\t\t\t\t\t\t\t\t$this.bindGridRenderEvents( grid );\n\n\t\t\t\t\t\t\t\t\t\t$this.getSavedMapping();\n\t\t\t\t\t\t\t\t\t\t$this.setButtonsStatus(); // set button enabled or disabled\n\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t\tbreak;\n\t\t\tcase 4:\n\t\t\t\tthis.api_import.getOptions( 'import_options', {\n\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\tvar result_data = Global.buildRecordArray( result.getResult() );\n\t\t\t\t\t\tvar div = $( '<div style=\"text-align: left;margin-left: 15px;\"></div>' );\n\n\t\t\t\t\t\tfor ( var i = 0; i < result_data.length; i++ ) {\n\t\t\t\t\t\t\tvar item = result_data[i];\n\t\t\t\t\t\t\tvar check_box = $this.getCheckBox( item.value );\n\n\t\t\t\t\t\t\tif ( current_step_data && current_step_data[item.value] ) {\n\t\t\t\t\t\t\t\tcheck_box.setValue( current_step_data[item.value] );\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tvar label = $( '<label class=\"wizard-checkbox-label\" style=\"display: block;\">' + item.label + '</label>' );\n\t\t\t\t\t\t\tlabel.prepend( check_box );\n\t\t\t\t\t\t\t$this.stepsWidgetDic[$this.current_step][item.value] = check_box;\n\n\t\t\t\t\t\t\tdiv.append( label );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$this.content_div.append( div );\n\t\t\t\t\t\t$this.setButtonsStatus(); // set button enabled or disabled\n\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\tcase 5:\n\t\t\t\tvar import_data = this.stepsDataDic[3].import_data;\n\t\t\t\tvar import_options = this.stepsDataDic[4];\n\n\t\t\t\tthis.api_import.import( import_data, import_options, true, {\n\t\t\t\t\tonResult: function( result ) {\n\n\t\t\t\t\t\tif ( $this.current_step != 5 ) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ( result && result.isValid() ) {\n\t\t\t\t\t\t\tvar label = $this.getLabel();\n\t\t\t\t\t\t\tlabel.text( $.i18n._( 'Data verification successful' ) );\n\n\t\t\t\t\t\t\t$this.content_div.append( label );\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar data_grid_error_source = $this.createErrorSource( result.getDetails() );\n\t\t\t\t\t\t\tif ( data_grid_error_source.length > 0 ) {\n\t\t\t\t\t\t\t\tlet export_button = $( $this.el ).find( '#export-import-result' );\n\t\t\t\t\t\t\t\texport_button.css( 'visibility', 'visible' );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t$this.showErrorGrid( $.i18n._( 'Verification failed due to the following reasons' ) + ': ',\n\t\t\t\t\t\t\t\tdata_grid_error_source,\n\t\t\t\t\t\t\t\t$.i18n._( 'Continue to the next step to skip importing invalid records.' ),\n\t\t\t\t\t\t\t\tresult.getRecordDetails() );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$this.setButtonsStatus(); // set button enabled or disabled\n\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\tcase 6:\n\t\t\t\timport_data = this.stepsDataDic[3].import_data;\n\t\t\t\timport_options = this.stepsDataDic[4];\n\n\t\t\t\tthis.api_import.setIsIdempotent( true ); //Force to idempotent API call to avoid duplicate network requests from causing errors displayed to the user.\n\t\t\t\tthis.api_import.import( import_data, import_options, false, {\n\t\t\t\t\tonResult: function( result ) {\n\n\t\t\t\t\t\tif ( $this.current_step != 6 ) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ( result && result.isValid() ) {\n\t\t\t\t\t\t\tvar label = $this.getLabel();\n\t\t\t\t\t\t\tlabel.text( $.i18n._( 'Import successful' ) );\n\n\t\t\t\t\t\t\t$this.content_div.append( label );\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar data_grid_error_source = $this.createErrorSource( result.getDetails() );\n\n\t\t\t\t\t\t\t$this.showErrorGrid( $.i18n._( 'Import failed due to the following reasons' ) + ':',\n\t\t\t\t\t\t\t\tdata_grid_error_source,\n\t\t\t\t\t\t\t\t$.i18n._( 'Invalid records have been skipped, all other records have been imported successfully.' ),\n\t\t\t\t\t\t\t\tresult.getRecordDetails() );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$this.setButtonsStatus(); // set button enabled or disabled\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\t$this.setButtonsStatus(); // set button enabled or disabled\n\t\t\t\tbreak;\n\n\t\t}\n\t}\n\n\tshowErrorGrid( top_des, data_grid_error_source, bottom_des, records_details ) {\n\t\tthis.data_grid_error_source = data_grid_error_source;\n\n\t\tvar label = $( '<span style=\"text-align: center;\" class=\\'top-des clear-both-div\\'></span>' );\n\t\tlabel.text( top_des );\n\n\t\tthis.content_div.append( label );\n\n\t\tvar grid = $( '<table id=\"error_grid\"></table>' );\n\n\t\tvar columns = [];\n\n\t\tvar column_info = {\n\t\t\tname: 'rowIndex',\n\t\t\tindex: 'rowIndex',\n\t\t\tlabel: $.i18n._( 'Row' ),\n\t\t\twidth: 60,\n\t\t\tsortable: false,\n\t\t\ttitle: false,\n\t\t\tfixed: true\n\t\t};\n\t\tcolumns.push( column_info );\n\n\t\tcolumn_info = {\n\t\t\tname: 'row',\n\t\t\tindex: 'row',\n\t\t\tlabel: $.i18n._( 'File Column' ),\n\t\t\twidth: 100,\n\t\t\tsortable: false,\n\t\t\ttitle: false\n\t\t};\n\t\tcolumns.push( column_info );\n\n\t\tcolumn_info = {\n\t\t\tname: 'column',\n\t\t\tindex: 'column',\n\t\t\tlabel: $.i18n._( 'Field' ),\n\t\t\twidth: 100,\n\t\t\tsortable: false,\n\t\t\ttitle: false\n\t\t};\n\t\tcolumns.push( column_info );\n\n\t\tcolumn_info = {\n\t\t\tname: 'message',\n\t\t\tindex: 'message',\n\t\t\tlabel: $.i18n._( 'Message' ),\n\t\t\twidth: 100,\n\t\t\tsortable: false,\n\t\t\ttitle: false\n\t\t};\n\t\tcolumns.push( column_info );\n\n\t\tthis.content_div.append( grid );\n\n\t\tlabel = $( '<span style=\"display: block; margin-top: 0.5rem;\" class=\\'total-des clear-both-div\\'></span>' );\n\t\tlabel.text( $.i18n._( 'Records' ) + ':' + $.i18n._( 'Total' ) + ': ' + records_details.total + ' ' + $.i18n._( 'Valid' ) + ': ' + records_details.valid + ' ' + $.i18n._( 'Invalid' ) + ': ' + records_details.invalid );\n\n\t\tthis.content_div.append( label );\n\n\t\tlabel = $( '<span style=\"text-align: center\" class=\\'bottom-des clear-both-div\\'></span>' );\n\t\tlabel.text( bottom_des );\n\n\t\tthis.content_div.append( '<br>' );\n\t\tthis.content_div.append( label );\n\n\t\tgrid = new TTGrid( 'error_grid', {\n\t\t\tsortable: false,\n\t\t\twidth: ( this.content_div.width() - 2 )\n\t\t}, columns );\n\t\tgrid.setData( data_grid_error_source );\n\t\tgrid.setGridColumnsWidth( null, { max_grid_width: ( this.content_div.width() - 2 ) } );\n\t}\n\n\tcreateErrorSource( error_array ) {\n\n\t\t//Error: Uncaught TypeError: Cannot read property 'import_data' of undefined in /interface/html5/#!m=TimeSheet&date=00070609&user_id=14372 line 773\n\t\tif ( !this.stepsDataDic || !this.stepsDataDic[3] ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar import_data = this.stepsDataDic[3].import_data;\n\t\tvar result = [];\n\t\tvar error_row = {};\n\n\t\tfor ( var key in error_array ) {\n\t\t\tvar error_info = error_array[key]['error'];\n\t\t\tfor ( var error_key in error_info ) {\n\t\t\t\tif ( !error_info.hasOwnProperty( error_key ) ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\terror_row = {};\n\t\t\t\t// #2345 - we always want the row and column name to show in the error report.\n\t\t\t\terror_row.rowIndex = parseInt( key ) + 2;\n\t\t\t\terror_row.row = $.i18n._( 'Unknown' );\n\t\t\t\terror_row.column = error_key;\n\t\t\t\terror_row.message = error_info[error_key][0];\n\n\t\t\t\t// Try to get more specific error info.\n\t\t\t\tfor ( var import_key in import_data ) {\n\t\t\t\t\tif ( import_key == error_key ) {  // #2345 - This won't match in cases where the csv columns do not match the object properties being validated. For example 'branch' != 'branch_id'\n\t\t\t\t\t\terror_row.row = import_data[import_key].map_column_name;\n\t\t\t\t\t\terror_row.column = this.column_map_data[import_key].import_column_name;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tresult.push( error_row );\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tbindGridRenderEvents( grid ) {\n\t\tvar $this = this;\n\t\tvar inputs = grid.grid.find( 'input[custom_cell=\"true\"]' );\n\t\tvar select = grid.grid.find( 'select[custom_cell=\"true\"]' );\n\n\t\tinputs.unbind( 'change' ).bind( 'change', function( e ) {\n\t\t\t$this.onCellInputChange( e );\n\t\t} );\n\n\t\tselect.unbind( 'change' ).bind( 'change', function( e ) {\n\t\t\t$this.onCellInputChange( e );\n\t\t} );\n\n\t\tinputs.unbind( 'focusin' ).bind( 'focusin', function( e ) {\n\t\t\t$this.onCellFocusIn( e );\n\t\t} );\n\n\t\tselect.unbind( 'focusin' ).bind( 'focusin', function( e ) {\n\t\t\t$this.onCellFocusIn( e );\n\t\t} );\n\t}\n\n\tonCellFocusIn( e ) {\n\t\tvar current_step_ui = this.stepsWidgetDic[this.current_step];\n\t\tvar grid = current_step_ui['import_data'];\n\t\tvar target = $( e.target );\n\t\tvar target_id = target.attr( 'id' );\n\t\tvar row_id = target_id.split( '_' )[0];\n\n\t\tgrid.grid.jqGrid( 'setSelection', row_id );\n\t}\n\n\tonCellInputChange( e ) {\n\t\tvar $this = this;\n\t\tvar current_step_ui = this.stepsWidgetDic[this.current_step];\n\t\tvar grid = current_step_ui['import_data'];\n\t\tvar target = $( e.target );\n\t\tvar target_id = target.attr( 'id' );\n\t\tvar row_id = target_id.split( '_' )[0];\n\t\tvar field = target_id.substring( target_id.indexOf( '_' ) + 1, target_id.length );\n\t\tvar data = grid.getData();\n\t\tvar target_val = target.val();\n\n\t\tvar len = data.length;\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar row_data = data[i];\n\t\t\tif ( row_data.id === row_id ) {\n\t\t\t\trow_data[field] = target_val;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif ( field === 'field' ) {\n\t\t\tupdateParseHintWidget();\n\t\t}\n\n\t\tfunction updateParseHintWidget() {\n\t\t\tvar widget;\n\t\t\tvar parse_hint_widget = target.parent().parent().find( '#' + row_id + '_parse_hint' );\n\t\t\tvar render_type = parse_hint_widget.attr( 'render_type' );\n\n\t\t\trow_data['parse_hint'] = '';\n\n\t\t\tif ( $this.parse_hint_source[target_val] ) {\n\n\t\t\t\twidget = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\t\t\t\twidget = widget.TComboBox( { set_empty: false } );\n\n\t\t\t\twidget.attr( 'custom_cell', 'true' );\n\t\t\t\twidget.attr( 'render_type', 'combobox' );\n\t\t\t\twidget.attr( 'id', row_id + '_parse_hint' );\n\t\t\t\twidget.width( '97%' );\n\n\t\t\t\tvar source = Global.buildRecordArray( $this.parse_hint_source[target_val] );\n\t\t\t\twidget.setSourceData( Global.buildRecordArray( $this.parse_hint_source[target_val] ) );\n\t\t\t\twidget.setValue( source[0].value );\n\t\t\t\trow_data['parse_hint'] = source[0].value;\n\n\t\t\t\tparse_hint_widget.parent().append( widget );\n\t\t\t\tparse_hint_widget.remove();\n\n\t\t\t} else {\n\n\t\t\t\twidget = $( '<input custom_cell=\"true\" ' +\n\t\t\t\t\t'render_type=\"text\" ' +\n\t\t\t\t\t'id=\"' + row_id + '_parse_hint\" ' +\n\t\t\t\t\t'value=\"\" ' +\n\t\t\t\t\t'type=\"text\" ' +\n\t\t\t\t\t'class=\"t-text-input\" ' +\n\t\t\t\t\t'style=\"width: 97%\">' );\n\n\t\t\t\tparse_hint_widget.parent().append( widget );\n\t\t\t\tparse_hint_widget.remove();\n\n\t\t\t}\n\n\t\t\twidget.bind( 'change', function( e ) {\n\t\t\t\t$this.onCellInputChange( e );\n\t\t\t} );\n\n\t\t}\n\t}\n\n\tsetImportGrid( gridId, grid_div, allMultipleSelection ) {\n\n\t\tif ( !allMultipleSelection ) {\n\t\t\tallMultipleSelection = false;\n\t\t}\n\n\t\tvar $this = this;\n\n\t\tthis.content_div.append( grid_div );\n\n\t\tthis.getGridColumns( gridId, function( column_model ) {\n\n\t\t\t$this.stepsWidgetDic[$this.current_step][gridId] = new TTGrid( gridId, {\n\t\t\t\tsortable: false,\n\t\t\t\theight: 300,\n\t\t\t\tmultiselect: allMultipleSelection,\n\t\t\t\tmultiboxonly: allMultipleSelection,\n\t\t\t\tediturl: 'clientArray'\n\t\t\t}, column_model );\n\n\t\t\t$this.setGridSize( $this.stepsWidgetDic[$this.current_step][gridId] );\n\n\t\t\t$this.setGridGroupColumns( gridId );\n\n\t\t} );\n\t}\n\n\tbuildMappingGridDataArray( mappingData ) {\n\n\t\tvar result = [];\n\t\tvar id = 1;\n\t\tfor ( var key in mappingData ) {\n\t\t\tif ( !mappingData.hasOwnProperty( key ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar item = mappingData[key];\n\t\t\tvar data = {};\n\t\t\tdata.id = 'csv' + id;\n\t\t\tdata.field = item.field ? item.field : TTUUID.zero_id;\n\t\t\tdata.default_value = item.default_value ? item.default_value : '';\n\t\t\tdata.parse_hint = item.parse_hint ? item.parse_hint : '';\n\t\t\tdata.map_column_name = item.map_column_name ? item.map_column_name : key;\n\t\t\tdata.row_1 = item.row_1 ? item.row_1 : item;\n\t\t\tresult.push( data );\n\n\t\t\tid = id + 1;\n\n\t\t}\n\n\t\tthis.last_id = id;\n\n\t\treturn result;\n\t}\n\n\tonDoneClick() {\n\t\tthis.cleanStepsData();\n\t\tLocalCacheData.current_open_wizard_controllers = LocalCacheData.current_open_wizard_controllers.filter( wizard => wizard.wizard_id !== this.wizard_id );\n\t\tthis.saveAllStepsToUserGenericData( function() {\n\n\t\t} );\n\n\t\tif ( this.call_back ) {\n\t\t\tthis.call_back();\n\t\t}\n\n\t\t$( this.el ).remove();\n\t}\n\n\tinitCurrentStep() {\n\n\t\tvar $this = this;\n\t\t$this.progress_label.text( 'Step ' + $this.current_step + ' of ' + $this.steps );\n\t\t$this.progress.attr( 'max', $this.steps );\n\t\t$this.progress.val( $this.current_step );\n\n\t\t$this.buildCurrentStepUI();\n\t\t$this.buildCurrentStepData();\n\t\t$this.setCurrentStepValues();\n\t}\n\n\tonNextClick() {\n\t\tvar $this = this;\n\t\tthis.saveCurrentStep();\n\t\tvar current_step_data = this.stepsDataDic[this.current_step];\n\t\tGlobal.setWidgetEnabled( this.back_btn, false );\n\t\tGlobal.setWidgetEnabled( this.next_btn, false );\n\t\tif ( this.current_step === 2 ) {\n\n\t\t\tif ( !current_step_data.file_uploader ) {\n\t\t\t\tTAlertManager.showAlert( $.i18n._( 'Please choose a file to import.' ) );\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$this.api_import.uploadFile( current_step_data.file_uploader, 'object_type=import&object_id=' + this.api_import.className, {\n\t\t\t\tonResult: function( upload_file_result ) {\n\t\t\t\t\tif ( upload_file_result.toLowerCase() !== 'true' ) {\n\t\t\t\t\t\t$this.setButtonsStatus(); // set button enabled or disabled\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t$this.current_step = $this.current_step + 1;\n\n\t\t\t\t\t$this.stepsDataDic[$this.current_step] = null;\n\t\t\t\t\t$this.initCurrentStep();\n\n\t\t\t\t}\n\t\t\t} );\n\n\t\t} else {\n\n\t\t\tthis.current_step = this.current_step + 1;\n\t\t\tthis.initCurrentStep();\n\t\t}\n\t}\n\n\tbuildImportMapping( array ) {\n\n\t\tvar result = {};\n\t\tvar content;\n\n\t\tvar len = array.length;\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar item = array[i];\n\t\t\tif ( item.field ) {\n\t\t\t\tcontent = {};\n\t\t\t\tcontent.field = item.field;\n\t\t\t\tcontent.map_column_name = item.map_column_name;\n\t\t\t\tcontent.default_value = item.default_value;\n\t\t\t\tcontent.parse_hint = item.parse_hint;\n\t\t\t\tresult[item.field] = content;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/* jshint ignore:start */\n\tsaveCurrentStep() {\n\t\tthis.stepsDataDic[this.current_step] = {};\n\t\tvar current_step_data = this.stepsDataDic[this.current_step];\n\t\tvar current_step_ui = this.stepsWidgetDic[this.current_step];\n\t\tswitch ( this.current_step ) {\n\t\t\tcase 1:\n\t\t\t\tcurrent_step_data.import_class = current_step_ui.import_class.getValue();\n\n\t\t\t\tvar formatted_import_class = current_step_data.import_class.charAt( 0 ).toUpperCase() + current_step_data.import_class.slice( 1 );\n\n\t\t\t\tthis.api_import.className = 'APIImport' + formatted_import_class;\n\t\t\t\tthis.api_import.key_name = 'Import' + formatted_import_class;\n\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tcurrent_step_data.file_uploader = current_step_ui.file_uploader.getValue();\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\t\tvar grid = current_step_ui.import_data;\n\t\t\t\tcurrent_step_data.import_data = this.buildImportMapping( grid.getData() );\n\t\t\t\tcurrent_step_data.import_data_for_layout = grid.getData();\n\t\t\t\tcurrent_step_data.saved_mapping = current_step_ui.saved_mapping.getValue();\n\t\t\t\tbreak;\n\t\t\tcase 4:\n\t\t\t\tfor ( var key in current_step_ui ) {\n\n\t\t\t\t\tif ( !current_step_ui.hasOwnProperty( key ) ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tcurrent_step_data[key] = current_step_ui[key].getValue();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/* jshint ignore:end */\n\tsetDefaultDataToSteps() {\n\n\t\tif ( !this.default_data ) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t//Remove drop zone so that it doesn't show up on the wrong step.\n\tremoveDropZone() {\n\t\tlet drop_zone = this.$el.find( '.file-drop-zone-highlight' );\n\t\tif ( drop_zone.length > 0 ) {\n\t\t\tdrop_zone.remove();\n\t\t}\n\t}\n\n\tattachDragAndDropFile( files ) {\n\t\t//Only add the first file as each document is a single file.\n\t\tlet data_transfer = new DataTransfer()\n\t\tdata_transfer.items.add( files[0] );\n\n\t\tthis.stepsWidgetDic[2].file_uploader[0].querySelector( 'input' ).files = data_transfer.files;\n\t\tthis.stepsWidgetDic[2].file_uploader.trigger( 'change' );\n\t\tthis.stepsWidgetDic[2].file_uploader.find( 'input' ).trigger( 'change' );\n\t}\n\n}\n"],"names":["ImportCSVWizardController","options","_","$","$this","label","combo_box","example_label","current_step_ui","current_value","url","e","file_browser","files","saved_layout_div","form_item_label","save_mapping_input","save_btn","previous_saved_layout_selector","update_btn","del_btn","name","target","action_button_div","add_icon","minus_icon","grid_id","grid_div","export_button","data","post_data","value","grid","len","id","select_data","i","layout","item","grid_data","j","import_data","select_layout_id","args","filter_data","result","res_data","a","b","select_id","select_layout","flag","is_default","array","selector","all_data","sel_id","gridId","callBack","column_info_array","column_info","cell_value","related_data","row","widget","col_model","row_id","source","acombobox","current_step_data","getRawDataRes","raw_data","generateColumnMapRes","key","raw_data_item","col_map_data_item","result_data","div","check_box","import_options","data_grid_error_source","top_des","bottom_des","records_details","columns","error_array","error_row","error_info","error_key","import_key","inputs","select","target_id","field","target_val","row_data","updateParseHintWidget","parse_hint_widget","allMultipleSelection","column_model","mappingData","wizard","upload_file_result","content","formatted_import_class","drop_zone","data_transfer"],"mappings":"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"}