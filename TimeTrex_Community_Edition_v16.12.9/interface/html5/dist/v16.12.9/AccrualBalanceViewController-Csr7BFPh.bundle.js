import{_ as d,j as c}from"./vendor-tTApdY0Y.bundle.js";class m extends BaseViewController{constructor(e={}){d.defaults(e,{el:"#accrual_balance_view_container",user_group_api:null,user_group_array:null,sub_accrual_view_controller:null,log_object_ids:null}),super(e)}init(e){this.edit_view_tpl="AccrualBalanceEditView.html",this.permission_id="accrual",this.viewId="AccrualBalance",this.script_name="AccrualBalanceView",this.table_name_key="accrual",this.context_menu_name=c.i18n._("Accrual Balances"),this.navigation_label=c.i18n._("Accrual Balance"),this.api=TTAPI.APIAccrualBalance,this.accrual_api=TTAPI.APIAccrual,this.user_api=TTAPI.APIUser,this.user_group_api=TTAPI.APIUserGroup,this.initPermission(),this.render(),this.buildContextMenu(),this.initData()}initPermission(){super.initPermission(),PermissionManager.validate(this.permission_id,"view")||PermissionManager.validate(this.permission_id,"view_child")?this.show_search_tab=!0:this.show_search_tab=!1}initOptions(){var e=this;this.initDropDownOption("status","user_status_id",this.user_api,null,"user_status_array"),this.user_group_api.getUserGroup("",!1,!1,{onResult:function(i){i=i.getResult(),i=Global.buildTreeRecord(i),!e.sub_view_mode&&e.basic_search_field_ui_dic.group_id&&e.basic_search_field_ui_dic.group_id.setSourceData(i),e.user_group_array=i}})}buildEditViewUI(){super.buildEditViewUI();var e=this,i={tab_accrual:{label:c.i18n._("Accrual"),init_callback:"initSubAccrualView",display_on_mass_edit:!1},tab_audit:!0};this.setTabModel(i),this.navigation.AComboBox({api_class:TTAPI.APIAccrualBalance,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_accrual_balance",navigation_mode:!0,addition_source_function:function(t,r){return e.__createRowId(r)},show_search_inputs:!0}),this.setNavigation()}getCustomContextMenuModel(){var e={exclude:["default"],include:["add","view","export_excel"]};return e}buildSearchFields(){super.buildSearchFields();var e={};e.permission_section="accrual",this.search_fields=[new SearchField({label:c.i18n._("Employee"),in_column:1,default_args:e,field:"user_id",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:c.i18n._("Employee Status"),in_column:1,field:"user_status_id",multiple:!0,basic_search:!0,adv_search:!1,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:c.i18n._("Accrual Account"),in_column:1,field:"accrual_policy_account_id",layout_name:"global_accrual_policy_account",api_class:TTAPI.APIAccrualPolicyAccount,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:c.i18n._("Default Branch"),in_column:2,field:"default_branch_id",layout_name:"global_branch",api_class:TTAPI.APIBranch,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:c.i18n._("Default Department"),in_column:2,field:"default_department_id",layout_name:"global_department",api_class:TTAPI.APIDepartment,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:c.i18n._("Group"),in_column:2,multiple:!0,field:"group_id",layout_name:"global_tree_column",tree_mode:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX})]}getFilterColumnsFromDisplayColumns(){var e={};return e.user_id=!0,e.accrual_policy_account_id=!0,this._getFilterColumnsFromDisplayColumns(e,!0)}__createRowId(e){if(Array.isArray(e))for(var i=0;i<e.length;i++)e[i].id=e[i].user_id+"_"+e[i].accrual_policy_account_id;else e&&e.user_id&&e.accrual_policy_account_id?e.id=e.user_id+"_"+e.accrual_policy_account_id:Debug.Text("ERROR: Data format is invalid.","AccrualBalanceViewController.js","AccrualBalanceViewController","__createRowId",1);return e}setDefaultMenuAddIcon(e,i,t){this.setDefaultMenuEditIcon(e,i,t)}setEditMenuAddIcon(e,i){ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}onAddClick(){var e=this;this.setCurrentEditViewState("view"),this.add_accrual=!0,e.openEditView();var i=null,t=this.getGridSelectIdArray(),r=t.length;if(r>0)i=this.getRecordFromGridById(t[0]);else{var _=e.grid.getGridParam("data");i=_[0]}var a={};a.filter_data={},i&&(a.filter_data.user_id=i.user_id,a.filter_data.accrual_policy_account_id=i.accrual_policy_account_id),this.api["get"+this.api.key_name](a,{onResult:function(o){var l=o.getResult();l||(l=[]),l=e.__createRowId(l),l=l[0],l||(l={}),e.current_edit_record=l,e.current_edit_record&&e.current_edit_record.user_id&&e.current_edit_record.accrual_policy_account_id&&(a.filter_data.user_id=e.current_edit_record.user_id,a.filter_data.accrual_policy_account_id=e.current_edit_record.accrual_policy_account_id),e.accrual_api["get"+e.accrual_api.key_name](a,{onResult:function(u){var n=u.getResult();e.log_object_ids=[];for(var s=0;s<n.length;s++)e.log_object_ids.push(n[s].id);e.initEditView()}})}})}parseToUserId(e){return e?(e=e.toString(),e.indexOf("_")>0?e.split("_")[0]:e):!1}parseToAccrualPolicyAccountId(e){return e?(e=e.toString(),e.indexOf("_")>0?e.split("_")[1]:e):!1}getAPIFilters(){var e=this.getCurrentSelectedRecord(),i={};return i.filter_data={},i.filter_data.user_id=this.parseToUserId(e),i.filter_data.accrual_policy_account_id=this.parseToAccrualPolicyAccountId(e),i}doViewClickResult(e){var i=this,t={};return t.filter_data={},e=i.__createRowId(e),i.current_edit_record=e,i.current_edit_record&&i.current_edit_record.user_id&&i.current_edit_record.accrual_policy_account_id&&(t.filter_data.user_id=i.current_edit_record.user_id,t.filter_data.accrual_policy_account_id=i.current_edit_record.accrual_policy_account_id),i.accrual_api["get"+i.accrual_api.key_name](t,{onResult:function(r){var _=r.getResult();i.log_object_ids=[];for(var a=0;a<_.length;a++)i.log_object_ids.push(_[a].id);return i.initEditView()}})}setEditViewData(){this.is_changed=!1,this.initEditViewData(),this.switchToProperTab(),this.initTabData()}initEditViewData(){if(!this.edit_only_mode&&this.navigation){var e=this.grid.getGridParam("data"),i=this.edit_view.find(".navigation-div");if(i.css("display","block"),!this.navigation.getSourceData()){this.navigation.setSourceData(e),this.navigation.setRowPerPage(LocalCacheData.getLoginUserPreference().items_per_page),this.navigation.setPagerData(this.pager_data);var t={};t.filter_data=Global.convertLayoutFilterToAPIFilter(this.select_layout),t.filter_sort=this.select_layout.data.filter_sort,this.navigation.setDefaultArgs(t)}this.navigation.setValue(this.current_edit_record)}this.setNavigationArrowsEnabled(),this.setCurrentEditRecordData(),this.edit_view.find(".save-and-continue-div").SaveAndContinueBox({related_view_controller:this}),this.edit_view.find(".save-and-continue-div").css("display","none")}initSubAccrualView(){var e=this;if(!this.current_edit_record.id&&!this.add_accrual){TTPromise.resolve("BaseViewController","onTabShow");return}if(this.sub_accrual_view_controller){this.sub_accrual_view_controller.buildContextMenu(!0),this.sub_accrual_view_controller.setDefaultMenu(),e.sub_accrual_view_controller.parent_edit_record=e.current_edit_record,e.sub_accrual_view_controller.initData();return}Global.loadScript("views/attendance/accrual/AccrualViewController.js",function(){var r=e.edit_view_tab.find("#tab_accrual"),_=r.find(".first-column-sub-view");TTPromise.add("initSubAccrualView","init"),TTPromise.wait("initSubAccrualView","init",function(){_.css("opacity","1")}),_.css("opacity","0"),Global.trackView("SubAccrualView"),AccrualViewController.loadSubView(_,i,t)});function i(){}function t(r){e.sub_accrual_view_controller=r,e.sub_accrual_view_controller.parent_edit_record=e.current_edit_record,e.sub_accrual_view_controller.parent_view_controller=e,e.sub_accrual_view_controller.is_trigger_add=!!e.add_accrual,e.sub_accrual_view_controller.initData(),e.add_accrual=!1}}setSubLogViewFilter(){return this.sub_log_view_controller?(this.sub_log_view_controller.parent_key="object_id",this.sub_log_view_controller.parent_value=this.log_object_ids,this.sub_log_view_controller.table_name_key=this.table_name_key,!0):!1}removeEditView(){super.removeEditView(),this.sub_accrual_view_controller=null}setNavigation(){var e=this;this.navigation.setPossibleDisplayColumns(this.buildDisplayColumnsByColumnModel(this.grid.getGridParam("colModel")),this.buildDisplayColumns(this.default_display_columns)),this.navigation.unbind("formItemChange").bind("formItemChange",function(i,t){t.getField();var r=t.getValue();r&&r!==e.current_edit_record.id&&(ProgressBar.showOverlay(),e.onViewClick(r))})}}export{m as AccrualBalanceViewController};
//# sourceMappingURL=AccrualBalanceViewController-Csr7BFPh.bundle.js.map
