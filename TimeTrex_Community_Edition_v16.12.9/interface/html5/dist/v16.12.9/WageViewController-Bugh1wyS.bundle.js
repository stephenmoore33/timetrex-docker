import{_,j as t}from"./vendor-tTApdY0Y.bundle.js";class u extends BaseViewController{constructor(e={}){_.defaults(e,{el:"#wage_view_container",user_api:null,user_group_api:null,company_api:null,currency_api:null,type_array:null,status_array:null,sex_array:null,user_group_array:null,country_array:null,province_array:null,e_province_array:null,currency:"",code:"",is_mass_adding:!1,events:{}}),super(e)}init(e){this.edit_view_tpl="WageEditView.html",this.permission_id="wage",this.script_name="WageView",this.viewId="Wage",this.table_name_key="user_wage",this.context_menu_name=t.i18n._("Wage"),this.navigation_label=t.i18n._("Wage"),this.document_object_type_id=110,this.api=TTAPI.APIUserWage,this.user_group_api=TTAPI.APIUserGroup,this.company_api=TTAPI.APICompany,this.user_api=TTAPI.APIUser,this.currency_api=TTAPI.APICurrency,this.render(),this.sub_view_mode?this.buildContextMenu(!0):this.buildContextMenu(),this.sub_view_mode||this.initData()}initOptions(){var e=this,i=[{option_name:"type",api:this.api},{option_name:"status",api:this.user_api},{option_name:"country",field_name:"country",api:this.company_api}];this.initDropDownOptions(i),this.user_group_api.getUserGroup("",!1,!1,{onResult:function(a){a=a.getResult(),a=Global.buildTreeRecord(a),e.user_group_array=a,e.sub_view_mode||e.adv_search_field_ui_dic.group_id.setSourceData(a)}})}getCustomContextMenuModel(){var e={exclude:["copy"],include:[{label:t.i18n._("Import"),id:"import_icon",menu_align:"right",action_group:"import_export",group:"other",vue_icon:"tticon tticon-file_download_black_24dp",permission_result:PermissionManager.checkTopLevelPermission("ImportCSVWage"),permission:null,sort_order:9010}]};return e}onFormItemChange(e,i){this.setIsChanged(e),this.setMassEditingFieldsWhenFormChange(e);var a=e.getField(),l=e.getValue();switch(this.current_edit_record[a]=l,a){case"type_id":this.onTypeChange(!0);break;case"user_id":t.isArray(this.current_edit_record.user_id)&&this.current_edit_record.user_id.length>1?this.is_mass_adding=!0:this.is_mass_adding=!1,this.setCurrency();break;case"wage":case"weekly_time":this.getHourlyRate();break}i||this.validate()}setCurrentEditRecordData(){this.setDefaultData({enable_recalculate_timesheets:!0},!0),super.setCurrentEditRecordData()}validate(){var e=this,i={};if(LocalCacheData.current_doing_context_action="validate",this.is_mass_editing)for(var a in this.edit_view_ui_dic){var l=this.edit_view_ui_dic[a];Global.isSet(l.isChecked)&&l.isChecked()&&l.getEnabled()&&(i[a]=l.getValue())}else Global.isArray(this.current_edit_record.user_id)&&this.current_edit_record.user_id.length>0?(i=[],t.each(this.current_edit_record.user_id,function(r,s){var n=Global.clone(e.current_edit_record);n.user_id=s,i.push(n)})):i=this.current_edit_record;this.api["validate"+this.api.key_name](i,{onResult:function(r){e.validateResult(r)}})}setDefaultMenuImportIcon(e,i,a){PermissionManager.checkTopLevelPermission("ImportCSVWage")===!0?ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}onCustomContextClick(e){switch(e){case"import_icon":this.onImportClick();break}}onImportClick(){var e=this;IndexViewController.openWizard("ImportCSVWizard","UserWage",function(){e.search()})}doSaveAPICall(e,i,a){e=this.buildMassAddRecord(e),super.doSaveAPICall(e,i,a)}setEditMenuSaveAndContinueIcon(e,i){this.saveAndContinueValidate(e),(this.is_mass_adding||!this.current_edit_record)&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setEditMenuSaveAndAddIcon(e,i){this.saveAndNewValidate(e),(!this.current_edit_record||!this.current_edit_record.id)&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setEditMenuSaveAndCopyIcon(e,i){this.saveAndContinueValidate(e),(!this.current_edit_record||!this.current_edit_record.id)&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setEditViewData(){var e=this;if(super.setEditViewData(),this.setCurrency(),!this.sub_view_mode){var i=e.edit_view_ui_dic.user_id;i&&((!this.current_edit_record||!this.current_edit_record.id)&&!this.is_mass_editing?i.setAllowMultipleSelection(!0):i.setAllowMultipleSelection(!1))}e.onTypeChange(!1)}setCurrency(){var e=this;if(Global.isSet(this.current_edit_record.user_id)){var i={};i.filter_data={user_id:this.current_edit_record.user_id},this.currency_api.getCurrency(i,!1,!1,{onResult:function(a){a=a.getResult(),Global.isArray(a)?(e.currency.text(a[0].symbol),e.code.text(a[0].iso_code)):(e.currency.text(""),e.code.text(""))}})}}getHourlyRate(){var e=this;this.current_edit_record.wage&&this.current_edit_record.weekly_time&&this.current_edit_record.type_id&&this.current_edit_record.type_id!=10&&this.api.getHourlyRate(this.current_edit_record.wage,e.edit_view_ui_dic.weekly_time.getInputValue(),this.current_edit_record.type_id,{onResult:function(i){var a=i.getResult();i&&i.isValid()&&e.current_edit_record&&(e.current_edit_record.hourly_rate=a,e.edit_view_ui_dic.hourly_rate.val(a))}})}onTypeChange(e){parseInt(this.current_edit_record.type_id)!=10?(this.attachElement("weekly_time"),this.attachElement("hourly_rate"),e&&this.getHourlyRate()):(this.detachElement("weekly_time"),this.detachElement("hourly_rate"))}buildEditViewUI(){super.buildEditViewUI();var e=this,i={tab_wage:{label:t.i18n._("Wage")},tab_attachment:!0,tab_audit:!0};this.setTabModel(i),this.navigation.AComboBox({api_class:TTAPI.APIUserWage,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_wage",show_search_inputs:!0,navigation_mode:!0}),this.setNavigation();var a=this.edit_view_tab.find("#tab_wage"),l=a.find(".first-column"),r,s,n;if(!this.sub_view_mode){r=Global.loadWidgetByName(FormItemType.AWESOME_BOX),r.AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!1,layout_name:"global_user",show_search_inputs:!0,set_empty:!0,field:"user_id"});var d={};d.permission_section="wage",r.setDefaultArgs(d),this.addEditFieldToColumn(t.i18n._("Employee"),r,l,"")}r=Global.loadWidgetByName(FormItemType.AWESOME_BOX),r.AComboBox({api_class:TTAPI.APIWageGroup,allow_multiple_selection:!1,layout_name:"global_wage_group",show_search_inputs:!0,set_default:!0,field:"wage_group_id"}),this.sub_view_mode?this.addEditFieldToColumn(t.i18n._("Wage Group"),r,l,""):this.addEditFieldToColumn(t.i18n._("Wage Group"),r,l),r=Global.loadWidgetByName(FormItemType.COMBO_BOX),r.TComboBox({field:"type_id"}),r.setSourceData(e.type_array),this.addEditFieldToColumn(t.i18n._("Type"),r,l),r=Global.loadWidgetByName(FormItemType.TEXT_INPUT),r.TTextInput({field:"wage",width:90}),s=t("<div class='widget-h-box'></div>"),this.currency=t("<span class='widget-left-label'></span>"),this.code=t("<span class='widget-right-label'></span>"),s.append(this.currency),s.append(r),s.append(this.code),this.addEditFieldToColumn(t.i18n._("Wage"),r,l,"",s),r=Global.loadWidgetByName(FormItemType.TEXT_INPUT),r.TTextInput({field:"weekly_time",need_parser_sec:!0}),s=t("<div class='widget-h-box'></div>"),n=t("<span class='widget-right-label'>( "+t.i18n._("ie")+": "+t.i18n._("40 hours / week")+" )</span>"),s.append(r),s.append(n),this.addEditFieldToColumn(t.i18n._("Average Time / Week"),r,l,"",s,!0),r=Global.loadWidgetByName(FormItemType.TEXT_INPUT),r.TTextInput({field:"hourly_rate"}),this.addEditFieldToColumn(t.i18n._("Annual Hourly Rate"),r,l,"",null,!0),r=Global.loadWidgetByName(FormItemType.TEXT_INPUT),r.TTextInput({field:"labor_burden_percent",width:50}),s=t("<div class='widget-h-box'></div>"),n=t("<span class='widget-right-label'>% ( "+t.i18n._("ie")+": "+t.i18n._("25&#37; burden")+" )</span>"),s.append(r),s.append(n),this.addEditFieldToColumn(t.i18n._("Labor Burden Percent"),r,l,"",s),r=Global.loadWidgetByName(FormItemType.DATE_PICKER),r.TDatePicker({field:"effective_date",width:120}),this.addEditFieldToColumn(t.i18n._("Effective Date"),r,l),this.is_viewing==!1&&(r=Global.loadWidgetByName(FormItemType.CHECKBOX),r.TCheckbox({field:"enable_recalculate_timesheets"}),s=t("<div class='widget-h-box'></div>"),n=t("<span class='widget-right-label'> "+t.i18n._("(Open pay periods only, from effective date.)")+"</span>"),s.append(r),s.append(n),this.addEditFieldToColumn(t.i18n._("Recalculate TimeSheets"),r,l,"",s,!0)),r=Global.loadWidgetByName(FormItemType.TEXT_AREA),r.TTextArea({field:"note",width:389,height:117}),this.addEditFieldToColumn(t.i18n._("Note"),r,l,"",null,null,!0)}setSelectLayout(){this.sub_view_mode?super.setSelectLayout(["first_name","last_name"]):super.setSelectLayout()}setProvince(e,i){var a=this;!e||e==="-1"||e==="0"?(a.province_array=[],this.adv_search_field_ui_dic.province.setSourceData([])):this.company_api.getOptions("province",e,{onResult:function(l){l=l.getResult(),l||(l=[]),a.province_array=Global.buildRecordArray(l),a.adv_search_field_ui_dic.province.setSourceData(a.province_array)}})}eSetProvince(e){var i=this,a=i.edit_view_ui_dic.province;!e||e==="-1"||e==="0"?(i.e_province_array=[],a.setSourceData([])):this.company_api.getOptions("province",e,{onResult:function(l){l=l.getResult(),l||(l=[]),i.e_province_array=Global.buildRecordArray(l),a.setSourceData(i.e_province_array)}})}onSetSearchFilterFinished(){if(this.search_panel.getSelectTabIndex()===1){var e=this.adv_search_field_ui_dic.country,i=e.getValue();this.setProvince(i)}}onBuildBasicUIFinished(){this.search_panel.find("div #basic_search")}onBuildAdvUIFinished(){this.adv_search_field_ui_dic.country.change(t.proxy(function(){var e=this.adv_search_field_ui_dic.country,i=e.getValue();this.setProvince(i),this.adv_search_field_ui_dic.province.setValue(null)},this))}buildSearchFields(){super.buildSearchFields();var e={permission_section:"wage"};this.search_fields=[new SearchField({label:t.i18n._("Employee"),in_column:1,field:"user_id",layout_name:"global_user",default_args:e,api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:t.i18n._("Type"),in_column:1,field:"type_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:t.i18n._("Wage Group"),in_column:1,field:"wage_group_id",layout_name:"global_wage_group",api_class:TTAPI.APIWageGroup,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX,addition_source_function:(i,a)=>(a.unshift({id:TTUUID.zero_id,name:t.i18n._("-- Default --")}),a)}),new SearchField({label:t.i18n._("Status"),in_column:1,field:"status_id",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:t.i18n._("Group"),in_column:1,multiple:!0,field:"group_id",layout_name:"global_tree_column",tree_mode:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:t.i18n._("Created By"),in_column:2,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!0,script_name:"EmployeeView",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:t.i18n._("Updated By"),in_column:2,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!0,script_name:"EmployeeView",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:t.i18n._("Default Branch"),in_column:2,field:"default_branch_id",layout_name:"global_branch",api_class:TTAPI.APIBranch,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:t.i18n._("Default Department"),field:"default_department_id",in_column:2,layout_name:"global_department",api_class:TTAPI.APIDepartment,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:t.i18n._("Title"),field:"title_id",in_column:2,layout_name:"global_job_title",api_class:TTAPI.APIUserTitle,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:t.i18n._("Country"),in_column:3,field:"country",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.COMBO_BOX}),new SearchField({label:t.i18n._("Province/State"),in_column:3,field:"province",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX})]}cleanWhenUnloadView(e){t("#wage_view_container").remove(),super.cleanWhenUnloadView(e)}searchDone(){TTPromise.resolve("WageView","init"),super.searchDone()}}u.loadView=function(o){Global.loadViewSource("Wage","WageView.html",function(e){var i={},a=_.template(e);Global.isSet(o)?o.html(a(i)):Global.contentContainer().html(a(i))})};u.loadSubView=function(o,e,i){Global.loadViewSource("Wage","SubWageView.html",function(a){var l={},r=_.template(a);Global.isSet(e)&&e(),Global.isSet(o)&&(o.html(r(l)),Global.isSet(i)&&i(sub_wage_view_controller))})};export{u as WageViewController};
//# sourceMappingURL=WageViewController-Bugh1wyS.bundle.js.map
