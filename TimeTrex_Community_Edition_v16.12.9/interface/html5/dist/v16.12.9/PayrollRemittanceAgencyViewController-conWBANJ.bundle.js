import{_ as l,j as n}from"./vendor-tTApdY0Y.bundle.js";class d extends BaseViewController{constructor(e={}){l.defaults(e,{el:"#payroll_remittance_agency_view_container",status_array:null,type_array:null,agency_array:null,country_array:null,province_array:null,district_array:null,remittance_source_account_array:null,sub_event_view_controller:null,e_province_array:null,company_api:null,remittance_source_account_api:null,always_week_day_array:null,date_api:null}),super(e)}init(){this.edit_view_tpl="PayrollRemittanceAgencyEditView.html",this.permission_id="payroll_remittance_agency",this.viewId="PayrollRemittanceAgency",this.script_name="PayrollRemittanceAgencyView",this.table_name_key="payroll_remittance_agency",this.context_menu_name=n.i18n._("Remittance Agencies"),this.navigation_label=n.i18n._("Remittance Agency"),this.api=TTAPI.APIPayrollRemittanceAgency,this.company_api=TTAPI.APICompany,this.date_api=TTAPI.APITTDate,this.remittance_source_account_api=TTAPI.APIRemittanceSourceAccount,this.render(),this.buildContextMenu(),this.initData()}initOptions(e){var r=[{option_name:"status",api:this.api},{option_name:"type",api:this.api},{option_name:"country",field_name:"country",api:this.company_api},{option_name:"always_week_day",field_name:"always_week_day",api:this.api}];this.initDropDownOptions(r,e)}openEditView(e){var r=this;this.edit_only_mode?this.initOptions(function(t){r.edit_view||r.initEditViewUI(r.viewId,r.edit_view_tpl);var a={};a.filter_data={id:e},r.api.getPayrollRemittanceAgency(a,{onResult:function(_){_=_.getResult()[0],_?(r.current_edit_record=_,r.initEditView()):(TAlertManager.showAlert(n.i18n._("Invalid agency id")),r.onCancelClick())}})}):super.openEditView()}getFilterColumnsFromDisplayColumns(){var e={};e.is_owner=!0,e.id=!0,e.is_child=!0,e.in_use=!0,e.first_name=!0,e.last_name=!0,e.type_id=!0,e.country=!0,e.province=!0,e.district=!0;var r=[];if(this.grid&&(r=this.grid.getGridParam("colModel")),r)for(var t=r.length,a=0;a<t;a++){var _=r[a];e[_.name]=!0}return e}onSetSearchFilterFinished(){var e,r;this.search_panel.getSelectTabIndex()===0?(e=this.basic_search_field_ui_dic.country,r=e.getValue(),this.setProvince(r)):this.search_panel.getSelectTabIndex()===1&&(e=this.adv_search_field_ui_dic.country,r=e.getValue(),this.setProvince(r))}getCustomContextMenuModel(){var e={exclude:["export_excel"],include:[]};return e}onBuildAdvUIFinished(){this.adv_search_field_ui_dic.country.change(n.proxy(function(){var e=this.adv_search_field_ui_dic.country,r=e.getValue();this.setProvince(r),this.adv_search_field_ui_dic.province.setValue(null)},this))}onBuildBasicUIFinished(){this.basic_search_field_ui_dic.country.change(n.proxy(function(){var e=this.basic_search_field_ui_dic.country,r=e.getValue();this.setProvince(r),this.basic_search_field_ui_dic.province.setValue(null)},this))}onFormItemChange(e,r){this.setIsChanged(e),this.setMassEditingFieldsWhenFormChange(e);var t=e.getField(),a=e.getValue();switch(t){case"country":case"province":if(a.toString()===this.current_edit_record[t].toString())return;break;case"type_id":if(a.toString()===this.current_edit_record[t].toString())return;this.onTypeChange(a);break;case"agency_id":this.onAgencyIdChange();break}this.current_edit_record[t]=a,(t==="country"||t==="type_id"||t==="province"||t==="district")&&(t!="province"&&(this.detachElement("province"),this.eSetProvince(this.current_edit_record.country)),t!="district"&&(this.detachElement("district"),this.setDistrict(this.current_edit_record.country,this.current_edit_record.province)),this.current_edit_record.type_id=this.edit_view_ui_dic.type_id.getValue(),this.current_edit_record.country=this.edit_view_ui_dic.country.getValue(),this.current_edit_record.province=this.edit_view_ui_dic.province.getValue()?this.edit_view_ui_dic.province.getValue():"00",this.current_edit_record.district=this.edit_view_ui_dic.district.getValue()?this.edit_view_ui_dic.district.getValue():"00",this.getAgencyOptions()),t==="legal_entity_id"&&this.getRemittanceSourceAccount(),r||this.validate()}onAgencyIdChange(){var e={agency_id:this.edit_view_ui_dic.agency_id.getValue()},r=this.api.getOptions("agency_id_field_labels",e,{async:!1}).getResult();this.detachElement("primary_identification"),this.detachElement("secondary_identification"),this.detachElement("tertiary_identification");for(var t in r)this.attachElement(t),this.edit_view_form_item_dic[t].find(".edit-view-form-item-label").text(r[t]);this.editFieldResize()}getAgencyOptions(){var e={type_id:this.current_edit_record.type_id,country:this.current_edit_record.country,province:this.current_edit_record.province,district:this.current_edit_record.district},r=this;this.api.getOptions("agency",e,{async:!1,onResult:function(t){var a=t.getResult();a||(a=[]),r.agency_array=Global.buildRecordArray(a),Global.isSet(r.basic_search_field_ui_dic.agency_id)&&r.basic_search_field_ui_dic.agency_id.setSourceData(Global.buildRecordArray(a)),Global.isSet(r.adv_search_field_ui_dic.agency_id)&&r.adv_search_field_ui_dic.agency_id.setSourceData(Global.buildRecordArray(a)),r.edit_view_ui_dic.agency_id.setSourceData(r.agency_array),r.current_edit_record.agency_id&&t[r.current_edit_record.agency_id]?r.edit_view_ui_dic.agency_id.setValue(r.current_edit_record.agency_id):r.current_edit_record.agency_id=r.edit_view_ui_dic.agency_id.getValue(),r.onAgencyIdChange()}})}getRemittanceSourceAccount(){var e=this,r=this.edit_view_ui_dic.legal_entity_id.getValue();if((!Global.isSet(r)||Global.isFalseOrNull(r))&&(r=this.current_edit_record.legal_entity_id),TTUUID.isUUID(r)){var t={};t.filter_data={},t.filter_data.legal_entity_id=r,t.filter_columns={},t.filter_columns.id=!0,t.filter_columns.name=!0,e.remittance_source_account_api.getRemittanceSourceAccount(t,{onResult:function(a){a=a.getResult(),e.remittance_source_account_array=a,e.edit_view_ui_dic.remittance_source_account_id.setSourceData(a)}})}}onTypeChange(e){(!Global.isSet(e)||Global.isFalseOrNull(e))&&(!Global.isSet(this.current_edit_record.type_id)||Global.isFalseOrNull(this.current_edit_record.type_id))&&(this.current_edit_record.type_id=10),this.editFieldResize()}setDistrict(e,r){var t=this;this.edit_view_ui_dic.type_id.getValue()==30?this.api.getDistrictOptions(e,r,{async:!1,onResult:function(a){if(a=a.getResult(),Object.keys(a).length==0||Object.keys(a).length==1&&a["00"]){t.current_edit_record.district="00";return}a||(a=[]),t.attachElement("district");var _=null;if(a.length<=1&&(_={label:"-- "+n.i18n._("Other")+" --",value:"00",fullValue:"00",orderValue:-1,id:"00"}),t.district_array=Global.buildRecordArray(a,_),t.edit_view_ui_dic.district.setSourceData(t.district_array),t.current_edit_record.district&&a[t.current_edit_record.district])t.edit_view_ui_dic.district.setValue(t.current_edit_record.district);else{var i=t.edit_view_ui_dic.district.getValue();(i==TTUUID.not_exist_id||i==TTUUID.zero_id||i==!1||i==null)&&(i="00",t.edit_view_ui_dic.district.setValue(i)),t.current_edit_record.district=i}}}):(t.current_edit_record.district="00",t.edit_view_ui_dic.district.setValue("00"))}setCurrentEditRecordData(){for(var e in this.current_edit_record)if(this.current_edit_record.hasOwnProperty(e)){var r=this.edit_view_ui_dic[e];if(Global.isSet(r))switch(e){default:r.setValue(this.current_edit_record[e]);break}}this.collectUIDataToCurrentEditRecord(),this.setEditViewDataDone()}eSetProvince(e,r){var t=this;this.edit_view_ui_dic.type_id.getValue()>10?this.api.getProvinceOptions(e,{async:!1,onResult:function(a){if(a=a.getResult(),a||(a=[]),t.edit_view_ui_dic.type_id.getValue()<20||Object.keys(a).length==0||Object.keys(a).length==1&&a["00"]){t.current_edit_record.province="00";return}t.attachElement("province");var _=null;if(a.length<=1&&(_={label:"-- "+n.i18n._("Other")+" --",value:"00",fullValue:"00",orderValue:-1,id:"00"}),t.province_array=Global.buildRecordArray(a,_),t.edit_view_ui_dic.province.setSourceData(t.province_array),t.current_edit_record.province&&Global.isSet(a[t.current_edit_record.province]))t.edit_view_ui_dic.province.setValue(t.current_edit_record.province);else{var i=t.edit_view_ui_dic.province.getValue();(i==TTUUID.not_exist_id||i==TTUUID.zero_id||i==!1||i==null)&&(i="00"),t.current_edit_record.province=i}}}):(t.current_edit_record.province="00",t.edit_view_ui_dic.province.setValue("00 "))}setEditViewDataDone(){super.setEditViewDataDone(),this.onTypeChange(),this.detachElement("province"),this.detachElement("district"),this.eSetProvince(this.current_edit_record.country),this.setDistrict(this.current_edit_record.country,this.current_edit_record.province),this.getAgencyOptions()}buildEditViewUI(){super.buildEditViewUI();var e=this,r={tab_payroll_remittance_agency:{label:n.i18n._("Remittance Agency"),is_multi_column:!0},tab_payroll_remittance_agency_event:{label:n.i18n._("Events"),init_callback:"initSubEventView",display_on_mass_edit:!1,html_template:this.getPayrollRemittanceAgencyEventTabHtml()},tab_audit:!0};this.setTabModel(r),this.navigation&&(this.navigation.AComboBox({api_class:TTAPI.APIPayrollRemittanceAgency,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_payroll_remittance_agency",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation());var t=this.edit_view_tab.find("#tab_payroll_remittance_agency"),a=t.find(".first-column"),_=t.find(".second-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(a),this.edit_view_tabs[0].push(_);var i=Global.loadWidgetByName(FormItemType.AWESOME_BOX);i.AComboBox({api_class:TTAPI.APILegalEntity,allow_multiple_selection:!1,layout_name:"global_legal_entity",field:"legal_entity_id",set_empty:!0,show_search_inputs:!0}),this.addEditFieldToColumn(n.i18n._("Legal Entity"),i,a,""),i=Global.loadWidgetByName(FormItemType.COMBO_BOX),i.TComboBox({field:"status_id"}),i.setSourceData(e.status_array),this.addEditFieldToColumn(n.i18n._("Status"),i,a),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"name",width:"100%"}),this.addEditFieldToColumn(n.i18n._("Name"),i,a),i.parent().width("45%"),i=Global.loadWidgetByName(FormItemType.TEXT_AREA),i.TTextArea({field:"description",width:"100%"}),this.addEditFieldToColumn(n.i18n._("Description"),i,a),i.parent().width("45%"),i=Global.loadWidgetByName(FormItemType.COMBO_BOX),i.TComboBox({field:"type_id"}),i.setSourceData(e.type_array),this.addEditFieldToColumn(n.i18n._("Type"),i,a),i=Global.loadWidgetByName(FormItemType.COMBO_BOX),i.TComboBox({set_empty:!1,field:"country"}),i.setSourceData(e.country_array),this.addEditFieldToColumn(n.i18n._("Country"),i,a),i=Global.loadWidgetByName(FormItemType.COMBO_BOX),i.TComboBox({set_empty:!1,field:"province"}),i.setSourceData([]),this.addEditFieldToColumn(n.i18n._("Province/State"),i,a,"",null,!0),i=Global.loadWidgetByName(FormItemType.COMBO_BOX),i.TComboBox({set_empty:!1,field:"district"}),i.setSourceData([]),this.addEditFieldToColumn(n.i18n._("District"),i,a,"",null,!0),i=Global.loadWidgetByName(FormItemType.COMBO_BOX),i.TComboBox({set_empty:!1,field:"agency_id"}),i.setSourceData([]),this.addEditFieldToColumn(n.i18n._("Agency"),i,a),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"primary_identification",width:200}),this.addEditFieldToColumn(n.i18n._("Primary Identification"),i,a,"",null,!0),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"secondary_identification",width:200}),this.addEditFieldToColumn(n.i18n._("Secondary Identification"),i,a,"",null,!0),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"tertiary_identification",width:200}),this.addEditFieldToColumn(n.i18n._("Tertiary Identification"),i,a,"",null,!0),this.detachElement("primary_identification"),this.detachElement("secondary_identification"),this.detachElement("tertiary_identification"),i=Global.loadWidgetByName(FormItemType.DATE_PICKER),i.TDatePicker({field:"start_date"}),this.addEditFieldToColumn(n.i18n._("Start Date"),i,_),i=Global.loadWidgetByName(FormItemType.DATE_PICKER),i.TDatePicker({field:"end_date"}),this.addEditFieldToColumn(n.i18n._("End Date"),i,_),i=Global.loadWidgetByName(FormItemType.AWESOME_BOX),i.AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!1,layout_name:"global_user",field:"contact_user_id",set_empty:!0,show_search_inputs:!0}),this.addEditFieldToColumn(n.i18n._("Contact"),i,_,""),i=Global.loadWidgetByName(FormItemType.AWESOME_BOX),i.AComboBox({api_class:TTAPI.APIRemittanceSourceAccount,allow_multiple_selection:!1,layout_name:"global_remittance_source_account",field:"remittance_source_account_id",set_empty:!0,show_search_inputs:!0}),this.addEditFieldToColumn(n.i18n._("Remittance Source Account"),i,_,""),i=Global.loadWidgetByName(FormItemType.COMBO_BOX),i.TComboBox({field:"always_week_day_id"}),i.setSourceData(this.always_week_day_array),this.addEditFieldToColumn(n.i18n._("Events Always On Business Day"),i,_),i=Global.loadWidgetByName(FormItemType.AWESOME_BOX),i.AComboBox({api_class:TTAPI.APIRecurringHoliday,allow_multiple_selection:!0,layout_name:"global_recurring_holiday",show_search_inputs:!0,set_empty:!0,field:"recurring_holiday_policy_id"}),this.addEditFieldToColumn(n.i18n._("Recurring Holidays"),i,_),this.detachElement("province"),this.detachElement("district")}setProvince(e,r){var t=this;!e||e===TTUUID.not_exist_id||e===TTUUID.zero_id?(t.province_array=[],this.adv_search_field_ui_dic.province.setSourceData([]),this.basic_search_field_ui_dic.province.setSourceData([])):this.company_api.getOptions("province",e,{async:!1,onResult:function(a){a=a.getResult(),a||(a=[]),t.province_array=Global.buildRecordArray(a,{label:"-- "+n.i18n._("Other")+" --",value:"00",fullValue:"00",orderValue:-1,id:"00"}),t.adv_search_field_ui_dic.province.setSourceData(t.province_array),t.basic_search_field_ui_dic.province.setSourceData(t.province_array)}})}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:n.i18n._("Legal Entity"),in_column:1,field:"legal_entity_id",layout_name:"global_legal_entity",api_class:TTAPI.APILegalEntity,multiple:!0,basic_search:!0,adv_search:!0,script_name:"LegalEntityView",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:n.i18n._("Status"),in_column:1,field:"status_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:n.i18n._("Name"),in_column:1,field:"name",multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:n.i18n._("Country"),in_column:2,field:"country",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.COMBO_BOX}),new SearchField({label:n.i18n._("Province/State"),in_column:2,field:"province",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:n.i18n._("Created By"),in_column:3,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,script_name:"EmployeeView",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:n.i18n._("Updated By"),in_column:3,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,script_name:"EmployeeView",form_item_type:FormItemType.AWESOME_BOX})]}initSubEventView(){var e=this;if(!this.current_edit_record.id){TTPromise.resolve("BaseViewController","onTabShow");return}if(this.sub_event_view_controller){this.sub_event_view_controller.buildContextMenu(!0),this.sub_event_view_controller.setDefaultMenu(),e.sub_event_view_controller.parent_value=e.current_edit_record.id,e.sub_event_view_controller.parent_edit_record=e.current_edit_record,e.sub_event_view_controller.initData();return}Global.loadScript("views/company/payroll_remittance_agency/PayrollRemittanceAgencyEventViewController.js",function(){if(e.edit_view_tab){var a=e.edit_view_tab.find("#tab_payroll_remittance_agency_event"),_=a.find(".first-column-sub-view");Global.trackView("SubPayrollRemittanceEventView"),PayrollRemittanceAgencyEventViewController.loadSubView(_,r,t)}});function r(){}function t(a){e.sub_event_view_controller=a,e.sub_event_view_controller.parent_key="payroll_remittance_agency_id",e.sub_event_view_controller.parent_value=e.current_edit_record.id,e.sub_event_view_controller.parent_edit_record=e.current_edit_record,e.sub_event_view_controller.parent_view_controller=e,e.sub_event_view_controller.postInit=function(){this.initData()}}}onCancelClick(){super.onCancelClick(),this.sub_event_view_controller=null}onSaveClick(e){super.onSaveClick(e),this.sub_event_view_controller=null}uniformVariable(e){if(e&&(super.collectUIDataToCurrentEditRecord(),this.is_mass_editing!=!0)){e.payroll_remittance_agency_id=this.parent_value,(e.type_id!=30||e.district==TTUUID.not_exist_id||e.district==TTUUID.zero_id||e.district==!1||e.district==null)&&(e.district="00"),(e.type_id<=10||e.province==TTUUID.not_exist_id||e.province==TTUUID.zero_id||e.province==!1||e.province==null)&&(e.province="00");var r="0000";e.agency_id&&(r=e.agency_id.slice(-4)),e.agency_id=e.type_id+":"+e.country+":"+e.province+":"+e.district+":"+r}return e}getPayrollRemittanceAgencyEventTabHtml(){return`<div id="tab_payroll_remittance_agency_event" class="edit-view-tab-outside-sub-view">
					<div class="edit-view-tab" id="tab_payroll_remittance_agency_event_content_div">
						<div class="first-column-sub-view">
						</div>
						<div class="save-and-continue-div">
							<span class="message"></span>
							<div class="save-and-continue-button-div">
								<button class="tt-button p-button p-component" type="button">
									<span class="icon"></span>
									<span class="p-button-label"></span>
								</button>
							</div>
						</div>
					</div>
				</div>`}}export{d as PayrollRemittanceAgencyViewController};
//# sourceMappingURL=PayrollRemittanceAgencyViewController-conWBANJ.bundle.js.map
