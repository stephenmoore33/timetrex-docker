{"version":3,"file":"InvoiceConfigViewController-CE_qfx18.bundle.js","sources":["../../views/invoice/settings/InvoiceConfigViewController.js"],"sourcesContent":["import '@/global/widgets/filebrowser/TImage';\nimport '@/global/widgets/filebrowser/TImageAdvBrowser';\n\nexport class InvoiceConfigViewController extends BaseViewController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\t// _required_files: ['TImageAdvBrowser', 'TImage']\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinit( options ) {\n\n\t\t//this._super('initialize', options );\n\t\tthis.edit_view_tpl = 'InvoiceConfigEditView.html';\n\t\tthis.permission_id = 'invoice_config';\n\t\tthis.viewId = 'InvoiceConfig';\n\t\tthis.script_name = 'InvoiceConfigView';\n\t\tthis.context_menu_name = $.i18n._( 'Preferences' );\n\t\tthis.api = TTAPI.APIInvoiceConfig;\n\n\t\tthis.render();\n\t\tthis.initData();\n\t}\n\n\trender() {\n\t\tsuper.render();\n\t}\n\n\tinitOptions( callBack ) {\n\n\t\tcallBack();\n\t}\n\n\tgetCustomContextMenuModel() {\n\t\tvar context_menu_model = {\n\t\t\texclude: ['default'],\n\t\t\tinclude: [\n\t\t\t\t'save',\n\t\t\t\t'cancel',\n\t\t\t]\n\t\t};\n\n\t\treturn context_menu_model;\n\t}\n\n\tgetInvoiceConfigData( callBack ) {\n\t\tvar $this = this;\n\n\t\t$this.api['get' + $this.api.key_name]( {\n\t\t\tonResult: function( result ) {\n\n\t\t\t\tvar result_data = result.getResult();\n\n\t\t\t\tif ( Global.isArray( result_data ) && Global.isSet( result_data[0] ) ) {\n\t\t\t\t\tcallBack( result_data[0] );\n\t\t\t\t} else {\n\t\t\t\t\t$this.api.getInvoiceConfigDefaultData( {\n\t\t\t\t\t\tonResult: function( result_2 ) {\n\t\t\t\t\t\t\tresult_data = result_2.getResult();\n\t\t\t\t\t\t\tcallBack( result_data );\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tsetCurrentEditRecordData() {\n\t\tfor ( var key in this.current_edit_record ) {\n\t\t\tvar widget = this.edit_view_ui_dic[key];\n\t\t\tif ( Global.isSet( widget ) ) {\n\t\t\t\tswitch ( key ) {\n\t\t\t\t\tdefault:\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t\tthis.file_browser.setImage( ServiceCaller.getURLByObjectType( 'invoice_config' ) );\n\t\tthis.collectUIDataToCurrentEditRecord();\n\t\tthis.setEditViewDataDone();\n\t}\n\n\topenEditView() {\n\t\tvar $this = this;\n\n\t\tif ( $this.edit_only_mode ) {\n\n\t\t\t$this.initOptions( function() {\n\n\t\t\t\t$this.getInvoiceConfigData( function( result_data ) {\n\n\t\t\t\t\t$this.buildContextMenu();\n\t\t\t\t\tTTPromise.add( 'InvoiceConfig', 'openEditView' );\n\n\t\t\t\t\tif ( !$this.edit_view ) {\n\t\t\t\t\t\t$this.initEditViewUI( $this.viewId, $this.edit_view_tpl );\n\t\t\t\t\t}\n\n\t\t\t\t\t// Waiting for the API returns data to set the current edit record.\n\t\t\t\t\t$this.current_edit_record = result_data;\n\n\t\t\t\t\tTTPromise.wait( 'InvoiceConfig', 'openEditView', function() {\n\t\t\t\t\t\t$this.initEditView();\n\t\t\t\t\t} );\n\n\t\t\t\t} );\n\n\t\t\t} );\n\n\t\t}\n\t}\n\n\tonFormItemChange( target, doNotValidate ) {\n\t\tthis.setIsChanged( target );\n\t\tthis.setMassEditingFieldsWhenFormChange( target );\n\n\t\tvar key = target.getField();\n\t\t//this.current_edit_record[key] = target.getValue();\n\t\tvar c_value = target.getValue();\n\n\t\tthis.current_edit_record[key] = c_value;\n\n\t\tif ( !doNotValidate ) {\n\t\t\tthis.validate();\n\t\t}\n\t}\n\n\tsetErrorMenu() {\n\n\t\tvar context_menu_array = ContextMenuManager.getMenuModelByMenuId( this.determineContextMenuMountAttributes().id );\n\t\tvar len = context_menu_array.length;\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tlet context_btn = context_menu_array[i];\n\t\t\tlet id = context_menu_array[i].id;\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\n\t\t\tswitch ( id ) {\n\t\t\t\tcase 'cancel':\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t}\n\t}\n\n\tbuildEditViewUI() {\n\t\tvar $this = this;\n\t\tsuper.buildEditViewUI();\n\n\t\tvar tab_model = {\n\t\t\t'tab_invoice_settings': {\n\t\t\t\t'label': $.i18n._( 'Invoice Settings' )\n\t\t\t},\n\t\t};\n\t\tthis.setTabModel( tab_model );\n\n\t\t//Tab 0 start\n\n\t\tvar tab_invoice_settings = this.edit_view_tab.find( '#tab_invoice_settings' );\n\n\t\tvar tab_invoice_settings_column1 = tab_invoice_settings.find( '.first-column' );\n\n\t\tthis.edit_view_tabs[0] = [];\n\n\t\tthis.edit_view_tabs[0].push( tab_invoice_settings_column1 );\n\n\t\tvar form_item_input;\n\t\t// Logo\n\n\t\tif ( typeof FormData == 'undefined' ) {\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.IMAGE_BROWSER );\n\n\t\t\tthis.file_browser = form_item_input.TImageBrowser( { field: '', default_width: 128, default_height: 128 } );\n\n\t\t\tthis.file_browser.bind( 'imageChange', function( e, target ) {\n\n\t\t\t\tnew ServiceCaller().uploadFile( target.getValue(), 'object_type=invoice_config', {\n\t\t\t\t\tonResult: function( result ) {\n\n\t\t\t\t\t\tif ( result.toLowerCase() === 'true' ) {\n\t\t\t\t\t\t\t$this.file_browser.setImage( ServiceCaller.getURLByObjectType( 'invoice_config' ) );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tTAlertManager.showAlert( result, 'Error' );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t} );\n\t\t} else {\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.IMAGE_AVD_BROWSER );\n\n\t\t\tthis.file_browser = form_item_input.TImageAdvBrowser( {\n\t\t\t\tfield: '', default_width: 128, default_height: 128, callBack: function( form_data ) {\n\t\t\t\t\tnew ServiceCaller().uploadFile( form_data, 'object_type=invoice_config', {\n\t\t\t\t\t\tonResult: function( result ) {\n\n\t\t\t\t\t\t\tif ( result.toLowerCase() === 'true' ) {\n\t\t\t\t\t\t\t\t$this.file_browser.setImage( ServiceCaller.getURLByObjectType( 'invoice_config' ) );\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tTAlertManager.showAlert( result, 'Error' );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Logo' ), form_item_input, tab_invoice_settings_column1, '', null, false, true );\n\n\t\t//SEPARATED_BOX\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.SEPARATED_BOX );\n\t\tform_item_input.SeparatedBox( { label: $.i18n._( 'Display on Invoice' ) } );\n\t\tthis.addEditFieldToColumn( null, form_item_input, tab_invoice_settings_column1 );\n\n\t\t// Company Address\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.CHECKBOX );\n\t\tform_item_input.TCheckbox( { field: 'display_company_address' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Company Address' ), form_item_input, tab_invoice_settings_column1 );\n\n\t\t// Phone\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.CHECKBOX );\n\t\tform_item_input.TCheckbox( { field: 'display_company_work_phone' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Phone' ), form_item_input, tab_invoice_settings_column1 );\n\n\t\t// Fax\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.CHECKBOX );\n\t\tform_item_input.TCheckbox( { field: 'display_company_fax_phone' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Fax' ), form_item_input, tab_invoice_settings_column1 );\n\n\t\t// Part Numbers\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.CHECKBOX );\n\t\tform_item_input.TCheckbox( { field: 'display_part_number' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Part Numbers' ), form_item_input, tab_invoice_settings_column1 );\n\n\t\t//Payment Information\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.CHECKBOX );\n\t\tform_item_input.TCheckbox( { field: 'display_payment' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Payment Information' ), form_item_input, tab_invoice_settings_column1 );\n\n\t\t//Payment Signature\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.CHECKBOX );\n\t\tform_item_input.TCheckbox( { field: 'display_payment_signature' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Payment Signature' ), form_item_input, tab_invoice_settings_column1 );\n\n\t\t// Note\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_AREA );\n\t\tform_item_input.TTextArea( { field: 'note', width: '100%' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Note' ), form_item_input, tab_invoice_settings_column1, '', null, null, true );\n\n\t\tform_item_input.parent().width( '45%' );\n\n\t\t//Invoice Email\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.SEPARATED_BOX );\n\t\tform_item_input.SeparatedBox( { label: $.i18n._( 'Invoice Email' ) } );\n\t\tthis.addEditFieldToColumn( null, form_item_input, tab_invoice_settings_column1 );\n\n\t\t// From Address\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\n\t\tform_item_input.TTextInput( { field: 'email_from' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'From Address' ), form_item_input, tab_invoice_settings_column1 );\n\n\t\t// Bcc Address\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\n\t\tform_item_input.TTextInput( { field: 'email_bcc' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Bcc Address' ), form_item_input, tab_invoice_settings_column1 );\n\n\t\t// Subject\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\n\t\tform_item_input.TTextInput( { field: 'email_subject' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Subject' ), form_item_input, tab_invoice_settings_column1 );\n\n\t\t// Body\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_AREA );\n\t\tform_item_input.TTextArea( { field: 'email_body', width: 400, height: 300 } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Body' ), form_item_input, tab_invoice_settings_column1, '', null, null, true );\n\n\t\tTTPromise.resolve( 'InvoiceConfig', 'openEditView' );\n\t}\n\n}"],"names":["InvoiceConfigViewController","options","_","$","callBack","context_menu_model","$this","result","result_data","result_2","key","widget","target","doNotValidate","c_value","context_menu_array","len","i","context_btn","id","tab_model","tab_invoice_settings","tab_invoice_settings_column1","form_item_input","e","form_data"],"mappings":"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"}