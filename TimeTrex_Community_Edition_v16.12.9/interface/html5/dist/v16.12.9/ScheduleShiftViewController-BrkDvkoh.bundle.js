import{_ as h,j as r}from"./vendor-tTApdY0Y.bundle.js";class b extends BaseViewController{constructor(t={}){h.defaults(t,{el:"#schedule_shift_view_container",schedule_status_array:null,user_status_array:null,user_group_array:null,user_api:null,user_group_api:null,date_api:null,absence_policy_api:null,job_api:null,job_item_api:null,department_api:null,default_punch_tag:[],previous_punch_tag_selection:[],total_time:null,pre_total_time:0,is_mass_adding:!1}),super(t)}init(t){this.edit_view_tpl="ScheduleShiftEditView.html",this.permission_id="schedule",this.viewId="ScheduleShift",this.script_name="ScheduleShiftView",this.table_name_key="schedule",this.context_menu_name=r.i18n._("Schedule Shift"),this.navigation_label=r.i18n._("Schedule"),this.api=TTAPI.APISchedule,this.absence_policy_api=TTAPI.APIAbsencePolicy,this.user_api=TTAPI.APIUser,this.user_group_api=TTAPI.APIUserGroup,Global.getProductEdition()>=20&&(this.job_api=TTAPI.APIJob,this.job_item_api=TTAPI.APIJobItem,this.punch_tag_api=TTAPI.APIPunchTag,this.department_api=TTAPI.APIDepartment),this.date_api=TTAPI.APITTDate,this.initPermission(),this.render(),this.buildContextMenu(),this.initData()}getCustomContextMenuModel(){var t={exclude:["copy"],include:[]};return t}onSaveClick(t){var i=this,e;if(this.is_mass_editing){e=[];var a={};for(var _ in this.edit_view_ui_dic)if(this.edit_view_ui_dic.hasOwnProperty(_)){var s=this.edit_view_ui_dic[_];Global.isSet(s.isChecked)&&s.isChecked()&&s.getEnabled()&&(a[_]=s.getValue())}for(var d=0;d<this.mass_edit_record_ids.length;d++){var n=Global.clone(a);n.id=i.mass_edit_record_ids[d],e.push(n)}}else this.collectUIDataToCurrentEditRecord(),e=this.uniformVariable(this.current_edit_record);this.api["set"+this.api.key_name](e,!1,t,{onResult:function(u){i.onSaveResult(u)}})}validate(){var t=this,i={};if(this.is_mass_editing)for(var i=[],e=0;e<this.mass_edit_record_ids.length;e++){var a={};a.id=t.mass_edit_record_ids[e];for(var _ in this.edit_view_ui_dic)if(this.edit_view_ui_dic.hasOwnProperty(_)){var s=this.edit_view_ui_dic[_];Global.isSet(s.isChecked)&&s.isChecked()&&s.getEnabled()&&(a[_]=s.getValue())}i.push(a)}else this.collectUIDataToCurrentEditRecord(),i=this.uniformVariable(this.current_edit_record);this.api["validate"+this.api.key_name](i,{onResult:function(d){t.validateResult(d)}})}jobUIValidate(t){return t||(t=this.permission_id),!!(PermissionManager.validate("job","enabled")&&PermissionManager.validate(t,"edit_job")&&Global.getProductEdition()>=20)}jobItemUIValidate(t){return t||(t="schedule"),!!(PermissionManager.validate("job_item","enabled")&&PermissionManager.validate(t,"edit_job_item"))}punchTagUIValidate(t){return t||(t="schedule"),!!(PermissionManager.validate("punch_tag","enabled")&&PermissionManager.validate(t,"edit_punch_tag"))}branchUIValidate(t){return t||(t="schedule"),!!PermissionManager.validate(t,"edit_branch")}departmentUIValidate(t){return t||(t="schedule"),!!PermissionManager.validate(t,"edit_department")}initPermission(){super.initPermission(),PermissionManager.validate(this.permission_id,"view")||PermissionManager.validate(this.permission_id,"view_child")?this.show_search_tab=!0:this.show_search_tab=!1,this.jobUIValidate()?this.show_job_ui=!0:this.show_job_ui=!1,this.jobItemUIValidate()?this.show_job_item_ui=!0:this.show_job_item_ui=!1,this.punchTagUIValidate()?this.show_punch_tag_ui=!0:this.show_punch_tag_ui=!1,this.branchUIValidate()?this.show_branch_ui=!0:this.show_branch_ui=!1,this.departmentUIValidate()?this.show_department_ui=!0:this.show_department_ui=!1}initOptions(){var t=this;this.initDropDownOption("status","status_id",this.api,function(i){i=i.getResult(),t.schedule_status_array=Global.buildRecordArray(i)}),this.initDropDownOption("status","user_status_id",this.user_api,function(i){i=i.getResult(),t.user_status_array=Global.buildRecordArray(i)}),this.user_group_api.getUserGroup("",!1,!1,{onResult:function(i){i=i.getResult(),i=Global.buildTreeRecord(i),t.user_group_array=i,t.adv_search_field_ui_dic.group_ids.setSourceData(i)}})}checkOpenPermission(){return!!(Global.getProductEdition()>=15&&PermissionManager.validate("schedule","view_open"))}getCustomFieldReferenceField(){return"note"}buildEditViewUI(){super.buildEditViewUI();var t=this,i={tab_schedule:{label:r.i18n._("Schedule")},tab_audit:!0};this.setTabModel(i);var e,a;this.navigation.AComboBox({api_class:TTAPI.APISchedule,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_schedule_schedule",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation();var _=this.edit_view_tab.find("#tab_schedule"),s=_.find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(s),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!0,layout_name:"global_user",show_search_inputs:!0,set_empty:!this.checkOpenPermission(),set_special_empty:!0,field:"user_id",addition_source_function:function(l,o){return t.onEmployeeSourceCreate(l,o)}});var d={};if(d.permission_section="schedule",e.setDefaultArgs(d),this.addEditFieldToColumn(r.i18n._("Employee"),e,s,""),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"status_id"}),e.setSourceData(t.schedule_status_array),this.addEditFieldToColumn(r.i18n._("Status"),e,s),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIAbsencePolicy,allow_multiple_selection:!1,layout_name:"global_absences",show_search_inputs:!0,set_empty:!0,field:"absence_policy_id"}),e.customSearchFilter=function(l){return t.setAbsencePolicyFilter(l)},this.addEditFieldToColumn(r.i18n._("Absence Policy"),e,s,"",null,!0),e=Global.loadWidgetByName(FormItemType.TEXT),e.TText({field:"available_balance"}),a=r("<div class='widget-h-box available-balance-h-box'></div>"),this.available_balance_info=r('<span class="available-balance-info tticon tticon-info_black_24dp"></span>'),a.append(e),a.append(this.available_balance_info),this.addEditFieldToColumn(r.i18n._("Available Balance"),e,s,"",a,!0),e=Global.loadWidgetByName(FormItemType.DATE_PICKER),e.TDatePicker({field:"start_date_stamp",validation_field:"date_stamp"}),this.addEditFieldToColumn(r.i18n._("Date"),e,s,"",null),e=Global.loadWidgetByName(FormItemType.DATE_PICKER),e.TRangePicker({field:"start_date_stamps",validation_field:"date_stamp"}),this.addEditFieldToColumn(r.i18n._("Date"),e,s,"",null,!0),e=Global.loadWidgetByName(FormItemType.TIME_PICKER),e.TTimePicker({field:"start_time"}),this.addEditFieldToColumn(r.i18n._("In"),e,s,"",null),e=Global.loadWidgetByName(FormItemType.TIME_PICKER),e.TTimePicker({field:"end_time"}),this.addEditFieldToColumn(r.i18n._("Out"),e,s,"",null),e=Global.loadWidgetByName(FormItemType.TEXT),e.TText({field:"total_time"}),this.addEditFieldToColumn(r.i18n._("Total"),e,s),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APISchedulePolicy,allow_multiple_selection:!1,layout_name:"global_schedule",show_search_inputs:!0,set_empty:!0,field:"schedule_policy_id"}),this.addEditFieldToColumn(r.i18n._("Schedule Policy"),e,s),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIBranch,allow_multiple_selection:!1,layout_name:"global_branch",show_search_inputs:!0,set_empty:!0,field:"branch_id",addition_source_function:function(l,o){return t.onSourceDataCreate(l,o)},added_items:[{value:TTUUID.not_exist_id,label:Global.default_item}]}),this.addEditFieldToColumn(r.i18n._("Branch"),e,s,"",null,!0),this.show_branch_ui||this.detachElement("branch_id"),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIDepartment,allow_multiple_selection:!1,layout_name:"global_department",show_search_inputs:!0,set_empty:!0,field:"department_id",addition_source_function:function(l,o){return t.onSourceDataCreate(l,o)},added_items:[{value:TTUUID.not_exist_id,label:Global.default_item}]}),this.addEditFieldToColumn(r.i18n._("Department"),e,s,"",null,!0),this.show_department_ui||this.detachElement("department_id"),Global.getProductEdition()>=20){e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIJob,allow_multiple_selection:!1,layout_name:"global_job",show_search_inputs:!0,set_empty:!0,setRealValueCallBack:function(l){l&&n.setValue(l.manual_id)},field:"job_id",addition_source_function:function(l,o){return t.onSourceDataCreate(l,o)},added_items:[{value:TTUUID.not_exist_id,label:Global.default_item}]}),a=r("<div class='widget-h-box'></div>");var n=Global.loadWidgetByName(FormItemType.TEXT_INPUT);n.TTextInput({field:"job_quick_search",disable_keyup_event:!0}),n.addClass("job-coder"),a.append(n),a.append(e),this.addEditFieldToColumn(r.i18n._("Job"),[e,n],s,"",a,!0),this.show_job_ui||this.detachElement("job_id"),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIJobItem,allow_multiple_selection:!1,layout_name:"global_job_item",show_search_inputs:!0,set_empty:!0,setRealValueCallBack:function(l){l&&u.setValue(l.manual_id)},field:"job_item_id",addition_source_function:function(l,o){return t.onSourceDataCreate(l,o)},added_items:[{value:TTUUID.not_exist_id,label:Global.default_item}]}),a=r("<div class='widget-h-box'></div>");var u=Global.loadWidgetByName(FormItemType.TEXT_INPUT);u.TTextInput({field:"job_item_quick_search",disable_keyup_event:!0}),u.addClass("job-coder"),a.append(u),a.append(e),this.addEditFieldToColumn(r.i18n._("Task"),[e,u],s,"",a,!0),this.show_job_item_ui||this.detachElement("job_item_id"),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIPunchTag,allow_multiple_selection:!0,layout_name:"global_punch_tag",show_search_inputs:!0,set_empty:!0,get_real_data_on_multi:!0,setRealValueCallBack:(l,o)=>{l&&this.setPunchTagQuickSearchManualIds(l,o)},field:"punch_tag_id",addition_source_function:function(l,o){return t.onSourceDataCreate(l,o)},added_items:[{value:TTUUID.not_exist_id,label:Global.default_item}]}),a=r("<div class='widget-h-box'></div>");var c=Global.loadWidgetByName(FormItemType.TEXT_INPUT);c.TTextInput({field:"punch_tag_quick_search",disable_keyup_event:!0}),c.addClass("job-coder"),a.append(c),a.append(e),this.addEditFieldToColumn(r.i18n._("Tags"),[e,c],s,"",a,!0),this.show_punch_tag_ui||this.detachElement("punch_tag_id")}e=Global.loadWidgetByName(FormItemType.TEXT_AREA),e.TTextArea({field:"note",width:"100%"}),this.addEditFieldToColumn(r.i18n._("Note"),e,s,"",null,null,!0),e.parent().width("45%"),Global.getProductEdition()>=15&&this.is_viewing==!1&&(e=Global.loadWidgetByName(FormItemType.CHECKBOX),e.TCheckbox({field:"notify_user_schedule_change"}),this.addEditFieldToColumn(r.i18n._("Notify Employee"),e,s,"",null,!0)),this.is_mass_editing?this.detachElement("total_time"):this.attachElement("total_time")}onSourceDataCreate(t,i){var e=t.getDisplayColumns(),a={};return r.each(e,function(_,s){return a.id=TTUUID.not_exist_id,a[s.name]=Global.default_item,!1}),(!i||r.type(i)!=="array")&&(i=[]),i.unshift(a),i}setEditViewWidgetsMode(){var t={};for(var i in this.edit_view_ui_dic)if(this.edit_view_ui_dic.hasOwnProperty(i)){var e=this.edit_view_ui_dic[i];this.edit_view_form_item_dic[i];var a=e.parent().parent().parent(),_=a.parent().attr("id");switch(a.hasClass("v-box")||t[_]||(t[_]=!0),i){case"start_date_stamps":(!this.current_edit_record.id||this.current_edit_record.id==TTUUID.zero_id)&&!this.is_mass_editing&&!this.is_edit?(this.attachElement(i),e.parents(".edit-view-form-item-div").show()):(this.detachElement(i),e.parents(".edit-view-form-item-div").hide());break;case"start_date_stamp":(!this.current_edit_record.id||this.current_edit_record.id==TTUUID.zero_id)&&!this.is_mass_editing&&!this.is_edit?(this.detachElement(i),e.parents(".edit-view-form-item-div").hide()):(this.attachElement(i),e.parents(".edit-view-form-item-div").show());break;default:e.css("opacity",1);break}this.is_viewing?Global.isSet(e.setEnabled)&&e.setEnabled(!1):Global.isSet(e.setEnabled)&&e.setEnabled(!0)}}exchangeBalance(){var t=r(r(this).next());t.css("display")==="block"?t.css("display","none"):t.css("display")==="none"&&t.css("display","block")}onAddResult(t){var i=this,e=t.getResult();e||(e=[]),e.company=LocalCacheData.current_company.name,i.sub_view_mode&&i.parent_key&&(e[i.parent_key]=i.parent_value),e===!0&&(e={user_id:TTUUID.zero_id}),!e.user_id&&(e.user_id=TTUUID.zero_id),i.current_edit_record=e,i.initEditView()}setAbsencePolicyFilter(t){return t.filter_data||(t.filter_data={}),t.filter_data.user_id=this.current_edit_record.user_id,t.filter_columns&&(t.filter_columns.absence_policy=!0),t}onEmployeeSourceCreate(t,i){if(!this.checkOpenPermission())return i;var e=t.getDisplayColumns(),a={};return r.each(e,function(_,s){return a.id=TTUUID.zero_id,a[s.name]=Global.open_item,!1}),(!i||r.type(i)!=="array")&&(i=[]),i.unshift(a),i}buildSearchFields(){super.buildSearchFields();var t=this;this.search_fields=[new SearchField({label:r.i18n._("Status"),in_column:1,field:"status_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:r.i18n._("Employee"),in_column:1,field:"user_id",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,addition_source_function:function(i,e){return t.onEmployeeSourceCreate(i,e)},adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:r.i18n._("Pay Period"),in_column:1,field:"pay_period_id",layout_name:"global_Pay_period",api_class:TTAPI.APIPayPeriod,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:r.i18n._("Start Date"),in_column:1,field:"start_date",basic_search:!1,adv_search:!0,form_item_type:FormItemType.DATE_PICKER}),new SearchField({label:r.i18n._("End Date"),in_column:1,field:"end_date",basic_search:!1,adv_search:!0,form_item_type:FormItemType.DATE_PICKER}),new SearchField({label:r.i18n._("Employee Status"),in_column:1,field:"user_status_id",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:r.i18n._("Default Branch"),in_column:1,field:"default_branch_id",layout_name:"global_branch",api_class:TTAPI.APIBranch,multiple:!0,basic_search:!1,adv_search:!0,script_name:"BranchView",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:r.i18n._("Default Department"),in_column:1,field:"default_department_id",layout_name:"global_department",api_class:TTAPI.APIDepartment,multiple:!0,basic_search:!1,adv_search:!0,script_name:"DepartmentView",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:r.i18n._("Group"),in_column:2,multiple:!0,field:"group_ids",layout_name:"global_tree_column",tree_mode:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:r.i18n._("Title"),field:"title_id",in_column:2,layout_name:"global_job_title",api_class:TTAPI.APIUserTitle,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:r.i18n._("Job"),in_column:2,field:"job_id",layout_name:"global_job",api_class:Global.getProductEdition()>=20?TTAPI.APIJob:null,multiple:!0,basic_search:!1,adv_search:this.show_job_ui&&Global.getProductEdition()>=20,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:r.i18n._("Task"),in_column:2,field:"job_item_id",layout_name:"global_job_item",api_class:Global.getProductEdition()>=20?TTAPI.APIJobItem:null,multiple:!0,basic_search:!1,adv_search:this.show_job_item_ui&&Global.getProductEdition()>=20,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:r.i18n._("Punch Tags"),in_column:2,field:"punch_tag_id",layout_name:"global_punch_tag",api_class:Global.getProductEdition()>=20?TTAPI.APIPunchTag:null,multiple:!0,basic_search:!1,adv_search:this.show_punch_tag_ui&&Global.getProductEdition()>=20,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:r.i18n._("Schedule Branch"),in_column:2,field:"branch_id",layout_name:"global_branch",api_class:TTAPI.APIBranch,multiple:!0,basic_search:!0,adv_search:!0,script_name:"BranchView",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:r.i18n._("Schedule Department"),in_column:2,field:"department_id",layout_name:"global_department",api_class:TTAPI.APIDepartment,multiple:!0,basic_search:!0,adv_search:!0,script_name:"DepartmentView",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:r.i18n._("Schedule Policy"),in_column:2,field:"schedule_policy_id",layout_name:"global_schedule",api_class:TTAPI.APISchedulePolicy,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX})]}onFormItemChange(t,i){var e=this;this.setIsChanged(t),this.setMassEditingFieldsWhenFormChange(t);var a=t.getField(),_=t.getValue();switch(this.current_edit_record[a]=_,a){case"job_id":Global.getProductEdition()>=20&&(this.edit_view_ui_dic.job_quick_search.setValue(t.getValue(!0)&&t.getValue(!0).manual_id?t.getValue(!0).manual_id:""),this.setJobItemValueWhenJobChanged(t.getValue(!0),"job_item_id",{status_id:10,job_id:this.current_edit_record.job_id}),this.edit_view_ui_dic.job_quick_search.setCheckBox(!0),this.setPunchTagValuesWhenCriteriaChanged(this.getPunchTagFilterData(),"punch_tag_id"));break;case"job_item_id":Global.getProductEdition()>=20&&(this.edit_view_ui_dic.job_item_quick_search.setValue(t.getValue(!0)&&t.getValue(!0).manual_id?t.getValue(!0).manual_id:""),this.edit_view_ui_dic.job_item_quick_search.setCheckBox(!0),this.setPunchTagValuesWhenCriteriaChanged(this.getPunchTagFilterData(),"punch_tag_id"));break;case"punch_tag_id":Global.getProductEdition()>=20&&(_!==TTUUID.zero_id&&_!==!1&&_.length>0?this.setPunchTagQuickSearchManualIds(t.getSelectItems()):this.edit_view_ui_dic.punch_tag_quick_search.setValue(""),e.previous_punch_tag_selection=_,this.edit_view_ui_dic.punch_tag_id.setSourceData(null));break;case"branch_id":Global.getProductEdition()>=20&&(this.setPunchTagValuesWhenCriteriaChanged(this.getPunchTagFilterData(),"punch_tag_id"),this.setJobValueWhenCriteriaChanged("job_id",{status_id:10,user_id:this.current_edit_record.user_id,punch_branch_id:this.current_edit_record.branch_id,punch_department_id:this.current_edit_record.department_id}),this.setDepartmentValueWhenBranchChanged(t.getValue(!0),"department_id",{branch_id:this.current_edit_record.branch_id,user_id:this.current_edit_record.user_id}));break;case"department_id":Global.getProductEdition()>=20&&(this.setPunchTagValuesWhenCriteriaChanged(this.getPunchTagFilterData(),"punch_tag_id"),this.setJobValueWhenCriteriaChanged("job_id",{status_id:10,user_id:this.current_edit_record.user_id,punch_branch_id:this.current_edit_record.branch_id,punch_department_id:this.current_edit_record.department_id}));break;case"job_quick_search":case"job_item_quick_search":Global.getProductEdition()>=20&&(this.onJobQuickSearch(a,_),this.setPunchTagValuesWhenCriteriaChanged(this.getPunchTagFilterData(),"punch_tag_id"),i=!0);break;case"punch_tag_quick_search":Global.getProductEdition()>=20&&(this.onPunchTagQuickSearch(_,this.getPunchTagFilterData(),"punch_tag_id"),i=!0);break;case"absence_policy_id":case"status_id":this.onStatusChange();break;case"user_id":this.edit_view_ui_dic.absence_policy_id.setSourceData(null),this.edit_view_ui_dic.absence_policy_id.setValue(!1),this.current_edit_record.absence_policy_id=!1,this.getAbsencePolicy(this.current_edit_record[a]),r.isArray(this.current_edit_record[a])&&this.current_edit_record[a].length>1?this.is_mass_adding=!0:this.is_mass_adding=!1,this.setEditMenu(),Global.getProductEdition()>=20&&this.setPunchTagValuesWhenCriteriaChanged(this.getPunchTagFilterData(),"punch_tag_id");break}this.getScheduleTotalTime(),this.getProjectedAbsencePolicyBalance(),i||this.validate()}getProjectedAbsencePolicyBalance(){if(r(this.edit_view_form_item_dic.available_balance.find(".schedule-view-balance-info")).css("display","none"),this.current_edit_record.absence_policy_id&&this.edit_view_form_item_dic.absence_policy_id.css("display")==="block"&&!this.is_mass_editing){var t;if(Global.isArray(this.current_edit_record.user_id)&&this.current_edit_record.user_id.length===1)t=this.current_edit_record.user_id[0];else if(this.current_edit_record.user_id)t=this.current_edit_record.user_id;else return;var i=this.current_edit_record.date_stamp,e=this.absence_policy_api.getProjectedAbsencePolicyBalance(this.current_edit_record.absence_policy_id,t,i,this.total_time,this.pre_total_time,{async:!1});e=e||{available_balance:0,current_time:0,remaining_balance:0,projected_balance:0,projected_remaining_balance:0},this.getBalanceHandler(e,i)}this.onStatusChange()}getAbsencePolicy(t){var i={filter_data:{}};i.filter_data.user_id=t,this.edit_view_ui_dic.absence_policy_id.setDefaultArgs(i)}uniformVariable(t){var i=[];if(Global.isArray(t.user_id)&&t.user_id.length>0){var e=t.user_id;for(var a in e){var _=Global.clone(t);_.user_id=e[a],i.push(_)}}else i.push(this.current_edit_record);if(this.current_edit_record.start_date_stamps&&i.length>1){var s=[];for(var d in i){var n=this.uniformDates(i[d].start_date_stamps,i[d]);Array.isArray(i[d].start_date_stamps)?n=i[d].start_date_stamps:n=this.parserDatesRange(i[d].start_date_stamps);for(var u in n){var c={};for(var l in i[d])l!="start_date_stamps"&&(c[l]=i[d][l]);c.start_date_stamp=n[u],c.date_stamp=n[u],s.push(c)}}}else s=this.current_edit_record,r.isArray(s.start_date_stamp)&&s.start_date_stamp.length==1&&(s.start_date_stamp=s.start_date_stamp[0]);return s}parserDatesRange(t){for(var i=t.split(" - "),e=[],a=Global.strToDate(i[0]),_=Global.strToDate(i[1]),s=a;s.getTime()<_.getTime();)e.push(s.format()),s=new Date(new Date(s.getTime()).setDate(s.getDate()+1));return i}uniformDates(t,i){var e=[];return!Array.isArray(t)&&t.indexOf(" - ")==-1?e=[t]:Array.isArray(t)?e=t:e=this.parserDatesRange(t),e}setCurrentEditRecordData(){var t=this;this.setDefaultData({status_id:10}),this.current_edit_record.id||this.is_mass_editing?this.edit_view_ui_dic.user_id.setAllowMultipleSelection(!1):this.edit_view_ui_dic.user_id.setAllowMultipleSelection(!0);for(var i in this.current_edit_record){var e=this.edit_view_ui_dic[i];if(Global.isSet(e)||i==="date_stamp")switch(i){case"start_date_stamp":case"start_date_stamps":if(!this.current_edit_record[i])continue;var a;this.current_edit_record.id?Array.isArray(this.current_edit_record.start_date_stamp)==!1&&(a=[this.current_edit_record.start_date_stamp]):a=this.current_edit_record.start_date_stamps,this.current_edit_record.start_date_stamp=a,e.setValue(a);break;case"total_time":this.pre_total_time=this.is_add?0:this.current_edit_record[i];break;case"job_id":if(Global.getProductEdition()>=20){var _={};_.filter_data={status_id:10,user_id:this.current_edit_record.user_id,punch_branch_id:this.current_edit_record.branch_id,punch_department_id:this.current_edit_record.department_id},e.setDefaultArgs(_),e.setValue(this.current_edit_record[i])}break;case"job_item_id":if(Global.getProductEdition()>=20){var _={};_.filter_data={status_id:10,job_id:this.current_edit_record.job_id},e.setDefaultArgs(_),e.setValue(this.current_edit_record[i])}break;case"punch_tag_id":if(Global.getProductEdition()>=20){e.setValue(this.current_edit_record[i]),this.previous_punch_tag_selection=this.current_edit_record[i];var _={};_.filter_data=t.getPunchTagFilterData(),e.setDefaultArgs(_)}break;case"branch_id":if(Global.getProductEdition()>=20){var _={};_.filter_data={user_id:this.current_edit_record.user_id},e.setDefaultArgs(_)}e.setValue(this.current_edit_record[i]);break;case"department_id":if(Global.getProductEdition()>=20){var _={};_.filter_data={user_id:this.current_edit_record.user_id,branch_id:this.current_edit_record.branch_id},e.setDefaultArgs(_)}e.setValue(this.current_edit_record[i]);break;case"punch_tag_quick_search":break;case"user_id":e.setValue(this.current_edit_record[i]),this.getAbsencePolicy(this.current_edit_record[i]);break;case"date_stamp":this.current_edit_record.start_date_stamp=this.current_edit_record[i],this.current_edit_record.start_date_stamps=this.current_edit_record[i];break;default:e.setValue(this.current_edit_record[i]);break}}this.collectUIDataToCurrentEditRecord(),this.setEditViewDataDone()}getScheduleTotalTime(){if(!this.is_mass_editing){var i,e,t;this.current_edit_record.start_date_stamps?t=this.uniformDates(this.current_edit_record.start_date_stamps,this.current_edit_record)[0]:t=this.current_edit_record.date_stamp;var i=t+" "+this.current_edit_record.start_time,e=t+" "+this.current_edit_record.end_time,a=this.current_edit_record.schedule_policy_id?this.current_edit_record.schedule_policy_id:"";if(a){var _=this.current_edit_record.user_id,s=this.api.getScheduleTotalTime(i,e,a,_,{async:!1});if(s.isValid()&&s.getResult()){this.total_time=s.getResult();var d=Global.getTimeUnit(this.total_time);this.edit_view_ui_dic.total_time.setValue(d),this.current_edit_record.total_time=d}}}}setEditViewDataDone(){super.setEditViewDataDone(),this.onStatusChange(),this.getScheduleTotalTime(),this.setEditViewWidgetsMode(),this.getProjectedAbsencePolicyBalance()}onStatusChange(){this.current_edit_record.status_id==20?(this.attachElement("absence_policy_id"),this.current_edit_record.absence_policy_id&&this.current_edit_record.absence_policy_id!=TTUUID.zero_id?this.attachElement("available_balance"):this.detachElement("available_balance")):(this.detachElement("absence_policy_id"),this.detachElement("available_balance")),this.editFieldResize()}}export{b as ScheduleShiftViewController};
//# sourceMappingURL=ScheduleShiftViewController-BrkDvkoh.bundle.js.map
