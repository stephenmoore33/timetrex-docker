{"version":3,"file":"UserPhotoWizardController-KrqvQB6k.bundle.js","sources":["../../views/wizard/user_photo/UserPhotoWizardController.js"],"sourcesContent":["import '@/global/widgets/filebrowser/TImageBrowser';\nimport '@/global/widgets/filebrowser/CameraBrowser';\nimport '@/global/widgets/filebrowser/TImageAdvBrowser';\nimport '@/global/widgets/filebrowser/TImage';\nimport '@/global/widgets/filebrowser/TImageCutArea';\n\nexport class UserPhotoWizardController extends BaseWizardController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tel: '.wizard-bg',\n\n\t\t\t// _required_files: [\n\t\t\t// \t'TImageBrowser', //only in the upload wizard\n\t\t\t// \t'CameraBrowser', //only in the upload wizard\n\t\t\t// \t'TImageAdvBrowser',//only in the upload wizard\n\t\t\t// \t'TImage',//only in the upload wizard\n\t\t\t// \t'TImageCutArea'//only in the upload wizard\n\t\t\t// ]\n\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinit( options ) {\n\t\t//this._super('initialize', options );\n\n\t\tthis.title = $.i18n._( 'Image Upload Wizard' );\n\t\tthis.steps = 3;\n\t\tthis.current_step = 1;\n\t\tthis.render();\n\t}\n\n\trender() {\n\t\tsuper.render();\n\n\t\tthis.initCurrentStep();\n\t}\n\n\t//Create each page UI\n\tbuildCurrentStepUI() {\n\n\t\tvar $this = this;\n\n\t\tthis.content_div.empty();\n\t\tswitch ( this.current_step ) {\n\t\t\tcase 1:\n\t\t\t\t$this.next_btn.removeClass( 'disable-image' );\n\t\t\t\tvar label = this.getLabel();\n\t\t\t\tlabel.text( $.i18n._( 'Please choose the image source' ) );\n\n\t\t\t\tvar combo_box = this.getComboBox( 'image_type' );\n\n\t\t\t\tcombo_box.setSourceData( [\n\t\t\t\t\t{ value: 'file', label: $.i18n._( 'File' ) },\n\t\t\t\t\t{ value: 'camera', label: $.i18n._( 'Camera' ) }\n\t\t\t\t] );\n\n\t\t\t\tthis.stepsWidgetDic[this.current_step] = {};\n\t\t\t\tthis.stepsWidgetDic[this.current_step][combo_box.getField()] = combo_box;\n\n\t\t\t\tthis.content_div.append( label );\n\t\t\t\tthis.content_div.append( combo_box );\n\n\t\t\t\tthis.removeDropZone();\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tvar step_1_Data = this.stepsDataDic[1];\n\n\t\t\t\tif ( step_1_Data.image_type !== 'camera' ) {\n\t\t\t\t\tGlobal.initFileDragAndDrop( this.$el.find( '.wizard' )[0], ( files ) => {\n\t\t\t\t\t\tthis.attachDragAndDropFile( files );\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t\t\t\tlabel = this.getLabel();\n\t\t\t\tvar img;\n\t\t\t\tif ( step_1_Data.image_type === 'file' ) {\n\t\t\t\t\tlabel.text( $.i18n._( 'Choose image file to upload' ) );\n\t\t\t\t\timg = this.getFileBrowser( 'image_data', null, 500, 350 );\n\t\t\t\t} else {\n\t\t\t\t\tlabel.text( $.i18n._( 'Take picture from camera' ) );\n\t\t\t\t\timg = this.getCameraBrowser( 'image_data' );\n\n\t\t\t\t\timg.unbind( 'NoImageChange' ).bind( 'NoImageChange', function() {\n\t\t\t\t\t\t$this.next_btn.addClass( 'disable-image' );\n\t\t\t\t\t\t// Stop the button glow when 'Try Again' is clicked.\n\t\t\t\t\t\tGlobal.glowAnimation.stop( $this.next_btn );\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t\t\t\timg.unbind( 'change' ).bind( 'change', function() {\n\t\t\t\t\t$this.next_btn.removeClass( 'disable-image' );\n\t\t\t\t\t// Start the button glow when 'Take Picture' or 'Try Again' is clicked.\n\t\t\t\t\tGlobal.glowAnimation.start( $this.next_btn, '#00ff00' );\n\t\t\t\t} );\n\n\t\t\t\tthis.stepsWidgetDic[this.current_step] = {};\n\t\t\t\tthis.stepsWidgetDic[this.current_step][img.getField()] = img;\n\n\t\t\t\tthis.content_div.append( label );\n\t\t\t\tthis.content_div.append( img );\n\t\t\t\t$this.next_btn.addClass( 'disable-image' );\n\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\t\t$this.next_btn.removeClass( 'disable-image' );\n\n\t\t\t\tlabel = this.getLabel();\n\t\t\t\tlabel.text( $.i18n._( 'Crop and resize image' ) );\n\n\t\t\t\timg = this.getImageCutArea( 'image_cut' );\n\t\t\t\tthis.stepsWidgetDic[this.current_step] = {};\n\t\t\t\tthis.stepsWidgetDic[this.current_step][img.getField()] = img;\n\n\t\t\t\tvar hide_form = $( ' <form enctype=\"multipart/form-data\" class=\"browser-form\"></form>' );\n\n\t\t\t\tthis.stepsWidgetDic[this.current_step]['hide_form'] = hide_form;\n\n\t\t\t\tthis.content_div.append( label );\n\t\t\t\tthis.content_div.append( img );\n\t\t\t\tthis.content_div.append( hide_form );\n\n\t\t\t\tthis.removeDropZone();\n\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tbuildCurrentStepData() {\n\t\tvar current_step_data = this.stepsDataDic[this.current_step];\n\t\tvar current_step_ui = this.stepsWidgetDic[this.current_step];\n\n\t\tswitch ( this.current_step ) {\n\t\t\tcase 1:\n\t\t\t\tif ( current_step_data ) {\n\t\t\t\t\tcurrent_step_ui.image_type.setValue( current_step_data.image_type );\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tif ( this.stepsDataDic[1].image_type === 'camera' ) {\n\t\t\t\t\tcurrent_step_ui.image_data.showCamera();\n\t\t\t\t}\n\n\t\t\t\tGlobal.setWidgetEnabled( this.next_btn, false );\n\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\t\tcurrent_step_ui.image_cut.setImage( this.stepsDataDic[2].img_src );\n\t\t}\n\t}\n\n\tonDoneClick() {\n\t\tvar $this = this;\n\t\tsuper.onDoneClick();\n\t\tthis.saveCurrentStep();\n\n\t\tvar current_step_ui = this.stepsWidgetDic[this.current_step];\n\t\tvar current_step_data = this.stepsDataDic[this.current_step];\n\n\t\tvar form_data = new FormData( current_step_ui.hide_form[0] );\n\n\t\tvar image_source_array = current_step_data.after_img_src && current_step_data.after_img_src.split( ',' );\n\n\t\tvar args = {};\n\n\t\t//Error: TypeError: current_step_data.after_img_src is undefined in interface/html5/framework/jquery.min.js?v=9.0.0-20151016-110437 line 2 > eval line 129\n\t\tif ( image_source_array && image_source_array.length > 0 ) {\n\t\t\tform_data.append( 'file_data', image_source_array[1] );\n\t\t\tform_data.append( 'base64_encoded', true );\n\t\t\tform_data.append( 'mime_type', image_source_array[0].split( ';' )[0].split( ':' )[1] );\n\t\t\tform_data.append( 'file_name', this.stepsDataDic[2].file_name );\n\n\t\t\tif ( this.call_back ) {\n\t\t\t\tthis.call_back( form_data );\n\t\t\t}\n\t\t}\n\n\t\t$this.onCloseClick();\n\t}\n\n\tonCloseClick() {\n\t\tvar current_step_ui = this.stepsWidgetDic[this.current_step];\n\t\tif ( this.current_step === 3 ) {\n\t\t\tcurrent_step_ui.image_cut.clearSelect();\n\t\t}\n\n\t\tif ( this.current_step === 2 && this.stepsDataDic[1].image_type === 'camera' ) {\n\t\t\tcurrent_step_ui.image_data.stopCamera();\n\t\t}\n\n\t\t$( this.el ).remove();\n\t\tLocalCacheData.current_open_wizard_controllers = LocalCacheData.current_open_wizard_controllers.filter( wizard => wizard.wizard_id !== this.wizard_id );\n\t}\n\n\tonNextClick() {\n\t\tif ( this.next_btn.hasClass( 'disable-image' ) ) {\n\t\t\treturn;\n\t\t}\n\t\tvar current_step_ui = this.stepsWidgetDic[this.current_step];\n\t\tif ( this.current_step === 3 ) {\n\t\t\tcurrent_step_ui.image_cut.clearSelect();\n\t\t}\n\t\tif ( this.current_step === 2 && this.stepsDataDic[1].image_type === 'camera' ) {\n\t\t\tcurrent_step_ui.image_data.stopCamera();\n\t\t\t// Stop the button glow when 'Next Button' is clicked.\n\t\t\tGlobal.glowAnimation.stop( this.next_btn );\n\t\t}\n\t\tthis.saveCurrentStep();\n\t\tthis.current_step = this.current_step + 1;\n\t\tthis.initCurrentStep();\n\t}\n\n\tonBackClick() {\n\t\tif ( this.back_btn.hasClass( 'disable-image' ) ) {\n\t\t\treturn;\n\t\t}\n\t\tvar current_step_ui = this.stepsWidgetDic[this.current_step];\n\t\tif ( this.current_step === 3 ) {\n\t\t\tcurrent_step_ui.image_cut.clearSelect();\n\t\t}\n\t\tif ( this.current_step === 2 && this.stepsDataDic[1].image_type === 'camera' ) {\n\t\t\tcurrent_step_ui.image_data.stopCamera();\n\t\t\t// Stop the button glow when 'Back Button' is clicked.\n\t\t\tGlobal.glowAnimation.stop( this.next_btn );\n\n\t\t}\n\t\tthis.saveCurrentStep();\n\t\tthis.current_step = this.current_step - 1;\n\t\tthis.initCurrentStep();\n\t}\n\n\tsaveCurrentStep() {\n\t\tthis.stepsDataDic[this.current_step] = {};\n\t\tvar current_step_data = this.stepsDataDic[this.current_step];\n\t\tvar current_step_ui = this.stepsWidgetDic[this.current_step];\n\t\tswitch ( this.current_step ) {\n\t\t\tcase 1:\n\t\t\t\tcurrent_step_data.image_type = current_step_ui.image_type.getValue();\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tcurrent_step_data.img_src = current_step_ui.image_data.getImageSrc();\n\t\t\t\tcurrent_step_data.file_name = current_step_ui.image_data.getFileName();\n\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\n\t\t\t\tcurrent_step_data.after_img_src = current_step_ui.image_cut.getAfterImageSrc();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tsetDefaultDataToSteps() {\n\n\t\tif ( !this.default_data ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tthis.stepsDataDic[2] = {};\n\t\tthis.stepsDataDic[3] = {};\n\n\t\tif ( this.getDefaultData( 'user_id' ) ) {\n\t\t\tthis.stepsDataDic[3].user_id = this.getDefaultData( 'user_id' );\n\t\t}\n\n\t\tif ( this.getDefaultData( 'pay_period_id' ) ) {\n\t\t\tthis.stepsDataDic[2].pay_period_id = this.getDefaultData( 'pay_period_id' );\n\t\t}\n\t}\n\n\t//Remove drop zone so that it doesn't show up on the wrong step.\n\tremoveDropZone() {\n\t\tlet drop_zone = this.$el.find( '.file-drop-zone-highlight' );\n\t\tif ( drop_zone.length > 0 ) {\n\t\t\tdrop_zone.remove();\n\t\t}\n\t}\n\n\tattachDragAndDropFile( files ) {\n\t\t//Only add the first file as each document is a single file.\n\t\tlet data_transfer = new DataTransfer()\n\t\tdata_transfer.items.add( files[0] );\n\n\t\tthis.stepsWidgetDic[2].image_data[0].querySelector( 'input' ).files = data_transfer.files;\n\t\tthis.stepsWidgetDic[2].image_data.trigger( 'change' );\n\t\tthis.stepsWidgetDic[2].image_data.find( 'input' ).trigger( 'change' );\n\t}\n\n}"],"names":["UserPhotoWizardController","options","_","$","$this","label","combo_box","step_1_Data","files","img","hide_form","current_step_data","current_step_ui","form_data","image_source_array","wizard","drop_zone","data_transfer"],"mappings":"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"}