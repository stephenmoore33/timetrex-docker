{"version":3,"file":"CameraBrowser-ZqjxPQAO.bundle.js","sources":["../../global/widgets/filebrowser/CameraBrowser.js"],"sourcesContent":["( function( $ ) {\n\n\t$.fn.CameraBrowser = function( options ) {\n\n\t\tGlobal.addCss( 'global/widgets/filebrowser/TImageBrowser.css' );\n\t\tvar opts = $.extend( {}, $.fn.CameraBrowser.defaults, options );\n\n\t\tvar $this = this;\n\t\tvar field;\n\n\t\tvar enabled = true;\n\t\tvar video = null;\n\t\tvar canvas = null;\n\n\t\tvar local_stream = null;\n\n\t\tthis.stopCamera = function() {\n\n\t\t\tif ( local_stream ) {\n\t\t\t\tif ( local_stream.stop ) {\n\t\t\t\t\t// This is the legacy method to stop video.\n\t\t\t\t\tlocal_stream.stop();\n\t\t\t\t} else if ( local_stream.getTracks ) {\n\t\t\t\t\t// This is the modern approach for stopping the video. https://developer.mozilla.org/en-US/docs/Web/API/MediaStreamTrack/stop\n\t\t\t\t\tlocal_stream.getTracks().forEach( track => track.stop() );\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis.showCamera = function() {\n\n\t\t\t// check for getUserMedia support\n\t\t\tnavigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia || navigator.oGetUserMedia;\n\t\t\tif ( navigator.mediaDevices && navigator.mediaDevices.getUserMedia ) {\n\t\t\t\t// Most up to date as of May 2020 (Aside from using async and await) https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\n\n\t\t\t\t// get webcam feed if available\n\t\t\t\tnavigator.mediaDevices.getUserMedia( { video: true } )\n\t\t\t\t\t.then(function(stream) {\n\t\t\t\t\t\tif ('srcObject' in video) {\n\t\t\t\t\t\t\tvideo.srcObject = stream;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Fallback for older browsers. https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement/srcObject#Supporting_fallback_to_the_src_property\n\t\t\t\t\t\t\tvideo.src = URL.createObjectURL( stream );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvideo.play();\n\t\t\t\t\t\tlocal_stream = stream;\n\t\t\t\t\t})\n\t\t\t\t\t.catch(function(err) {\n\t\t\t\t\t\terrorBack();\n\t\t\t\t\t});\n\t\t\t} else if ( navigator.getUserMedia ) {\n\t\t\t\t// Semi-deprecated, legacy, but still works. https://developer.mozilla.org/en-US/docs/Web/API/Navigator/getUserMedia\n\n\t\t\t\t// get webcam feed if available\n\t\t\t\tnavigator.getUserMedia( { video: true }, function( stream ) {\n\t\t\t\t\tif ('srcObject' in video) {\n\t\t\t\t\t\tvideo.srcObject = stream;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Fallback for older browsers. https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement/srcObject#Supporting_fallback_to_the_src_property\n\t\t\t\t\t\tvideo.src = URL.createObjectURL( stream );\n\t\t\t\t\t}\n\t\t\t\t\tvideo.play();\n\t\t\t\t\tlocal_stream = stream;\n\t\t\t\t}, errorBack );\n\t\t\t} else if ( navigator.webkitGetUserMedia ) { // WebKit-prefixed\n\t\t\t\tnavigator.webkitGetUserMedia( { video: true }, function( stream ) {\n\t\t\t\t\tvideo.src = window.webkitURL.createObjectURL( stream );\n\t\t\t\t\tvideo.play();\n\t\t\t\t\tlocal_stream = stream;\n\t\t\t\t}, errorBack );\n\t\t\t} else if ( navigator.mozGetUserMedia ) { // Firefox-prefixed\n\t\t\t\tnavigator.mozGetUserMedia( { video: true }, function( stream ) {\n\t\t\t\t\tvideo.src = window.URL.createObjectURL( stream );\n\t\t\t\t\tvideo.play();\n\t\t\t\t\tlocal_stream = stream;\n\t\t\t\t}, errorBack );\n\t\t\t} else {\n\t\t\t\terrorBack();\n\t\t\t}\n\n\t\t\tfunction errorBack() {\n\t\t\t\tTAlertManager.showAlert( $.i18n._( 'Unable to access Camera.<br><br>Please check your camera connections, permissions, and ensure you are using HTTPS. Alternatively, use the File upload method instead.' ) );\n\t\t\t}\n\t\t};\n\n\t\tthis.setEnable = function( val ) {\n\t\t\tenabled = val;\n\n\t\t\tvar btn = this.children().eq( 1 );\n\n\t\t\tif ( !val ) {\n\t\t\t\tbtn.attr( 'disabled', true );\n\t\t\t\tbtn.removeClass( 'disable-element' ).addClass( 'disable-element' );\n\t\t\t} else {\n\t\t\t\tbtn.removeAttr( 'disabled' );\n\t\t\t\tbtn.removeClass( 'disable-element' );\n\t\t\t}\n\n\t\t};\n\n\t\tthis.clearErrorStyle = function() {\n\n\t\t};\n\n\t\tthis.getField = function() {\n\t\t\treturn field;\n\t\t};\n\n\t\tthis.getValue = function() {\n\t\t\treturn false;\n\t\t};\n\n\t\tthis.getFileName = function() {\n\t\t\treturn 'camera_stream.png';\n\t\t};\n\n\t\tthis.getImageSrc = function() {\n\t\t\treturn canvas[0].toDataURL();\n\t\t};\n\n\t\tthis.setImage = function( val ) {\n\t\t\tvar image = $this.children().eq( 0 );\n\n\t\t\tif ( !val ) {\n\t\t\t\timage.attr( 'src', '' );\n\t\t\t\timage.hide();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar d = new Date();\n\t\t\timage.hide();\n\t\t\timage.attr( 'src', val + '&t=' + d.getTime() );\n\t\t\timage.css( 'height', 'auto' );\n\t\t\timage.css( 'width', 'auto' );\n\n\t\t};\n\n\t\tthis.onImageLoad = function( image ) {\n\n//\t\t\tvar image_height = $( image ).height() > 0 ? $( image ).height() : image.naturalHeight;\n//\t\t\tvar image_width = $( image ).width() > 0 ? $( image ).width() : image.naturalWidth;\n//\n//\t\t\tif ( image_height > default_height ) {\n//\t\t\t\t$( image ).css( 'height', default_height );\n//\n//\t\t\t}\n//\n//\t\t\tif ( image_width > default_width ) {\n//\t\t\t\t$( image ).css( 'width', default_width );\n//\n//\t\t\t\t$( image ).css( 'height', 'auto' );\n//\t\t\t}\n//\n//\t\t\t$this.trigger( 'setSize' );\n\n\t\t\t$( image ).show();\n\n\t\t};\n\n\t\tthis.setValue = function( val ) {\n\n\t\t\tif ( !val ) {\n\t\t\t\tval = '';\n\t\t\t}\n\n\t\t};\n\n\t\tthis.each( function() {\n\n\t\t\tvar o = $.meta ? $.extend( {}, opts, $( this ).data() ) : opts;\n\n\t\t\tfield = o.field;\n\n\t\t\tvar $$this = this;\n\n\t\t\tvideo = $( this ).children().eq( 0 ).children().eq( 0 )[0];\n\t\t\tcanvas = $( this ).children().eq( 0 ).children().eq( 1 );\n\n\t\t\tvar take_picture = $( this ).children().eq( 1 ).children().eq( 0 );\n\t\t\tvar try_again = $( this ).children().eq( 1 ).children().eq( 1 );\n\n\t\t\t// Set initial states of the buttons.\n\t\t\ttake_picture.prop( 'disabled', false );\n\t\t\ttry_again.prop( 'disabled', true );\n\n\t\t\ttake_picture.bind( 'click', function() {\n\t\t\t\ttake_picture.prop( 'disabled', true );\n\t\t\t\ttry_again.prop( 'disabled', false );\n\t\t\t\t// Global.glowAnimation.start(); // not needed here as its triggered in UserPhotoWizardController.buildCurrentStepUI()\n\n\t\t\t\t// flash the photo area to indicate a picture has been taken.\n\t\t\t\tcanvas.parent().addClass( 'flash' );\n\n\t\t\t\tsetTimeout( function(){\n\t\t\t\t\tcanvas.parent().removeClass( 'flash' );\n\t\t\t\t}, 1000);\t// Timeout must be the same length as the CSS3 transition or longer (or you'll mess up the transition)\n\n\t\t\t\t// handle picture taking\n\t\t\t\tvar ctx = canvas[0].getContext( '2d' );\n\t\t\t\tctx.drawImage( video, 0, 0, 400, 300 );\n\t\t\t\tcanvas.css( 'z-index', 51 );\n\n\t\t\t\t$this.trigger( 'change', [$this] );\n\t\t\t} );\n\n\t\t\ttry_again.bind( 'click', function() {\n\t\t\t\ttake_picture.prop( 'disabled', false );\n\t\t\t\ttry_again.prop( 'disabled', true );\n\t\t\t\tGlobal.glowAnimation.stop();\n\n\t\t\t\tcanvas.css( 'z-index', -1 );\n\n\t\t\t\t$this.trigger( 'NoImageChange', [$this] );\n\t\t\t} );\n\n\t\t} );\n\n\t\treturn this;\n\n\t};\n\n\t$.fn.CameraBrowser.defaults = {};\n\t$.fn.CameraBrowser.html_template = `\n\t<div class=\"file-browser\">\n\t\t<div class=\"video-div\">\n\t\t\t<video class=\"video-display\" width=\"400\" height=\"300\">\n\t\t\t</video>\n\t\t\t<canvas class=\"video-capture\" width=\"400\" height=\"300\">\n\t\t\t</canvas>\n\t\t</div>\n\t\t<div class=\"buttons\">\n\t\t\t<button id=\"take_picture\" class=\"t-button\">Take Picture</button>\n\t\t\t<button id=\"try_again\" class=\"t-button\">Try Again</button>\n\t\t</div>\n\t</div>\n\t`;\n\n} )( jQuery );"],"names":["$","options","opts","$this","field","video","canvas","local_stream","track","stream","err","errorBack","val","btn","image","d","o","take_picture","try_again","ctx","jQuery"],"mappings":"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"}