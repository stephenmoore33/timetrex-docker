{"version":3,"file":"ExpenseAuthorizationViewController-CedoEJ59.bundle.js","sources":["../../views/my_account/expense/ExpenseAuthorizationViewController.js"],"sourcesContent":["import '@/global/widgets/filebrowser/TImageBrowser';\n\nexport class ExpenseAuthorizationViewController extends BaseViewController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tel: '#expense_authorization_view_container',\n\n\t\t\t// _required_files: ['TImageBrowser'],\n\n\t\t\thierarchy_level_array: null,\n\t\t\tstatus_array: null,\n\n\t\t\tpayment_method_array: null,\n\n\t\t\tsub_document_view_controller: null,\n\n\t\t\tdocument_object_type_id: null,\n\n\t\t\trelatedExpenseArray: null,\n\n\t\t\tpunch_tag_api: null,\n\t\t\tdefault_punch_tag: [],\n\t\t\tprevious_punch_tag_selection: [],\n\n\t\t\tdocument_api: null\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinit( options ) {\n\t\t//this._super('initialize', options );\n\t\tthis.edit_view_tpl = 'ExpenseAuthorizationEditView.html';\n\t\tthis.permission_id = 'user_expense';\n\t\tthis.viewId = 'ExpenseAuthorization';\n\t\tthis.script_name = 'ExpenseAuthorizationView';\n\t\tthis.table_name_key = 'user_expense';\n\t\tthis.context_menu_name = $.i18n._( 'Expense (Authorizations)' );\n\t\tthis.navigation_label = $.i18n._( 'Expense' );\n\t\tthis.api = TTAPI.APIUserExpense;\n\t\tthis.message_control_api = TTAPI.APIMessageControl;\n\n\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\tthis.job_api = TTAPI.APIJob;\n\t\t\tthis.job_item_api = TTAPI.APIJobItem;\n\t\t\tthis.punch_tag_api = TTAPI.APIPunchTag;\n\t\t}\n\n\t\tthis.document_api = TTAPI.APIDocument;\n\t\tthis.authorization_api = TTAPI.APIAuthorization;\n\n\t\tthis.document_object_type_id = 400;\n\n\t\tthis.hierarchy_type_id = 200;\n\t\tthis.event_bus = new TTEventBus({ view_id: this.viewId });\n\t\tthis.render();\n\t\tthis.buildContextMenu();\n\n\t\tthis.initData();\n\t}\n\n\tinitOptions() {\n\t\tvar $this = this;\n\n\t\tvar args = {};\n\t\tvar filter_data = {};\n\t\tfilter_data.type_id = [10, 20, 30];\n\t\tfilter_data.user_id = [this.current_edit_record ? this.current_edit_record.user_id : LocalCacheData.getLoginUser().id];\n\n\t\tthis.initDropDownOption( 'status' );\n\t\tthis.initDropDownOption( 'payment_method' );\n\n\t\targs.filter_data = filter_data;\n\n\t\tif ( Global.isSet( $this.basic_search_field_ui_dic['expense_policy_id'] ) ) {\n\t\t\t$this.basic_search_field_ui_dic['expense_policy_id'].setDefaultArgs( args );\n\t\t}\n\n\t\tvar result = this.api.getHierarchyLevelOptions( [-1], { async: false } );\n\t\tif ( result && result.isValid() ) {\n\t\t\tvar data = result.getResult();\n\t\t\t$this['hierarchy_level_array'] = Global.buildRecordArray( data );\n\t\t\tif ( Global.isSet( $this.basic_search_field_ui_dic['hierarchy_level'] ) ) {\n\t\t\t\t$this.basic_search_field_ui_dic['hierarchy_level'].setSourceData( Global.buildRecordArray( data ) );\n\t\t\t}\n\t\t}\n\t}\n\n\tgetSubViewFilter( filter ) {\n\n\t\tif ( filter.length === 0 ) {\n\t\t\tfilter = {};\n\t\t}\n\n\t\tfilter['parent_id'] = 0;\n\t\tif ( !Global.isSet( filter.hierarchy_level ) ) {\n\t\t\tfilter['hierarchy_level'] = 1;\n\t\t\tthis.filter_data['hierarchy_level'] = {\n\t\t\t\tfield: 'hierarchy_level',\n\t\t\t\tid: '',\n\t\t\t\tvalue: this.basic_search_field_ui_dic['hierarchy_level'].getValue( true )\n\t\t\t};\n\t\t}\n\n\t\treturn filter;\n\t}\n\n\tgetFilterColumnsFromDisplayColumns() {\n\t\tvar column_filter = {};\n\t\t//Issue #2897 - The column user_id is required for the navigation icons to function properly while not in edit view.\n\t\tcolumn_filter.user_id = true;\n\n\t\treturn this._getFilterColumnsFromDisplayColumns( column_filter, true );\n\t}\n\n\tgetCustomContextMenuModel() {\n\t\tvar context_menu_model = {\n\t\t\tgroups: {\n\t\t\t\tauthorization: {\n\t\t\t\t\tlabel: $.i18n._( 'Authorization' ),\n\t\t\t\t\tid: this.script_name + 'Authorization'\n\t\t\t\t},\n\t\t\t\tobjects: {\n\t\t\t\t\tlabel: $.i18n._( 'Objects' ),\n\t\t\t\t\tid: this.script_name + 'objects'\n\t\t\t\t}\n\t\t\t},\n\t\t\texclude: ['default'],\n\t\t\tinclude: [\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'View' ),\n\t\t\t\t\tid: 'edit', // copy pasted this value, but 'edit' seems deliberate. clicking this icon opens edit view, not view. Double check before changing.\n\t\t\t\t\tgroup: 'editor',\n\t\t\t\t\tvue_icon: 'tticon tticon-visibility_black_24dp',\n\t\t\t\t\tshow_on_right_click: true,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Cancel' ),\n\t\t\t\t\tid: 'cancel',\n\t\t\t\t\tgroup: 'editor',\n\t\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Authorize' ),\n\t\t\t\t\tid: 'authorization',\n\t\t\t\t\tvue_icon: 'tticon tticon-thumb_up_black_24dp',\n\t\t\t\t\tmenu_align: 'center'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Pass' ),\n\t\t\t\t\tid: 'pass',\n\t\t\t\t\tvue_icon: 'tticon tticon-redo_black_24dp',\n\t\t\t\t\tmenu_align: 'center'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Decline' ),\n\t\t\t\t\tid: 'decline',\n\t\t\t\t\tvue_icon: 'tticon tticon-thumb_down_black_24dp',\n\t\t\t\t\tmenu_align: 'center'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Jump To' ),\n\t\t\t\t\tid: 'jump_to_header',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\taction_group: 'jump_to',\n\t\t\t\t\taction_group_header: true,\n\t\t\t\t\tpermission_result: false // to hide it in legacy context menu and avoid errors in legacy parsers.\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'TimeSheet' ),\n\t\t\t\t\tid: 'timesheet',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\taction_group: 'jump_to',\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Schedule' ),\n\t\t\t\t\tid: 'schedule',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\taction_group: 'jump_to',\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Export' ),\n\t\t\t\t\tid: 'export_excel',\n\t\t\t\t\tgroup: 'other',\n\t\t\t\t\tvue_icon: 'tticon tticon-file_upload_black_24dp',\n\t\t\t\t\tmenu_align: 'right'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Edit Employee' ),\n\t\t\t\t\tid: 'edit_employee',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\taction_group: 'jump_to',\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\treturn context_menu_model;\n\t}\n\n\tsetCustomDefaultMenuIcon( id, context_btn, grid_selected_length ) {\n\t\tswitch ( id ) {\n\t\t\tcase 'authorization':\n\t\t\t\tthis.setDefaultMenuAuthorizationIcon( context_btn, grid_selected_length );\n\t\t\t\tbreak;\n\t\t\tcase 'pass':\n\t\t\t\tthis.setDefaultMenuPassIcon( context_btn, grid_selected_length );\n\t\t\t\tbreak;\n\t\t\tcase 'decline':\n\t\t\t\tthis.setDefaultMenuDeclineIcon( context_btn, grid_selected_length );\n\t\t\t\tbreak;\n\t\t\tcase 'authorization_request':\n\t\t\t\tthis.setDefaultMenuAuthorizationRequestIcon( context_btn, grid_selected_length );\n\t\t\t\tbreak;\n\t\t\tcase 'authorization_timesheet':\n\t\t\t\tthis.setDefaultMenuAuthorizationTimesheetIcon( context_btn, grid_selected_length );\n\t\t\t\tbreak;\n\t\t\tcase 'authorization_expense':\n\t\t\t\tthis.setDefaultMenuAuthorizationExpenseIcon( context_btn, grid_selected_length );\n\t\t\t\tbreak;\n\t\t\tcase 'timesheet':\n\t\t\t\tthis.setDefaultMenuViewIcon( context_btn, grid_selected_length, 'punch' );\n\t\t\t\tbreak;\n\t\t\tcase 'schedule':\n\t\t\t\tthis.setDefaultMenuViewIcon( context_btn, grid_selected_length, 'schedule' );\n\t\t\t\tbreak;\n\t\t\tcase 'edit_employee':\n\t\t\t\tthis.setDefaultMenuEditIcon( context_btn, grid_selected_length );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tsetDefaultMenuEditIcon( context_btn, grid_selected_length ) {\n\n\t\tif ( grid_selected_length === 1 ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t} else {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tsetDefaultMenuSaveIcon( context_btn, grid_selected_length ) {\n\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t}\n\n\tsetDefaultMenuAuthorizationIcon( context_btn, grid_selected_length ) {\n\t\tif ( !this.is_viewing ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\n\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t}\n\n\tsetDefaultMenuPassIcon( context_btn, grid_selected_length ) {\n\t\tif ( !this.is_viewing ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\n\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t}\n\n\tsetDefaultMenuDeclineIcon( context_btn, grid_selected_length ) {\n\t\tif ( !this.is_viewing ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\n\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t}\n\n\tsetCustomEditMenuIcon( id, context_btn ) {\n\t\tswitch ( id ) {\n\t\t\tcase 'authorization':\n\t\t\t\tthis.setEditMenuAuthorizationIcon( context_btn );\n\t\t\t\tbreak;\n\t\t\tcase 'pass':\n\t\t\t\tthis.setEditMenuPassIcon( context_btn );\n\t\t\t\tbreak;\n\t\t\tcase 'decline':\n\t\t\t\tthis.setEditMenuDeclineIcon( context_btn );\n\t\t\t\tbreak;\n\t\t\tcase 'authorization_request':\n\t\t\t\tthis.setEditMenuAuthorizationRequestIcon( context_btn );\n\t\t\t\tbreak;\n\t\t\tcase 'authorization_timesheet':\n\t\t\t\tthis.setEditMenuAuthorizationTimesheetIcon( context_btn );\n\t\t\t\tbreak;\n\t\t\tcase 'authorization_expense':\n\t\t\t\tthis.setEditMenuAuthorizationExpenseIcon( context_btn );\n\t\t\t\tbreak;\n\t\t\tcase 'timesheet':\n\t\t\t\tthis.setEditMenuNavViewIcon( context_btn, 'punch' );\n\t\t\t\tbreak;\n\t\t\tcase 'schedule':\n\t\t\t\tthis.setEditMenuNavViewIcon( context_btn, 'schedule' );\n\t\t\t\tbreak;\n\t\t\tcase 'edit_employee':\n\t\t\t\tthis.setEditMenuNavEditIcon( context_btn, 'user' );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tsetDefaultMenuAuthorizationRequestIcon( context_btn, grid_selected_length ) {\n\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t}\n\n\tsetDefaultMenuAuthorizationTimesheetIcon( context_btn, grid_selected_length ) {\n\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t}\n\n\tsetDefaultMenuAuthorizationExpenseIcon( context_btn, grid_selected_length ) {\n\t\tif ( !( Global.getProductEdition() >= 25 ) ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t}\n\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t}\n\n\tsetEditMenuAuthorizationRequestIcon( context_btn ) {\n\t\tif ( !this.current_edit_record || !this.current_edit_record.id ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t} else {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t}\n\t}\n\n\tsetEditMenuAuthorizationTimesheetIcon( context_btn ) {\n\t\tif ( !this.current_edit_record || !this.current_edit_record.id ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t} else {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t}\n\t}\n\n\tsetEditMenuAuthorizationExpenseIcon( context_btn ) {\n\t\tif ( !this.current_edit_record || !this.current_edit_record.id ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t} else {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t}\n\t}\n\n\tsetEditMenuEditIcon( context_btn ) {\n\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t}\n\n\tsetEditMenuSaveIcon( context_btn ) {\n\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t}\n\n\tsetEditMenuAuthorizationIcon( context_btn ) {\n\t\tif ( !this.current_edit_record || !this.current_edit_record.id ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t} else {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t}\n\t}\n\n\tsetEditMenuPassIcon( context_btn ) {\n\t\tif ( !this.current_edit_record || !this.current_edit_record.id ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t} else {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t}\n\t}\n\n\tsetEditMenuDeclineIcon( context_btn ) {\n\t\tif ( !this.current_edit_record || !this.current_edit_record.id ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t} else {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t}\n\t}\n\n\tonCustomContextClick( id ) {\n\t\tswitch ( id ) {\n\t\t\tcase 'authorization':\n\t\t\t\tthis.onAuthorizationClick();\n\t\t\t\tbreak;\n\t\t\tcase 'pass':\n\t\t\t\tthis.onPassClick();\n\t\t\t\tbreak;\n\t\t\tcase 'decline':\n\t\t\t\tthis.onDeclineClick();\n\t\t\t\tbreak;\n\t\t\tcase 'authorization_request':\n\t\t\t\tthis.onAuthorizationRequestClick();\n\t\t\t\tbreak;\n\t\t\tcase 'authorization_timesheet':\n\t\t\t\tthis.onAuthorizationTimesheetClick();\n\t\t\t\tbreak;\n\t\t\tcase 'authorization_expense':\n\t\t\t\tthis.onAuthorizationExpenseClick();\n\t\t\t\tbreak;\n\t\t\tcase 'timesheet':\n\t\t\tcase 'schedule':\n\t\t\tcase 'edit_employee':\n\t\t\tcase 'export_excel':\n\t\t\t\tthis.onNavigationClick( id );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tonNavigationClick( iconName ) {\n\n\t\tvar $this = this;\n\n\t\tvar grid_selected_id_array;\n\n\t\tvar filter = {};\n\n\t\tvar ids = [];\n\n\t\tvar user_ids = [];\n\n\t\tvar base_date;\n\t\tif ( $this.edit_view && $this.current_edit_record.id ) {\n\t\t\tids.push( $this.current_edit_record.id );\n\t\t\tuser_ids.push( $this.current_edit_record.user_id );\n\t\t\tbase_date = $this.current_edit_record.incurred_date;\n\t\t} else {\n\t\t\tgrid_selected_id_array = this.getGridSelectIdArray();\n\t\t\t$.each( grid_selected_id_array, function( index, value ) {\n\t\t\t\tvar grid_selected_row = $this.getRecordFromGridById( value );\n\t\t\t\tids.push( grid_selected_row.id );\n\t\t\t\tuser_ids.push( grid_selected_row.user_id );\n\t\t\t\tbase_date = grid_selected_row.incurred_date;\n\t\t\t} );\n\t\t}\n\n\t\tswitch ( iconName ) {\n\t\t\tcase 'edit_employee':\n\t\t\t\tif ( user_ids.length > 0 ) {\n\t\t\t\t\tIndexViewController.openEditView( this, $.i18n._( 'Employee' ), user_ids[0] );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'timesheet':\n\t\t\t\tif ( user_ids.length > 0 ) {\n\t\t\t\t\tfilter.user_id = user_ids[0];\n\t\t\t\t\tfilter.base_date = base_date;\n\t\t\t\t\tGlobal.addViewTab( $this.viewId, $.i18n._( 'Authorization - Expense' ), window.location.href );\n\t\t\t\t\tIndexViewController.goToView( 'TimeSheet', filter );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'schedule':\n\t\t\t\tfilter.filter_data = {};\n\t\t\t\tvar include_users = { value: user_ids };\n\t\t\t\tfilter.filter_data.include_user_ids = include_users;\n\t\t\t\tfilter.select_date = base_date;\n\t\t\t\tGlobal.addViewTab( this.viewId, $.i18n._( 'Authorization - Expense' ), window.location.href );\n\t\t\t\tIndexViewController.goToView( 'Schedule', filter );\n\t\t\t\tbreak;\n\t\t\tcase 'export_excel':\n\t\t\t\tthis.onExportClick( 'export' + this.api.key_name );\n\t\t\t\tbreak;\n\n\t\t}\n\t}\n\n\thandleAuthorizationButtons( enable = true ) {\n\t\tif ( enable == true ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, 'authorization', true );\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, 'pass', true );\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, 'decline', true );\n\t\t} else {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, 'authorization', false );\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, 'pass', false );\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, 'decline', false );\n\t\t}\n\t}\n\n\tonAuthorizationExpenseClick() {\n\t\tIndexViewController.goToView( 'ExpenseAuthorization' );\n\t}\n\n\tonAuthorizationTimesheetClick() {\n\t\tIndexViewController.goToView( 'TimeSheetAuthorization' );\n\t}\n\n\tonAuthorizationRequestClick() {\n\t\tIndexViewController.goToView( 'RequestAuthorization' );\n\t}\n\n\tonAuthorizationClick() {\n\t\tvar $this = this;\n\n\t\t//Error: TypeError: $this.current_edit_record is null in /interface/html5/framework/jquery.min.js?v=7.4.6-20141027-074127 line 2 > eval line 629\n\t\tif ( !$this.current_edit_record ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar record = this.current_edit_record;\n\t\trecord = this.uniformVariable( record );\n\n\t\tLocalCacheData.current_doing_context_action = 'authorize';\n\n\t\t$this.handleAuthorizationButtons( false ); //Disable the authorization buttons while the authorization is being processed.\n\n\t\tthis.api['set' + this.api.key_name]( record, false, false, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tif ( result && result.isValid() ) { //Don't try to authorize the expense if validation fails, display the validation errors and stop.\n\t\t\t\t\t$this.setAuthorization( true ); //This re-enables the authorization buttons.\n\t\t\t\t} else {\n\t\t\t\t\t$this.handleAuthorizationButtons( true ); //Enable the authorization buttons while the authorization is being processed.\n\n\t\t\t\t\t$this.setErrorMenu();\n\t\t\t\t\t$this.setErrorTips( result, true );\n\t\t\t\t}\n\t\t\t},\n\t\t\tonError: function( result ) {\n\t\t\t\t$this.handleAuthorizationButtons( true ); //Enable the authorization buttons while the authorization is being processed.\n\t\t\t}\n\t\t} );\n\t}\n\n\tonPassClick() {\n\t\tvar $this = this;\n\t\tthis.onRightArrowClick( function() {\n\t\t\t$this.search();\n\t\t\t$().TFeedback( {\n\t\t\t\tsource: 'Pass'\n\t\t\t} );\n\t\t} );\n\t}\n\n\tonDeclineClick() {\n\t\tthis.setAuthorization( false );\n\t}\n\n\tsetAuthorization( authorized ) {\n\t\tvar $this = this;\n\t\tvar filter = {};\n\n\t\tfilter.authorized = authorized ? authorized : false;\n\t\tfilter.object_id = $this.current_edit_record.id;\n\t\tfilter.object_type_id = 200;\n\n\t\t$this.handleAuthorizationButtons( false ); //Disable the authorization buttons while the authorization is being processed.\n\n\t\t$this.authorization_api['setAuthorization']( [filter], {\n\t\t\tonResult: function( result ) {\n\t\t\t\tif ( result && result.isValid() ) {\n\t\t\t\t\t$this.is_changed = false;\n\t\t\t\t\t$this.updateBadgeCount();\n\t\t\t\t\t$this.onRightArrowClick( function() {\n\t\t\t\t\t\t$this.search( false );\n\t\t\t\t\t\tvar authorization_value = authorized ? 'Authorize' : 'Decline';\n\t\t\t\t\t\t$().TFeedback( {\n\t\t\t\t\t\t\tsource: authorization_value\n\t\t\t\t\t\t} );\n\t\t\t\t\t} );\n\t\t\t\t} else {\n\t\t\t\t\t$this.setErrorMenu();\n\t\t\t\t\t$this.setErrorTips( result, true );\n\t\t\t\t}\n\n\t\t\t\t$this.handleAuthorizationButtons( true ); //Enable the authorization buttons while the authorization is being processed.\n\t\t\t},\n\t\t\tonError: function( result ) {\n\t\t\t\t$this.handleAuthorizationButtons( true ); //Enable the authorization buttons while the authorization is being processed.\n\t\t\t}\n\t\t} );\n\t}\n\n\tbuildEditViewUI() {\n\n\t\tsuper.buildEditViewUI();\n\n\t\tvar $this = this;\n\n\t\tvar tab_model = {\n\t\t\t'tab_expense': {\n\t\t\t\t'label': $.i18n._( 'Expense' ),\n\t\t\t\t'html_template': this.getExpenseAuthorizationTabHtml(),\n\t\t\t\t'is_multi_column': true\n\t\t\t},\n\t\t\t'tab_attachment': true,\n\t\t\t'tab_audit': true,\n\t\t};\n\t\tthis.setTabModel( tab_model );\n\n\t\tthis.navigation.AComboBox( {\n\t\t\tapi_class: TTAPI.APIUserExpense,\n\t\t\tid: this.script_name + '_navigation',\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_expense',\n\t\t\tnavigation_mode: true,\n\t\t\tshow_search_inputs: true\n\t\t} );\n\n\t\tthis.setNavigation();\n\n\t\t//Tab 0 start\n\n\t\tvar tab_expense = this.edit_view_tab.find( '#tab_expense' );\n\n\t\tvar tab_expense_column1 = tab_expense.find( '.first-column' );\n\t\tvar tab_expense_column2 = tab_expense.find( '.second-column' );\n\t\t//var authorization_history_column = tab_expense.find( '.auth-history-column' );\n\n\t\tthis.edit_view_tabs[0] = [];\n\n\t\tthis.edit_view_tabs[0].push( tab_expense_column1 );\n\t\tthis.edit_view_tabs[0].push( tab_expense_column2 );\n\t\t//this.edit_view_tabs[0].push( authorization_history_column );\n\n\t\tvar form_item_input;\n\t\tvar widgetContainer;\n\t\tvar label;\n\n\t\t// Employee\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIUser,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_user',\n\t\t\tfield: 'user_id',\n\t\t\tset_empty: false\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Employee' ), form_item_input, tab_expense_column1, '', null );\n\n\t\t// Date Incurred\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\t\tform_item_input.TDatePicker( { field: 'incurred_date' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Date Incurred' ), form_item_input, tab_expense_column1, '', null );\n\n\t\t// Description\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_AREA );\n\t\tform_item_input.TTextArea( { field: 'description', width: '100%' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Description' ), form_item_input, tab_expense_column1, '', null, null, true );\n\n\t\tform_item_input.parent().width( '45%' );\n\n\t\t// Payment Method\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\n\t\tform_item_input.TComboBox( { field: 'payment_method_id' } );\n\t\tform_item_input.setSourceData( $this.payment_method_array );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Payment Method' ), form_item_input, tab_expense_column1 );\n\n\t\t// Type\n\n\t\tvar args = {};\n\t\tvar filter_data = {};\n\t\tfilter_data.type_id = [10, 20, 30];\n\t\tfilter_data.user_id = [LocalCacheData.getLoginUser().id];\n\n\t\targs.filter_data = filter_data;\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIExpensePolicy,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_expense_policy',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'expense_policy_id'\n\t\t} );\n\n\t\tform_item_input.setDefaultArgs( args );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Type' ), form_item_input, tab_expense_column1 );\n\n\t\t//Amount\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\tform_item_input.TTextInput( { field: 'gross_amount1' } );\n\n\t\twidgetContainer = $( '<div class=\\'widget-h-box \\'></div>' );\n\t\tlabel = $( '<span class=\\'widget-right-label\\'> ' + $.i18n._( 'Reimburse' ) + ' </span>' );\n\n\t\tvar widget_checkbox = Global.loadWidgetByName( FormItemType.CHECKBOX );\n\t\twidget_checkbox.TCheckbox( { field: 'is_reimbursable' } );\n\n\t\twidgetContainer.append( form_item_input );\n\t\twidgetContainer.append( label );\n\t\twidgetContainer.append( widget_checkbox );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Amount' ), [form_item_input, widget_checkbox], tab_expense_column1, '', widgetContainer );\n\n\t\t// Currency\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APICurrency,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_currency',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'currency_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Currency' ), form_item_input, tab_expense_column2, '' );\n\n\t\t//Branch\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIBranch,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_branch',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'branch_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Branch' ), form_item_input, tab_expense_column2 );\n\n\t\t//Department\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIDepartment,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_department',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'department_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Department' ), form_item_input, tab_expense_column2 );\n\n\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t//Job\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIJob,\n\t\t\t\tallow_multiple_selection: false,\n\t\t\t\tlayout_name: 'global_job',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tsetRealValueCallBack: ( function( val ) {\n\n\t\t\t\t\tif ( val ) {\n\t\t\t\t\t\tjob_coder.setValue( val.manual_id );\n\t\t\t\t\t}\n\t\t\t\t} ),\n\t\t\t\tfield: 'job_id'\n\t\t\t} );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\tvar job_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tjob_coder.TTextInput( { field: 'job_quick_search', disable_keyup_event: true } );\n\t\t\tjob_coder.addClass( 'job-coder' );\n\n\t\t\twidgetContainer.append( job_coder );\n\t\t\twidgetContainer.append( form_item_input );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Job' ), [form_item_input, job_coder], tab_expense_column2, '', widgetContainer );\n\n\t\t\t// Task\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIJobItem,\n\t\t\t\tallow_multiple_selection: false,\n\t\t\t\tlayout_name: 'global_job_item',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tsetRealValueCallBack: ( function( val ) {\n\n\t\t\t\t\tif ( val ) {\n\t\t\t\t\t\tjob_item_coder.setValue( val.manual_id );\n\t\t\t\t\t}\n\t\t\t\t} ),\n\t\t\t\tfield: 'job_item_id'\n\t\t\t} );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\tvar job_item_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tjob_item_coder.TTextInput( { field: 'job_item_quick_search', disable_keyup_event: true } );\n\t\t\tjob_item_coder.addClass( 'job-coder' );\n\n\t\t\twidgetContainer.append( job_item_coder );\n\t\t\twidgetContainer.append( form_item_input );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Task' ), [form_item_input, job_item_coder], tab_expense_column2, '', widgetContainer );\n\n\t\t\t//Punch Tag\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIPunchTag,\n\t\t\t\tallow_multiple_selection: true,\n\t\t\t\tlayout_name: 'global_punch_tag',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tget_real_data_on_multi: true,\n\t\t\t\tsetRealValueCallBack: ( ( punch_tags, get_real_data ) => {\n\t\t\t\t\tif ( punch_tags ) {\n\t\t\t\t\t\tthis.setPunchTagQuickSearchManualIds( punch_tags, get_real_data );\n\t\t\t\t\t}\n\t\t\t\t} ),\n\t\t\t\tfield: 'punch_tag_id'\n\t\t\t} );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\tvar punch_tag_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tpunch_tag_coder.TTextInput( { field: 'punch_tag_quick_search', disable_keyup_event: true } );\n\t\t\tpunch_tag_coder.addClass( 'job-coder' );\n\n\t\t\twidgetContainer.append( punch_tag_coder );\n\t\t\twidgetContainer.append( form_item_input );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Punch Tags' ), [form_item_input, punch_tag_coder], tab_expense_column2, '', widgetContainer, true );\n\n\t\t}\n\t\t//Tags\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TAG_INPUT );\n\n\t\tform_item_input.TTagInput( { field: 'tag', object_type_id: 930 } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Tags' ), form_item_input, tab_expense_column2, '', null, null, true );\n\n\t\t//Inside editor\n\n\t\tvar inside_editor_div = tab_expense.find( '.inside-editor-div' );\n\n\t\tvar inside_editor_args = {\n\t\t\tname: $.i18n._( 'Attachment Name' ),\n\t\t\taction: $.i18n._( 'Action' )\n\t\t};\n\n\t\tthis.editor = Global.loadWidgetByName( FormItemType.INSIDE_EDITOR );\n\t\tthis.editor.InsideEditor( {\n\t\t\taddRow: this.insideEditorAddRow,\n\t\t\tremoveRow: this.insideEditorRemoveRow,\n\t\t\tgetValue: this.insideEditorGetValue,\n\t\t\tsetValue: this.insideEditorSetValue,\n\t\t\tparent_controller: this,\n\t\t\tapi: this.document_api,\n\t\t\trender: getRender(),\n\t\t\trender_args: inside_editor_args,\n\t\t\trender_inline_html: true,\n\t\t\trow_render: getRowRender(),\n\n\t\t} );\n\n\t\tfunction getRender() {\n\t\t\treturn `\n\t\t\t<table class=\"inside-editor-render\">\n\t\t\t\t<tr class=\"title\" style=\"font-weight: bold\">\n\t\t\t\t\t<td style=\"width: 400px\"><%= name %></td>\n\t\t\t\t\t<td style=\"width: 300px\"><%= action %></td>\n\t\t\t\t</tr>\n\t\t\t</table>`;\n\t\t}\n\n\t\tfunction getRowRender() {\n\t\t\treturn `\n\t\t\t<tr class=\"inside-editor-row data-row\">\n\t\t\t\t<td></td>\n\t\t\t\t<td></td>\n\t\t\t\t<td class=\"cell control-icon\">\n\t\t\t\t\t<button class=\"plus-icon\" onclick=\"\"></button>\n\t\t\t\t</td>\n\t\t\t\t<td class=\"cell control-icon\">\n\t\t\t\t\t<button class=\"minus-icon \" onclick=\"\"></button>\n\t\t\t\t</td>\n\t\t\t</tr>`;\n\t\t}\n\n\t\tinside_editor_div.append( this.editor );\n\t}\n\n\tbuildSearchFields() {\n\n\t\tsuper.buildSearchFields();\n\t\tthis.search_fields = [\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Type' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'expense_policy_id',\n\t\t\t\tlayout_name: 'global_expense_policy',\n\t\t\t\tapi_class: TTAPI.APIExpensePolicy,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Tags' ),\n\t\t\t\tfield: 'tag',\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tin_column: 1,\n\t\t\t\tobject_type_id: 930,\n\t\t\t\tform_item_type: FormItemType.TAG_INPUT\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Hierarchy Level' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tmultiple: false,\n\t\t\t\tset_any: false,\n\t\t\t\tfield: 'hierarchy_level',\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tlayout_name: 'global_option_column',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} )\n\t\t];\n\t}\n\n\tsearch( set_default_menu, page_action, page_number, callBack ) {\n\t\tthis.updateBadgeCount();\n\t\tsuper.search( set_default_menu, page_action, page_number, callBack );\n\t}\n\n\tupdateBadgeCount() {\n\t\tthis.event_bus.emit( 'tt_topbar', 'profile_pending_counts', { //Update \"My Profile\" badge.\n\t\t\tobject_types: [ 'notification', 'expense_authorization' ]\n\t\t} );\n\t}\n\n\tcalcRelatedExpenses( override_expense_policy_id = null, override_amount = null ) {\n\t\t//This is also in ExpenseAuthorizationViewController.js\n\t\tvar $this = this;\n\n\t\tthis.current_edit_record['gross_amount1'] = ( this.current_edit_record['gross_amount1'] ? this.current_edit_record['gross_amount1'] : this.current_edit_record['gross_amount'] );\n\n\t\tvar amount_arr = this.relatedExpenseArray ? this.relatedExpenseArray : false;\n\n\t\tif ( override_expense_policy_id !== null && override_amount !== null && amount_arr['taxes'] && amount_arr['taxes'][override_expense_policy_id] ) {\n\t\t\tamount_arr['taxes'][override_expense_policy_id]['amount'] = override_amount;\n\t\t}\n\n\t\tthis.api['calcRelatedExpenses'](\n\t\t\tthis.current_edit_record['expense_policy_id'], this.current_edit_record['gross_amount1'], amount_arr, this.current_edit_record['is_reimbursable'],\n\t\t\t{\n\t\t\t\tonResult: function( res ) {\n\t\t\t\t\t$this.relatedExpenseArray = res.getResult();\n\t\t\t\t\t$this.setRelatedExpense( $this.relatedExpenseArray );\n\t\t\t\t}\n\t\t\t} );\n\n\t\treturn true;\n\t}\n\n\tonExpensePolicyChange() {\n\t\tvar expense_policies = this.edit_view_ui_dic['expense_policy_id'].getSourceData();\n\n\t\tvar unit_name = $.i18n._( 'Amount' );\n\t\tfor ( var n in expense_policies ) {\n\t\t\tif ( expense_policies[n].type_id == 30 && expense_policies[n].id == this.edit_view_ui_dic['expense_policy_id'].getValue() && expense_policies[n].unit_name && expense_policies[n].unit_name.length > 0 ) {\n\t\t\t\tunit_name = expense_policies[n].unit_name;\n\t\t\t}\n\t\t}\n\t\tthis.edit_view_ui_dic['gross_amount1'].parents( '.edit-view-form-item-div' ).find( '.edit-view-form-item-label' ).html( unit_name );\n\n\t\tthis.calcRelatedExpenses();\n\t}\n\n\t/* jshint ignore:start */\n\tsetCurrentEditRecordData() {\n\t\tvar $this = this;\n\t\t//Set current edit record data to all widgets\n\t\tfor ( var key in this.current_edit_record ) {\n\n\t\t\tif ( !this.current_edit_record.hasOwnProperty( key ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar widget = this.edit_view_ui_dic[key];\n\n\t\t\tif ( Global.isSet( widget ) ) {\n\t\t\t\tswitch ( key ) {\n\t\t\t\t\tcase 'user_id':\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\twidget.setEnabled( false );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'gross_amount1':\n\t\t\t\t\t\twidget.setValue( this.current_edit_record['gross_amount'] );\n\t\t\t\t\t\t//this.onFormItemChange(widget); //This causes onFormItemChange() to trigger for gross_amount1, causing the related expense policies to be recalculated when the view appears. So if the user specified custom taxes they will get wiped out.\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'gross_amount':\n\t\t\t\t\tcase 'net_amount':\n\t\t\t\t\t\t// Don't do anything.\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_id':\n\t\t\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_item_id':\n\t\t\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\t\t\tvar args = {};\n\t\t\t\t\t\t\targs.filter_data = { job_id: this.current_edit_record.job_id };\n\t\t\t\t\t\t\twidget.setDefaultArgs( args );\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'punch_tag_id':\n\t\t\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t\tthis.previous_punch_tag_selection = this.current_edit_record[key];\n\n\t\t\t\t\t\t\tvar args = {};\n\t\t\t\t\t\t\targs.filter_data = $this.getPunchTagFilterData();\n\t\t\t\t\t\t\twidget.setDefaultArgs( args );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'punch_tag_quick_search':\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_quick_search':\n//\t\t\t\t\t\twidget.setValue( this.current_edit_record['job_id'] ? this.current_edit_record['job_id'] : 0 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_item_quick_search':\n//\t\t\t\t\t\twidget.setValue( this.current_edit_record['job_item_id'] ? this.current_edit_record['job_item_id'] : 0 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t\tthis.collectUIDataToCurrentEditRecord();\n\n\t\tthis.setEditViewDataDone();\n\t}\n\n\t/* jshint ignore:end */\n\n\tsetEditViewDataDone() {\n\t\tsuper.setEditViewDataDone();\n\t\tvar $this = this;\n\t\tthis.is_changed = false;\n\n\t\tif ( Global.isSet( this.current_edit_record['related_expenses'] ) ) {\n\t\t\tthis.relatedExpenseArray = this.current_edit_record['related_expenses'];\n\t\t\tthis.setRelatedExpense( this.current_edit_record['related_expenses'] );\n\t\t}\n\n\t\tthis.initInsideEditorData();\n\t\tAuthorizationHistory.init( this );\n\n\t\tGlobal.initFileDragAndDrop( this.edit_view[0].firstElementChild, ( files ) => {\n\t\t\tthis.attachDragAndDropFiles( files );\n\t\t} );\n\t}\n\n\tinitInsideEditorData() {\n\t\tvar $this = this;\n\t\tvar args = {};\n\t\targs.filter_data = {};\n\n\t\tif ( !this.current_edit_record || !this.current_edit_record.id ) {\n\t\t\t$this.editor.removeAllRows();\n\t\t\t$this.editor.getDefaultData();\n\t\t} else {\n\n\t\t\targs.filter_data.object_type_id = this.document_object_type_id;\n\t\t\targs.filter_data.object_id = this.current_edit_record['id'];\n\n\t\t\t$this.api['getAttachment']( args, {\n\t\t\t\tonResult: function( res ) {\n\n\t\t\t\t\tif ( !$this.edit_view ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tvar data = res.getResult();\n\t\t\t\t\t$this.editor.setValue( data );\n\n\t\t\t\t}\n\t\t\t} );\n\n\t\t}\n\t}\n\n\tinsideEditorSetValue( val ) {\n\t\tvar len = val.length;\n\t\tthis.removeAllRows();\n\n\t\tif ( len > 0 ) {\n\t\t\tfor ( var i = 0; i < val.length; i++ ) {\n\t\t\t\tif ( Global.isSet( val[i] ) ) {\n\t\t\t\t\tvar row = val[i];\n\t\t\t\t\tthis.addRow( row );\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthis.getDefaultData();\n\t\t}\n\t}\n\n\tinsideEditorGetValue() {\n\n\t\tvar len = this.rows_widgets_array.length;\n\n\t\tvar result = [];\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar row = this.rows_widgets_array[i];\n\t\t\tif ( Global.isSet( row.file ) ) {\n\t\t\t\tvar data = {\n\t\t\t\t\tname: row.name.getValue(),\n\t\t\t\t\tfile: row.file.getValue()\n\t\t\t\t};\n\n\t\t\t\tif ( data.name === 'No File Selected' ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tresult.push( data );\n\t\t\t}\n\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tinsideEditorAddRow( data, index ) {\n\n\t\tif ( !data ) {\n\t\t\tthis.getDefaultData( index );\n\t\t} else {\n\t\t\tvar row = this.getRowRender(); //Get Row render\n\t\t\tvar render = this.getRender(); //get render, should be a table\n\t\t\tvar widgets = {}; //Save each row's widgets\n\n\t\t\t//Build row widgets\n\n\t\t\t// Attachment Name\n\t\t\tvar form_item_file_name = Global.loadWidgetByName( FormItemType.TEXT );\n\t\t\tform_item_file_name.TText( { field: 'name', width: 400 } );\n\t\t\tform_item_file_name.setValue( data.name ? data.name : $.i18n._( 'No File Selected' ) );\n\t\t\tform_item_file_name.setClassStyle( data.name ? { 'font-weight': 'bold' } : null );\n\t\t\twidgets[form_item_file_name.getField()] = form_item_file_name;\n\t\t\trow.children().eq( 0 ).append( form_item_file_name );\n\t\t\tform_item_file_name.attr( 'document_id', ( data.id && this.parent_controller.current_edit_record.id ) ? data.id : '' );\n\t\t\tform_item_file_name.attr( 'document_revision_id', ( data.document_revision_id && this.parent_controller.current_edit_record.id ) ? data.document_revision_id : '' );\n\n\t\t\t// Action\n\t\t\tif ( data.name ) {\n\n\t\t\t\tvar widgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\t\t\t\tvar download = $( '<button type=\\'button\\' class=\\' download-button t-button widget-right-label\\'>' + $.i18n._( 'Download' ) + '</button>' );\n\t\t\t\tvar view = $( '<button type=\\'button\\' class=\\' view-button t-button widget-right-label\\'>' + $.i18n._( 'View' ) + '</button>' );\n\n\t\t\t\tdownload.attr( {\n\t\t\t\t\tdocument_id: data.id,\n\t\t\t\t\tdocument_revision_id: data.document_revision_id,\n\t\t\t\t\tobject_type_id: this.parent_controller.document_object_type_id\n\t\t\t\t} );\n\t\t\t\tview.attr( {\n\t\t\t\t\tdocument_id: data.id,\n\t\t\t\t\tdocument_revision_id: data.document_revision_id,\n\t\t\t\t\tobject_type_id: this.parent_controller.document_object_type_id\n\t\t\t\t} );\n\n\t\t\t\tdownload.bind( 'click', this.parent_controller.downloadFile );\n\t\t\t\tview.bind( 'click', this.parent_controller.downloadFile );\n\n\t\t\t\twidgetContainer.append( download );\n\t\t\t\twidgetContainer.append( view );\n\n\t\t\t\trow.children().eq( 1 ).append( widgetContainer );\n\t\t\t} else {\n\t\t\t\tvar form_item_file = Global.loadWidgetByName( FormItemType.FILE_BROWSER );\n\n\t\t\t\tvar $this = this.file_browser = form_item_file.TImageBrowser( {\n\t\t\t\t\t\tfield: 'file',\n\t\t\t\t\t\tname: 'file_data',\n\t\t\t\t\t\taccept_filter: '*',\n\t\t\t\t\t\tchangeHandler: function( a ) {\n\t\t\t\t\t\t\tvar file_name = $( this ).find( '.browser' )[0].files[0].name;\n\t\t\t\t\t\t\tform_item_file_name.setValue( file_name );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\twidgets[form_item_file.getField()] = form_item_file;\n\t\t\t\trow.children().eq( 1 ).append( form_item_file );\n\n\t\t\t}\n\n\t\t\t// end\n\n\t\t\tif ( typeof index != 'undefined' ) {\n\n\t\t\t\trow.insertAfter( $( render ).find( 'tr' ).eq( index ) );\n\t\t\t\tthis.rows_widgets_array.splice( ( index ), 0, widgets );\n\n\t\t\t} else {\n\t\t\t\t$( render ).append( row );\n\t\t\t\tthis.rows_widgets_array.push( widgets );\n\t\t\t}\n\n\t\t\tif ( this.parent_controller.is_viewing ) {\n\t\t\t\trow.find( '.control-icon' ).hide();\n\t\t\t}\n\n\t\t\tthis.addIconsEvent( row ); //Bind event to add and minus icon\n\t\t\tthis.removeLastRowLine();\n\t\t}\n\t}\n\n\tdownloadFile() {\n\n\t\tvar $this = $( this );\n\t\tvar document_attachment_id = $this.attr( 'document_id' );\n\t\tvar document_revision_id = $this.attr( 'document_revision_id' );\n\t\tvar object_type_id = $this.attr( 'object_type_id' );\n\n\t\tvar url = ServiceCaller.getURLByObjectType( 'file_download' ) + '&object_type=document&parent_id=' + document_attachment_id + '&parent_object_type_id=' + object_type_id + '&object_id=' + document_revision_id;\n\n\t\tGlobal.APIFileDownload( null, null, null, url );\n\t}\n\n\tinsideEditorRemoveRow( row ) {\n\n\t\tvar $this = this;\n\t\tvar index = row[0].rowIndex - 1;\n\t\tvar remove_id = this.rows_widgets_array[index].name.attr( 'document_id' );\n\t\tif ( TTUUID.isUUID( remove_id ) && remove_id != TTUUID.zero_id && remove_id != TTUUID.not_exist_id ) {\n\t\t\tTAlertManager.showConfirmAlert( $.i18n._( 'Are you sure you want to remove' ) + ': ' + this.rows_widgets_array[index].name.text() + '?', null, function( result ) {\n\t\t\t\tif ( result ) {\n\t\t\t\t\tProgressBar.showOverlay();\n\t\t\t\t\t$this.api['delete' + $this.api.key_name]( remove_id, {\n\t\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\t\tProgressBar.closeOverlay();\n\t\t\t\t\t\t\tif ( result && result.isValid() ) {\n\t\t\t\t\t\t\t\trow.remove();\n\t\t\t\t\t\t\t\t$this.rows_widgets_array.splice( index, 1 );\n\t\t\t\t\t\t\t\tif ( $this.rows_widgets_array.length === 0 ) {\n\t\t\t\t\t\t\t\t\t$this.getDefaultData();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t} );\n\t\t} else {\n\t\t\trow.remove();\n\t\t\t$this.rows_widgets_array.splice( index, 1 );\n\t\t}\n\n\t\tthis.removeLastRowLine();\n\t}\n\n\t/* jshint ignore:start */\n\tonFormItemChange( target, doNotValidate ) {\n\t\tvar $this = this;\n\n\t\tthis.setIsChanged( target );\n\t\tthis.setMassEditingFieldsWhenFormChange( target );\n\n\t\tvar key = target.getField();\n\t\tvar c_value = target.getValue();\n\n\t\tthis.current_edit_record[key] = c_value;\n\n\t\tvar amount_arr = false;\n\n\t\tswitch ( key ) {\n\t\t\tcase 'expense_policy_id':\n\t\t\t\tthis.onExpensePolicyChange();\n\t\t\t\tbreak;\n\t\t\tcase 'gross_amount1':\n\t\t\t\tthis.calcRelatedExpenses();\n\t\t\t\tbreak;\n\t\t\tcase 'is_reimbursable':\n\t\t\t\tthis.calcRelatedExpenses();\n\t\t\t\tbreak;\n\t\t\tcase 'amount':\n\t\t\t\tthis.calcRelatedExpenses( target.attr( 'id' ), c_value ); //When a related expense amount is changed, we need to pass that through so the net amount can be updated.\n\t\t\t\tbreak;\n\t\t\tcase 'job_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.edit_view_ui_dic['job_quick_search'].setValue( target.getValue( true ) ? ( target.getValue( true ).manual_id ? target.getValue( true ).manual_id : '' ) : '' );\n\t\t\t\t\tthis.setJobItemValueWhenJobChanged( target.getValue( true ), 'job_item_id', { job_id: this.current_edit_record.job_id } );\n\t\t\t\t\tthis.edit_view_ui_dic['job_quick_search'].setCheckBox( true );\n\t\t\t\t\tthis.setPunchTagValuesWhenCriteriaChanged( this.getPunchTagFilterData(), 'punch_tag_id' );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'job_item_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.edit_view_ui_dic['job_item_quick_search'].setValue( target.getValue( true ) ? ( target.getValue( true ).manual_id ? target.getValue( true ).manual_id : '' ) : '' );\n\t\t\t\t\tthis.edit_view_ui_dic['job_item_quick_search'].setCheckBox( true );\n\t\t\t\t\tthis.setPunchTagValuesWhenCriteriaChanged( this.getPunchTagFilterData(), 'punch_tag_id' );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'punch_tag_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tif ( c_value !== TTUUID.zero_id && c_value !== false && c_value.length > 0 ) {\n\t\t\t\t\t\tthis.setPunchTagQuickSearchManualIds( target.getSelectItems() );\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.edit_view_ui_dic['punch_tag_quick_search'].setValue( '' );\n\t\t\t\t\t}\n\t\t\t\t\t$this.previous_punch_tag_selection = c_value;\n\t\t\t\t\t//Reset source data to make sure correct punch tags are always shown.\n\t\t\t\t\tthis.edit_view_ui_dic['punch_tag_id'].setSourceData( null );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'user_id':\n\t\t\tcase 'branch_id':\n\t\t\tcase 'department_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.setPunchTagValuesWhenCriteriaChanged( this.getPunchTagFilterData(), 'punch_tag_id' );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'job_quick_search':\n\t\t\tcase 'job_item_quick_search':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.onJobQuickSearch( key, c_value );\n\n\t\t\t\t\t//Don't validate immediately as onJobQuickSearch is doing async API calls, and it would cause a guaranteed validation failure.\n\t\t\t\t\tdoNotValidate = true;\n\t\t\t\t\tthis.setPunchTagValuesWhenCriteriaChanged( this.getPunchTagFilterData(), 'punch_tag_id' );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'punch_tag_quick_search':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.onPunchTagQuickSearch( c_value, this.getPunchTagFilterData(), 'punch_tag_id' );\n\n\t\t\t\t\t//Don't validate immediately as onPunchTagQuickSearch is doing async API calls, and it would cause a guaranteed validation failure.\n\t\t\t\t\tdoNotValidate = true;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif ( !doNotValidate ) {\n\t\t\tthis.validate();\n\t\t}\n\t}\n\n\t/* jshint ignore:end */\n\n\t/**\n\t * this just sets the subform data\n\t * should be called in most cases\n\t *\n\t * @param expenses\n\t */\n\tsetRelatedExpenseData( expenses, selected_related_expense_policy_id ) {\n\t\tvar tab_expense = this.edit_view_tab.find( '#tab_expense' );\n\t\tvar tab_expense_column3 = tab_expense.find( '.third-column' );\n\n\t\ttab_expense_column3.find( '#net_amount' ).val( expenses['net_amount'] );\n\t\ttab_expense_column3.find( '#gross_amount' ).val( expenses['gross_amount'] );\n\t\ttab_expense_column3.find( '#reimburse_amount' ).val( expenses['reimburse_amount'] );\n\n\t\tvar tax_inputs = tab_expense_column3.find( '.tax_input' );\n\t\tfor ( var n = 0; n < tax_inputs.length; n++ ) {\n\t\t\tvar el = $( tax_inputs[n] );\n\t\t\tif ( el.length > 0 ) {\n\t\t\t\tvar id = el.attr( 'id' );\n\t\t\t\tif ( !selected_related_expense_policy_id || selected_related_expense_policy_id != id ) {\n\t\t\t\t\tel.val( expenses['taxes'][id].amount );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn;\n\t}\n\n\t/**\n\t * rebuilds the entire subform ui\n\t * we need to call this when type changes or reimburse is checked to add and remove fields\n\t *\n\t * @param expenses\n\t */\n\tsetRelatedExpense( expenses ) {\n\n\t\t// Third column start\n\t\tvar tab_expense = this.edit_view_tab.find( '#tab_expense' );\n\t\tvar tab_expense_column3 = tab_expense.find( '.third-column' ).empty();\n\n\t\tif ( this.edit_view_tabs[0].length < 3 ) {\n\t\t\tthis.edit_view_tabs[0].push( tab_expense_column3 );\n\t\t}\n\n\t\tif ( !expenses ) {\n\t\t\texpenses = { net_amount: 0, gross_amount: 0, reimburse_amount: this.current_edit_record.reimburse_amount };\n\t\t}\n\n\t\tif ( expenses && expenses['taxes'] && Object.keys( expenses['taxes'] ).length > 0 ) {\n\t\t\t// Net Amount\n\t\t\tvar form_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tform_item_input.TTextInput( { field: 'net_amount' } );\n\t\t\tform_item_input.setValue( expenses['net_amount'] );\n\t\t\tform_item_input.attr( 'id', 'net_amount' );\n\t\t\tform_item_input.setEnabled( false );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Net Amount' ), form_item_input, tab_expense_column3, '', null, true );\n\n\t\t\tthis.edit_view_ui_dic['net_amount'].css( 'opacity', 1 );\n\n\t\t\tif ( expenses['taxes'] ) {\n\t\t\t\tfor ( var key in expenses['taxes'] ) {\n\t\t\t\t\tvar item = expenses['taxes'][key];\n\n\t\t\t\t\t// taxes\n\t\t\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\t\t\tform_item_input.TTextInput( { field: 'amount' } );\n\t\t\t\t\tform_item_input.setValue( item['amount'] );\n\t\t\t\t\tform_item_input.attr( 'id', item['expense_policy_id'] );\n\t\t\t\t\tform_item_input.addClass( 'tax_input' );\n\t\t\t\t\tthis.addEditFieldToColumn( $.i18n._( item['expense_policy_name'] ), form_item_input, tab_expense_column3, '', null, true );\n\n\t\t\t\t\tthis.edit_view_ui_dic['amount'].css( 'opacity', 1 );\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Amount\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\t\tform_item_input.TText( { field: 'gross_amount' } );\n\t\t\tform_item_input.setValue( expenses['gross_amount'] );\n\t\t\tform_item_input.attr( 'id', 'gross_amount' );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Amount' ), form_item_input, tab_expense_column3, '', null, true );\n\n\t\t\tthis.edit_view_ui_dic['gross_amount'].css( 'opacity', 1 );\n\t\t}\n\n\t\t// Reimburse Amount\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\tform_item_input.TText( { field: 'reimburse_amount' } );\n\t\tform_item_input.setValue( expenses['reimburse_amount'] );\n\t\tform_item_input.attr( 'id', 'reimburse_amount' );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Reimburse Amount' ), form_item_input, tab_expense_column3, '', null, true );\n\n\t\tthis.edit_view_ui_dic['reimburse_amount'].css( 'opacity', 1 );\n\n\t\tthis.editFieldResize( 0 );\n\t}\n\n\tuniformVariable( records ) {\n\t\tif ( this.relatedExpenseArray ) {\n\t\t\trecords.related_expenses = this.relatedExpenseArray;\n\t\t\trecords.gross_amount = this.relatedExpenseArray.gross_amount;\n\t\t\trecords.net_amount = this.relatedExpenseArray.net_amount;\n\t\t\trecords.reimburse_amount = this.relatedExpenseArray.reimburse_amount;\n\t\t}\n\n\t\treturn records;\n\t}\n\n\t// onSaveAndContinueResult( result ) {\n\t//\n\t// \tvar $this = this;\n\t// \tif ( result.isValid() ) {\n\t// \t\tvar result_data = result.getResult();\n\t// \t\tif ( result_data === true ) {\n\t// \t\t\t$this.refresh_id = $this.current_edit_record.id;\n\t//\n\t// \t\t} else if ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) { // as new\n\t// \t\t\t$this.refresh_id = result_data;\n\t// \t\t}\n\t//\n\t// \t\t$this.saveInsideEditorData( function() {\n\t// \t\t\t$this.search( false );\n\t// \t\t\t$this.onEditClick( $this.refresh_id, true );\n\t//\n\t// \t\t\t$this.onSaveAndContinueDone( result );\n\t//\n\t// \t\t} );\n\t//\n\t// \t} else {\n\t// \t\t$this.setErrorTips( result );\n\t// \t\t$this.setErrorMenu();\n\t// \t}\n\t// },\n\n\t// onSaveAndNewResult: function( result ) {\n\t// \tvar $this = this;\n\t// \tif ( result.isValid() ) {\n\t// \t\tvar result_data = result.getResult();\n\t// \t\tif ( result_data === true ) {\n\t// \t\t\t$this.refresh_id = $this.current_edit_record.id;\n\t//\n\t// \t\t} else if ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) { // as new\n\t// \t\t\t$this.refresh_id = result_data;\n\t// \t\t}\n\t//\n\t// \t\t$this.saveInsideEditorData( function() {\n\t// \t\t\t$this.search( false );\n\t// \t\t\t$this.onAddClick( true );\n\t//\n\t// \t\t} );\n\t// \t} else {\n\t// \t\t$this.setErrorTips( result );\n\t// \t\t$this.setErrorMenu();\n\t// \t}\n\t// },\n\n\tonCancelClick( force_no_confirm, cancel_all, callback ) {\n\t\t//Refresh grid on cancel as its not done during authorize/decline anymore.\n\t\tvar $this = this;\n\t\tsuper.onCancelClick( force_no_confirm, cancel_all, function() {\n\t\t\t//Since we are overriding the callback function to call this.search(), make sure the original callback is still called.\n\t\t\tif ( callback ) {\n\t\t\t\tcallback();\n\t\t\t}\n\n\t\t\t$this.search();\n\t\t} );\n\t}\n\n\tonSaveAndCopyResult( result ) {\n\t\tvar $this = this;\n\t\tif ( result && result.isValid() ) {\n\t\t\tvar result_data = result.getResult();\n\t\t\tif ( result_data === true ) {\n\t\t\t\t$this.refresh_id = $this.current_edit_record.id;\n\n\t\t\t} else if ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) {\n\t\t\t\t$this.refresh_id = result_data;\n\t\t\t}\n\n\t\t\t$this.saveInsideEditorData( function() {\n\t\t\t\t$this.search( false );\n\n\t\t\t\t$this.onCopyAsNewClick();\n\n\t\t\t} );\n\n\t\t} else {\n\t\t\t$this.setErrorTips( result );\n\t\t\t$this.setErrorMenu();\n\t\t}\n\t}\n\n\tonSaveResult( result ) {\n\t\tvar $this = this;\n\t\tif ( result && result.isValid() ) {\n\t\t\tvar result_data = result.getResult();\n\t\t\tif ( result_data === true ) {\n\t\t\t\t$this.refresh_id = $this.current_edit_record.id;\n\t\t\t} else if ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) {\n\t\t\t\t$this.refresh_id = result_data;\n\t\t\t}\n\n\t\t\t$this.saveInsideEditorData( function() {\n\t\t\t\t$this.search( false );\n\t\t\t} );\n\n\t\t} else {\n\t\t\t$this.setErrorMenu();\n\t\t\t$this.setErrorTips( result );\n\n\t\t}\n\t}\n\n\t/* jshint ignore:start */\n\tsaveInsideEditorData( callBack ) {\n\t\tvar $this = this;\n\t\tvar data = this.editor.getValue();\n\t\tvar files = data.length;\n\t\tif ( files > 0 ) {\n\t\t\tvar success = 0;\n\t\t\tfor ( var key in data ) {\n\t\t\t\tvar fileItem = data[key];\n\t\t\t\tif ( Global.isSet( fileItem.file ) ) {\n\n\t\t\t\t\tvar document_revision_id = this.api.addAttachment( fileItem.name, this.document_object_type_id, this.refresh_id, { async: false } ).getResult();\n\t\t\t\t\t$this.api.uploadFile( fileItem.file, 'object_type=document_revision&object_id=' + document_revision_id + '&parent_object_type_id=' + this.document_object_type_id, {} );\n\n\t\t\t\t\tsuccess++;\n\n\t\t\t\t} else {\n\t\t\t\t\tcallBack();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( success === files ) {\n\t\t\t\tcallBack();\n\t\t\t}\n\n\t\t} else {\n\t\t\tcallBack();\n\t\t}\n\t}\n\n\t/* jshint ignore:end */\n\n\tuploadFile( document_result, file_data ) {\n\t\tvar document_revision_id = document_result.getResult();\n\t\tvar $this = this;\n\n\t\t$this.api.uploadFile( file_data, 'object_type=document_revision&object_id=' + document_revision_id, {\n\t\t\tonResult: function( upload_file_result ) {\n\t\t\t}\n\t\t} );\n\t}\n\n\tattachDragAndDropFiles( files ) {\n\t\tfor ( let file of files ) {\n\t\t\t//If every inside editor row already has a file, add a new row.\n\t\t\t//Adding an empty row triggers an API call to get the default data. So we need to wait for that to finish before adding the file.\n\t\t\tif ( this.editor.rows_widgets_array.every( row => !row.hasOwnProperty( 'file' ) || row.file[0].querySelector( 'input' ).files.length > 0 ) ) {\n\t\t\t\tthis.editor.getDefaultData( null, () => {\n\t\t\t\t\tthis.attachFileToEmptyRow( file );\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\t//There is an empty row already\n\t\t\t\tthis.attachFileToEmptyRow( file );\n\t\t\t}\n\t\t}\n\t}\n\n\tattachFileToEmptyRow( file ) {\n\t\t//Add the current file to the data transfer object\n\t\tlet data_transfer = new DataTransfer();\n\t\tdata_transfer.items.add( file );\n\n\t\t//Attach to the first inside editor row that doesn't have a file\n\t\tfor ( let row of this.editor.rows_widgets_array ) {\n\t\t\t//If editing an existing expense, the row will not have a file property and we can skip it.\n\t\t\tif ( !row.hasOwnProperty( 'file' ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t//Check if the row has a file attached\n\t\t\tlet file_input = row.file[0].querySelector( 'input' );\n\t\t\tif ( file_input.files.length === 0 ) {\n\t\t\t\tfile_input.files = data_transfer.files;\n\t\t\t\trow.name.setValue( file.name );\n\t\t\t\t$( file_input ).trigger( 'change' );\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tgetExpenseAuthorizationTabHtml() {\n\t\treturn `<div id=\"tab_expense\" class=\"edit-view-tab-outside\">\n\t\t\t\t\t<div class=\"edit-view-tab\" id=\"tab_expense_content_div\">\n\t\t\t\t\t\t<div class=\"first-column\"></div>\n\t\t\t\t\t\t<div class=\"second-column\"></div>\n\t\t\t\t\t\t<div class=\"third-column full-width-column border-column\"></div>\n\t\t\t\t\t\t<div class=\"inside-editor-div full-width-column\"></div>\n\t\t\t\t\t\t<div class=\"auth-history-column\">\n\t\t\t\t\t\t\t<div class=\"authorization-grid-div inside-grid full-width-column\">\n\t\t\t\t\t\t\t\t<div class=\"grid-top-border\"></div>\n\t\t\t\t\t\t\t\t<div class=\"grid-title separated-box\"></div>\n\t\t\t\t\t\t\t\t<table id=\"grid\"></table>\n\t\t\t\t\t\t\t\t<div class=\"bottom-div\">\n\t\t\t\t\t\t\t\t\t<div class=\"grid-bottom-border\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>`;\n\t}\n}\n"],"names":["ExpenseAuthorizationViewController","options","_","$","$this","args","filter_data","result","data","filter","column_filter","context_menu_model","id","context_btn","grid_selected_length","iconName","grid_selected_id_array","ids","user_ids","base_date","index","value","grid_selected_row","include_users","enable","record","authorized","authorization_value","tab_model","tab_expense","tab_expense_column1","tab_expense_column2","form_item_input","widgetContainer","label","widget_checkbox","val","job_coder","job_item_coder","punch_tags","get_real_data","punch_tag_coder","inside_editor_div","inside_editor_args","getRender","getRowRender","set_default_menu","page_action","page_number","callBack","override_expense_policy_id","override_amount","amount_arr","res","expense_policies","unit_name","n","key","widget","files","len","row","render","widgets","form_item_file_name","download","view","form_item_file","a","file_name","document_attachment_id","document_revision_id","object_type_id","url","remove_id","target","doNotValidate","c_value","expenses","selected_related_expense_policy_id","tab_expense_column3","tax_inputs","el","item","records","force_no_confirm","cancel_all","callback","result_data","success","fileItem","document_result","file_data","upload_file_result","file","data_transfer","file_input"],"mappings":"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"}