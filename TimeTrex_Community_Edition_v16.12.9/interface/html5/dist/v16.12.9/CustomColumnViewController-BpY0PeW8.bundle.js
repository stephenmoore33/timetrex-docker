import{_ as d,j as l}from"./vendor-tTApdY0Y.bundle.js";import"./FormulaBuilder-C7dDDUu-.bundle.js";class b extends BaseViewController{constructor(e={}){d.defaults(e,{el:"#custom_column_view_container",sub_report_schedule_view_controller:null,type_array:null,format_array:null,exclude_columns_array:null,include_columns_array:null}),super(e)}init(e){this.edit_view_tpl="CustomColumnEditView.html",this.permission_id="report",this.viewId="CustomColumn",this.script_name="CustomColumnView",this.context_menu_name=l.i18n._("Custom Column"),this.navigation_label=l.i18n._("Custom Column"),this.table_name_key="report_custom_column",this.api=TTAPI.APIReportCustomColumn,this.render(),this.sub_view_mode?this.buildContextMenu(!0):(this.buildContextMenu(),this.sub_view_mode||this.initData())}getCustomContextMenuModel(){var e={exclude:["mass_edit"],include:[]};return this.sub_view_mode&&e.exclude.push("view"),e}buildEditViewUI(){super.buildEditViewUI();var e=this,o={tab_custom_column:{label:l.i18n._("Custom Column")},tab_audit:!0};this.setTabModel(o),this.edit_only_mode||(this.navigation.AComboBox({api_class:TTAPI.APIUserReportData,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_branch",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation());var n=this.edit_view_tab.find("#tab_custom_column"),i=n.find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(i);var t=Global.loadWidgetByName(FormItemType.TEXT_INPUT);t.TTextInput({field:"name",width:"100%"}),this.addEditFieldToColumn(l.i18n._("Name"),t,i,""),t.parent().width("45%"),t=Global.loadWidgetByName(FormItemType.TEXT_AREA),t.TTextInput({field:"description",width:"100%"}),this.addEditFieldToColumn(l.i18n._("Description"),t,i,"",null,null,!0),t.parent().width("45%"),t=Global.loadWidgetByName(FormItemType.COMBO_BOX),t.TComboBox({field:"type_id",set_empty:!1}),t.setSourceData(e.type_array),this.addEditFieldToColumn(l.i18n._("Type"),t,i),t=Global.loadWidgetByName(FormItemType.COMBO_BOX),t.TComboBox({field:"format_id"}),t.setSourceData(e.format_array),this.addEditFieldToColumn(l.i18n._("Format"),t,i),t=Global.loadWidgetByName(FormItemType.AWESOME_BOX),t=t.AComboBox({field:"include_columns",set_empty:!0,allow_multiple_selection:!0,layout_name:"global_option_column",key:"value"}),t.setSourceData(e.include_columns_array),this.addEditFieldToColumn(l.i18n._("Include Columns"),t,i,"",null,!0),t=Global.loadWidgetByName(FormItemType.AWESOME_BOX),t=t.AComboBox({field:"exclude_columns",set_empty:!0,allow_multiple_selection:!0,layout_name:"global_option_column",key:"value"}),t.setSourceData(e.exclude_columns_array),this.addEditFieldToColumn(l.i18n._("Exclude Columns"),t,i,"",null,!0),t=Global.loadWidgetByName(FormItemType.FORMULA_BUILDER),t.FormulaBuilder({field:"formula",width:"100%",onFormulaBtnClick:function(){var s=LocalCacheData.current_open_report_controller.api;e.api.getOptions("formula_functions",{onResult:function(m){var c=m.getResult();e.current_edit_record.type_id==30||e.current_edit_record.type_id==31?s.getOptions("filter_columns",{onResult:u}):s.getOptions("formula_columns",{onResult:u});function u(h){var p=h.getResult(),a={};a.functions=Global.buildRecordArray(c),a.variables=Global.buildRecordArray(p),a.formula=e.current_edit_record.formula,a.current_edit_record=Global.clone(e.current_edit_record),a.api=e.api,IndexViewController.openWizard("FormulaBuilderWizard",a,function(_){e.current_edit_record.formula=_,e.edit_view_ui_dic.formula.setValue(_)})}}})}}),e.addEditFieldToColumn(l.i18n._("Formula"),t,i,"",null,!0,!0),t.parent().width("45%"),e.detachElement("formula")}onFormItemChange(e,o){this.setIsChanged(e),this.setMassEditingFieldsWhenFormChange(e);var n=e.getField(),i=e.getValue();switch(this.current_edit_record[n]=i,n){case"type_id":this.onTypeChange();break}o||this.validate()}onAddClick(){super.onAddClick();var e=this;TTPromise.wait(null,null,function(){e.collectUIDataToCurrentEditRecord(),e.onTypeChange()})}onTypeChange(){var e;((e=this.current_edit_record)==null?void 0:e.type_id)==10?(this.detachElement("formula"),this.attachElement("exclude_columns"),this.attachElement("include_columns")):(this.attachElement("formula"),this.detachElement("exclude_columns"),this.detachElement("include_columns"))}setEditViewDataDone(){super.setEditViewDataDone(),this.onTypeChange()}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:l.i18n._("Name"),in_column:1,field:"name",multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:l.i18n._("Description"),field:"description",basic_search:!0,adv_search:!1,in_column:1,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:l.i18n._("Created By"),in_column:2,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,script_name:"EmployeeView",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:l.i18n._("Updated By"),in_column:2,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,script_name:"EmployeeView",form_item_type:FormItemType.AWESOME_BOX})]}getGridSetup(){var e=this,o={container_selector:this.sub_view_mode?"#tab_custom_columns":"body",sub_grid_mode:this.sub_view_mode,onSelectRow:function(){e.onGridSelectRow()},onCellSelect:function(){e.onGridSelectRow()},onSelectAll:function(){e.onGridSelectAll()},ondblClickRow:function(n){e.onGridDblClickRow(n)},onRightClickRow:function(n){var i=e.getGridSelectIdArray();i.indexOf(n)<0&&(e.grid.grid.resetSelection(),e.grid.grid.setSelection(n),e.onGridSelectRow())}};return this.sub_view_mode&&(o.setGridSize=function(){e.sub_view_mode&&e.baseViewSubTabGridResize("#tab_custom_columns")},o.onResizeGrid=function(){e.sub_view_mode&&e.baseViewSubTabGridResize("#tab_custom_columns")}),o}openEditView(){this.edit_view||this.initEditViewUI(this.viewId,this.edit_view_tpl),this.sub_view_mode&&(this.parent_view_controller.need_refresh_display_columns=!0)}initOptions(e){var o=this;this.initDropDownOption("type"),this.initDropDownOption("format"),this.initDropDownOption("dynamic_columns","dynamic_columns",this.parent_view_controller.api,function(n){var i=n.getResult();o.include_columns_array=Global.buildRecordArray(i),o.exclude_columns_array=Global.buildRecordArray(i)})}onDeleteDone(e){this.parent_view_controller.need_refresh_display_columns=!0,this.removeDeletedRows()}onDeleteAndNextDone(e){this.parent_view_controller.need_refresh_display_columns=!0}searchDone(){l("window").trigger("resize"),this.sub_view_mode&&TTPromise.resolve("SubCustomColumnView","init"),super.searchDone()}}b.loadSubView=function(r,e,o){Global.loadViewSource("CustomColumn","SubCustomColumnView.html",function(n){var i={},t=d.template(n);Global.isSet(e)&&e(),Global.isSet(r)&&(r.html(t(i)),Global.isSet(o)&&TTPromise.wait("BaseViewController","initialize",function(){o(window.sub_custom_column_view_controller)}))})};export{b as CustomColumnViewController};
//# sourceMappingURL=CustomColumnViewController-BpY0PeW8.bundle.js.map
