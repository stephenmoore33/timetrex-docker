{"version":3,"file":"PermissionWizardController-BB4kNJjI.bundle.js","sources":["../../views/wizard/permission_wizard/PermissionWizardController.js"],"sourcesContent":["export class PermissionWizardController extends BaseWizardController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tel: '.wizard-bg',\n\t\t\tapi_permission: null\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinit( options ) {\n\t\t//this._super('initialize', options );\n\n\t\tthis.title = $.i18n._( 'Permission Wizard' );\n\t\tthis.steps = 3;\n\t\tthis.current_step = 1;\n\n\t\tthis.render();\n\t}\n\n\trender() {\n\t\tsuper.render();\n\t\tthis.api_permission = TTAPI.APIPermission;\n\t\tthis.initCurrentStep();\n\t}\n\n\t//Create each page UI\n\tbuildCurrentStepUI() {\n\t\tvar $this = this;\n\t\tthis.content_div.empty();\n\n\t\tthis.stepsWidgetDic[this.current_step] = {};\n\t\tswitch ( this.current_step ) {\n\t\t\tcase 1:\n\t\t\t\tvar label = this.getLabel();\n\t\t\t\tlabel.text( $.i18n._( 'Choose role and permission actions' ) );\n\n\t\t\t\tthis.content_div.append( label );\n\n\t\t\t\t//Role\n\t\t\t\tvar form_item = $( Global.loadWidget( 'global/widgets/wizard_form_item/WizardFormItem.html' ) );\n\t\t\t\tvar form_item_label = form_item.find( '.form-item-label' );\n\t\t\t\tvar form_item_input_div = form_item.find( '.form-item-input-div' );\n\n\t\t\t\tvar combobox = this.getComboBox( 'role', false );\n\n\t\t\t\tform_item_label.text( $.i18n._( 'Role' ) );\n\t\t\t\tform_item_input_div.append( combobox );\n\n\t\t\t\tthis.content_div.append( form_item );\n\n\t\t\t\t//Permission\n\t\t\t\tform_item = $( Global.loadWidget( 'global/widgets/wizard_form_item/WizardFormItem.html' ) );\n\t\t\t\tform_item_label = form_item.find( '.form-item-label' );\n\t\t\t\tform_item_input_div = form_item.find( '.form-item-input-div' );\n\n\t\t\t\tvar permission = this.getAComboBox( null, true, 'global_option_column', 'permission', false, 'value' );\n\n\t\t\t\tform_item_label.text( $.i18n._( 'Permissions' ) );\n\t\t\t\tform_item_input_div.append( permission );\n\n\t\t\t\tthis.content_div.append( form_item );\n\n\t\t\t\tthis.stepsWidgetDic[this.current_step][combobox.getField()] = combobox;\n\t\t\t\tthis.stepsWidgetDic[this.current_step][permission.getField()] = permission;\n\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\n\t\t\t\tlabel = this.getLabel();\n\t\t\t\tlabel.text( $.i18n._( 'Choose modules and sub-modules' ) );\n\n\t\t\t\tthis.content_div.append( label );\n\n\t\t\t\t//Modules\n\t\t\t\tform_item = $( Global.loadWidget( 'global/widgets/wizard_form_item/WizardFormItem.html' ) );\n\t\t\t\tform_item_label = form_item.find( '.form-item-label' );\n\t\t\t\tform_item_input_div = form_item.find( '.form-item-input-div' );\n\n\t\t\t\tvar modules = this.getAComboBox( null, true, 'global_option_column', 'section_group', false, 'value' );\n\n\t\t\t\tform_item_label.text( $.i18n._( 'Modules' ) );\n\t\t\t\tform_item_input_div.append( modules );\n\n\t\t\t\tthis.content_div.append( form_item );\n\n\t\t\t\tform_item.bind( 'formItemChange', function( e, target ) {\n\t\t\t\t\tvar select_value = target.getValue();\n\t\t\t\t\t$this.setSection( select_value, true );\n\n\t\t\t\t} );\n\n\t\t\t\t//Sub Modules\n\t\t\t\tform_item = $( Global.loadWidget( 'global/widgets/wizard_form_item/WizardFormItem.html' ) );\n\t\t\t\tform_item_label = form_item.find( '.form-item-label' );\n\t\t\t\tform_item_input_div = form_item.find( '.form-item-input-div' );\n\n\t\t\t\tvar sub_modules = this.getAComboBox( null, true, 'global_option_column', 'section', false, 'value' );\n\n\t\t\t\tform_item_label.text( $.i18n._( 'Sub-Modules' ) );\n\t\t\t\tform_item_input_div.append( sub_modules );\n\n\t\t\t\tthis.content_div.append( form_item );\n\n\t\t\t\tthis.stepsWidgetDic[this.current_step][modules.getField()] = modules;\n\t\t\t\tthis.stepsWidgetDic[this.current_step][sub_modules.getField()] = sub_modules;\n\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\n\t\t\t\tlabel = this.getLabel();\n\t\t\t\tlabel.text( $.i18n._( 'Would you like to allow, deny or simply highlight the chosen permissions' ) );\n\n\t\t\t\tthis.content_div.append( label );\n\n\t\t\t\tvar radio_1 = $( '<input type=\"radio\" name=\"action\" id=\"allow\" value=\"allow\"><label for=\"allow\">Allow </label>' );\n\t\t\t\tvar radio_2 = $( '<input type=\"radio\" name=\"action\" id=\"deny\" value=\"deny\"><label for=\"deny\">Deny </label>' );\n\t\t\t\tvar radio_3 = $( '<input type=\"radio\" name=\"action\" id=\"highlight\" value=\"highlight\"><label for=\"highlight\">Highlight Only </label>' );\n\n\t\t\t\tthis.content_div.append( radio_1 );\n\t\t\t\tthis.content_div.append( radio_2 );\n\t\t\t\tthis.content_div.append( radio_3 );\n\n\t\t\t\tthis.stepsWidgetDic[this.current_step]['allow'] = radio_1;\n\t\t\t\tthis.stepsWidgetDic[this.current_step]['deny'] = radio_2;\n\t\t\t\tthis.stepsWidgetDic[this.current_step]['highlight'] = radio_3;\n\n\t\t\t\tbreak;\n\n\t\t}\n\t}\n\n\tsetSection( section_group_id, select_all ) {\n\t\tvar current_step_ui = this.stepsWidgetDic[this.current_step];\n\n\t\tthis.api_permission.getSectionBySectionGroup( section_group_id, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tvar data = Global.buildRecordArray( result.getResult() );\n\t\t\t\tcurrent_step_ui.section.setSourceData( data );\n\t\t\t\tif ( select_all ) {\n\t\t\t\t\tcurrent_step_ui.section.setValue( data );\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tbuildCurrentStepData() {\n\t\tvar $this = this;\n\t\tvar current_step_data = this.stepsDataDic[this.current_step];\n\t\tvar current_step_ui = this.stepsWidgetDic[this.current_step];\n\n\t\tswitch ( this.current_step ) {\n\t\t\tcase 1:\n\n\t\t\t\tthis.api_permission.getOptions( 'preset', {\n\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\tvar data = Global.buildRecordArray( result.getResult() );\n\n\t\t\t\t\t\tdata.unshift( { value: 0, label: $.i18n._( 'CUSTOM' ) } );\n\n\t\t\t\t\t\tcurrent_step_ui.role.setSourceData( data );\n\n\t\t\t\t\t\tif ( current_step_data ) {\n\t\t\t\t\t\t\tcurrent_step_ui.role.setValue( current_step_data.role );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( LocalCacheData.current_open_primary_controller.current_edit_record && LocalCacheData.current_open_primary_controller.current_edit_record.name ) {\n\t\t\t\t\t\t\tvar selected_control_name = LocalCacheData.current_open_primary_controller.current_edit_record.name.toLowerCase();\n\t\t\t\t\t\t\tfor ( var n in data ) {\n\t\t\t\t\t\t\t\tif ( data[n].label.toLowerCase() == selected_control_name ) {\n\t\t\t\t\t\t\t\t\tcurrent_step_ui.role.setSelectedIndex( n );\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t\tthis.api_permission.getOptions( 'common_permissions', {\n\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\tvar data = Global.buildRecordArray( result.getResult() );\n\n\t\t\t\t\t\tcurrent_step_ui.permission.setSourceData( data );\n\n\t\t\t\t\t\tif ( current_step_data ) {\n\t\t\t\t\t\t\tcurrent_step_ui.permission.setValue( current_step_data.permission );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcurrent_step_ui.permission.setValue( data );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t\tbreak;\n\n\t\t\tcase 2:\n\n\t\t\t\tthis.api_permission.getOptions( 'section_group', {\n\t\t\t\t\tonResult: function( result ) {\n\n\t\t\t\t\t\tvar data = Global.buildRecordArray( result.getResult() );\n\n\t\t\t\t\t\tcurrent_step_ui.section_group.setSourceData( data );\n\n\t\t\t\t\t\tif ( current_step_data ) {\n\n\t\t\t\t\t\t\tif ( current_step_data.section_group && current_step_data.section_group.length > 0 ) {\n\t\t\t\t\t\t\t\tcurrent_step_ui.section_group.setValue( current_step_data.section_group );\n\t\t\t\t\t\t\t\t$this.setSection( current_step_data.section_group );\n\t\t\t\t\t\t\t\tcurrent_step_ui.section.setValue( current_step_data.section );\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcurrent_step_ui.section_group.setValue( data[0].value );\n\t\t\t\t\t\t\t$this.setSection( data[0].value, true );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t\tbreak;\n\n\t\t\tcase 3:\n\n\t\t\t\tif ( current_step_data ) {\n\t\t\t\t\tcurrent_step_ui[current_step_data.action].prop( 'checked', 'checked' );\n\t\t\t\t} else {\n\t\t\t\t\tcurrent_step_ui['allow'].prop( 'checked', 'checked' );\n\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t}\n\t}\n\n\tonDoneClick() {\n\t\tvar $this = this;\n\t\tsuper.onDoneClick();\n\t\tthis.saveCurrentStep();\n\n\t\tvar preset = this.stepsDataDic[1].role;\n\t\tvar sections = this.stepsDataDic[2].section;\n\t\tvar permission = this.stepsDataDic[1].permission;\n\t\tvar permission_status = this.stepsDataDic[3].action;\n\n\t\tthis.api_permission.filterPresetPermissions( preset, sections, permission, {\n\t\t\tonResult: function( result ) {\n\n\t\t\t\tif ( !result.isValid ) {\n\t\t\t\t\tTAlertManager.showErrorAlert( result );\n\t\t\t\t\t$this.onCloseClick();\n\t\t\t\t} else {\n\n\t\t\t\t\t$this.onCloseClick();\n\t\t\t\t\tif ( $this.call_back ) {\n\t\t\t\t\t\t$this.call_back( result.getResult(), permission_status );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t}\n\n\tsaveCurrentStep() {\n\t\tthis.stepsDataDic[this.current_step] = {};\n\t\tvar current_step_data = this.stepsDataDic[this.current_step];\n\t\tvar current_step_ui = this.stepsWidgetDic[this.current_step];\n\t\tswitch ( this.current_step ) {\n\t\t\tcase 3:\n\t\t\t\tfor ( var key in current_step_ui ) {\n\t\t\t\t\tif ( !current_step_ui.hasOwnProperty( key ) ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( current_step_ui[key].prop( 'checked' ) || current_step_ui[key][0].checked === true ) {\n\t\t\t\t\t\tcurrent_step_data.action = key;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tfor ( var key in current_step_ui ) {\n\t\t\t\t\tif ( !current_step_ui.hasOwnProperty( key ) ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tcurrent_step_data[key] = current_step_ui[key].getValue();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tsetDefaultDataToSteps() {\n\n\t\tif ( !this.default_data ) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n}"],"names":["PermissionWizardController","options","_","$","$this","label","form_item","form_item_label","form_item_input_div","combobox","permission","modules","e","target","select_value","sub_modules","radio_1","radio_2","radio_3","section_group_id","select_all","current_step_ui","result","data","current_step_data","selected_control_name","n","preset","sections","permission_status","key"],"mappings":"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"}