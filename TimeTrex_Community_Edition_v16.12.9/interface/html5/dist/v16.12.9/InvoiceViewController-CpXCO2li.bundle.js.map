{"version":3,"file":"InvoiceViewController-CpXCO2li.bundle.js","sources":["../../views/invoice/invoice/InvoiceViewController.js"],"sourcesContent":["export class InvoiceViewController extends BaseViewController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tstatus_array: null,\n\n\t\t\tclient_group_array: null,\n\t\t\tclient_group_api: null,\n\t\t\tclient_api: null,\n\t\t\tclient_contact_api: null,\n\t\t\tproduct_api: null,\n\t\t\ttransaction_api: null,\n\n\t\t\tel: '#invoice_view_container',\n\n\t\t\tsub_client_contact_view_controller: null,\n\t\t\tsub_client_payment_view_controller: null,\n\t\t\tsub_transaction_view_controller: null,\n\n\t\t\ttotal_data_render: null,\n\t\t\ttotal_data_row_render: null,\n\n\t\t\towing_amount: null,\n\n\t\t\ttransaction_paid_data: null,\n\n\t\t\thistory: null,\n\n\t\t\teditor: null\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinit( options ) {\n\n\t\t//this._super('initialize', options );\n\t\tthis.edit_view_tpl = 'InvoiceEditView.html';\n\t\tthis.permission_id = 'invoice';\n\t\tthis.viewId = 'Invoice';\n\t\tthis.script_name = 'InvoiceView';\n\t\tthis.table_name_key = 'invoice';\n\t\tthis.context_menu_name = $.i18n._( 'Invoices' );\n\t\tthis.navigation_label = $.i18n._( 'Invoice' );\n\t\tthis.api = TTAPI.APIInvoice;\n\t\tthis.client_group_api = TTAPI.APIClientGroup;\n\t\tthis.client_api = TTAPI.APIClient;\n\t\tthis.product_api = TTAPI.APIProduct;\n\t\tthis.transaction_api = TTAPI.APITransaction;\n\t\tthis.client_contact_api = TTAPI.APIClientContact;\n\n\t\tthis.render();\n\n\t\tthis.buildContextMenu();\n\n\t\tif ( !this.sub_view_mode ) {\n\t\t\tthis.initData();\n\t\t}\n\t}\n\n\tgetCustomContextMenuModel() {\n\t\tvar context_menu_model = {\n\t\t\texclude: ['copy', 'mass_edit'],\n\t\t\tinclude: [\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'View: Invoice' ),\n\t\t\t\t\tid: 'view',\n\t\t\t\t\taction_group: 'view',\n\t\t\t\t\tvue_icon: 'tticon tticon-visibility_black_24dp',\n\t\t\t\t\tsort_order: 1010\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'View: Packing Slip' ),\n\t\t\t\t\tid: 'packing_slip',\n\t\t\t\t\taction_group: 'view',\n\t\t\t\t\tvue_icon: 'tticon tticon-visibility_black_24dp',\n\t\t\t\t\tsort_order: 1012, //After View icon.\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Payment' ),\n\t\t\t\t\tid: 'payment',\n\t\t\t\t\tvue_icon: 'tticon tticon-attach_money_black_24dp',\n\t\t\t\t\tmenu_align: 'right'\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\tif ( !this.sub_view_mode ) {\n\t\t\tcontext_menu_model['include'].push( {\n\t\t\t\tlabel: $.i18n._( 'Jump To' ),\n\t\t\t\tid: 'jump_to_header',\n\t\t\t\tmenu_align: 'right',\n\t\t\t\taction_group: 'jump_to',\n\t\t\t\taction_group_header: true,\n\t\t\t\tpermission_result: false, // to hide it in legacy context menu and avoid errors in legacy parsers.\n\t\t\t\tsort_order: 9050,\n\t\t\t} );\n\n\t\t\tcontext_menu_model['include'].push( {\n\t\t\t\tlabel: $.i18n._( 'Edit Client' ),\n\t\t\t\tid: 'edit_client',\n\t\t\t\tmenu_align: 'right',\n\t\t\t\taction_group: 'jump_to',\n\t\t\t\tgroup: 'navigation',\n\t\t\t\tsort_order: 9050,\n\t\t\t\t} );\n\n\t\t\tcontext_menu_model['include'].push( {\n\t\t\t\tlabel: $.i18n._( 'Clients' ),\n\t\t\t\tid: 'client',\n\t\t\t\tmenu_align: 'right',\n\t\t\t\taction_group: 'jump_to',\n\t\t\t\tgroup: 'navigation',\n\t\t\t\ticon: 'client_groups-35x35.png',\n\t\t\t\tsort_order: 9050,\n\t\t\t} );\n\n\t\t\tcontext_menu_model['include'].push( {\n\t\t\t\tlabel: $.i18n._( 'Client Contacts' ),\n\t\t\t\tid: 'client_contact',\n\t\t\t\tmenu_align: 'right',\n\t\t\t\taction_group: 'jump_to',\n\t\t\t\tgroup: 'navigation',\n\t\t\t\tsort_order: 9050,\n\t\t\t\t} );\n\n\t\t\tcontext_menu_model['include'].push( {\n\t\t\t\tlabel: $.i18n._( 'Transactions' ),\n\t\t\t\tid: 'transaction',\n\t\t\t\tmenu_align: 'right',\n\t\t\t\taction_group: 'jump_to',\n\t\t\t\tgroup: 'navigation',\n\t\t\t\tsort_order: 9050,\n\t\t\t\t} );\n\n\t\t\tcontext_menu_model['include'].push( {\n\t\t\t\tlabel: $.i18n._( 'Payment Methods' ),\n\t\t\t\tid: 'payment_method',\n\t\t\t\tmenu_align: 'right',\n\t\t\t\taction_group: 'jump_to',\n\t\t\t\tgroup: 'navigation',\n\t\t\t\tsort_order: 9050,\n\t\t\t\t} );\n\t\t}\n\n\t\treturn context_menu_model;\n\t}\n\n\tsetCustomDefaultMenuIcon( id, context_btn, grid_selected_length ) {\n\t\tswitch ( id ) {\n\t\t\tcase 'packing_slip':\n\t\t\t\tthis.setDefaultMenuPackingSlipIcon( context_btn, grid_selected_length );\n\t\t\t\tbreak;\n\t\t\tcase 'payment':\n\t\t\t\tthis.setDefaultMenuPaymentIcon( context_btn, grid_selected_length );\n\t\t\t\tbreak;\n\t\t\tcase 'edit_client':\n\t\t\t\tthis.setDefaultMenuEditClientIcon( context_btn, grid_selected_length );\n\t\t\t\tbreak;\n\t\t\tcase 'client':\n\t\t\t\tthis.setDefaultMenuClientIcon( context_btn, grid_selected_length );\n\t\t\t\tbreak;\n\t\t\tcase 'client_contact':\n\t\t\t\tthis.setDefaultMenuClientContactIcon( context_btn, grid_selected_length );\n\t\t\t\tbreak;\n\t\t\tcase 'transaction':\n\t\t\t\tthis.setDefaultMenuTransactionIcon( context_btn, grid_selected_length );\n\t\t\t\tbreak;\n\t\t\tcase 'payment_method':\n\t\t\t\tthis.setDefaultMenuPaymentMethodIcon( context_btn, grid_selected_length );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tsetCustomEditMenuIcon( id, context_btn ) {\n\t\tswitch ( id ) {\n\t\t\tcase 'packing_slip':\n\t\t\t\tthis.setEditMenuPackingSlipIcon( context_btn );\n\t\t\t\tbreak;\n\t\t\tcase 'payment':\n\t\t\t\tthis.setEditMenuPaymentIcon( context_btn );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tsetEditMenuPackingSlipIcon( context_btn, pId ) {\n\n\t\tif ( !this.current_edit_record || !this.current_edit_record.id ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tsetEditMenuPaymentIcon( context_btn, pId ) {\n\t\tif ( !this.current_edit_record || !this.current_edit_record.id ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tsetDefaultMenuViewIcon( context_btn, grid_selected_length, pId ) {\n\t\tif ( !this.viewPermissionValidate( pId ) || this.edit_only_mode ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t}\n\n\t\tif ( grid_selected_length > 0 && this.viewOwnerOrChildPermissionValidate() ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t} else {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tsetDefaultMenuPackingSlipIcon( context_btn, grid_selected_length, pId ) {\n\n\t\tif ( grid_selected_length > 0 ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t} else {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tsetDefaultMenuPaymentIcon( context_btn, grid_selected_length, pId ) {\n\n\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t}\n\n\tsetDefaultMenuEditClientIcon( context_btn, grid_selected_length, pId ) {\n\t\tif ( grid_selected_length > 0 ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t} else {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tsetDefaultMenuClientIcon( context_btn, grid_selected_length, pId ) {\n\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t}\n\n\tsetDefaultMenuClientContactIcon( context_btn, grid_selected_length, pId ) {\n\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t}\n\n\tsetDefaultMenuTransactionIcon( context_btn, grid_selected_length, pId ) {\n\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t}\n\n\tsetDefaultMenuPaymentMethodIcon( context_btn, grid_selected_length, pId ) {\n\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t}\n\n\tgetFilterColumnsFromDisplayColumns() {\n\t\tvar column_filter = {};\n\t\tcolumn_filter.is_owner = true;\n\t\tcolumn_filter.id = true;\n\t\tcolumn_filter.is_child = true;\n\t\tcolumn_filter.in_use = true;\n\t\tcolumn_filter.first_name = true;\n\t\tcolumn_filter.last_name = true;\n\t\tcolumn_filter.client_id = true;\n\n\t\t// Error: Unable to get property 'getGridParam' of undefined or null reference\n\t\tvar display_columns = [];\n\t\tif ( this.grid ) {\n\t\t\tdisplay_columns = this.grid.getGridParam( 'colModel' );\n\t\t}\n\n\t\tif ( display_columns ) {\n\t\t\tvar len = display_columns.length;\n\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\tvar column_info = display_columns[i];\n\t\t\t\tcolumn_filter[column_info.name] = true;\n\t\t\t}\n\t\t}\n\n\t\treturn column_filter;\n\t}\n\n\tonCustomContextClick( id ) {\n\t\tswitch ( id ) {\n\t\t\tcase 'edit_client':\n\t\t\tcase 'client':\n\t\t\tcase 'client_contact':\n\t\t\tcase 'transaction':\n\t\t\tcase 'payment_method':\n\t\t\tcase 'payment':\n\t\t\tcase 'view':\n\t\t\tcase 'packing_slip':\n\t\t\t\tthis.onNavigationClick( id );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tonViewClick() {\n\t\treturn this.onNavigationClick( 'view' );\n\t}\n\n\tonNavigationClick( iconName ) {\n\t\tvar $this = this;\n\t\tvar grid_selected_id_array;\n\t\tvar filter = { filter_data: {} };\n\t\tvar ids = [];\n\t\tvar client_ids = [];\n\t\tvar invoice_id;\n\t\tvar currency_id;\n\t\tif ( $this.edit_view ) {\n\t\t\tif ( $this.current_edit_record.client_id ) {\n\t\t\t\tclient_ids.push( $this.current_edit_record.client_id );\n\t\t\t}\n\t\t\tcurrency_id = $this.current_edit_record.currency_id;\n\t\t\tif ( $this.current_edit_record.id ) {\n\t\t\t\tinvoice_id = $this.current_edit_record.id;\n\t\t\t\tids.push( $this.current_edit_record.id );\n\t\t\t}\n\t\t} else {\n\t\t\tgrid_selected_id_array = this.getGridSelectIdArray();\n\t\t\t$.each( grid_selected_id_array, function( index, value ) {\n\t\t\t\tvar grid_selected_row = $this.getRecordFromGridById( value );\n\t\t\t\tids.push( grid_selected_row.id );\n\t\t\t\tclient_ids.push( grid_selected_row.client_id );\n\t\t\t} );\n\t\t}\n\t\tfilter.filter_data.client_id = client_ids;\n\t\tvar args = { filter_data: { id: ids } };\n\t\tvar post_data;\n\t\tswitch ( iconName ) {\n\t\t\tcase 'edit_client':\n\t\t\t\tif ( client_ids.length > 0 ) {\n\t\t\t\t\tIndexViewController.openEditView( this, 'Client', client_ids[0] );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'payment':\n\t\t\t\tif ( invoice_id ) {\n\t\t\t\t\tIndexViewController.openEditView( this, 'InvoiceTransaction', {\n\t\t\t\t\t\ttype_id: 20,\n\t\t\t\t\t\tinvoice_id: invoice_id,\n\t\t\t\t\t\tclient_id: client_ids[0],\n\t\t\t\t\t\tcurrency_id: currency_id,\n\t\t\t\t\t\tis_add: true,\n\t\t\t\t\t\towing_amount: this.owing_amount\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'client':\n\t\t\t\tfilter.filter_data.id = filter.filter_data.client_id;\n\t\t\t\tdelete filter.filter_data.client_id;\n\t\t\t\tGlobal.addViewTab( $this.viewId, $.i18n._( 'Invoices' ), window.location.href );\n\t\t\t\tIndexViewController.goToView( 'Client', filter );\n\t\t\t\tbreak;\n\t\t\tcase 'client_contact':\n\t\t\t\tGlobal.addViewTab( $this.viewId, $.i18n._( 'Invoices' ), window.location.href );\n\t\t\t\tIndexViewController.goToView( 'ClientContact', filter );\n\t\t\t\tbreak;\n\t\t\tcase 'transaction':\n\t\t\t\tGlobal.addViewTab( $this.viewId, $.i18n._( 'Invoices' ), window.location.href );\n\t\t\t\tIndexViewController.goToView( 'InvoiceTransaction', filter );\n\t\t\t\tbreak;\n\t\t\tcase 'payment_method':\n\t\t\t\tGlobal.addViewTab( $this.viewId, $.i18n._( 'Invoices' ), window.location.href );\n\t\t\t\tIndexViewController.goToView( 'ClientPayment', filter );\n\t\t\t\tbreak;\n\t\t\tcase 'view':\n\t\t\t\tpost_data = { 0: args, 1: false, 2: 'pdf' };\n\t\t\t\tthis.doFormIFrameCall( post_data );\n\t\t\t\tbreak;\n\t\t\tcase 'packing_slip':\n\t\t\t\tpost_data = { 0: args, 1: false, 2: 'pdf_packing_slip' };\n\t\t\t\tthis.doFormIFrameCall( post_data );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tdoFormIFrameCall( postData ) {\n\t\tGlobal.APIFileDownload( this.api.className, 'get' + this.api.key_name, postData );\n\t}\n\n\tinitOptions() {\n\t\tvar $this = this;\n\n\t\tthis.initDropDownOption( 'status' );\n\t\tthis.client_group_api.getClientGroup( '', false, false, {\n\t\t\tonResult: function( res ) {\n\t\t\t\tres = res.getResult();\n\t\t\t\tres = Global.buildTreeRecord( res );\n\t\t\t\tif ( !$this.edit_only_mode && !$this.sub_view_mode ) {\n\t\t\t\t\t$this.basic_search_field_ui_dic['client_group_id'].setSourceData( res );\n\t\t\t\t\t$this.adv_search_field_ui_dic['client_group_id'].setSourceData( res );\n\t\t\t\t}\n\n\t\t\t\t$this.client_group_array = res;\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tbuildEditViewUI() {\n\n\t\tsuper.buildEditViewUI();\n\n\t\tvar $this = this;\n\n\t\tthis.edit_view.children().eq( 0 ).css( 'min-width', 1050 );\n\n\t\tvar tab_model = {\n\t\t\t'tab_invoice': {\n\t\t\t\t'label': $.i18n._( 'Invoice' ),\n\t\t\t\t'html_template': this.getInvoiceTabHtml(),\n\t\t\t\t'is_multi_column': true\n\t\t\t},\n\t\t\t'tab_client_contacts': {\n\t\t\t\t'label': $.i18n._( 'Client Contacts' ),\n\t\t\t\t'init_callback': 'initSubClientContactView',\n\t\t\t\t'display_on_mass_edit': false\n\t\t\t},\n\t\t\t'tab_payment_methods': {\n\t\t\t\t'label': $.i18n._( 'Payment Methods' ),\n\t\t\t\t'init_callback': 'initSubClientPaymentView',\n\t\t\t\t'display_on_mass_edit': false\n\t\t\t},\n\t\t\t'tab_transactions': {\n\t\t\t\t'label': $.i18n._( 'Transactions' ),\n\t\t\t\t'init_callback': 'initSubTransactionView',\n\t\t\t\t'display_on_mass_edit': false\n\t\t\t},\n\t\t\t'tab_audit': true,\n\t\t};\n\t\tthis.setTabModel( tab_model );\n\n\t\tthis.navigation.AComboBox( {\n\t\t\tapi_class: TTAPI.APIInvoice,\n\t\t\tid: this.script_name + '_navigation',\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_invoice',\n\t\t\tnavigation_mode: true,\n\t\t\tshow_search_inputs: true\n\t\t} );\n\n\t\tthis.setNavigation();\n\n\t\t//Tab 0 start\n\n\t\tvar tab_invoice = this.edit_view_tab.find( '#tab_invoice' );\n\n\t\tvar tab_invoice_column1 = tab_invoice.find( '.first-column' );\n\t\tvar tab_invoice_column2 = tab_invoice.find( '.second-column' );\n\t\tvar tab_invoice_column3 = tab_invoice.find( '.third-column' );\n\n\t\tthis.edit_view_tabs[0] = [];\n\n\t\tthis.edit_view_tabs[0].push( tab_invoice_column1 );\n\t\tthis.edit_view_tabs[0].push( tab_invoice_column2 );\n\t\tthis.edit_view_tabs[0].push( tab_invoice_column3 );\n\n\t\tvar form_item_input;\n\t\tvar widgetContainer;\n\t\tvar label;\n\n\t\t// Client\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIClient,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_client',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'client_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Client' ), form_item_input, tab_invoice_column1, '', null, true );\n\n\t\t// Client\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\tform_item_input.TText( { field: 'client' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Client' ), form_item_input, tab_invoice_column1, '', null, true );\n\n\t\t// Status\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\t\tform_item_input.TComboBox( { field: 'status_id' } );\n\t\tform_item_input.setSourceData( $this.status_array );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Status' ), form_item_input, tab_invoice_column1 );\n\n\t\t// Billing Contact\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIClientContact,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_client_contact',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'billing_contact_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Billing Contact' ), form_item_input, tab_invoice_column1 );\n\n\t\t// Shipping Contact\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIClientContact,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_client_contact',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'shipping_contact_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Shipping Contact' ), form_item_input, tab_invoice_column1 );\n\n\t\t// Other Contact\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIClientContact,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_client_contact',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'other_contact_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Other Contact' ), form_item_input, tab_invoice_column1 );\n\n\t\t// Currency\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APICurrency,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_currency',\n\t\t\tshow_search_inputs: true,\n\t\t\tfield: 'currency_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Currency' ), form_item_input, tab_invoice_column1 );\n\n\t\t// PO Number\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\n\t\tform_item_input.TTextInput( { field: 'po_number', width: 100 } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'PO Number' ), form_item_input, tab_invoice_column1 );\n\n\t\t// Tags\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TAG_INPUT );\n\n\t\tform_item_input.TTagInput( { field: 'tag', object_type_id: 910 } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Tags' ), form_item_input, tab_invoice_column1, '', null, null, true );\n\n\t\t// Invoice #\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\tform_item_input.TText( { field: 'invoice_number' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Invoice #' ), form_item_input, tab_invoice_column2, '' );\n\n\t\t// Invoice Date\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\n\t\tform_item_input.TDatePicker( { field: 'invoice_date' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Invoice Date' ), form_item_input, tab_invoice_column2 );\n\n\t\t// Order Date\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\n\t\tform_item_input.TDatePicker( { field: 'order_date' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Order Date' ), form_item_input, tab_invoice_column2 );\n\n\t\t// Payment Required\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\n\t\tform_item_input.TDatePicker( { field: 'required_date' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Payment Required' ), form_item_input, tab_invoice_column2 );\n\n\t\t// Shipped Date\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\n\t\tform_item_input.TDatePicker( { field: 'shipped_date' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Shipped Date' ), form_item_input, tab_invoice_column2 );\n\n\t\t// Sales Rep\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIUser,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_user',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'sales_contact_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Sales Rep' ), form_item_input, tab_invoice_column2 );\n\n\t\t// Tracking Number\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\n\t\tform_item_input.TTextInput( { field: 'tracking_number' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Tracking Number' ), form_item_input, tab_invoice_column2 );\n\n\t\t// Shipping Policy\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\t\tform_item_input.TComboBox( { field: 'combined_shipping_policy_id' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Shipping Policy' ), form_item_input, tab_invoice_column2, '' );\n\n\t\t//Inside editor\n\n\t\tvar inside_editor_div = tab_invoice.find( '.inside-editor-div' );\n\n\t\tvar args = {\n\t\t\tproduct: $.i18n._( 'Product' ),\n\t\t\tdescription: $.i18n._( 'Description' ),\n\t\t\tqty: $.i18n._( 'QTY' ),\n\t\t\tprice: $.i18n._( 'Price' ),\n\t\t\tprorate: $.i18n._( 'ProRate' ),\n\t\t\ttotal: $.i18n._( 'Total' )\n\t\t};\n\n\t\tthis.editor = Global.loadWidgetByName( FormItemType.INSIDE_EDITOR );\n\n\t\tthis.editor.InsideEditor( {\n\t\t\taddRow: this.insideEditorAddRow,\n\t\t\tremoveRow: this.insideEditorRemoveRow,\n\t\t\tgetValue: this.insideEditorGetValue,\n\t\t\tsetValue: this.insideEditorSetValue,\n\t\t\tparent_controller: this,\n\t\t\tapi: this.transaction_api,\n\t\t\trender: getRender(),\n\t\t\trender_args: args,\n\t\t\trender_inline_html: true,\n\t\t\trow_render: getRowRender(),\n\n\t\t} );\n\n\t\tfunction getRender() {\n\t\t\treturn `\n\t\t\t<table class=\"inside-editor-render\">\n\t\t\t\t<tr class=\"title\" style=\"font-weight: bold;\">\n\t\t\t\t\t<td style=\"width: 200px\"><%= product %></td>\n\t\t\t\t\t<td style=\"width: 400px\"><%= description %></td>\n\t\t\t\t\t<td style=\"width: 50px\"><%= qty %></td>\n\t\t\t\t\t<td style=\"width: 50px\"><%= price %></td>\n\t\t\t\t\t<td style=\"width: 85px\"><%= prorate %></td>\n\t\t\t\t\t<td style=\"width: 100px\"><%= total %></td>\n\t\t\t\t</tr>\n\t\t\t</table>`;\n\t\t}\n\n\t\tfunction getRowRender() {\n\t\t\treturn `\n\t\t\t<tr class=\"inside-editor-row data-row\">\n\t\t\t\t<td class=\"\"></td>\n\t\t\t\t<td class=\"\"></td>\n\t\t\t\t<td class=\"\"></td>\n\t\t\t\t<td class=\"\"></td>\n\t\t\t\t<td class=\"\"></td>\n\t\t\t\t<td class=\"\"></td>\n\t\t\t\t<td class=\"cell control-icon\">\n\t\t\t\t\t<button class=\"plus-icon\" onclick=\"\"></button>\n\t\t\t\t</td>\n\t\t\t\t<td class=\"cell control-icon\">\n\t\t\t\t\t<button class=\"minus-icon \" onclick=\"\"></button>\n\t\t\t\t</td>\n\t\t\t</tr>`;\n\t\t}\n\n\t\tinside_editor_div.append( this.editor );\n\n\t\t// Note(private)\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_AREA );\n\n\t\tform_item_input.TTextArea( { field: 'private_note', width: 800, height: 50 } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Note(private)' ), form_item_input, tab_invoice_column3, '', null, null, true );\n\n\t\t// Note(public)\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_AREA );\n\n\t\tform_item_input.TTextArea( { field: 'public_note', width: 500, height: 50 } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Note(public)' ), form_item_input, tab_invoice_column3, '', null, null, true );\n\n\t\t// Email Invoice To Contact(s)\n\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\t\tvar email_invoice = Global.loadWidgetByName( FormItemType.CHECKBOX );\n\t\temail_invoice.TCheckbox( { field: 'email_invoice' } );\n\t\twidgetContainer.append( email_invoice );\n\t\tlabel = $( '<span class=\\'widget-right-label\\'> ' + $.i18n._( 'CC' ) + '</span>' );\n\t\twidgetContainer.append( label );\n\t\tvar email_cc = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\temail_cc.TTextInput( { field: 'email_other_cc', width: 200 } );\n\t\twidgetContainer.append( email_cc );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Email Invoice To Contact(s)' ), [email_invoice, email_cc], tab_invoice_column3, '', widgetContainer );\n\t}\n\n\tbuildSearchFields() {\n\n\t\tsuper.buildSearchFields();\n\t\tthis.search_fields = [\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Status' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'status_id',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tlayout_name: 'global_option_column',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Client' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'client_id',\n\t\t\t\tlayout_name: 'global_client',\n\t\t\t\tapi_class: TTAPI.APIClient,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Client Group' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tmultiple: true,\n\t\t\t\tfield: 'client_group_id',\n\t\t\t\tlayout_name: 'global_tree_column',\n\t\t\t\ttree_mode: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Invoice Number' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'invoice_number',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.TEXT_INPUT\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'PO Number' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'po_number',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.TEXT_INPUT\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Sales Rep' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'sales_contact_id',\n\t\t\t\tlayout_name: 'global_user',\n\t\t\t\tapi_class: TTAPI.APIUser,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Billing Contact' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'billing_contact_id',\n\t\t\t\tlayout_name: 'global_client_contact',\n\t\t\t\tapi_class: TTAPI.APIClientContact,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Shipping Contact' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'shipping_contact_id',\n\t\t\t\tlayout_name: 'global_client_contact',\n\t\t\t\tapi_class: TTAPI.APIClientContact,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Other Contact' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'other_contact_id',\n\t\t\t\tlayout_name: 'global_client_contact',\n\t\t\t\tapi_class: TTAPI.APIClientContact,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Tags' ),\n\t\t\t\tfield: 'tag',\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tin_column: 2,\n\t\t\t\tobject_type_id: 910,\n\t\t\t\tform_item_type: FormItemType.TAG_INPUT\n\t\t\t} )\n\n\t\t];\n\t}\n\n\tsetSelectLayout() {\n\t\tif ( this.sub_view_mode ) {\n\t\t\tsuper.setSelectLayout( ['client'] );\n\t\t} else {\n\t\t\tsuper.setSelectLayout();\n\t\t}\n\t}\n\n\t_continueDoCopyAsNew() {\n\t\tvar $this = this;\n\n\t\tthis.setCurrentEditViewState( 'new' );\n\t\tLocalCacheData.current_doing_context_action = 'copy_as_new';\n\t\tif ( Global.isSet( this.edit_view ) ) {\n\t\t\tthis.current_edit_record = this.copyAsNewResetIds( this.current_edit_record );\n\t\t\tvar navigation_div = this.edit_view.find( '.navigation-div' );\n\t\t\tnavigation_div.css( 'display', 'none' );\n\t\t\tthis.setEditMenu();\n\t\t\tthis.setTabStatus();\n\n\t\t\tthis.detachElement( 'client' );\n\t\t\tthis.attachElement( 'client_id' );\n\t\t\tthis.edit_view_ui_dic['invoice_number'].setValue( $.i18n._( 'N/A' ) );\n\n\t\t\t//This is also done in onCopyAsNewResult().\n\t\t\tthis.edit_view_ui_dic['invoice_date'].setValue( ( new Date ).format( Global.getLoginUserDateFormat() ) );\n\t\t\tthis.edit_view_ui_dic['order_date'].setValue( ( new Date ).format( Global.getLoginUserDateFormat() ) );\n\t\t\tthis.edit_view_ui_dic['required_date'].setValue( '' );\n\t\t\tthis.edit_view_ui_dic['shipped_date'].setValue( '' );\n\t\t\tthis.edit_view_ui_dic['tracking_number'].setValue( '' );\n\n\t\t\tfor ( var i = 0; i < $this.editor.rows_widgets_array.length; i++ ) {\n\t\t\t\tif ( $this.editor.rows_widgets_array[i].quantity ) {\n\t\t\t\t\t$this.editor.rows_widgets_array[i].quantity.change();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.is_changed = true;\n\t\t\tProgressBar.closeOverlay();\n\n\t\t} else {\n\t\t\tsuper._continueDoCopyAsNew();\n\t\t}\n\t}\n\n\tsetCurrentEditRecordData() {\n\t\t//Set current edit record data to all widgets\n\t\tfor ( var key in this.current_edit_record ) {\n\t\t\tif ( !this.current_edit_record.hasOwnProperty( key ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar widget = this.edit_view_ui_dic[key];\n\t\t\tif ( Global.isSet( widget ) ) {\n\t\t\t\tswitch ( key ) {\n\t\t\t\t\tcase 'client_id':\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tthis.edit_view_ui_dic['billing_contact_id'].setSourceData( null );\n\t\t\t\t\t\tthis.edit_view_ui_dic['shipping_contact_id'].setSourceData( null );\n\t\t\t\t\t\tthis.edit_view_ui_dic['other_contact_id'].setSourceData( null );\n\n\t\t\t\t\t\tif ( !this.current_edit_record || !this.current_edit_record.id ) { //New in sub view, the client_id is set\n\t\t\t\t\t\t\tthis.getClient( this.current_edit_record[key] );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.getClient( this.current_edit_record[key], true );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'combined_shipping_policy_id':\n\t\t\t\t\t\t//set when get shipping options;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'currency_id':\n\t\t\t\t\t\tif ( !this.current_edit_record[key] ) {\n\t\t\t\t\t\t\tthis.current_edit_record[key] = LocalCacheData.getLoginUser().currency_id;\n\t\t\t\t\t\t}\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'invoice_number':\n\t\t\t\t\t\tif ( !this.current_edit_record[key] || this.copied_record_id ) {\n\t\t\t\t\t\t\twidget.setValue( $.i18n._( 'N/A' ) );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t\tthis.collectUIDataToCurrentEditRecord();\n\t\tthis.setEditViewDataDone();\n\t}\n\n\tshowClientColumn() {\n\t\tif ( this.is_edit ) {\n\t\t\tthis.attachElement( 'client' );\n\t\t\tthis.detachElement( 'client_id' );\n\t\t} else if ( this.is_add ) {\n\t\t\tthis.detachElement( 'client' );\n\t\t\tthis.attachElement( 'client_id' );\n\n\t\t}\n\t}\n\n\tsetPaymentIconDisabled() {\n\t\tlet context_btn = ContextMenuManager.getMenuModelByMenuId( this.determineContextMenuMountAttributes().id ).find( context_icon => context_icon.id === 'payment' );\n\t\tthis.setDefaultMenuPaymentIcon( context_btn );\n\t}\n\n\tonFormItemChange( target, doNotValidate ) {\n\t\tthis.setPaymentIconDisabled();\n\t\tthis.setMassEditingFieldsWhenFormChange( target );\n\t\tthis.setIsChanged( target );\n\t\tvar $this = this;\n\t\tvar key = target.getField();\n\t\tvar c_value = target.getValue();\n\t\tthis.current_edit_record[key] = target.getValue();\n\n\t\tswitch ( key ) {\n\t\t\tcase 'client_id':\n\t\t\t\tthis.edit_view_ui_dic['billing_contact_id'].setSourceData( null );\n\t\t\t\tthis.edit_view_ui_dic['shipping_contact_id'].setSourceData( null );\n\t\t\t\tthis.edit_view_ui_dic['other_contact_id'].setSourceData( null );\n\t\t\t\tthis.edit_view_ui_dic['billing_contact_id'].setValue( false );\n\t\t\t\tthis.edit_view_ui_dic['shipping_contact_id'].setValue( false );\n\t\t\t\tthis.edit_view_ui_dic['other_contact_id'].setValue( false );\n\n\t\t\t\tthis.current_edit_record['billing_contact_id'] = false;\n\t\t\t\tthis.current_edit_record['shipping_contact_id'] = false;\n\t\t\t\tthis.current_edit_record['other_contact_id'] = false;\n\t\t\t\tthis.getClient( c_value );\n\t\t\t\tbreak;\n\t\t\tcase 'billing_contact_id':\n\n\t\t\t\tif ( this.current_edit_record['billing_contact_id'] ) {\n\t\t\t\t\tthis.setDefaultCurrency();\n\t\t\t\t} else {\n\t\t\t\t\tthis.getInvoiceTotalData();\n\t\t\t\t}\n\n\t\t}\n\n\t\tswitch ( key ) {\n\t\t\tcase 'currency_id':\n\t\t\tcase 'shipping_contact_id':\n\t\t\t\tthis.getInvoiceTotalData();\n\t\t\t\tthis.getShippingOptions();\n\t\t\t\tbreak;\n\t\t\tcase 'combined_shipping_policy_id':\n\t\t\t\tthis.getInvoiceTotalData();\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif ( !doNotValidate ) {\n\t\t\tthis.validate();\n\t\t}\n\t}\n\n\tsetDefaultCurrency() {\n\t\tvar $this = this;\n\t\tvar args = {};\n\t\targs.filter_data = {};\n\t\targs.filter_data.id = this.current_edit_record['billing_contact_id'];\n\t\tthis.client_contact_api['get' + this.client_contact_api.key_name]( args, {\n\t\t\tonResult: function( res ) {\n\t\t\t\tvar result = res.getResult()[0];\n\t\t\t\t// FIXED JS EXCEPTION: Cannot set property 'currency_id' of null\n\t\t\t\tif ( $this.edit_view_ui_dic && $this.current_edit_record ) {\n\t\t\t\t\t//Fixed possible exception -- Error: Unable to get property 'currency_id' of undefined or null reference in /interface/html5/ line 1246\n\t\t\t\t\tif ( result ) {\n\t\t\t\t\t\t$this.current_edit_record['currency_id'] = result.currency_id;\n\t\t\t\t\t\t$this.edit_view_ui_dic['currency_id'].setValue( result.currency_id );\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$this.current_edit_record['currency_id'] = LocalCacheData.getLoginUser().currency_id;\n\t\t\t\t\t\t$this.edit_view_ui_dic['currency_id'].setValue( LocalCacheData.getLoginUser().currency_id );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t$this.getInvoiceTotalData();\n\t\t\t}\n\t\t} );\n\t}\n\n\tgetClient( client_id, filter_only ) {\n\t\tvar $this = this;\n\t\tvar filter = {};\n\t\tfilter.filter_data = { 'id': client_id };\n\t\tfilter.filter_columns = {\n\t\t\t'invoice_number': true,\n\t\t\t'default_other_contact_id': true,\n\t\t\t'client': true,\n\t\t\t'default_billing_contact_id': true,\n\t\t\t'invoice_date': true,\n\t\t\t'status': true,\n\t\t\t'default_shipping_contact_id': true\n\t\t};\n\t\tif ( client_id ) {\n\t\t\tthis.client_api['get' + this.client_api.key_name]( filter, {\n\t\t\t\tonResult: function( res ) {\n\t\t\t\t\tif ( !$this.edit_view ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar result_data = res.getResult();\n\t\t\t\t\tif ( Global.isArray( result_data ) ) {\n\t\t\t\t\t\tvar result = result_data[0];\n\n\t\t\t\t\t\t//When set it first time in setCurrentEditRecord, don't use default value\n\t\t\t\t\t\tif ( !filter_only ) {\n\n\t\t\t\t\t\t\tvar default_billing_contact_id = result.default_billing_contact_id;\n\t\t\t\t\t\t\tvar default_shipping_contact_id = result.default_shipping_contact_id;\n\t\t\t\t\t\t\tvar default_other_contact_id = result.default_other_contact_id;\n\n\t\t\t\t\t\t\t$this.edit_view_ui_dic['billing_contact_id'].setValue( default_billing_contact_id );\n\t\t\t\t\t\t\t$this.edit_view_ui_dic['shipping_contact_id'].setValue( default_shipping_contact_id );\n\t\t\t\t\t\t\t$this.edit_view_ui_dic['other_contact_id'].setValue( default_other_contact_id );\n\n\t\t\t\t\t\t\t$this.current_edit_record['billing_contact_id'] = default_billing_contact_id;\n\t\t\t\t\t\t\t$this.current_edit_record['shipping_contact_id'] = default_shipping_contact_id;\n\t\t\t\t\t\t\t$this.current_edit_record['other_contact_id'] = default_other_contact_id;\n\n\t\t\t\t\t\t\t$this.setDefaultCurrency();\n\t\t\t\t\t\t\t$this.getShippingOptions();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$this.edit_view_ui_dic['billing_contact_id'].setDefaultArgs( { 'filter_data': { 'client_id': client_id } } );\n\t\t\t\t\t\t$this.edit_view_ui_dic['shipping_contact_id'].setDefaultArgs( { 'filter_data': { 'client_id': client_id } } );\n\t\t\t\t\t\t$this.edit_view_ui_dic['other_contact_id'].setDefaultArgs( { 'filter_data': { 'client_id': client_id } } );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t} );\n\t\t} else {\n\n\t\t\tif ( !filter_only ) {\n\t\t\t\tthis.getInvoiceTotalData();\n\t\t\t\tthis.getShippingOptions();\n\t\t\t}\n\n\t\t}\n\t}\n\n\tsetEditViewDataDone() {\n\t\tsuper.setEditViewDataDone();\n\t\tthis.showClientColumn();\n\t\tthis.initInsideEditorData();\n\t}\n\n\tinitInsideEditorData( update_status ) {\n\n\t\tvar $this = this;\n\n\t\tvar transaction_id = this.current_edit_record.id ? this.current_edit_record.id : this.copied_record_id;\n\t\tthis.copied_record_id = '';\n\n\t\tif ( !transaction_id ) {\n\n\t\t\tthis.transaction_paid_data = null;\n\n\t\t\t$this.editor.removeAllRows();\n\t\t\t$this.editor.getDefaultData();\n\n\t\t\tif ( this.total_data_render ) {\n\t\t\t\tthis.total_data_render.remove();\n\t\t\t\tthis.total_data_render = null;\n\t\t\t\tthis.total_data_row_render = null;\n\t\t\t}\n\n\t\t\tif ( this.history ) {\n\t\t\t\tthis.history.remove();\n\t\t\t\tthis.history = null;\n\t\t\t}\n\n\t\t\t$this.getInvoiceTotalData();\n\t\t\t$this.getShippingOptions();\n\n\t\t} else {\n\n\t\t\tvar filter = {};\n\t\t\tfilter.filter_data = {};\n\t\t\tfilter.filter_data.invoice_id = transaction_id;\n\t\t\tfilter.filter_data.type_id = 10;\n\t\t\tfilter.filter_data.product_type_id = [10, 20];\n\n\t\t\tthis.transaction_api['get' + this.transaction_api.key_name]( filter, true, {\n\t\t\t\tonResult: function( res ) {\n\n\t\t\t\t\tvar result = res.getResult();\n\n\t\t\t\t\t// get the paid data.\n\t\t\t\t\tfilter.filter_data = {};\n\t\t\t\t\tfilter.filter_columns = {\n\t\t\t\t\t\ttype_id: true,\n\t\t\t\t\t\tstatus_id: true,\n\t\t\t\t\t\tpayment_type: true,\n\t\t\t\t\t\tconfirm_number: true,\n\t\t\t\t\t\tid: true,\n\t\t\t\t\t\tclient_id: true,\n\t\t\t\t\t\tinvoice_id: true,\n\t\t\t\t\t\tamount: true,\n\t\t\t\t\t\tstatus: true,\n\t\t\t\t\t\tclient_payment: true\n\t\t\t\t\t};\n\t\t\t\t\tfilter.filter_data.type_id = 20;\n\t\t\t\t\tfilter.filter_data.invoice_id = transaction_id;\n\n\t\t\t\t\t$this.transaction_api['get' + $this.transaction_api.key_name]( filter, true, {\n\t\t\t\t\t\tonResult: function( paid_res ) {\n\n\t\t\t\t\t\t\tif ( !$this.edit_view ) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( Global.isSet( update_status ) ) {\n\t\t\t\t\t\t\t\t$this.updateStatus();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tvar paid = paid_res.getResult();\n\t\t\t\t\t\t\tif ( paid === true || LocalCacheData.current_doing_context_action == 'copy_as_new' ) { //When doing copy as new, always ignore paid transactions as they aren't likely wanted or accurate anyways.\n\t\t\t\t\t\t\t\t$this.transaction_paid_data = null;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$this.transaction_paid_data = paid;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$this.editor.setValue( result );\n\n\t\t\t\t\t\t\t//Only when doing copy as new, trigger onChange event for all quantity fields, so the latest prices are retrieved.\n\t\t\t\t\t\t\t//  This is also done in _continueDoCopyAsNew.\n\t\t\t\t\t\t\tif ( LocalCacheData.current_doing_context_action == 'copy_as_new' && Global.isSet( $this.edit_view ) ) {\n\t\t\t\t\t\t\t\tfor ( var i = 0; i < $this.editor.rows_widgets_array.length; i++ ) {\n\t\t\t\t\t\t\t\t\tif ( $this.editor.rows_widgets_array[i].quantity ) {\n\t\t\t\t\t\t\t\t\t\t$this.editor.rows_widgets_array[i].quantity.change();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$this.getInvoiceTotalData( result );\n\t\t\t\t\t\t\t$this.getShippingOptions( result );\n\t\t\t\t\t\t\t$this.setTransactionHistoryData();\n\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\t\t\t} );\n\n\t\t}\n\t}\n\n\tinsideEditorSetValue( val ) {\n\t\tvar len = val.length;\n\t\tthis.removeAllRows();\n\n\t\tif ( len > 0 ) {\n\t\t\tfor ( var i = 0; i < val.length; i++ ) {\n\t\t\t\tif ( Global.isSet( val[i] ) ) {\n\t\t\t\t\tvar row = val[i];\n\t\t\t\t\tthis.addRow( row );\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthis.getDefaultData();\n\t\t}\n\t}\n\n\tgetInvoiceTotalData( transaction_data ) {\n\n\t\tvar $this = this;\n\t\tvar transaction_record;\n\n\t\tif ( !$this.edit_view ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( Global.isSet( transaction_data ) ) {\n\t\t\ttransaction_record = transaction_data;\n\t\t} else {\n\t\t\ttransaction_record = this.editor.getValue();\n\t\t}\n\n\t\tif ( this.transaction_paid_data ) {\n\t\t\tvar temp_transaction_record = [];\n\t\t\t$.each( transaction_record, function( key, item ) {\n\t\t\t\ttemp_transaction_record.push( item );\n\t\t\t} );\n\t\t\t$.each( this.transaction_paid_data, function( key, item ) {\n\t\t\t\ttemp_transaction_record.push( item );\n\t\t\t} );\n\n\t\t\ttransaction_record = temp_transaction_record;\n\t\t}\n\n\t\tthis.api.getInvoiceTotalData( transaction_record, this.current_edit_record, false, {\n\t\t\tonResult: function( res ) {\n\n\t\t\t\tvar result = res.getResult();\n\t\t\t\t$this.setInvoiceTotalData( result );\n\t\t\t}\n\t\t} );\n\t}\n\n\tsetTransactionHistoryData() {\n\n\t\tif ( this.transaction_paid_data ) {\n\n\t\t\tif ( this.history ) {\n\t\t\t\tthis.history.remove();\n\t\t\t}\n\n\t\t\tvar tab_invoice = this.edit_view_tab.find( '#tab_invoice' );\n\t\t\tvar inside_editor_div = tab_invoice.find( '.inside-transaction-history-div' );\n\n\t\t\tvar render = `\n\t\t\t<table class=\"inside-editor-render inside-custom-style\">\n\t\t\t\t<tr class=\"title\" style=\"font-weight: bold;\">\n\t\t\t\t\t<td style=\"width: 400px\"><%= status %></td>\n\t\t\t\t\t<td style=\"width: 300px\"><%= payment_type %></td>\n\t\t\t\t\t<td style=\"width: 200px\"><%= client_payment %></td>\n\t\t\t\t\t<td style=\"width: 200px\"><%= confirm_number %></td>\n\t\t\t\t\t<td style=\"width: 100px\"><%= amount %></td>\n\t\t\t\t</tr>\n\t\t\t</table>`;\n\t\t\tvar row_render = `\n\t\t\t<tr class=\"inside-editor-row data-row\">\n\t\t\t\t<td class=\"\"><%= status %></td>\n\t\t\t\t<td class=\"\"><%= payment_type %></td>\n\t\t\t\t<td class=\"\"><%= client_payment %></td>\n\t\t\t\t<td class=\"\"><%= confirm_number %></td>\n\t\t\t\t<td class=\"\"><%= amount %></td>\n\t\t\t</tr>`;\n\n\t\t\tvar title = {\n\t\t\t\tstatus: $.i18n._( 'Status' ),\n\t\t\t\tpayment_type: $.i18n._( 'Payment Type' ),\n\t\t\t\tclient_payment: $.i18n._( 'Payment Method' ),\n\t\t\t\tconfirm_number: $.i18n._( 'Confirmation Number' ),\n\t\t\t\tamount: $.i18n._( 'Amount' )\n\t\t\t};\n\n\t\t\tvar history = Global.loadWidgetByName( FormItemType.INSIDE_EDITOR );\n\n\t\t\tvar template = _.template( render );\n\n\t\t\tvar render_div = history.children().eq( 1 );\n\t\t\trender_div.append( template( title ) );\n\n\t\t\trender = $( render_div.find( '.inside-editor-render' ) );\n\t\t\t/* jshint ignore:start */\n\t\t\tfor ( var key in this.transaction_paid_data ) {\n\t\t\t\tvar row = this.transaction_paid_data[key];\n\t\t\t\t$.each( row, function( i, v ) {\n\t\t\t\t\trow[i] = v ? v : '--';\n\t\t\t\t} );\n\n\t\t\t\tvar tmp_template = _.template( row_render );\n\t\t\t\trender.append( tmp_template( row ) );\n\t\t\t}\n\t\t\t/* jshint ignore:end */\n\t\t\tinside_editor_div.append( render );\n\n\t\t\tthis.history = $( render );\n\t\t}\n\t}\n\n\tsetInvoiceTotalData( total_data ) {\n\n\t\tif ( !this.edit_view ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( Global.isSet( this.total_data_render ) ) {\n\t\t\tthis.total_data_render.remove();\n\t\t\tthis.total_data_render = null;\n\t\t}\n\n\t\tvar tab_invoice = this.edit_view_tab.find( '#tab_invoice' );\n\t\tvar inside_editor_div = tab_invoice.find( '.inside-total-data-editor-div' );\n\t\tthis.total_data_row_render = `\n\t\t<ul class=\"total-data-row\">\n\t\t\t<li class=\"total-data-label\"><%= label %></li>\n\t\t\t<li class=\"total-data-value\"><%= value %></li>\n\t\t</ul>`;\n\t\tthis.total_data_render = $( '<div class=\"total-data-editor\"></div>' );\n\n\t\tvar render_args = this.viewTotalDataUI( Global.removeSortPrefixFromArray( total_data ) );\n\n\t\tif ( Global.isSet( render_args ) ) {\n\t\t\tinside_editor_div.append( this.total_data_render );\n\t\t}\n\t}\n\n\tviewTotalDataUI( total_data ) {\n\n\t\tvar render_args = null;\n\n\t\tfor ( var key in total_data ) {\n\t\t\tvar row = total_data[key];\n\n\t\t\tif ( typeof row === 'object' ) {\n\t\t\t\tif ( key === 'owing' ) {\n\t\t\t\t\tthis.owing_amount = row.amount;\n\t\t\t\t}\n\t\t\t\tif ( Global.isSet( row.amount ) && ( parseFloat( row.amount ) !== 0 || ( key === 'owing' && parseFloat( total_data.paid.amount ) === 0 && parseFloat( total_data.previous_balance.amount ) !== 0 ) ) ) {\n\t\t\t\t\trender_args = { label: row.name, value: row.amount };\n\t\t\t\t\tvar template = _.template( this.total_data_row_render );\n\t\t\t\t\tthis.total_data_render.append( template( render_args ) );\n\t\t\t\t} else {\n\t\t\t\t\tthis.viewTotalDataUI( row );\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\n\t\treturn render_args;\n\t}\n\n\tgetShippingOptions( transaction_data ) {\n\t\tvar $this = this;\n\t\tvar transaction_record;\n\t\tif ( Global.isSet( transaction_data ) ) {\n\t\t\ttransaction_record = transaction_data;\n\t\t} else {\n\t\t\ttransaction_record = this.editor.getValue();\n\t\t}\n\n\t\tif ( this.transaction_paid_data ) {\n\t\t\tvar temp_transaction_record = [];\n\t\t\t$.each( transaction_record, function( key, item ) {\n\t\t\t\ttemp_transaction_record.push( item );\n\t\t\t} );\n\t\t\t$.each( this.transaction_paid_data, function( key, item ) {\n\t\t\t\ttemp_transaction_record.push( item );\n\t\t\t} );\n\n\t\t\ttransaction_record = temp_transaction_record;\n\t\t}\n\n\t\tthis.api.getShippingOptions( transaction_record, this.current_edit_record, {\n\t\t\tonResult: function( res ) {\n\n\t\t\t\tif ( !$this.edit_view ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar result = res.getResult();\n\t\t\t\tvar combined_shipping_policy_id = $this.current_edit_record.combined_shipping_policy_id;\n\t\t\t\t$this.edit_view_ui_dic['combined_shipping_policy_id'].setSourceData( Global.buildRecordArray( result ) );\n\t\t\t\t$this.edit_view_ui_dic['combined_shipping_policy_id'].setValue( combined_shipping_policy_id );\n\t\t\t}\n\t\t} );\n\t}\n\n\tupdateStatus() {\n\t\tvar $this = this;\n\t\tthis.api['updateStatus']( this.current_edit_record.id, {\n\t\t\tonResult: function( res ) {\n\t\t\t\tif ( res && res.isValid() ) {\n\t\t\t\t\tvar status_id = res.getResult();\n\t\t\t\t\t$this.edit_view_ui_dic['status_id'].setValue( status_id );\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t}\n\n\tinitSubClientContactView() {\n\t\tvar $this = this;\n\n\t\tif ( !this.current_edit_record.id ) {\n\t\t\tTTPromise.resolve( 'BaseViewController', 'onTabShow' ); //Since search() isn't called in this case, and we just display the \"Please Save This Record ...\" message, resolve the promise.\n\t\t\treturn;\n\t\t}\n\n\t\tif ( this.sub_client_contact_view_controller ) {\n\t\t\tthis.sub_client_contact_view_controller.buildContextMenu( true );\n\t\t\tthis.sub_client_contact_view_controller.setDefaultMenu();\n\t\t\t$this.sub_client_contact_view_controller.parent_key = 'client_id';\n\t\t\t$this.sub_client_contact_view_controller.parent_value = $this.current_edit_record.client_id;\n\t\t\t$this.sub_client_contact_view_controller.parent_edit_record = $this.current_edit_record;\n\t\t\t$this.sub_client_contact_view_controller.initData();\n\t\t\treturn;\n\t\t}\n\n\t\tGlobal.loadScript( 'views/invoice/client_contact/ClientContactViewController.js', function() {\n\t\t\tvar tab_client_contacts = $this.edit_view_tab.find( '#tab_client_contacts' );\n\t\t\tvar firstColumn = tab_client_contacts.find( '.first-column-sub-view' );\n\n\t\t\tGlobal.trackView( 'Sub' + 'ClientContact' + 'View' );\n\t\t\tClientContactViewController.loadSubView( firstColumn, beforeLoadView, afterLoadView );\n\n\t\t} );\n\n\t\tfunction beforeLoadView() {\n\n\t\t}\n\n\t\tfunction afterLoadView( subViewController ) {\n\t\t\t$this.sub_client_contact_view_controller = subViewController;\n\t\t\t$this.sub_client_contact_view_controller.parent_key = 'client_id';\n\t\t\t$this.sub_client_contact_view_controller.parent_value = $this.current_edit_record.client_id;\n\t\t\t$this.sub_client_contact_view_controller.parent_edit_record = $this.current_edit_record;\n\t\t\t$this.sub_client_contact_view_controller.parent_view_controller = $this;\n\t\t\t$this.sub_client_contact_view_controller.postInit = function() {\n\t\t\t\tthis.initData();\n\t\t\t};\n\t\t}\n\t}\n\n\tinitSubClientPaymentView() {\n\t\tvar $this = this;\n\n\t\tif ( !this.current_edit_record.id ) {\n\t\t\tTTPromise.resolve( 'BaseViewController', 'onTabShow' ); //Since search() isn't called in this case, and we just display the \"Please Save This Record ...\" message, resolve the promise.\n\t\t\treturn;\n\t\t}\n\n\t\tif ( this.sub_client_payment_view_controller ) {\n\t\t\tthis.sub_client_payment_view_controller.buildContextMenu( true );\n\t\t\tthis.sub_client_payment_view_controller.setDefaultMenu();\n\t\t\t$this.sub_client_payment_view_controller.parent_key = 'client_id';\n\t\t\t$this.sub_client_payment_view_controller.parent_value = $this.current_edit_record.client_id;\n\t\t\t$this.sub_client_payment_view_controller.parent_edit_record = $this.current_edit_record;\n\t\t\t$this.sub_client_payment_view_controller.initData();\n\t\t\treturn;\n\t\t}\n\n\t\tGlobal.loadScript( 'views/invoice/client_payment/ClientPaymentViewController.js', function() {\n\t\t\tvar tab_payment_methods = $this.edit_view_tab.find( '#tab_payment_methods' );\n\t\t\tvar firstColumn = tab_payment_methods.find( '.first-column-sub-view' );\n\n\t\t\tGlobal.trackView( 'Sub' + 'ClientPayment' + 'View' );\n\t\t\tClientPaymentViewController.loadSubView( firstColumn, beforeLoadView, afterLoadView );\n\n\t\t} );\n\n\t\tfunction beforeLoadView() {\n\n\t\t}\n\n\t\tfunction afterLoadView( subViewController ) {\n\t\t\t$this.sub_client_payment_view_controller = subViewController;\n\t\t\t$this.sub_client_payment_view_controller.parent_key = 'client_id';\n\t\t\t$this.sub_client_payment_view_controller.parent_value = $this.current_edit_record.client_id;\n\t\t\t$this.sub_client_payment_view_controller.parent_edit_record = $this.current_edit_record;\n\t\t\t$this.sub_client_payment_view_controller.parent_view_controller = $this;\n\t\t\t$this.sub_client_payment_view_controller.postInit = function() {\n\t\t\t\tthis.initData();\n\t\t\t};\n\t\t}\n\t}\n\n\tinitSubTransactionView() {\n\t\tvar $this = this;\n\n\t\tif ( !this.current_edit_record.id ) {\n\t\t\tTTPromise.resolve( 'BaseViewController', 'onTabShow' ); //Since search() isn't called in this case, and we just display the \"Please Save This Record ...\" message, resolve the promise.\n\t\t\treturn;\n\t\t}\n\n\t\tif ( this.sub_transaction_view_controller ) {\n\t\t\tthis.sub_transaction_view_controller.buildContextMenu( true );\n\t\t\tthis.sub_transaction_view_controller.setDefaultMenu();\n\t\t\t$this.sub_transaction_view_controller.parent_key = 'invoice_id';\n\t\t\t$this.sub_transaction_view_controller.parent_value = $this.current_edit_record.id;\n\t\t\t$this.sub_transaction_view_controller.parent_edit_record = $this.current_edit_record;\n\t\t\t$this.sub_transaction_view_controller.initData();\n\t\t\treturn;\n\t\t}\n\n\t\tGlobal.loadScript( 'views/invoice/invoice_transaction/InvoiceTransactionViewController.js', function() {\n\t\t\tvar tab_transactions = $this.edit_view_tab.find( '#tab_transactions' );\n\t\t\tvar firstColumn = tab_transactions.find( '.first-column-sub-view' );\n\n\t\t\tGlobal.trackView( 'Sub' + 'InvoiceTransaction' + 'View' );\n\t\t\tInvoiceTransactionViewController.loadSubView( firstColumn, beforeLoadView, afterLoadView );\n\n\t\t} );\n\n\t\tfunction beforeLoadView() {\n\n\t\t}\n\n\t\tfunction afterLoadView( subViewController ) {\n\t\t\t$this.sub_transaction_view_controller = subViewController;\n\t\t\t$this.sub_transaction_view_controller.parent_key = 'invoice_id';\n\t\t\t$this.sub_transaction_view_controller.parent_value = $this.current_edit_record.id;\n\t\t\t$this.sub_transaction_view_controller.parent_edit_record = $this.current_edit_record;\n\t\t\t$this.sub_transaction_view_controller.parent_view_controller = $this;\n\t\t\t$this.sub_transaction_view_controller.postInit = function() {\n\t\t\t\tthis.initData();\n\t\t\t};\n\t\t}\n\t}\n\n\tremoveEditView() {\n\t\tsuper.removeEditView();\n\t\tthis.history = null;\n\t\tthis.editor = null;\n\t\tthis.total_data_render = null;\n\t\tthis.total_data_row_render = null;\n\t\tthis.transaction_paid_data = null;\n\t\tthis.sub_client_contact_view_controller = null;\n\t\tthis.sub_client_payment_view_controller = null;\n\t\tthis.sub_transaction_view_controller = null;\n\t}\n\n\tinsideEditorAddRow( data, index ) {\n\t\tvar form_item_input;\n\t\tvar widgetContainer;\n\n\t\tvar row = this.getRowRender(); //Get Row render\n\t\tvar render = this.getRender(); //get render, should be a table\n\t\tvar widgets = {}; //Save each row's widgets\n\n\t\tvar $this = this;\n\t\tif ( !data ) {\n\t\t\tthis.getDefaultData( index );\n\t\t} else {\n\n\t\t\t//Save current set item\n\t\t\twidgets.current_edit_item = data;\n\n\t\t\t//Build row widgets\n\n\t\t\t// Product\n\t\t\tvar args = {};\n\t\t\targs.filter_data = {};\n\t\t\targs.filter_data.type_id = [10, 20];\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\twidth: 203,\n\t\t\t\tis_static_width: true,\n\t\t\t\tapi_class: TTAPI.APIProduct,\n\t\t\t\tallow_multiple_selection: false,\n\t\t\t\tlayout_name: 'global_product',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tfield: 'product_id'\n\t\t\t} );\n\t\t\tform_item_input.setDefaultArgs( args );\n\t\t\tform_item_input.setValue( data.product_id ? data.product_id : '' );\n\t\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\t\trow.children().eq( 0 ).append( form_item_input );\n\n\t\t\tthis.setWidgetEnableBaseOnParentController( form_item_input );\n\n\t\t\tform_item_input.bind( 'formItemChange', function( e, target ) {\n\t\t\t\t$this.parent_controller.onRowChanges( $( this ).parent().parent().index() - 1, target );\n\t\t\t} );\n\n\t\t\t// Description\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tform_item_input.TTextInput( { field: 'description', width: 500 } );\n\t\t\tform_item_input.setValue( data.description ? data.description : '' );\n\t\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\t\trow.children().eq( 1 ).append( form_item_input );\n\n\t\t\tthis.setWidgetEnableBaseOnParentController( form_item_input );\n\n\t\t\t// QTY\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tform_item_input.TTextInput( { field: 'quantity', width: 40, no_validate_timer_sec: 100 } );\n\t\t\tform_item_input.setValue( data.quantity ? data.quantity : '' );\n\n\t\t\tform_item_input.bind( 'formItemChange', function( e, target, doNotValidate ) {\n\t\t\t\tif ( doNotValidate ) {\n\t\t\t\t\t$this.parent_controller.onRowChanges( $( this ).parent().parent().index() - 1, target );\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\t\trow.children().eq( 2 ).append( form_item_input );\n\n\t\t\tthis.setWidgetEnableBaseOnParentController( form_item_input );\n\n\t\t\t// Price\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tform_item_input.TTextInput( { field: 'unit_price', width: 50, no_validate_timer_sec: 100 } );\n\t\t\tform_item_input.setValue( data.unit_price ? data.unit_price : '' );\n\n\t\t\tform_item_input.bind( 'formItemChange', function( e, target, doNotValidate ) {\n\t\t\t\tif ( doNotValidate ) {\n\t\t\t\t\t$this.parent_controller.onRowChanges( $( this ).parent().parent().index() - 1, target );\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\t\trow.children().eq( 3 ).append( form_item_input );\n\n\t\t\tthis.setWidgetEnableBaseOnParentController( form_item_input );\n\n\t\t\t// ProRate\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tform_item_input.TTextInput( { field: 'pro_rate_numerator', width: 30, no_validate_timer_sec: 100 } );\n\t\t\tform_item_input.setValue( data.pro_rate_numerator ? data.pro_rate_numerator : 1 );\n\t\t\tform_item_input.attr( 'maxlength', 3 );\n\n\t\t\tform_item_input.bind( 'formItemChange', function( e, target, doNotValidate ) {\n\t\t\t\tif ( doNotValidate ) {\n\t\t\t\t\t$this.parent_controller.onRowChanges( $( this ).parent().parent().parent().index() - 1, target );\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\t\twidgetContainer.append( form_item_input );\n\n\t\t\tvar label = $( '<span class=\\'widget-right-label\\'>/</span>' );\n\t\t\twidgetContainer.append( label );\n\n\t\t\tthis.setWidgetEnableBaseOnParentController( form_item_input );\n\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tform_item_input.TTextInput( { field: 'pro_rate_denominator', width: 30, no_validate_timer_sec: 100 } );\n\t\t\tform_item_input.setValue( data.pro_rate_denominator ? data.pro_rate_denominator : 1 );\n\t\t\tform_item_input.attr( 'maxlength', 3 );\n\n\t\t\tform_item_input.bind( 'formItemChange', function( e, target, doNotValidate ) {\n\t\t\t\tif ( doNotValidate ) {\n\t\t\t\t\t$this.parent_controller.onRowChanges( $( this ).parent().parent().parent().index() - 1, target );\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\t\twidgetContainer.append( form_item_input );\n\n\t\t\trow.children().eq( 4 ).append( widgetContainer );\n\n\t\t\tthis.setWidgetEnableBaseOnParentController( form_item_input );\n\n\t\t\t// Total\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tform_item_input.TTextInput( { field: 'amount', width: 100 } );\n\t\t\tform_item_input.setValue( data.amount ? data.amount : '' );\n\t\t\tform_item_input.setReadOnly( true );\n//\t\t\tform_item_input.attr( 'readonly', 'readonly' );\n\n\t\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\t\trow.children().eq( 5 ).append( form_item_input );\n\n\t\t\tif ( typeof index != 'undefined' ) {\n\n\t\t\t\trow.insertAfter( $( render ).find( 'tr' ).eq( index ) );\n\t\t\t\tthis.rows_widgets_array.splice( ( index ), 0, widgets );\n\n\t\t\t} else {\n\t\t\t\t$( render ).append( row );\n\t\t\t\tthis.rows_widgets_array.push( widgets );\n\t\t\t}\n\t\t\tif ( this.parent_controller.is_viewing ) {\n\t\t\t\trow.find( '.control-icon' ).hide();\n\t\t\t}\n\n\t\t\tthis.setWidgetEnableBaseOnParentController( form_item_input );\n\n\t\t\tvar plus_icon = row.find( '.plus-icon' );\n\t\t\tvar minus_icon = row.find( '.minus-icon' );\n\n\t\t\tplus_icon.click( function() {\n\t\t\t\t$this.parent_controller.setPaymentIconDisabled();\n\t\t\t\t$this.addRow( null, $( this ).parent().parent().index() );\n\t\t\t} );\n\n\t\t\tminus_icon.click( function() {\n\t\t\t\t$this.parent_controller.setPaymentIconDisabled();\n\t\t\t\t$this.removeRow( row );\n\n\t\t\t\tif ( render.find( 'tr' ).length === 1 ) {\n\t\t\t\t\t$this.addRow();\n\t\t\t\t}\n\n\t\t\t} );\n\n//\t\t\tthis.addIconsEvent( row ); //Bind event to add and minus icon\n\t\t\tthis.removeLastRowLine();\n\t\t}\n\n\t\tif ( data && TTUUID.isUUID( data.product_id ) && data.product_id != TTUUID.zero_id ) {\n\t\t\tvar filter = {};\n\t\t\tfilter.filter_data = {};\n\t\t\tfilter.filter_data.id = data.product_id;\n\t\t\tfilter.filter_columns = { id: true, price_locked: true, description_locked: true };\n\t\t\tthis.parent_controller.product_api['get' + this.parent_controller.product_api.key_name]( filter, {\n\t\t\t\tonResult: function( res ) {\n\t\t\t\t\tvar result = res.getResult()[0];\n\t\t\t\t\twidgets['description'].setReadOnly( result.description_locked );\n\t\t\t\t\twidgets['unit_price'].setReadOnly( result.price_locked );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t}\n\n\tinsideEditorRemoveRow( row ) {\n\t\tvar index = row[0].rowIndex - 1;\n\t\tvar remove_id = this.rows_widgets_array[index].current_edit_item.id;\n\t\tif ( TTUUID.isUUID( remove_id ) && remove_id != TTUUID.zero_id && remove_id != TTUUID.not_exist_id ) {\n\t\t\tthis.delete_ids.push( remove_id );\n\t\t}\n\t\trow.remove();\n\t\tthis.rows_widgets_array.splice( index, 1 );\n\t\tthis.parent_controller.getInvoiceTotalData();\n\t\tthis.removeLastRowLine();\n\t}\n\n\tonRowChanges( index, target ) {\n\t\tthis.setPaymentIconDisabled();\n\t\tvar $this = this;\n\t\tvar current_row = this.editor.rows_widgets_array[index];\n\t\tvar key = target.getField();\n\t\tvar value = target.getValue();\n\t\tvar filter = {};\n\t\tfilter.filter_data = {};\n\t\tfilter.filter_columns = {};\n\t\tfilter.filter_columns.description = true;\n\t\tfilter.filter_columns.name = true;\n\t\tfilter.filter_columns.part_number = true;\n\t\tfilter.filter_columns.type_id = true;\n\t\tfilter.filter_columns.currency_id = true;\n\t\tfilter.filter_columns.id = true;\n\t\tfilter.filter_columns.price_locked = true;\n\t\tfilter.filter_columns.description_locked = true;\n\n\t\tswitch ( key ) {\n\t\t\tcase 'quantity':\n\t\t\tcase 'product_id':\n\t\t\t\tvar product_id;\n\t\t\t\tvar quantity;\n\t\t\t\tif ( key === 'product_id' ) {\n\t\t\t\t\tquantity = 1;\n\t\t\t\t\tproduct_id = value;\n\t\t\t\t} else {\n\t\t\t\t\tquantity = value;\n\t\t\t\t\tproduct_id = current_row['product_id'].getValue();\n\t\t\t\t}\n\t\t\t\tif ( TTUUID.isUUID( product_id ) && product_id != TTUUID.zero_id ) {\n\t\t\t\t\tfilter.filter_data.id = product_id;\n\t\t\t\t\tthis.product_api['get' + this.product_api.key_name]( filter, {\n\t\t\t\t\t\tonResult: function( p_res ) {\n\t\t\t\t\t\t\tvar result_data = p_res.getResult()[0];\n\t\t\t\t\t\t\tif ( key === 'product_id' ) {\n\t\t\t\t\t\t\t\tcurrent_row['description'].setValue( result_data['description'] );\n\t\t\t\t\t\t\t\tcurrent_row['description'].setReadOnly( result_data['description_locked'] );\n\t\t\t\t\t\t\t\tcurrent_row['unit_price'].setReadOnly( result_data['price_locked'] );\n\n\t\t\t\t\t\t\t\tcurrent_row['current_edit_item']['product_type_id'] = result_data['type_id'];\n\t\t\t\t\t\t\t\tcurrent_row['current_edit_item']['product_name'] = result_data['name'];\n\t\t\t\t\t\t\t\tcurrent_row['current_edit_item']['product_part_number'] = result_data['part_number'];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( result_data.id && $this.current_edit_record && $this.current_edit_record['currency_id'] ) {\n\t\t\t\t\t\t\t\t$this.product_api['getProductQuantityUnitPrice']( result_data.id, quantity, $this.current_edit_record['currency_id'], {\n\t\t\t\t\t\t\t\t\tonResult: function( u_res ) {\n\t\t\t\t\t\t\t\t\t\tvar unit_price = u_res.getResult();\n\t\t\t\t\t\t\t\t\t\tif ( key === 'product_id' ) {\n\t\t\t\t\t\t\t\t\t\t\tcurrent_row['quantity'].setValue( quantity );\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tcurrent_row['unit_price'].setValue( unit_price );\n\t\t\t\t\t\t\t\t\t\t$this.calcTransactionRowTotal( current_row );\n\t\t\t\t\t\t\t\t\t\tif ( $this.editor && $this.editor.rows_widgets_array ) {\n\t\t\t\t\t\t\t\t\t\t\t$this.editor.rows_widgets_array[index] = current_row;\n\t\t\t\t\t\t\t\t\t\t\tvar transaction_data = $this.editor.getValue();\n\t\t\t\t\t\t\t\t\t\t\t$this.getInvoiceTotalData( transaction_data );\n\t\t\t\t\t\t\t\t\t\t\t$this.getShippingOptions( transaction_data );\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'pro_rate_numerator':\n\t\t\tcase 'pro_rate_denominator':\n\t\t\tcase 'unit_price':\n\t\t\t\tthis.calcTransactionRowTotal( current_row );\n\t\t\t\tvar transaction_data = $this.editor.getValue();\n\t\t\t\tthis.getInvoiceTotalData( transaction_data );\n\t\t\t\tthis.getShippingOptions( transaction_data );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tcalcTransactionRowTotal( current_row ) {\n\t\tvar total = 0.00;\n\t\tvar pro_rate_numerator = parseFloat( current_row['pro_rate_numerator'].getValue() );\n\t\tvar pro_rate_denominator = parseFloat( current_row['pro_rate_denominator'].getValue() );\n\t\tvar quantity = parseFloat( current_row['quantity'].getValue() );\n\t\tvar unit_price = parseFloat( current_row['unit_price'].getValue() );\n\n\t\tif ( ( !isNaN( quantity ) && isFinite( quantity ) ) && ( !isNaN( unit_price ) && isFinite( unit_price ) ) ) {\n\t\t\ttotal = ( quantity * unit_price );\n\t\t}\n\n\t\tif ( ( !isNaN( pro_rate_numerator ) && isFinite( pro_rate_numerator ) && pro_rate_numerator != 0 ) && ( !isNaN( pro_rate_denominator ) && isFinite( pro_rate_denominator ) && pro_rate_denominator != 0 ) ) {\n\t\t\ttotal = ( total * ( pro_rate_numerator / pro_rate_denominator ) );\n\t\t}\n\n\t\tcurrent_row['amount'].setValue( parseFloat( total ).toFixed( 2 ) );\n\t}\n\n\tinsideEditorGetValue( current_edit_item_id ) {\n\t\tvar len = this.rows_widgets_array.length;\n\n\t\tvar result = [];\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\n\t\t\tvar row = this.rows_widgets_array[i];\n\t\t\tvar data = {};\n\t\t\tdata['status_id'] = row.current_edit_item['status_id'];\n\t\t\tdata['product_part_number'] = row.current_edit_item['product_part_number'];\n\t\t\tdata['id'] = row.current_edit_item['id'];\n\t\t\tdata['description'] = row.current_edit_item['description'];\n\t\t\tdata['product_name'] = row.current_edit_item['product_name'];\n\t\t\tdata['amount'] = row.current_edit_item['amount'];\n\t\t\tdata['unit_price'] = row.current_edit_item['unit_price'];\n\t\t\tdata['product_type_id'] = row.current_edit_item['product_type_id'];\n\t\t\tdata['type_id'] = row.current_edit_item['type_id'];\n\t\t\tdata['pro_rate_denominator'] = row.current_edit_item['pro_rate_denominator'];\n\t\t\tdata['client_id'] = row.current_edit_item['client_id'];\n\t\t\tdata['quantity'] = row.current_edit_item['quantity'];\n\t\t\tdata['product_id'] = row.current_edit_item['product_id'];\n\t\t\tdata['invoice_id'] = row.current_edit_item['invoice_id'];\n\t\t\tdata['pro_rate_numerator'] = row.current_edit_item['pro_rate_numerator'];\n\t\t\tdata['effective_date'] = row.current_edit_item['effective_date'];\n\n\t\t\tvar product_id = row['product_id'].getValue();\n\n\t\t\tif ( typeof current_edit_item_id !== 'undefined' && ( current_edit_item_id === '' || current_edit_item_id === false ) ) {\n\t\t\t\tdata['id'] = '';\n\t\t\t\tdata['invoice_id'] = '';\n\t\t\t\tdata['type_id'] = 10;\n\t\t\t\tdata['effective_date'] = new Date().format();\n\t\t\t}\n\n\t\t\tif ( typeof data.effective_date === 'undefined' ) {\n\t\t\t\tdata['effective_date'] = new Date().format();\n\t\t\t}\n\n\t\t\tif ( typeof data.type_id === 'undefined' ) {\n\t\t\t\tdata['type_id'] = 10;\n\t\t\t}\n\n\t\t\tif ( TTUUID.isUUID( product_id ) && product_id != TTUUID.zero_id ) {\n\t\t\t\tdata['product_id'] = product_id;\n\t\t\t\tdata['quantity'] = row['quantity'].getValue();\n\t\t\t\tdata['pro_rate_numerator'] = row['pro_rate_numerator'].getValue();\n\t\t\t\tdata['description'] = row['description'].getValue();\n\t\t\t\tdata['pro_rate_denominator'] = row['pro_rate_denominator'].getValue();\n\t\t\t\tdata['amount'] = row['amount'].getValue();\n\t\t\t\tdata['unit_price'] = row['unit_price'].getValue();\n\t\t\t\tdata['client_id'] = this.parent_controller.current_edit_record['client_id'];\n\n\t\t\t\tresult.push( data );\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tuniformVariable( record ) {\n\n\t\tif ( !Global.isSet( record ) ) {\n\t\t\trecord = {};\n\t\t}\n\t\tvar transaction_data = this.editor.getValue( this.current_edit_record.id );\n\t\tif ( transaction_data.length > 0 ) {\n\t\t\trecord.transactions = transaction_data;\n\t\t}\n\n\t\treturn record;\n\t}\n\n\tonCopyAsNewResult( result ) {\n\t\tvar $this = this;\n\t\tvar result_data = result.getResult();\n\t\tif ( !result_data ) {\n\t\t\tTAlertManager.showAlert( $.i18n._( 'Record does not exist' ) );\n\t\t\t$this.onCancelClick();\n\t\t\treturn;\n\t\t}\n\n\t\t$this.openEditView(); // Put it here is to avoid if the selected one is not existed in data or have deleted by other pragram. in this case, the edit view should not be opend.\n\n\t\tresult_data = result_data[0];\n\t\tthis.copied_record_id = result_data.id;\n\n\t\tresult_data.id = '';\n\n\t\tresult_data.invoice_date = ( new Date ).format( Global.getLoginUserDateFormat() );\n\t\tresult_data.order_date = ( new Date ).format( Global.getLoginUserDateFormat() );\n\t\tresult_data.required_date = null;\n\t\tresult_data.shipped_date = null;\n\t\tresult_data.tracking_number = null;\n\n\t\tif ( $this.sub_view_mode && $this.parent_key ) {\n\t\t\tresult_data[$this.parent_key] = $this.parent_value;\n\t\t}\n\n\t\t$this.current_edit_record = result_data;\n\t\t$this.initEditView();\n\t}\n\n\tgetInvoiceTabHtml() {\n\t\treturn `<div id=\"tab_invoice\" class=\"edit-view-tab-outside\">\n\t\t\t\t\t<div class=\"edit-view-tab\" id=\"tab_invoice_content_div\">\n\t\t\t\t\t\t<div class=\"first-column\"></div>\n\t\t\t\t\t\t<div class=\"second-column\"></div>\n\t\t\t\t\t\t<div class=\"inside-editor-div full-width-column\" style=\"margin-bottom: 10px;\"></div>\n\t\t\t\t\t\t<div class=\"inside-total-data-editor-div\"></div>\n\t\t\t\t\t\t<div class=\"inside-transaction-history-div\"></div>\n\t\t\t\t\t\t<div class=\"third-column full-width-column\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>`;\n\t}\n\n}\n\nInvoiceViewController.loadSubView = function( container, beforeViewLoadedFun, afterViewLoadedFun ) {\n\n\tGlobal.loadViewSource( 'Invoice', 'SubInvoiceView.html', function( result ) {\n\t\tvar args = {};\n\t\tvar template = _.template( result );\n\n\t\tif ( Global.isSet( beforeViewLoadedFun ) ) {\n\t\t\tbeforeViewLoadedFun();\n\t\t}\n\n\t\tif ( Global.isSet( container ) ) {\n\t\t\tcontainer.html( template( args ) );\n\t\t\tif ( Global.isSet( afterViewLoadedFun ) ) {\n\t\t\t\tafterViewLoadedFun( sub_invoice_view_controller );\n\t\t\t}\n\t\t}\n\t} );\n};\n"],"names":["InvoiceViewController","options","_","$","context_menu_model","id","context_btn","grid_selected_length","pId","column_filter","display_columns","len","i","column_info","iconName","$this","grid_selected_id_array","filter","ids","client_ids","invoice_id","currency_id","index","value","grid_selected_row","args","post_data","postData","res","tab_model","tab_invoice","tab_invoice_column1","tab_invoice_column2","tab_invoice_column3","form_item_input","widgetContainer","label","inside_editor_div","getRender","getRowRender","email_invoice","email_cc","navigation_div","key","widget","context_icon","target","doNotValidate","c_value","result","client_id","filter_only","result_data","default_billing_contact_id","default_shipping_contact_id","default_other_contact_id","update_status","transaction_id","paid_res","paid","val","row","transaction_data","transaction_record","temp_transaction_record","item","render","row_render","title","history","template","render_div","v","tmp_template","total_data","render_args","combined_shipping_policy_id","status_id","tab_client_contacts","firstColumn","beforeLoadView","afterLoadView","subViewController","tab_payment_methods","tab_transactions","data","widgets","e","plus_icon","minus_icon","remove_id","current_row","product_id","quantity","p_res","u_res","unit_price","total","pro_rate_numerator","pro_rate_denominator","current_edit_item_id","record","container","beforeViewLoadedFun","afterViewLoadedFun"],"mappings":"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"}