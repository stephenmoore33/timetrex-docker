import{_ as b,j as s}from"./vendor-tTApdY0Y.bundle.js";class g extends BaseViewController{constructor(t={}){b.defaults(t,{el:"",batch_id:"",user_id:"",callback:null,events:{"click .done-btn":"onCloseClick"}}),super(t)}init(t){this.options=t,this.content_div=s(this.el).find(".content"),this.batch_id=this.options.batch_id,this.user_id=this.options.user_id,this.options.callback&&(this.callback=this.options.callback),this.api=TTAPI.APIUserGenericStatus,this.render(),this.initData()}initData(){var t=this;ProgressBar.showOverlay(),this.getAllColumns(function(){t.initLayout()})}initLayout(){var t=this;t.getDefaultDisplayColumns(function(){t.setSelectLayout(),t.search()})}onCloseClick(){s(this.el).remove(),this.callback&&this.callback()}render(){var t=s(this.el).find(".title");t.text(s.i18n._("Status Report"))}getAllColumns(t){var i=this;this.api.getOptions("columns",{onResult(l){var r=l.getResult();i.all_columns=Global.buildColumnArray(r),t&&t()}})}search(t){Global.isSet(t)||(t=!0);var i=this,l={};l.filter_data={},l.filter_data.batch_id=this.batch_id,l.filter_items_per_page=0,this.api.getUserGenericStatus(l,!0,{onResult:function(r){var e=r.getResult();e=Global.formatGridData(e,i.api.key_name),i.grid.setData(e),i.setGridSize(),ProgressBar.closeOverlay(),t&&i.setDefaultMenu(!0)}}),this.api.getUserGenericStatusCountArray(this.user_id,this.batch_id,{onResult:function(r){var e=r.getResult(),f=s(i.el).find(".failed"),u=s(i.el).find(".warning"),o=s(i.el).find(".success");e!=!0&&e.status&&(f.text(e.status[10].total+"/"+e.total+"( "+e.status[10].percent+"% )"),u.text(e.status[20].total+"/"+e.total+"( "+e.status[20].percent+"% )"),o.text(e.status[30].total+"/"+e.total+"( "+e.status[30].percent+"% )"));var a=s(i.el).find("#export-user-generic-status");a.find(".p-button-label").text(s.i18n._("Export")),a.unbind("click").bind("click",function(){i.select_layout.data.filter_data={batch_id:i.batch_id},i.onExportClick("export"+i.api.key_name)})}})}setGridSize(){}setSelectLayout(t){var i=this,l=[];this.select_layout={id:""},this.select_layout.data={filter_data:{},filter_sort:{}},this.select_layout.data.display_columns=this.default_display_columns;var r=this.select_layout.data,e=this.buildDisplayColumns(r.display_columns),f=e.length;r.display_columns.length<1&&(r.display_columns=this.default_display_columns);var u=0;Global.isSet(t)&&t>0&&(u=t);for(var o=u;o<f;o++){var a=e[o];if(a.value==="description")var p={name:a.value,index:a.value,label:a.label,width:400,sortable:!1,title:!1};else a.value==="status"?p={name:a.value,index:a.value,label:a.label,width:100,sortable:!1,title:!1,formatter:function(h,_,y){var d=s("<span></span>");return h==="Failed"?d.addClass("failed-label"):h==="Warning"?d.addClass("warning-label"):h==="Success"&&d.addClass("success-label"),d.text(h),d.get(0).outerHTML}}:p={name:a.value,index:a.value,label:a.label,width:100,sortable:!1,title:!1};l.push(p)}this.grid&&(this.grid.grid.jqGrid("GridUnload"),this.grid=null),this.grid=new TTGrid("user_generic_data_status_grid-"+this.batch_id,{altRows:!0,onSelectRow:s.proxy(this.onGridSelectRow,this),data:[],rowNum:1e4,sortable:!1,datatype:"local",width:600,colNames:[],viewrecords:!0},l);var c=s(this.el).find(".content");this.grid.grid.setGridWidth(c.width()-2),this.grid.grid.setGridHeight(c.height()-25),s(window).off("resize.user_generic_status_window").on("resize.user_generic_status_window",function(){i.grid.grid.setGridWidth(c.width()-2),i.grid.grid.setGridHeight(c.height()-25)}),this.filter_data=this.select_layout.data.filter_data}}g.open=function(n,t,i){Global.loadViewSource("UserGenericStatus","UserGenericStatusWindow.css"),Global.loadViewSource("UserGenericStatus","UserGenericStatusWindow.html",function(l){if(TTUUID.isUUID(n)==!0){var r={batch_id:n,failed:s.i18n._("Failed"),warning:s.i18n._("Warning"),success:s.i18n._("Success")},e=b.template(l);s("body").append(e(r)),new g({el:"#"+n,batch_id:n,user_id:t,can_cache_controller:!1,callback:i})}else TAlertManager.showAlert(s.i18n._("Status report is empty. Please try again.",LocalCacheData.getApplicationName()),s.i18n._("NOTICE"))})};export{g as UserGenericStatusWindowController};
//# sourceMappingURL=UserGenericStatusWindowController-DLO9Dri0.bundle.js.map
