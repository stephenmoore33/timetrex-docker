const __vite__fileDeps=["./main_ui-CaF8IcSp.css","./leaflet-timetrex-DIHfnHxo.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{_ as E}from"./main_ui-z76rxVqJ.entry.bundle.js";import{_ as I,j as s}from"./vendor-tTApdY0Y.bundle.js";import"./TImage-D3G3HRb1.bundle.js";class S extends BaseViewController{constructor(e={}){I.defaults(e,{el:"#punches_view_container",old_type_status:{},user_api:null,user_group_api:null,api_station:null,type_array:null,punch_tag_api:null,default_punch_tag:[],previous_punch_tag_selection:[],actual_time_label:null,location_mass_edit_check_box:null}),super(e)}init(e){this.edit_view_tpl="PunchesEditView.html",this.permission_id="punch",this.viewId="Punches",this.script_name="PunchesView",this.table_name_key="punch",this.context_menu_name=s.i18n._("Punches"),this.navigation_label=s.i18n._("Punch"),this.api=TTAPI.APIPunch,this.user_api=TTAPI.APIUser,this.user_group_api=TTAPI.APIUserGroup,Global.getProductEdition()>=20&&(this.job_api=TTAPI.APIJob,this.job_item_api=TTAPI.APIJobItem,this.punch_tag_api=TTAPI.APIPunchTag),this.api_station=TTAPI.APIStation,this.initPermission(),this.render(),this.buildContextMenu(),this.initData()}jobUIValidate(e){return e||(e="punch"),!!(PermissionManager.validate("job","enabled")&&PermissionManager.validate(e,"edit_job"))}jobItemUIValidate(e){return e||(e="punch"),!!(PermissionManager.validate("job_item","enabled")&&PermissionManager.validate(e,"edit_job_item"))}punchTagUIValidate(e){return e||(e="punch"),!!(PermissionManager.validate("punch_tag","enabled")&&PermissionManager.validate(e,"edit_punch_tag"))}branchUIValidate(e){return e||(e="punch"),!!PermissionManager.validate(e,"edit_branch")}departmentUIValidate(e){return e||(e="punch"),!!PermissionManager.validate(e,"edit_department")}goodQuantityUIValidate(e){return e||(e="punch"),!!PermissionManager.validate(e,"edit_quantity")}badQuantityUIValidate(e){return e||(e="punch"),!!(PermissionManager.validate(e,"edit_quantity")&&PermissionManager.validate(e,"edit_bad_quantity"))}transferUIValidate(e){return e||(e="punch"),!!PermissionManager.validate(e,"edit_transfer")}noteUIValidate(e){return e||(e="punch"),!!PermissionManager.validate(e,"edit_note")}locationUIValidate(e){return e||(e="punch"),!!PermissionManager.validate(e,"edit_location")}stationValidate(){return!!PermissionManager.validate("station","enabled")}initPermission(){super.initPermission(),this.jobUIValidate()?this.show_job_ui=!0:this.show_job_ui=!1,this.jobItemUIValidate()?this.show_job_item_ui=!0:this.show_job_item_ui=!1,this.punchTagUIValidate()?this.show_punch_tag_ui=!0:this.show_punch_tag_ui=!1,this.branchUIValidate()?this.show_branch_ui=!0:this.show_branch_ui=!1,this.departmentUIValidate()?this.show_department_ui=!0:this.show_department_ui=!1,this.goodQuantityUIValidate()?this.show_good_quantity_ui=!0:this.show_good_quantity_ui=!1,this.badQuantityUIValidate()?this.show_bad_quantity_ui=!0:this.show_bad_quantity_ui=!1,this.transferUIValidate()?this.show_transfer_ui=!0:this.show_transfer_ui=!1,this.noteUIValidate()?this.show_note_ui=!0:this.show_note_ui=!1,this.locationUIValidate()?this.show_location_ui=!0:this.show_location_ui=!1,this.stationValidate()?this.show_station_ui=!0:this.show_station_ui=!1}initOptions(){var e=this;this.initDropDownOption("type"),this.initDropDownOption("status","status_id",this.api,null,"status_array"),this.initDropDownOption("status","user_status_id",this.user_api,null,"user_status_array"),this.user_group_api.getUserGroup("",!1,!1,{onResult:function(i){i=i.getResult(),i=Global.buildTreeRecord(i),e.user_group_array=i,e.basic_search_field_ui_dic.group_id.setSourceData(i),e.adv_search_field_ui_dic.group_id.setSourceData(i)}})}onEditStationDone(){this.setStation()}setStation(){var e=this,i={filter_data:{id:this.current_edit_record.station_id}};this.api_station.getStation(i,{onResult:function(t){e.station=t.getResult()[0];var a=e.edit_view_ui_dic.station_id;a.setValue(e.station.type+"-"+e.station.description),a.css("cursor","pointer")}})}uniformVariable(e){if(this.is_mass_editing==!1&&(e=this.buildMassAddRecord(e)),Array.isArray(e))for(let i=0;i<e.length;i++)e[i].hasOwnProperty("time_stamp")||(e[i].time_stamp=!1);else e.hasOwnProperty("time_stamp")||(e.time_stamp=!1);return e}getCustomFieldReferenceField(){return"note"}buildEditViewUI(){super.buildEditViewUI();var e=this,i={tab_punch:{label:s.i18n._("Punch")},tab_audit:!0};this.setTabModel(i);var t,a;this.navigation.AComboBox({api_class:TTAPI.APIPunch,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_punch",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation();var r=this.edit_view_tab.find("#tab_punch"),n=r.find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(n),t=Global.loadWidgetByName(FormItemType.AWESOME_BOX),t.AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!0,layout_name:"global_user",show_search_inputs:!0,set_empty:!0,field:"user_id"});var _={};_.permission_section="punch",t.setDefaultArgs(_),this.addEditFieldToColumn(s.i18n._("Employee"),t,n,"",null,!0),t=Global.loadWidgetByName(FormItemType.TIME_PICKER),t.TTimePicker({field:"punch_time",validation_field:"time_stamp"}),a=s("<div class='widget-h-box'></div>"),this.actual_time_label=s("<span class='widget-right-label'></span>"),a.append(t),a.append(this.actual_time_label),this.addEditFieldToColumn(s.i18n._("Time"),t,n,"",a),t=Global.loadWidgetByName(FormItemType.DATE_PICKER),t.TDatePicker({field:"punch_date",validation_field:"date_stamp"}),this.addEditFieldToColumn(s.i18n._("Date"),t,n,"",null,!0),t=Global.loadWidgetByName(FormItemType.DATE_PICKER),t.TRangePicker({field:"punch_dates",validation_field:"date_stamp"}),this.addEditFieldToColumn(s.i18n._("Date"),t,n,"",null,!0),t=Global.loadWidgetByName(FormItemType.CHECKBOX),t.TCheckbox({field:"transfer"}),this.addEditFieldToColumn(s.i18n._("Transfer"),t,n,"",null,!0),(this.show_transfer_ui==!1||this.is_add==!1)&&this.detachElement("transfer"),t=Global.loadWidgetByName(FormItemType.COMBO_BOX),t.TComboBox({field:"type_id"}),t.setSourceData(e.type_array),a=s("<div class='widget-h-box'></div>");var d=Global.loadWidgetByName(FormItemType.CHECKBOX);d.TCheckbox({field:"disable_rounding"});var o=s("<span class='widget-right-label'>"+s.i18n._("Disable Rounding")+"</span>");if(a.append(t),this.is_viewing||PermissionManager.validate("punch","edit_disable_rounding")==!1?this.addEditFieldToColumn(s.i18n._("Punch Type"),t,n,"",a,!0):(a.append(o),a.append(d),this.addEditFieldToColumn(s.i18n._("Punch Type"),[t,d],n,"",a,!0)),t=Global.loadWidgetByName(FormItemType.COMBO_BOX),t.TComboBox({field:"status_id"}),t.setSourceData(e.status_array),this.addEditFieldToColumn(s.i18n._("In/Out"),t,n),t=Global.loadWidgetByName(FormItemType.AWESOME_BOX),t.AComboBox({api_class:TTAPI.APIBranch,allow_multiple_selection:!1,layout_name:"global_branch",show_search_inputs:!0,set_empty:!0,field:"branch_id",addition_source_function:function(l,u){return e.onSourceDataCreate(l,u)},added_items:[{value:TTUUID.not_exist_id,label:Global.default_item},{value:"ffffffff-ffff-ffff-ffff-000000000002",label:s.i18n._("-- Current Shift --")}]}),this.addEditFieldToColumn(s.i18n._("Branch"),t,n,"",null,!0),this.show_branch_ui||this.detachElement("branch_id"),t=Global.loadWidgetByName(FormItemType.AWESOME_BOX),t.AComboBox({api_class:TTAPI.APIDepartment,allow_multiple_selection:!1,layout_name:"global_department",show_search_inputs:!0,set_empty:!0,field:"department_id",addition_source_function:function(l,u){return e.onSourceDataCreate(l,u)},added_items:[{value:TTUUID.not_exist_id,label:Global.default_item},{value:"ffffffff-ffff-ffff-ffff-000000000002",label:s.i18n._("-- Current Shift --")}]}),this.addEditFieldToColumn(s.i18n._("Department"),t,n,"",null,!0),this.show_department_ui||this.detachElement("department_id"),Global.getProductEdition()>=20){t=Global.loadWidgetByName(FormItemType.AWESOME_BOX),t.AComboBox({api_class:TTAPI.APIJob,allow_multiple_selection:!1,layout_name:"global_job",show_search_inputs:!0,set_empty:!0,setRealValueCallBack:function(l){l&&c.setValue(l.manual_id)},field:"job_id",addition_source_function:function(l,u){return e.onSourceDataCreate(l,u)},added_items:[{value:TTUUID.not_exist_id,label:Global.default_item},{value:"ffffffff-ffff-ffff-ffff-000000000002",label:s.i18n._("-- Current Shift --")}]}),a=s("<div class='widget-h-box'></div>");var c=Global.loadWidgetByName(FormItemType.TEXT_INPUT);c.TTextInput({field:"job_quick_search",disable_keyup_event:!0}),c.addClass("job-coder"),a.append(c),a.append(t),this.addEditFieldToColumn(s.i18n._("Job"),[t,c],n,"",a,!0),this.show_job_ui||this.detachElement("job_id"),t=Global.loadWidgetByName(FormItemType.AWESOME_BOX),t.AComboBox({api_class:TTAPI.APIJobItem,allow_multiple_selection:!1,layout_name:"global_job_item",show_search_inputs:!0,set_empty:!0,setRealValueCallBack:function(l){l&&h.setValue(l.manual_id)},field:"job_item_id",addition_source_function:function(l,u){return e.onSourceDataCreate(l,u)},added_items:[{value:TTUUID.not_exist_id,label:Global.default_item},{value:"ffffffff-ffff-ffff-ffff-000000000002",label:s.i18n._("-- Current Shift --")}]}),a=s("<div class='widget-h-box'></div>");var h=Global.loadWidgetByName(FormItemType.TEXT_INPUT);h.TTextInput({field:"job_item_quick_search",disable_keyup_event:!0}),h.addClass("job-coder"),a.append(h),a.append(t),this.addEditFieldToColumn(s.i18n._("Task"),[t,h],n,"",a,!0),this.show_job_item_ui||this.detachElement("job_item_id"),t=Global.loadWidgetByName(FormItemType.AWESOME_BOX),t.AComboBox({api_class:TTAPI.APIPunchTag,allow_multiple_selection:!0,layout_name:"global_punch_tag",show_search_inputs:!0,set_empty:!0,get_real_data_on_multi:!0,setRealValueCallBack:(l,u)=>{l&&this.setPunchTagQuickSearchManualIds(l,u)},field:"punch_tag_id"}),a=s("<div class='widget-h-box'></div>");var v=Global.loadWidgetByName(FormItemType.TEXT_INPUT);v.TTextInput({field:"punch_tag_quick_search",disable_keyup_event:!0}),v.addClass("job-coder"),a.append(v),a.append(t),this.addEditFieldToColumn(s.i18n._("Tags"),[t,v],n,"",a,!0),this.show_punch_tag_ui||this.detachElement("punch_tag_id")}if(Global.getProductEdition()>=20){var m=Global.loadWidgetByName(FormItemType.TEXT_INPUT);m.TTextInput({field:"quantity",width:40}),m.addClass("quantity-input");var T=s("<span class='widget-right-label'>"+s.i18n._("Good")+": </span>"),p=Global.loadWidgetByName(FormItemType.TEXT_INPUT);p.TTextInput({field:"bad_quantity",width:40}),p.addClass("quantity-input");var y=s("<span class='widget-right-label'>/ "+s.i18n._("Bad")+": </span>");a=s("<div class='widget-h-box'></div>"),a.append(T),a.append(m),a.append(y),a.append(p),this.addEditFieldToColumn(s.i18n._("Quantity"),[m,p],n,"",a,!0),!this.show_bad_quantity_ui&&!this.show_good_quantity_ui?this.detachElement("quantity"):(this.show_bad_quantity_ui||(y.hide(),p.hide()),this.show_good_quantity_ui||(T.hide(),m.hide()))}if(t=Global.loadWidgetByName(FormItemType.TEXT_AREA),t.TTextArea({field:"note",width:"100%"}),this.addEditFieldToColumn(s.i18n._("Note"),t,n,"",null,!0,!0),t.parent().width("45%"),this.show_note_ui||this.detachElement("note"),Global.getProductEdition()>=15){var f=Global.loadWidgetByName(FormItemType.TEXT);f.TText({field:"latitude"});var b=Global.loadWidgetByName(FormItemType.TEXT);b.TText({field:"longitude"}),a=s("<div class='widget-h-box link-widget-box'></div>");var g=Global.loadWidgetByName(FormItemType.TEXT);g.TText({field:"position_accuracy"}),o=s("<span class='widget-right-label'>"+s.i18n._("Accuracy")+":</span>");var w=s('<img class="widget-h-box-mapIcon" src="framework/leaflet/images/marker-icon-red.png" >');if(this.location_wrapper=s('<div class="widget-h-box-mapLocationWrapper"></div>'),a.append(w),a.append(this.location_wrapper),this.location_wrapper.append(f),this.location_wrapper.append(s("<span>, </span>")),this.location_wrapper.append(b),this.location_wrapper.append(o),this.location_wrapper.append(g),this.location_wrapper.append(s("<span>m</span>")),this.is_mass_editing){this.location_mass_edit_check_box=s(' <div class="mass-edit-checkbox-wrapper"><input type="checkbox" class="mass-edit-checkbox"></input><label for="checkbox-input-1" class="input-helper input-helper--checkbox"></label></div>'),this.location_mass_edit_check_box.insertBefore(s(w)),this.location_mass_edit_check_box.change(()=>{this.trigger("formItemChange",[this.edit_view_ui_dic.longitude]),this.trigger("formItemChange"[this.edit_view_ui_dic.latitude]),this.trigger("position_accuracy"[this.edit_view_ui_dic.position_accuracy])});let l=()=>this.location_mass_edit_check_box.find(".mass-edit-checkbox")[0].checked,u=()=>!0;b.isChecked=f.isChecked=g.isChecked=l,b.getEnabled=f.getEnabled=g.getEnabled=u}this.addEditFieldToColumn(s.i18n._("Location"),[f,b,g],n,"",a,!0),a.click(l=>{l.target.className!="mass-edit-checkbox"&&this.onMapClick()}),(!this.is_edit&&!this.is_viewing&&!this.is_mass_editing||!this.show_location_ui)&&a.parents(".edit-view-form-item-div").hide()}t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"station_id"}),this.addEditFieldToColumn(s.i18n._("Station"),t,n,"",null,!0,!0),t.click(function(){e.current_edit_record.station_id&&e.show_station_ui&&IndexViewController.openEditView(e,"Station",e.current_edit_record.station_id)}),t=Global.loadWidgetByName(FormItemType.CHECKBOX),t.TCheckbox({field:"split_punch_control"}),this.addEditFieldToColumn(s.i18n._("Split Existing Punches"),t,n,"",null,!0),this.is_add==!1&&this.detachElement("split_punch_control"),t=Global.loadWidgetByName(FormItemType.IMAGE),t.TImage({field:"punch_image"}),this.addEditFieldToColumn(s.i18n._("Image"),t,n,"",null,!0,!0),this.is_mass_editing&&(this.detachElement("punch_image"),this.detachElement("user_id"))}onSourceDataCreate(e,i){var t=e.getDisplayColumns(),a={},r={};return s.each(t,function(n,_){return a.id=TTUUID.not_exist_id,a[_.name]=Global.default_item,r.id="ffffffff-ffff-ffff-ffff-000000000002",r[_.name]=s.i18n._("-- Current Shift --"),!1}),(!i||s.type(i)!=="array")&&(i=[]),i.unshift(r),i.unshift(a),i}setEditViewWidgetsMode(){var e={};for(var i in this.edit_view_ui_dic)if(this.edit_view_ui_dic.hasOwnProperty(i)){var t=this.edit_view_ui_dic[i];this.edit_view_form_item_dic[i],t.css("opacity",1);var a=t.parent().parent().parent(),r=a.parent().attr("id");switch(a.hasClass("v-box")||e[r]||(e[r]=!0),i){case"punch_dates":!this.is_mass_editing&&(this.isMassAdding()||!this.current_edit_record.id||this.current_edit_record.id==TTUUID.zero_id)?(this.attachElement(i),t.css("opacity",1)):(this.detachElement(i),t.css("opacity",0));break;case"punch_date":!this.is_mass_editing&&(this.isMassAdding()||!this.current_edit_record.id||this.current_edit_record.id==TTUUID.zero_id)?(this.detachElement(i),t.css("opacity",0)):(this.attachElement(i),t.css("opacity",1));break}this.is_viewing?Global.isSet(t.setEnabled)&&t.setEnabled(!1):Global.isSet(t.setEnabled)&&t.setEnabled(!0)}}onTransferChanged(e){var i=!1;this.edit_view_ui_dic&&this.edit_view_ui_dic.transfer&&this.edit_view_ui_dic.transfer.getValue()==!0&&(i=!0);var t=this.edit_view_ui_dic.type_id,a=this.edit_view_ui_dic.status_id;i&&t&&a?(t.setEnabled(!1),a.setEnabled(!1),this.old_type_status.type_id=t.getValue(),this.old_type_status.status_id=a.getValue(),t.setValue(10),a.setValue(10),this.current_edit_record.type_id=10,this.current_edit_record.status_id=10):t&&a&&(t.setEnabled(!0),a.setEnabled(!0),this.old_type_status.hasOwnProperty("type_id")&&(t.setValue(this.old_type_status.type_id),a.setValue(this.old_type_status.status_id),this.current_edit_record.type_id=this.old_type_status.type_id,this.current_edit_record.status_id=this.old_type_status.status_id)),i==!0?(this.original_note==""?this.original_note=this.current_edit_record.note:this.original_note=this.edit_view_ui_dic.note.getValue(),this.edit_view_ui_dic.note.setValue(this.new_note?this.new_note:""),this.current_edit_record.note=this.new_note?this.new_note:""):(typeof e>"u"||e===!1)&&(this.new_note=this.edit_view_ui_dic.note.getValue(),this.edit_view_ui_dic.note.setValue(this.original_note?this.original_note:""),this.current_edit_record.note=this.original_note?this.original_note:"")}validate(){var e=this,i={};if(this.is_mass_editing){for(var t in this.edit_view_ui_dic)if(this.edit_view_ui_dic.hasOwnProperty(t)){var a=this.edit_view_ui_dic[t];Global.isSet(a.isChecked)&&a.isChecked()&&a.getEnabled()&&(i[t]=a.getValue())}i.id=this.mass_edit_record_ids[0],i=this.uniformVariable(i)}else i=this.current_edit_record,i=this.uniformVariable(i);this.api["validate"+this.api.key_name](i,{onResult:function(r){e.validateResult(r)}})}buildMassEditSaveRecord(e,i){var t=[];return s.each(e,function(a,r){var n=Global.clone(i);n.id=r,t.push(n)}),t}buildMassAddRecord(e){var i=[],t=e.punch_dates;if(t&&t.indexOf(" - ")>0&&(t=this.parserDatesRange(t)),t)for(var a=0;a<t.length;a++){var r=Global.clone(e);delete r.punch_dates,r.punch_date=t[a];var n=this.current_edit_record.user_id;if(Global.isArray(n))for(var _=0;_<n.length;_++){var d=Global.clone(r);d.user_id=this.current_edit_record.user_id[_],i.push(d)}else i.push(r)}return i}parserDatesRange(e){for(var i=e.split(" - "),t=[],a=Global.strToDate(i[0]),r=Global.strToDate(i[1]),n=a;n.getTime()<r.getTime();)t.push(n.format()),n=new Date(new Date(n.getTime()).setDate(n.getDate()+1));return t.push(i[1]),t}setCurrentEditRecordData(){var e=this;for(var i in this.current_edit_record)if(this.current_edit_record.hasOwnProperty(i)){var t=this.edit_view_ui_dic[i];if(Global.isSet(t))switch(i){case"punch_dates":var a;this.current_edit_record.punch_dates?a=this.current_edit_record.punch_dates:(a=[this.current_edit_record.punch_date],this.current_edit_record.punch_dates=a),t.setValue(a);break;case"country":this.setCountryValue(t,i);break;case"enable_email_notification_message":t.setValue(this.current_edit_record[i]);break;case"job_id":if(Global.getProductEdition()>=20){var r={};r.filter_data={status_id:10,user_id:this.current_edit_record.user_id,punch_branch_id:this.current_edit_record.branch_id,punch_department_id:this.current_edit_record.department_id},t.setDefaultArgs(r),t.setValue(this.current_edit_record[i])}break;case"job_item_id":if(Global.getProductEdition()>=20){var r={};r.filter_data={status_id:10,job_id:this.current_edit_record.job_id},t.setDefaultArgs(r),t.setValue(this.current_edit_record[i])}break;case"punch_tag_id":if(Global.getProductEdition()>=20){t.setValue(this.current_edit_record[i]),this.previous_punch_tag_selection=this.current_edit_record[i];var n=t;TTPromise.wait(null,null,function(){var d={};d.filter_data=e.getPunchTagFilterData(),n.setDefaultArgs(d)})}break;case"punch_tag_quick_search":break;case"job_quick_search":break;case"job_item_quick_search":break;case"station_id":this.current_edit_record[i]?this.setStation():(t.setValue("N/A"),t.css("cursor","default"));break;case"punch_image":this.edit_view_form_item_dic.station_id,this.current_edit_record.has_image?(this.attachElement("punch_image"),t.setValue(ServiceCaller.getURLByObjectType("file_download")+"&object_type=punch_image&parent_id="+this.current_edit_record.user_id+"&object_id="+this.current_edit_record.id)):this.detachElement("punch_image");break;default:t.setValue(this.current_edit_record[i]);break}}var _;this.current_edit_record.id&&(this.current_edit_record.actual_time_stamp?_=s.i18n._("Actual Time")+": "+this.current_edit_record.actual_time_stamp:_="N/A"),this.actual_time_label.text(_),this.collectUIDataToCurrentEditRecord(),this.setLocationValue(),this.setEditViewDataDone(),this.isEditChange()}setLocationValue(e){Global.getProductEdition()>=15&&(e&&(this.current_edit_record.latitude=e.latitude,this.current_edit_record.longitude=e.longitude,this.current_edit_record.position_accuracy=e.position_accuracy),this.edit_view_ui_dic.latitude.setValue(this.current_edit_record.latitude),this.edit_view_ui_dic.longitude.setValue(this.current_edit_record.longitude),this.edit_view_ui_dic.position_accuracy.setValue(this.current_edit_record.position_accuracy?this.current_edit_record.position_accuracy:0),!this.current_edit_record.latitude&&!this.is_mass_editing?this.location_wrapper.hide():this.show_location_ui&&this.location_wrapper.show())}isEditChange(){this.current_edit_record.id||this.is_mass_editing?this.edit_view_ui_dic.user_id.setEnabled(!1):this.edit_view_ui_dic.user_id.setEnabled(!0)}setEditViewDataDone(){this.setTabOVisibility(!0),this.is_edit==!0?this.edit_view_ui_dic.user_id.setAllowMultipleSelection(!1):this.edit_view_ui_dic.user_id.setAllowMultipleSelection(!0),this.is_viewing==!0&&(this.current_edit_record.latitude==0||this.current_edit_record.longitude==0)?s(".widget-h-box-mapLocationWrapper").parents(".edit-view-form-item-div").hide():this.show_location_ui&&s(".widget-h-box-mapLocationWrapper").parents(".edit-view-form-item-div").show(),this.navigation.setValue(this.current_edit_record.id),s(".edit-view-tab-bar").css("opacity",1),TTPromise.resolve("init","init")}setSubLogViewFilter(){return this.sub_log_view_controller?(this.sub_log_view_controller.getSubViewFilter=function(e){return e.table_name_object_id={punch:[this.parent_edit_record.id],punch_control:[this.parent_edit_record.punch_control_id]},e},!0):!1}buildOtherFieldUI(e,i){if(this.edit_view_tab){var t,a=this,r=this.edit_view_tab.find("#tab_punch"),n=r.find(".first-column");if(a.edit_view_ui_dic[e])t=a.edit_view_ui_dic[e],t.setValue(a.current_edit_record[e]);else{t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:e});var _=a.addEditFieldToColumn(i,t,n);_.insertBefore(this.edit_view_form_item_dic.note),t.setValue(a.current_edit_record[e])}t.css("opacity",1),t.css("minWidth",300),a.is_viewing?t.setEnabled(!1):t.setEnabled(!0)}}onAddResult(e){var i=this,t=e.getResult();t||(t=[]),t.company=LocalCacheData.current_company.name,t.punch_date=new Date().format(),i.sub_view_mode&&i.parent_key&&(t[i.parent_key]=i.parent_value),i.current_edit_record=t,i.initEditView()}buildSearchFields(){super.buildSearchFields();var e={permission_section:"punch"};this.search_fields=[new SearchField({label:s.i18n._("Employee Status"),in_column:1,field:"user_status_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:s.i18n._("Pay Period"),in_column:1,field:"pay_period_id",layout_name:"global_Pay_period",api_class:TTAPI.APIPayPeriod,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:s.i18n._("Start Date"),in_column:1,field:"start_date",basic_search:!1,adv_search:!0,form_item_type:FormItemType.DATE_PICKER}),new SearchField({label:s.i18n._("End Date"),in_column:1,field:"end_date",basic_search:!1,adv_search:!0,form_item_type:FormItemType.DATE_PICKER}),new SearchField({label:s.i18n._("Employee"),in_column:1,field:"user_id",layout_name:"global_user",default_args:e,api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:s.i18n._("Status"),in_column:1,field:"status_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:s.i18n._("Type"),in_column:1,field:"type_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:s.i18n._("Group"),in_column:2,multiple:!0,field:"group_id",layout_name:"global_tree_column",tree_mode:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:s.i18n._("Title"),in_column:2,field:"title_id",layout_name:"global_user_title",api_class:TTAPI.APIUserTitle,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:s.i18n._("Punch Branch"),in_column:2,field:"branch_id",layout_name:"global_branch",api_class:TTAPI.APIBranch,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:s.i18n._("Punch Department"),in_column:2,field:"department_id",layout_name:"global_department",api_class:TTAPI.APIDepartment,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:s.i18n._("Default Branch"),in_column:1,field:"default_branch_id",layout_name:"global_branch",api_class:TTAPI.APIBranch,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:s.i18n._("Default Department"),in_column:1,field:"default_department_id",layout_name:"global_department",api_class:TTAPI.APIDepartment,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:s.i18n._("Job"),in_column:2,field:"job_id",layout_name:"global_job",api_class:Global.getProductEdition()>=20?TTAPI.APIJob:null,multiple:!0,basic_search:!1,adv_search:this.show_job_ui&&Global.getProductEdition()>=20,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:s.i18n._("Task"),in_column:2,field:"job_item_id",layout_name:"global_job_item",api_class:Global.getProductEdition()>=20?TTAPI.APIJobItem:null,multiple:!0,basic_search:!1,adv_search:this.show_job_item_ui&&Global.getProductEdition()>=20,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:s.i18n._("Punch Tags"),in_column:2,field:"punch_tag_id",layout_name:"global_punch_tag",api_class:Global.getProductEdition()>=20?TTAPI.APIPunchTag:null,multiple:!0,basic_search:!1,adv_search:this.show_punch_tag_ui&&Global.getProductEdition()>=20,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:s.i18n._("Created By"),in_column:2,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:s.i18n._("Updated By"),in_column:2,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX})]}getCustomContextMenuModel(){var e={exclude:["copy"],include:[{label:s.i18n._("Jump To"),id:"jump_to_header",menu_align:"right",action_group:"jump_to",action_group_header:!0,sort_order:9050,permission_result:!1},{label:s.i18n._("TimeSheet"),id:"timesheet",menu_align:"right",action_group:"jump_to",sort_order:9050,group:"navigation"},{label:s.i18n._("Edit Employee"),id:"edit_employee",menu_align:"right",action_group:"jump_to",sort_order:9050,group:"navigation"}]};return Global.getProductEdition()>=15&&e.include.push({label:s.i18n._("Map"),id:"map",menu_align:"right",group:"other",vue_icon:"tticon tticon-map_black_24dp",sort_order:8e3},{label:s.i18n._("Import"),id:"import_icon",menu_align:"right",action_group:"import_export",group:"other",vue_icon:"tticon tticon-file_download_black_24dp",sort_order:9010}),e}onMapClick(){if(Global.getProductEdition()>=15){ProgressBar.showProgressBar();var e={filter_columns:{id:!0,latitude:!0,longitude:!0,punch_date:!0,punch_time:!0,position_accuracy:!0,user_id:!0}},i=[],t={};if(this.is_edit||this.is_mass_editing||this.is_add)i.push(this.current_edit_record),this.is_viewing||(t.single_marker_draggable=!0);else{var a=this.getGridSelectIdArray();t.single_marker_draggable=!1,e.filter_data=Global.convertLayoutFilterToAPIFilter(this.select_layout),a.length>0&&(e.filter_data.id=a),e.filter_columns.first_name=!0,e.filter_columns.last_name=!0,e.filter_columns.user_id=!0,e.filter_columns.date_stamp=!0,e.filter_columns.punch_date=!0,e.filter_columns.punch_time=!0,e.filter_columns.time_stamp=!0,e.filter_columns.status=!0,e.filter_columns.punch_control_id=!0,e.filter_columns.branch=!0,e.filter_columns.branch_id=!0,e.filter_columns.department=!0,e.filter_columns.department_id=!0,e.filter_columns.job_manual_id=!0,e.filter_columns.job=!0,e.filter_columns.job_id=!0,e.filter_columns.job_item_manual_id=!0,e.filter_columns.job_item=!0,e.filter_columns.job_item_id=!0,e.filter_columns.punch_tag_id=!0,e.filter_columns.total_time=!0,e.filter_columns.latitude=!0,e.filter_columns.longitude=!0,e.filter_columns.position_accuracy=!0,i=this.api.getPunch(e,{async:!1}).getResult()}E(()=>import("./leaflet-timetrex-D9Z7_Af6.bundle.js"),__vite__mapDeps([0,1]),import.meta.url).then(r=>{var n=r.TTConvertMapData.processPunchesFromViewController(i,t);IndexViewController.openEditView(this,"Map",n)}).catch(Global.importErrorHandler)}}onCustomContextClick(e){switch(e){case"timesheet":case"edit_employee":this.onNavigationClick(e);break;case"map":this.onMapClick();break;case"import_icon":this.onImportClick();break}}onImportClick(){var e=this;IndexViewController.openWizard("ImportCSVWizard","Punch",function(){e.search()})}setCustomDefaultMenuIcon(e,i,t){switch(e){case"timesheet":this.setDefaultMenuViewIcon(i,t,"punch");break;case"edit_employee":this.setDefaultMenuEditIcon(i,t,"user");break}}setCustomEditMenuIcon(e,i){switch(e){case"timesheet":this.setEditMenuNavViewIcon(i,"punch");break;case"edit_employee":this.setEditMenuNavEditIcon(i,"user");break}}onNavigationClick(e){var i=this,t,a,r,n;switch(e){case"timesheet":if(t={filter_data:{}},Global.isSet(this.current_edit_record))t.user_id=this.current_edit_record.user_id,t.base_date=this.current_edit_record.punch_date,Global.addViewTab(this.viewId,s.i18n._("Punches"),window.location.href),IndexViewController.goToView("TimeSheet",t);else if(a={},r=this.getGridSelectIdArray(),n=r.length,n>0){var _=r[0];a.filter_data={},a.filter_data.id=[_],this.api["get"+this.api.key_name](a,{onResult:function(d){var o=d.getResult();o||(o=[]),o=o[0],t.user_id=o.user_id,t.base_date=o.punch_date,Global.addViewTab(i.viewId,s.i18n._("Punches"),window.location.href),IndexViewController.goToView("TimeSheet",t)}})}break;case"edit_employee":t={filter_data:{}},Global.isSet(this.current_edit_record)?IndexViewController.openEditView(this,"Employee",this.current_edit_record.user_id):(a={},r=this.getGridSelectIdArray(),n=r.length,n>0&&(_=r[0],a.filter_data={},a.filter_data.id=[_],this.api["get"+this.api.key_name](a,{onResult:function(d){var o=d.getResult();o||(o=[]),o=o[0],IndexViewController.openEditView(i,"Employee",o.user_id)}})));break}}setEditMenuSaveAndContinueIcon(e,i){this.saveAndContinueValidate(e,i),(this.is_mass_editing||this.is_viewing||this.isMassDateOrMassUser())&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}copyAsNewResetIds(e){return e.id="",e.punch_control_id="",e}_continueDoCopyAsNew(){if(this.setCurrentEditViewState("new"),LocalCacheData.current_doing_context_action="copy_as_new",Global.isSet(this.edit_view)){this.current_edit_record=this.copyAsNewResetIds(this.current_edit_record);var e=this.edit_view.find(".navigation-div");e.css("display","none"),this.openEditView(),this.initEditView(),this.setEditMenu(),this.setTabStatus(),this.is_changed=!1,ProgressBar.closeOverlay()}else super._continueDoCopyAsNew()}isMassDateOrMassUser(){return this.isMassAdding()?!!(this.current_edit_record.punch_dates&&this.current_edit_record.punch_dates.length>1||this.current_edit_record.user_id&&this.current_edit_record.user_id.length>1):!1}onSaveAndCopy(e){var i=this;Global.isSet(e)||(e=!1),this.is_add=!0,this.is_changed=!1,LocalCacheData.current_doing_context_action="save_and_copy";var t=this.current_edit_record;t=this.uniformVariable(t),this.clearNavigationData(),this.api["set"+this.api.key_name](t,!1,e,{onResult:function(a){i.onSaveAndCopyResult(a)}})}onSaveAndNewClick(e){var i=this;Global.isSet(e)||(e=!1),this.setCurrentEditViewState("new");var t=this.current_edit_record;t=this.uniformVariable(t),this.api["set"+this.api.key_name](t,!1,e,{onResult:function(a){i.onSaveAndNewResult(a)}})}onMassEditClick(){var e=this;e.is_add=!1,e.is_viewing=!1,e.is_mass_editing=!0,LocalCacheData.current_doing_context_action="mass_edit",e.openEditView();var i={},t=this.getGridSelectIdArray();t.length,this.mass_edit_record_ids=[],s.each(t,function(a,r){e.mass_edit_record_ids.push(r)}),i.filter_data={},i.filter_data.id=this.mass_edit_record_ids,this.api["getCommon"+this.api.key_name+"Data"](i,{onResult:function(a){var r=a.getResult();r||(r=[]),e.api.getOptions("unique_columns",{onResult:function(n){e.unique_columns=n.getResult(),e.api.getOptions("linked_columns",{onResult:function(_){e.linked_columns=_.getResult(),e.sub_view_mode&&e.parent_key&&(r[e.parent_key]=e.parent_value),e.current_edit_record=r,e.initEditView()}})}})}})}onSaveAndContinue(e){var i=this;Global.isSet(e)||(e=!1),this.is_changed=!1,LocalCacheData.current_doing_context_action="save_and_continue",this.isMassAdding()&&(this.current_edit_record.punch_dates&&this.current_edit_record.punch_dates.length===1&&(this.current_edit_record.punch_date=this.current_edit_record.punch_dates[0]),this.current_edit_record.user_id&&this.current_edit_record.user_id.length===1&&(this.current_edit_record.user_id=this.current_edit_record.user_id[0])),this.current_edit_record=this.uniformVariable(this.current_edit_record),this.api["set"+this.api.key_name](this.current_edit_record,!1,e,{onResult:function(t){i.onSaveAndContinueResult(t)}})}onFormItemChange(e,i){var t=this;this.setIsChanged(e),this.setMassEditingFieldsWhenFormChange(e);var a=e.getField(),r=e.getValue();switch(this.current_edit_record[a]=r,a){case"user_id":this.setEditMenu();break;case"punch_date":this.current_edit_record.punch_dates=[r];break;case"punch_dates":this.setEditMenu();break;case"transfer":this.onTransferChanged();break;case"job_id":Global.getProductEdition()>=20&&(this.edit_view_ui_dic.job_quick_search.setValue(e.getValue(!0)&&e.getValue(!0).manual_id?e.getValue(!0).manual_id:""),this.setJobItemValueWhenJobChanged(e.getValue(!0),"job_item_id",{status_id:10,job_id:this.current_edit_record.job_id}),this.edit_view_ui_dic.job_quick_search.setCheckBox(!0),this.setPunchTagValuesWhenCriteriaChanged(this.getPunchTagFilterData(),"punch_tag_id"));break;case"job_item_id":Global.getProductEdition()>=20&&(this.edit_view_ui_dic.job_item_quick_search.setValue(e.getValue(!0)&&e.getValue(!0).manual_id?e.getValue(!0).manual_id:""),this.edit_view_ui_dic.job_item_quick_search.setCheckBox(!0),this.setPunchTagValuesWhenCriteriaChanged(this.getPunchTagFilterData(),"punch_tag_id"));break;case"punch_tag_id":Global.getProductEdition()>=20&&(r!==TTUUID.zero_id&&r!==!1&&r.length>0?this.setPunchTagQuickSearchManualIds(e.getSelectItems()):this.edit_view_ui_dic.punch_tag_quick_search.setValue(""),t.previous_punch_tag_selection=r,this.edit_view_ui_dic.punch_tag_id.setSourceData(null));break;case"user_id":case"branch_id":case"department_id":Global.getProductEdition()>=20&&(this.setPunchTagValuesWhenCriteriaChanged(this.getPunchTagFilterData(),"punch_tag_id"),this.setJobValueWhenCriteriaChanged("job_id",{status_id:10,user_id:this.current_edit_record.user_id,punch_branch_id:this.current_edit_record.branch_id,punch_department_id:this.current_edit_record.department_id}));break;case"job_quick_search":case"job_item_quick_search":Global.getProductEdition()>=20&&(this.onJobQuickSearch(a,r),this.setPunchTagValuesWhenCriteriaChanged(this.getPunchTagFilterData(),"punch_tag_id"));break;case"punch_tag_quick_search":Global.getProductEdition()>=20&&(this.onPunchTagQuickSearch(r,this.getPunchTagFilterData(),"punch_tag_id"),i=!0);break;default:this.current_edit_record[a]=r;break}i||this.validate()}onMapSaveClick(e,i){this.savePunchPosition(e,i)}savePunchPosition(e,i){return!e||e.length!==1?(Debug.Text("ERROR: Invalid params/data passed to function.","PunchesViewController.js","PunchesViewController","savePunchPosition",1),!1):(this.is_mass_editing==!0&&(this.location_mass_edit_check_box.find(".mass-edit-checkbox")[0].checked=!0),this.setLocationValue(e[0]),i(),this.is_changed=!0,!0)}getSelectEmployee(e){var i;return e?i=LocalCacheData.getLoginUser():i=LocalCacheData.getLoginUser().id,i}getFilterColumnsFromDisplayColumns(e,i){return e==null&&(e={}),e.latitude=!0,e.longitude=!0,this._getFilterColumnsFromDisplayColumns(e,i)}isMassAdding(){return!!(this.current_edit_record&&(Array.isArray(this.current_edit_record.user_id)===!0||Array.isArray(this.current_edit_record.punch_dates)===!0&&this.current_edit_record.punch_dates.length>1))}}export{S as PunchesViewController};
//# sourceMappingURL=PunchesViewController-BEFzLKXZ.bundle.js.map
