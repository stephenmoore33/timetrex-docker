const __vite__fileDeps=["./main_ui-CaF8IcSp.css","./leaflet-timetrex-DIHfnHxo.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{h as x,_ as M}from"./main_ui-z76rxVqJ.entry.bundle.js";import{_ as S,j as t}from"./vendor-tTApdY0Y.bundle.js";import"./TImage-D3G3HRb1.bundle.js";import"./TImageAdvBrowser-CQSTdPda.bundle.js";class j extends BaseViewController{constructor(e={}){S.defaults(e,{el:"#employee_view_container",user_api:null,user_group_api:null,punch_tag_api:null,company_api:null,hierarchyControlAPI:null,redurring_schedule_control_api:null,status_array:null,mfa_type_array:null,sex_array:null,user_group_array:null,country_array:null,province_array:null,e_province_array:null,default_punch_tag:[],previous_punch_tag_selection:[],sub_wage_view_controller:null,sub_user_contact_view_controller:null,sub_accrual_policy_user_modifier_view_controller:null,sub_log_view_controller:null,sub_company_tax_view_controller:null,sub_job_application_view_controller:null,sub_user_skill_view_controller:null,sub_user_education_view_controller:null,sub_user_membership_view_controller:null,sub_user_license_view_controller:null,sub_user_language_view_controller:null,sub_user_review_control_view_controller:null,sub_payment_methods_view_controller:null,hierarchy_options_dic:null,hierarchy_ui_model:null,show_hierarchy:!1,select_company_id:null,sub_view_grid_autosize:!0,events:{}}),super(e)}init(e){this.edit_view_tpl="EmployeeEditView.html",this.permission_id="user",this.viewId="Employee",this.script_name="EmployeeView",this.table_name_key="users",this.document_object_type_id=100,this.context_menu_name=t.i18n._("Employees"),this.navigation_label=t.i18n._("Employee"),this.api=TTAPI.APIUser,this.api_user_default=TTAPI.APIUserDefault,this.select_company_id=LocalCacheData.getCurrentCompany().id,Global.getProductEdition()>=20&&(this.job_api=TTAPI.APIJob,this.job_item_api=TTAPI.APIJobItem,this.punch_tag_api=TTAPI.APIPunchTag),this.user_group_api=TTAPI.APIUserGroup,this.company_api=TTAPI.APICompany,this.hierarchyControlAPI=TTAPI.APIHierarchyControl,this.redurring_schedule_control_api=TTAPI.APIRecurringScheduleControl,this.event_bus=new x({view_id:this.viewId}),this.render(),this.buildContextMenu(),this.initData()}jobUIValidate(){return!!(PermissionManager.validate("job","enabled")&&(PermissionManager.validate("job","view")||PermissionManager.validate("job","view_child")||PermissionManager.validate("job","view_own")))}jobItemUIValidate(){return!!(PermissionManager.validate("job_item","enabled")&&(PermissionManager.validate("job_item","view")||PermissionManager.validate("job_item","view_child")||PermissionManager.validate("job_item","view_own")))}punchTagUIValidate(){return!!(PermissionManager.validate("punch_tag","enabled")&&(PermissionManager.validate("punch_tag","view")||PermissionManager.validate("punch_tag","view_child")||PermissionManager.validate("punch_tag","view_own")))}initPermission(){super.initPermission(),this.jobUIValidate()?this.show_job_ui=!0:this.show_job_ui=!1,this.jobItemUIValidate()?this.show_job_item_ui=!0:this.show_job_item_ui=!1,this.punchTagUIValidate()?this.show_punch_tag_ui=!0:this.show_punch_tag_ui=!1}getCustomContextMenuModel(){var e={exclude:["copy"],include:[{label:t.i18n._("Map"),id:"map",menu_align:"right",vue_icon:"tticon tticon-map_black_24dp",sort_order:2e3},{label:t.i18n._("Import"),id:"import_icon",menu_align:"right",action_group:"import_export",group:"other",vue_icon:"tticon tticon-file_download_black_24dp",sort_order:9010},{label:t.i18n._("Jump To"),id:"jump_to_header",menu_align:"right",action_group:"jump_to",action_group_header:!0,permission_result:!1,sort_order:3e3},{label:t.i18n._("TimeSheet"),id:"timesheet",menu_align:"right",action_group:"jump_to",group:"navigation",sort_order:3010},{label:t.i18n._("Schedule"),id:"schedule",menu_align:"right",action_group:"jump_to",group:"navigation",sort_order:3020},{label:t.i18n._("Pay Stubs"),id:"pay_stub",menu_align:"right",action_group:"jump_to",group:"navigation",sort_order:3030},{label:t.i18n._("Pay Stub Amendments"),id:"pay_stub_amendment",menu_align:"right",action_group:"jump_to",group:"navigation",sort_order:3040}]};return this.edit_only_mode&&e.exclude.push("timesheet","schedule","pay_stub","pay_stub_amendment","map","import_icon","export_excel"),e}openEditView(e){if(this.edit_only_mode){this.parent_view_controller.viewId==="JobApplication"&&e===void 0&&(e=this.refresh_id);var a=this;this.initOptions(function(o){a.edit_view||a.initEditViewUI(a.viewId,a.edit_view_tpl),l()})}else this.edit_view||this.initEditViewUI(this.viewId,this.edit_view_tpl);function l(){a.getEmployeeData(e,function(o){o?(a.current_edit_record=o,a.initEditView()):(TAlertManager.showAlert(t.i18n._("Record does not exist.")),a.onCancelClick()),a.edit_only_mode&&t(".edit-view-tab-bar").css("opacity",1)})}}setEditViewDataDone(){super.setEditViewDataDone()}getEmployeeData(e,a){if(typeof e=="object")e.id="",e.company=LocalCacheData.current_company.name,a(e);else{var l={};l.filter_data={},l.filter_data.id=[e],this.api["get"+this.api.key_name](l,{onResult:function(o){var r=o.getResult();r||(r=[]),r=r[0],a(r)}})}}initOptions(e){var a=[{option_name:"status"},{option_name:"sex"},{option_name:"mfa_type"},{option_name:"country",field_name:"country",api:this.company_api}];this.initDropDownOptions(a,function(l){e&&e(l)})}initDropDownOptions(e,a){var l=this,o=e.length+2,r=0,_=[];this.hierarchyPermissionValidate()?l.hierarchyControlAPI.getOptions("object_type",{onResult:function(u){var m=u.getResult();if(m){var b=[];for(var h in m)b.push({id:Global.removeSortPrefix(h),value:m[h]});l.hierarchy_ui_model=b}r=r+1,r===o&&a(_)}}):(this.show_hierarchy=!1,r=r+1),this.user_group_api.getUserGroup("",!1,!1,{onResult:function(u){u=u.getResult(),u=Global.buildTreeRecord(u),l.edit_only_mode||!l.sub_view_mode&&l.basic_search_field_ui_dic.group_id&&(l.basic_search_field_ui_dic.group_id.setSourceData(u),l.adv_search_field_ui_dic.group_id.setSourceData(u)),l.user_group_array=u,r=r+1,r===o&&a(_)}});for(var c=0;c<o-2;c++){var n=e[c];this.initDropDownOption(n.option_name,n.field_name,n.api,d)}function d(u){_.push(u),r=r+1,r===o&&a(_)}}setCustomDefaultMenuIcon(e,a,l){switch(e){case"timesheet":this.setDefaultMenuViewIcon(a,l,"punch");break;case"schedule":this.setDefaultMenuViewIcon(a,l,"schedule");break;case"pay_stub_amendment":this.setDefaultMenuViewIcon(a,l,"pay_stub_amendment");break;case"pay_stub":this.setDefaultMenuPayStubIcon(a,l,"pay_stub");break}}setDefaultMenuPayStubIcon(e,a,l){PermissionManager.checkTopLevelPermission("PayStub")||ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),a===1?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuImportIcon(e,a,l){PermissionManager.checkTopLevelPermission("ImportCSVEmployee")===!0?ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}initSubQualificationView(){var e=this;if(!this.current_edit_record.id){TTPromise.resolve("BaseViewController","onTabShow");return}t("#tab_qualifications .first-column-sub-view").css("opacity","0"),TTPromise.add("Employee_Qualifications_Tab","initSubQualificationView"),ProgressBar.showProgressBar(),TTPromise.add("Employee_Qualifications_Tab","UserSkillViewController"),Global.loadScript("views/hr/qualification/UserSkillViewController.js",function(){var n=e.edit_view_tab.find("#tab_qualifications"),d=n.find(".first-column-sub-view").find(".first-sub-view");Global.trackView("SubUserSkillView"),UserSkillViewController.loadSubView(d,a,l)}),ProgressBar.showProgressBar(),TTPromise.add("Employee_Qualifications_Tab","UserEducationViewController"),Global.loadScript("views/hr/qualification/UserEducationViewController.js",function(){var n=e.edit_view_tab.find("#tab_qualifications"),d=n.find(".first-column-sub-view").find(".second-sub-view");Global.trackView("SubUserEducationView"),UserEducationViewController.loadSubView(d,a,_)}),ProgressBar.showProgressBar(),TTPromise.add("Employee_Qualifications_Tab","UserMembershipViewController"),Global.loadScript("views/hr/qualification/UserMembershipViewController.js",function(){var n=e.edit_view_tab.find("#tab_qualifications"),d=n.find(".first-column-sub-view").find(".third-sub-view");Global.trackView("SubUserMembershipView"),UserMembershipViewController.loadSubView(d,a,c)}),ProgressBar.showProgressBar(),TTPromise.add("Employee_Qualifications_Tab","UserLicenseViewController"),Global.loadScript("views/hr/qualification/UserLicenseViewController.js",function(){var n=e.edit_view_tab.find("#tab_qualifications"),d=n.find(".first-column-sub-view").find(".forth-sub-view");Global.trackView("SubUserLicenseView"),UserLicenseViewController.loadSubView(d,a,o)}),ProgressBar.showProgressBar(),TTPromise.add("Employee_Qualifications_Tab","UserLanguageViewController"),Global.loadScript("views/hr/qualification/UserLanguageViewController.js",function(){var n=e.edit_view_tab.find("#tab_qualifications"),d=n.find(".first-column-sub-view").find(".fifth-sub-view");Global.trackView("SubUserLanguageView"),UserLanguageViewController.loadSubView(d,a,r)});function a(){}function l(n){t(n.el).find(".sub-view-title").text(t.i18n._("Skills")),e.sub_user_skill_view_controller=n,e.sub_user_skill_view_controller.parent_key="user_id",e.sub_user_skill_view_controller.parent_value=e.current_edit_record.id,e.sub_user_skill_view_controller.parent_edit_record=e.current_edit_record,e.sub_user_skill_view_controller.parent_view_controller=e,e.sub_user_skill_view_controller.postInit=function(){this.buildContextMenu(),this.initData(),ProgressBar.removeProgressBar()}}function o(n){t(n.el).find(".sub-view-title").text(t.i18n._("Licenses")),e.sub_user_license_view_controller=n,e.sub_user_license_view_controller.parent_key="user_id",e.sub_user_license_view_controller.parent_value=e.current_edit_record.id,e.sub_user_license_view_controller.parent_edit_record=e.current_edit_record,e.sub_user_license_view_controller.parent_view_controller=e,e.sub_user_license_view_controller.postInit=function(){this.buildContextMenu(),this.initData(),ProgressBar.removeProgressBar()}}function r(n){t(n.el).find(".sub-view-title").text(t.i18n._("Languages")),e.sub_user_language_view_controller=n,e.sub_user_language_view_controller.parent_key="user_id",e.sub_user_language_view_controller.parent_value=e.current_edit_record.id,e.sub_user_language_view_controller.parent_edit_record=e.current_edit_record,e.sub_user_language_view_controller.parent_view_controller=e,e.sub_user_language_view_controller.postInit=function(){this.buildContextMenu(),this.initData(),ProgressBar.removeProgressBar()}}function _(n){t(n.el).find(".sub-view-title").text(t.i18n._("Education")),e.sub_user_education_view_controller=n,e.sub_user_education_view_controller.parent_key="user_id",e.sub_user_education_view_controller.parent_value=e.current_edit_record.id,e.sub_user_education_view_controller.parent_edit_record=e.current_edit_record,e.sub_user_education_view_controller.parent_view_controller=e,e.sub_user_education_view_controller.postInit=function(){this.buildContextMenu(),this.initData(),ProgressBar.removeProgressBar()}}function c(n){t(n.el).find(".sub-view-title").text(t.i18n._("Memberships")),e.sub_user_membership_view_controller=n,e.sub_user_membership_view_controller.parent_key="user_id",e.sub_user_membership_view_controller.parent_value=e.current_edit_record.id,e.sub_user_membership_view_controller.parent_edit_record=e.current_edit_record,e.sub_user_membership_view_controller.parent_view_controller=e,e.sub_user_membership_view_controller.postInit=function(){this.buildContextMenu(),this.initData(),ProgressBar.removeProgressBar()}}TTPromise.wait("Employee_Qualifications_Tab",null,function(){t("#contentContainer").trigger("resize"),t("#tab_qualifications .first-column-sub-view").css("opacity","1")}),TTPromise.resolve("Employee_Qualifications_Tab","initSubQualificationView")}initSubCompanyTaxView(){var e=this;if(!this.current_edit_record.id){TTPromise.resolve("BaseViewController","onTabShow");return}if(TTPromise.add("TaxView","init"),this.sub_company_tax_view_controller){this.sub_company_tax_view_controller.buildContextMenu(!0),this.sub_company_tax_view_controller.setDefaultMenu(),e.sub_company_tax_view_controller.parent_value=e.current_edit_record.id,e.sub_company_tax_view_controller.parent_edit_record=e.current_edit_record,e.sub_company_tax_view_controller.initData();return}Global.loadViewSource("CompanyTaxDeduction","CompanyTaxDeductionViewController.js",function(){if(e.edit_view_tab){var o=e.edit_view_tab.find("#tab_tax"),r=o.find(".first-column-sub-view");Global.trackView("SubUserContactView"),CompanyTaxDeductionViewController.loadSubView(r,a,l)}});function a(){}function l(o){e.sub_company_tax_view_controller=o,e.sub_company_tax_view_controller.parent_key="include_user_id",e.sub_company_tax_view_controller.parent_value=e.current_edit_record.id,e.sub_company_tax_view_controller.parent_edit_record=e.current_edit_record,e.sub_company_tax_view_controller.parent_view_controller=e,TTPromise.wait("BaseViewController","initialize",function(){e.sub_company_tax_view_controller.initData()})}}initSubUserReviewControlView(){var e=this;if(!this.current_edit_record.id){TTPromise.resolve("BaseViewController","onTabShow");return}if(TTPromise.add("ReviewView","init"),this.sub_user_review_control_view_controller){this.sub_user_review_control_view_controller.buildContextMenu(!0),this.sub_user_review_control_view_controller.setDefaultMenu(),e.sub_user_review_control_view_controller.parent_key="user_id",e.sub_user_review_control_view_controller.parent_value=e.current_edit_record.id,e.sub_user_review_control_view_controller.parent_edit_record=e.current_edit_record,e.sub_user_review_control_view_controller.initData();return}Global.loadScript("views/hr/kpi/UserReviewControlViewController.js",function(){if(e.edit_view_tab){var o=e.edit_view_tab.find("#tab_reviews"),r=o.find(".first-column-sub-view");Global.trackView("SubUserReviewControlView"),UserReviewControlViewController.loadSubView(r,a,l)}});function a(){}function l(o){e.sub_user_review_control_view_controller=o,e.sub_user_review_control_view_controller.parent_key="user_id",e.sub_user_review_control_view_controller.parent_value=e.current_edit_record.id,e.sub_user_review_control_view_controller.parent_edit_record=e.current_edit_record,e.sub_user_review_control_view_controller.parent_view_controller=e,e.sub_user_review_control_view_controller.initData()}}initSubPaymentMethodsView(){var e=this;if(!this.current_edit_record.id){TTPromise.resolve("BaseViewController","onTabShow");return}if(TTPromise.add("PaymentMethodsView","init"),this.sub_payment_methods_view_controller){this.sub_payment_methods_view_controller.buildContextMenu(!0),this.sub_payment_methods_view_controller.setDefaultMenu(),e.sub_payment_methods_view_controller.parent_key="user_id",e.sub_payment_methods_view_controller.parent_value=e.current_edit_record.id,e.sub_payment_methods_view_controller.parent_edit_record=e.current_edit_record,e.sub_payment_methods_view_controller.initData();return}Global.loadScript("views/employees/remittance_destination_account/RemittanceDestinationAccountViewController.js",function(){if(e.edit_view_tab){var o=e.edit_view_tab.find("#tab_payment_methods"),r=o.find(".first-column-sub-view");Global.trackView("SubRemittanceDestinationAccountView"),RemittanceDestinationAccountViewController.loadSubView(r,a,l)}});function a(){}function l(o){e.sub_payment_methods_view_controller=o,e.sub_payment_methods_view_controller.is_subview=!0,e.sub_payment_methods_view_controller.parent_key="user_id",e.sub_payment_methods_view_controller.parent_value=e.current_edit_record.id,e.sub_payment_methods_view_controller.parent_edit_record=e.current_edit_record,e.sub_payment_methods_view_controller.parent_view_controller=e,TTPromise.wait("BaseViewController","initialize",function(){e.sub_payment_methods_view_controller.initData()})}}initSubJobApplicationView(){var e=this;if(!this.current_edit_record.id){TTPromise.resolve("BaseViewController","onTabShow");return}if(TTPromise.add("JobAppView","init"),this.sub_job_application_view_controller){this.sub_job_application_view_controller.buildContextMenu(!0),this.sub_job_application_view_controller.setDefaultMenu(),e.sub_job_application_view_controller.parent_key="interviewer_user_id",e.sub_job_application_view_controller.parent_value=e.current_edit_record.id,e.sub_job_application_view_controller.parent_edit_record=e.current_edit_record,e.sub_job_application_view_controller.initData();return}Global.loadScript("views/hr/recruitment/JobApplicationViewController.js",function(){if(e.edit_view_tab){var o=e.edit_view_tab.find("#tab_applications"),r=o.find(".first-column-sub-view");Global.trackView("SubJobApplicationView"),JobApplicationViewController.loadSubView(r,a,l)}});function a(){}function l(o){e.sub_job_application_view_controller=o,e.sub_job_application_view_controller.parent_key="interviewer_user_id",e.sub_job_application_view_controller.parent_value=e.current_edit_record.id,e.sub_job_application_view_controller.parent_edit_record=e.current_edit_record,e.sub_job_application_view_controller.parent_view_controller=e,TTPromise.wait("BaseViewController","initialize",function(){e.sub_job_application_view_controller.initData()})}}initSubUserContactView(){var e=this;if(!this.current_edit_record.id){TTPromise.resolve("BaseViewController","onTabShow");return}if(TTPromise.add("ContactView","init"),this.sub_user_contact_view_controller){this.sub_user_contact_view_controller.buildContextMenu(!0),this.sub_user_contact_view_controller.setDefaultMenu(),e.sub_user_contact_view_controller.parent_value=e.current_edit_record.id,e.sub_user_contact_view_controller.parent_edit_record=e.current_edit_record,e.sub_user_contact_view_controller.initData();return}Global.loadScript("views/employees/user_contact/UserContactViewController.js",function(){if(e.edit_view_tab){var o=e.edit_view_tab.find("#tab_contacts"),r=o.find(".first-column-sub-view");Global.trackView("SubUserContactView"),UserContactViewController.loadSubView(r,a,l)}});function a(){}function l(o){e.sub_user_contact_view_controller=o,e.sub_user_contact_view_controller.parent_key="user_id",e.sub_user_contact_view_controller.parent_value=e.current_edit_record.id,e.sub_user_contact_view_controller.parent_edit_record=e.current_edit_record,e.sub_user_contact_view_controller.parent_view_controller=e,TTPromise.wait("BaseViewController","initialize",function(){e.sub_user_contact_view_controller.initData()})}}initSubWageView(){var e=this;if(!this.current_edit_record.id){TTPromise.resolve("BaseViewController","onTabShow");return}if(TTPromise.add("WageView","init"),this.sub_wage_view_controller){this.sub_wage_view_controller.buildContextMenu(!0),this.sub_wage_view_controller.setDefaultMenu(),e.sub_wage_view_controller.parent_value=e.current_edit_record.id,e.sub_wage_view_controller.parent_edit_record=e.current_edit_record,e.sub_wage_view_controller.initData(),TTPromise.resolve("WageView","init");return}Global.loadScript("views/company/wage/WageViewController.js",function(){if(e.edit_view_tab){var o=e.edit_view_tab.find("#tab_wage"),r=o.find(".first-column-sub-view");Global.trackView("SubWageView"),WageViewController.loadSubView(r,a,l)}});function a(){}function l(o,r){e.sub_wage_view_controller=o,e.sub_wage_view_controller.parent_key="user_id",e.sub_wage_view_controller.parent_value=e.current_edit_record.id,e.sub_wage_view_controller.parent_edit_record=e.current_edit_record,e.sub_wage_view_controller.parent_view_controller=e,TTPromise.wait("BaseViewController","initialize",function(){e.sub_wage_view_controller&&e.sub_wage_view_controller.initData()})}}initSubAccrualPolicyUserModifier(){var e=this;if(!this.current_edit_record.id){TTPromise.resolve("BaseViewController","onTabShow"),this.edit_view.find(".permission-defined-div").css("display","none");return}if(TTPromise.add("AccrualView","init"),this.sub_accrual_policy_user_modifier_view_controller){this.sub_accrual_policy_user_modifier_view_controller.buildContextMenu(!0),this.sub_accrual_policy_user_modifier_view_controller.setDefaultMenu(),e.sub_accrual_policy_user_modifier_view_controller.parent_key="user_id",e.sub_accrual_policy_user_modifier_view_controller.parent_value=e.current_edit_record.id,e.sub_accrual_policy_user_modifier_view_controller.parent_edit_record=e.current_edit_record,e.sub_accrual_policy_user_modifier_view_controller.initData();return}Global.getProductEdition()>=15?(this.edit_view.find(".permission-defined-div").css("display","none"),Global.loadScript("views/policy/accrual_policy/AccrualPolicyUserModifierViewController.js",function(){if(e.edit_view_tab){var o=e.edit_view_tab.find("#tab_accruals"),r=o.find(".first-column-sub-view");Global.trackView("SubAccrualPolicyUserModifierView"),AccrualPolicyUserModifierViewController.loadSubView(r,a,l)}})):(this.edit_view_tab.find("#tab_accruals").find(".first-column-sub-view").css("display","none"),this.edit_view.find(".permission-defined-div").css("display","block"),this.edit_view.find(".permission-message").html(Global.getUpgradeMessage()));function a(o){var r={parent_view:"employee"};return{template:S.template(o),args:r}}function l(o){e.sub_accrual_policy_user_modifier_view_controller=o,e.sub_accrual_policy_user_modifier_view_controller.parent_key="user_id",e.sub_accrual_policy_user_modifier_view_controller.parent_value=e.current_edit_record.id,e.sub_accrual_policy_user_modifier_view_controller.parent_edit_record=e.current_edit_record,e.sub_accrual_policy_user_modifier_view_controller.parent_view_controller=e,e.sub_accrual_policy_user_modifier_view_controller.sub_view_mode=!0,TTPromise.wait("BaseViewController","initialize",function(){e.sub_accrual_policy_user_modifier_view_controller.initData()})}}setDefaultUserName(){if(this.is_add==!0){var e=this.edit_view_ui_dic.first_name,a=this.edit_view_ui_dic.last_name,l=this.edit_view_ui_dic.user_name;l.setValue(e.getValue().toLowerCase().replace(/[^a-zA-Z_]/gi,"")+"."+a.getValue().toLowerCase().replace(/[^a-zA-Z_]/gi,"")),this.current_edit_record.user_name=l.getValue()}}onFormItemChange(e,a){var l=this;this.setIsChanged(e),this.setMassEditingFieldsWhenFormChange(e);var o=e.getField();if(this.current_edit_record){switch(parseInt(o)>0?(this.current_edit_record.hierarchy_control||(this.current_edit_record.hierarchy_control={}),this.current_edit_record.hierarchy_control[o]=e.getValue()):this.current_edit_record[o]=e.getValue(),o){case"first_name":var r=this.edit_view_ui_dic.first_name_1;r.setValue(e.getValue()),this.current_edit_record.first_name_1=e.getValue(),this.setDefaultUserName();break;case"last_name":r=this.edit_view_ui_dic.last_name_1,r.setValue(e.getValue()),this.current_edit_record.last_name_1=e.getValue(),this.setDefaultUserName();break;case"first_name_1":r=this.edit_view_ui_dic.first_name,r.setValue(e.getValue()),this.current_edit_record.first_name=e.getValue(),this.setDefaultUserName();break;case"last_name_1":r=this.edit_view_ui_dic.last_name,r.setValue(e.getValue()),this.current_edit_record.last_name=e.getValue(),this.setDefaultUserName();break;case"country":r=this.edit_view_ui_dic.province,r.setValue(null);break;case"default_job_id":Global.getProductEdition()>=20&&(this.edit_view_ui_dic.job_quick_search.setValue(e.getValue(!0)&&e.getValue(!0).manual_id?e.getValue(!0).manual_id:""),this.setJobItemValueWhenJobChanged(e.getValue(!0),"default_job_item_id",{status_id:10,job_id:this.current_edit_record.default_job_id,company_id:this.select_company_id}),this.edit_view_ui_dic.job_quick_search.setCheckBox(!0),this.setPunchTagValuesWhenCriteriaChanged(this.getPunchTagFilterData(),"default_punch_tag_id"));break;case"default_job_item_id":Global.getProductEdition()>=20&&(this.edit_view_ui_dic.job_item_quick_search.setValue(e.getValue(!0)&&e.getValue(!0).manual_id?e.getValue(!0).manual_id:""),this.edit_view_ui_dic.job_item_quick_search.setCheckBox(!0),this.setPunchTagValuesWhenCriteriaChanged(this.getPunchTagFilterData(),"default_punch_tag_id"));break;case"default_punch_tag_id":Global.getProductEdition()>=20&&(e.getValue()!==TTUUID.zero_id&&e.getValue()!==!1&&e.getValue().length>0?this.setPunchTagQuickSearchManualIds(e.getSelectItems()):this.edit_view_ui_dic.punch_tag_quick_search.setValue(""),this.edit_view_ui_dic.default_punch_tag_id.setSourceData(null));break;case"id":case"default_branch_id":case"default_department_id":case"group_id":Global.getProductEdition()>=20&&this.setPunchTagValuesWhenCriteriaChanged(this.getPunchTagFilterData(),"default_punch_tag_id");break;case"job_quick_search":case"job_item_quick_search":Global.getProductEdition()>=20&&(this.onJobQuickSearch(o,e.getValue(),"default_job_id","default_job_item_id",{status_id:10,company_id:l.select_company_id}),TTPromise.wait("BaseViewController","onJobQuickSearch",function(){l.setPunchTagValuesWhenCriteriaChanged(l.getPunchTagFilterData(),"default_punch_tag_id")}),a=!0);break;case"punch_tag_quick_search":Global.getProductEdition()>=20&&(this.onPunchTagQuickSearch(e.getValue(),this.getPunchTagFilterData(),"default_punch_tag_id"),a=!0);break}if(o==="country"){this.onCountryChange();return}a||this.validate()}}hierarchyPermissionValidate(e,a){return!!(PermissionManager.validate("hierarchy","edit")||PermissionManager.validate("user","edit_hierarchy"))}checkTabPermissions(e){var a=!1;switch(e){case"tab_hierarchy":this.select_company_id===LocalCacheData.getCurrentCompany().id&&(a=!0);break;case"tab_wage":PermissionManager.checkTopLevelPermission("Wage")&&this.select_company_id===LocalCacheData.getCurrentCompany().id&&(a=!0);break;case"tab_tax":PermissionManager.checkTopLevelPermission("UserTaxDeduction")&&this.select_company_id===LocalCacheData.getCurrentCompany().id&&(a=!0);break;case"tab_payment_methods":PermissionManager.checkTopLevelPermission("RemittanceDestinationAccount")&&this.select_company_id===LocalCacheData.getCurrentCompany().id&&(a=!0);break;case"tab_contacts":PermissionManager.checkTopLevelPermission("UserContact")&&this.select_company_id===LocalCacheData.getCurrentCompany().id&&(a=!0);break;case"tab_applications":PermissionManager.subJobApplicationValidate("JobApplication")&&this.select_company_id===LocalCacheData.getCurrentCompany().id&&(a=!0);break;case"tab_accruals":PermissionManager.checkTopLevelPermission("AccrualPolicy")&&this.select_company_id===LocalCacheData.getCurrentCompany().id&&(a=!0);break;case"tab_qualifications":PermissionManager.checkTopLevelPermission("Qualification")&&this.select_company_id===LocalCacheData.getCurrentCompany().id&&(a=!0);break;case"tab_reviews":PermissionManager.checkTopLevelPermission("UserReviewControl")&&this.select_company_id===LocalCacheData.getCurrentCompany().id&&(a=!0);break;default:a=super.checkTabPermissions(e);break}return a}setCurrentEditRecordData(){var e=this,a={};for(var l in this.current_edit_record){var o=this.edit_view_ui_dic[l];if(Global.isSet(o)||l==="hierarchy_control")switch(l){case"first_name":case"last_name":a[l+"_1"]=!0;var r=this.edit_view_ui_dic[l+"_1"];r.setValue(this.current_edit_record[l]),o.setValue(this.current_edit_record[l]);break;case"country":this.setCountryValue(o,l);break;case"hierarchy_control":if(this.show_hierarchy)for(var _ in this.current_edit_record.hierarchy_control){var c=this.current_edit_record.hierarchy_control[_];this.edit_view_ui_dic[_]&&(o=this.edit_view_ui_dic[_],a[_]=!0,o.setValue(c))}break;case"default_job_id":o.setValue(this.current_edit_record[l]);break;case"default_job_item_id":var n={};n.filter_data={status_id:10,job_id:this.current_edit_record.default_job_id},o.setDefaultArgs(n),o.setValue(this.current_edit_record[l]);break;case"default_punch_tag_id":if(Global.getProductEdition()>=20){o.setValue(this.current_edit_record[l]),this.previous_punch_tag_selection=this.current_edit_record[l];var d=o;TTPromise.wait(null,null,function(){var m={};m.filter_data=e.getPunchTagFilterData(),d.setDefaultArgs(m)})}break;case"job_quick_search":break;case"job_item_quick_search":break;case"punch_tag_quick_search":break;default:if(!a[l]){o.setValue(this.current_edit_record[l]);break}break}}if(this.current_edit_record.id)this.file_browser&&(this.file_browser.show(),this.file_browser.setImage(ServiceCaller.getURLByObjectType("user_photo")+"&object_id="+this.current_edit_record.id),this.is_viewing?this.file_browser.setEnable(!1):this.file_browser.setEnable(!0),t(".upload-image-alert").remove());else if(this.file_browser){this.file_browser.hide();var u=t('<span class="upload-image-alert">');u.text(t.i18n._("Please save this record before uploading a photo")),this.file_browser.parent().append(u)}this.edit_view_ui_dic.company_id&&this.edit_view_ui_dic.company_id.setEnabled(!1),this.edit_view_ui_dic.mfa_type_id&&(this.edit_view_ui_dic.mfa_type_id.setEnabled(!1),this.current_edit_record.mfa_type_id==1e3&&this.detachElement("mfa_type_id")),this.collectUIDataToCurrentEditRecord(),this.setEmailIcon(),this.setEditViewDataDone()}setEmailIcon(){var e=this;t(".employee-email-icon").remove();var a=t('<img title="'+t.i18n._("ReValidate Email Address")+'" class="employee-email-icon work-email" src="theme/default/images/email16x16.png">'),l=t('<img title="'+t.i18n._("ReValidate Email Address")+'" class="employee-email-icon home-email" src="theme/default/images/email16x16.png">');this.current_edit_record.hasOwnProperty("work_email_is_valid")&&!this.current_edit_record.work_email_is_valid&&(this.edit_view_form_item_dic.work_email.children().eq(1).append(a),a.on("click",function(){o()})),this.current_edit_record.hasOwnProperty("home_email_is_valid")&&!this.current_edit_record.home_email_is_valid&&(this.edit_view_form_item_dic.home_email.children().eq(1).append(l),l.on("click",function(){o()}));function o(){e.api.sendValidationEmail(e.current_edit_record.id,{onResult:function(r){r&&r.isValid()?TAlertManager.showAlert(t.i18n._("Validation email sent...")):TAlertManager.showAlert(t.i18n._("No validation email sent..."))}})}}onSaveResult(e){if(super.onSaveResult(e),e&&e.isValid()){var a=e.getAttributeInAPIDetails("system_job_queue");a&&this.event_bus.emit("tt_topbar","toggle_job_queue_spinner",{show:!0,get_job_data:!0})}}onSaveDone(e){this.edit_only_mode&&LocalCacheData.current_open_primary_controller.viewId==="TimeSheet"&&LocalCacheData.current_open_primary_controller.updateSelectUserAndRefresh(this.current_edit_record)}getCopyAsNewFilter(e){return e.filter_data.company_id=this.select_company_id,e}onAddClick(){var e=this;if(Global.getProductEdition()==10)e.selectUserDefaultSettings(null);else{var a={};a.filter_columns={id:!0,name:!0},e.edit_view_tab&&(e.edit_view_tab.tabs("option","active",0),t(".employee-edit-view .label-wrap").scrollLeft(0)),e.api_user_default.getUserDefault(a,{onResult:function(l){var o=l.getResult();o.length>1?e.showUserDefaultChoiceModal(o):o.length===1?e.selectUserDefaultSettings(o[0].id):e.selectUserDefaultSettings(null)}})}}showUserDefaultChoiceModal(e){for(var a=0;a<e.length;a++)e[a].value=e[a].id,e[a].label=e[a].name;TAlertManager.showFlexAlert(t.i18n._("New Hire Default"),t.i18n._("Select a new hire default template to use for this employee."),"dropdown",e,l=>{l!==!1&&this.selectUserDefaultSettings(l)})}selectUserDefaultSettings(e){var a=this;this.setCurrentEditViewState("new"),a.openEditView(),a.api["get"+a.api.key_name+"DefaultData"](this.select_company_id,e,{onResult:function(l){a.onAddResult(l)}})}onMassEditClick(){var e=this;e.is_add=!1,e.is_viewing=!1,e.is_mass_editing=!0,LocalCacheData.current_doing_context_action="mass_edit",e.openEditView();var a={},l=this.getGridSelectIdArray();l.length,this.mass_edit_record_ids=[],t.each(l,function(o,r){e.mass_edit_record_ids.push(r)}),a.filter_data={},a.filter_data.id=this.mass_edit_record_ids,a.filter_data.company_id=this.select_company_id,this.api["getCommon"+this.api.key_name+"Data"](a,{onResult:function(o){var r=o.getResult();r||(r=[]),e.api.getOptions("unique_columns",{onResult:function(_){e.unique_columns=_.getResult(),e.api.getOptions("linked_columns",{onResult:function(c){e.linked_columns=c.getResult(),e.sub_view_mode&&e.parent_key&&(r[e.parent_key]=e.parent_value),e.current_edit_record=r,e.initEditView()}})}})}})}getAPIFilters(){var e=super.getAPIFilters();return e.filter_data.company_id=this.select_company_id,e}search(e,a,l,o){Global.isSet(e)||(e=!0);var r=this,_={};if(_.filter_data={},_.filter_sort={},_.filter_columns=this.getFilterColumnsFromDisplayColumns(),_.filter_items_per_page=0,this.pager_data)if(LocalCacheData.paging_type===0)a==="next"?_.filter_page=this.pager_data.next_page:_.filter_page=1;else switch(a){case"next":_.filter_page=this.pager_data.next_page;break;case"last":_.filter_page=this.pager_data.previous_page;break;case"start":_.filter_page=1;break;case"end":_.filter_page=this.pager_data.last_page_number;break;case"go_to":_.filter_page=l;break;default:_.filter_page=this.pager_data.current_page;break}else _.filter_page=1;if(this.sub_view_mode&&this.parent_key&&(this.select_layout.data.filter_data[this.parent_key]=this.parent_value),Global.isSet(this.getSubViewFilter)&&(this.select_layout.data.filter_data=this.getSubViewFilter(this.select_layout.data.filter_data)),_.filter_data=Global.convertLayoutFilterToAPIFilter(this.select_layout),this.select_layout&&this.select_layout.data&&(_.filter_sort=this.select_layout.data.filter_sort),TTUUID.isUUID(this.refresh_id))_.filter_data={},_.filter_data.id=[this.refresh_id],this.last_select_ids=_.filter_data.id;else{this.last_select_ids=[];for(var c=this.getGridSelectIdArray(),n=0;n<c.length;n++)this.last_select_ids.push(c[n])}this.api["get"+this.api.key_name](_,{onResult:function(d){var u=d.getResult();if(Global.isArray(u)?(r.removeNoResultCover(),Global.isSet(r.__createRowId)&&(u=r.__createRowId(u)),u=Global.formatGridData(u,r.api.key_name)):r.showNoResultCover(),TTUUID.isUUID(r.refresh_id)){if(r.refresh_id=null,r.grid){var m=r.grid.getData(),b=m.length;t.type(m)!=="array"&&(m=[]);var h=!1,p=u[0];if(p){for(var v=0;v<b;v++){var g=m[v];if(g.id==p.id){r.grid.grid.setRowData(p.id,p),h=!0;break}}h||(r.grid.setData(m.concat(p)),r.highLightGridRowById(p.id))}}}else{if(r.pager_data=d.getPagerData(),LocalCacheData.paging_type!==0&&(r.paging_widget.setPagerData(r.pager_data),r.paging_widget_2.setPagerData(r.pager_data)),LocalCacheData.paging_type===0&&a==="next"){var T=r.grid.getData();u=T.concat(u)}r.grid&&(r.grid.setData(u),r.reSelectLastSelectItems())}r.setGridCellBackGround(),ProgressBar.closeOverlay(),e&&r.setDefaultMenu(!0),LocalCacheData.paging_type===0&&(!r.pager_data||r.pager_data.is_last_page?r.paging_widget.css("display","none"):r.paging_widget.css("display","block")),o&&o(d),e&&r.autoOpenEditViewIfNecessary(),r.searchDone()}}),_&&_.filter_data&&_.filter_data.company_id?(this.select_company_id=_.filter_data.company_id,this.user_group_api.getUserGroup({filter_data:{company_id:this.select_company_id}},!1,!1,{onResult:function(d){d=d.getResult(),d=Global.buildTreeRecord(d),r.edit_only_mode||!r.sub_view_mode&&r.basic_search_field_ui_dic.group_id&&(r.basic_search_field_ui_dic.group_id.setSourceData(d),r.adv_search_field_ui_dic.group_id.setSourceData(d)),r.user_group_array=d}})):this.select_company_id=LocalCacheData.getCurrentCompany().id}onCustomContextClick(e){switch(e){case"import_icon":this.onImportClick();break;case"timesheet":case"schedule":case"pay_stub":case"pay_stub_amendment":this.onNavigationClick(e);break}}onMapClick(){if(Global.getProductEdition()>=15){this.is_viewing=!1,ProgressBar.showProgressBar();var e={filter_columns:{id:!0,first_name:!0,last_name:!0,address1:!0,address2:!0,city:!0,province:!0,country:!0,postal_code:!0,latitude:!0,longitude:!0}},a=[];if(this.is_edit)a.push(this.current_edit_record);else{var l=this.getGridSelectIdArray();e.filter_data=Global.convertLayoutFilterToAPIFilter(this.select_layout),l.length>0&&(e.filter_data.id=l),a=this.api.getUser(e,{async:!1}).getResult()}this.is_mass_editing||M(()=>import("./leaflet-timetrex-D9Z7_Af6.bundle.js"),__vite__mapDeps([0,1]),import.meta.url).then(o=>{var r=o.TTConvertMapData.processBasicFromGenericViewController(a);IndexViewController.openEditView(this,"Map",r)}).catch(Global.importErrorHandler)}}onImportClick(){var e=this;IndexViewController.openWizard("ImportCSVWizard","User",function(){e.search()})}onNavigationClick(e){var a=this,l,o={},r=[],_=new Date().format();switch(a.edit_view&&a.current_edit_record.id?r.push(a.current_edit_record.id):(l=this.getGridSelectIdArray(),t.each(l,function(n,d){var u=a.getRecordFromGridById(d);r.push(u.id)})),e){case"timesheet":r.length>0&&(o.user_id=r[0],o.base_date=_,Global.addViewTab(a.viewId,t.i18n._("Employees"),window.location.href),IndexViewController.goToView("TimeSheet",o));break;case"schedule":o.filter_data={};var c={value:r};o.filter_data.include_user_ids=c,o.select_date=_,Global.addViewTab(this.viewId,t.i18n._("Employees"),window.location.href),IndexViewController.goToView("Schedule",o);break;case"pay_stub":r.length>0&&(o.filter_data={},o.filter_data.user_id=r[0],Global.addViewTab(a.viewId,t.i18n._("Employees"),window.location.href),IndexViewController.goToView("PayStub",o));break;case"pay_stub_amendment":r.length>0&&(o.filter_data={},o.filter_data.user_id=r[0],Global.addViewTab(this.viewId,t.i18n._("Employees"),window.location.href),IndexViewController.goToView("PayStubAmendment",o));break}}removeEditView(){super.removeEditView(),this.sub_user_contact_view_controller=null,this.sub_wage_view_controller=null,this.sub_company_tax_view_controller=null,this.sub_accrual_policy_user_modifier_view_controller=null,this.sub_user_review_control_view_controller=null,this.sub_job_application_view_controller=null,this.sub_user_skill_view_controller=null,this.sub_user_education_view_controller=null,this.sub_user_membership_view_controller=null,this.sub_user_license_view_controller=null,this.sub_user_language_view_controller=null,this.sub_payment_methods_view_controller=null}buildEditViewUI(){super.buildEditViewUI();var e=this,a={tab_employee:{label:t.i18n._("Employee"),is_multi_column:!0},tab_contact_info:{label:t.i18n._("Contact Info"),is_multi_column:!0},tab_hierarchy:{label:t.i18n._("Hierarchy"),display_on_mass_edit:!1,html_template:this.getHierarchyTabHtml()},tab_login:{label:t.i18n._("Sign In"),is_multi_column:!0},tab_wage:{label:t.i18n._("Wage"),is_sub_view:!0,init_callback:"initSubWageView",display_on_mass_edit:!1},tab_tax:{label:t.i18n._("Tax"),is_sub_view:!0,init_callback:"initSubCompanyTaxView",display_on_mass_edit:!1},tab_payment_methods:{label:t.i18n._("Pay Methods"),init_callback:"initSubPaymentMethodsView",display_on_mass_edit:!1},tab_contacts:{label:t.i18n._("Contacts"),init_callback:"initSubUserContactView",display_on_mass_edit:!1},tab_applications:{label:t.i18n._("Applications"),init_callback:"initSubJobApplicationView",display_on_mass_edit:!1},tab_accruals:{label:t.i18n._("Accruals"),init_callback:"initSubAccrualPolicyUserModifier",display_on_mass_edit:!1,show_permission_div:!0},tab_qualifications:{label:t.i18n._("Qualifications"),init_callback:"initSubQualificationView",display_on_mass_edit:!1,html_template:this.getQualificationsTabHtml()},tab_reviews:{label:t.i18n._("Reviews"),init_callback:"initSubUserReviewControlView",display_on_mass_edit:!1},tab_attachment:!0,tab_audit:!0};this.setTabModel(a),this.edit_only_mode||(this.navigation.AComboBox({id:this.script_name+"_navigation",api_class:TTAPI.APIUser,allow_multiple_selection:!1,layout_name:"global_user",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation());var l=this.edit_view_tab.find("#tab_employee"),o=l.find(".first-column"),r=l.find(".second-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(o),this.edit_view_tabs[0].push(r);var i=Global.loadWidgetByName(FormItemType.AWESOME_BOX);if(i.AComboBox({api_class:TTAPI.APICompany,allow_multiple_selection:!1,layout_name:"global_company",show_search_inputs:!0,set_empty:!0,field:"company_id"}),this.addEditFieldToColumn(t.i18n._("Company"),i,o),i.setEnabled(!1),i=Global.loadWidgetByName(FormItemType.AWESOME_BOX),i.AComboBox({api_class:TTAPI.APILegalEntity,allow_multiple_selection:!1,layout_name:"global_legal_entity",show_search_inputs:!0,field:"legal_entity_id",customSearchFilter:function(s){return e.setCompanyIdFilter(s)},set_empty:!0}),this.addEditFieldToColumn(t.i18n._("Legal Entity"),i,o),i=Global.loadWidgetByName(FormItemType.COMBO_BOX),i.TComboBox({field:"status_id"}),i.setSourceData(e.status_array),this.addEditFieldToColumn(t.i18n._("Status"),i,o),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"first_name",width:200}),this.addEditFieldToColumn(t.i18n._("First Name"),i,o,""),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"last_name",width:200}),this.addEditFieldToColumn(t.i18n._("Last Name"),i,o),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"employee_number",width:90}),this.addEditFieldToColumn(t.i18n._("Employee Number"),i,o),i=Global.loadWidgetByName(FormItemType.AWESOME_BOX),i.AComboBox({api_class:TTAPI.APIPermissionControl,allow_multiple_selection:!1,layout_name:"global_permission_control",show_search_inputs:!0,field:"permission_control_id",customSearchFilter:function(s){return e.setCompanyIdFilter(s)},set_empty:!0}),this.addEditFieldToColumn(t.i18n._("Permission Group"),i,o),i=Global.loadWidgetByName(FormItemType.AWESOME_BOX),i.AComboBox({api_class:TTAPI.APIPayPeriodSchedule,allow_multiple_selection:!1,layout_name:"global_pay_period_schedule",show_search_inputs:!0,customSearchFilter:function(s){return e.setCompanyIdFilter(s)},set_empty:!0,field:"pay_period_schedule_id"}),this.addEditFieldToColumn(t.i18n._("Pay Period Schedule"),i,o),i=Global.loadWidgetByName(FormItemType.AWESOME_BOX),i.AComboBox({api_class:TTAPI.APIPolicyGroup,allow_multiple_selection:!1,layout_name:"global_policy_group",customSearchFilter:function(s){return e.setCompanyIdFilter(s)},show_search_inputs:!0,set_empty:!0,field:"policy_group_id"}),this.addEditFieldToColumn(t.i18n._("Policy Group"),i,o),this.is_add&&(i=Global.loadWidgetByName(FormItemType.AWESOME_BOX),i.AComboBox({field:"recurring_schedule_id",api_class:TTAPI.APIRecurringScheduleTemplateControl,allow_multiple_selection:!0,layout_name:"global_recurring_template_control",show_search_inputs:!0,set_empty:!0}),this.addEditFieldToColumn(t.i18n._("Recurring Schedule"),i,o,"first_last")),i=Global.loadWidgetByName(FormItemType.AWESOME_BOX),i.AComboBox({api_class:TTAPI.APIUserTitle,allow_multiple_selection:!1,layout_name:"global_job_title",customSearchFilter:function(s){return e.setCompanyIdFilter(s)},show_search_inputs:!0,set_empty:!0,field:"title_id"}),this.addEditFieldToColumn(t.i18n._("Title"),i,o,""),i=Global.loadWidgetByName(FormItemType.AWESOME_BOX),i.AComboBox({api_class:TTAPI.APICurrency,allow_multiple_selection:!1,layout_name:"global_currency",customSearchFilter:function(s){return e.setCompanyIdFilter(s)},show_search_inputs:!0,field:"currency_id",set_empty:!0}),this.addEditFieldToColumn(t.i18n._("Currency"),i,r),i=Global.loadWidgetByName(FormItemType.AWESOME_BOX),i.AComboBox({api_class:TTAPI.APIBranch,allow_multiple_selection:!1,customSearchFilter:function(s){return e.setCompanyIdFilter(s)},layout_name:"global_branch",show_search_inputs:!0,set_empty:!0,field:"default_branch_id"}),this.addEditFieldToColumn(t.i18n._("Default Branch"),i,r),i=Global.loadWidgetByName(FormItemType.AWESOME_BOX),i.AComboBox({api_class:TTAPI.APIDepartment,allow_multiple_selection:!1,layout_name:"global_department",customSearchFilter:function(s){return e.setCompanyIdFilter(s)},show_search_inputs:!0,set_empty:!0,field:"default_department_id"}),this.addEditFieldToColumn(t.i18n._("Default Department"),i,r),this.initPermission(),Global.getProductEdition()>=20){i=Global.loadWidgetByName(FormItemType.AWESOME_BOX),i.AComboBox({api_class:TTAPI.APIJob,allow_multiple_selection:!1,layout_name:"global_job",customSearchFilter:function(s){return e.setCompanyIdFilter(s)},show_search_inputs:!0,set_empty:!0,always_include_columns:["group_id"],setRealValueCallBack:function(s){s&&c.setValue(s.manual_id)},field:"default_job_id"});var _=t("<div class='widget-h-box'></div>"),c=Global.loadWidgetByName(FormItemType.TEXT_INPUT);c.TTextInput({field:"job_quick_search",disable_keyup_event:!0}),c.addClass("job-coder"),_.append(c),_.append(i),this.addEditFieldToColumn(t.i18n._("Default Job"),[i,c],r,"",_,!0),this.show_job_ui||this.detachElement("default_job_id"),i=Global.loadWidgetByName(FormItemType.AWESOME_BOX),i.AComboBox({api_class:TTAPI.APIJobItem,allow_multiple_selection:!1,layout_name:"global_job_item",customSearchFilter:function(s){return e.setCompanyIdFilter(s)},show_search_inputs:!0,set_empty:!0,always_include_columns:["group_id"],setRealValueCallBack:function(s){s&&d.setValue(s.manual_id)},field:"default_job_item_id"});var n=t("<div class='widget-h-box'></div>"),d=Global.loadWidgetByName(FormItemType.TEXT_INPUT);d.TTextInput({field:"job_item_quick_search",disable_keyup_event:!0}),d.addClass("job-coder"),n.append(d),n.append(i),this.addEditFieldToColumn(t.i18n._("Default Task"),[i,d],r,"",n,!0),this.show_job_item_ui||this.detachElement("default_job_item_id"),i=Global.loadWidgetByName(FormItemType.AWESOME_BOX),i.AComboBox({api_class:TTAPI.APIPunchTag,allow_multiple_selection:!0,layout_name:"global_punch_tag",customSearchFilter:function(s){return e.setCompanyIdFilter(s)},show_search_inputs:!0,set_empty:!0,get_real_data_on_multi:!0,setRealValueCallBack:(s,f)=>{s&&this.setPunchTagQuickSearchManualIds(s,f)},field:"default_punch_tag_id"});var u=t("<div class='widget-h-box'></div>"),m=Global.loadWidgetByName(FormItemType.TEXT_INPUT);m.TTextInput({field:"punch_tag_quick_search",disable_keyup_event:!0}),m.addClass("job-coder"),u.append(m),u.append(i),this.addEditFieldToColumn(t.i18n._("Default Punch Tag"),[i,m],r,"",u,!0),this.show_punch_tag_ui||this.detachElement("default_punch_tag_id")}i=Global.loadWidgetByName(FormItemType.AWESOME_BOX),i.AComboBox({tree_mode:!0,allow_multiple_selection:!1,layout_name:"global_tree_column",set_empty:!0,field:"group_id"}),i.setSourceData(e.user_group_array),this.addEditFieldToColumn(t.i18n._("Group"),i,r),i=Global.loadWidgetByName(FormItemType.AWESOME_BOX),i.AComboBox({api_class:TTAPI.APIEthnicGroup,allow_multiple_selection:!1,layout_name:"global_ethnic_group",customSearchFilter:function(s){return e.setCompanyIdFilter(s)},show_search_inputs:!0,field:"ethnic_group_id",set_empty:!0}),this.addEditFieldToColumn(t.i18n._("Ethnicity"),i,r),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"sin",width:90}),this.addEditFieldToColumn(t.i18n._("SIN / SSN"),i,r),i=Global.loadWidgetByName(FormItemType.DATE_PICKER),i.TDatePicker({field:"birth_date"}),this.addEditFieldToColumn(t.i18n._("Birth Date"),i,r),i=Global.loadWidgetByName(FormItemType.DATE_PICKER),i.TDatePicker({field:"hire_date"}),this.addEditFieldToColumn(t.i18n._("Hire Date"),i,r),i=Global.loadWidgetByName(FormItemType.DATE_PICKER),i.TDatePicker({field:"termination_date"}),this.addEditFieldToColumn(t.i18n._("Termination Date"),i,r),i=Global.loadWidgetByName(FormItemType.TAG_INPUT),i.TTagInput({field:"tag",object_type_id:200}),this.addEditFieldToColumn(t.i18n._("Tags"),i,r,"",null,null,!0);var b=this.edit_view_tab.find("#tab_contact_info"),h=b.find(".first-column"),p=b.find(".second-column");this.edit_view_tabs[1]=[],this.edit_view_tabs[1].push(h),this.edit_view_tabs[1].push(p),typeof FormData>"u"?(i=Global.loadWidgetByName(FormItemType.IMAGE_BROWSER),this.file_browser=i.TImageBrowser({field:"",default_width:128,default_height:128,enable_delete:!0}),this.file_browser.bind("imageChange",function(s,f){new ServiceCaller().uploadFile(f.getValue(),"object_type=user_photo&object_id="+e.current_edit_record.id,{onResult:function(F){F.toLowerCase()==="true"?e.refreshProfileImage(e.file_browser):TAlertManager.showAlert(F,"Error")}})})):(i=Global.loadWidgetByName(FormItemType.IMAGE_AVD_BROWSER),this.file_browser=i.TImageAdvBrowser({field:"",default_width:128,default_height:128,enable_delete:!0,callBack:function(s){new ServiceCaller().uploadFile(s,"object_type=user_photo&object_id="+e.current_edit_record.id,{onResult:function(f){f.toLowerCase()==="true"?e.refreshProfileImage(e.file_browser):TAlertManager.showAlert(f,"Error")}})},deleteImageHandler:function(s){e.onDeleteImage(()=>{e.refreshProfileImage(e.file_browser)})}})),this.is_edit&&(this.file_browser.setEnableDelete(!0),this.file_browser.bind("deleteClick",function(s,f){e.api.deleteImage(e.current_edit_record.id,{onResult:function(F){e.onDeleteImage(()=>{e.refreshProfileImage(e.file_browser)})}})})),this.addEditFieldToColumn(t.i18n._("Photo"),this.file_browser,h,"",null,!1,!0),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"first_name_1",width:200}),this.addEditFieldToColumn(t.i18n._("First Name"),i,h),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"middle_name",width:200}),this.addEditFieldToColumn(t.i18n._("Middle Name"),i,h),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"last_name_1",width:200}),this.addEditFieldToColumn(t.i18n._("Last Name"),i,h),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"address1",width:"100%"}),this.addEditFieldToColumn(t.i18n._("Home Address (Line 1)"),i,h),i.parent().width("45%"),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"address2",width:"100%"}),this.addEditFieldToColumn(t.i18n._("Home Address (Line 2)"),i,h),i.parent().width("45%"),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"city",width:200}),this.addEditFieldToColumn(t.i18n._("City"),i,h),i=Global.loadWidgetByName(FormItemType.COMBO_BOX),i.TComboBox({field:"country",set_empty:!0}),i.setSourceData(e.country_array),this.addEditFieldToColumn(t.i18n._("Country"),i,h),i=Global.loadWidgetByName(FormItemType.COMBO_BOX),i.TComboBox({field:"province"}),i.setSourceData([]),this.addEditFieldToColumn(t.i18n._("Province/State"),i,h),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"postal_code",width:200}),this.addEditFieldToColumn(t.i18n._("Postal/ZIP Code"),i,h,""),i=Global.loadWidgetByName(FormItemType.COMBO_BOX),i.TComboBox({field:"sex_id"}),i.setSourceData(e.sex_array),this.addEditFieldToColumn(t.i18n._("Gender"),i,p),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"work_phone",width:200}),this.addEditFieldToColumn(t.i18n._("Work Phone"),i,p,""),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"work_phone_ext"}),i.css("width","50"),this.addEditFieldToColumn(t.i18n._("Work Phone Ext"),i,p),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"home_phone",width:200}),this.addEditFieldToColumn(t.i18n._("Home Phone"),i,p),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"mobile_phone",width:200}),this.addEditFieldToColumn(t.i18n._("Mobile Phone"),i,p),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"fax_phone",width:200}),this.addEditFieldToColumn(t.i18n._("Fax"),i,p),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"work_email",width:200}),this.addEditFieldToColumn(t.i18n._("Work Email"),i,p,"",null,!0),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"home_email",width:200}),this.addEditFieldToColumn(t.i18n._("Home Email"),i,p,"",null,!0),i=Global.loadWidgetByName(FormItemType.TEXT_AREA),i.TTextArea({field:"note",width:"100%",rows:4}),this.addEditFieldToColumn(t.i18n._("Note"),i,p,"",null,null,!0),i.parent().width("45%");var v=this.edit_view_tab.find("#tab_hierarchy"),g=v.find(".first-column");if(this.edit_view_tabs[2]=[],this.edit_view_tabs[2].push(g),this.hierarchyPermissionValidate()){var T=this.hierarchyControlAPI.getHierarchyControlOptions({async:!1});if(e.hierarchy_options_dic={},T){var A=T.getResult();for(var C in A)parseInt(C)===200&&Global.getProductEdition()!=25||(e.hierarchy_options_dic[C]=Global.buildRecordArray(A[C]))}S.size(e.hierarchy_options_dic)>0?e.show_hierarchy=!0:e.show_hierarchy=!1}if(this.show_hierarchy&&this.hierarchy_ui_model){this.edit_view_tab.find("#tab_hierarchy").find(".first-column").css("display","block"),this.edit_view_tab.find("#tab_hierarchy").find(".hierarchy-div").css("display","none");for(var k=this.hierarchy_ui_model.length,I=0;I<k;I++){var P=this.hierarchy_ui_model[I],B=this.hierarchy_options_dic[P.id];B&&(i=Global.loadWidgetByName(FormItemType.COMBO_BOX),i.TComboBox({field:P.id}),i.setSourceData(B),this.addEditFieldToColumn(P.value,i,g))}}else this.edit_view_tab.find("#tab_hierarchy").find(".first-column").css("display","none"),this.edit_view_tab.find("#tab_hierarchy").find(".hierarchy-div").NoHierarchyBox({related_view_controller:this}),this.edit_view_tab.find("#tab_hierarchy").find(".hierarchy-div").css("display","block");var D=this.edit_view_tab.find("#tab_login"),w=D.find(".first-column"),y=D.find(".second-column");this.edit_view_tabs[3]=[],this.edit_view_tabs[3].push(w),this.edit_view_tabs[3].push(y),i=Global.loadWidgetByName(FormItemType.CHECKBOX),i.TCheckbox({field:"enable_login"}),this.addEditFieldToColumn(t.i18n._("Sign In Enabled"),i,w);var i=Global.loadWidgetByName(FormItemType.COMBO_BOX);if(i.TComboBox({field:"mfa_type_id"}),i.setSourceData(e.mfa_type_array),this.addEditFieldToColumn(t.i18n._("Multifactor Authentication"),i,w,null,null,!0),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"user_name",width:200}),this.addEditFieldToColumn(t.i18n._("User Name"),i,w),i=Global.loadWidgetByName(FormItemType.PASSWORD_INPUT),i.TTextInput({field:"password",width:200}),this.addEditFieldToColumn(t.i18n._("Change Password"),i,w),i=Global.loadWidgetByName(FormItemType.PASSWORD_INPUT),i.TTextInput({field:"password_confirm",width:200}),this.addEditFieldToColumn(t.i18n._("Confirm Password"),i,w),Global.getProductEdition()>10){i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"phone_id",width:90});var E=t("<div class='widget-h-box'></div>");E.append(i),E.append(t("<span class='widget-right-label'>( "+t.i18n._("Optional")+" )</span>")),this.addEditFieldToColumn(t.i18n._("Quick Punch ID"),i,y,"",E),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"phone_password",width:90}),this.addEditFieldToColumn(t.i18n._("Quick Punch Password"),i,y)}i=Global.loadWidgetByName(FormItemType.DATE_PICKER),i.TDatePicker({field:"login_expire_date"});var V=t("<div class='widget-h-box'></div>");V.append(i),V.append(t("<span class='widget-right-label'>( "+t.i18n._("Leave blank to never expire")+" )</span>")),this.addEditFieldToColumn(t.i18n._("Sign In Expire Date"),i,y,"",V),i=Global.loadWidgetByName(FormItemType.AWESOME_BOX),i.AComboBox({api_class:TTAPI.APIPermissionControl,allow_multiple_selection:!1,layout_name:"global_permission_control",show_search_inputs:!0,field:"terminated_permission_control_id",customSearchFilter:function(s){return e.setCompanyIdFilter(s)},set_empty:!0}),this.addEditFieldToColumn(t.i18n._("Terminated Permission Group"),i,y),TTPromise.resolve("employeeEditView","openEditView")}getQualificationsTabHtml(){var e=`<div id="tab_qualifications" class="edit-view-tab-outside-sub-view">
								<div class="edit-view-tab" id="tab_qualifications_content_div">
									<div class="first-column-sub-view">
										<div class="first-sub-view"></div>
										<div class="second-sub-view"></div>
										<div class="third-sub-view"></div>
										<div class="forth-sub-view"></div>
										<div class="fifth-sub-view"></div>
									</div>
									<div class="save-and-continue-div">
										<span class="message"></span>
										<div class="save-and-continue-button-div">
											<button class="tt-button p-button p-component" type="button">
												<span class="icon"></span>
												<span class="p-button-label"></span>
											</button>
										</div>
									</div>
								</div>
							</div>`;return e}setProvince(e,a){var l=this;!e||e==="-1"||e==="0"?(l.province_array=[],this.adv_search_field_ui_dic.province.setSourceData([])):this.company_api.getOptions("province",e,{onResult:function(o){o=o.getResult(),o||(o=[]),l.province_array=Global.buildRecordArray(o),l.adv_search_field_ui_dic.province.setSourceData(l.province_array)}})}eSetProvince(e,a){var l=this,o=l.edit_view_ui_dic.province;!e||e==="-1"||e==="0"?(l.e_province_array=[],o.setSourceData([])):this.company_api.getOptions("province",e,{onResult:function(r){r=r.getResult(),r||(r=[]),l.e_province_array=Global.buildRecordArray(r),a&&l.e_province_array.length>0&&(l.current_edit_record.province=l.e_province_array[0].value,o.setValue(l.current_edit_record.province)),o.setSourceData(l.e_province_array)}})}onSetSearchFilterFinished(){if(this.search_panel.getSelectTabIndex()===1){var e=this.adv_search_field_ui_dic.country,a=e.getValue();this.setProvince(a)}}onBuildBasicUIFinished(){this.search_panel.find("div #basic_search")}onBuildAdvUIFinished(){this.adv_search_field_ui_dic.country.change(t.proxy(function(){var e=this.adv_search_field_ui_dic.country,a=e.getValue();this.setProvince(a),this.adv_search_field_ui_dic.province.setValue(null)},this))}buildSearchFields(){super.buildSearchFields();var e=this;this.search_fields=[new SearchField({label:t.i18n._("Company"),in_column:1,field:"company_id",layout_name:"global_company",api_class:TTAPI.APICompany,multiple:!1,custom_first_label:Global.default_item,basic_search:!!PermissionManager.checkTopLevelPermission("Companies"),adv_search:!!PermissionManager.checkTopLevelPermission("Companies"),form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:t.i18n._("Legal Entity"),in_column:1,field:"legal_entity_id",layout_name:"global_legal_entity",api_class:TTAPI.APILegalEntity,multiple:!0,custom_first_label:Global.any_item,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:t.i18n._("Status"),in_column:1,field:"status_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:t.i18n._("First Name"),in_column:1,field:"first_name",basic_search:!0,adv_search:!0,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:t.i18n._("Last Name"),field:"last_name",basic_search:!0,adv_search:!0,in_column:1,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:t.i18n._("Employee Number"),field:"employee_number",basic_search:!1,adv_search:!0,in_column:1,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:t.i18n._("Phone"),field:"any_phone",basic_search:!1,adv_search:!0,in_column:1,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:t.i18n._("Email"),field:"any_email",basic_search:!1,adv_search:!0,in_column:2,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:t.i18n._("Tags"),field:"tag",basic_search:!0,adv_search:!0,in_column:2,object_type_id:200,form_item_type:FormItemType.TAG_INPUT}),new SearchField({label:t.i18n._("Gender"),in_column:2,field:"sex_id",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:t.i18n._("Group"),in_column:2,multiple:!0,field:"group_id",layout_name:"global_tree_column",tree_mode:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:t.i18n._("Default Branch"),in_column:2,field:"default_branch_id",layout_name:"global_branch",api_class:TTAPI.APIBranch,multiple:!0,basic_search:!0,adv_search:!0,customSearchFilter:function(a){return e.setCompanyIdFilter(a)},form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:t.i18n._("Default Department"),field:"default_department_id",in_column:2,layout_name:"global_department",api_class:TTAPI.APIDepartment,multiple:!0,basic_search:!0,adv_search:!0,customSearchFilter:function(a){return e.setCompanyIdFilter(a)},form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:t.i18n._("Policy Group"),field:"policy_group_id",in_column:3,layout_name:"global_policy_group",api_class:TTAPI.APIPolicyGroup,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:t.i18n._("Title"),field:"title_id",in_column:3,layout_name:"global_job_title",api_class:TTAPI.APIUserTitle,multiple:!0,basic_search:!1,adv_search:!0,customSearchFilter:function(a){return e.setCompanyIdFilter(a)},form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:t.i18n._("Country"),in_column:3,field:"country",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.COMBO_BOX}),new SearchField({label:t.i18n._("Province/State"),in_column:3,field:"province",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:t.i18n._("City"),field:"city",basic_search:!1,adv_search:!0,in_column:3,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:t.i18n._("SIN/SSN"),field:"sin",basic_search:!1,adv_search:!0,in_column:3,form_item_type:FormItemType.TEXT_INPUT})]}setCompanyIdFilter(e){return e?e.filter_data?e.filter_data.company_id=this.select_company_id:e.filter_data={company_id:this.select_company_id}:e={filter_data:{company_id:this.select_company_id}},e}cleanWhenUnloadView(e){t("#employee_view_container").remove(),super.cleanWhenUnloadView(e)}getFilterColumnsFromDisplayColumns(e,a){return e==null&&(e={}),e.company_id=!0,e.latitude=!0,e.longitude=!0,this._getFilterColumnsFromDisplayColumns(e,a)}getPunchTagFilterData(){if(!this.current_edit_record||!this.current_edit_record.user_id)return{};var e={status_id:10,user_id:this.current_edit_record.id,user_group_id:this.current_edit_record.group_id,branch_id:this.current_edit_record.default_branch_id,department_id:this.current_edit_record.default_department_id,job_id:this.current_edit_record.default_job_id,job_item_id:this.current_edit_record.default_job_item_id};return e}refreshProfileImage(e){let a=ServiceCaller.getURLByObjectType("user_photo")+"&object_id="+this.current_edit_record.id+"&refresh_id="+TTUUID.generateUUID();e.setImage(a),this.event_bus.emit("tt_topbar","refresh_profile_image",{image_url:a})}getHierarchyTabHtml(){return`<div id="tab_hierarchy" class="edit-view-tab-outside">
					<div class="edit-view-tab" id="tab_hierarchy_content_div">
						<div class="first-column full-width-column"></div>
						<div class="hierarchy-div">
							<span class="message"></span>
							<div class="save-and-continue-button-div">
								<button class="tt-button p-button p-component" type="button">
									<span class="icon"></span>
									<span class="p-button-label"></span>
								</button>
							</div>
						</div>
					</div>
				</div>`}}export{j as EmployeeViewController};
//# sourceMappingURL=EmployeeViewController-CIQk95iS.bundle.js.map
