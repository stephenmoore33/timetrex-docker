import{_ as s,j as n}from"./vendor-tTApdY0Y.bundle.js";class c extends BaseViewController{constructor(e={}){s.defaults(e,{el:"#invoice_transaction_view_container",status_array:null,type_array:null,payment_type_array:null,currency_array:null,currency_api:null}),super(e)}init(e){this.edit_view_tpl="InvoiceTransactionEditView.html",this.permission_id="transaction",this.viewId="InvoiceTransaction",this.script_name="InvoiceTransactionView",this.table_name_key="invoice_transaction",this.context_menu_name=n.i18n._("Transactions"),this.navigation_label=n.i18n._("Transaction"),this.api=TTAPI.APITransaction,this.currency_api=TTAPI.APICurrency,this.render(),this.buildContextMenu(),this.sub_view_mode||this.initData()}initOptions(e){var i=this,d={filter_columns:{name:!0,id:!0}},a=[{option_name:"status",field_name:null,api:null},{option_name:"type",field_name:null,api:null},{option_name:"payment_type",field_name:null,api:null}];this.currency_api.getCurrency(d,!1,{onResult:function(t){t=t.getResult();var _={};n.each(t,function(l,r){_[r.id]=r.name}),i.currency_array=Global.buildRecordArray(_),i.initDropDownOptions(a,function(l){e&&e(l)})}})}getCustomContextMenuModel(){var e={exclude:["default"],include:["edit","delete_icon","delete_and_next","save","save_and_continue","save_and_next","cancel"]};return!this.sub_view_mode&&!this.edit_only_mode&&e.include.push({label:n.i18n._("Jump To"),id:"jump_to_header",menu_align:"right",action_group:"jump_to",action_group_header:!0,permission_result:!1,sort_order:9050},{label:n.i18n._("Edit Client"),id:"edit_client",menu_align:"right",action_group:"jump_to",group:"navigation",sort_order:9050},{label:n.i18n._("Client Contacts"),id:"client_contact",menu_align:"right",action_group:"jump_to",group:"navigation",sort_order:9050},{label:n.i18n._("Invoices"),id:"invoice",menu_align:"right",action_group:"jump_to",group:"navigation",sort_order:9050},{label:n.i18n._("Payment Methods"),id:"payment_method",menu_align:"right",action_group:"jump_to",group:"navigation",sort_order:9050},"export_excel"),e}setCustomDefaultMenuIcon(e,i,d){switch(e){case"edit_client":this.setDefaultMenuEditClientIcon(i,d);break}}setDefaultMenuEditClientIcon(e,i,d){i===1?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}onCustomContextClick(e){switch(e){case"edit_client":case"client_contact":case"invoice":case"payment_method":case"export_excel":this.onNavigationClick(e);break}}onNavigationClick(e){var i=this,d,a={filter_data:{}},t=[];switch(i.edit_view&&i.current_edit_record.id?t.push(i.current_edit_record.client_id):(d=this.getGridSelectIdArray(),n.each(d,function(_,l){var r=i.getRecordFromGridById(l);t.push(r.client_id)})),a.filter_data.client_id=t,e){case"edit_client":t.length>0&&IndexViewController.openEditView(this,"Client",t[0]);break;case"client_contact":Global.addViewTab(i.viewId,n.i18n._("Transactions"),window.location.href),IndexViewController.goToView("ClientContact",a);break;case"invoice":Global.addViewTab(i.viewId,n.i18n._("Transactions"),window.location.href),IndexViewController.goToView("Invoice",a);break;case"payment_method":Global.addViewTab(i.viewId,n.i18n._("Transactions"),window.location.href),IndexViewController.goToView("ClientPayment",a);break;case"export_excel":this.onExportClick("export"+this.api.key_name);break}}buildEditViewUI(){super.buildEditViewUI();var e=this,i={tab_transaction:{label:n.i18n._("Transaction")},tab_audit:!0};this.setTabModel(i),this.edit_only_mode||(this.navigation.AComboBox({api_class:TTAPI.APITransaction,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_transaction",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation());var d=this.edit_view_tab.find("#tab_transaction"),a=d.find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(a);var t=Global.loadWidgetByName(FormItemType.COMBO_BOX);t.TComboBox({field:"status_id"}),t.setSourceData(e.status_array),this.addEditFieldToColumn(n.i18n._("Status"),t,a,""),t=Global.loadWidgetByName(FormItemType.COMBO_BOX),t.TComboBox({field:"currency_id"}),t.setSourceData(e.currency_array),this.addEditFieldToColumn(n.i18n._("Currency"),t,a),t=Global.loadWidgetByName(FormItemType.COMBO_BOX),t.TComboBox({field:"type_id"}),t.setSourceData(e.type_array),this.addEditFieldToColumn(n.i18n._("Type"),t,a),this.edit_only_mode||(t=Global.loadWidgetByName(FormItemType.AWESOME_BOX),t.AComboBox({api_class:TTAPI.APIProduct,allow_multiple_selection:!1,layout_name:"global_product",show_search_inputs:!0,set_empty:!0,field:"product_id"}),this.addEditFieldToColumn(n.i18n._("Product"),t,a,"",null,!0),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"description",width:"100%"}),this.addEditFieldToColumn(n.i18n._("Description"),t,a,"",null,!0),t.parent().width("45%"),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"quantity",width:80}),this.addEditFieldToColumn(n.i18n._("Quantity"),t,a,"",null,!0),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"unit_cost",width:80}),this.addEditFieldToColumn(n.i18n._("Unit Cost"),t,a,"",null,!0)),t=Global.loadWidgetByName(FormItemType.COMBO_BOX),t.TComboBox({field:"payment_type_id"}),t.setSourceData(e.payment_type_array),this.addEditFieldToColumn(n.i18n._("Payment Type"),t,a,"",null,!0);var _={};_.filter_data={},_.filter_data.client_id=-1,_.filter_data.type_id=[],t=Global.loadWidgetByName(FormItemType.AWESOME_BOX),t.AComboBox({api_class:TTAPI.APIClientPayment,allow_multiple_selection:!1,layout_name:"global_client_payment",show_search_inputs:!0,set_empty:!0,field:"client_payment_id"}),t.setDefaultArgs(_),this.addEditFieldToColumn(n.i18n._("Payment Method"),t,a,"",null,!0),this.edit_only_mode||(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"unit_price",width:80}),this.addEditFieldToColumn(n.i18n._("Unit Price"),t,a,"",null,!0)),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"amount",width:80}),this.addEditFieldToColumn(n.i18n._("Amount"),t,a),t=Global.loadWidgetByName(FormItemType.DATE_PICKER),t.TDatePicker({field:"effective_date"}),this.addEditFieldToColumn(n.i18n._("Effective Date"),t,a),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"confirm_number",width:120}),this.addEditFieldToColumn(n.i18n._("Confirmation Number"),t,a,"",null,!0),t=Global.loadWidgetByName(FormItemType.TEXT_AREA),t.TTextArea({field:"note",width:"100%"}),this.addEditFieldToColumn(n.i18n._("Note"),t,a,"",null,null,!0),t.parent().width("45%"),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"payment_process_message"}),this.addEditFieldToColumn(n.i18n._("Payment Process Message"),t,a,"",null,!0)}getTransactionDefaultData(e,i){this.api["get"+this.api.key_name+"DefaultData"](e.type_id,e.invoice_id,{onResult:function(d){var a=d.getResult();a||(a={}),a.invoice_id=e.invoice_id,a.client_id=e.client_id,a.type_id=e.type_id,a.currency_id=e.currency_id,a.amount=e.owing_amount,a.effective_date=new Date().format(),i(a)}})}openEditView(e){var i=this;e&&e.is_add&&(this.is_add=!0),i.edit_only_mode?i.initOptions(function(d){i.edit_view||i.initEditViewUI(i.viewId,i.edit_view_tpl),i.getTransactionDefaultData(e,function(a){i.current_edit_record=a,i.initEditView()})}):this.edit_view||this.initEditViewUI(this.viewId,this.edit_view_tpl)}getFilterColumnsFromDisplayColumns(){var e={};e.is_owner=!0,e.id=!0,e.is_child=!0,e.in_use=!0,e.first_name=!0,e.last_name=!0,e.client_id=!0;var i=[];if(this.grid&&(i=this.grid.getGridParam("colModel")),i)for(var d=i.length,a=0;a<d;a++){var t=i[a];e[t.name]=!0}return e}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:n.i18n._("Status"),in_column:1,field:"status_id",multiple:!0,basic_search:!0,adv_search:!1,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:n.i18n._("Type"),in_column:1,field:"type_id",multiple:!0,basic_search:!0,adv_search:!1,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:n.i18n._("Product"),in_column:1,field:"product_id",layout_name:"global_product",api_class:TTAPI.APIProduct,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:n.i18n._("Invoice Number"),in_column:2,field:"invoice_number",multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:n.i18n._("Client"),in_column:2,field:"client_id",layout_name:"global_client",api_class:TTAPI.APIClient,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX})]}setSelectLayout(){this.sub_view_mode?super.setSelectLayout(["client"]):super.setSelectLayout()}onFormItemChange(e,i){var d=e.getField(),a=e.getValue();this.current_edit_record[d]=a,this.is_changed=!0,d==="type_id"&&this.onTypeChange(),d==="payment_type_id"&&this.onPaymentTypeChange(!0),i||this.validate()}setCurrentEditRecordData(){this.current_edit_record.hasOwnProperty("payment_process_message")&&this.current_edit_record.payment_process_message?this.attachElement("payment_process_message"):this.detachElement("payment_process_message");for(var e in this.current_edit_record)if(this.current_edit_record.hasOwnProperty(e)){var i=this.edit_view_ui_dic[e];if(Global.isSet(i))switch(e){case"type_id":i.setValue(this.current_edit_record[e]);break;default:i.setValue(this.current_edit_record[e]);break}}this.collectUIDataToCurrentEditRecord(),this.setEditViewDataDone()}setEditViewDataDone(){super.setEditViewDataDone(),this.onTypeChange(),this.onPaymentTypeChange(),this.isEditChange()}onTypeChange(){this.current_edit_record.type_id==10?(this.detachElement("product_id"),this.detachElement("description"),this.detachElement("quantity"),this.detachElement("unit_cost"),this.detachElement("payment_type_id"),this.detachElement("client_payment_id"),this.detachElement("unit_price"),this.detachElement("confirm_number")):(this.edit_only_mode||(this.detachElement("product_id"),this.detachElement("description"),this.detachElement("quantity"),this.detachElement("unit_cost"),this.detachElement("unit_price")),this.attachElement("payment_type_id"),this.detachElement("client_payment_id"),this.detachElement("confirm_number")),this.editFieldResize()}onPaymentTypeChange(e){e&&(this.edit_view_ui_dic.client_payment_id.setValue(!1),this.current_edit_record.client_payment_id=!1),this.current_edit_record.payment_type_id==10?(this.detachElement("client_payment_id"),this.detachElement("confirm_number")):this.current_edit_record.payment_type_id==30||this.current_edit_record.payment_type_id==35||this.current_edit_record.payment_type_id==40?(this.edit_view_ui_dic.client_payment_id.setSourceData(null),this.current_edit_record.payment_type_id==40?(this.edit_view_ui_dic.client_payment_id.default_args.filter_data.client_id=this.current_edit_record.client_id,this.edit_view_ui_dic.client_payment_id.default_args.filter_data.type_id=[40]):(this.edit_view_ui_dic.client_payment_id.default_args.filter_data.client_id=this.current_edit_record.client_id,this.edit_view_ui_dic.client_payment_id.default_args.filter_data.type_id=[30]),this.attachElement("client_payment_id"),this.detachElement("confirm_number")):(this.attachElement("confirm_number"),this.detachElement("client_payment_id")),this.editFieldResize()}isEditChange(){this.current_edit_record.id?(this.edit_view_ui_dic.status_id.setEnabled(!1),this.edit_view_ui_dic.type_id.setEnabled(!1),this.edit_view_ui_dic.product_id.setEnabled(!1),this.edit_view_ui_dic.quantity.setEnabled(!1),this.edit_view_ui_dic.unit_cost.setEnabled(!1),this.edit_view_ui_dic.unit_price.setEnabled(!1)):this.edit_only_mode?(this.edit_view_ui_dic.status_id.setEnabled(!1),this.edit_view_ui_dic.currency_id.setEnabled(!1),this.edit_view_ui_dic.type_id.setEnabled(!1)):(this.edit_view_ui_dic.status_id.setEnabled(!0),this.edit_view_ui_dic.type_id.setEnabled(!0),this.edit_view_ui_dic.product_id.setEnabled(!0),this.edit_view_ui_dic.quantity.setEnabled(!0),this.edit_view_ui_dic.unit_cost.setEnabled(!0),this.edit_view_ui_dic.unit_price.setEnabled(!0))}onSaveClick(e,i=!1){return this.is_add==!0&&this.edit_view_ui_dic.amount.getValue()!=0&&(i=!0),super.onSaveClick(e,i)}onSaveResult(e){var i=this;if(e&&e.isValid()){var d=e.getResult();this.edit_only_mode||(d===!0?i.refresh_id=i.current_edit_record.id:TTUUID.isUUID(d)&&d!=TTUUID.zero_id&&d!=TTUUID.not_exist_id&&(i.refresh_id=d),i.search()),i.onSaveDone(e),i.removeEditView(),this.edit_only_mode&&(i.parent_view_controller.initInsideEditorData(!0),i.parent_view_controller.is_changed=!0)}else i.setErrorMenu(),i.setErrorTips(e)}}c.loadSubView=function(o,e,i){Global.loadViewSource("InvoiceTransaction","SubInvoiceTransactionView.html",function(d){var a={},t=s.template(d);Global.isSet(e)&&e(),Global.isSet(o)&&(o.html(t(a)),Global.isSet(i)&&i(sub_invoice_transaction_view_controller))})};export{c as InvoiceTransactionViewController};
//# sourceMappingURL=InvoiceTransactionViewController-DazPdlQW.bundle.js.map
