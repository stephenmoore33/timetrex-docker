{"version":3,"file":"FormulaBuilder-C7dDDUu-.bundle.js","sources":["../../global/widgets/formula_builder/FormulaBuilder.js"],"sourcesContent":["( function( $ ) {\n\n\t$.fn.FormulaBuilder = function( options ) {\n\t\tvar opts = $.extend( {}, $.fn.FormulaBuilder.defaults, options );\n\t\tvar $this = this;\n\t\tvar field;\n\n\t\tvar text_label = $.i18n._( 'Formula Builder' );\n\n\t\tvar field_type = 'textarea';\n\n\t\tvar error_string = '';\n\t\tvar error_tip_box;\n\n\t\tvar mass_edit_mode = false;\n\t\tvar check_box = null;\n\n\t\tvar enabled = true;\n\n\t\tvar text_input = null;\n\n\t\tthis.getEnabled = function() {\n\t\t\treturn enabled;\n\t\t};\n\n\t\tthis.setEnabled = function( val ) {\n\t\t\tenabled = val;\n\t\t\tif ( val === false || val === '' ) {\n\t\t\t\ttext_input.children().attr( 'disabled', 'true' );\n\t\t\t\ttext_input.addClass( 't-text-area-readonly' );\n\t\t\t} else {\n\t\t\t\ttext_input.children().removeAttr( 'disabled' );\n\t\t\t\ttext_input.removeClass( 't-text-area-readonly' );\n\t\t\t}\n\n\t\t};\n\n\t\tthis.setCheckBox = function( val ) {\n\t\t\tif ( check_box ) {\n\t\t\t\tcheck_box.children().eq( 0 )[0].checked = val;\n\t\t\t}\n\t\t};\n\n\t\tthis.isChecked = function() {\n\t\t\tif ( check_box ) {\n\t\t\t\tif ( check_box.children().eq( 0 )[0].checked === true ) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\n\t\tthis.setMassEditMode = function( val ) {\n\t\t\tmass_edit_mode = val;\n\n\t\t\tif ( mass_edit_mode ) {\n\t\t\t\tcheck_box = $( ' <div class=\"mass-edit-checkbox-wrapper\"><input type=\"checkbox\" class=\"mass-edit-checkbox\"></input>' +\n\t\t\t\t\t'<label for=\"checkbox-input-1\" class=\"input-helper input-helper--checkbox\"></label></div>' );\n\t\t\t\tcheck_box.insertBefore( text_input );\n\n\t\t\t\tcheck_box.change( function() {\n\t\t\t\t\t$this.trigger( 'formItemChange', [$this] );\n\t\t\t\t} );\n\n\t\t\t} else {\n\t\t\t\tif ( check_box ) {\n\t\t\t\t\tcheck_box.remove();\n\t\t\t\t\tcheck_box = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t};\n\n\t\tthis.setValue = function( val ) {\n\n\t\t\tif ( !val ) {\n\t\t\t\tval = '';\n\t\t\t}\n\n\t\t\ttext_input.val( val );\n\n\t\t};\n\n\t\tthis.setErrorStyle = function( errStr, show, isWarning ) {\n\t\t\tif ( isWarning ) {\n\t\t\t\ttext_input.addClass( 'warning-tip' );\n\t\t\t} else {\n\t\t\t\ttext_input.addClass( 'error-tip' );\n\t\t\t}\n\t\t\terror_string = errStr;\n\n\t\t\tif ( show ) {\n\t\t\t\tthis.showErrorTip();\n\t\t\t}\n\t\t};\n\n\t\tthis.showErrorTip = function( sec ) {\n\n\t\t\tif ( !Global.isSet( sec ) ) {\n\t\t\t\tsec = 2;\n\t\t\t}\n\n\t\t\tif ( !error_tip_box ) {\n\t\t\t\terror_tip_box = Global.loadWidgetByName( WidgetNamesDic.ERROR_TOOLTIP );\n\t\t\t\terror_tip_box = error_tip_box.ErrorTipBox();\n\t\t\t}\n\t\t\tif ( text_input.hasClass( 'warning-tip' ) ) {\n\t\t\t\terror_tip_box.show( this, error_string, sec, true );\n\t\t\t} else {\n\t\t\t\terror_tip_box.show( this, error_string, sec );\n\t\t\t}\n\t\t};\n\n\t\tthis.hideErrorTip = function() {\n\n\t\t\tif ( Global.isSet( error_tip_box ) ) {\n\t\t\t\terror_tip_box.remove();\n\t\t\t}\n\n\t\t};\n\n\t\tthis.clearErrorStyle = function() {\n\t\t\ttext_input.removeClass( 'error-tip' );\n\t\t\ttext_input.removeClass( 'warning-tip' );\n\t\t\tthis.hideErrorTip();\n\t\t\terror_string = '';\n\t\t};\n\n\t\tthis.setField = function( val ) {\n\t\t\tfield = val;\n\t\t};\n\n\t\tthis.getField = function() {\n\t\t\treturn field;\n\t\t};\n\n\t\tthis.getValue = function() {\n\t\t\treturn text_input.val();\n\t\t};\n\n\t\tthis.setValue = function( val ) {\n\n\t\t\tif ( !val ) {\n\t\t\t\tval = '';\n\t\t\t}\n\n\t\t\ttext_input.val( val );\n\t\t};\n\n\t\tthis.each( function() {\n\n\t\t\tvar o = $.meta ? $.extend( {}, opts, $( this ).data() ) : opts;\n\t\t\tvar calc_width = true;\n\n\t\t\tif ( o.field_type && o.field_type === 'text_input' ) {\n\t\t\t\t$( this ).html( $.fn.FormulaBuilder.html_template_text_input );\n\t\t\t\tcalc_width = false;\n\t\t\t}\n\n\t\t\tfield = o.field;\n\t\t\ttext_input = $( this ).find( '.formula-input' );\n\n\t\t\tvar formula_btn = $( this ).find( 'button' );\n\n\t\t\tif ( !calc_width ) {\n\t\t\t\tformula_btn.css( 'float', 'right' );\n\t\t\t}\n\n\t\t\tformula_btn.text( o.text_label ? o.text_label : text_label );\n\n\t\t\tformula_btn.unbind( 'click' ).bind( 'click', Global.debounce( function FormulaClick( e ) {\n\t\t\t\tif ( o.onFormulaBtnClick ) {\n\t\t\t\t\to.onFormulaBtnClick();\n\t\t\t\t}\n\t\t\t}, Global.calcDebounceWaitTimeBasedOnNetwork(), true ) );\n\n\t\t\tif ( o.width && ( o.width > 0 || o.width.indexOf( '%' ) > 0 ) ) {\n\t\t\t\tif ( o.width.indexOf( '%' ) > 0 && calc_width) {\n\t\t\t\t\t$this.width( o.width );\n\t\t\t\t\ttext_input.css( 'width', 'calc( 100% - 115px )' );\n\t\t\t\t} else {\n\t\t\t\t\ttext_input.width( o.width );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttext_input.width( 300 );\n\t\t\t}\n\t\t\tif ( o.height > 0 ) {\n\t\t\t\ttext_input.height( o.height );\n\t\t\t}\n\n\t\t\tif ( o.rows > 0 ) {\n\t\t\t\ttext_input.attr( 'rows', o.rows );\n\t\t\t} else {\n\t\t\t\ttext_input.attr( 'rows', 5 );\n\t\t\t}\n\n\t\t\tif ( o.style ) {\n\t\t\t\t$this.css( o.style );\n\t\t\t}\n\n\t\t\ttext_input.change( function() {\n\t\t\t\tif ( check_box ) {\n\t\t\t\t\t$this.setCheckBox( true );\n\t\t\t\t}\n\n\t\t\t\t$this.trigger( 'formItemChange', [$this] );\n\t\t\t} );\n\n\t\t\ttext_input.mouseover( function() {\n\n\t\t\t\tif ( enabled ) {\n\t\t\t\t\tif ( error_string && error_string.length > 0 ) {\n\t\t\t\t\t\t$this.showErrorTip( 20 );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t\ttext_input.mouseout( function() {\n\t\t\t\tif ( !$( $this ).is( ':focus' ) ) {\n\t\t\t\t\t$this.hideErrorTip();\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\ttext_input.focusin( function() {\n\t\t\t\tif ( !enabled ) {\n\t\t\t\t\tif ( !check_box ) {\n\t\t\t\t\t\tif ( LocalCacheData.current_open_sub_controller &&\n\t\t\t\t\t\t\tLocalCacheData.current_open_sub_controller.edit_view &&\n\t\t\t\t\t\t\tLocalCacheData.current_open_sub_controller.is_viewing ) {\n\t\t\t\t\t\t\terror_string = LocalCacheData.current_open_sub_controller.getViewModeErrorMessage();\n\t\t\t\t\t\t\t$this.showErrorTip( 10 );\n\t\t\t\t\t\t} else if ( LocalCacheData.current_open_primary_controller &&\n\t\t\t\t\t\t\tLocalCacheData.current_open_primary_controller.edit_view &&\n\t\t\t\t\t\t\tLocalCacheData.current_open_primary_controller.is_viewing ) {\n\t\t\t\t\t\t\terror_string = LocalCacheData.current_open_primary_controller.getViewModeErrorMessage();\n\t\t\t\t\t\t\t$this.showErrorTip( 10 );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif ( error_string && error_string.length > 0 ) {\n\t\t\t\t\t\t$this.showErrorTip( 20 );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\ttext_input.focusout( function() {\n\t\t\t\t$this.hideErrorTip();\n\t\t\t} );\n\n\t\t\t//Prevent missing formula input box from appearing during first load.\n\t\t\tTTPromise.wait( null, null, function() {\n\t\t\t\ttext_input.parents( '.formula-builder' ).css( 'opacity', 1 );\n\t\t\t} );\n\n\t\t} );\n\n\t\treturn this;\n\n\t};\n\n\t$.fn.FormulaBuilder.defaults = {};\n\t$.fn.FormulaBuilder.html_template = `\n\t<div class=\"formula-builder\">\n\t\t<textarea type=\"text\" class=\"t-text-area formula-input formula-textarea\"></textarea>\n\t\t<button class=\"t-button formula-btn\"></button>\n\t</div>\n\t`;\n\t$.fn.FormulaBuilder.html_template_text_input = `\n\t<div class=\"formula-builder\">\n\t\t<input type=\"text\" class=\"t-text-input formula-input\" autocomplete=\"timetrex-no-auto-fill\">\n\t\t<button class=\"t-button formula-btn\" style=\"margin-left: 5px; margin-top: -1px;\"></button>\n\t</div>\n\t`;\n\n} )( jQuery );"],"names":["$","options","opts","$this","field","text_label","error_string","error_tip_box","mass_edit_mode","check_box","enabled","text_input","val","errStr","show","isWarning","sec","o","calc_width","formula_btn","e","jQuery"],"mappings":"iDAAE,SAAUA,EAAI,CAEfA,EAAE,GAAG,eAAiB,SAAUC,EAAU,CACzC,IAAIC,EAAOF,EAAE,OAAQ,CAAE,EAAEA,EAAE,GAAG,eAAe,SAAUC,GACnDE,EAAQ,KACRC,EAEAC,EAAaL,EAAE,KAAK,EAAG,iBAAiB,EAIxCM,EAAe,GACfC,EAEAC,EAAiB,GACjBC,EAAY,KAEZC,EAAU,GAEVC,EAAa,KAEjB,YAAK,WAAa,UAAW,CAC5B,OAAOD,CACV,EAEE,KAAK,WAAa,SAAUE,EAAM,CACjCF,EAAUE,EACLA,IAAQ,IAASA,IAAQ,IAC7BD,EAAW,SAAU,EAAC,KAAM,WAAY,MAAM,EAC9CA,EAAW,SAAU,0BAErBA,EAAW,SAAQ,EAAG,WAAY,UAAU,EAC5CA,EAAW,YAAa,wBAG5B,EAEE,KAAK,YAAc,SAAUC,EAAM,CAC7BH,IACJA,EAAU,SAAU,EAAC,GAAI,CAAG,EAAC,CAAC,EAAE,QAAUG,EAE9C,EAEE,KAAK,UAAY,UAAW,CAC3B,MAAK,GAAAH,GACCA,EAAU,SAAQ,EAAG,GAAI,CAAC,EAAG,CAAC,EAAE,UAAY,GAMrD,EAEE,KAAK,gBAAkB,SAAUG,EAAM,CACtCJ,EAAiBI,EAEZJ,GACJC,EAAYT,EAAG,+LAEfS,EAAU,aAAcE,GAExBF,EAAU,OAAQ,UAAW,CAC5BN,EAAM,QAAS,iBAAkB,CAACA,CAAK,CAAC,CAC7C,IAGSM,IACJA,EAAU,OAAM,EAChBA,EAAY,KAIjB,EAEE,KAAK,SAAW,SAAUG,EAAM,CAEzBA,IACLA,EAAM,IAGPD,EAAW,IAAKC,EAEnB,EAEE,KAAK,cAAgB,SAAUC,EAAQC,EAAMC,EAAY,CACnDA,EACJJ,EAAW,SAAU,eAErBA,EAAW,SAAU,aAEtBL,EAAeO,EAEVC,GACJ,KAAK,aAAY,CAErB,EAEE,KAAK,aAAe,SAAUE,EAAM,CAE7B,OAAO,MAAOA,KACnBA,EAAM,GAGDT,IACLA,EAAgB,OAAO,iBAAkB,eAAe,aAAa,EACrEA,EAAgBA,EAAc,eAE1BI,EAAW,SAAU,eACzBJ,EAAc,KAAM,KAAMD,EAAcU,EAAK,EAAI,EAEjDT,EAAc,KAAM,KAAMD,EAAcU,CAAG,CAE/C,EAEE,KAAK,aAAe,UAAW,CAEzB,OAAO,MAAOT,IAClBA,EAAc,OAAM,CAGxB,EAEE,KAAK,gBAAkB,UAAW,CACjCI,EAAW,YAAa,aACxBA,EAAW,YAAa,eACxB,KAAK,aAAY,EACjBL,EAAe,EAClB,EAEE,KAAK,SAAW,SAAUM,EAAM,CAC/BR,EAAQQ,CACX,EAEE,KAAK,SAAW,UAAW,CAC1B,OAAOR,CACV,EAEE,KAAK,SAAW,UAAW,CAC1B,OAAOO,EAAW,KACrB,EAEE,KAAK,SAAW,SAAUC,EAAM,CAEzBA,IACLA,EAAM,IAGPD,EAAW,IAAKC,EACnB,EAEE,KAAK,KAAM,UAAW,CAErB,IAAIK,EAAIjB,EAAE,KAAOA,EAAE,OAAQ,CAAA,EAAIE,EAAMF,EAAG,IAAI,EAAG,KAAM,CAAA,EAAKE,EACtDgB,EAAa,GAEZD,EAAE,YAAcA,EAAE,aAAe,eACrCjB,EAAG,IAAI,EAAG,KAAMA,EAAE,GAAG,eAAe,0BACpCkB,EAAa,IAGdd,EAAQa,EAAE,MACVN,EAAaX,EAAG,IAAM,EAAC,KAAM,gBAAgB,EAE7C,IAAImB,EAAcnB,EAAG,IAAM,EAAC,KAAM,QAAQ,EAEpCkB,GACLC,EAAY,IAAK,QAAS,SAG3BA,EAAY,KAAMF,EAAE,WAAaA,EAAE,WAAaZ,GAEhDc,EAAY,OAAQ,OAAO,EAAG,KAAM,QAAS,OAAO,SAAU,SAAuBC,EAAI,CACnFH,EAAE,mBACNA,EAAE,kBAAiB,CAEpB,EAAE,OAAO,qCAAsC,EAAM,CAAA,EAEjDA,EAAE,QAAWA,EAAE,MAAQ,GAAKA,EAAE,MAAM,QAAS,GAAK,EAAG,GACpDA,EAAE,MAAM,QAAS,GAAK,EAAG,GAAKC,GAClCf,EAAM,MAAOc,EAAE,OACfN,EAAW,IAAK,QAAS,yBAEzBA,EAAW,MAAOM,EAAE,OAGrBN,EAAW,MAAO,KAEdM,EAAE,OAAS,GACfN,EAAW,OAAQM,EAAE,QAGjBA,EAAE,KAAO,EACbN,EAAW,KAAM,OAAQM,EAAE,IAAI,EAE/BN,EAAW,KAAM,OAAQ,GAGrBM,EAAE,OACNd,EAAM,IAAKc,EAAE,OAGdN,EAAW,OAAQ,UAAW,CACxBF,GACJN,EAAM,YAAa,IAGpBA,EAAM,QAAS,iBAAkB,CAACA,CAAK,CAAC,CAC5C,GAEGQ,EAAW,UAAW,UAAW,CAE3BD,GACCJ,GAAgBA,EAAa,OAAS,GAC1CH,EAAM,aAAc,GAI1B,GAEGQ,EAAW,SAAU,UAAW,CACzBX,EAAGG,CAAO,EAAC,GAAI,QAAQ,GAC5BA,EAAM,aAAY,CAEvB,GAEGQ,EAAW,QAAS,UAAW,CACxBD,EAeAJ,GAAgBA,EAAa,OAAS,GAC1CH,EAAM,aAAc,IAffM,IACA,eAAe,6BACnB,eAAe,4BAA4B,WAC3C,eAAe,4BAA4B,YAC3CH,EAAe,eAAe,4BAA4B,0BAC1DH,EAAM,aAAc,KACT,eAAe,iCAC1B,eAAe,gCAAgC,WAC/C,eAAe,gCAAgC,aAC/CG,EAAe,eAAe,gCAAgC,0BAC9DH,EAAM,aAAc,KAQ3B,GAEGQ,EAAW,SAAU,UAAW,CAC/BR,EAAM,aAAY,CACtB,GAGG,UAAU,KAAM,KAAM,KAAM,UAAW,CACtCQ,EAAW,QAAS,kBAAkB,EAAG,IAAK,UAAW,EAC7D,EAEA,GAES,IAET,EAECX,EAAE,GAAG,eAAe,SAAW,CAAA,EAC/BA,EAAE,GAAG,eAAe,cAAgB;AAAA;AAAA;AAAA;AAAA;AAAA,GAMpCA,EAAE,GAAG,eAAe,yBAA2B;AAAA;AAAA;AAAA;AAAA;AAAA,EAOhD,GAAKqB,CAAQ"}