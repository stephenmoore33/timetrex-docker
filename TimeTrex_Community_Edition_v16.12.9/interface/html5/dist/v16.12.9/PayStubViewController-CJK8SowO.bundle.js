import{_ as T,j as o,e as A}from"./vendor-tTApdY0Y.bundle.js";class k extends BaseViewController{constructor(e={}){T.defaults(e,{el:"#pay_stub_view_container",filtered_status_array:null,user_status_array:null,user_group_array:null,user_destination_account_array:null,currency_array:null,type_array:null,country_array:null,province_array:null,e_province_array:null,user_api:null,user_group_api:null,company_api:null,pay_stub_entry_api:null,include_pay_stub_accounts:!0,transaction_status_array:!1,net_pay_amount:!1,pseal_link:!1,original_status_id:10}),super(e)}init(e){this.edit_view_tpl="PayStubEditView.html",this.permission_id="pay_stub",this.viewId="PayStub",this.script_name="PayStubView",this.table_name_key="pay_stub",this.context_menu_name=o.i18n._("Pay Stub"),this.navigation_label=o.i18n._("Pay Stubs"),this.api=TTAPI.APIPayStub,this.user_api=TTAPI.APIUser,this.pay_stub_entry_api=TTAPI.APIPayStubEntry,this.pay_stub_entry_account_link_api=TTAPI.APIPayStubEntryAccountLink,this.user_group_api=TTAPI.APIUserGroup,this.company_api=TTAPI.APICompany,this.pay_period_api=TTAPI.APIPayPeriod,this.pay_stub_transaction_api=TTAPI.APIPayStubTransaction,this.remittance_destination_account_api=TTAPI.APIRemittanceDestinationAccount;var t=this;o.when(this.preloadTransactionOptions(new o.Deferred),this.preloadPayStubAccountLinks(new o.Deferred)).done(function(){t.completeInit()})}isEditMode(){return!!(this.is_add||this.is_edit&&this.original_status_id==25)}preloadTransactionOptions(e){var t=this;return this.pay_stub_transaction_api.getOptions("status",!1,!1,{onResult:function(i){t.transaction_status_array=i.getResult(),e.resolve(!0)}}),e.promise()}preloadPayStubAccountLinks(e){var t=this;return this.pay_stub_entry_account_link_api.getPayStubEntryAccountLink("",!1,!1,{onResult:function(i){var s=i.getResult()[0];s&&(t.pseal_link={total_gross_entry_account_id:!1,total_deductions_entry_account_id:!1,net_pay_entry_account_id:!1,contributions_entry_account_id:!1},t.pseal_link.total_gross_entry_account_id=s.total_gross,t.pseal_link.total_deductions_entry_account_id=s.total_employee_deduction,t.pseal_link.net_pay_entry_account_id=s.total_net_pay,t.pseal_link.contributions_entry_account_id=s.total_employer_deduction),e.resolve(!0)}}),e.promise()}completeInit(){this.initPermission(),this.render(),this.buildContextMenu(),this.initData()}initPermission(){return super.initPermission(),PermissionManager.validate(this.permission_id,"view")||PermissionManager.validate(this.permission_id,"view_child")?this.show_search_tab=!0:this.show_search_tab=!1,{}}initOptions(){var e=this,t=[{option_name:"filtered_status",field_name:"status_id",api:this.api},{option_name:"type",field_name:"type_id",api:this.api},{option_name:"status",field_name:"user_status_id",api:this.user_api},{option_name:"country",field_name:"country",api:this.company_api}];this.initDropDownOptions(t);for(var i={},s=1;s<=128;s++)i[s]=s;e.basic_search_field_ui_dic.run_id.setSourceData(Global.buildRecordArray(i)),e.adv_search_field_ui_dic.run_id.setSourceData(Global.buildRecordArray(i)),this.user_group_api.getUserGroup("",!1,!1,{onResult:function(a){a=a.getResult(),a=Global.buildTreeRecord(a),e.user_group_array=a,!e.sub_view_mode&&e.basic_search_field_ui_dic.group_id&&(e.basic_search_field_ui_dic.group_id.setSourceData(a),e.adv_search_field_ui_dic.group_id.setSourceData(a))}})}getCustomContextMenuModel(){var e={groups:{pay_stubs:{label:o.i18n._("Pay Stubs"),id:this.script_name+"Pay Stubs"}},exclude:["copy","save_and_new","save_and_copy"],include:[{label:o.i18n._("Jump To"),id:"jump_to_header",menu_align:"right",action_group:"jump_to",action_group_header:!0,permission_result:!1},{label:o.i18n._("TimeSheet"),id:"timesheet",menu_align:"right",action_group:"jump_to",group:"navigation"},{label:o.i18n._("Schedule"),id:"schedule",menu_align:"right",action_group:"jump_to",group:"navigation"},{label:o.i18n._("Pay Stub Amendments"),id:"pay_stub_amendment",menu_align:"right",action_group:"jump_to",group:"navigation"},{label:o.i18n._("Pay Stub Transactions"),id:"pay_stub_transaction",menu_align:"right",action_group:"jump_to",group:"navigation",items:[],permission_result:!0,permission:!0,sort_order:null},{label:o.i18n._("Edit Employee"),id:"edit_employee",menu_align:"right",action_group:"jump_to",group:"navigation"},{label:o.i18n._("Edit Pay Period"),id:"edit_pay_period",menu_align:"right",action_group:"jump_to",group:"navigation"},{label:"",id:"other_header",menu_align:"right",action_group:"other",action_group_header:!0,vue_icon:"tticon tticon-more_vert_black_24dp"},{label:o.i18n._("View: Employee Pay Stubs"),id:"employee_pay_stubs",menu_align:"right",action_group:"other"},{label:o.i18n._("View: Employer Pay Stubs"),id:"employer_pay_stubs",menu_align:"right",action_group:"other"},{label:o.i18n._("Generate Pay Stub"),id:"generate_pay_stub",menu_align:"right",action_group:"other"},{label:o.i18n._("Process Transactions"),id:"direct_deposit",menu_align:"right",action_group:"other",icon:"direct_deposit-35x35.png",items:[],permission_result:!0,permission:!0}]};return e}setCustomDefaultMenuIcon(e,t,i){switch(e){case"timesheet":this.setDefaultMenuViewIcon(t,i,"punch");break;case"schedule":this.setDefaultMenuViewIcon(t,i,"schedule");break;case"pay_stub_amendment":this.setDefaultMenuViewIcon(t,i,"pay_stub_amendment");break;case"pay_stub_transaction":this.setDefaultMenuViewIcon(t,i,"pay_stub_transaction");break;case"edit_employee":this.setDefaultMenuEditEmployeeIcon(t,i,"user");break;case"edit_pay_period":this.setDefaultMenuEditPayPeriodIcon(t,i);break;case"employee_pay_stubs":case"employer_pay_stubs":case"print_checks":case"direct_deposit":this.setDefaultMenuReportRelatedIcons(t,i);break;case"generate_pay_stub":this.setDefaultMenuGeneratePayStubIcon(t,i);break}}setDefaultMenuEditPayPeriodIcon(e,t,i){this.editPermissionValidate("pay_period_schedule")||ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),t===1?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuEditEmployeeIcon(e,t){this.editChildPermissionValidate("user")||ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),t===1?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuViewIcon(e,t,i){i==="punch"||i==="schedule"||i==="pay_stub_amendment"?super.setDefaultMenuViewIcon(e,t,i):i==="pay_stub_transaction"?PermissionManager.validate("pay_stub","enabled")&&(PermissionManager.validate("pay_stub","view")||PermissionManager.validate("pay_stub","view_child"))?ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1):((!this.viewPermissionValidate(i)||this.edit_only_mode)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),t>0&&this.viewOwnerOrChildPermissionValidate()?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1))}setCustomEditMenuIcon(e,t){switch(e){case"timesheet":this.setEditMenuViewIcon(t,"punch");break;case"schedule":this.setEditMenuViewIcon(t,"schedule");break;case"pay_stub_amendment":this.setEditMenuViewIcon(t,"pay_stub_amendment");break;case"pay_stub_transaction":this.setEditMenuViewIcon(t,"pay_stub_transaction");break;case"edit_employee":this.setEditMenuViewIcon(t,"user");break;case"edit_pay_period":this.setEditMenuViewIcon(t,"pay_period_schedule");break;case"view":case"employer_pay_stubs":case"employee_pay_stubs":case"print_checks":case"direct_deposit":this.setEditMenuEditIcon(t);break;case"generate_pay_stub":this.setEditMenuGeneratePayStubIcon(t);break}}payStubReportIconsValidate(){if(!PermissionManager.validate("pay_stub","enabled"))return!1;var e=this.getSelectedItem();return!!(PermissionManager.validate("pay_stub","view")||this.ownerOrChildPermissionValidate("pay_stub","view_child",e))}setDefaultMenuReportRelatedIcons(e,t,i){this.payStubReportIconsValidate()||ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),t>0&&this.viewOwnerOrChildPermissionValidate()?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setEditMenuReportRelatedIcons(e,t,i){this.payStubReportIconsValidate()||ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),this.current_edit_record.id&&this.viewOwnerOrChildPermissionValidate()?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setEditMenuGeneratePayStubIcon(e,t,i){PermissionManager.checkTopLevelPermission("GeneratePayStubs")||ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuGeneratePayStubIcon(e,t,i){PermissionManager.checkTopLevelPermission("GeneratePayStubs")||ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}removeEntryInsideEditorCover(){this.cover&&this.cover.length>0&&this.cover.remove(),this.cover=null}setCurrentEditRecordData(){this.include_pay_stub_accounts=!0;for(var e in this.current_edit_record){var t=this.edit_view_ui_dic[e];if(Global.isSet(t))switch(e){case"country":this.setCountryValue(t,e);break;case"status_id":(this.current_edit_record[e]==40||this.current_edit_record[e]==100)&&(this.include_pay_stub_accounts=!1),t.setValue(this.current_edit_record[e]);break;default:t.setValue(this.current_edit_record[e]);break}}this.collectUIDataToCurrentEditRecord(),this.setEditViewDataDone()}setEditViewDataDone(){super.setEditViewDataDone(),this.is_add?this.edit_view_ui_dic.user_id.setEnabled(!0):this.edit_view_ui_dic.user_id.setEnabled(!1),this.is_mass_editing?this.detachElement("user_id"):(this.initInsideEntryEditorData(),this.attachElement("user_id"))}getPayStubTransactionDefaultData(e,t){this.pay_stub_transaction_api["get"+this.pay_stub_transaction_api.key_name+"DefaultData"]({onResult:function(i){var s=[],a=i.getResult();a.id=!1,s.push(a),e(s,t)}})}getPayStubTransaction(e){var t=this,i={};i.filter_data={},i.filter_data.pay_stub_id=TTUUID.isUUID(this.current_edit_record.id)?this.current_edit_record.id:TTUUID.isUUID(this.copied_record_id)?this.copied_record_id:"",this.pay_stub_transaction_api.getPayStubTransaction(i,!0,{onResult:function(s){if(t.edit_view){var a=s.getResult();T.size(a)==0&&(a=[]),e(a)}}})}initInsideTransactionEditorData(){var e=this;(!this.current_edit_record||TTUUID.isUUID(this.current_edit_record.id)==!1)&&!this.copied_record_id?this.getPayStubTransactionDefaultData(function(t){e.isEditMode()==!0||t.length>0?e.editor.transaction_data=t:e.editor.transaction_data=!1,TTPromise.resolve("PayStubViewController","insideEditorDataLoaded")}):this.getPayStubTransaction(function(t){e.isEditMode()==!0||t.length>0?e.editor.transaction_data=t:e.editor.transaction_data=!1,TTPromise.resolve("PayStubViewController","insideEditorDataLoaded")})}initInsideEntryEditorData(){TTPromise.add("PayStubViewController","insideEditorDataLoaded");var e=this,t={};if(t.filter_data={},this.copied_record_id||this.current_edit_record&&this.current_edit_record.id)t.filter_data.pay_stub_id=TTUUID.isUUID(this.current_edit_record.id)?this.current_edit_record.id:this.copied_record_id,this.pay_stub_entry_api["get"+this.pay_stub_entry_api.key_name](t,{onResult:function(s){if(e.edit_view){var a=e.handlePayStubEntryData(s.getResult());TTPromise.wait("PayStubViewController","insideEditorDataLoaded",function(){e.editor.setValue(a)})}}});else{var i=e.handlePayStubEntryData();TTPromise.wait("PayStubViewController","insideEditorDataLoaded",function(){e.editor.setValue(i)})}this.initInsideTransactionEditorData()}handlePayStubEntryData(e){var t={},i={};if(e)for(var s in e){var a=e[s].type_id;if(a==40){if(e[s].pay_stub_entry_account_id){var n=e[s];n.total_row=!0,t[e[s].pay_stub_entry_account_id]=n[s]}}else typeof i[a]>"u"&&(i[a]=[]),i[a].push(e[s])}for(var m=[10,20,30,50,80],f=0;f<m.length;f++)(typeof i[m[f]]>"u"||i[m[f]].length==0)&&(i[m[f]]=[],i[m[f]].push({type_id:m[f]}));var y={};t[this.pseal_link.total_gross_entry_account_id]?y=t[this.pseal_link.total_gross_entry_account_id]:y={total_row:!0,type_id:40,name:o.i18n._("Total Gross"),pay_stub_entry_account_id:this.pseal_link.total_gross_entry_account_id},i[10].push(y);var r={};t[this.pseal_link.total_deductions_entry_account_id]?r=t[this.pseal_link.total_deductions_entry_account_id]:r={total_row:!0,type_id:40,name:o.i18n._("Total Deductions"),pay_stub_entry_account_id:this.pseal_link.total_deductions_entry_account_id},i[20].push(r);var _={};t[this.pseal_link.net_pay_entry_account_id]?_=t[this.pseal_link.net_pay_entry_account_id]:_={type_id:40,name:o.i18n._("Net Pay"),pay_stub_entry_account_id:this.pseal_link.net_pay_entry_account_id},i[40]=_;var d={};return t[this.pseal_link.contributions_entry_account_id]?d=t[this.pseal_link.contributions_entry_account_id]:d={total_row:!0,type_id:40,name:o.i18n._("Employer Total Contributions"),pay_stub_entry_account_id:this.pseal_link.contributions_entry_account_id},i[30].push(d),i}insideEntryEditorSetValue(e){var t=this;this.removeAllRows(!0),this.removeCover();function i(r){var _=t.getRender(),d=`
			<tr class="tblHeader">
				<td align="left" colspan="2"><%= col1 %></td>
				<td> <%= col2 %></td>
				<td> <%= col3 %></td>
				<td> <%= col4 %></td>
				<td> <%= col5 %></td>
				<td> <%= col6 %></td>
				<td colspan="" style="width:60px"></td>
			</tr>`,p={col1:o.i18n._("Earnings"),col2:o.i18n._("Note"),col3:o.i18n._("Rate"),col4:o.i18n._("Hrs/Units"),col5:o.i18n._("Amount"),col6:o.i18n._("YTD Amount")},u=T.template(d);o(_).append(u(p)),t.rows_widgets_array.push(!0);for(var l=0;l<T.size(r);l++)if(Global.isSet(r[l])){var c=r[l];c.type_id=10,t.addRow(c)}o(_).append('<tr><td colspan="8"><br></td></tr>'),t.rows_widgets_array.push(!0)}function s(){return`
			<tr class="tblHeader">
				<td align="left" colspan="2"><%= col1 %></td>
				<td colspan="3"> <%= col2 %></td>
				<td> <%= col3 %></td>
				<td> <%= col4 %></td>
				<td colspan="" style="width: 30px"></td>
			</tr>`}function a(r){var _=t.getRender(),d=s(),p={col1:o.i18n._("Deductions"),col2:o.i18n._("Note"),col3:o.i18n._("Amount"),col4:o.i18n._("YTD Amount")},u=T.template(d);o(_).append(u(p)),t.rows_widgets_array.push(!0);for(var l=0;l<T.size(r);l++)if(Global.isSet(r[l])){var c=r[l];c.type_id=20,t.addRow(c)}o(_).append('<tr><td colspan="8"><br></td></tr>'),t.rows_widgets_array.push(!0)}function n(r){var _=t.getRender();r&&t.addRow(r),o(_).append('<tr><td colspan="8"><br></td></tr>'),t.rows_widgets_array.push(!0)}function m(r){var _=t.getRender(),d=s(),p={col1:o.i18n._("Miscellaneous"),col2:o.i18n._("Note"),col3:o.i18n._("Amount"),col4:o.i18n._("YTD Amount")},u=T.template(d);o(_).append(u(p)),t.rows_widgets_array.push(!0);for(var l in r)t.addRow(r[l]);o(_).append('<tr><td colspan="8"><br></td></tr>'),t.rows_widgets_array.push(!0)}function f(r){var _=t.getRender(),d=s(),p={col1:o.i18n._("Employer Contributions"),col2:o.i18n._("Note"),col3:o.i18n._("Amount"),col4:o.i18n._("YTD Amount")},u=T.template(d);o(_).append(u(p)),t.rows_widgets_array.push(!0);for(var l=0;l<T.size(r);l++)if(Global.isSet(r[l])){var c=r[l];c.type_id=30,t.addRow(c)}o(_).append('<tr><td colspan="8"><br></td></tr>'),t.rows_widgets_array.push(!0)}function y(r){var _=t.getRender(),d=s(),p={col1:o.i18n._("Accrual"),col2:o.i18n._("Note"),col3:o.i18n._("Amount"),col4:o.i18n._("Balance")},u=T.template(d);o(_).append(u(p)),t.rows_widgets_array.push(!0);for(var l=0;l<T.size(r);l++)if(Global.isSet(r[l])){var c=r[l];c.type_id=50,t.addRow(c)}o(_).append('<tr><td colspan="8"><br></td></tr>'),t.rows_widgets_array.push(!0)}(this.parent_controller.isEditMode()==!0||this.parent_controller.checkForNonHeaderData(e[10]))&&i(e[10]),(this.parent_controller.isEditMode()==!0||this.parent_controller.checkForNonHeaderData(e[20]))&&a(e[20]),n(e[40]),(this.parent_controller.isEditMode()==!0||this.parent_controller.checkForNonHeaderData(e[80]))&&m(e[80]),(this.parent_controller.isEditMode()==!0||this.parent_controller.checkForNonHeaderData(e[30]))&&f(e[30]),(this.parent_controller.isEditMode()==!0||this.parent_controller.checkForNonHeaderData(e[50]))&&y(e[50]),this.parent_controller.editor.transaction_data&&this.parent_controller.editor.insideTransactionEditorSetValue(this.parent_controller.editor.transaction_data),this.parent_controller.copied_record_id&&TTUUID.isUUID(this.parent_controller.copied_record_id)&&(this.parent_controller.copied_record_id=""),this.calcTotal()}checkForNonHeaderData(e){for(var t in e)if(TTUUID.isUUID(e[t].id)==!0)return!0;return!1}insideEntryEditorAddRow(e,t){var i=this;if(!e)i.addRow({},t);else{let s=function(a,n,m){var f=i.getRender(),y={},r,_=o("<div class='widget-h-box'></div>"),d,p={filter_data:{}},u="",l="",c=i.parent_controller.current_edit_record.status_id,h=!1;(!i.parent_controller.current_edit_record.id&&!i.parent_controller.copied_record_id||!a.id)&&(h=!0),(c==40||c==100)&&(h=!1),TTUUID.isUUID(a.pay_stub_amendment_id)&&a.pay_stub_amendment_id!=TTUUID.zero_id&&(u=a.pay_stub_amendment_id),TTUUID.isUUID(a.user_expense_id)&&a.user_expense_id!=TTUUID.zero_id&&(l=a.user_expense_id),i.parent_controller.copied_record_id&&(u="",l="");var D=!0;TTUUID.isUUID(u)&&u!=TTUUID.zero_id?(d=o("<span class='widget-right-label'> ("+o.i18n._("Amendment")+")</span>"),D=!1):TTUUID.isUUID(l)&&l!=TTUUID.zero_id&&(d=o("<span class='widget-right-label'> ("+o.i18n._("Expense")+")</span>"),D=!1),n==10?r=o(`<tr class="tblDataWhite" align="right">
								<td align="left" colspan="2"></td>
								<td class=""></td>
								<td class=""></td>
								<td class=""></td>
								<td class=""></td>
								<td class=""></td>
								<td colspan="2" class="cell control-icon">
									<div>
										<button class="plus-icon" onclick=""></button>
										<button class="minus-icon " onclick=""></button>
									</div>
								</td>
							</tr>`):r=o(`<tr class="tblDataWhite" align="right">
						<td align="left" colspan="2"></td>
						<td class="" colspan="3"></td>
						<td class=""></td>
						<td class=""></td>
						<td colspan="2" class="cell control-icon" style="width: 30px">
							<button class="plus-icon" onclick=""></button>
							<button class="minus-icon " onclick=""></button>
						</td>
					</tr>`);var M=Global.loadWidgetByName(FormItemType.AWESOME_BOX);M.AComboBox({api_class:TTAPI.APIPayStubEntryAccount,width:132,is_static_width:132,allow_multiple_selection:!1,layout_name:"global_PayStubAccount",show_search_inputs:!0,set_empty:!0,field:"pay_stub_entry_name_id"}),M.setValue(a.pay_stub_entry_name_id),M.setEnabled(D),M.unbind("formItemChange").bind("formItemChange",function(F,v){i.onFormItemChange(v)});var b=Global.loadWidgetByName(FormItemType.TEXT);b.TText({field:"name"}),b.setValue(a.name?a.type_id!=40?"  "+a.name:a.name:"");var U=Global.loadWidgetByName(FormItemType.TEXT_INPUT);U.TTextInput({field:"description",width:300}),U.setValue(a.description),U.attr("editable",!0);var w=Global.loadWidgetByName(FormItemType.TEXT);w.TText({field:"description"}),w.setValue(a.description?a.description:" ");var C=Global.loadWidgetByName(FormItemType.TEXT_INPUT);C.TTextInput({field:"rate",width:60,hasKeyEvent:!0}),C.setValue(Global.removeTrailingZeros(a.rate)),C.attr("editable",!0),C.unbind("formItemKeyUp").bind("formItemKeyUp",function(F,v){i.onFormItemKeyUp(v)}),C.unbind("formItemKeyDown").bind("formItemKeyDown",function(F,v){i.onFormItemKeyDown(v)}),C.unbind("formItemChange").bind("formItemChange",function(F,v){i.onFormItemChange(v)});var P=Global.loadWidgetByName(FormItemType.TEXT);P.TText({field:"rate"}),P.setValue(Global.removeTrailingZeros(a.rate));var S=Global.loadWidgetByName(FormItemType.TEXT_INPUT);S.TTextInput({field:"units",width:60,hasKeyEvent:!0}),S.setValue(Global.removeTrailingZeros(a.units)),S.attr("editable",!0),S.unbind("formItemKeyUp").bind("formItemKeyUp",function(F,v){i.onFormItemKeyUp(v)}),S.unbind("formItemKeyDown").bind("formItemKeyDown",function(F,v){i.onFormItemKeyDown(v)}),S.unbind("formItemChange").bind("formItemChange",function(F,v){i.onFormItemChange(v)});var g=Global.loadWidgetByName(FormItemType.TEXT);g.TText({field:"units"}),g.setValue(Global.removeTrailingZeros(a.units));var E=Global.loadWidgetByName(FormItemType.TEXT_INPUT);E.TTextInput({field:"amount",width:60}),E.setValue(Global.removeTrailingZeros(a.amount)),E.unbind("formItemKeyUp").bind("formItemKeyUp",function(F,v){i.onFormItemKeyUp(v)}),E.unbind("formItemKeyDown").bind("formItemKeyDown",function(F,v){i.onFormItemKeyDown(v)}),E.unbind("formItemChange").bind("formItemChange",function(F,v){i.onFormItemChange(v)});var I=Global.loadWidgetByName(FormItemType.TEXT);I.TText({field:"amount"}),I.setValue(Global.removeTrailingZeros(a.amount));var V=Global.loadWidgetByName(FormItemType.TEXT);V.TText({field:"ytd_amount"}),V.setValue(Global.removeTrailingZeros(a.ytd_amount)),V.attr({pay_stub_entry_id:a.id&&i.parent_controller.current_edit_record.id?a.id:"",type_id:a.type_id,original_amount:a.amount?a.amount:"0.00",original_ytd_amount:a.ytd_amount?a.ytd_amount:"0.00",pay_stub_entry_name_id:a.pay_stub_entry_name_id?a.pay_stub_entry_name_id:null}),V.attr("pay_stub_amendment_id",u),V.attr("user_expense_id",l),parseFloat(a.ytd_amount)!=0||(c==40||c==100||a.total_row===!0)&&V.text("-"),a.rate&&parseFloat(a.rate)!=0&&!i.parent_controller.copied_record_id?E.setReadOnly(!0):(c==40||c==100||a.total_row===!0)&&P.text("-"),a.units&&parseFloat(a.units)!=0&&!i.parent_controller.copied_record_id?E.setReadOnly(!0):(c==40||c==100||a.total_row===!0)&&g.text("-"),n==40||a.total_row===!0?((a.type_id==40||a.total_row===!0)&&b.css("font-weight","bold"),y[b.getField()]=b,_.append(b),_.append(d),r.children().eq(0).append(_)):i.parent_controller.isEditMode()==!0||m?a.type_id==40||a.total_row===!0?(b.css("font-weight","bold"),y[b.getField()]=b,_.append(b),_.append(d),r.children().eq(0).append(_)):(p.filter_data.type_id=[n],M.setDefaultArgs(p),y[M.getField()]=M,_.append(M),_.append(d),r.children().eq(0).append(_)):((a.type_id==40||a.total_row===!0)&&b.css("font-weight","bold"),y[b.getField()]=b,_.append(b),_.append(d),r.children().eq(0).append(_)),(a.type_id==n.toString()||a.type_id===n)&&n!=40&&!a.total_row?i.parent_controller.isEditMode()==!0?((TTUUID.isUUID(u)&&u!=TTUUID.zero_id||TTUUID.isUUID(l)&&l!=TTUUID.zero_id)&&U.setReadOnly(!0),y[U.getField()]=U,r.children().eq(1).append(U)):(y[w.getField()]=w,r.children().eq(1).append(w)):Global.isSet(m)||h||T.size(a)===1&&i.parent_controller.isEditMode()==!0?a.type_id==40||a.total_row===!0||(y[U.getField()]=U,r.children().eq(1).append(U)):(n==20||n==30||n==50||n==80)&&(y[w.getField()]=w,r.children().eq(1).append(w)),(a.type_id===n.toString()||a.type_id===n)&&n!=40&&!a.total_row?i.parent_controller.isEditMode()==!0?((TTUUID.isUUID(u)&&u!=TTUUID.zero_id||TTUUID.isUUID(l)&&l!=TTUUID.zero_id)&&E.setReadOnly(!0),y[E.getField()]=E,n==10?r.children().eq(4).append(E):r.children().eq(2).append(E)):(y[I.getField()]=I,n==10?r.children().eq(4).append(I):r.children().eq(2).append(I)):(Global.isSet(m)||h||T.size(a)===1&&i.parent_controller.isEditMode()==!0)&&n!=40&&!a.total_row?a.type_id==40?(I.css("font-weight","bold"),y[I.getField()]=I,n==10?r.children().eq(4).append(I):r.children().eq(2).append(I)):(y[E.getField()]=E,n==10?r.children().eq(4).append(E):r.children().eq(2).append(E)):((a.type_id==40||a.total_row)&&n==30,I.css("font-weight","bold"),y[I.getField()]=I,n==10?r.children().eq(4).append(I):r.children().eq(2).append(I)),(a.type_id==40||a.total_row)&&V.css("font-weight","bold"),(Global.isSet(m)||h||T.size(a)===1)&&n!=40&&V.text("-"),y[V.getField()]=V,n==10?r.children().eq(5).append(V):r.children().eq(3).append(V),n==10&&(a.type_id==10&&!a.total_row?i.parent_controller.isEditMode()==!0?((TTUUID.isUUID(u)&&u!=TTUUID.zero_id||TTUUID.isUUID(l)&&l!=TTUUID.zero_id)&&C.setReadOnly(!0),y[C.getField()]=C,r.children().eq(2).append(C)):(y[P.getField()]=P,r.children().eq(2).append(P)):(Global.isSet(m)||h)&&(a.type_id==40||a.total_row||(y[C.getField()]=C,r.children().eq(2).append(C))),a.type_id==10&&!a.total_row?i.parent_controller.isEditMode()==!0?((TTUUID.isUUID(u)&&u!=TTUUID.zero_id||TTUUID.isUUID(l)&&l!=TTUUID.zero_id)&&S.setReadOnly(!0),y[S.getField()]=S,r.children().eq(3).append(S)):(y[g.getField()]=g,r.children().eq(3).append(g)):Global.isSet(m)||h?a.type_id==40||a.total_row?(g.css("font-weight","bold"),y[g.getField()]=g,r.children().eq(3).append(g)):(y[S.getField()]=S,r.children().eq(3).append(S)):(g.css("font-weight","bold"),y[g.getField()]=g,r.children().eq(3).append(g))),(TTUUID.isUUID(u)&&u!=TTUUID.zero_id||TTUUID.isUUID(l)&&l!=TTUUID.zero_id)&&r.children().last().find(".minus-icon ").hide(),a.total_row==!0&&(y.total_row=!0),typeof a.type_id<"u"&&(y.type_id=a.type_id),a.pay_stub_entry_account_id==i.parent_controller.pseal_link.net_pay_entry_account_id&&(y.pay_stub_entry_account_id=i.parent_controller.pseal_link.net_pay_entry_account_id),typeof m<"u"?(r.insertAfter(o(f).find("tr").eq(m)),i.rows_widgets_array.splice(m+1,0,y)):(o(f).append(r),i.rows_widgets_array.push(y)),i.parent_controller.isEditMode()==!0?i.addIconsEvent(r):r.children().last().empty(),(a.total_row||a.type_id==40)&&(r.find(".plus-icon").remove(),r.find(".minus-icon").remove())};typeof t<"u"&&typeof this.rows_widgets_array[t].ytd_amount<"u"&&!e.type_id&&(e.type_id=this.rows_widgets_array[t].ytd_amount.attr("type_id")),e.type_id==10?s(e,10,t):e.type_id==20?s(e,20,t):e.type_id==30?s(e,30,t):e.type_id==40?s(e,40,t):e.type_id==50?s(e,50,t):e.type_id==80&&s(e,80,t)}}insideEntryEditorRemoveRow(e){var t=e[0].rowIndex;if(this.rows_widgets_array[t].ytd_amount){var i=this.rows_widgets_array[t].ytd_amount.attr("pay_stub_entry_id"),s=this.rows_widgets_array[t].ytd_amount.attr("type_id");TTUUID.isUUID(i)&&this.delete_ids.push(i),e.remove(),this.rows_widgets_array[t-1]===!0&&(this.rows_widgets_array[t+1].total_row===!0||this.rows_widgets_array[t+1]===!0)?(this.addRow({id:"",type_id:s},t-1),this.rows_widgets_array.splice(t+1,1)):this.rows_widgets_array.splice(t,1)}this.calcTotal()}savePayStub(e,t){if(this.include_pay_stub_accounts){var i=this.saveInsideEntryEditorData(),s=this.saveInsideTransactionEditorData();i.length>0&&(e.entries=i),s.length>0&&(e.transactions=s)}t()}onSaveClick(e){this.is_mass_editing&&(this.include_pay_stub_accounts=!1),super.onSaveClick(e)}doSaveAPICall(e,t,i){this.savePayStub(e,()=>{super.doSaveAPICall(e,!0,i)})}onSaveDone(e){return this.current_edit_record=null,!0}saveInsideTransactionEditorData(e){var t=this,i=this.editor.insideTransactionEditorGetValue(t.current_edit_record.id?t.current_edit_record.id:"");if(this.editor.delete_transaction_ids.length>0)for(var s=0;s<this.editor.delete_transaction_ids.length;s++)for(var a=0;a<i.length;a++)this.editor.delete_transaction_ids[s]==i[a].id&&(i[a].deleted=1);return i}onCopyAsNewClick(){var e=this;if(this.setCurrentEditViewState("new"),LocalCacheData.current_doing_context_action="copy_as_new",Global.isSet(this.edit_view)){this.copied_record_id=this.current_edit_record.id,this.current_edit_record.id="",this.edit_view_ui_dic.user_id.setEnabled(!0),this.current_edit_record.status_id!=25&&(this.current_edit_record.status_id=25,this.edit_view_ui_dic.status_id.setValue(25)),this.editor.show_cover=!1;var t=this.edit_view.find(".navigation-div");t.css("display","none"),this.setEditMenu(),this.setTabStatus(),this.is_changed=!1,this.editor.removeAllRows(!0),this.initInsideEntryEditorData(),ProgressBar.closeOverlay()}else{var i={},s=this.getGridSelectIdArray(),a=s.length,n;a>0?(n=s[0],i.filter_data={},i.filter_data.id=[n],this.api["get"+this.api.key_name](i,{onResult:function(m){e.onCopyAsNewResult(m)}})):TAlertManager.showAlert(o.i18n._("No selected record"))}}initEditView(){this.original_status_id=this.current_edit_record.status_id,super.initEditView()}onSubViewRemoved(){this.search(),this.edit_view?this.setEditMenu():this.setDefaultMenu()}onCopyAsNewResult(e){var t=this,i=e.getResult();if(!i){TAlertManager.showAlert(o.i18n._("Record does not exist")),t.onCancelClick();return}t.openEditView(),i=i[0],this.copied_record_id=i.id,i.id="",t.sub_view_mode&&t.parent_key&&(i[t.parent_key]=t.parent_value),i.status_id!=25&&(i.status_id=25),t.current_edit_record=i,t.editor.show_cover=!1,t.initEditView()}onSaveAndContinue(e){var t=this;Global.isSet(e)||(e=!1),this.is_changed=!1,this.is_add=!1,LocalCacheData.current_doing_context_action="save_and_continue";var i=this.current_edit_record;this.original_status_id=i.status_id,i=this.uniformVariable(i),this.savePayStub(i,function(){t.api["set"+t.api.key_name](i,!1,e,{onResult:function(s){t.onSaveAndContinueResult(s)}})})}onCancelClick(){TTPromise.reject("PayStubViewController","insideEditorDataLoaded"),super.onCancelClick()}openEditView(){this.editor&&(this.editor.transaction_data=!1),TTPromise.reject("PayStubViewController","insideEditorDataLoaded"),super.openEditView()}onMassEditClick(){var e=this;e.is_add=!1,e.is_viewing=!1,e.is_mass_editing=!0,LocalCacheData.current_doing_context_action="mass_edit",e.openEditView();var t={},i=this.getGridSelectIdArray();i.length,this.mass_edit_record_ids=[],o.each(i,function(s,a){e.mass_edit_record_ids.push(a)}),t.filter_data={},t.filter_data.id=this.mass_edit_record_ids,this.api["getCommon"+this.api.key_name+"Data"](t,{onResult:function(s){var a=s.getResult();a||(a=[]),e.api.getOptions("unique_columns",{onResult:function(n){e.unique_columns=n.getResult(),e.api.getOptions("linked_columns",{onResult:function(m){e.linked_columns=m.getResult(),e.sub_view_mode&&e.parent_key&&(a[e.parent_key]=e.parent_value),e.current_edit_record=a,e.initEditView()}})}})}})}onSaveAndContinueResult(e){var t=this;if(e&&e.isValid()){var i=e.getResult();i===!0?t.refresh_id=t.current_edit_record.id:TTUUID.isUUID(i)&&i!=TTUUID.zero_id&&i!=TTUUID.not_exist_id&&(t.refresh_id=i),t.search(!1),t.editor.show_cover=!1,t.onEditClick(t.refresh_id,!0),t.onSaveAndContinueDone(e)}else t.setErrorTips(e),t.setErrorMenu()}saveInsideEntryEditorData(e){var t=this,i=this.editor.getValue(t.current_edit_record.id?t.current_edit_record.id:"");if(this.editor.delete_ids.length>0)for(var s=0;s<this.editor.delete_ids.length;s++)for(var a=0;a<i.length;a++)this.editor.delete_ids[s]==i[a].id&&(i[a].deleted=1);return e&&typeof e=="function"&&e(),i}insideEntryEditorGetValue(e){var t=this.rows_widgets_array.length,i=[];if(this.cover&&this.cover.length>0)return i;for(var s=0;s<t;s++){var a=this.rows_widgets_array[s],n={};a===!0||T.isArray(a)||(n.id=a.ytd_amount.attr("pay_stub_entry_id"),a.ytd_amount.attr("type_id")&&(n.type=a.ytd_amount.attr("type_id")),n.rate=a.rate?a.rate.getValue():"",n.units=a.units?a.units.getValue():"",n.amount=a.amount?a.amount.getValue():"",Global.isSet(a.ytd_amount)&&(n.ytd_amount=a.ytd_amount.getValue()),n.description=a.description?a.description.getValue():"",Global.isSet(a.pay_stub_entry_name_id)?n.pay_stub_entry_name_id=a.pay_stub_entry_name_id.getValue():n.pay_stub_entry_name_id=a.ytd_amount.attr("pay_stub_entry_name_id"),n.pay_stub_amendment_id=a.ytd_amount.attr("pay_stub_amendment_id"),n.user_expense_id=a.ytd_amount.attr("user_expense_id"),n.pay_stub_id=e,a.total_row!=!0&&TTUUID.isUUID(n.pay_stub_entry_name_id)&&(n.pay_stub_entry_name_id!=TTUUID.zero_id||n.description!=null&&n.description.length>0||n.rate!=null&&n.rate.length>0&&parseFloat(n.rate)!=0||n.units!=null&&n.units.length>0&&parseFloat(n.units)!=0||n.amount!=null&&n.amount.length>0&&parseFloat(n.amount)!=0)&&i.push(n))}return i}getFilterColumnsFromDisplayColumns(){var e={};e.is_owner=!0,e.id=!0,e.user_id=!0,e.is_child=!0,e.in_use=!0,e.first_name=!0,e.last_name=!0,e.start_date=!0,e.end_date=!0,e.pay_period_id=!0;var t=[];if(this.grid&&(t=this.grid.getGridParam("colModel")),t)for(var i=t.length,s=0;s<i;s++){var a=t[s];e[a.name]=!0}return e}onFormItemChange(e,t){var i=this;this.setIsChanged(e),this.setMassEditingFieldsWhenFormChange(e);var s=e.getField(),a=e.getValue();switch(this.current_edit_record[s]=a,s){case"user_id":if(this.is_add){var n=i.editor.rows_widgets_array[i.editor.rows_widgets_array.length-2],m=i.edit_view_ui_dic.user_id.getValue();for(var f in n)Global.isArray(n)&&n[f].remittance_destination_account_id&&(n[f].remittance_destination_account_id.setDefaultArgs({filter_data:{user_id:m}}),n[f].remittance_destination_account_id.setValue(TTUUID.zero_id))}break;case"country":var y=this.edit_view_ui_dic.province;y.setValue(null);break;case"pay_period_id":var r={};r.filter_data={},r.filter_data.id=a,this.pay_period_api["get"+this.pay_period_api.key_name](r,{onResult:function(_){if(_&&_.isValid()&&_.getResult()[0]){var d=_.getResult()[0],p=Global.strToDate(d.start_date).format(),u=Global.strToDate(d.end_date).format(),l=Global.strToDate(d.transaction_date).format();i.current_edit_record.start_date=p,i.current_edit_record.end_date=u,i.current_edit_record.transaction_date=l,i.edit_view_ui_dic.start_date.setValue(p),i.edit_view_ui_dic.end_date.setValue(u),i.edit_view_ui_dic.transaction_date.setValue(l),t||i.validate()}}});break;default:t||i.validate();break}s==="country"||s==="pay_period_id"||t||this.validate()}onSetSearchFilterFinished(){if(this.search_panel.getSelectTabIndex()===1){var e=this.adv_search_field_ui_dic.country,t=e.getValue();this.setProvince(t)}}onBuildAdvUIFinished(){this.adv_search_field_ui_dic.country.change(o.proxy(function(){var e=this.adv_search_field_ui_dic.country,t=e.getValue();this.setProvince(t),this.adv_search_field_ui_dic.province.setValue(null)},this))}setProvince(e,t){var i=this;!e||e==="-1"||e==="0"?(i.province_array=[],this.adv_search_field_ui_dic.province.setSourceData([])):this.company_api.getOptions("province",e,{onResult:function(s){s=s.getResult(),s||(s=[]),i.province_array=Global.buildRecordArray(s),i.adv_search_field_ui_dic.province.setSourceData(i.province_array)}})}eSetProvince(e,t){var i=this,s=i.edit_view_ui_dic.province;!e||e==="-1"||e==="0"?(i.e_province_array=[],s.setSourceData([])):this.company_api.getOptions("province",e,{onResult:function(a){a=a.getResult(),a||(a=[]),i.e_province_array=Global.buildRecordArray(a),t&&i.e_province_array.length>0&&(i.current_edit_record.province=i.e_province_array[0].value,s.setValue(i.current_edit_record.province)),s.setSourceData(i.e_province_array)}})}validate(){var e=this,t={};if(this.is_mass_editing){for(var i in this.edit_view_ui_dic)if(this.edit_view_ui_dic.hasOwnProperty(i)){var s=this.edit_view_ui_dic[i];Global.isSet(s.isChecked)&&s.isChecked()&&s.getEnabled()&&(t[i]=s.getValue())}}else t=this.current_edit_record;if(t=this.uniformVariable(t),this.include_pay_stub_accounts){var a=e.saveInsideEntryEditorData(),n=e.saveInsideTransactionEditorData();typeof a=="object"&&(t.entries=a),typeof n=="object"&&(t.transactions=n)}this.api["validate"+this.api.key_name](t,{onResult:function(m){e.validateResult(m)}})}buildEditViewUI(){super.buildEditViewUI();var e=this,t={tab_pay_stub:{label:o.i18n._("Pay Stub"),is_multi_column:!0,html_template:this.getPayStubTabHtml()},tab_audit:!0};this.setTabModel(t),this.navigation.AComboBox({api_class:TTAPI.APIPayStub,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_pay_stub",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation();var i=this.edit_view_tab.find("#tab_pay_stub"),s=i.find(".first-column"),a=i.find(".second-column"),n;this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(s),n=Global.loadWidgetByName(FormItemType.AWESOME_BOX),n.AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!1,layout_name:"global_user",show_search_inputs:!0,set_empty:!1,field:"user_id"}),this.addEditFieldToColumn(o.i18n._("Employee"),n,s,"",null,!0),n=Global.loadWidgetByName(FormItemType.COMBO_BOX),n.TComboBox({field:"status_id",set_empty:!1}),n.setSourceData(e.filtered_status_array),this.addEditFieldToColumn(o.i18n._("Status"),n,s),n=Global.loadWidgetByName(FormItemType.COMBO_BOX),n.TComboBox({field:"type_id",set_empty:!1}),n.setSourceData(e.type_array),this.addEditFieldToColumn(o.i18n._("Type"),n,s),n=Global.loadWidgetByName(FormItemType.AWESOME_BOX),n.AComboBox({api_class:TTAPI.APICurrency,allow_multiple_selection:!1,layout_name:"global_currency",show_search_inputs:!0,set_empty:!0,field:"currency_id"}),this.addEditFieldToColumn(o.i18n._("Currency"),n,s),n=Global.loadWidgetByName(FormItemType.AWESOME_BOX),n.AComboBox({api_class:TTAPI.APIPayPeriod,allow_multiple_selection:!1,layout_name:"global_Pay_period",show_search_inputs:!0,set_empty:!0,field:"pay_period_id"}),this.addEditFieldToColumn(o.i18n._("Pay Period"),n,a),n=Global.loadWidgetByName(FormItemType.TEXT_INPUT),n.TTextInput({field:"run_id",width:20}),this.addEditFieldToColumn(o.i18n._("Payroll Run"),n,a),n=Global.loadWidgetByName(FormItemType.DATE_PICKER),n.TDatePicker({field:"start_date"}),this.addEditFieldToColumn(o.i18n._("Pay Start Date"),n,a),n=Global.loadWidgetByName(FormItemType.DATE_PICKER),n.TDatePicker({field:"end_date"}),this.addEditFieldToColumn(o.i18n._("Pay End Date"),n,a),n=Global.loadWidgetByName(FormItemType.DATE_PICKER),n.TDatePicker({field:"transaction_date"}),this.addEditFieldToColumn(o.i18n._("Payment Date"),n,a,"");var m=i.find(".inside-pay-stub-entry-editor-div");this.editor=Global.loadWidgetByName(FormItemType.INSIDE_EDITOR),this.editor.InsideEditor({addRow:this.insideEntryEditorAddRow,removeRow:this.insideEntryEditorRemoveRow,getValue:this.insideEntryEditorGetValue,setValue:this.insideEntryEditorSetValue,parent_controller:this,api:this.pay_stub_entry_api,render:f(),render_args:{},render_inline_html:!0,row_render:y()});function f(){return`
			<table class="inside-editor-render tblList">
			</table>`}function y(){return"<div></div>"}this.editor.show_cover=!0,this.editor.delete_transaction_ids=[],this.editor.removeCover=this.removeEntryInsideEditorCover,this.editor.onEditClick=this.removeEntryInsideEditorCover,this.editor.onFormItemKeyUp=function(r){var _=r.parent().parent().index(),d=this,p=d.rows_widgets_array[_].rate,u=d.rows_widgets_array[_].units,l=d.rows_widgets_array[_].amount;if(r.getValue().length===0&&l.setReadOnly(!1),(p.getValue().length>0||u.getValue().length>0)&&l.setReadOnly(!0),p.getValue().length>0&&u.getValue().length>0){var c=Global.MoneyRound(A(parseFloat(p.getValue())).mul(parseFloat(u.getValue())).toFixed(4));(c=="NaN"||c==0||c=="")&&(c="0.00"),l.setValue(c),this.onFormItemChange(l,!0)}else l.setValue("0.00"),this.onFormItemChange(l,!0)},this.editor.onFormItemKeyDown=function(r){var _=r.parent().parent().index(),d=this,p=d.rows_widgets_array[_].amount,u=d.rows_widgets_array[_].rate,l=d.rows_widgets_array[_].units;u.getValue().length>0&&l.getValue().length>0||(p.setValue("0.00"),this.onFormItemChange(p,!0)),p.setReadOnly(!0)},this.editor.onFormItemChange=function(r,_){var d=r.getField(),p=parseFloat(r.getValue()?r.getValue():0),u=r.parent().parent().index();if(d==="amount"){var l=parseFloat(this.rows_widgets_array[u].ytd_amount.attr("original_ytd_amount"));isNaN(l)&&(l=0);var c=parseFloat(this.rows_widgets_array[u].ytd_amount.attr("original_amount"));isNaN(c)&&(c=0);var h=Global.removeTrailingZeros(A(l).sub(c).add(p).toFixed(4));isNaN(h)&&(h=0),this.rows_widgets_array[u].ytd_amount.setValue(h!=0?h:"-"),this.rows_widgets_array[u].ytd_amount.attr("original_ytd_amount",h),this.rows_widgets_array[u].ytd_amount.attr("original_amount",p)}_||this.parent_controller.validate(),this.calcTotal()},this.editor.calcTotal=function(){for(var r=0,_=0,d=0,p=0,u=0,l=!0,c=0;c<this.rows_widgets_array.length;c++){var h=this.rows_widgets_array[c];if(h===!0||T.isArray(h)){r=0,_=0,d=0;continue}if(h.total_row===!0){Global.isNumeric(_)||(_=0),Global.isSet(h.units)&&(l==!1?h.units.setValue(Global.MoneyRound(r)):l&&h.units.setValue("-")),h.amount.setValue(Global.MoneyRound(parseFloat(_))),h.ytd_amount.setValue(Global.MoneyRound(parseFloat(d))),h.type_id==10?(p=_,u=d):h.type_id==20&&(p=A(p).sub(_).toFixed(4),u=A(u).sub(d).toFixed(4)),this.parent_controller.net_pay_amount=p;continue}if(h.pay_stub_entry_account_id&&h.pay_stub_entry_account_id==this.parent_controller.pseal_link.net_pay_entry_account_id){h.amount.setValue(Global.MoneyRound(p)),h.ytd_amount.setValue(Global.MoneyRound(u));continue}var D=0;Global.isSet(h.units)&&Global.isNumeric(h.units.getValue())&&(D=Global.MoneyRound(parseFloat(h.units.getValue())),l=!1);var M=0;Global.isSet(h.amount)&&Global.isNumeric(h.amount.getValue())&&(M=parseFloat(h.amount.getValue()),l=!1);var b=0;Global.isSet(h.ytd_amount)&&Global.isNumeric(h.ytd_amount.getValue())&&(b=parseFloat(h.ytd_amount.getValue())),l==!1?r=A(parseFloat(r)).add(parseFloat(D)).toFixed(4):r="",Global.isNumeric(M)&&(_=A(_).add(M).toFixed(4)),Global.isNumeric(b)&&(d=A(d).add(b).toFixed(4))}this.calcTransactionTotals()},this.editor.insideTransactionEditorSetValue=function(r){if(e=this,!this.parent_controller.current_edit_record)return!1;var _=this.parent_controller.current_edit_record.status_id,d=!1;!this.parent_controller.current_edit_record.id&&!this.parent_controller.copied_record_id&&(d=!0),!d&&_==25&&this.show_cover&&(this.cover=Global.loadWidgetByName(WidgetNamesDic.NO_RESULT_BOX),this.cover.NoResultBox({related_view_controller:this,message:o.i18n._("Click the Edit icon below to override pay stub amounts"),is_edit:!0}));var p=this.getRender(),u=`
			<tr class="tblHeader">
				<td align="left" colspan="2"><%= col1 %></td>
				<td colspan="2"> <%= col2 %></td>
				<td colspan="1"> <%= col3 %></td>
				<td colspan="1"> <%= col4 %></td>
				<td colspan="1" style="width: 30px"><%= col5 %></td>
				<td colspan="2" style="width:60px"></td>
			</tr>`,l={col1:o.i18n._("Payment Method"),col2:o.i18n._("Note"),col3:o.i18n._("Status"),col4:o.i18n._("Payment Date"),col5:o.i18n._("Amount")};o(p).append('<tr class="tblSepHeader"><td colspan="8">'+o.i18n._("Transactions")+"</td></tr>");var c=T.template(u);if(o(p).append(c(l)),this.rows_widgets_array.push(!0),T.size(r)>0){for(var h=0;h<T.size(r);h++)if(Global.isSet(r[h])){var D=r[h];this.insideTransactionEditorAddRow(D)}this.rows_widgets_array.push(!0),this.cover&&this.cover.length>0&&(this.cover.css({width:this.width(),height:this.height()+30}),this.parent().append(this.cover))}else this.parent_controller.getPayStubTransactionDefaultData(function(M){e.insideTransactionEditorAddRow(M),e.rows_widgets_array.push(!0),e.cover&&e.cover.length>0&&(e.cover.css({width:e.width(),height:e.height()}),e.parent().append(e.cover))});this.calcTransactionTotals()},this.editor.insideTransactionEditorGetValue=function(r){var _=this.rows_widgets_array.length,d=[];if(this.cover&&this.cover.length>0)return d;for(var p=0;p<_;p++){var u={};if(T.isArray(this.rows_widgets_array[p])){var l=this.rows_widgets_array[p][0];if(!Global.isSet(l.remittance_destination_account_id)||!l.remittance_destination_account_id.getValue())continue;u.id=l.form_item_record.id,u.remittance_destination_account_id=l.remittance_destination_account_id?l.remittance_destination_account_id.getValue():TTUUID.zero_id,Global.isSet(l.status_id)&&(u.status_id=l.status_id.getValue()),u.transaction_date=l.transaction_date?l.transaction_date.getValue():"",Global.isSet(l.currency_id)&&(u.currency_id=l.currency_id.getValue()),u.note=l.note?l.note.getValue():"",u.amount=l.amount?l.amount.getValue():"",Global.isSet(l.deleted)&&l.deleted==1?u.deleted=1:u.deleted=0,u.pay_stub_id=r,l.total_row!=!0&&TTUUID.isUUID(u.remittance_destination_account_id)&&(u.remittance_destination_account_id!=TTUUID.zero_id||u.note!=null&&u.note.length>0||u.amount!=null&&u.amount.length>0&&parseFloat(u.amount)!=0)&&d.push(u)}}return d},this.editor.insideTransactionEditorRemoveRow=function(r){var _=r[0].rowIndex-1;if(this.rows_widgets_array[_][0]){this.rows_widgets_array[_][0].form_item_record.deleted=1;var d=this.rows_widgets_array[_][0].form_item_record.id}TTUUID.isUUID(d)?this.delete_transaction_ids.push(d):this.rows_widgets_array.splice(_,1),r.hide();var p=o(".paystub_transaction_row:visible").length;p==0&&this.insideTransactionEditorAddRow({},_),this.parent_controller.validate(),e.calcTransactionTotals()},this.editor.calcTransactionTotals=function(){for(var r=0,_=0;_<this.rows_widgets_array.length;_++){var d=this.rows_widgets_array[_];if(T.isObject(d)&&Global.isSet(d[0])&&Global.isSet(d[0].remittance_destination_account_id)&&Global.isSet(d[0].form_item_record.deleted)==!1&&Global.isSet(d[0].status_id)&&(d[0].status_id.getValue()==10||d[0].status_id.getValue()==20)){var p=parseFloat(d[0].amount.getValue());isNaN(p)&&(p=0),r+=p}}r=Global.MoneyRound(r);var u=this.getRender();if(o(".transaction_total_rows").remove(),r>0){var l=Global.removeTrailingZeros(A(parseFloat(r)).sub(parseFloat(this.parent_controller.net_pay_amount)).toFixed(4));isNaN(l)&&(l=0);var c="green";l!=0&&(c="red"),l!=0?(l=Global.MoneyRound(l),o(u).append('<tr class="tblDataWhite transaction_total_rows"><td colspan="2" style="text-align:left"><b>Transaction Total</b></td><td colspan="3"><br></td><td style="text-align:right;"><span>Difference: <i  style="color:red;">'+l+'</i></b></td><td><b style="color:'+c+'">'+Global.MoneyRound(r)+"</b></td><td></td></td></tr>")):o(u).append('<tr class="tblDataWhite transaction_total_rows"><td colspan="2" style="text-align:left"><b>Transaction Total</b></td><td colspan="4"><br></td><td><b style="color:'+c+'">'+r+"</b></td><td></td></td></tr>"),this.rows_widgets_array.push(!0)}},this.editor.insideTransactionEditorAddRow=function(r,_){var d=this;if(!d.parent_controller||!d.parent_controller.current_edit_record)return!1;if(T.size(r)==0)this.parent_controller.getPayStubTransactionDefaultData(function(F){d.insideTransactionEditorAddRow(F,_)},_);else{var p=d.getRender(),u=[],l={};l.form_item_record={};var c=o(`<tr class="tblDataWhite paystub_transaction_row" align="right">
								<td align="left" colspan="2"></td>
								<td colspan="2" class=""></td>
								<td colspan="1" class=""></td>
								<td colspan="1" class=""></td>
								<td colspan="1" class="cell control-icon" style="width: 30px"></td>
								<td colspan="1" class="cell control-icon">
									<div>
										<button class="plus-icon" onclick=""></button>
										<button class="minus-icon " onclick=""></button>
									</div>
								</td>
							</tr>`);r=T.isArray(r)?r[0]:r,l.form_item_record.id=r.id&&d.parent_controller.current_edit_record.id?r.id:"",d.parent_controller.current_edit_record.status_id,!d.parent_controller.current_edit_record.id&&!d.parent_controller.copied_record_id&&(r.status_id=10);var h=[10];d.parent_controller.is_add==!1&&h.push(20);var D=Global.loadWidgetByName(FormItemType.AWESOME_BOX);D.AComboBox({api_class:TTAPI.APIRemittanceDestinationAccount,allow_multiple_selection:!1,layout_name:"global_remittance_destination_account",show_search_inputs:!0,set_empty:!0,field:"remittance_destination_account_id",default_args:{filter_data:{user_id:d.parent_controller.current_edit_record.user_id,status_id:h}}}),D.setValue(r.remittance_destination_account_id?r.remittance_destination_account_id:""),D.unbind("formItemChange").bind("formItemChange",function(F,v){d.parent_controller.validate()});var M=Global.loadWidgetByName(FormItemType.TEXT);M.TText({field:"remittance_destination_account"}),M.setValue(r.remittance_destination_account?r.remittance_destination_account:"");var b=Global.loadWidgetByName(FormItemType.TEXT_INPUT);b.TTextInput({field:"note",width:300}),b.setValue(r.note),b.attr("editable",!0);var U=Global.loadWidgetByName(FormItemType.TEXT);U.TText({field:"description"}),U.setValue(r.description);var w=Global.loadWidgetByName(FormItemType.COMBO_BOX);w.TComboBox({field:"status_id",set_empty:!1}),w.setSourceData(d.parent_controller.transaction_status_array),w.setValue(r.status_id?r.status_id:""),w.setEnabled(LocalCacheData.current_doing_context_action=="copy_as_new"),w.unbind("formItemChange").bind("formItemChange",function(F,v){d.parent_controller.validate()});var C=Global.loadWidgetByName(FormItemType.TEXT);C.TText({field:"status"}),C.setValue(r.status?r.status:"");var P=Global.loadWidgetByName(FormItemType.DATE_PICKER);P.TDatePicker({field:"transaction_date"}),P.setValue(r.transaction_date?r.transaction_date:""),P.attr("editable",!0),r.transaction_date||P.setValue(d.parent_controller.edit_view_ui_dic.transaction_date.getValue()),P.unbind("formItemChange").bind("formItemChange",function(F,v){d.parent_controller.validate()});var S=Global.loadWidgetByName(FormItemType.TEXT);S.TText({field:"transaction_date"}),S.setValue(r.transaction_date?r.transaction_date:"");var g=Global.loadWidgetByName(FormItemType.TEXT_INPUT);g.TTextInput({field:"amount",width:60}),g.setValue(r.amount?Global.removeTrailingZeros(r.amount):""),g.unbind("formItemChange").bind("formItemChange",function(F,v){d.parent_controller.validate(),d.calcTransactionTotals()}),g.attr("editable",!0);var E=Global.loadWidgetByName(FormItemType.TEXT);if(E.TText({field:"amount"}),E.setValue(r.amount?Global.removeTrailingZeros(r.amount):""),r.status_id||(r.status_id=10),d.parent_controller.isEditMode()?(D.setEnabled(r.status_id==10),P.setEnabled(r.status_id==10),g.setReadOnly(r.status_id!=10),b.setReadOnly(r.status_id!=10),w.setEnabled(!1)):(D.setEnabled(!1),P.setEnabled(!1),g.setEnabled(!1),b.setEnabled(!1),w.setEnabled(!1),n=U),l[D.getField()]=D,c.children().eq(0).append(D),l[b.getField()]=b,c.children().eq(1).append(b),l[w.getField()]=w,c.children().eq(2).append(w),l[P.getField()]=P,c.children().eq(3).append(P),l[g.getField()]=g,c.children().eq(4).append(g),u.push(l),typeof _<"u"?(c.insertAfter(o(p).find("tr").eq(_)),d.rows_widgets_array.splice(_,0,u)):(o(p).append(c),d.rows_widgets_array.push(u)),d.parent_controller.isEditMode()==!0){var I=c.find(".minus-icon");r.status_id!=10?I.remove():I.click(function(){d.insideTransactionEditorRemoveRow(c)});var V=c.find(".plus-icon");V.click(function(){d.insideTransactionEditorAddRow({},o(this).parents("tr").index())})}else c.children().last().find(".minus-icon").remove(),c.children().last().find(".plus-icon").remove()}},m.append(this.editor)}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:o.i18n._("Pay Stub Status"),in_column:1,field:"status_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:o.i18n._("Pay Stub Type"),in_column:1,field:"type_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:o.i18n._("Employee Status"),in_column:1,field:"user_status_id",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:o.i18n._("Pay Period"),in_column:1,field:"pay_period_id",layout_name:"global_Pay_period",api_class:TTAPI.APIPayPeriod,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:o.i18n._("Payroll Run"),in_column:1,field:"run_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:o.i18n._("Employee"),in_column:1,field:"user_id",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:o.i18n._("Title"),field:"title_id",in_column:1,layout_name:"global_job_title",api_class:TTAPI.APIUserTitle,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:o.i18n._("Currency"),field:"currency_id",in_column:1,layout_name:"global_currency",api_class:TTAPI.APICurrency,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:o.i18n._("Group"),in_column:2,multiple:!0,field:"group_id",layout_name:"global_tree_column",tree_mode:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:o.i18n._("Default Branch"),in_column:2,field:"default_branch_id",layout_name:"global_branch",api_class:TTAPI.APIBranch,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:o.i18n._("Default Department"),field:"default_department_id",in_column:2,layout_name:"global_department",api_class:TTAPI.APIDepartment,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:o.i18n._("Country"),in_column:2,field:"country",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.COMBO_BOX}),new SearchField({label:o.i18n._("Province/State"),in_column:2,field:"province",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:o.i18n._("City"),field:"city",basic_search:!1,adv_search:!0,in_column:2,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:o.i18n._("Created By"),in_column:2,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:o.i18n._("Updated By"),in_column:2,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX})]}onCustomContextClick(e){switch(e){case"timesheet":case"schedule":case"pay_stub_amendment":case"edit_employee":case"employee_pay_stubs":case"employer_pay_stubs":case"generate_pay_stub":case"edit_pay_period":case"export_excel":case"pay_stub_transaction":default:this.onNavigationClick(e);break}}onViewClick(e,t){this.onNavigationClick("view")}onReportPrintClick(e){var t=this,i,s=[],a=[],n=[];t.edit_view&&t.current_edit_record.id?(s.push(t.current_edit_record.id),a.push(t.current_edit_record.user_id),n.push(t.current_edit_record.pay_period_id),t.current_edit_record.start_date):(i=this.getGridSelectIdArray(),o.each(i,function(y,r){var _=t.getRecordFromGridById(r);s.push(_.id),a.push(_.user_id),n.push(_.pay_period_id),_.start_date}));var m={filter_data:{id:s}},f={0:m,1:!0,2:e};this.doFormIFrameCall(f)}onNavigationClick(e){var t=this,i,s={},a=[],n=[],m,f=[];t.edit_view&&t.current_edit_record.id?(a.push(t.current_edit_record.id),n.push(t.current_edit_record.user_id),f.push(t.current_edit_record.pay_period_id),m=t.current_edit_record.start_date):(i=this.getGridSelectIdArray(),o.each(i,function(p,u){var l=t.getRecordFromGridById(u);a.push(l.id),n.push(l.user_id),f.push(l.pay_period_id),m=l.start_date}));var y={filter_data:{id:a}},r;switch(e){case"edit_employee":n.length>0&&IndexViewController.openEditView(this,"Employee",n[0]);break;case"edit_pay_period":f.length>0&&IndexViewController.openEditView(this,"PayPeriods",f[0]);break;case"timesheet":n.length>0&&(s.user_id=n[0],s.base_date=m,Global.addViewTab(t.viewId,o.i18n._("Pay Stubs"),window.location.href),IndexViewController.goToView("TimeSheet",s));break;case"schedule":s.filter_data={};var _={value:n};s.filter_data.include_user_ids=_,s.select_date=m,Global.addViewTab(this.viewId,o.i18n._("Pay Stubs"),window.location.href),IndexViewController.goToView("Schedule",s);break;case"pay_stub_amendment":s.filter_data={},s.filter_data.user_id=n[0],s.filter_data.pay_period_id=f[0],Global.addViewTab(this.viewId,o.i18n._("Pay Stubs"),window.location.href),IndexViewController.goToView("PayStubAmendment",s);break;case"generate_pay_stub":n.length===1?s.user_id=n[0]:n.length>1&&(s.user_id=n),f.length===1?s.pay_period_id=[f[0]]:f.length>1?s.pay_period_id=f:s.pay_period_id=[],IndexViewController.openWizard("GeneratePayStubWizard",s,function(){t.search()});break;case"view":PermissionManager.validate("pay_stub","view")||PermissionManager.validate("pay_stub","view_child")?r={0:y,1:!1,2:"pdf",3:!1}:r={0:y,1:!1,2:"pdf",3:!0},this.doFormIFrameCall(r),o().TFeedback({source:"View",delay:5e3});break;case"employee_pay_stubs":r={0:y,1:!1,2:"pdf",3:!0},this.doFormIFrameCall(r);break;case"employer_pay_stubs":r={0:y,1:!1,2:"pdf",3:!1},this.doFormIFrameCall(r);break;case"pay_stub_transaction":s={},s.filter_data={},s.filter_data.user_id={value:n},s.filter_data.pay_period_id={value:f},Global.addViewTab(this.viewId,o.i18n._("Pay Stubs"),window.location.href),IndexViewController.goToView("PayStubTransaction",s);break;case"export_excel":this.onExportClick("export"+this.api.key_name);break;case"direct_deposit":var d={filter_data:{pay_stub_id:this.getGridSelectIdArray()}};IndexViewController.openWizardController("ProcessTransactionsWizardController",d);break}}onReportMenuClick(e){this.onReportPrintClick(e)}doFormIFrameCall(e){Global.APIFileDownload(this.api.className,"get"+this.api.key_name,e)}getPayStubTabHtml(){return`<div id="tab_pay_stub" class="edit-view-tab-outside">
					<div class="edit-view-tab" id="tab_pay_stub_content_div">
						<div class="first-column"></div>
						<div class="second-column"></div>
						<div class="inside-pay-stub-entry-editor-div full-width-column" style="float: left; position: relative">
						</div>
					</div>
				</div>`}}export{k as PayStubViewController};
//# sourceMappingURL=PayStubViewController-CJK8SowO.bundle.js.map
