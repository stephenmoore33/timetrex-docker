import{_ as u,j as a}from"./vendor-tTApdY0Y.bundle.js";class p extends BaseViewController{constructor(t={}){u.defaults(t,{el:"#custom_field_view_container",type_array:null,parent_table_array:null,status_array:null,original_custom_field_select_items:[],authentication_api:null}),super(t)}init(t){this.edit_view_tpl="CustomFieldEditView.html",this.permission_id="custom_field",this.viewId="CustomField",this.script_name="CustomFieldView",this.table_name_key="custom_field_control",this.context_menu_name=a.i18n._("Custom Field"),this.navigation_label=a.i18n._("Custom Field"),this.api=TTAPI.APICustomField,this.authentication_api=TTAPI.APIAuthentication,this.render(),this.buildContextMenu(),this.initData()}getCustomContextMenuModel(){var t={exclude:["copy","mass_edit"],include:[]};return t}initOptions(t){var i=[{option_name:"type",api:this.api},{option_name:"status",api:this.api},{option_name:"parent_table",field_name:"parent_table",api:this.api}];this.initDropDownOptions(i)}searchDone(t){super.searchDone(),Global.refreshCustomFieldCache()}buildEditViewUI(){super.buildEditViewUI();var t=this,i={tab_custom_field:{label:a.i18n._("Custom Field"),is_multi_column:!0,html_template:this.getCustomFieldTabHtml()},tab_audit:!0};this.setTabModel(i),this.navigation.AComboBox({api_class:TTAPI.APICustomField,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_custom_field",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation();var l=this.edit_view_tab.find("#tab_custom_field"),_=l.find(".first-column"),d=l.find(".second-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(_);var e=Global.loadWidgetByName(FormItemType.COMBO_BOX);e.TComboBox({field:"status_id"}),e.setSourceData(t.status_array),this.addEditFieldToColumn(a.i18n._("Status"),e,_,""),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"name"}),this.addEditFieldToColumn(a.i18n._("Name"),e,_,"");var e=Global.loadWidgetByName(FormItemType.COMBO_BOX);e.TComboBox({field:"parent_table"}),e.setSourceData(t.parent_table_array),this.addEditFieldToColumn(a.i18n._("Object Type"),e,_,"");var e=Global.loadWidgetByName(FormItemType.COMBO_BOX);e.TComboBox({field:"type_id"}),e.setSourceData(t.type_array),this.addEditFieldToColumn(a.i18n._("Field Type"),e,_,"",null,!0),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"display_order"}),this.addEditFieldToColumn(a.i18n._("Display Order"),e,_,""),e=Global.loadWidgetByName(FormItemType.CHECKBOX),e.TCheckbox({field:"enable_search"}),this.addEditFieldToColumn(a.i18n._("Enable Search"),e,_,"",null,!0),e=Global.loadWidgetByName(FormItemType.SEPARATED_BOX),e.SeparatedBox({label:a.i18n._("Validation Rules")}),this.addEditFieldToColumn(null,e,d,"",null,!0,!1),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"default_value"}),e.attr("id","custom-field-default-value"),this.addEditFieldToColumn(a.i18n._("Default Value"),e,d,""),e=Global.loadWidgetByName(FormItemType.CHECKBOX),e.TCheckbox({field:"is_required"}),this.addEditFieldToColumn(a.i18n._("Required"),e,d,""),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"validate_min_length"}),this.addEditFieldToColumn(a.i18n._("Minimum Length"),e,d,"",null,!0),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"validate_max_length"}),this.addEditFieldToColumn(a.i18n._("Maximum Length"),e,d,"",null,!0),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"validate_decimal_places"}),this.addEditFieldToColumn(a.i18n._("Decimal Places"),e,d,"",null,!0),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"validate_min_amount"}),this.addEditFieldToColumn(a.i18n._("Minimum Amount"),e,d,"",null,!0),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"validate_max_amount"}),this.addEditFieldToColumn(a.i18n._("Maximum Amount"),e,d,"",null,!0),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"validate_min_time_unit",mode:"time_unit",need_parser_sec:!0}),this.addEditFieldToColumn(a.i18n._("Minimum Amount"),e,d,"",null,!0),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"validate_max_time_unit",mode:"time_unit",need_parser_sec:!0}),this.addEditFieldToColumn(a.i18n._("Maximum Amount"),e,d,"",null,!0),e=Global.loadWidgetByName(FormItemType.DATE_PICKER),e.TDatePicker({field:"validate_min_date"}),this.addEditFieldToColumn(a.i18n._("Minimum Date"),e,d,"",null,!0),e=Global.loadWidgetByName(FormItemType.DATE_PICKER),e.TDatePicker({field:"validate_max_date"}),this.addEditFieldToColumn(a.i18n._("Maximum Date"),e,d,"",null,!0),e=Global.loadWidgetByName(FormItemType.TIME_PICKER),e.TTimePicker({field:"validate_min_time",validation_field:"time_stamp"}),this.addEditFieldToColumn(a.i18n._("Minimum time"),e,d,"",null,!0),e=Global.loadWidgetByName(FormItemType.TIME_PICKER),e.TTimePicker({field:"validate_max_time",validation_field:"time_stamp"}),this.addEditFieldToColumn(a.i18n._("Maximum time"),e,d,"",null,!0);var e=Global.loadWidgetByName(FormItemType.TEXT_INPUT);e.TTextInput({field:"validate_multi_select_min_amount"}),this.addEditFieldToColumn(a.i18n._("Multi-select Minimum Selected"),e,d,"",null,!0),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"validate_multi_select_max_amount"}),this.addEditFieldToColumn(a.i18n._("Multi-select Maximum Selected"),e,d,"",null,!0),e=Global.loadWidgetByName(FormItemType.DATE_PICKER),e.TDatePicker({field:"validate_min_datetime",mode:"date_time"}),this.addEditFieldToColumn(a.i18n._("Minimum Date"),e,d,"",null,!0),e=Global.loadWidgetByName(FormItemType.DATE_PICKER),e.TDatePicker({field:"validate_max_datetime",mode:"date_time"}),this.addEditFieldToColumn(a.i18n._("Maximum Date"),e,d,"",null,!0);var n=l.find(".inside-editor-div"),r={id:a.i18n._("Item Value"),label:a.i18n._("Item Display Label")};this.editor=Global.loadWidgetByName(FormItemType.INSIDE_EDITOR),this.editor.InsideEditor({addRow:this.insideEditorAddRow,removeRow:this.insideEditorRemoveRow,getValue:this.insideEditorGetValue,setValue:this.insideEditorSetValue,render:o(),render_args:r,render_inline_html:!0,row_render:s(),parent_controller:this});function o(){return`
			<table class="inside-editor-render">
				<tr class="title">
					<td style="width: 200px"><%= id %></td>
					<td style="width: 200px"><%= label %></td>
					<td style="width: 25px"></td>
					<td style="width: 25px"></td>
				</tr>
			</table>`}function s(){return`
			<tr class="inside-editor-row data-row">
				<td class="id cell"></td>
				<td class="label cell"></td>
				<td class="cell control-icon">
					<button class="plus-icon" onclick=""></button>
				</td>
				<td class="cell control-icon">
					<button class="minus-icon " onclick=""></button>
				</td>
			</tr>`}n.append(this.editor)}insideEditorSetValue(t){t.length,this.removeAllRows();for(var i=0;i<t.length;i++)if(Global.isSet(t[i])){var l=t[i];Global.isSet(this.parent_id)&&(l.id=""),this.addRow(l)}}insideEditorAddRow(t,i){let l=!1;t?l=!0:t={};var _=t.id?t.id:TTUUID.generateUUID(),d=this.getRowRender(),e=this.getRender(),n={},r;r=Global.loadWidgetByName(FormItemType.TEXT_INPUT),r.TTextInput({field:"id",width:175}),r.setValue(t.id?t.id:""),r.attr("item_id",_),r.bind("formItemChange",(function(o,s,m){this.parent_controller.createMetaData(this.parent_controller.current_edit_record.type_id),this.parent_controller.updateCustomFieldDropdowns()}).bind(this)),l&&this.parent_controller.is_add==!1&&r.setEnabled(!1),n[r.getField()]=r,d.children().eq(0).append(r),r=Global.loadWidgetByName(FormItemType.TEXT_INPUT),r.TTextInput({field:"label",width:175}),r.setValue(t.label?t.label:""),r.bind("formItemChange",(function(o,s,m){this.parent_controller.onFormItemChange(s,m),this.parent_controller.updateCustomFieldDropdowns()}).bind(this)),n[r.getField()]=r,d.children().eq(1).append(r),typeof i<"u"?(d.insertAfter(a(e).find("tr").eq(i)),this.rows_widgets_array.splice(i,0,n)):(a(e).append(d),this.rows_widgets_array.push(n)),this.parent_controller.is_viewing&&d.find(".control-icon").hide(),this.addIconsEvent(d),this.removeLastRowLine()}insideEditorRemoveRow(t){var i=t[0].rowIndex-1;t.remove(),this.rows_widgets_array.splice(i,1),this.removeLastRowLine(),this.parent_controller.updateCustomFieldDropdowns(),this.parent_controller.createMetaData(this.parent_controller.current_edit_record.type_id)}insideEditorGetValue(t){for(var i=this.rows_widgets_array.length,l=[],_=0;_<i;_++){var d=this.rows_widgets_array[_],e={label:d.label.getValue(),id:d.id.getValue()};l.push(e)}return l}setEditViewDataDone(){super.setEditViewDataDone(),this.onTypeChange(!0),this.initInsideEditorData(!0)}initInsideEditorData(t){var i=this;if(t&&this.editor.removeAllRows(),this.mass_edit||!this.current_edit_record.meta_data.validation.multi_select_items||!this.current_edit_record.meta_data.validation.multi_select_items.length>0||!this.current_edit_record)i.editor.removeAllRows(),i.editor.addRow(),i.original_custom_field_select_items=[];else{i.original_custom_field_select_items=[];for(var l=0;l<i.current_edit_record.meta_data.validation.multi_select_items.length;l++){var _=i.current_edit_record.meta_data.validation.multi_select_items[l];_.id!==TTUUID.zero_id&&_.id!==TTUUID.not_exist_id&&(i.editor.addRow(_),i.original_custom_field_select_items.push(_))}}}saveInsideEditorData(t){this.createMetaData(),t&&t()}onFormItemChange(t,i){this.setIsChanged(t),this.setMassEditingFieldsWhenFormChange(t);var l=t.getField(),_=t.getValue();switch(this.current_edit_record[l]=_,l){case"type_id":this.onTypeChange(!1);break;case"parent_table":this.onParentTableChange();break;case"value":this.onSelectValueChange(t[0],_);break}this.createMetaData(this.current_edit_record.type_id),i||this.validate()}onTypeChange(t){this.hideValidationFields(),this.current_edit_record.type_id==1010?this.detachElement("enable_search"):this.attachElement("enable_search"),this.current_edit_record.type_id==100||this.current_edit_record.type_id==110?(this.attachElement("validate_min_length"),this.attachElement("validate_max_length")):this.current_edit_record.type_id==400||this.current_edit_record.type_id==410||this.current_edit_record.type_id==420?(this.attachElement("validate_min_amount"),this.attachElement("validate_max_amount"),this.current_edit_record.type_id==410&&this.attachElement("validate_decimal_places")):this.current_edit_record.type_id==1e3||this.current_edit_record.type_id==1010?(this.attachElement("validate_min_date"),this.attachElement("validate_max_date")):this.current_edit_record.type_id==1100?(this.attachElement("validate_min_time"),this.attachElement("validate_max_time")):this.current_edit_record.type_id==1200?(this.attachElement("validate_min_datetime"),this.attachElement("validate_max_datetime")):this.current_edit_record.type_id==1300?(this.attachElement("validate_min_time_unit"),this.attachElement("validate_max_time_unit")):this.current_edit_record.type_id==2100?a("#tab_custom_field_content_div #dropdown-editor").show():this.current_edit_record.type_id==2110&&(a("#tab_custom_field_content_div #dropdown-editor").show(),this.attachElement("validate_multi_select_min_amount"),this.attachElement("validate_multi_select_max_amount")),this.changeDefaultValueFormItemType(this.current_edit_record.type_id,t),this.editFieldResize()}onParentTableChange(){this.setPunchFieldTypes()}onSelectValueChange(t,i){t.id=i}changeDefaultValueFormItemType(t,i){let l=this.edit_view_tab.find("#tab_custom_field .second-column"),_=this.getCustomFieldFormInputByType(t,"default_value",this.current_edit_record.meta_data),d=_[0],e=_[1];d.attr("id","custom-field-default-value-new"),this.edit_view_ui_dic.default_value=d,this.addEditFieldToColumn(a.i18n._("Default Value"),d,l,"",e),d.css("opacity",1);let n=document.querySelector("#custom-field-default-value"),r=document.querySelector("#custom-field-default-value-new"),o=document.createElement("div");n.parentNode.insertBefore(o,n),r.parentNode.insertBefore(n,r),o.parentNode.insertBefore(r,o),o.parentNode.removeChild(o),n.parentNode.parentNode.remove(),r.id="custom-field-default-value",i?d.setValue(this.current_edit_record.default_value):this.current_edit_record.default_value=""}hideValidationFields(){this.detachElement("validate_min_length"),this.detachElement("validate_max_length"),this.detachElement("validate_min_amount"),this.detachElement("validate_max_amount"),this.detachElement("validate_decimal_places"),this.detachElement("validate_min_date"),this.detachElement("validate_max_date"),this.detachElement("validate_min_time_unit"),this.detachElement("validate_max_time_unit"),this.detachElement("validate_min_time"),this.detachElement("validate_max_time"),this.detachElement("validate_min_datetime"),this.detachElement("validate_max_datetime"),this.detachElement("validate_multi_select_min_amount"),this.detachElement("validate_multi_select_max_amount"),a("#tab_custom_field_content_div #dropdown-editor").hide()}createMetaData(t){switch(t=parseInt(t),t){case 100:case 110:this.current_edit_record.meta_data.validation={validate_min_length:this.current_edit_record.validate_min_length,validate_max_length:this.current_edit_record.validate_max_length};break;case 400:case 420:this.current_edit_record.meta_data.validation={validate_min_amount:this.current_edit_record.validate_min_amount,validate_max_amount:this.current_edit_record.validate_max_amount};break;case 410:this.current_edit_record.meta_data.validation={validate_min_amount:this.current_edit_record.validate_min_amount,validate_max_amount:this.current_edit_record.validate_max_amount,validate_decimal_places:this.current_edit_record.validate_decimal_places};break;case 1e3:case 1010:this.current_edit_record.meta_data.validation={validate_min_date:this.current_edit_record.validate_min_date,validate_max_date:this.current_edit_record.validate_max_date};break;case 1100:this.current_edit_record.meta_data.validation={validate_min_time:this.current_edit_record.validate_min_time,validate_max_time:this.current_edit_record.validate_max_time};break;case 1200:this.current_edit_record.meta_data.validation={validate_min_datetime:this.current_edit_record.validate_min_datetime,validate_max_datetime:this.current_edit_record.validate_max_datetime};break;case 1300:this.current_edit_record.meta_data.validation={validate_min_time_unit:this.current_edit_record.validate_min_time_unit,validate_max_time_unit:this.current_edit_record.validate_max_time_unit};break;case 2100:this.current_edit_record.meta_data.validation={multi_select_items:this.editor.getValue().filter(i=>i.id!==""||i.id!=="")};break;case 2110:this.current_edit_record.meta_data.validation={validate_multi_select_min_amount:this.current_edit_record.validate_multi_select_min_amount,validate_multi_select_max_amount:this.current_edit_record.validate_multi_select_max_amount,multi_select_items:this.editor.getValue().filter(i=>i.id!==""||i.id!=="")};break;default:this.current_edit_record.meta_data.validation={};break}}updateCustomFieldDropdowns(){if(this.current_edit_record.type_id==2100||this.current_edit_record.type_id==2110){let t=this.editor.getValue(),i=this.current_edit_record.default_value;this.edit_view_ui_dic.default_value.setSourceData(t),Array.isArray(t)&&t.some(l=>l.id==i)?this.edit_view_ui_dic.default_value.setValue(this.current_edit_record.default_value):Array.isArray(i)&&i.length>1?this.edit_view_ui_dic.default_value.setValue(i.filter(l=>t.some(_=>_.id==l))):this.edit_view_ui_dic.default_value.setValue(null)}}setCurrentEditRecordData(){this.parseMetaDataToCurrentEditRecord(),super.setCurrentEditRecordData(),this.is_add==!1&&(this.edit_view_ui_dic.type_id.setEnabled(!1),this.edit_view_ui_dic.parent_table.setEnabled(!1)),this.setPunchFieldTypes()}setPunchFieldTypes(){var t={parent_table:this.current_edit_record.parent_table},i=this.api.getOptions("type_id",t,{async:!1}).getResult();this.edit_view_ui_dic.type_id.setSourceData(i),i[this.current_edit_record.type_id]?this.edit_view_ui_dic.type_id.setValue(this.current_edit_record.type_id):(this.edit_view_ui_dic.type_id.setValue(Object.keys(i)[0]),this.current_edit_record.type_id=Object.keys(i)[0])}parseMetaDataToCurrentEditRecord(){for(var t in this.current_edit_record.meta_data.validation)this.current_edit_record[t]=this.current_edit_record.meta_data.validation[t]}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:a.i18n._("Name"),in_column:1,field:"name",multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:a.i18n._("Status"),in_column:1,field:"status_id",multiple:!0,basic_search:!0,adv_search:!1,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:a.i18n._("Field Type"),in_column:2,field:"type_id",multiple:!0,basic_search:!0,adv_search:!1,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:a.i18n._("Object Type"),in_column:2,field:"parent_table",multiple:!0,basic_search:!0,adv_search:!1,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX})]}setDefaultMenuAddIcon(t,i,l){Global.getProductEdition()==10?ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,t.id,!1):super.setDefaultMenuAddIcon(t,i,l)}getCustomFieldTabHtml(){return`<div id="tab_custom_field" class="edit-view-tab-outside">
					<div class="edit-view-tab" id="tab_custom_field_content_div">
						<div class="first-column"></div>
						<div class="second-column"></div>
						<div class="inside-editor-div full-width-column" id="dropdown-editor">
						</div>
					</div>
				</div>`}copyAsNewResetIds(t){return this.edit_view_ui_dic.type_id&&this.edit_view_ui_dic.parent_table&&(this.edit_view_ui_dic.type_id.setEnabled(!0),this.edit_view_ui_dic.parent_table.setEnabled(!0)),super.copyAsNewResetIds(t)}onSaveDone(t){Global.clearCache("getOptions_columns"),Global.clearCache("getOptions_debit_credit_variables"),Global.clearCache("getOptions_formula_columns"),super.onSaveDone(t)}}export{p as CustomFieldViewController};
//# sourceMappingURL=CustomFieldViewController-COX4FjpZ.bundle.js.map
