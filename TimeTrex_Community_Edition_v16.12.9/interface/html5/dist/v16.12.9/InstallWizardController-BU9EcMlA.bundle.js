import{_ as S,j as e}from"./vendor-tTApdY0Y.bundle.js";class Z extends BaseWizardController{constructor(n={}){S.defaults(n,{el:".install-wizard",type_array:null,country_array:null,time_zone_array:null,external_installer:null,company_id:null,user_id:null,edit_view_error_ui_dic:{}}),super(n)}init(n){if(this.title_1=e(this.el).find(".title-1"),this.steps=5,this.script_name="wizard_install",this.wizard_id="InstallWizard",this.api=TTAPI.APIInstall,ServiceCaller.extra_url="&disable_db=1",S.size(LocalCacheData.getAllURLArgs())>0){var i=LocalCacheData.getAllURLArgs();this.current_step=i.a,this.external_installer=i.external_installer}else this.current_step="license",this.external_installer=0;this.render()}render(){var n=e(this.el).find(".title");this.next_btn=e(this.el).find(".forward-btn"),this.back_btn=e(this.el).find(".back-btn"),this.done_btn=e(this.el).find(".done-btn"),n.text(e.i18n._("Install Wizard")),this.initCurrentStep()}initCurrentStep(n){var i=this;switch(n||(n=this.current_step),ProgressBar.showOverlay(),n){case"license":this.api.getLicense({onResult:function(r){i.stepsDataDic[i.current_step]=r.getResult(),i._initCurrentStep()}});break;case"requirements":this.api.getRequirements(this.external_installer,{onResult:function(r){r&&r.isValid()?r.getResult().action?i.onNextClick():(i.stepsDataDic[i.current_step]=r.getResult(),i._initCurrentStep()):(i.current_step="license",i.initCurrentStep())}});break;case"databaseSchema":ServiceCaller.extra_url=!1,this.api.getDatabaseSchema({onResult:function(r){r&&r.isValid()?(i.stepsDataDic[i.current_step]=r.getResult(),i._initCurrentStep()):(i.current_step="license",i.initCurrentStep())}});break;case"databaseConfig":this.api.getDatabaseConfig({onResult:function(r){r&&r.isValid()?(i.stepsDataDic[i.current_step]=r.getResult(),i.type_array=r.getResult().type_options,i._initCurrentStep()):(i.current_step="license",i.initCurrentStep())}});break;case"postUpgrade":this.api.postUpgrade({onResult:function(r){r&&r.isValid()?(i.stepsDataDic[i.current_step]=r.getResult(),i._initCurrentStep()):(i.current_step="license",i.initCurrentStep())}});break;case"systemSettings":this.api.getSystemSettings({onResult:function(r){r&&r.isValid()?(i.stepsDataDic[i.current_step]=r.getResult(),i.time_zone_array=r.getResult().time_zone_options,i._initCurrentStep()):(i.current_step="license",i.initCurrentStep())}});break;case"company":this.api.getCompany(this.company_id,{onResult:function(r){r&&r.isValid()?(i.stepsDataDic[i.current_step]=r.getResult(),i._initCurrentStep()):(i.current_step="license",i.initCurrentStep())}});break;case"user":var l="";Global.isSet(this.stepsDataDic[this.current_step])&&(l=this.stepsDataDic[this.current_step].company_id),this.api.getUser(l,this.user_id,{onResult:function(r){r&&r.isValid()?(i.stepsDataDic[i.current_step]=r.getResult(),i._initCurrentStep()):(i.current_step="license",i.initCurrentStep())}});break;case"installDone":var a="";Global.isSet(i.stepsDataDic[i.current_step])&&(a=i.stepsDataDic[i.current_step].upgrade),this.api.installDone(a,{onResult:function(r){r&&r.isValid()?(i.stepsDataDic[i.current_step]=r.getResult(),i._initCurrentStep()):(i.current_step="license",i.initCurrentStep())}});break;case"maintenanceJobs":this.api.getMaintenanceJobs({onResult:function(r){r&&r.isValid()?r.getResult()===!0?(i.current_step="installDone",i.initCurrentStep()):(i.stepsDataDic[i.current_step]=r.getResult(),i._initCurrentStep()):(i.current_step="license",i.initCurrentStep())}});break}}_initCurrentStep(n){var i=this;i.setButtonsStatus(),i.buildCurrentStepUI(),i.buildCurrentStepData(),i.setCurrentStepValues()}setButtonsStatus(){this.current_step==="license"?(Global.setWidgetEnabled(this.back_btn,!1),Global.setWidgetEnabled(this.next_btn,!1)):(Global.setWidgetEnabled(this.back_btn,!0),Global.setWidgetEnabled(this.next_btn,!0)),this.current_step!=="installDone"?Global.setWidgetEnabled(this.done_btn,!1):(Global.setWidgetEnabled(this.done_btn,!0),Global.setWidgetEnabled(this.next_btn,!1))}buildCurrentStepUI(){var n=this,i=this.content_div.find(".step-title > .wizard-label"),l=this.content_div.find(".license"),a=this.content_div.find(".requirements"),r=this.content_div.find(".databaseConfig"),p=this.content_div.find(".databaseSchema"),s=this.content_div.find(".postUpgrade"),c=this.content_div.find(".systemSettings"),m=this.content_div.find(".company"),g=this.content_div.find(".user"),W=this.content_div.find(".installDone"),R=this.content_div.find(".maintenanceJobs"),t,d=this.stepsDataDic[this.current_step];switch(this.content_div.find(".step").hide(),this.content_div.find(".content-handle-btn").empty(),Global.isSet(this.stepsWidgetDic[this.current_step])||(this.stepsWidgetDic[this.current_step]={}),this.current_step){case"license":if(l.empty(),this.title_1.text(e.i18n._("License Acceptance")),d.install_mode){d.license_text?(i.text(e.i18n._('Please read through the following license and if you agree and accept it, click the "'+e.i18n._("I Accept")+'"checkbox at the bottom.')),t=Global.loadWidgetByName(FormItemType.TEXT_AREA),t.TTextArea({field:"license_text",width:"65%",height:"80%"}),this.stepsWidgetDic[this.current_step][t.getField()]=t,l.append(t)):l.append(d.error_message),l.append("<br>"),t=Global.loadWidgetByName(FormItemType.CHECKBOX),t.TCheckbox({field:"license_accept"}),t.unbind("formItemChange").bind("formItemChange",function(k,H){H.getValue()?Global.setWidgetEnabled(n.next_btn,!0):Global.setWidgetEnabled(n.next_btn,!1)}),this.stepsWidgetDic[this.current_step][t.getField()]=t,l.append(t);var L="<span> "+e.i18n._("I Accept")+"</span>";l.append(L)}else{var u=e.i18n._('The installer has already been run, as a safety measure it has been disabled from running again. If you are absolutely sure you want to run it again, or upgrade your system, please go to your timetrex.ini.php file and set "installer_enabled" to "TRUE". The line should look like')+":";u=u+"<br>",u=u+"<br>",u=u+'"<b>installer_enabled = TRUE</b>"',u=u+"<br>",u=u+"<br>",u=u+e.i18n._('After this change has been made, you can click the "Re-Check" button below to begin your installation.'),u=u+"<br>",u=u+"<br>",u=u+e.i18n._("For help, please visit")+' <a href="https://www.timetrex.com">www.timetrex.com</a> ',l.append(u);var C=this.getRibbonButtonBox(),E=e('<li><button class="ribbon-sub-menu-icon" id="re-check">'+e.i18n._("Re-Check")+"</button></li>");E.unbind("click").bind("click",function(){ProgressBar.showOverlay(),n.api.getLicense({onResult:function(w){n.stepsDataDic[n.current_step]=w.getResult(),n._initCurrentStep()}})}),C.children().eq(0).append(E),this.content_div.find(".content-handle-btn").html(C)}l.show();break;case"requirements":var y=e.i18n._("In order for your")+" "+e.i18n._(d.application_name)+" "+e.i18n._("installation to function properly, please ensure all of the system check items listed below are marked as")+" <b>OK</b>. "+e.i18n._("If any are red, please take the necessary steps to fix them.");d.check_all_requirements!=0&&(d.tt_product_edition>10?y=y+'<p style="background-color: #FFFF00">'+e.i18n._("For installation assistance, please contact")+' <a href="https://www.timetrex.com/contact-us" target="_blank">'+e.i18n._("TimeTrex support")+"</a>":d.tt_product_edition==10&&(y=y+'<p style="background-color: #FFFF00">'+e.i18n._("For installation assistance, please join our community")+' <a href="https://forums.timetrex.com" target="_blank">'+e.i18n._("forums")+"</a> "+e.i18n._("or contact a TimeTrex support expert for")+' <a href="https://www.timetrex.com/setup-support" target="_blank">'+e.i18n._("Implementation Support Services")+"</a></p>")),d.check_all_requirements==1&&Global.setWidgetEnabled(this.next_btn,!1),S.size(d.extended_error_messages)>0&&Global.setWidgetEnabled(this.next_btn,!1),i.html(y),this.title_1.text(e.i18n._("System Check Acceptance"));var B=a.find(".first-column");B.empty(),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"timetrex_version"}),this.addEditFieldToColumn(e.i18n._("TimeTrex Version"),t,B,""),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"php_version"}),this.addEditFieldToColumn(e.i18n._("PHP Version"),t,B,""),a.find(".first-label").empty(),t=Global.loadWidgetByName(FormItemType.SEPARATED_BOX),t.SeparatedBox({label:e.i18n._("PHP Requirements")}),this.addEditFieldToColumn(null,t,a.find(".first-label"));var o=a.find(".second-column");o.empty(),d.check_all_requirements==0?(o.html(e.i18n._("All System Requirements have been met successfully")+"!"),o.addClass("all-ok")):(o.removeClass("all-ok"),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"database_engine"}),this.addEditFieldToColumn(e.i18n._("PostgreSQL Enabled"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"bcmath"}),this.addEditFieldToColumn(e.i18n._("BCMATH Enabled"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"mbstring"}),this.addEditFieldToColumn(e.i18n._("MBSTRING Enabled"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"gettext"}),this.addEditFieldToColumn(e.i18n._("GETTEXT Enabled"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"intl"}),this.addEditFieldToColumn(e.i18n._("INTL Enabled"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"soap"}),this.addEditFieldToColumn(e.i18n._("SOAP Enabled"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"gd"}),this.addEditFieldToColumn(e.i18n._("GD Enabled"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"json"}),this.addEditFieldToColumn(e.i18n._("JSON Enabled"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"simplexml"}),this.addEditFieldToColumn(e.i18n._("SimpleXML Enabled"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"curl"}),this.addEditFieldToColumn(e.i18n._("CURL Enabled"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"zip"}),this.addEditFieldToColumn(e.i18n._("ZIP Enabled"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"mail"}),this.addEditFieldToColumn(e.i18n._("MAIL Enabled"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"openssl"}),this.addEditFieldToColumn(e.i18n._("OpenSSL Enabled"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"pear"}),this.addEditFieldToColumn(e.i18n._("PEAR Enabled"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"safe_mode"}),this.addEditFieldToColumn(e.i18n._("Safe Mode Turned Off"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"disabled_functions"}),this.addEditFieldToColumn(e.i18n._("PHP DISABLE_FUNCTIONS"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"allow_fopen_url"}),this.addEditFieldToColumn(e.i18n._("ALLOW_FOPEN_URL Turned Off"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"disk_space"}),this.addEditFieldToColumn(e.i18n._("Disk Space"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"memory_limit"}),this.addEditFieldToColumn(e.i18n._("Memory Limit"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"post_size"}),this.addEditFieldToColumn(e.i18n._("Max Post Size"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"upload_size"}),this.addEditFieldToColumn(e.i18n._("Max Upload Size"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"base_url"}),this.addEditFieldToColumn(e.i18n._("Base URL"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"system_timezone"}),this.addEditFieldToColumn(e.i18n._("System TimeZone"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"php_int_size"}),this.addEditFieldToColumn(e.i18n._("PHP 64-bit Support"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"base_dir"}),this.addEditFieldToColumn(e.i18n._("PHP Open BaseDir"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"cli_executable"}),this.addEditFieldToColumn(e.i18n._("PHP CLI Executable"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"config_file"}),this.addEditFieldToColumn(e.i18n._("Writable")+" "+e.i18n._(d.application_name)+" "+e.i18n._("Configuration File")+"<br>(timetrex.ini.php)",t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"cache_dir"}),this.addEditFieldToColumn(e.i18n._("Writable Cache Directory"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"safe_cache_dir"}),this.addEditFieldToColumn(e.i18n._("Secure Cache Directory"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"storage_dir"}),this.addEditFieldToColumn(e.i18n._("Writable Storage Directory"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"safe_storage_dir"}),this.addEditFieldToColumn(e.i18n._("Secure Storage Directory"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"log_dir"}),this.addEditFieldToColumn(e.i18n._("Writable Log Directory"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"safe_log_dir"}),this.addEditFieldToColumn(e.i18n._("Secure Log Directory"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"empty_cache_dir"}),this.addEditFieldToColumn(e.i18n._("Empty Cache Directory"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"file_permission"}),this.addEditFieldToColumn(e.i18n._("File Permissions"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"file_checksums"}),this.addEditFieldToColumn(e.i18n._("File CheckSums"),t,o,"",null,!0,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"cli_requirements"}),this.addEditFieldToColumn(e.i18n._("PHP CLI Requirements"),t,o,"",null,!0,!0));var N=a.find(".forth-column");if(N.empty(),S.size(d.extended_error_messages)>0){var f="<span><b>"+e.i18n._("Detailed Error Messages")+"</b></span>";f=f+"<br>",f=f+"<br>";for(var K in d.extended_error_messages){var X=d.extended_error_messages[K];for(var z in X)f=f+X[z],f=f+"<br>"}N.html(f),N.addClass("dataError")}else N.removeClass("dataError");var U=a.find(".fifth-column");U.empty();var h=e.i18n._("Your")+" "+e.i18n._(d.application_name)+" "+e.i18n._("configuration file")+" ";h=h+"(timetrex.ini.php)",h=h+" "+e.i18n._("is located at")+":",h=h+"<br>",h=h+"<p><b>"+d.config_file_loc+"</b></p>",h=h+"<br>",h=h+e.i18n._("Your PHP configuration file")+" (php.ini) "+e.i18n._("is located at")+":",h=h+"<br>",d.php_include_path?h=h+"<p><b>"+d.php_config_file+"</b>, "+e.i18n._("the include path is")+': "<b>'+d.php_include_path+'</b>"</p>':h=h+"<p><b>"+d.php_config_file+"</b>, "+e.i18n._("the include path is")+': ""</p>',h=h+e.i18n._("Detailed")+"&nbsp;",h=h+'<a href="phpinfo.php" target="_blank">'+e.i18n._("PHP Information")+"</a>",d.check_all_requirements==0||U.html(h);var C=this.getRibbonButtonBox(),E=e('<li><button class="ribbon-sub-menu-icon" id="re-check">'+e.i18n._("Re-Check")+"</button></li>");E.unbind("click").bind("click",function(){ProgressBar.showOverlay(),n.api.getRequirements(n.external_installer,{onResult:function(k){k&&k.getResult().action?n.onNextClick():k&&k.isValid()&&(n.stepsDataDic[n.current_step]=k.getResult(),n._initCurrentStep())}})}),C.children().eq(0).append(E),this.content_div.find(".content-handle-btn").html(C),a.show();break;case"user":i.html(e.i18n._("Please enter the administrator user name and password")+"<br><br><b>*"+e.i18n._("IMPORTANT")+"*:</b> "+e.i18n._("Please write this information down, as you will need it later to login to")+" "+e.i18n._(d.application_name)),this.title_1.text(e.i18n._("Administrator Sign In"));var v=g.find(".first-column");v.empty(),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"user_name",width:200}),this.addEditFieldToColumn(e.i18n._("User Name"),t,v),t=Global.loadWidgetByName(FormItemType.PASSWORD_INPUT),t.TTextInput({field:"password",width:200}),this.addEditFieldToColumn(e.i18n._("Password"),t,v),t=Global.loadWidgetByName(FormItemType.PASSWORD_INPUT),t.TTextInput({field:"password2",width:200}),this.addEditFieldToColumn(e.i18n._("Password (Confirm)"),t,v),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"first_name",width:200}),this.addEditFieldToColumn(e.i18n._("First Name"),t,v),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"last_name",width:200}),this.addEditFieldToColumn(e.i18n._("Last Name"),t,v),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"work_email",width:200}),this.addEditFieldToColumn(e.i18n._("Email"),t,v),g.show();break;case"company":i.text(e.i18n._("Please enter your company information below.")),this.title_1.text(e.i18n._("Company Information"));var T=m.find(".first-column");T.empty(),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"name",width:200}),this.addEditFieldToColumn(e.i18n._("Company Full Name"),t,T),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"short_name",width:200});var _=e("<div class='widget-h-box'></div>"),F=e("<span class='widget-right-label'> ( "+e.i18n._("ie")+": "+e.i18n._("America Online")+" = "+e.i18n._("AOL")+", "+e.i18n._("no spaces")+" )</span>");_.append(t),_.append(F),this.addEditFieldToColumn(e.i18n._("Company Short Name"),t,T,"",_,null,!0),t=Global.loadWidgetByName(FormItemType.COMBO_BOX),t.TComboBox({field:"industry_id"}),t.setSourceData(this.stepsDataDic[this.current_step].industry_options),this.addEditFieldToColumn(e.i18n._("Industry"),t,T),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"address1",width:200}),this.addEditFieldToColumn(e.i18n._("Address (Line 1)"),t,T),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"address2",width:200}),this.addEditFieldToColumn(e.i18n._("Address (Line 2)"),t,T),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"city",width:200}),this.addEditFieldToColumn(e.i18n._("City"),t,T),t=Global.loadWidgetByName(FormItemType.COMBO_BOX),t.TComboBox({field:"country"}),t.setSourceData(this.stepsDataDic[this.current_step].country_options),this.addEditFieldToColumn(e.i18n._("Country"),t,T),t=Global.loadWidgetByName(FormItemType.COMBO_BOX),t.TComboBox({field:"province"}),this.addEditFieldToColumn(e.i18n._("Province / State"),t,T),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"postal_code",width:200}),this.addEditFieldToColumn(e.i18n._("Postal / ZIP Code"),t,T),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"work_phone",width:200}),this.addEditFieldToColumn(e.i18n._("Phone"),t,T),m.show();break;case"systemSettings":i.text(e.i18n._("Please enter your site configuration information below. If you are unsure of the fields, we suggest that you use the default values.")),this.title_1.text(e.i18n._("System Settings"));var I=c.find(".first-column");I.empty();var _=e("<div class='widget-h-box'></div>"),D=Global.loadWidgetByName(FormItemType.TEXT);D.TText({field:"host_name"}),D.setValue("http://"+this.stepsDataDic[this.current_step].host_name),_.append(D);var P=Global.loadWidgetByName(FormItemType.TEXT_INPUT);P.TTextInput({field:"base_url",width:200}),_.append(P);var V=e("<span class='widget-right-label'>("+e.i18n._("No trailing slash")+")</span>");_.append(V),this.addEditFieldToColumn(e.i18n._("URL"),[D,P],I,"",_,null,!0),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"log_dir",width:400}),this.addEditFieldToColumn(e.i18n._("Log Directory"),t,I),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"storage_dir",width:400});var _=e("<div class='widget-h-box'></div>"),F=e("<span class='widget-right-label'> ("+e.i18n._("for things like attachments, logos, etc...")+")</span>");_.append(t),_.append(F),this.addEditFieldToColumn(e.i18n._("Storage Directory"),t,I,"",_,null,!0),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"cache_dir",width:400}),this.addEditFieldToColumn(e.i18n._("Cache Directory"),t,I),t=Global.loadWidgetByName(FormItemType.COMBO_BOX),t.TComboBox({field:"time_zone"}),t.setSourceData(n.time_zone_array),this.addEditFieldToColumn(e.i18n._("Server Time Zone"),t,I),c.show();break;case"databaseConfig":r.find(".step-tip").text(e.i18n._("Privileged Database User Name / Password. This is only used to create the database schema if the above user does not have permissions to do so."));var y="";y=y+e.i18n._("Please enter your database configuration information below. If you are unsure, use the default values."),i.html(y),this.title_1.text(e.i18n._("Database Configuration"));var x=r.find(".first-column");x.empty(),t=Global.loadWidgetByName(FormItemType.COMBO_BOX),t.TComboBox({field:"type"}),t.setSourceData(n.type_array),this.addEditFieldToColumn(e.i18n._("Database Type"),t,x),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"host",width:200}),this.addEditFieldToColumn(e.i18n._("Host Name"),t,x),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"database_name",width:200}),this.addEditFieldToColumn(e.i18n._("Database Name"),t,x),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"user",width:200}),this.addEditFieldToColumn(e.i18n._("Database User Name"),t,x),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"password",width:200}),this.addEditFieldToColumn(e.i18n._("Database Password"),t,x);var G=r.find(".second-column");G.empty(),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"priv_user",width:200});var _=e("<div class='widget-h-box'></div>"),F=e("<span class='widget-right-label'>( "+e.i18n._("ie: root, postgres")+" )</span>");_.append(t),_.append(F),this.addEditFieldToColumn(e.i18n._("Privileged Database User Name"),t,G,"",_),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"priv_password",width:200}),this.addEditFieldToColumn(e.i18n._("Privileged Database User Password"),t,G);var C=this.getRibbonButtonBox(),E=e('<li><button class="ribbon-sub-menu-icon" id="testConnection">'+e.i18n._("Test Connection")+"</button></li>"),n=this;E.unbind("click").bind("click",function(){n.onTestDatabaseConnectionClick(n,!0)}),C.children().eq(0).append(E),this.content_div.find(".content-handle-btn").html(C),r.show();break;case"databaseSchema":this.title_1.text(e.i18n._("Database Configuration")),d.upgrade?p.find(".s-label").text(e.i18n._("Upgrading database, please wait...")):p.find(".s-label").text(e.i18n._("Initializing database, please wait...")),i.empty(),p.show();break;case"postUpgrade":i.empty(),this.title_1.text(e.i18n._("Upgrade Complete")),s.html("<b>"+e.i18n._("Congratulations!")+"</b> "+e.i18n._("You have successfully upgraded")+" "+e.i18n._(d.application_name)+" "+e.i18n._("to")+" <b>"+d.application_version+"</b><br><br><b>"+e.i18n._("Note")+":</b> "+e.i18n._("In order to access new features you may need to re-apply the")+" <b>"+e.i18n._("Administrator")+"</b> "+e.i18n._("permission preset to each administrator employee in")+" "+e.i18n._(d.application_name)+"."),s.show();break;case"installDone":var O=window.location,M=O.protocol+"//"+O.host+O.pathname,A=M+"#!m=Login";i.empty(),this.title_1.text(e.i18n._("Done!")),d.upgrade==1?W.html("<b>"+e.i18n._("Congratulations!")+"</b> "+e.i18n._("You have successfully upgraded")+" "+e.i18n._(d.application_name)+"<br><br>"+e.i18n._("You may now")+' <a href="'+A+'">'+e.i18n._("sign in")+"</a> "+e.i18n._("with the user name/password that you created earlier.")):W.html("<b>"+e.i18n._("Congratulations!")+" </b> "+e.i18n._("You have successfully installed")+" "+e.i18n._(d.application_name)+"<br><br>"+e.i18n._("You may now")+' <a href="'+A+'">'+e.i18n._("sign in")+"</a> "+e.i18n._("with the user name/password that you created earlier.")),W.show();break;case"maintenanceJobs":i.empty(),this.title_1.text(e.i18n._("Maintenance Jobs"));var b=e.i18n._(d.application_name)+" <b>"+e.i18n._("requires")+"</b> "+e.i18n._("that maintenance jobs be run regularly throughout the day.")+'<br><p style="color: #ff0000"><b>'+e.i18n._("This is extremely important and without these maintenance jobs running")+" "+e.i18n._(d.application_name)+" "+e.i18n._("will fail to operate correctly.")+'</b></p><br><br><div style="background-color: #eee; width: 100%;"><br>';d.php_os=="WINNT"?b=b+e.i18n._("In Windows simply run this command as Administrator.")+"<br><br>"+d.schedule_maintenance_job_command:(b=b+e.i18n._("In most Linux distributions, you can run the following command"),d.is_sudo_installed==!1&&(b=b+ +" "+e.i18n._("as root")),b=b+":<br><b>",d.is_sudo_installed&&(b=b+"sudo"),b=b+" crontab -u "+d.web_server_user+" -e",b=b+"</b><br><br>"+e.i18n._("Then add the following line to the bottom of the file")+":<br><b>* * * * * php "+d.cron_file+" > /dev/null 2>&1</b><br><br></div>"),R.html(b),R.show();break}}onTestDatabaseConnectionClick(n,i){var l={};for(var a in n.stepsWidgetDic[n.current_step]){var r=n.stepsWidgetDic[n.current_step][a];l[a]=r.getValue()}ProgressBar.showOverlay();var p=n.api.testConnection(l,{async:!1});if(p&&p.isValid()){var s=p.getResult(),c="";if(s.test_connection!==null){if(s.test_connection===!0)return s.database_version===1?(c=c+'<p style="background-color: #ff0000">'+e.i18n._("Database version check")+" <b>"+e.i18n._("FAILED")+"</b>! "+e.i18n._("Please upgrade your database to meet the minimum version requirements and try again.")+"</p>",TAlertManager.showAlert(c),!1):(c=c+"<p>"+e.i18n._("Connection test to your database as a non-privileged user has")+" <b>"+e.i18n._("SUCCEEDED")+"</b>! "+e.i18n._("You may continue.")+"</p>",i&&TAlertManager.showAlert(c),!0);if(s.test_connection===!1)return c=c+'<p style="background-color: #ff0000">'+e.i18n._("Connection test to your database as a non-privileged user has")+" <b>"+e.i18n._("FAILED")+"</b>! "+e.i18n._("Please correct your settings and try again.")+"</p>",TAlertManager.showAlert(c),!1}s.test_priv_connection!==null&&s.test_priv_connection===!1&&(c=c+'<p style="background-color: #ff0000">'+e.i18n._("Connection test to your database as a privileged user has")+" <b>"+e.i18n._("FAILED")+"</b>! "+e.i18n._("Please correct the user name/password and try again.")+"</p>",TAlertManager.showAlert(c))}}onFormItemChange(n){var i=this.stepsWidgetDic[this.current_step],l=n.getField(),a=n.getValue();switch(l){case"country":this.api.getProvinceOptions(a,{onResult:function(r){r&&r.isValid()&&(i.province.setSourceData([]),i.province.setSourceData(r.getResult()))}});break}}onBackClick(){switch(this.saveCurrentStep(),this.current_step){case"license":break;case"requirements":this.current_step="license",this.initCurrentStep();break;case"databaseConfig":this.current_step="requirements",this.initCurrentStep();break;case"postUpgrade":case"systemSettings":this.current_step="databaseConfig",this.initCurrentStep();break;case"company":this.current_step="systemSettings",this.initCurrentStep();break;case"maintenanceJobs":case"installDone":this.current_step="user",this.initCurrentStep();break;case"user":this.current_step="company",this.initCurrentStep();break}}onNextClick(){var n,i=this;switch(this.saveCurrentStep(),this.current_step){case"license":this.current_step="requirements",this.initCurrentStep();break;case"requirements":this.external_installer==1?(this.current_step="databaseSchema",this.initCurrentStep()):(this.current_step="databaseConfig",this.initCurrentStep());break;case"databaseConfig":n={};for(var l in this.stepsWidgetDic[this.current_step]){var a=this.stepsWidgetDic[this.current_step][l];n[l]=a.getValue()}this.onTestDatabaseConnectionClick(this,!1)&&TAlertManager.showConfirmAlert(e.i18n._("Installing/Upgrading the TimeTrex database may take up to 10 minutes. Please do not stop the process in any way, including pressing STOP or BACK in your web browser, doing so may leave your database in an unusable state."),null,function(r){r&&i.api.createDatabase(n,{onResult:function(p){p&&p.isValid()&&(p.getResult().next_page?(i.current_step=p.getResult().next_page,i.initCurrentStep()):(i.stepsDataDic[i.current_step]=p.getResult(),i._initCurrentStep()))}})});break;case"postUpgrade":this.current_step="installDone",this.stepsDataDic[this.current_step]={upgrade:1},this.initCurrentStep();break;case"maintenanceJobs":this.current_step="installDone",this.initCurrentStep();break;case"systemSettings":n={};for(var l in this.stepsWidgetDic[this.current_step]){var a=this.stepsWidgetDic[this.current_step][l];n[l]=a.getValue()}this.api.setSystemSettings(n,this.external_installer,{onResult:function(r){r&&r.isValid()&&(i.current_step="company",i.initCurrentStep())}});break;case"company":n={},n.company_id=i.company_id;for(var l in this.stepsWidgetDic[this.current_step]){var a=this.stepsWidgetDic[this.current_step][l];n[l]=a.getValue()}this.api.setCompany(n,{onResult:function(r){if(r&&r.isValid()){var p=r.getResult();i.current_step="user",i.company_id=p,i.stepsDataDic[i.current_step]={company_id:p},i.initCurrentStep()}else i.setErrorTips(r)}});break;case"user":n={},n.user_id=this.user_id;for(var l in this.stepsWidgetDic[this.current_step]){var a=this.stepsWidgetDic[this.current_step][l];n[l]=a.getValue()}n=e.extend({},n,this.stepsDataDic[i.current_step]),this.api.setUser(n,this.external_installer,{onResult:function(r){if(r&&r.isValid()){var p=r.getResult().next_page;i.user_id=r.getResult().user_id,i.current_step=p,i.initCurrentStep()}else i.setErrorTips(r)}});break}}buildCurrentStepData(){var n=this,i=this.stepsDataDic[this.current_step],l=this.stepsWidgetDic[this.current_step];switch(this.current_step){case"systemSettings":case"databaseConfig":case"license":case"user":for(var a in l)i[a]&&l[a].setValue(i[a]);ProgressBar.closeOverlay();break;case"company":for(var a in l)i[a]&&l[a].setValue(i[a]);var r=l.country.getValue();this.api.getProvinceOptions(r,{onResult:function(m){m&&m.isValid()&&(l.province.setSourceData(m.getResult()),l.province.setValue(i.province)),ProgressBar.closeOverlay()}});break;case"requirements":for(var a in l){var p=e(this.edit_view_form_item_dic[a]);i[a]==0||p.show();var s=l[a];switch(s.removeClass("t-text"),s.removeClass("dataError"),s.removeClass("dataWarning"),s.addClass("custom-t-text"),a){case"timetrex_version":i[a].check_timetrex_version==0?s.html(e.i18n._("OK")+"(v"+i[a].current_timetrex_version+")"):i[a].check_timetrex_version==1?(s.html(e.i18n._("Unable to Check Latest Version")),s.addClass("dataWarning")):i[a].check_timetrex_version==2&&(s.html(e.i18n._("A Newer Version of TimeTrex is Available.")+' <a href="https://www.timetrex.com/download.php">'+e.i18n._("Download")+" v"+i[a].latest_timetrex_version+" "+e.i18n._("Now")+"</a>"),s.addClass("dataWarning"));break;case"php_version":i[a].check_php_version==0?s.html(e.i18n._("OK")+" (v"+i[a].php_version+")"):i[a].check_php_version==1?(s.html(e.i18n._("Invalid")+" (v"+i[a].php_version+")"),s.addClass("dataError")):i[a].check_php_version==2&&(s.html(e.i18n._("Unsupported")+" (v"+i[a].php_version+")"),s.addClass("dataWarning"));break;case"php_int_size":i[a]==0?s.html(e.i18n._("OK")):i[a]==1&&(s.html(e.i18n._("Invalid (Only 32-bit)")),s.addClass("dataError"));break;case"database_engine":i[a]==0?s.html(e.i18n._("OK")):(s.html(e.i18n._("Not Installed. (PGSQL extension must be enabled)")),s.addClass("dataError"));break;case"bcmath":i[a]==0?s.html(e.i18n._("OK")):i[a]==1&&(s.html(e.i18n._("Not Installed. (BCMATH extension must be enabled)")),s.addClass("dataError"));break;case"mbstring":i[a]==0?s.html(e.i18n._("OK")):i[a]==1&&(s.html(e.i18n._("Not Installed. (MBSTRING extension must be enabled)")),s.addClass("dataError"));break;case"gettext":i[a]==0?s.html(e.i18n._("OK")):i[a]==1&&(s.html(e.i18n._("Not Installed. (GETTEXT extension must be enabled)")),s.addClass("dataError"));break;case"intl":i[a]==0?s.html(e.i18n._("OK")):i[a]==1&&(s.html(e.i18n._("Not Installed. (INTL extension must be enabled)")),s.addClass("dataError"));break;case"soap":i[a]==0?s.html(e.i18n._("OK")):i[a]==1&&(s.html(e.i18n._("Not Installed. (SOAP extension must be enabled)")),s.addClass("dataError"));break;case"gd":i[a]==0?s.html(e.i18n._("OK")):i[a]==1&&(s.html(e.i18n._("Not Installed. (GD extension must be enabled)")),s.addClass("dataError"));break;case"json":i[a]==0?s.html(e.i18n._("OK")):i[a]==1&&(s.html(e.i18n._("Not Installed. (JSON extension must be enabled)")),s.addClass("dataError"));break;case"mcrypt":i[a]==0?s.html(e.i18n._("OK")):i[a]==1&&(s.html(e.i18n._("Not Installed. (MCRYPT extension must be enabled)")),s.addClass("dataError"));break;case"simplexml":i[a]==0?s.html(e.i18n._("OK")):i[a]==1&&(s.html(e.i18n._("Not Installed. (SimpleXML extension must be enabled)")),s.addClass("dataError"));break;case"curl":i[a]==0?s.html(e.i18n._("OK")):i[a]==1&&(s.html(e.i18n._("Not Installed. (CURL extension must be enabled)")),s.addClass("dataError"));break;case"zip":i[a]==0?s.html(e.i18n._("OK")):i[a]==1&&(s.html(e.i18n._("Not Installed. (ZIP extension must be enabled)")),s.addClass("dataError"));break;case"mail":i[a]==0?s.html(e.i18n._("OK")):i[a]==1&&(s.html(e.i18n._("Not Installed. (MAIL extension must be enabled)")),s.addClass("dataError"));break;case"openssl":i[a]==0?s.html(e.i18n._("OK")):i[a]==1&&(s.html(e.i18n._("Not Installed. (OpenSSL extension must be enabled)")),s.addClass("dataError"));break;case"pear":i[a]==0?s.html(e.i18n._("OK")):i[a]==1&&(i.php_os=="WINNT"?s.html(e.i18n._("Not Installed.")+"("+e.i18n._("try running")+': "<b>go-pear.bat</b>")'):s.html(e.i18n._("Not Installed.")+"("+e.i18n._("install the PEAR RPM or package from")+' <a href="http://pear.php.net">http://pear.php.net</a>)'),s.addClass("dataError"));break;case"safe_mode":i[a]==0?s.html(e.i18n._("OK")):i[a]==1&&(s.html(e.i18n._("Safe Mode is On. (Please disable it in php.ini)")),s.addClass("dataError"));break;case"allow_fopen_url":i[a]==0?s.html(e.i18n._("OK")):i[a]==1&&(s.html(e.i18n._("ALLOW_FOPEN_URL is Off. (Please enable it in php.ini)")),s.addClass("dataError"));break;case"disk_space":i[a]==0?s.html(e.i18n._("OK")):i[a]==1&&(s.html(e.i18n._("Not enough disk space available, please free up disk space and try again.")),s.addClass("dataError"));break;case"memory_limit":if(i[a].check_php_memory_limit==0){var c=e.i18n._("OK");i[a].memory_limit>0&&(c+="("+i[a].memory_limit+" bytes)"),s.html(c),p.hide()}else i[a].check_php_memory_limit==1&&(s.html(i[a].memory_limit+" bytes ("+e.i18n._("Set this to 512M or higher")+")"),s.addClass("dataError"));break;case"post_size":if(i[a].check_php_post_size==0){var c=e.i18n._("OK");i[a].post_size>0&&(c+="("+i[a].post_size+" bytes)"),s.html(c),p.hide()}else i[a].check_php_post_size==1&&(s.html(i[a].post_size+" bytes ("+e.i18n._("Set this to 25M or higher, recommend 128M")+")"),s.addClass("dataError"));break;case"upload_size":if(i[a].check_php_upload_size==0){var c=e.i18n._("OK");i[a].upload_size>0&&(c+="("+i[a].post_size+" bytes)"),s.html(c),p.hide()}else i[a].check_php_upload_size==1&&(s.html(i[a].upload_size+" bytes ("+e.i18n._("Set this to 25M or higher, recommend 128M")+")"),s.addClass("dataError"));break;case"disabled_functions":i[a].check_disabled_functions==0?(s.html(e.i18n._("OK")),p.hide()):i[a].check_disabled_functions==1&&(s.html(e.i18n._("Critical functions disabled")+": "+i[a].disabled_function_list+" ("+e.i18n._("Please enable them in php.ini")+")"),s.addClass("dataError"));break;case"base_url":i[a].check_base_url==0?(s.html(e.i18n._("OK")),p.hide()):(s.html(a+" "+e.i18n._("in")+" timetrex.ini.php "+e.i18n._("is incorrect, perhaps it should be")+" "+i[a].recommended_base_url+" "+e.i18n._("instead")),s.addClass("dataError"));break;case"base_dir":i[a].check_php_open_base_dir==0?(s.html(e.i18n._("OK")),p.hide()):(s.html(e.i18n._("PHP OPEN_BASEDIR setting")+" ("+i[a].php_open_base_dir+") "+e.i18n._("does not include directory of PHP CLI binary")+" ("+i[a].php_cli_directory+")"),s.addClass("dataError"));break;case"system_timezone":i[a]==0?s.html(e.i18n._("OK")):i[a]==1&&(s.html(e.i18n._("system_timezone in timetrex.ini.php is invalid!")),s.addClass("dataError"));break;case"cli_executable":i[a].check_php_cli_binary==0?(s.html(e.i18n._("OK")),p.hide()):(s.html(e.i18n._("PHP CLI")+" ("+i[a].php_cli+") "+e.i18n._("does not exist or is not executable.")),s.addClass("dataError"));break;case"cli_requirements":i[a].check_php_cli_requirements==0?(s.html(e.i18n._("OK")),p.hide()):(s.html(e.i18n._("PHP CLI requirements failed while executing")+":<br>"+i[a].php_cli_requirements_command+"<br>"+e.i18n._("Likely caused by having two PHP.INI files with different settings.")),s.addClass("dataError"));break;case"config_file":i[a]==0?s.html(e.i18n._("OK")):(s.html(e.i18n._("Not writable")),s.addClass("dataError"));break;case"cache_dir":i[a].check_writable_cache_directory==0?(s.html(e.i18n._("OK")),p.hide()):(s.html(e.i18n._("Not writable")+" ("+i[a].cache_dir+")"),s.addClass("dataError"));break;case"safe_cache_dir":i[a].check_safe_cache_directory==0?(s.html(e.i18n._("OK")),p.hide()):(s.html(e.i18n._("INSECURE, must not be a sub-directory of base path.")+" ("+i[a].base_path+")"),s.addClass("dataError"));break;case"storage_dir":i[a].check_writable_storage_directory==0?(s.html(e.i18n._("OK")),p.hide()):(s.html(e.i18n._("Not writable")+" ("+i[a].storage_path+")"),s.addClass("dataError"));break;case"safe_storage_dir":i[a].check_safe_storage_directory==0?(s.html(e.i18n._("OK")),p.hide()):(s.html(e.i18n._("INSECURE, must not be a sub-directory of base path.")+" ("+i[a].base_path+")"),s.addClass("dataError"));break;case"log_dir":i[a].check_writable_log_directory==0?(s.html(e.i18n._("OK")),p.hide()):(s.html(e.i18n._("Not writable")+" ("+i[a].log_path+")"),s.addClass("dataError"));break;case"safe_log_dir":i[a].check_safe_log_directory==0?(s.html(e.i18n._("OK")),p.hide()):(s.html(e.i18n._("INSECURE, must not be a sub-directory of base path.")+" ("+i[a].base_path+")"),s.addClass("dataError"));break;case"empty_cache_dir":i[a].check_clean_cache_directory==0?(s.html(e.i18n._("OK")),p.hide()):(s.html(e.i18n._("Please delete all files/directories in")+":  <b>"+i[a].cache_dir+"</b>"),s.addClass("dataError"));break;case"file_permission":i[a]==0?s.html(e.i18n._("OK")):(s.html(e.i18n._("File permissions are invalid, some")+" "+e.i18n._(i.application_name)+" "+e.i18n._("files are not readable/writable. See detailed error messages below.")),s.addClass("dataError"));break;case"file_checksums":i[a]==0?s.html(e.i18n._("OK")):(s.html(e.i18n._("File checksums do not match, some")+" "+e.i18n._(i.application_name)+" "+e.i18n._("files may be corrupted, missing, or not installed properly. See detailed error messages below.")),s.addClass("dataError"));break}}ProgressBar.closeOverlay();break;case"databaseSchema":this.api.setDatabaseSchema(this.external_installer,{onResult:function(m){if(m&&m.isValid()){var g=m.getResult();if(g.next_page)switch(n.current_step=g.next_page,g.next_page){case"postUpgrade":n.initCurrentStep();break;case"systemSettings":g.action?n.onNextClick():n.initCurrentStep();break}}}});break;default:ProgressBar.closeOverlay();break}}setErrorTips(n){this.clearErrorTips();var i=n.getDetails(),l=i[0];for(var a in l)l.hasOwnProperty(a)&&Global.isSet(this.stepsWidgetDic[this.current_step][a])&&(this.stepsWidgetDic[this.current_step][a].is(":visible")?this.stepsWidgetDic[this.current_step][a].setErrorStyle(l[a],!0):this.stepsWidgetDic[this.current_step][a].setErrorStyle(l[a]),this.edit_view_error_ui_dic[a]=this.stepsWidgetDic[this.current_step][a])}clearErrorTips(){for(var n in this.edit_view_error_ui_dic)!this.edit_view_error_ui_dic.hasOwnProperty(n)||!this.edit_view_error_ui_dic[n]||this.edit_view_error_ui_dic[n].clearErrorStyle();this.edit_view_error_ui_dic={}}onDoneClick(){this.cleanStepsData();var n=window.location,i=n.protocol+"//"+n.host+n.pathname;Global.setURLToBrowser(i+"#!m=Login"),e(this.el).remove()}onCloseClick(){this.script_name&&this.saveCurrentStep();var n=window.location,i=n.protocol+"//"+n.host+n.pathname;Global.setURLToBrowser(i+"#!m=Login"),e(this.el).remove()}cleanStepsData(){this.stepsDataDic={},this.current_step="license"}}export{Z as InstallWizardController};
//# sourceMappingURL=InstallWizardController-BU9EcMlA.bundle.js.map
