import{_ as l,j as i}from"./vendor-tTApdY0Y.bundle.js";import"./TImageBrowser-CvdFimWY.bundle.js";import"./TImageAdvBrowser-CQSTdPda.bundle.js";import"./main_ui-z76rxVqJ.entry.bundle.js";class h extends BaseViewController{constructor(o={}){l.defaults(o,{date_api:null,employeeActive:[]}),super(o)}init(o){this.viewId="About",this.script_name="AboutView",this.context_menu_name=i.i18n._("About"),this.api=TTAPI.APIAbout,this.date_api=TTAPI.APITTDate,this.render(),this.initData()}getCustomContextMenuModel(){var o={exclude:["default"],include:[{label:i.i18n._("Check For Updates"),id:"check_updates",vue_icon:"tticon tticon-refresh_black_24dp",group:"editor"},{label:"",id:"diagnostic_header",action_group:"diagnostic",menu_align:"right",action_group_header:!0,vue_icon:"tticon tticon-more_vert_black_24dp"},{label:i.i18n._("Diagnostics: Enable"),id:"diagnostics_enable",action_group:"diagnostic",menu_align:"right"},{label:i.i18n._("Diagnostics: Disable"),id:"diagnostics_disable",action_group:"diagnostic",menu_align:"right"},{label:i.i18n._("Diagnostics: Upload"),id:"diagnostics_upload",action_group:"diagnostic",menu_align:"right"},{label:i.i18n._("Diagnostics: Test Connection"),id:"diagnostics_test_connection",action_group:"diagnostic",menu_align:"right"}]};return o}setCustomEditMenuIcon(o,t){switch(o){case"diagnostics_enable":case"diagnostics_disable":case"diagnostics_upload":case"diagnostics_test_connection":this.setEditMenuDiagnosticIcon(t);break}}setEditMenuDiagnosticIcon(o){this.diagnosticPermissionValidate()===!0?ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,o.id,!0):ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,o.id,!1)}onCustomContextClick(o){switch(o){case"check_updates":this.onCheckClick();break;case"diagnostics_enable":this.onToggleDiagnosticClick(!0);break;case"diagnostics_disable":this.onToggleDiagnosticClick(!1);break;case"diagnostics_upload":this.onUploadDiagnosticClick();break;case"diagnostics_test_connection":this.onTestConnectionDiagnosticClick();break}}onCheckClick(){var o=this;this.api.isNewVersionAvailable({onResult:function(t){o.current_edit_record=t.getResult(),o.initEditView()}})}onToggleDiagnosticClick(o){this.api.setSystemDiagnostic(o,{onResult:function(t){var n="";o?n=i.i18n._("Diagnostic mode is now enabled."):n=i.i18n._("Diagnostic mode is now disabled."),TAlertManager.showAlert(n,i.i18n._("Diagnostics Mode"))}})}onUploadDiagnosticClick(){this.api.uploadSystemDiagnostic({onResult:function(o){}})}onTestConnectionDiagnosticClick(){this.api.testConnectionDiagnostic({onResult:function(o){var t="";o.getResult()===!0?t=i.i18n._("Connection test successful!"):(t=o.getResult(),t==""&&(t=o.getDescription())),TAlertManager.showAlert(t,i.i18n._("Diagnostics Connection Test"))}})}getAboutData(o){var t=this;t.api.getAboutData({onResult:function(n){var a=n.getResult();Global.isSet(a)&&o(a)}})}diagnosticPermissionValidate(){return!!(APIGlobal.pre_login_data.primary_company_id===LocalCacheData.getLoginUser().company_id&&PermissionManager.validate("user","edit"))}openEditView(){var o=this;o.edit_only_mode&&(this.buildContextMenu(),o.edit_view||o.initEditViewUI("About","AboutEditView.html"),o.getAboutData(function(t){o.current_edit_record=t,o.initEditView()}))}setUIWidgetFieldsToCurrentEditRecord(){}setCurrentEditRecordData(){Global.isSet(this.current_edit_record.license_data)||(this.current_edit_record.license_data={});for(var o in this.edit_view_form_item_dic)this.detachElement(o);for(var t in this.current_edit_record)if(this.current_edit_record.hasOwnProperty(t)){var n=this.edit_view_ui_dic[t];switch(t){case"new_version":if(this.current_edit_record[t]===!0){this.attachElement("notice");var a="<br><b>"+i.i18n._("NOTICE")+":</b> "+i.i18n._("There is a new version of")+" ";a+="<b>"+i.i18n._(this.current_edit_record.application_name)+"</b> "+i.i18n._("available")+".",a+="<br>"+i.i18n._("This version may contain tax table updates necessary for accurate payroll calculation, we recommend that you upgrade as soon as possible.")+"<br>",a+=""+i.i18n._("The latest version can be downloaded from")+": <a href='https://"+this.current_edit_record.organization_url+"/?upgrade=1' target='_blank'>",a+="<b>"+this.current_edit_record.organization_url+"</b></a><br><br>",i(this.edit_view_form_item_dic.notice.find(".tblDataWarning")).html(a)}break;case"registration_key":Global.isSet(n)&&(this.current_edit_record[t]===""||Global.isFalseOrNull(this.current_edit_record[t])?n.setValue(i.i18n._("N/A")):n.setValue(this.current_edit_record[t]));break;case"hardware_id":Global.isSet(n)&&(this.current_edit_record[t]===""||Global.isFalseOrNull(this.current_edit_record[t])?n.setValue(i.i18n._("N/A")):n.setValue(this.current_edit_record[t]));break;case"cron":Global.isSet(n)&&(this.current_edit_record[t].last_run_date!==""?n.setValue(this.current_edit_record[t].last_run_date):n.setValue(i.i18n._("Never")));break;case"license_data":if(Global.isSet(this.current_edit_record[t])){this.attachElement("license_info"),this.attachElement("license_browser");var e=i(this.edit_view_form_item_dic.license_info.find(".separated-box"));if(this.current_edit_record[t].message?(e.css({"font-weight":"bold","background-color":"red",height:"auto",color:"#000000"}),e.html(i.i18n._("License Information")+"<br>"+i.i18n._("WARNING")+": "+this.current_edit_record[t].message),i(e.find("span")).removeClass("label").css({"font-size":"normal","font-weight":"bold"})):e.html('<span class="label">'+i.i18n._("License Information")+"</span>"),this.current_edit_record[t].organization_name)for(var s in this.current_edit_record[t])switch(s){case"major_version":case"minor_version":this.attachElement("_version"),this.edit_view_ui_dic._version.setValue(this.current_edit_record[t].major_version+"."+this.current_edit_record[t].minor_version+".X");break;default:Global.isSet(this.edit_view_ui_dic[s])&&Global.isSet(this.edit_view_form_item_dic[s])&&(this.attachElement(s),this.edit_view_ui_dic[s].setValue(this.current_edit_record[t][s]));break}}break;case"user_counts":this.current_edit_record[t].length>0&&this.attachElement("user_active_inactive");break;case"schema_version_group_A":case"schema_version_group_B":case"schema_version_group_C":case"schema_version_group_D":Global.isSet(n)&&this.current_edit_record[t]&&n.setValue(this.current_edit_record[t]);break;default:Global.isSet(n)&&n.setValue(this.current_edit_record[t]);break}Global.isSet(n)&&this.current_edit_record[t]==!1&&n.parents(".edit-view-form-item-div").detach()}this.collectUIDataToCurrentEditRecord(),this.setEditViewDataDone()}setEditViewDataDone(){super.setEditViewDataDone(),this.setActiveEmployees()}setActiveEmployees(){if(this.employeeActive.length>0){for(var o in this.employeeActive){var t=this.employeeActive[o].getField();Global.isSet(this.edit_view_form_item_dic[t])&&this.edit_view_form_item_dic[t].remove()}this.employeeActive=[]}if(Global.isSet(this.current_edit_record.user_counts)&&this.current_edit_record.user_counts.length>0){var n=this.edit_view_tab.find("#tab_about"),a=n.find(".first-column");for(var e in this.current_edit_record.user_counts){var s=this.current_edit_record.user_counts[e],r=Global.loadWidgetByName(FormItemType.TEXT);r.TText({field:"active_"+e}),r.setValue(s.max_active_users+" / "+s.max_inactive_users),this.addEditFieldToColumn(i.i18n._(s.label),r,a,"",null,!0),this.employeeActive.push(r),this.edit_view_ui_dic["active_"+e].css("opacity",1)}this.editFieldResize(0)}}buildEditViewUI(){var o=this;super.buildEditViewUI();var t={tab_about:{label:i.i18n._("About")}};this.setTabModel(t);var n=this.edit_view_tab.find("#tab_about"),a=n.find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(a);var e=i("<div class='tblDataWarning'></div>");this.addEditFieldToColumn(null,e,a,"",null,!0,!1,"notice"),e=Global.loadWidgetByName(FormItemType.SEPARATED_BOX),e.SeparatedBox({label:i.i18n._("System Information")}),this.addEditFieldToColumn(null,e,a),e=Global.loadWidgetByName(FormItemType.TEXT),e.TText({field:"product_edition"}),this.addEditFieldToColumn(i.i18n._("Product Edition"),e,a),e=Global.loadWidgetByName(FormItemType.TEXT),e.TText({field:"system_version"}),this.addEditFieldToColumn(i.i18n._("Version"),e,a),e=Global.loadWidgetByName(FormItemType.TEXT),e.TText({field:"operating_system"}),this.addEditFieldToColumn(i.i18n._("Operating System"),e,a),e=Global.loadWidgetByName(FormItemType.TEXT),e.TText({field:"php_version"}),this.addEditFieldToColumn(i.i18n._("PHP Version"),e,a),e=Global.loadWidgetByName(FormItemType.TEXT),e.TText({field:"tax_engine_version"}),this.addEditFieldToColumn(i.i18n._("Tax Engine Version"),e,a),e=Global.loadWidgetByName(FormItemType.TEXT),e.TText({field:"tax_data_version"}),this.addEditFieldToColumn(i.i18n._("Tax Data Version"),e,a),e=Global.loadWidgetByName(FormItemType.TEXT),e.TText({field:"registration_key"}),this.addEditFieldToColumn(i.i18n._("Registration Key"),e,a),e=Global.loadWidgetByName(FormItemType.TEXT),e.TText({field:"hardware_id"}),this.addEditFieldToColumn(i.i18n._("Hardware ID"),e,a),e=Global.loadWidgetByName(FormItemType.TEXT),e.TText({field:"cron"}),this.addEditFieldToColumn(i.i18n._("Maintenance Jobs Last Ran"),e,a),e=Global.loadWidgetByName(FormItemType.SEPARATED_BOX),e.SeparatedBox({label:i.i18n._("License Information")}),this.addEditFieldToColumn(null,e,a,"",null,!0,!1,"license_info"),LocalCacheData.productEditionId>10&&APIGlobal.pre_login_data.primary_company_id==LocalCacheData.getCurrentCompany().id&&(e=Global.loadWidgetByName(FormItemType.IMAGE_BROWSER),this.file_browser=e.TImageBrowser({field:"license_browser",id:"license_browser",name:"file_data",accept_filter:"*",changeHandler:function(s){o.uploadLicense(this)}})),this.addEditFieldToColumn(i.i18n._("Upload License"),e,a,"",null,!0),e=Global.loadWidgetByName(FormItemType.TEXT),e.TText({field:"product_name"}),this.addEditFieldToColumn(i.i18n._("Product"),e,a,"",null,!0),e=Global.loadWidgetByName(FormItemType.TEXT),e.TText({field:"organization_name"}),this.addEditFieldToColumn(i.i18n._("Company"),e,a,"",null,!0),e=Global.loadWidgetByName(FormItemType.TEXT),e.TText({field:"_version"}),this.addEditFieldToColumn(i.i18n._("Version"),e,a,"",null,!0),e=Global.loadWidgetByName(FormItemType.TEXT),e.TText({field:"active_employee_licenses"}),this.addEditFieldToColumn(i.i18n._("Active Employee Licenses"),e,a,"",null,!0),e=Global.loadWidgetByName(FormItemType.TEXT),e.TText({field:"issue_date"}),this.addEditFieldToColumn(i.i18n._("Issue Date"),e,a,"",null,!0),e=Global.loadWidgetByName(FormItemType.TEXT),e.TText({field:"expire_date_display"}),this.addEditFieldToColumn(i.i18n._("Expire Date"),e,a,"",null,!0),e=Global.loadWidgetByName(FormItemType.SEPARATED_BOX),e.SeparatedBox({label:i.i18n._("Schema Version")}),this.addEditFieldToColumn(null,e,a),e=Global.loadWidgetByName(FormItemType.TEXT),e.TText({field:"schema_version_group_A"}),this.addEditFieldToColumn(i.i18n._("Group A"),e,a),e=Global.loadWidgetByName(FormItemType.TEXT),e.TText({field:"schema_version_group_B"}),this.addEditFieldToColumn(i.i18n._("Group B"),e,a),e=Global.loadWidgetByName(FormItemType.TEXT),e.TText({field:"schema_version_group_C"}),this.addEditFieldToColumn(i.i18n._("Group C"),e,a),e=Global.loadWidgetByName(FormItemType.TEXT),e.TText({field:"schema_version_group_D"}),this.addEditFieldToColumn(i.i18n._("Group D"),e,a),e=Global.loadWidgetByName(FormItemType.SEPARATED_BOX),e.SeparatedBox({label:i.i18n._("Employees (Active / InActive)")}),this.addEditFieldToColumn(null,e,a,"",null,!0,!1,"user_active_inactive")}uploadLicense(o){var t=this,n=this.edit_view_ui_dic.license_browser.getValue();t.api.uploadFile(n,"object_type=license&object_id=",{onResult:function(a){a=="TRUE"?(ProgressBar.showProgressBar(),window.setTimeout(function(){window.location.reload()},3e3)):(TAlertManager.showAlert(a),i("#file_browser").val(""))}})}}export{h as AboutViewController};
//# sourceMappingURL=AboutViewController-yjHQmFZp.bundle.js.map
