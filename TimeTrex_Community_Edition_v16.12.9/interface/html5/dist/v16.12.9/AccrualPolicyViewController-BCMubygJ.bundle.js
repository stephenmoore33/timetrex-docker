import{_ as h,j as l}from"./vendor-tTApdY0Y.bundle.js";class T extends BaseViewController{constructor(e={}){h.defaults(e,{el:"#accrual_policy_view_container",type_array:null,apply_frequency_array:null,month_of_year_array:null,day_of_month_array:null,day_of_week_array:null,month_of_quarter_array:null,length_of_service_unit_array:null,elgible_period_array:null,original_milestone_data:[],date_api:null,accrual_policy_milestone_api:null,accrual_policy_user_modifier_api:null,sub_accrual_policy_user_modifier_view_controller:null}),super(e)}init(e){this.edit_view_tpl="AccrualPolicyEditView.html",this.permission_id="accrual_policy",this.viewId="AccrualPolicy",this.script_name="AccrualPolicyView",this.table_name_key="accrual_policy",this.context_menu_name=l.i18n._("Accrual Policy"),this.navigation_label=l.i18n._("Accrual Policy"),this.api=TTAPI.APIAccrualPolicy,this.date_api=TTAPI.APITTDate,this.accrual_policy_milestone_api=TTAPI.APIAccrualPolicyMilestone,this.accrual_policy_user_modifier_api=TTAPI.APIAccrualPolicyUserModifier,this.month_of_quarter_array=Global.buildRecordArray({1:1,2:2,3:3}),this.render(),this.buildContextMenu(),this.initData()}onCustomContextClick(e){switch(e){case"re_calculate_accrual":this.onReCalAccrualClick();break}}onReCalAccrualClick(){var e={},a=this;this.edit_view?e.accrual_policy_id=[this.current_edit_record.id]:e.accrual_policy_id=this.getGridSelectIdArray(),IndexViewController.openWizard("ReCalculateAccrualWizard",e,function(){a.search()})}getCustomContextMenuModel(){var e={exclude:[],include:[{label:"",id:"other_header",menu_align:"right",action_group:"other",action_group_header:!0,vue_icon:"tticon tticon-more_vert_black_24dp"},{label:l.i18n._("ReCalculate Accrual"),id:"re_calculate_accrual",permission_result:!0,permission:null,menu_align:"right",action_group:"other"}]};return e}initOptions(){var e=this,a=[{option_name:"type",api:this.api},{option_name:"apply_frequency",api:this.api},{option_name:"eligible_period",api:this.api},{option_name:"length_of_service_unit",field_name:"length_of_service_unit_id",api:this.accrual_policy_milestone_api}];this.initDropDownOptions(a),this.date_api.getMonthOfYearArray({onResult:function(t){t=t.getResult(),e.month_of_year_array=t}}),this.date_api.getDayOfMonthArray({onResult:function(t){t=t.getResult(),e.day_of_month_array=t}}),this.date_api.getDayOfWeekArray({onResult:function(t){t=t.getResult(),e.day_of_week_array=t}})}setCustomDefaultMenuIcon(e,a,t){switch(e){case"re_calculate_accrual":this.setDefaultMenuReCalAccrualWizardIcon(a,t);break}}setCustomEditMenuIcon(e,a){switch(e){case"re_calculate_accrual":this.setEditMenuReCalAccrualWizardIcon(a);break}}setEditMenuReCalAccrualWizardIcon(e){PermissionManager.validate("accrual_policy","enabled")&&(PermissionManager.validate("accrual_policy","edit")||PermissionManager.validate("accrual_policy","edit_child")||PermissionManager.validate("accrual_policy","edit_own"))?ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),this.current_edit_record&&this.current_edit_record.id?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuReCalAccrualWizardIcon(e,a){PermissionManager.validate("accrual_policy","enabled")&&(PermissionManager.validate("accrual_policy","edit")||PermissionManager.validate("accrual_policy","edit_child")||PermissionManager.validate("accrual_policy","edit_own"))?ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),a>=1?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}buildEditViewUI(){super.buildEditViewUI();var e=this,a={tab_accrual_policy:{label:l.i18n._("Accrual Policy"),is_multi_column:!0},tab_eligibility:{label:l.i18n._("Eligibility")},tab_length_of_service_milestones:{label:l.i18n._("Length Of Service Milestones"),html_template:this.getAccrualPolicyLengthOfServiceMilestonesTabHtml()},tab_employee_settings:{label:l.i18n._("Employee Settings"),init_callback:"initSubAccrualPolicyUserModifier",display_on_mass_edit:!1,show_permission_div:!0},tab_audit:!0};this.setTabModel(a),this.navigation.AComboBox({api_class:TTAPI.APIAccrualPolicy,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_accrual",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation();var t=this.edit_view_tab.find("#tab_accrual_policy"),o=this.edit_view_tab.find("#tab_eligibility"),m=this.edit_view_tab.find("#tab_length_of_service_milestones"),r=t.find(".first-column"),d=o.find(".first-column"),n=m.find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(r);var i,_,u;i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"name",width:"100%"}),this.addEditFieldToColumn(l.i18n._("Name"),i,r,""),i.parent().width("45%"),i=Global.loadWidgetByName(FormItemType.TEXT_AREA),i.TTextArea({field:"description",width:"100%"}),this.addEditFieldToColumn(l.i18n._("Description"),i,r,"",null,null,!0),i.parent().width("45%"),i=Global.loadWidgetByName(FormItemType.COMBO_BOX),i.TComboBox({field:"type_id",set_empty:!1}),i.setSourceData(e.type_array),this.addEditFieldToColumn(l.i18n._("Type"),i,r),i=Global.loadWidgetByName(FormItemType.AWESOME_BOX),i.AComboBox({api_class:TTAPI.APIContributingShiftPolicy,allow_multiple_selection:!1,layout_name:"global_contributing_shift_policy",show_search_inputs:!0,set_empty:!0,set_default:!0,field:"contributing_shift_policy_id"}),this.addEditFieldToColumn(l.i18n._("Contributing Shift Policy"),i,r,"",null,!0),i=Global.loadWidgetByName(FormItemType.AWESOME_BOX),i.AComboBox({api_class:TTAPI.APIAccrualPolicyAccount,allow_multiple_selection:!1,layout_name:"global_accrual_policy_account",show_search_inputs:!0,set_empty:!0,set_default:!0,field:"accrual_policy_account_id"}),this.addEditFieldToColumn(l.i18n._("Accrual Account"),i,r),i=Global.loadWidgetByName(FormItemType.AWESOME_BOX),i.AComboBox({api_class:TTAPI.APIContributingPayCodePolicy,allow_multiple_selection:!1,layout_name:"global_contributing_pay_code_policy",show_search_inputs:!0,set_empty:!0,set_default:!0,field:"length_of_service_contributing_pay_code_policy_id"}),this.addEditFieldToColumn(l.i18n._("Length Of Service Hours Based On"),i,n,"",null,!0),i=Global.loadWidgetByName(FormItemType.SEPARATED_BOX),i.SeparatedBox({label:l.i18n._("Milestone Rollover Based On")}),this.addEditFieldToColumn(null,i,r,"",null,!0,!1,"separated_2"),i=Global.loadWidgetByName(FormItemType.CHECKBOX),i.TCheckbox({field:"milestone_rollover_hire_date"}),this.addEditFieldToColumn(l.i18n._("Employee's Hire Date"),i,r,"",null,!0),i=Global.loadWidgetByName(FormItemType.COMBO_BOX),i.TComboBox({field:"milestone_rollover_month"}),i.setSourceData(e.month_of_year_array),this.addEditFieldToColumn(l.i18n._("Month"),i,r,"",null,!0),i=Global.loadWidgetByName(FormItemType.COMBO_BOX),i.TComboBox({field:"milestone_rollover_day_of_month"}),i.setSourceData(e.day_of_month_array),this.addEditFieldToColumn(l.i18n._("Day of Month"),i,r,"",null,!0);var s=t.find(".second-column");if(this.edit_view_tabs[0].push(s),i=Global.loadWidgetByName(FormItemType.AWESOME_BOX),i.AComboBox({api_class:TTAPI.APIAccrualPolicyAccount,allow_multiple_selection:!1,layout_name:"global_accrual_policy_account",show_search_inputs:!0,set_empty:!0,set_default:!0,field:"excess_rollover_accrual_policy_account_id"}),this.addEditFieldToColumn(l.i18n._("Move Excess Rollover Time To"),i,r),i=Global.loadWidgetByName(FormItemType.SEPARATED_BOX),i.SeparatedBox({label:l.i18n._("Frequency In Which To Apply Time to Employee Records")}),this.addEditFieldToColumn(null,i,s,"",null,!0,!1,"separated_1"),i=Global.loadWidgetByName(FormItemType.COMBO_BOX),i.TComboBox({field:"apply_frequency_id",set_empty:!1}),i.setSourceData(e.apply_frequency_array),this.addEditFieldToColumn(l.i18n._("Frequency"),i,s,"",null,!0),i=Global.loadWidgetByName(FormItemType.CHECKBOX),i.TCheckbox({field:"apply_frequency_hire_date"}),this.addEditFieldToColumn(l.i18n._("Employee's Hire Date"),i,s,"",null,!0),i=Global.loadWidgetByName(FormItemType.COMBO_BOX),i.TComboBox({field:"apply_frequency_month"}),i.setSourceData(e.month_of_year_array),this.addEditFieldToColumn(l.i18n._("Month"),i,s,"",null,!0),i=Global.loadWidgetByName(FormItemType.COMBO_BOX),i.TComboBox({field:"apply_frequency_day_of_month"}),i.setSourceData(e.day_of_month_array),this.addEditFieldToColumn(l.i18n._("Day of Month"),i,s,"",null,!0),i=Global.loadWidgetByName(FormItemType.COMBO_BOX),i.TComboBox({field:"apply_frequency_day_of_week"}),i.setSourceData(l.extend({},e.day_of_week_array)),this.addEditFieldToColumn(l.i18n._("Day Of Week"),i,s,"",null,!0),i=Global.loadWidgetByName(FormItemType.COMBO_BOX),i.TComboBox({field:"apply_frequency_quarter_month",set_empty:!1}),i.setSourceData(e.month_of_quarter_array),this.addEditFieldToColumn(l.i18n._("Month of Quarter"),i,s,"",null,!0),i=Global.loadWidgetByName(FormItemType.CHECKBOX),i.TCheckbox({field:"enable_opening_balance"}),_=l("<div class='widget-h-box'></div>"),u=l("<span class='widget-right-label'> "+l.i18n._("(Applies Initial Accrual Amount on Hire Date)")+"</span>"),_.append(i),_.append(u),this.addEditFieldToColumn(l.i18n._("Enable Opening Balance"),i,s,"",_,!0),i=Global.loadWidgetByName(FormItemType.CHECKBOX),i.TCheckbox({field:"enable_pro_rate_initial_period"}),_=l("<div class='widget-h-box'></div>"),u=l("<span class='widget-right-label'> "+l.i18n._("(Based on Hire Date)")+"</span>"),_.append(i),_.append(u),this.addEditFieldToColumn(l.i18n._("Prorate Initial Accrual Amount"),i,s,"",_,!0),this.edit_view_tabs[1]=[],this.edit_view_tabs[1].push(d),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"minimum_employed_days",width:30}),this.addEditFieldToColumn(l.i18n._("After Minimum Employed Days"),i,d,"",null,!0),Global.getProductEdition()>=15){i=Global.loadWidgetByName(FormItemType.COMBO_BOX),i.TComboBox({field:"eligible_period_id",set_empty:!1}),i.setSourceData(e.eligible_period_array),this.addEditFieldToColumn(l.i18n._("Eligibility Period"),i,d),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"minimum_eligible_time",mode:"time_unit",need_parser_sec:!0}),_=l("<div class='widget-h-box'></div>");var c=Global.loadWidgetByName(FormItemType.CHECKBOX);c.TCheckbox({field:"minimum_eligible_apply_retroactive"});var u=l("<span class='widget-right-label'>"+l.i18n._("Apply Retroactively")+"</span>");_.append(i),_.append(u),_.append(c),this.addEditFieldToColumn(l.i18n._("After Minimum Time"),[i,c],d,"",_,!0),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"maximum_eligible_time",mode:"time_unit",need_parser_sec:!0}),this.addEditFieldToColumn(l.i18n._("Before Maximum Time"),i,d,"",null,!0),i=Global.loadWidgetByName(FormItemType.AWESOME_BOX),i.AComboBox({api_class:TTAPI.APIContributingShiftPolicy,allow_multiple_selection:!1,layout_name:"global_contributing_shift_policy",show_search_inputs:!0,set_empty:!0,set_default:!0,field:"eligible_contributing_shift_policy_id"}),this.addEditFieldToColumn(l.i18n._("Contributing Shift Policy"),i,d,"",null,!0)}var m=this.edit_view_tab.find("#tab_length_of_service_milestones"),p=m.find(".inside-editor-div"),y={length_of_service:l.i18n._("Length Of Service"),accrual_rate:l.i18n._("Accrual Rate/Year"),accrual_total_maximum:l.i18n._("Accrual Maximum Balance"),annual_maximum_rollover:l.i18n._("Annual Maximum Rollover"),annual_maximum_time:l.i18n._("Annual Accrual Maximum")};this.editor=Global.loadWidgetByName(FormItemType.INSIDE_EDITOR),this.editor.InsideEditor({addRow:this.insideEditorAddRow,removeRow:this.insideEditorRemoveRow,getValue:this.insideEditorGetValue,setValue:this.insideEditorSetValue,render:f(),render_args:y,render_inline_html:!0,row_render:g(),parent_controller:this});function f(){return`
			<table class="inside-editor-render">
				<tr class="title">
					<td style="width: 200px"><%= length_of_service %></td>
					<td style="width: 200px"><%= accrual_rate %></td>
					<td class="annual-maximum-time-td" style="width: 200px"><%= annual_maximum_time %></td>
					<td style="width: 200px"><%= accrual_total_maximum %></td>
					<td style="width: 200px"><%= annual_maximum_rollover %></td>
					<td style="width: 25px"></td>
					<td style="width: 25px"></td>
				</tr>
			</table>`}function g(){return`
			<tr class="inside-editor-row data-row">
				<td class="length_of_service cell"></td>
				<td class="accrual_rate cell"></td>
				<td class="annual_maximum_time annual-maximum-time-td cell"></td>
				<td class="accrual_total_maximum cell"></td>
				<td class="annual_maximum_rollover cell"></td>
				<td class="cell control-icon">
					<button class="plus-icon" onclick=""></button>
				</td>
				<td class="cell control-icon">
					<button class="minus-icon " onclick=""></button>
				</td>
			</tr>`}p.append(this.editor)}onMilestoneRolloverHireDate(){this.current_edit_record.milestone_rollover_hire_date===!0?(this.detachElement("milestone_rollover_month"),this.detachElement("milestone_rollover_day_of_month")):this.current_edit_record.milestone_rollover_hire_date===!1&&(this.attachElement("milestone_rollover_month"),this.attachElement("milestone_rollover_day_of_month")),this.editFieldResize()}onApplyFrequencyHireDate(){this.current_edit_record.apply_frequency_id==20&&(this.attachElement("apply_frequency_hire_date"),this.current_edit_record.apply_frequency_hire_date===!0?(this.detachElement("apply_frequency_month"),this.detachElement("apply_frequency_day_of_month")):(this.attachElement("apply_frequency_month"),this.attachElement("apply_frequency_day_of_month")),this.editFieldResize())}onApplyFrequencyChange(e){Global.isSet(e)||(Global.isSet(this.current_edit_record.apply_frequency_id)||(this.current_edit_record.apply_frequency_id=10),e=this.current_edit_record.apply_frequency_id),this.detachElement("apply_frequency_hire_date"),this.detachElement("apply_frequency_month"),this.detachElement("apply_frequency_day_of_month"),this.detachElement("apply_frequency_day_of_week"),this.detachElement("apply_frequency_quarter_month"),e==20?this.onApplyFrequencyHireDate():e==30?this.attachElement("apply_frequency_day_of_month"):e==40?this.attachElement("apply_frequency_day_of_week"):e==25&&(this.attachElement("apply_frequency_day_of_month"),this.attachElement("apply_frequency_quarter_month")),this.edit_view_ui_dic.type_id.getValue()==20&&this.edit_view_ui_dic.eligible_period_id&&this.edit_view_ui_dic.eligible_period_id.getValue()!=0&&this.edit_view_ui_dic.eligible_period_id.setValue(e),this.editFieldResize()}onContributingShiftPolicyChange(){this.edit_view_ui_dic.contributing_shift_policy_id&&this.edit_view_ui_dic.eligible_contributing_shift_policy_id&&(this.current_edit_record.eligible_contributing_shift_policy_id=this.edit_view_ui_dic.contributing_shift_policy_id.getValue(),this.edit_view_ui_dic.eligible_contributing_shift_policy_id.setValue(this.edit_view_ui_dic.contributing_shift_policy_id.getValue()))}onTypeChange(){Global.isSet(this.current_edit_record.type_id)||(this.current_edit_record.type_id=20),this.current_edit_record.type_id==20?(this.is_mass_editing||(l(this.edit_view_tab.find("ul li")[1]).show(),l(this.edit_view_tab.find("ul li")[2]).show()),this.edit_view_tab.find("#tab_accrual_policy").find(".second-column").css("display","block"),this.edit_view_tab.find("#tab_accrual_policy").find(".first-column").removeClass("full-width-column"),this.attachElement("separated_1"),this.attachElement("apply_frequency_id"),this.attachElement("minimum_employed_days"),this.detachElement("contributing_shift_policy_id"),this.attachElement("enable_opening_balance"),this.attachElement("enable_pro_rate_initial_period"),this.onApplyFrequencyChange(),this.onApplyFrequencyHireDate()):this.current_edit_record.type_id==30&&(this.is_mass_editing||(l(this.edit_view_tab.find("ul li")[1]).show(),l(this.edit_view_tab.find("ul li")[2]).show()),this.edit_view_tab.find("#tab_accrual_policy").find(".second-column").css("display","none"),this.edit_view_tab.find("#tab_accrual_policy").find(".first-column").removeClass("full-width-column"),this.attachElement("contributing_shift_policy_id"),this.attachElement("separated_1"),this.attachElement("minimum_employed_days"),this.detachElement("enable_opening_balance"),this.detachElement("enable_pro_rate_initial_period"),this.detachElement("apply_frequency_id"),this.onApplyFrequencyChange(!1)),this.editFieldResize(),this.setAccrualRateFormat()}onEligiblePeriodChange(){Global.isSet(this.current_edit_record.eligible_period_id)||(this.current_edit_record.eligible_period_id=0),this.current_edit_record.eligible_period_id==0?(this.detachElement("minimum_eligible_time"),this.detachElement("minimum_eligible_apply_retroactive"),this.detachElement("maximum_eligible_time"),this.detachElement("eligible_contributing_shift_policy_id")):(this.attachElement("minimum_eligible_time"),this.attachElement("minimum_eligible_apply_retroactive"),this.attachElement("maximum_eligible_time"),this.attachElement("eligible_contributing_shift_policy_id")),this.editFieldResize()}setAccrualRateFormat(e){for(var a=this.editor.rows_widgets_array.length,t=0;t<a;t++){var o=this.editor.rows_widgets_array[t];this.current_edit_record.type_id==30?(o.accrual_rate_hourly.show(),o.accrual_rate_yearly.hide()):(o.accrual_rate_yearly.show(),o.accrual_rate_hourly.hide())}var r=l(".inside-editor-render").children().eq(0).children().eq(0).children().eq(1);this.current_edit_record.type_id==30?(r.text(l.i18n._("Accrual Rate/Hour")),l(".annual-maximum-time-td").show()):(r.text(l.i18n._("Accrual Rate/Year")),l(".annual-maximum-time-td").hide())}onFormItemChange(e,a){this.setIsChanged(e),this.setMassEditingFieldsWhenFormChange(e);var t=e.getField(),o=e.getValue();this.current_edit_record[t]=o,t==="type_id"&&this.onTypeChange(),t==="apply_frequency_id"&&this.onApplyFrequencyChange(),t==="apply_frequency_hire_date"&&this.onApplyFrequencyHireDate(),t==="milestone_rollover_hire_date"&&this.onMilestoneRolloverHireDate(),t==="eligible_period_id"&&this.onEligiblePeriodChange(),t==="contributing_shift_policy_id"&&this.onContributingShiftPolicyChange(),a||this.validate()}isDisplayLengthOfServiceHoursBasedOn(){for(var e=this.editor.rows_widgets_array.length,a=0,t=0;t<e;t++){var o=this.editor.rows_widgets_array[t];o.length_of_service_unit_id.getValue()==50&&a++}a===0?(this.detachElement("length_of_service_contributing_pay_code_policy_id"),this.edit_view_tab.find("#tab_length_of_service_milestones").find(".first-column").css("border","none")):(this.attachElement("length_of_service_contributing_pay_code_policy_id"),this.edit_view_tab.find("#tab_length_of_service_milestones").find(".first-column").css("border","1px solid #c7c7c7"))}insideEditorSetValue(e){e.length,this.removeAllRows();for(var a=0;a<e.length;a++)if(Global.isSet(e[a])){var t=e[a];Global.isSet(this.parent_id)&&(t.id=""),this.addRow(t)}}insideEditorAddRow(e,a){e||(e={});var t=e.id&&this.parent_controller.current_edit_record.id?e.id:TTUUID.generateUUID(),o=this,r=this.getRowRender(),d=this.getRender(),n={},i,_;_=l("<div class='widget-h-box'></div>");var u=l("<span class='widget-right-label'> "+l.i18n._("After")+":  </span>"),s=l("<span class='widget-right-label'>&nbsp;</span>");i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"length_of_service",width:30}),i.setValue(e.length_of_service?e.length_of_service:0),i.attr("milestone_id",t),this.setWidgetEnableBaseOnParentController(i);var c=Global.loadWidgetByName(FormItemType.COMBO_BOX);c.TComboBox({field:"length_of_service_unit_id"}),c.setSourceData(this.parent_controller.length_of_service_unit_array),c.setValue(e.length_of_service_unit_id?e.length_of_service_unit_id:10),c.bind("formItemChange",function(m,p){o.parent_controller.isDisplayLengthOfServiceHoursBasedOn()}),this.setWidgetEnableBaseOnParentController(i),this.setWidgetEnableBaseOnParentController(c),_.append(u),_.append(i),_.append(s),_.append(c),n[i.getField()]=i,n[c.getField()]=c,r.children().eq(0).append(_),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),_=l("<div class='widget-h-box'></div>"),i.TTextInput({field:"accrual_rate_hourly",width:90,need_parser_sec:!1}),i.setPlaceHolder(""),i.setValue(e.accrual_rate?e.accrual_rate:"0.000"),_.append(i),n[i.getField()]=i,r.children().eq(1).append(_),this.setWidgetEnableBaseOnParentController(i),_=l("<div class='widget-h-box'></div>"),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"accrual_rate_yearly",width:90,mode:"time_unit",need_parser_sec:!0}),i.setValue(e.accrual_rate?e.accrual_rate:"0"),_.append(i),n[i.getField()]=i,r.children().eq(1).append(_),this.setWidgetEnableBaseOnParentController(i),e.type_id==30?(n.accrual_rate_hourly.show(),n.accrual_rate_yearly.hide()):(n.accrual_rate_yearly.show(),n.accrual_rate_hourly.hide()),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"annual_maximum_time",width:90,mode:"time_unit",need_parser_sec:!0}),i.setValue(e.annual_maximum_time?e.annual_maximum_time:"0"),n[i.getField()]=i,r.children().eq(2).append(i),this.setWidgetEnableBaseOnParentController(i),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"maximum_time",width:90,mode:"time_unit",need_parser_sec:!0}),i.setValue(e.maximum_time?e.maximum_time:"0"),n[i.getField()]=i,r.children().eq(3).append(i),this.setWidgetEnableBaseOnParentController(i),i=Global.loadWidgetByName(FormItemType.TEXT_INPUT),i.TTextInput({field:"rollover_time",width:90,mode:"time_unit",need_parser_sec:!0}),i.setValue(e.rollover_time?e.rollover_time:"0"),n[i.getField()]=i,r.children().eq(4).append(i),this.setWidgetEnableBaseOnParentController(i),typeof a<"u"?(r.insertAfter(l(d).find("tr").eq(a)),this.rows_widgets_array.splice(a,0,n)):(l(d).append(r),this.rows_widgets_array.push(n)),this.parent_controller.is_viewing&&r.find(".control-icon").hide(),this.addIconsEvent(r),this.removeLastRowLine(),this.parent_controller.setAccrualRateFormat()}insideEditorRemoveRow(e){var a=e[0].rowIndex-1,t=this.rows_widgets_array[a].length_of_service.attr("milestone_id");t&&TTUUID.isUUID(t)&&t!=TTUUID.not_exist_id&&t!=TTUUID.zero_id&&this.delete_ids.push(t),e.remove(),this.rows_widgets_array.splice(a,1),this.removeLastRowLine(),this.parent_controller.isDisplayLengthOfServiceHoursBasedOn()}insideEditorGetValue(e){for(var a=this.rows_widgets_array.length,t=[],o=0;o<a;o++){var r=this.rows_widgets_array[o],d=0;this.parent_controller.current_edit_record.type_id==30?d=r.accrual_rate_hourly.getValue():d=r.accrual_rate_yearly.getValue();var n={length_of_service:r.length_of_service.getValue(),length_of_service_unit_id:r.length_of_service_unit_id.getValue(),accrual_rate:d,maximum_time:r.maximum_time.getValue(),rollover_time:r.rollover_time.getValue()};this.parent_controller.current_edit_record.type_id==30&&(n.annual_maximum_time=r.annual_maximum_time.getValue()),n.id=r.length_of_service.attr("milestone_id"),n.accrual_policy_id=e,t.push(n)}return t}setEditViewDataDone(){super.setEditViewDataDone(),this.onApplyFrequencyChange(),this.onTypeChange(),this.onMilestoneRolloverHireDate(),this.onEligiblePeriodChange(),this.initInsideEditorData()}initInsideEditorData(){var e=this,a={};a.filter_data={},this.mass_edit||(!this.current_edit_record||!this.current_edit_record.id)&&!this.copied_record_id?(e.editor.removeAllRows(),e.editor.addRow(),e.isDisplayLengthOfServiceHoursBasedOn(),e.original_milestone_data=[]):(a.filter_data.accrual_policy_id=this.current_edit_record.id?this.current_edit_record.id:this.copied_record_id,this.copied_record_id="",this.accrual_policy_milestone_api.getAccrualPolicyMilestone(a,!0,{onResult:function(t){if(e.edit_view){var o=t.getResult();o===!0?(e.original_milestone_data=[],e.editor.addRow()):o.length>0&&(e.original_milestone_data=h.map(o,h.clone),e.editor.setValue(o)),e.isDisplayLengthOfServiceHoursBasedOn()}}}))}saveInsideEditorData(e,a){var t=this,o=this.editor.getValue(this.refresh_id),r=t.editor.delete_ids;r.length>0&&t.accrual_policy_milestone_api.deleteAccrualPolicyMilestone(r,{onResult:function(n){n&&n.isValid()&&(t.editor.delete_ids=[])}});let d=this.getChangedRecords(o,this.original_milestone_data,[]);Array.isArray(d)&&d.length>0?t.accrual_policy_milestone_api.setAccrualPolicyMilestone(d,{onResult:function(n){n.getResult(),Global.isSet(e)&&e()}}):Global.isSet(e)&&e()}onSaveResult(e){if(e&&e.isValid()){var a=e.getResult();if(a===!0?this.refresh_id=this.current_edit_record.id:a&&TTUUID.isUUID(a)&&a!=TTUUID.not_exist_id&&a!=TTUUID.zero_id&&(this.refresh_id=a),this.is_mass_editing==!1){var t=this;t.saveInsideEditorData(function(){t.search(),t.onSaveDone(e),t.removeEditView()})}else this.search(),this.onSaveDone(e),this.removeEditView()}else this.setErrorTips(e),this.setErrorMenu()}removeEditView(){super.removeEditView(),this.sub_accrual_policy_user_modifier_view_controller=null}onSaveAndCopyResult(e){var a=this;if(e&&e.isValid()){var t=e.getResult();t===!0?a.refresh_id=a.current_edit_record.id:t&&TTUUID.isUUID(t)&&t!=TTUUID.not_exist_id&&t!=TTUUID.zero_id&&(a.refresh_id=t),a.saveInsideEditorData(function(){a.search(!1),a.onCopyAsNewClick()})}else a.setErrorTips(e),a.setErrorMenu()}_continueDoCopyAsNew(){if(LocalCacheData.current_doing_context_action="copy_as_new",this.is_add=!0,Global.isSet(this.edit_view))for(var e=0;e<this.editor.rows_widgets_array.length;e++)this.editor.rows_widgets_array[e].length_of_service.attr("milestone_id","");super._continueDoCopyAsNew()}onCopyAsNewResult(e){var a=this,t=e.getResult();if(!t){TAlertManager.showAlert(l.i18n._("Record does not exist")),a.onCancelClick();return}a.openEditView(),t=t[0],this.copied_record_id=t.id,t.id="",a.sub_view_mode&&a.parent_key&&(t[a.parent_key]=a.parent_value),a.current_edit_record=t,a.initEditView()}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:l.i18n._("Name"),in_column:1,field:"name",multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:l.i18n._("Type"),in_column:1,field:"type_id",multiple:!0,basic_search:!0,adv_search:!1,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:l.i18n._("Created By"),in_column:2,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:l.i18n._("Updated By"),in_column:2,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX})]}initSubAccrualPolicyUserModifier(){var e=this;if(Global.getProductEdition()<=10?(this.edit_view_tab.find("#tab_employee_settings").find(".first-column-sub-view").css("display","none"),this.edit_view.find(".save-and-continue-div").css("display","none"),this.edit_view.find(".permission-defined-div").css("display","block"),this.edit_view.find(".permission-message").html(Global.getUpgradeMessage())):(this.edit_view_tab.find("#tab_employee_settings").find(".first-column-sub-view").css("display","block"),this.edit_view.find(".permission-defined-div").css("display","none")),!this.current_edit_record.id){TTPromise.resolve("BaseViewController","onTabShow");return}if(this.sub_accrual_policy_user_modifier_view_controller){this.sub_accrual_policy_user_modifier_view_controller.buildContextMenu(!0),this.sub_accrual_policy_user_modifier_view_controller.setDefaultMenu(),e.sub_accrual_policy_user_modifier_view_controller.parent_key="accrual_policy_id",e.sub_accrual_policy_user_modifier_view_controller.parent_value=e.current_edit_record.id,e.sub_accrual_policy_user_modifier_view_controller.parent_edit_record=e.current_edit_record,e.sub_accrual_policy_user_modifier_view_controller.initData();return}Global.getProductEdition()>=15&&Global.loadScript("views/policy/accrual_policy/AccrualPolicyUserModifierViewController.js",function(){var o=e.edit_view_tab.find("#tab_employee_settings"),r=o.find(".first-column-sub-view");Global.trackView("SubAccrualPolicyUserModifierView"),AccrualPolicyUserModifierViewController.loadSubView(r,a,t)});function a(o){var r={parent_view:"accrual_policy"};return{template:h.template(o),args:r}}function t(o){e.sub_accrual_policy_user_modifier_view_controller=o,e.sub_accrual_policy_user_modifier_view_controller.parent_key="accrual_policy_id",e.sub_accrual_policy_user_modifier_view_controller.parent_value=e.current_edit_record.id,e.sub_accrual_policy_user_modifier_view_controller.parent_edit_record=e.current_edit_record,e.sub_accrual_policy_user_modifier_view_controller.parent_view_controller=e,TTPromise.wait("BaseViewController","initialize",function(){e.sub_accrual_policy_user_modifier_view_controller.initData()})}}getAccrualPolicyLengthOfServiceMilestonesTabHtml(){return`<div id="tab_length_of_service_milestones" class="edit-view-tab-outside">
					<div class="edit-view-tab" id="tab_length_of_service_milestones_content_div">
						<div class="first-column full-width-column"></div>
						<div class="inside-editor-div full-width-column">
						</div>
					</div>
				</div>`}}export{T as AccrualPolicyViewController};
//# sourceMappingURL=AccrualPolicyViewController-BCMubygJ.bundle.js.map
