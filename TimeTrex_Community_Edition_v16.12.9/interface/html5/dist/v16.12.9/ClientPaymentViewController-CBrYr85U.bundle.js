import{_,j as i}from"./vendor-tTApdY0Y.bundle.js";import"./TImage-D3G3HRb1.bundle.js";import"./TImageAdvBrowser-CQSTdPda.bundle.js";class s extends BaseViewController{constructor(t={}){_.defaults(t,{el:"#client_payment_view_container",status_array:null,type_array:null,credit_card_type_array:null,sub_document_view_controller:null,bank_account_type_array:null,document_object_type_id:null,file_browser:null}),super(t)}init(t){this.edit_view_tpl="ClientPaymentEditView.html",this.permission_id="client_payment",this.viewId="ClientPayment",this.script_name="ClientPaymentView",this.table_name_key="client_payment",this.document_object_type_id=90,this.context_menu_name=i.i18n._("Payment Methods"),this.navigation_label=i.i18n._("Payment Methods"),this.api=TTAPI.APIClientPayment,this.render(),this.buildContextMenu(),this.sub_view_mode||this.initData()}initOptions(){var t=this,n=[{option_name:"status",api:this.api},{option_name:"type",api:this.api},{option_name:"bank_account_type",api:this.api},{option_name:"credit_card_type",field_name:"cc_type_id",api:this.api}];this.initDropDownOptions(n),Global.isSet(t.adv_search_field_ui_dic.is_default)&&this.basic_search_field_ui_dic.is_default.setSourceData(Global.buildRecordArray({0:"False",1:"True"}))}getCustomContextMenuModel(){var t={exclude:[],include:["default"]};return this.sub_view_mode||t.include.push({label:i.i18n._("Jump To"),id:"jump_to_header",menu_align:"right",action_group:"jump_to",action_group_header:!0,permission_result:!1},{label:i.i18n._("Edit Client"),id:"edit_client",menu_align:"right",action_group:"jump_to",group:"navigation"},{label:i.i18n._("Client Contacts"),id:"client_contact",menu_align:"right",action_group:"jump_to",group:"navigation"},{label:i.i18n._("Transactions"),id:"transaction",menu_align:"right",action_group:"jump_to",group:"navigation"},{label:i.i18n._("Invoices"),id:"invoice",menu_align:"right",action_group:"jump_to",group:"navigation"}),t}setCurrentEditRecordData(){this.setDefaultData({type_id:30,bank_account_type_id:200});for(var t in this.current_edit_record)if(this.current_edit_record.hasOwnProperty(t)){var n=this.edit_view_ui_dic[t];Global.isSet(n)&&n.setValue(this.current_edit_record[t])}if(this.current_edit_record.signature_exists&&this.current_edit_record.id&&this.current_edit_record.client_id){var l=ServiceCaller.getURLByObjectType("file_download")+"&object_type=client_payment_signature&object_id="+this.current_edit_record.id+"&parent_id="+this.current_edit_record.client_id;this.file_browser.setImage(l)}else this.detachElement("signature");this.collectUIDataToCurrentEditRecord(),this.setEditViewDataDone()}setCustomDefaultMenuIcon(t,n,l){switch(t){case"login":this.setDefaultMenuLoginIcon(n,l);break;case"edit_client":this.setDefaultMenuEditClientIcon(n,l);break}}setDefaultMenuEditClientIcon(t,n,l){n===1?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,t.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,t.id,!1)}onCustomContextClick(t){switch(t){case"download":this.onDownloadClick();break;case"edit_client":case"client_contact":case"invoice":case"transaction":case"export_excel":this.onNavigationClick(t);break}}getFilterColumnsFromDisplayColumns(){var t={};t.is_owner=!0,t.id=!0,t.is_child=!0,t.in_use=!0,t.first_name=!0,t.last_name=!0,t.client_id=!0;var n=[];if(this.grid&&(n=this.grid.getGridParam("colModel")),n)for(var l=n.length,a=0;a<l;a++){var e=n[a];t[e.name]=!0}return t}onNavigationClick(t){var n=this,l,a={filter_data:{}},e=[];switch(n.edit_view&&n.current_edit_record.id?e.push(n.current_edit_record.client_id):(l=this.getGridSelectIdArray(),i.each(l,function(c,d){var r=n.getRecordFromGridById(d);e.push(r.client_id)})),a.filter_data.client_id=e,t){case"edit_client":e.length>0&&IndexViewController.openEditView(this,"Client",e[0]);break;case"client_contact":Global.addViewTab(n.viewId,i.i18n._("Payment Methods"),window.location.href),IndexViewController.goToView("ClientContact",a);break;case"invoice":Global.addViewTab(n.viewId,i.i18n._("Payment Methods"),window.location.href),IndexViewController.goToView("Invoice",a);break;case"transaction":Global.addViewTab(n.viewId,i.i18n._("Payment Methods"),window.location.href),IndexViewController.goToView("InvoiceTransaction",a);break;case"export_excel":this.onExportClick("export"+this.api.key_name);break}}buildEditViewUI(){super.buildEditViewUI();var t=this,n={tab_payment_method:{label:i.i18n._("Payment Method")},tab_attachment:!0,tab_audit:!0};this.setTabModel(n),this.navigation.AComboBox({api_class:TTAPI.APIClientPayment,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_client_payment",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation();var l=this.edit_view_tab.find("#tab_payment_method"),a=l.find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(a);var e=Global.loadWidgetByName(FormItemType.AWESOME_BOX);e.AComboBox({api_class:TTAPI.APIClient,allow_multiple_selection:!1,layout_name:"global_client",show_search_inputs:!0,set_empty:!0,field:"client_id"}),this.addEditFieldToColumn(i.i18n._("Client"),e,a,""),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"status_id"}),e.setSourceData(t.status_array),this.addEditFieldToColumn(i.i18n._("Status"),e,a),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"type_id"}),e.setSourceData(t.type_array),this.addEditFieldToColumn(i.i18n._("Type"),e,a),e=Global.loadWidgetByName(FormItemType.CHECKBOX),e.TCheckbox({field:"is_default"}),this.addEditFieldToColumn(i.i18n._("Default"),e,a),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"bank_account_type_id"}),e.setSourceData(t.bank_account_type_array),this.addEditFieldToColumn(i.i18n._("Bank Type"),e,a,"",null,!0),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"bank_institution",width:30}),this.addEditFieldToColumn(i.i18n._("Institution Number"),e,a,"",null,!0),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"bank_transit",width:100}),this.addEditFieldToColumn(i.i18n._("Bank Transit"),e,a,"",null,!0),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"bank_account",width:120}),this.addEditFieldToColumn(i.i18n._("Account Number"),e,a,"",null,!0),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"cc_type_id"}),e.setSourceData(t.credit_card_type_array),this.addEditFieldToColumn(i.i18n._("Credit Card Type"),e,a,"",null,!0),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"cc_number",width:120}),this.addEditFieldToColumn(i.i18n._("Credit Card Number"),e,a,"",null,!0),e=Global.loadWidgetByName(FormItemType.DATE_PICKER),e.TDatePicker({field:"cc_expire"}),this.addEditFieldToColumn(i.i18n._("Expiry Date"),e,a,"",null,!0),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"cc_check",width:60}),this.addEditFieldToColumn(i.i18n._("Credit Card Security Code (CSC)"),e,a,"",null,!0),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"cc_name"}),this.addEditFieldToColumn(i.i18n._("Card Holder Name"),e,a,"",null,!0),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"cc_bank_phone"}),this.addEditFieldToColumn(i.i18n._("Card Issuing Banks Phone Number"),e,a,"",null,!0),e=Global.loadWidgetByName(FormItemType.IMAGE_AVD_BROWSER),this.file_browser=e.TImageAdvBrowser({field:"signature",show_browser:!1}),this.addEditFieldToColumn(i.i18n._("Signature"),e,a,"",null,!0,!0),e=Global.loadWidgetByName(FormItemType.TEXT_AREA),e.TTextArea({field:"note",width:"100%"}),this.addEditFieldToColumn(i.i18n._("Note"),e,a,"",null,null,!0),e.parent().width("45%")}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:i.i18n._("Client"),in_column:1,field:"client_id",layout_name:"global_client",api_class:TTAPI.APIClient,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:i.i18n._("Status"),in_column:1,field:"status_id",multiple:!0,basic_search:!0,adv_search:!1,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:i.i18n._("Type"),in_column:1,field:"type_id",multiple:!0,basic_search:!0,adv_search:!1,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:i.i18n._("Default"),in_column:2,field:"is_default",multiple:!0,basic_search:!0,adv_search:!1,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:i.i18n._("Created By"),in_column:2,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:i.i18n._("Updated By"),in_column:2,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX})]}onFormItemChange(t,n){this.setIsChanged(t),this.setMassEditingFieldsWhenFormChange(t);var l=t.getField(),a=t.getValue();this.current_edit_record[l]=a,l==="type_id"&&this.onTypeChange(),l==="bank_account_type_id"&&this.onBankAccountTypeChange(),n||this.validate()}setEditViewDataDone(){super.setEditViewDataDone(),this.onTypeChange()}onTypeChange(){this.current_edit_record.type_id==30?(this.detachElement("bank_account_type_id"),this.detachElement("bank_institution"),this.detachElement("bank_transit"),this.detachElement("bank_account"),this.attachElement("cc_type_id"),this.attachElement("cc_number"),this.attachElement("cc_expire"),this.attachElement("cc_check"),this.attachElement("cc_name"),this.attachElement("cc_bank_phone")):this.current_edit_record.type_id==40?(this.attachElement("bank_account_type_id"),this.attachElement("bank_institution"),this.attachElement("bank_transit"),this.attachElement("bank_account"),this.detachElement("cc_type_id"),this.detachElement("cc_number"),this.detachElement("cc_expire"),this.detachElement("cc_check"),this.detachElement("cc_name"),this.detachElement("cc_bank_phone"),this.onBankAccountTypeChange()):(this.detachElement("bank_account_type_id"),this.detachElement("bank_institution"),this.detachElement("bank_transit"),this.detachElement("bank_account"),this.detachElement("cc_type_id"),this.detachElement("cc_number"),this.detachElement("cc_expire"),this.detachElement("cc_check"),this.detachElement("cc_name"),this.detachElement("cc_bank_phone")),this.editFieldResize()}onBankAccountTypeChange(){this.current_edit_record.bank_account_type_id==200&&this.current_edit_record.type_id==40?(this.attachElement("bank_institution"),this.edit_view_form_item_dic.bank_transit.find(".edit-view-form-item-label").text(i.i18n._("Bank Transit"))):this.current_edit_record.bank_account_type_id==201&&(this.detachElement("bank_institution"),this.edit_view_form_item_dic.bank_transit.find(".edit-view-form-item-label").text(i.i18n._("Routing Number"))),this.editFieldResize()}}s.loadSubView=function(o,t,n){Global.loadViewSource("ClientPayment","SubClientPaymentView.html",function(l){var a={},e=_.template(l);Global.isSet(t)&&t(),Global.isSet(o)&&(o.html(e(a)),Global.isSet(n)&&n(sub_client_payment_view_controller))})};export{s as ClientPaymentViewController};
//# sourceMappingURL=ClientPaymentViewController-CBrYr85U.bundle.js.map
