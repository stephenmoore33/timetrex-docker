import{h as Y,o as J,c as Q,d as G,l as $,n as Z,u as ee,x as te,_ as ie,j as _}from"./vendor-tTApdY0Y.bundle.js";import{c as ae,l as se,G as n,d as X}from"./main_ui-z76rxVqJ.entry.bundle.js";import{s as re}from"./selectbutton.esm-C0mFON0B.bundle.js";const le={name:"ScheduleControlBar",created(){this.event_bus=new TTEventBus({component_id:this.component_id}),this.event_bus.on(this.component_id,"getValue",this.getValue,TTEventBusStatics.AUTO_CLEAR_ON_EXIT),this.event_bus.on(this.component_id,"setValue",this.setValue,TTEventBusStatics.AUTO_CLEAR_ON_EXIT),this.event_bus.on(this.component_id,"setScheduleSettingsState",this.setScheduleSettingsState,TTEventBusStatics.AUTO_CLEAR_ON_EXIT),this.event_bus.on(this.component_id,"setSettingActive",this.setSettingActive,TTEventBusStatics.AUTO_CLEAR_ON_EXIT),this.event_bus.on(this.component_id,"setSettingDeactivated",this.setSettingDeactivated,TTEventBusStatics.AUTO_CLEAR_ON_EXIT)},unmounted(){Debug.Text("Vue control bar component unmounted ("+this.component_id+").","ScheduleControlBar.vue","ScheduleControlBar","unmounted",2),this.event_bus.autoClear()},props:{view_id:{type:String,default:null},component_id:{type:String,default:null},schedule_mode_options:{type:Array,default:[]},schedule_settings_options:{type:Array,default:[]}},data(){return{removeEventsOnUnmount:[],schedule_mode_options_selected:"week"}},computed:{},methods:{setValue(V){var e=["schedule_mode_options_selected"];V.key&&V.key&&e.includes(V.key)?this[V.key]=V.value:Debug.Error("Invalid parameters passed to function.","ScheduleControlBar.vue","ScheduleControlBar","setValue",1)},getScheduleSettingsState(V){var e=this.schedule_settings_options.find(t=>t.id===V);if(e)return e.active;Debug.Error("Item not found ("+V+"). Check supplied id.","ScheduleControlBar.vue","ScheduleControlBar","getScheduleSettingsState",1)},setScheduleSettingsState(V){var e=this.schedule_settings_options.find(t=>t.id===V.item_id);e?e[V.item_field]=V.item_value:Debug.Error("Item not found ("+V.item_id+"). Check supplied id.","ScheduleControlBar.vue","ScheduleControlBar","setScheduleSettingsState",1)},setSettingActive(V){var e=this.schedule_settings_options.find(t=>t.id===V.item_id);e?e.setOnlySelfActive():Debug.Error("Item not found ("+V.item_id+"). Check supplied id.","ScheduleControlBar.vue","ScheduleControlBar","setSettingActive",1)},setSettingDeactivated(V){var e=this.schedule_settings_options.find(t=>t.id===V.item_id);e?e.setOnlySelfDeactivated():Debug.Error("Item not found ("+V.item_id+"). Check supplied id.","ScheduleControlBar.vue","ScheduleControlBar","setOnlySelfDeactivated",1)},onScheduleModeChange(){this.event_bus.emit(this.component_id,"scheduleModeOnChange",{key:"schedule_mode_options_selected",value:this.schedule_mode_options_selected})}},components:{SelectButton:re,TTContextButton:se}},K=V=>(ee("data-v-1a4e1a28"),V=V(),te(),V),de={class:"tt-horizontal-vue-bar"},ne=K(()=>G("div",{class:"bar-column left"},null,-1)),_e=K(()=>G("div",{class:"bar-column center"},[G("div",{class:"date-chooser-div"})],-1)),oe={class:"bar-column right"},ue={class:"bar-column schedule-mode"},ce={class:"bar-column menu-item"};function he(V,e,t,i,s,a){const l=Y("SelectButton"),d=Y("TTContextButton");return J(),Q("div",de,[ne,_e,G("div",oe,[G("div",ue,[$(l,{modelValue:s.schedule_mode_options_selected,"onUpdate:modelValue":e[0]||(e[0]=o=>s.schedule_mode_options_selected=o),options:t.schedule_mode_options,optionLabel:"label",optionValue:"value",onClick:e[1]||(e[1]=o=>{this.onScheduleModeChange()})},null,8,["modelValue","options"])]),G("div",ce,[$(d,{class:Z(["no-wrap"]),items:t.schedule_settings_options},null,8,["items"])])])])}const me=ae(le,[["render",he],["__scopeId","data-v-1a4e1a28"]]);class pe extends BaseViewController{constructor(e={}){ie.defaults(e,{el:"#schedule_view_container",user_group_api:null,status_array:null,user_group_array:null,toggle_button:null,start_date_picker:null,start_date:null,end_date:null,full_schedule_data:null,schedule_columns:null,full_format:"ddd-MMM-DD-YYYY",weekly_format:"ddd, MMM DD",final_schedule_data_array:[],has_date_array:[],no_date_array:[],shift_key_name_array:[],select_cells_Array:[],select_all_shifts_array:[],select_shifts_array:[],select_recurring_shifts_array:[],all_employee_btn:null,daily_totals_btn:null,weekly_totals_btn:null,strict_range_btn:null,month_date_row_array:null,month_date_row_tr_ids:null,month_date_row_position:null,month_current_header_number:0,day_header_width:0,day_hour_width:40,select_drag_menu_id:"",is_override:!1,notify_user_schedule_change:!1,scroll_position:0,selected_user_ids:[],prev_total_time:0,prev_status_id:null,is_mass_adding:!1,calculate_cell_number:0,scroll_interval:null,scroll_unit:0,holiday_data_dic:{},absence_policy_api:null,job_api:null,job_item_api:null,user_api:null,department_api:null,punch_tag_api:null,default_punch_tag:[],previous_punch_tag_selection:[],year_mode_original_date:null,events:{},vue_control_bar_id:""}),super(e)}init(e){this.permission_id="schedule",this.script_name="ScheduleView",this.viewId="Schedule",this.table_name_key="schedule",this.context_menu_name=_.i18n._("Schedules"),this.navigation_label=_.i18n._("Schedule"),this.api=TTAPI.APISchedule,this.user_group_api=TTAPI.APIUserGroup,this.absence_policy_api=TTAPI.APIAbsencePolicy,this.company_api=TTAPI.APICompany,this.user_api=TTAPI.APIUser,this.currency_api=TTAPI.APICurrency,this.event_bus=new TTEventBus({view_id:this.viewId}),n.getProductEdition()>=20&&(this.job_api=TTAPI.APIJob,this.job_item_api=TTAPI.APIJobItem,this.punch_tag_api=TTAPI.APIPunchTag,this.department_api=TTAPI.APIDepartment),this.api_absence_policy=TTAPI.APIAbsencePolicy,this.scroll_position=0,this.initPermission(),this.render(),this.buildContextMenu(),this.initData()}jobUIValidate(e){return e||(e=this.permission_id),!!(PermissionManager.validate("job","enabled")&&PermissionManager.validate(e,"edit_job")&&n.getProductEdition()>=20)}jobItemUIValidate(e){return e||(e=this.permission_id),!!(PermissionManager.validate("job_item","enabled")&&PermissionManager.validate(e,"edit_job_item"))}punchTagUIValidate(e){return e||(e=this.permission_id),!!(PermissionManager.validate("punch_tag","enabled")&&PermissionManager.validate(e,"edit_job_item"))}branchUIValidate(e){return e||(e=this.permission_id),!!PermissionManager.validate(e,"edit_branch")}departmentUIValidate(e){return e||(e=this.permission_id),!!PermissionManager.validate(e,"edit_department")}unscheduledEmployeeUIValidate(){return!!(PermissionManager.validate("schedule","view")||PermissionManager.validate("schedule","view_child"))}initPermission(){super.initPermission(),this.show_search_tab=!0,this.jobUIValidate()?this.show_job_ui=!0:this.show_job_ui=!1,this.jobItemUIValidate()?this.show_job_item_ui=!0:this.show_job_item_ui=!1,this.punchTagUIValidate()?this.show_punch_tag_ui=!0:this.show_punch_tag_ui=!1,this.branchUIValidate()?this.show_branch_ui=!0:this.show_branch_ui=!1,this.departmentUIValidate()?this.show_department_ui=!0:this.show_department_ui=!1}initData(){var e=this;n.removeViewTab(this.viewId),ProgressBar.showOverlay(),this.initOptions(),this.default_display_columns=[],PermissionManager.validate(this.permission_id,"edit_branch")&&this.default_display_columns.push("branch"),PermissionManager.validate(this.permission_id,"edit_department")&&this.default_display_columns.push("department"),n.getProductEdition()>=20&&(PermissionManager.validate(this.permission_id,"edit_job")&&this.default_display_columns.push("job"),PermissionManager.validate(this.permission_id,"edit_job_item")&&this.default_display_columns.push("job_item"));var t=new Date;n.UNIT_TEST_MODE==!0&&(LocalCacheData.last_schedule_selected_date="15-Feb-18");var i=n.getLoginUserDateFormat(),s=t.format(i);LocalCacheData.last_schedule_selected_date?this.setDatePickerValue(LocalCacheData.last_schedule_selected_date):LocalCacheData.current_select_date&&n.strToDate(LocalCacheData.current_select_date,"YYYY-MM-DD")?(this.setDatePickerValue(n.strToDate(LocalCacheData.current_select_date,"YYYY-MM-DD").format()),LocalCacheData.current_select_date=""):this.setDatePickerValue(s),this.setMoveOrDropMode(this.select_drag_menu_id?this.select_drag_menu_id:"move"),TTPromise.wait("BaseViewController","getCustomFields",function(){e.getAllColumns(function(){e.initLayout()})})}setToggleButtonValue(e){this.toggle_button&&(this.toggle_button.setValue(e),this.setToggleButtonUrl())}setToggleButtonUrl(){var e=this.getMode();this.start_date_picker.getDefaultFormatValue(),this.edit_view||n.setURLToBrowser(n.getBaseURL()+"#!m="+this.viewId+"&mode="+e)}setDatePickerValue(e){this.start_date_picker.setValue(e),LocalCacheData.last_schedule_selected_date=e}getAllColumns(e){var t=this;this.api.getOptions("columns",{onResult:function(i){var s=i.getResult();t.all_columns=n.buildColumnArray(s),t.api.getOptions("group_columns",{onResult:function(a){for(var l=n.buildColumnArray(s),d=a.getResult(),o=[],r=l.length,c=d.length,u=0;u<c;u++)for(var h=d[u],m=0;m<r;m++){var p=l[m];if(p.value===h){o.push(p);break}}t.all_columns=o,t.column_selector.setUnselectedGridData(t.all_columns),e&&e()}})}})}initLayout(){var e=this;e.getAllLayouts(function(){e.setSelectLayout(),e.search(!0,!1)})}initOptions(){var e=this;this.initDropDownOption("status","",this.api),this.user_group_api.getUserGroup("",!1,!1,{onResult:function(t){t=t.getResult(),t=n.buildTreeRecord(t),e.user_group_array=t,e.basic_search_field_ui_dic.group_ids&&e.basic_search_field_ui_dic.group_ids.setSourceData(t),e.adv_search_field_ui_dic.group_ids&&e.adv_search_field_ui_dic.group_ids.setSourceData(t)}})}getSelectDate(){var t;var e=((t=this.start_date_picker)==null?void 0:t.getValue())??"Invalid date";return e=="Invalid date"&&(e=new Date),e}getGridSelectIdArray(){for(var e=[],t=this.select_all_shifts_array.length,i=0;i<t;i++){var s=this.select_all_shifts_array[i];s.id&&s.id!=TTUUID.zero_id&&s.id!=TTUUID.not_exist_id&&e.push(s.id)}return e}getSelectedItem(){var e=null;return this.edit_view?e=this.current_edit_record:this.select_all_shifts_array.length>0&&(e=this.select_all_shifts_array[0]),e?n.clone(e):null}_continueDoCopyAsNew(){var e=this;if(this.setCurrentEditViewState("new"),LocalCacheData.current_doing_context_action="copy_as_new",n.isSet(this.edit_view)){this.current_edit_record.id="";var t=this.edit_view.find(".navigation-div");t.css("display","none"),this.setCurrentEditRecordData(),this.setEditMenu(),this.setTabStatus(),this.is_changed=!1,ProgressBar.closeOverlay()}else{var i={},s=this.getGridSelectIdArray(),a=s.length;if(a>0)var l=s[0];else{var d=n.clone(e.select_all_shifts_array[0]);d=e.resetSomeFields(d),e.current_edit_record=d,e.openEditView(),e.initEditView();return}i.filter_data={},i.filter_data.id=[l],this.api["get"+this.api.key_name](i,{onResult:function(o){var r=o.getResult();if(!r||r===!0){TAlertManager.showAlert(_.i18n._("Record does not exist")),e.onCancelClick();return}e.openEditView(),r=r[0],r.id="",e.sub_view_mode&&e.parent_key&&(r[e.parent_key]=e.parent_value),e.current_edit_record=r,e.initEditView()}})}}onViewClick(e,t){this.setCurrentEditViewState("view");var i=this.getViewSelectedRecordId(e);if(n.isFalseOrNull(i)){TTPromise.add("Schedule","init"),this.openEditView();var s=n.clone(this.select_all_shifts_array[0]);s=this.resetSomeFields(s),this.current_edit_record=s;var a=this;TTPromise.wait("Schedule","init",function(){a.initEditView()});return}this.setCurrentSelectedRecord(i),this.openEditView();var l=this.getAPIFilters();return this.doViewAPICall(l)}getCommonFields(){var e;return _.each(this.select_all_shifts_array,function(t,i){if(!e)return e=n.clone(i),!0;for(var s in i)e[s]!==i[s]&&delete e[s]}),e}onMassEditClick(){var e=this,t={},i=[];if(this.setCurrentEditViewState("mass_edit"),this.mass_edit_record_ids=[],i=this.getGridSelectIdArray(),e.openEditView(),_.each(i,function(a,l){e.mass_edit_record_ids.push(l)}),e.selected_user_ids=[],_.each(this.select_all_shifts_array,function(a,l){var d=l;d.hasOwnProperty("user_id")&&e.selected_user_ids.push(d.user_id)}),t.filter_data={},t.filter_data.id=this.mass_edit_record_ids,this.mass_edit_record_ids.length!==this.select_all_shifts_array.length){s(this.getCommonFields());return}this.api["getCommon"+this.api.key_name+"Data"](t,{onResult:function(a){var l=a.getResult();l||(l=[]),s(l)}});function s(a){e.api.getOptions("unique_columns",{onResult:function(l){e.unique_columns=l.getResult(),e.api.getOptions("linked_columns",{onResult:function(d){e.linked_columns=d.getResult(),e.sub_view_mode&&e.parent_key&&(a[e.parent_key]=e.parent_value),e.current_edit_record=a,e.is_mass_editing=!0,e.initEditView()}})}})}}onEditClick(e,t){if(TTPromise.add("Schedule","init"),this.setCurrentEditViewState("edit"),this.openEditView(),e=this.getEditSelectedRecordId(e),n.isFalseOrNull(e)){this.openEditView();var i=n.clone(this.select_all_shifts_array[0]);i=this.resetSomeFields(i),this.current_edit_record=i,this.current_edit_record.user_ids=[this.current_edit_record.user_id],this.is_viewing=!1;var s=this;TTPromise.wait("Schedule","init",function(){s.initEditView()});return}this.setCurrentSelectedRecord(e);var a=this.getAPIFilters();return this.doEditAPICall(a)}doDeleteAPICall(e,t){if(t||(t={onResult:(function(s){ProgressBar.closeOverlay(),i.call(this,s),s&&s.isValid()?(this.onDeleteDone(s),this.edit_view?this.removeEditView():this.setCurrentEditViewState("")):TAlertManager.showErrorAlert(s)}).bind(this)}),e&&e.length>0)return this.api["delete"+this.api.key_name](e,t);i.call(this,{isValid:function(){return!1}});function i(s){this.edit_view?this.removeEditView():this.setCurrentEditViewState("");for(var a=[],l=0;l<this.select_cells_Array.length;l++)this.select_cells_Array[l].shift&&(this.select_cells_Array[l].shift.status_id="20",a.push(this.select_cells_Array[l].shift));a.length>0?this.api.setSchedule(a,{onResult:(function(){this.search()}).bind(this)}):s&&s.isValid()&&this.search()}}getCustomContextMenuModel(){var e={groups:{drag_and_drop:{label:_.i18n._("Drag & Drop"),id:this.viewId+"drag_and_drop"}},exclude:["export_excel","save_and_next","delete_and_next","copy"],include:[{label:_.i18n._("Jump To"),id:"jump_to_header",menu_align:"right",action_group:"jump_to",action_group_header:!0,permission_result:!1,sort_order:9030},{label:_.i18n._("TimeSheet"),id:"timesheet",menu_align:"right",action_group:"jump_to",group:"navigation",permission_result:!0,sort_order:9030},{label:_.i18n._("Edit Employee"),id:"edit_employee",menu_align:"right",action_group:"jump_to",group:"navigation",permission_result:!0,sort_order:9030},{label:_.i18n._("Import"),id:"import_icon",menu_align:"right",action_group:"import_export",group:"other",vue_icon:"tticon tticon-file_download_black_24dp",permission_result:PermissionManager.checkTopLevelPermission("ImportCSVSchedule"),sort_order:9025}]};return e.include.push({label:_.i18n._("Print"),id:"print",action_group_header:!0,action_group:"print",menu_align:"right",sort_order:9020}),e.include.push({label:_.i18n._("Individual Schedules"),id:"pdf_schedule",action_group:"print",menu_align:"right",sort_order:9020}),e.include.push({label:_.i18n._("Find Available"),id:"find_available",vue_icon:"tticon tticon-search_black_24dp",menu_align:"right",permission_result:!0,show_on_right_click:!0,sort_order:7e3}),PermissionManager.validate("request","add")&&e.include.push({label:_.i18n._("Add Request"),id:"AddRequest",vue_icon:"tticon tticon-post_add_black_24dp",menu_align:"right",permission_result:!0,permission:!0,show_on_right_click:!0,sort_order:7010}),!this.is_edit&&!this.is_mass_editing&&!this.is_viewing&&(e.include.unshift({label:_.i18n._("Drag & Drop: Move"),id:"move",action_group:"drag_and_drop",multi_select_group:1,menu_align:"right",group:"drag_and_drop",permission_result:!0,sort_order:8050},{label:_.i18n._("Drag & Drop: Copy"),id:"drag_copy",action_group:"drag_and_drop",menu_align:"right",multi_select_group:1,group:"drag_and_drop",permission_result:!0,sort_order:8060},{label:_.i18n._("Drag & Drop: Swap"),id:"swap",action_group:"drag_and_drop",menu_align:"right",multi_select_group:1,group:"drag_and_drop",permission_result:!0,sort_order:8070},{id:"separator_drag_and_drop_1",action_group:"drag_and_drop",menu_align:"right",separator:!0,sort_order:8080},{label:_.i18n._("Drag & Drop: Overwrite"),id:"override",action_group:"drag_and_drop",multi_select_group:2,menu_align:"right",group:"drag_and_drop",permission_result:!0,sort_order:8090}),n.getProductEdition()>=15&&e.include.unshift({label:_.i18n._("Drag & Drop: Notify Employee"),id:"notify_user_schedule_change",action_group:"drag_and_drop",multi_select_group:3,menu_align:"right",group:"drag_and_drop",permission_result:!0,sort_order:8100})),(PermissionManager.validate("schedule","view")||PermissionManager.validate("schedule","view_child"))&&e.include.push({label:_.i18n._("Group - Combined"),id:"pdf_schedule_group_combined",action_group:"print",menu_align:"right",sort_order:9020},{label:_.i18n._("Group - Separated"),id:"pdf_schedule_group",action_group:"print",menu_align:"right",sort_order:9020},{label:_.i18n._("Group - Separated (Page Breaks)"),id:"pdf_schedule_group_pagebreak",action_group:"print",menu_align:"right",sort_order:9020}),e.include.push(),PermissionManager.validate("punch","add")&&(PermissionManager.validate("punch","edit")||PermissionManager.validate("punch","edit_child"))&&e.include.push({label:"",id:"other_header",action_group:"other",menu_align:"right",action_group_header:!0,vue_icon:"tticon tticon-more_vert_black_24dp",sort_order:9050},{label:_.i18n._("Auto Punch"),id:"AutoPunch",action_group:"other",menu_align:"right",group:"other",permission_result:!0,permission:!0,show_on_right_click:!0,sort_order:9050}),e}parseCustomContextModelForEditViews(e){return e=super.parseCustomContextModelForEditViews(e),this.determineContextMenuMountAttributes().menu_type==="editview_contextmenu"&&e.exclude.push("move","drag_copy","swap","override","notify_user_schedule_change","print","pdf_schedule","pdf_schedule_group_combined","pdf_schedule_group","pdf_schedule_group_pagebreak"),e}onReportMenuClick(e){this.onNavigationClick(e)}onCustomContextClick(e){switch(e){case"move":case"drag_copy":case"swap":this.setMoveOrDropMode(e);break;case"override":this.onOverrideClick();break;case"notify_user_schedule_change":this.onNotifyUserScheduleChangeClick();break;case"edit_employee":case"timesheet":this.onNavigationClick(e);break;case"find_available":this.onFindAvailableClick(e);break;case"AutoPunch":this.addPunchesFromScheduledShifts(e);break;case"AddRequest":this.addRequestFromScheduledShifts(e);break;case"import_icon":this.onImportClick();break;case"pdf_schedule":case"pdf_schedule_group":case"pdf_schedule_group_combined":case"pdf_schedule_group_pagebreak":this.onReportMenuClick(e);break}}addRequestFromScheduledShifts(e){if(n.getProductEdition()<=10)return TAlertManager.showAlert(n.getUpgradeMessage()),!1;if(t&&t.length<=0)return!1;var t=this.select_cells_Array,i=t[0]?t[0]:null,s=t[t.length-1]?t[t.length-1]:null;if(!i||!s)return!1;var a=this.api.getScheduleDefaultData(this.select_cells_Array,{async:!1}).getResult(),l=10,d=40,o=!1,r=!1,c=!1,u=!1,h=!1,m=!1,p=!1;for(var b in t){i.shift==null&&t[b].shift&&(i=t[b]);var M=new Date(t[b].time_stamp_num);switch(M.getDay()){case 0:p=!0;break;case 1:o=!0;break;case 2:r=!0;break;case 3:c=!0;break;case 4:u=!0;break;case 5:h=!0;break;case 6:m=!0;break}M=null}if(a.mon=o,a.tue=r,a.wed=c,a.thu=u,a.fri=h,a.sat=m,a.sun=p,i&&i.date)var v=i.date;if(s&&s.date)var y=s.date;i&&i.shift&&i.shift.status_id==10&&i.shift.user_id&&i.shift.user_id!=TTUUID.zero_id&&(l=20,d=30),a.status_id=l,a.type_id=d,a.user_id=LocalCacheData.getLoginUser().id,a.full_name=LocalCacheData.getLoginUser().full_name,v&&(a.date_stamp=v,a.start_date=v),y&&(a.end_date=y),i.start_time&&(a.start_time=i.start_time),i.end_time&&(a.end_time=i.end_time),i.branch_id&&(a.branch_id=i.branch_id),i.department_id&&(a.department_id=i.department_id),i.job_id&&(a.job_id=i.job_id),i.job_item_id&&(a.job_item_id=i.job_item_id),i.punch_tag_id&&(a.punch_tag_id=i.punch_tag_id),IndexViewController.openEditView(this,"Request",a,"openAddView")}addPunchesFromScheduledShifts(e){if(n.getProductEdition()<=10)return TAlertManager.showAlert(n.getUpgradeMessage()),!1;if(this.select_cells_Array==null||this.select_cells_Array.length<1)return TAlertManager.showAlert("No schedules selected. You can't autopunch no schedules."),!1;var t=this.select_cells_Array,i={},s=[];i.schedule=[],i.recurring=[];for(var a=0;a<t.length;a++)t[a].shift!=null&&(t[a].shift.id&&t[a].shift.id!=TTUUID.zero_id&&t[a].shift.id!=TTUUID.not_exist_id?i.schedule.push(t[a].shift.id):t[a].shift.recurring_schedule_id&&t[a].shift.recurring_schedule_id!=TTUUID.not_exist_id&&i.recurring.push(t[a].shift.recurring_schedule_id),s.push(t[a].shift.user_id));this.api.addPunchesFromScheduledShifts(i,{onResult:function(l){l&&l.isValid()?UserGenericStatusWindowController.open(l.getAttributeInAPIDetails("user_generic_status_batch_id"),[LocalCacheData.getLoginUser().id]):TAlertManager.showErrorAlert(l)}})}getSelectEmployee(){var e=this.select_cells_Array[0];return!e||e.user_id==TTUUID.zero_id?e={user_id:LocalCacheData.getLoginUser().id}:e.user_id&&e.user_id!=TTUUID.zero_id&&(e={user_id:e.user_id}),this.edit_view&&this.current_edit_record&&(e.user_id=this.current_edit_record.user_id),e.user_id}onFindAvailableClick(){if(n.getProductEdition()<=10){TAlertManager.showAlert(n.getUpgradeMessage());return}var e=this,t={};t.selected=[];for(var i=this.select_all_shifts_array.length,s=0;s<i;s++){var a=this.select_all_shifts_array[s];t.selected.push(a)}LocalCacheData.extra_filter_for_next_open_view={},LocalCacheData.extra_filter_for_next_open_view.filter_data=t,IndexViewController.openWizard("FindAvailableWizard",null,function(l,d){e.onFindAvailableClose(l,t.selected,d)})}onFindAvailableClose(e,t,i){for(var s=this,a=t.length,l=0;l<a;l++){var d=t[l];d.user_id=e,d.replaced_id=d.id,d.notify_user_schedule_change=i,delete d.id}this.api.setSchedule(t,{onResult:function(o){o.isValid()||TAlertManager.showErrorAlert(o),s.search()}})}onImportClick(){var e=this;IndexViewController.openWizard("ImportCSVWizard","Schedule",function(){e.search()})}onNavigationClick(e){if(this.checkScheduleData()){var t;switch(e){case"edit_employee":IndexViewController.openEditView(this,"Employee",this.getSelectEmployee());break;case"timesheet":var i={filter_data:{}};i.user_id=this.getSelectEmployee(),this.edit_view?i.base_date=this.current_edit_record.date_stamp:i.base_date=this.start_date_picker.getValue(),n.addViewTab(this.viewId,_.i18n._("Schedules"),window.location.href),IndexViewController.goToView("TimeSheet",i);break;case"pdf_schedule":case"pdf_schedule_group_combined":case"pdf_schedule_group":case"pdf_schedule_group_pagebreak":if(i=n.convertLayoutFilterToAPIFilter(this.select_layout),i||(i={}),i.time_period={},i.time_period.time_period="custom_date",i.time_period.start_date=this.full_schedule_data.schedule_dates.start_display_date,i.time_period.end_date=this.full_schedule_data.schedule_dates.end_display_date,i.time_period.start_date==i.time_period.end_date){var s=new Date(new Date(this.start_date.getTime()).setDate(this.start_date.getDate()+6));i.time_period.end_date=s.format()}t={0:i,1:e},this.doFormIFrameCall(t);break}}}doFormIFrameCall(e){n.APIFileDownload("APIScheduleSummaryReport","getScheduleSummaryReport",e)}setScheduleGridDragAble(){var e=this.getMode();switch(e){case T.DAY:this.setWeekModeDragAble();break;case T.WEEK:this.setWeekModeDragAble();break;case T.MONTH:this.setWeekModeDragAble();break;case T.YEAR:this.setWeekModeDragAble();break}var t=this;_(".schedule-grid-div").off("dragover").on("dragover",function(i){var s=_(".schedule-grid-div"),a=s.offset().top,l=i.originalEvent.clientY,d=s.height();l>a+d?(t.scroll_unit=l-(a+d),t.scroll_interval||(t.scroll_interval=setInterval(function(){var o=t.grid.grid.parent().parent();o.scrollTop(o.scrollTop()+t.scroll_unit)},50))):l<a+15&&l>a-50?(t.scroll_unit=a+15-l,t.scroll_interval||(t.scroll_interval=setInterval(function(){var o=t.grid.grid.parent().parent();o.scrollTop(o.scrollTop()-t.scroll_unit)},50))):(clearInterval(t.scroll_interval),t.scroll_interval=null)}),_(".schedule-grid-div").off("dragend").on("dragend",function(i){t.scroll_interval&&(clearInterval(t.scroll_interval),t.scroll_interval=null)}),_(".schedule-grid-div td").unbind("dragenter").bind("dragenter",function(i){i.preventDefault(),_(".schedule-drag-over").removeClass("schedule-drag-over"),(_(this).attr("draggable")||_(this).parents("td").attr("draggable"))&&_(this).addClass("schedule-drag-over")})}setWeekModeDragAble(){var e=this,t=this.grid.grid.find(".date-column").parents("td");t.attr("draggable",!0),t.unbind("dragstart").bind("dragstart",function(i){var s=i.target;if(e.select_all_shifts_array.length<1||!_(s).hasClass("ui-state-highlight")||!e.select_drag_menu_id)return!1;for(var a=_("<div class='drag-holder-div'></div>"),l=e.select_all_shifts_array.length,d=0;d<l;d++){var o=e.select_all_shifts_array[d],r=_("<span class='drag-span'></span>");o.status_id==20?r.text(e.getAbsenceCellValue(o)):r.text(o.start_time+" - "+o.end_time),a.append(r)}return _("body").find(".drag-holder-div").remove(),_("body").append(a),i.originalEvent.dataTransfer.setData("Text","schedule"),i.originalEvent.dataTransfer.setDragImage&&i.originalEvent.dataTransfer.setDragImage(a[0],0,0),!0}),t.unbind("drop").bind("drop",function(i){i.preventDefault(),i.stopPropagation&&i.stopPropagation(),_(".drag-holder-div").remove();var s=!1,a=!1,l=[],d=[],o=[],r=i.currentTarget,c=e.select_cellls_and_shifts_array;if(c){var u,h;u=r.parentNode.rowIndex-1,h=r.cellIndex;var m=0,p=0,b,M,v=e.grid.grid.getGridParam("colModel");e.select_drag_menu_id==="move"?a=!0:a=!1;for(var y=c.length,g=0;g<y;g++){var A=c[g],D;if(g===0?(b=A.row_id,M=A.cell_index):(s||(m=A.row_id-b),p=A.cell_index-M),A.shift)D=A.shift;else{var P=u+m,B=h+p;if(B>v.length-1)continue;var f=e.getDataByCellIndex(P,B),S=e.schedule_source[P];(!S||!S.user_id)&&(s=!0);continue}if(D.branch_id=D.branch?D.branch_id:"",D.department_id=D.department?D.department_id:"",D.job_id=D.job_id?D.job_id:"",D.job_item_id=D.job_item_id?D.job_item_id:"",D.punch_tag_id=D.punch_tag_id?D.punch_tag_id:"",P=u+m,B=h+p,!(B>v.length-1)){if(f=e.getDataByCellIndex(P,B),S=e.schedule_source[P],(!S||!S.user_id)&&(s=!0),S){if(S.type===U.DATE)break;if(!f||s){var x;if(v)if(e.getMode()===T.MONTH){var k=e.getCellRelatedDate(P,v,B,v[B].name);k&&(x=k.format())}else x=n.strToDate(v[B].name,e.full_format).format();if(!x||x=="Invalid date")continue;f={},S.user_id?(f.user_id=S.user_id,f.branch=S.branch,f.branch_id=S.branch?S.branch_id:"",f.schedule_policy_id=S.schedule_policy_id,f.department_id=S.department?S.department_id:"",f.department=S.department,f.job_id=S.job_id?S.job_id:"",f.job=S.job,f.job_item_id=S.job_item_id?S.job_item_id:"",f.punch_tag_id=S.punch_tag_id?S.punch_tag_id:"",f.job_item=S.job_item,f.date_stamp=x,f.start_date_stamp=x):(f=D,f.date_stamp=x,f.start_date_stamp=x)}}else continue;var E=n.clone(D);if(e.select_drag_menu_id!=="swap")E.id="",E.date_stamp=f.date_stamp,E.start_date_stamp=f.start_date_stamp,E.user_id=f.user_id,E.branch_id=f.branch?f.branch_id:TTUUID.not_exist_id,E.department_id=f.department?f.department_id:TTUUID.not_exist_id,E.job_id=f.job_id?f.job_id:TTUUID.not_exist_id,E.job_item_id=f.job_item_id?f.job_item_id:TTUUID.not_exist_id,E.punch_tag_id=f.punch_tag_id?f.punch_tag_id:TTUUID.not_exist_id,e.is_override&&(E.overwrite=!0),e.notify_user_schedule_change&&(E.notify_user_schedule_change=!0),l.push(E),D.id&&D.id!=TTUUID.zero_id?d.push(D.id):D.user_id!=TTUUID.zero_id&&D.user_id!=TTUUID.not_exist_id?(D.status_id="20",o.push(D)):D.user_id==TTUUID.zero_id&&(a=!1);else{var R=n.clone(E),C=n.clone(f);if(!C.start_date)continue;for(var w in f)w!=="id"&&w!=="user_id"&&w!=="date_stamp"&&w!=="start_date_stamp"&&w!=="branch_id"&&w!=="department_id"&&w!=="job_id"&&w!=="job_item_id"&&w!=="punch_tag_id"&&w!=="branch"&&w!=="department"&&w!=="job"&&w!=="job_item"&&w!=="schedule_policy_id"&&(f[w]=R[w],E[w]=C[w]);f.branch_id=f.branch?f.branch_id:TTUUID.not_exist_id,f.department_id=f.department?f.department_id:TTUUID.not_exist_id,f.job_id=f.job_id?f.job_id:TTUUID.not_exist_id,f.job_item_id=f.job_item_id?f.job_item_id:TTUUID.not_exist_id,f.punch_tag_id=f.punch_tag_id?f.punch_tag_id:TTUUID.not_exist_id,l.push(f),l.push(E)}}}l.length>0&&e.api.setSchedule(l,{onResult:function(W){W&&W.isValid()?a?d.length>0?e.api.deleteSchedule(d,{onResult:function(){o.length>0?e.api.setSchedule(o,{onResult:function(){e.search()}}):e.search()}}):o.length>0?e.api.setSchedule(o,{onResult:function(){e.search()}}):e.search():e.search():TAlertManager.showErrorAlert(W)}})}}),t.unbind("dragenter").bind("dragenter",function(i){i.preventDefault()}),t.unbind("dragover").bind("dragover",function(i){i.preventDefault()}),t.unbind("dragend").bind("dragend",function(i){_(".drag-holder-div").remove(),_(".schedule-drag-over").removeClass("schedule-drag-over")})}resetSomeFields(e){return e.branch_id=e.branch?e.branch_id:"",e.department_id=e.department?e.department_id:"",e.job_id=e.job?e.job_id:"",e.job_item_id=e.job_item?e.job_item_id:"",e.punch_tag_id=e.punch_tag_id?e.punch_tag_id:[],e}_createParametersForAdd(){var e=[],t;if(this.select_cells_Array.length>0)for(var i=0,s=this.select_cells_Array.length;i<s;i++){var a=this.select_cells_Array[i];t={},t.user_id=a.user_id,t.branch_id=a.branch_id,t.department_id=a.department_id,t.job_id=a.job_id,t.job_item_id=a.job_item_id,t.punch_tag_id=a.punch_tag_id,t.date=a.date,e.push(t)}if(e.length<1){var l=LocalCacheData.getLoginUser();t={},t.user_id=l.id,t.branch_id=l.branch_id,t.department_id=l.department_id,t.job_id=l.job_id,t.job_item_id=l.job_item_id,t.punch_tag_id=l.punch_tag_id,t.date=this.getSelectDate(),e.push(t)}return e}onAddClick(e){var t=this;this.setCurrentEditViewState("new"),this.select_cells_Array.length>1&&(this.is_mass_adding=!0),t.openEditView();var i;e?i=[{user_id:this.current_edit_record.user_id,branch_id:this.current_edit_record.branch_id,department_id:this.current_edit_record.department_id,job_id:this.current_edit_record.job_id,job_item_id:this.current_edit_record.job_item_id,punch_tag_id:this.current_edit_record.punch_tag_id,date:this.current_edit_record.date_stamp}]:i=this._createParametersForAdd(),this.api["get"+this.api.key_name+"DefaultData"](i,{onResult:function(s){var a,l=s.getResult();if(a=l,t.select_cells_Array.length>=1)for(var d=0,o=i.length;d<o;d++){var r=i[d];d==0?(a.branch_id=r.branch_id,a.department_id=r.department_id,a.job_id=r.job_id,a.job_item_id=r.job_item_id,a.punch_tag_id=r.punch_tag_id):(a.branch_id!==r.branch_id&&a.branch_id!=="-2"?a.branch_id="-2":r.branch_id,a.department_id!==r.department_id&&a.department_id!=="-2"?a.department_id="-2":r.department_id,a.job_id!==r.job_id&&a.job_id!=="-2"?a.job_id="-2":r.job_id,a.job_item_id!==r.job_item_id&&a.job_item_id!=="-2"?a.job_item_id="-2":r.job_item_id,a.punch_tag_id!==r.punch_tag_id&&a.punch_tag_id!=="-2"?a.punch_tag_id="-2":r.punch_tag_id)}if(!e)a.date_stamp=t.getSelectDate();else{var c=n.strToDate(t.current_edit_record.date_stamp);a.date_stamp=new Date(new Date(c.getTime()).setDate(c.getDate()+1)).format()}a.start_date_stamp||(a.start_date_stamp=a.date_stamp),a.id="",t.sub_view_mode&&t.parent_key&&(l[t.parent_key]=t.parent_value),t.current_edit_record=a,t.initEditView()}})}openEditView(){this.edit_view||this.initEditViewUI("Schedule","ScheduleEditView.html"),this.previous_absence_policy_id=!1}setEditViewWidgetsMode(){var e={};for(var t in this.edit_view_ui_dic)if(this.edit_view_ui_dic.hasOwnProperty(t)){var i=this.edit_view_ui_dic[t];i.css("opacity",1);var s=i.parent().parent().parent(),a=s.parent().attr("id");s.hasClass("v-box")||e[a]||(e[a]=!0),this.is_viewing?n.isSet(i.setEnabled)&&i.setEnabled(!1):n.isSet(i.setEnabled)&&i.setEnabled(!0)}}setJobValueWhenUserChanged(e,t,i){var s=this;if(s.current_edit_record){this.edit_view_ui_dic.user_ids&&this.edit_view_ui_dic.user_ids.is(":visible")?(i.user_id=this.edit_view_ui_dic.user_ids.getValue(),i.user_id.length==1?i.user_id=i.user_id[0]:i.user_id=!1):i.user_id=this.current_edit_record.user_id;var a=s.edit_view_ui_dic[t];a.getValue(),a.setSourceData(null),a.setCheckBox(!0),this.edit_view_ui_dic.job_item_quick_search.setCheckBox(!0);var l={};l.filter_data=i,s.edit_view_ui_dic[t].setDefaultArgs(l)}}onFormItemChange(e,t){var i=this;this.setIsChanged(e),this.setMassEditingFieldsWhenFormChange(e);var s=e.getField(),a=e.getValue();switch(this.current_edit_record[s]=a,s){case"job_id":n.getProductEdition()>=20&&(this.edit_view_ui_dic.job_quick_search.setValue(e.getValue(!0)&&e.getValue(!0).manual_id?e.getValue(!0).manual_id:""),this.setJobItemValueWhenJobChanged(e.getValue(!0),"job_item_id",{status_id:10,job_id:this.current_edit_record.job_id}),this.edit_view_ui_dic.job_quick_search.setCheckBox(!0),this.setPunchTagValuesWhenCriteriaChanged(this.getPunchTagFilterData(),"punch_tag_id"));break;case"job_item_id":n.getProductEdition()>=20&&(this.edit_view_ui_dic.job_item_quick_search.setValue(e.getValue(!0)&&e.getValue(!0).manual_id?e.getValue(!0).manual_id:""),this.edit_view_ui_dic.job_item_quick_search.setCheckBox(!0),this.setPunchTagValuesWhenCriteriaChanged(this.getPunchTagFilterData(),"punch_tag_id"));break;case"punch_tag_id":n.getProductEdition()>=20&&(a!==TTUUID.zero_id&&a!==!1&&a.length>0?this.setPunchTagQuickSearchManualIds(e.getSelectItems()):this.edit_view_ui_dic.punch_tag_quick_search.setValue(""),i.previous_punch_tag_selection=a,this.edit_view_ui_dic.punch_tag_id.setSourceData(null));break;case"branch_id":n.getProductEdition()>=20&&(this.setPunchTagValuesWhenCriteriaChanged(this.getPunchTagFilterData(),"punch_tag_id"),this.setJobValueWhenCriteriaChanged("job_id",{status_id:10,user_id:this.current_edit_record.user_id,punch_branch_id:this.current_edit_record.branch_id,punch_department_id:this.current_edit_record.department_id}),this.setDepartmentValueWhenBranchChanged(e.getValue(!0),"department_id",{branch_id:this.current_edit_record.branch_id,user_id:this.current_edit_record.user_id}));break;case"department_id":n.getProductEdition()>=20&&(this.setPunchTagValuesWhenCriteriaChanged(this.getPunchTagFilterData(),"punch_tag_id"),this.setJobValueWhenCriteriaChanged("job_id",{status_id:10,user_id:this.current_edit_record.user_id,punch_branch_id:this.current_edit_record.branch_id,punch_department_id:this.current_edit_record.department_id}));break;case"job_quick_search":case"job_item_quick_search":n.getProductEdition()>=20&&(this.onJobQuickSearch(s,a),this.setPunchTagValuesWhenCriteriaChanged(this.getPunchTagFilterData(),"punch_tag_id"));break;case"punch_tag_quick_search":n.getProductEdition()>=20&&(this.onPunchTagQuickSearch(a,this.getPunchTagFilterData(),"punch_tag_id"),t=!0);break;case"status_id":this.onTypeChange(!0);break;case"user_id":case"user_ids":this.setEditMenu(),this.setAbsencePolicyWhenUserChanged(),n.getProductEdition()>=20&&(this.edit_view_ui_dic.job_id&&this.setJobValueWhenUserChanged(this.edit_view_ui_dic.job_id.getValue(!0),"job_id",{status_id:10,user_id:this.edit_view_ui_dic[s].getValue()}),this.setPunchTagValuesWhenCriteriaChanged(this.getPunchTagFilterData(),"punch_tag_id"));return;case"start_date_stamps":this.setEditMenu(),this.current_edit_record.start_date_stamp=a;break}if(s=="absence_policy_id"&&(this.previous_absence_policy_id=this.current_edit_record.absence_policy_id),s==="date_stamp"||s==="start_date_stamps"||s==="start_date_stamp"||s==="start_time"||s==="end_time"||s==="schedule_policy_id"||s==="absence_policy_id")if(this.current_edit_record.date_stamp!==""&&this.current_edit_record.start_time!==""&&this.current_edit_record.end_time!==""){var l=this.current_edit_record.date_stamp+" "+this.current_edit_record.start_time,d=this.current_edit_record.date_stamp+" "+this.current_edit_record.end_time,o=this.current_edit_record.schedule_policy_id,r=this.current_edit_record.user_id;this.api.getScheduleTotalTime(l,d,o,r,{onResult:function(c){!i.edit_view||!i.current_edit_record||!i.edit_view_ui_dic.total_time||(c&&c.isValid()&&c.getResult()?c=c.getResult():c=i.current_edit_record.total_time?i.current_edit_record.total_time:0,i.current_edit_record.total_time=c,c=n.getTimeUnit(c),i.edit_view_ui_dic.total_time.setValue(c),i.onAvailableBalanceChange())}})}else this.onAvailableBalanceChange();t||this.validate()}setAbsencePolicyWhenUserChanged(){var e=this,t=e.edit_view_ui_dic.absence_policy_id;t.setSourceData(null);var i=t.getValue(),s={};s.filter_data={id:i},s=this.setAbsencePolicyFilter(s),i?e.absence_policy_api.getAbsencePolicy(s,{onResult:function(a){if(!(e.current_edit_record===null||e.current_edit_record===void 0)){var l=a.getResult();l.length>0?(t.setValue(i),e.current_edit_record.absence_policy_id=i):(t.setValue(!1),e.current_edit_record.absence_policy_id=!1),e.onAvailableBalanceChange(),e.validate()}}}):(this.onAvailableBalanceChange(),this.validate())}validate(){var e=this,t={};if(this.is_mass_adding)t=[],_.each(this.select_cells_Array,function(r,c){if(c.hasOwnProperty("user_id")&&c.hasOwnProperty("date")&&c.date){var u=n.clone(e.current_edit_record);delete u.user_ids,delete u.start_dates,u.id="",u.user_id=c.user_id,u.start_date_stamp=c.date,u=e.buildMassAddRecord(u),t.push(u)}});else if(this.is_mass_editing){for(var i in this.edit_view_ui_dic)if(this.edit_view_ui_dic.hasOwnProperty(i)){var s=this.edit_view_ui_dic[i];n.isSet(s.isChecked)&&s.isChecked()&&s.getEnabled()&&(t[i]=s.getValue())}if(this.mass_edit_record_ids.length>0){var a=t;t=[],_.each(this.mass_edit_record_ids,function(r,c){var u=n.clone(a);u.id=c,u=e.processAddRecord(u),t.push(u)}),_.each(this.select_all_shifts_array,function(r,c){if(!c.id||c.id==TTUUID.zero_id){var u=n.clone(c);for(var h in a)u[h]=a[h];u=e.processAddRecord(u),t.push(u)}}),t=this.getRecordsFromUserIDs(t)}else{var l=[];_.each(this.select_all_shifts_array,function(r,c){if(!c.id||c.id==TTUUID.zero_id){var u=n.clone(c);for(var h in t)u[h]=t[h];u=e.processAddRecord(u),l.push(u)}}),l.length<1?this.select_cells_Array.length>0&&(e.processAddRecord(t),t=this.getRecordsFromUserIDs([t])):(t=l,t=this.getRecordsFromUserIDs(t))}}else if(this.current_edit_record&&this.current_edit_record.start_date_stamp&&(this.current_edit_record.start_date_stamp.indexOf(" - ")>0||_.type(this.current_edit_record.start_date_stamp)==="array")){this.current_edit_record.start_date_stamp.indexOf(" - ")>0&&(this.current_edit_record.start_date_stamp=this.parserDatesRange(this.current_edit_record.start_date_stamp)),t=[];for(var d=0;d<this.current_edit_record.start_date_stamp.length;d++){var o=n.clone(e.current_edit_record);o.start_date_stamp=this.current_edit_record.start_date_stamp[d],this.select_cells_Array.length>0&&e.processAddRecord(o),t.push(o)}t=this.getRecordsFromUserIDs(t)}else t=n.clone(this.current_edit_record),this.select_cells_Array.length>0&&e.processAddRecord(t),t=this.getRecordsFromUserIDs([t]);this.api["validate"+this.api.key_name](t,{onResult:function(r){e.validateResult(r)}})}getRecordsFromUserIDs(e){for(var t=[],i=0;i<e.length;i++){var s=e[i];if(s.user_ids&&s.user_ids.length>0)for(var a=0;a<s.user_ids.length;a++){var l=s.user_ids[a];n.isObject(l)&&l.id&&(l=l.id);var d=n.clone(s);d.user_id=l,t.push(d)}else(!this.current_edit_record||!this.current_edit_record.id||this.current_edit_record.id==TTUUID.zero_id)&&!this.is_mass_editing&&(s.user_id=TTUUID.zero_id),t.push(s)}return t}onSaveAndCopy(e){var t=this;n.isSet(e)||(e=!1),this.is_add=!0,this.is_changed=!1,LocalCacheData.current_doing_context_action="save_and_copy";var i=this.current_edit_record;if(i=this.processAddRecord(i),i=this.getRecordsFromUserIDs([i]),this.current_edit_record.start_date_stamp.indexOf(" - ")>0||_.type(this.current_edit_record.start_date_stamp)==="array"){this.current_edit_record.start_date_stamp.indexOf(" - ")>0&&(this.current_edit_record.start_date_stamp=this.parserDatesRange(this.current_edit_record.start_date_stamp)),i=[];for(var s=0;s<this.current_edit_record.start_date_stamp.length;s++){var a=n.clone(t.current_edit_record);a.start_date_stamp=this.current_edit_record.start_date_stamp[s],a=this.processAddRecord(a),i.push(a)}i=this.getRecordsFromUserIDs(i)}this.clearNavigationData(),this.api["set"+this.api.key_name](i,!1,!1,e,{onResult:function(l){if(t.current_edit_record){var d=t.current_edit_record.start_date_stamp;_.type(d)==="array"&&(d=d[d.length-1]);var o=n.strToDate(d),r=new Date(new Date(o.getTime()).setDate(o.getDate()+1));t.current_edit_record.start_date_stamp=r.format(),t.onSaveAndCopyResult(l)}}})}onSaveAndNewClick(e){var t=this;n.isSet(e)||(e=!1),this.setCurrentEditViewState("new");var i=this.current_edit_record;if(i=this.processAddRecord(i),i=this.getRecordsFromUserIDs([i]),this.current_edit_record.start_date_stamp.indexOf(" - ")>0||_.type(this.current_edit_record.start_date_stamp)==="array"){this.current_edit_record.start_date_stamp.indexOf(" - ")>0&&(this.current_edit_record.start_date_stamp=this.parserDatesRange(this.current_edit_record.start_date_stamp)),i=[];for(var s=0;s<this.current_edit_record.start_date_stamp.length;s++){var a=n.clone(t.current_edit_record);a.start_date_stamp=this.current_edit_record.start_date_stamp[s],a=this.processAddRecord(a),i.push(a)}i=this.getRecordsFromUserIDs(i)}this.api["set"+this.api.key_name](i,!1,e,{onResult:function(l){t.onSaveAndNewResult(l)}})}buildSelectedCellsRecord(){var e=this,t=[];return _.each(this.select_cells_Array,function(i,s){if(s.hasOwnProperty("user_id")&&s.hasOwnProperty("date")&&s.date){var a=n.clone(e.current_edit_record);delete a.user_ids,delete a.start_dates,a.id="",a.user_id=s.user_id,a.start_date_stamp=s.date,a=e.buildMassAddRecord(a),t.push(a)}}),t}buildMassAddRecord(e){for(var t=this._createParametersForAdd(),i=0,s=t.length;i<s;i++){var a=t[i];e.user_id===a.user_id&&(e.branch_id=="-2"?e.branch_id=a.branch_id:e.branch_id,e.department_id=="-2"?e.department_id=a.department_id:e.department_id,e.job_id=="-2"?e.job_id=a.job_id:e.job_id,e.job_item_id=="-2"?e.job_item_id=a.job_item_id:e.job_item_id,e.punch_tag_id=="-2"?e.punch_tag_id=a.punch_tag_id:e.punch_tag_id)}return e}processAddRecord(e){for(var t=this._createParametersForAdd(),i=0,s=t.length;i<s;i++){var a=t[i];e.branch_id=="-2"?e.branch_id=a.branch_id:e.branch_id,e.department_id=="-2"?e.department_id=a.department_id:e.department_id,e.job_id=="-2"?e.job_id=a.job_id:e.job_id,e.job_item_id=="-2"?e.job_item_id=a.job_item_id:e.job_item_id,e.punch_tag_id=="-2"?e.punch_tag_id=a.punch_tag_id:e.punch_tag_id;break}return e}getSelectedId(e,t,i){for(var s=0,a=i.length;s<a;s++){var l=i[s];e.user_id===l.user_id&&(e[t]=l[t])}}onSaveAndContinue(e){var t=this;n.isSet(e)||(e=!1),this.is_changed=!1,this.is_add=!1,LocalCacheData.current_doing_context_action="save_and_continue";var i=this.current_edit_record;if(i=this.processAddRecord(i),i=this.uniformVariable(i),this.current_edit_record.start_date_stamp&&(this.current_edit_record.start_date_stamp.indexOf(" - ")>0||_.type(this.current_edit_record.start_date_stamp)==="array")){this.current_edit_record.start_date_stamp.indexOf(" - ")>0&&(this.current_edit_record.start_date_stamp=this.parserDatesRange(this.current_edit_record.start_date_stamp)),i=[];for(var s=0;s<this.current_edit_record.start_date_stamp.length;s++){var a=n.clone(t.current_edit_record);a.start_date_stamp=this.current_edit_record.start_date_stamp[s],a=this.processAddRecord(a),i.push(a)}i=this.getRecordsFromUserIDs(i)}else i=this.getRecordsFromUserIDs([i]);this.api["set"+this.api.key_name](i,!1,e,{onResult:function(l){t.previous_absence_policy_id=!1,t.onSaveAndContinueResult(l)}})}onSaveClick(e){var t=this,i;if(n.isSet(e)||(e=!1),LocalCacheData.current_doing_context_action="save",this.is_mass_adding)i=this.buildSelectedCellsRecord();else if(this.is_mass_editing){var s=this.getChangedFields();i=[],_.each(this.mass_edit_record_ids,function(d,o){var r=n.clone(s);r.id=o,r=t.processAddRecord(r),i.push(r)}),_.each(this.select_all_shifts_array,function(d,o){if(!o.id||o.id==TTUUID.zero_id){var r=n.clone(o);for(var c in s)r[c]=s[c];r=t.processAddRecord(r),i.push(r)}})}else if(this.current_edit_record.start_date_stamp.indexOf(" - ")>0||_.type(this.current_edit_record.start_date_stamp)==="array"){this.current_edit_record.start_date_stamp.indexOf(" - ")>0&&(this.current_edit_record.start_date_stamp=this.parserDatesRange(this.current_edit_record.start_date_stamp)),i=[];for(var a=0;a<this.current_edit_record.start_date_stamp.length;a++){var l=n.clone(t.current_edit_record);l.start_date_stamp=this.current_edit_record.start_date_stamp[a],l=t.processAddRecord(l),i.push(l)}i=this.getRecordsFromUserIDs(i)}else i=this.current_edit_record,i=t.processAddRecord(i),i=this.getRecordsFromUserIDs([i]);this.api["set"+this.api.key_name](i,!1,e,{onResult:function(d){if(d&&d.isValid()){var o=d.getResult();o===!0&&t.current_edit_record?t.refresh_id=t.current_edit_record.id:TTUUID.isUUID(o)&&o!=TTUUID.zero_id&&o!=TTUUID.not_exist_id&&(t.refresh_id=o),t.search(!1,!1),t.previous_absence_policy_id=!1,t.removeEditView()}else t.setErrorTips(d),t.setErrorMenu()}})}removeEditView(){super.removeEditView(),this.setMoveOrDropMode(this.select_drag_menu_id?this.select_drag_menu_id:"move"),this.selected_user_ids=[],this.is_mass_adding=!1}setEditMenuSaveAndContinueIcon(e){this.saveAndContinueValidate(e),(this.is_mass_editing||this.is_viewing||this.is_mass_adding||this.isMassEmployeeOrDate())&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}isMassEmployeeOrDate(){return!!(this.current_edit_record&&this.current_edit_record.start_date_stamps&&(this.current_edit_record.start_date_stamps.indexOf(" - ")>0||_.type(this.current_edit_record.start_date_stamps)==="array"&&this.current_edit_record.start_date_stamps.length>1)||this.current_edit_record&&this.current_edit_record.user_ids&&this.current_edit_record.user_ids.length>1)}setEditMenuSaveAndAddIcon(e){this.saveAndNewValidate(e),(this.is_viewing||this.is_mass_editing||this.is_mass_adding)&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setEditMenuSaveAndCopyIcon(e){this.saveAndCopyValidate(e),(this.is_viewing||this.is_mass_editing||this.is_mass_adding)&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}onTypeChange(e){this.current_edit_record.status_id==20?this.attachElement("absence_policy_id"):this.detachElement("absence_policy_id")}setEditViewData(){var e=this;super.setEditViewData(),e.onTypeChange(!1)}checkOpenPermission(){return!!(n.getProductEdition()>=15&&PermissionManager.validate("schedule","view_open"))}getCustomFieldReferenceField(){return"note"}buildEditViewUI(){var e=this,t,i;ContextMenuManager.getMenu(this.determineContextMenuMountAttributes().id)===void 0?this.buildContextMenu():Debug.Warn("Context Menu ("+this.determineContextMenuMountAttributes().id+") already exists for: "+this.viewId,"ScheduleViewController.js","ScheduleViewController","buildEditViewUI",10),this.edit_view_close_icon=this.edit_view.find(".close-icon"),this.edit_view_close_icon.hide(),this.edit_view_close_icon.click(function(){e.onCloseIconClick()});var s={tab_schedule:{label:_.i18n._("Schedule")},tab_audit:!0};this.setTabModel(s);var a=this.edit_view_tab.find("#tab_schedule"),l=a.find(".first-column");n.getProductEdition(),t=n.loadWidgetByName(FormItemType.AWESOME_BOX),t.AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!1,layout_name:"global_user",show_search_inputs:!0,set_empty:!this.checkOpenPermission(),set_open:this.checkOpenPermission(),field:"user_id"});var d={};if(d.permission_section="schedule",t.setDefaultArgs(d),this.addEditFieldToColumn(_.i18n._("Employee"),t,l,"",null,!0),t=n.loadWidgetByName(FormItemType.AWESOME_BOX),t.AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!0,layout_name:"global_user",show_search_inputs:!0,set_empty:!this.checkOpenPermission(),set_open:this.checkOpenPermission(),addition_source_function:function(u,h){return e.onEmployeeSourceCreate(u,h)},field:"user_ids"}),d={},d.permission_section="schedule",t.setDefaultArgs(d),this.addEditFieldToColumn(_.i18n._("Employee"),t,l,"",null,!0),t=n.loadWidgetByName(FormItemType.COMBO_BOX),t.TComboBox({field:"status_id"}),t.setSourceData(e.status_array),this.addEditFieldToColumn(_.i18n._("Status"),t,l),t=n.loadWidgetByName(FormItemType.AWESOME_BOX),t.AComboBox({api_class:TTAPI.APIAbsencePolicy,allow_multiple_selection:!1,layout_name:"global_absences",show_search_inputs:!0,set_empty:!0,field:"absence_policy_id"}),t.customSearchFilter=function(u){return e.setAbsencePolicyFilter(u)},this.addEditFieldToColumn(_.i18n._("Absence Policy"),t,l,"",null,!0),t=n.loadWidgetByName(FormItemType.TEXT),t.TText({field:"available_balance"}),i=_("<div class='widget-h-box available-balance-h-box'></div>"),this.available_balance_info=_('<span class="available-balance-info tticon tticon-info_black_24dp"></span>'),i.append(t),i.append(this.available_balance_info),this.addEditFieldToColumn(_.i18n._("Available Balance"),t,l,"",i,!0),(!this.current_edit_record||this.current_edit_record.user_ids&&this.current_edit_record.user_ids.length>1)&&this.detachElement("available_balance"),t=n.loadWidgetByName(FormItemType.DATE_PICKER),t.TDatePicker({field:"start_date_stamp",validation_field:"date_stamp"}),this.addEditFieldToColumn(_.i18n._("Date"),t,l,"",null,!0),t=n.loadWidgetByName(FormItemType.DATE_PICKER),t.TRangePicker({field:"start_date_stamps"}),this.addEditFieldToColumn(_.i18n._("Date"),t,l,"",null,!0),t=n.loadWidgetByName(FormItemType.AWESOME_BOX),t.AComboBox({allow_multiple_selection:!0,layout_name:"global_option_column",show_search_inputs:!1,set_empty:!0,field:"start_dates"}),this.addEditFieldToColumn(_.i18n._("Date"),t,l,"",null,!0),t=n.loadWidgetByName(FormItemType.TIME_PICKER),t.TTimePicker({field:"start_time"}),this.addEditFieldToColumn(_.i18n._("In"),t,l,"",null,!0),t=n.loadWidgetByName(FormItemType.TIME_PICKER),t.TTimePicker({field:"end_time"}),this.addEditFieldToColumn(_.i18n._("Out"),t,l,"",null,!0),t=n.loadWidgetByName(FormItemType.TEXT),t.TText({field:"total_time"}),t.css("cursor","pointer"),this.addEditFieldToColumn(_.i18n._("Total"),t,l),t=n.loadWidgetByName(FormItemType.AWESOME_BOX),t.AComboBox({api_class:TTAPI.APISchedulePolicy,allow_multiple_selection:!1,layout_name:"global_schedule",show_search_inputs:!0,set_empty:!0,field:"schedule_policy_id"}),this.addEditFieldToColumn(_.i18n._("Schedule Policy"),t,l),t=n.loadWidgetByName(FormItemType.AWESOME_BOX),t.AComboBox({api_class:TTAPI.APIBranch,allow_multiple_selection:!1,layout_name:"global_branch",show_search_inputs:!0,set_empty:!0,field:"branch_id",addition_source_function:function(u,h){return e.onSourceDataCreate(u,h)},added_items:[{value:TTUUID.not_exist_id,label:n.default_item},{value:"-2",label:n.selected_item}]}),this.addEditFieldToColumn(_.i18n._("Branch"),t,l,"",null,!0),this.show_branch_ui||this.detachElement("branch_id"),t=n.loadWidgetByName(FormItemType.AWESOME_BOX),t.AComboBox({api_class:TTAPI.APIDepartment,allow_multiple_selection:!1,layout_name:"global_department",show_search_inputs:!0,set_empty:!0,field:"department_id",addition_source_function:function(u,h){return e.onSourceDataCreate(u,h)},added_items:[{value:TTUUID.not_exist_id,label:n.default_item},{value:"-2",label:n.selected_item}]}),this.addEditFieldToColumn(_.i18n._("Department"),t,l,"",null,!0),this.show_department_ui||this.detachElement("department_id"),n.getProductEdition()>=20){t=n.loadWidgetByName(FormItemType.AWESOME_BOX),t.AComboBox({api_class:TTAPI.APIJob,allow_multiple_selection:!1,layout_name:"global_job",show_search_inputs:!0,set_empty:!0,setRealValueCallBack:function(u){u&&o.setValue(u.manual_id)},field:"job_id",addition_source_function:function(u,h){return e.onSourceDataCreate(u,h)},added_items:[{value:TTUUID.not_exist_id,label:n.default_item},{value:"-2",label:n.selected_item}]}),i=_("<div class='widget-h-box'></div>");var o=n.loadWidgetByName(FormItemType.TEXT_INPUT);o.TTextInput({field:"job_quick_search",disable_keyup_event:!0}),o.addClass("job-coder"),i.append(o),i.append(t),this.addEditFieldToColumn(_.i18n._("Job"),[t,o],l,"",i,!0),this.show_job_ui||this.detachElement("job_id"),t=n.loadWidgetByName(FormItemType.AWESOME_BOX),t.AComboBox({api_class:TTAPI.APIJobItem,allow_multiple_selection:!1,layout_name:"global_job_item",show_search_inputs:!0,set_empty:!0,setRealValueCallBack:function(u){u&&r.setValue(u.manual_id)},field:"job_item_id",addition_source_function:function(u,h){return e.onSourceDataCreate(u,h)},added_items:[{value:TTUUID.not_exist_id,label:n.default_item},{value:"-2",label:n.selected_item}]}),i=_("<div class='widget-h-box'></div>");var r=n.loadWidgetByName(FormItemType.TEXT_INPUT);r.TTextInput({field:"job_item_quick_search",disable_keyup_event:!0}),r.addClass("job-coder"),i.append(r),i.append(t),this.addEditFieldToColumn(_.i18n._("Task"),[t,r],l,"",i,!0),this.show_job_item_ui||this.detachElement("job_item_id"),t=n.loadWidgetByName(FormItemType.AWESOME_BOX),t.AComboBox({api_class:TTAPI.APIPunchTag,allow_multiple_selection:!0,layout_name:"global_punch_tag",show_search_inputs:!0,set_empty:!0,get_real_data_on_multi:!0,setRealValueCallBack:(u,h)=>{u&&this.setPunchTagQuickSearchManualIds(u,h)},field:"punch_tag_id",addition_source_function:function(u,h){return e.onSourceDataCreatePunchTag(u,h)},added_items:[{value:TTUUID.not_exist_id,label:n.default_item}]}),i=_("<div class='widget-h-box'></div>");var c=n.loadWidgetByName(FormItemType.TEXT_INPUT);c.TTextInput({field:"punch_tag_quick_search",disable_keyup_event:!0}),c.addClass("job-coder"),i.append(c),i.append(t),this.addEditFieldToColumn(_.i18n._("Tags"),[t,c],l,"",i,!0),this.show_punch_tag_ui||this.detachElement("punch_tag_id")}t=n.loadWidgetByName(FormItemType.TEXT_AREA),t.TTextArea({field:"note",width:"100%"}),this.addEditFieldToColumn(_.i18n._("Note"),t,l,"",null,null,!0),t.parent().width("45%"),n.getProductEdition()>=15&&this.is_viewing==!1&&(t=n.loadWidgetByName(FormItemType.CHECKBOX),t.TCheckbox({field:"notify_user_schedule_change"}),this.addEditFieldToColumn(_.i18n._("Notify Employee"),t,l,"",null,!0)),TTPromise.resolve("Schedule","init")}setDefaultMenuDeleteIcon(e,t){(!this.deletePermissionValidate("schedule")||this.edit_only_mode)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),t>0&&this.deleteOwnerOrChildPermissionValidate("schedule")?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}onAvailableBalanceChange(){this.current_edit_record.status_id==20&&this.current_edit_record.hasOwnProperty("absence_policy_id")&&this.current_edit_record.absence_policy_id&&!this.is_mass_editing?this.getAvailableBalance():this.detachElement("available_balance")}parserDatesRange(e){for(var t=e.split(" - "),i=[],s=n.strToDate(t[0]),a=n.strToDate(t[1]),l=s;l.getTime()<a.getTime();)i.push(l.format()),l=new Date(new Date(l.getTime()).setDate(l.getDate()+1));return i.push(t[1]),i}getSelectUsersArray(){for(var e=[],t=this.select_cells_Array,i=t.length,s={},a=0;a<i;a++){var l=t[a];l.user_id||(l.user_id=TTUUID.zero_id),s[l.user_id]=!0}for(var d in s)e.push(d);return e.length===0&&e.push(this.getDefaultUser()),e}getSelectDateArray(){for(var e=[],t=this.select_cells_Array,i=t.length,s={},a=0;a<i;a++){var l=t[a];l.date&&(s[l.date]=!0)}for(var d in s)e.push(d);return e}getAvailableBalance(){if(n.isSet(this.current_edit_record)!=!1){var e=this,t=this.current_edit_record.user_id,i=this.current_edit_record.total_time,s=this.current_edit_record.start_date_stamp;if(this.previous_absence_policy_id==!1&&(this.previous_absence_policy_id=this.current_edit_record.absence_policy_id),this.is_mass_adding){if(this.current_edit_record.user_ids.length>1){this.detachElement("available_balance");return}else if(t=this.current_edit_record.user_ids[0],!t){this.detachElement("available_balance");return}i=i*this.current_edit_record.start_dates.length,s=this.current_edit_record.start_dates[this.current_edit_record.start_dates.length-1]}else if(_.type(s)==="string"&&s.indexOf(" - ")>0&&(s=this.parserDatesRange(s)),_.type(s)==="array"&&s.length>0&&(i=i*s.length,s=s[s.length-1]),(!this.current_edit_record||!this.current_edit_record.id||this.current_edit_record.id==TTUUID.zero_id)&&!this.is_mass_editing){if(this.current_edit_record.user_ids.length<1||this.current_edit_record.user_ids.length>1){this.detachElement("available_balance");return}else if(t=this.current_edit_record.user_ids[0],!t){this.detachElement("available_balance");return}}this.current_edit_record&&this.current_edit_record.id&&this.prev_status_id==10&&this.edit_view_ui_dic.status_id.getValue()==20&&(this.prev_total_time=0),this.current_edit_record.absence_policy_id!=TTUUID.zero_id?this.api_absence_policy.getProjectedAbsencePolicyBalance(this.current_edit_record.absence_policy_id,t,s,i,this.prev_total_time,this.previous_absence_policy_id,{onResult:function(a){e.getBalanceHandler(a,s)}}):this.getBalanceHandler(!1,s)}}buildSearchAndLayoutUI(){var e=this.search_panel.find("div #saved_layout_content_div"),t=_(_.fn.SearchPanel.html.form_item),i=t.find(".form-item-label"),s=t.find(".form-item-input-div");this.column_selector=n.loadWidgetByName(FormItemType.AWESOME_DROPDOWN),this.column_selector=this.column_selector.ADropDown({display_show_all:!1,id:"column_selector",key:"value",allow_drag_to_order:!0,display_close_btn:!1,display_column_settings:!1,static_height:150}),i.text(_.i18n._("Display Columns")),s.append(this.column_selector),e.append(t),e.append("<div class='clear-both-div'></div>"),this.column_selector.setColumns([{name:"label",index:"label",label:_.i18n._("Column Name"),width:100,sortable:!1}]),t=_(_.fn.SearchPanel.html.form_item),i=t.find(".form-item-label"),s=t.find(".form-item-input-div"),i.text(_.i18n._("Save Search As")),this.save_search_as_input=n.loadWidgetByName(FormItemType.TEXT_INPUT),this.save_search_as_input.TTextInput();var a=_(`<button class="tt-button p-button p-component small-search-panel-button" type="button">
<span class="tticon tticon-save_black_24dp"></span>
<span class="p-button-label">`+_.i18n._("Save")+`</span>
</button>`);s.append(this.save_search_as_input),s.append(a);var l=this;a.click(function(){l.onSaveNewLayout()}),this.previous_saved_layout_div=_("<div class='previous-saved-layout-div'></div>"),s.append(this.previous_saved_layout_div),i=_("<span style='margin-left: 5px' >"+_.i18n._("Previous Saved Searches")+":</span>"),this.previous_saved_layout_div.append(i),this.previous_saved_layout_selector=_("<select style='margin-left: 5px' class='t-select'>");var d=_(`<button class="tt-button p-button p-component small-search-panel-button" type="button">
<span class="tticon tticon-save_black_24dp"></span>
<span class="p-button-label">`+_.i18n._("Update")+`</span>
</button>`),o=_(`<button class="tt-button p-button p-component small-search-panel-button" type="button">
<span class="tticon tticon-delete_black_24dp"></span>
<span class="p-button-label">`+_.i18n._("Delete")+`</span>
</button>`);d.click(function(){l.onUpdateLayout()}),o.click(function(){l.onDeleteLayout()}),this.previous_saved_layout_div.append(this.previous_saved_layout_selector),this.previous_saved_layout_div.append(d),this.previous_saved_layout_div.append(o),e.append(t),this.previous_saved_layout_div.css("display","none")}setCurrentEditRecordData(){var e=this;this.is_mass_adding?(this.attachElement("start_dates"),this.detachElement("start_date_stamp"),this.detachElement("start_date_stamps"),this.attachElement("user_ids"),this.detachElement("user_id"),this.edit_view_ui_dic.start_dates.setEnabled(!1),this.edit_view_ui_dic.user_ids.setEnabled(!1)):(this.detachElement("start_dates"),this.current_edit_record.id&&this.current_edit_record.id!=TTUUID.zero_id||this.is_mass_editing?(this.attachElement("start_date_stamp"),this.detachElement("start_date_stamps"),this.detachElement("user_ids"),this.attachElement("user_id")):(this.attachElement("start_date_stamps"),this.detachElement("start_date_stamp"),this.current_edit_record.start_date_stamps=this.current_edit_record.start_date_stamp,this.attachElement("user_ids"),this.detachElement("user_id"))),this.prev_total_time=0,this.current_edit_record.id&&this.current_edit_record.id!=TTUUID.zero_id&&(this.prev_status_id=this.current_edit_record.status_id);for(var t in this.current_edit_record){var i=this.edit_view_ui_dic[t];if(n.isSet(i))switch(t){case"user_ids":if(i.is(":visible")){var s=this.getSelectUsersArray();this.current_edit_record[t]=s,i.setValue(s)}break;case"start_dates":var a=this.getSelectDateArray();this.current_edit_record[t]=a,a=n.buildRecordArray(a),i.setSourceData(a),i.setValue(a);break;case"total_time":this.current_edit_record.id&&this.current_edit_record.id!=TTUUID.zero_id&&(this.prev_total_time=this.current_edit_record[t]);var l=this.current_edit_record.date_stamp+" "+this.current_edit_record.start_time,d=this.current_edit_record.date_stamp+" "+this.current_edit_record.end_time,o=this.current_edit_record.schedule_policy_id,r=this.current_edit_record.user_id,c=this.api.getScheduleTotalTime(l,d,o,r,{async:!1});c&&c.isValid()&&c.getResult()?c=c.getResult():c=!1,this.current_edit_record.total_time=c,i.setValue(n.getTimeUnit(c));break;case"job_id":if(n.getProductEdition()>=20){var r=!1;this.edit_view_ui_dic.user_ids&&this.edit_view_ui_dic.user_ids.is(":visible")?(r=this.getSelectUsersArray(),r.length==1?r=r[0]:r=!1):r=this.current_edit_record.user_id;var u={};u.filter_data={status_id:10,user_id:r,punch_branch_id:this.current_edit_record.branch_id,punch_department_id:this.current_edit_record.department_id},i.setDefaultArgs(u),i.setValue(this.current_edit_record[t])}break;case"job_item_id":if(n.getProductEdition()>=20){var u={};u.filter_data={status_id:10,job_id:this.current_edit_record.job_id},i.setDefaultArgs(u),i.setValue(this.current_edit_record[t])}break;case"punch_tag_id":if(n.getProductEdition()>=20){i.setValue(this.current_edit_record[t]),this.previous_punch_tag_selection=this.current_edit_record[t];var h=i;TTPromise.wait(null,null,function(){var m={};m.filter_data=e.getPunchTagFilterData(),h.setDefaultArgs(m)})}break;case"branch_id":if(n.getProductEdition()>=20){var u={};u.filter_data={user_id:this.current_edit_record.user_id},i.setDefaultArgs(u)}i.setValue(this.current_edit_record[t]);break;case"department_id":if(n.getProductEdition()>=20){var u={};u.filter_data={user_id:this.current_edit_record.user_id,branch_id:this.current_edit_record.branch_id},i.setDefaultArgs(u)}i.setValue(this.current_edit_record[t]);break;case"punch_tag_quick_search":break;case"job_quick_search":break;case"job_item_quick_search":break;default:i.setValue(this.current_edit_record[t]);break}}this.onAvailableBalanceChange(),this.setEditViewDataDone()}setAbsencePolicyFilter(e){var t;return e.filter_data||(e.filter_data={}),this.is_mass_editing?this.edit_view_ui_dic.user_id.isChecked()?e.filter_data.user_id=this.current_edit_record.user_id:e.filter_data.user_id=this.selected_user_ids:!this.current_edit_record||!this.current_edit_record.id||this.current_edit_record.id==TTUUID.zero_id?e.filter_data.user_id=((t=this.current_edit_record)==null?void 0:t.user_ids)||null:e.filter_data.user_id=this.current_edit_record.user_id,e.filter_columns&&(e.filter_columns.absence_policy=!0),e}setDefaultMenuCopyIcon(e,t){this.copyPermissionValidate()||ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),t>=1?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuCopyAsNewIcon(e,t){this.copyAsNewPermissionValidate()||ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),t===1?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setCustomEditMenuIcon(e,t){switch(e){case"import_icon":this.setEditMenuImportIcon(t);break;case"AutoPunch":this.setEditMenuAutoPunchIcon(t);break;case"AddRequest":this.setEditMenuAddRequestIcon(t);break;case"find_available":this.setEditMenuFindAvailableIcon(t);break}}_getGridSelectedLength(){var e=0;return e=this.select_all_shifts_array.length,e}setCustomDefaultMenuIcon(e,t,i){switch(e){case"move":this.movePermissionValidate()||ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,t.id,!1);break;case"drag_copy":this.copyPermissionValidate()||ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,t.id,!1);break;case"swap":this.editPermissionValidate()||ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,t.id,!1);break;case"override":!this.editPermissionValidate()&&!this.movePermissionValidate()&&!this.copyPermissionValidate()&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,t.id,!1);break;case"edit_employee":this.setDefaultMenuEditEmployeeIcon(t,i);break;case"import_icon":this.setDefaultMenuImportIcon(t,i);break;case"timesheet":this.setDefaultMenuEditTimesheetIcon(t,i);break;case"find_available":this.setDefaultMenuFindAvailabletIcon(t,i);break;case"AutoPunch":this.setAutoPunchIcon(t,i);break;case"AddRequest":this.setAddRequestIcon(t,i);break}}setDefaultMenu(e){super.setDefaultMenu(e,this._getGridSelectedLength()),this.setMoveOrDropMode(this.select_drag_menu_id?this.select_drag_menu_id:"move")}enableAddRequestButton(){var i=[];if(!this.select_cellls_and_shifts_array)return!1;var e=this.select_cellls_and_shifts_array,t=e.length;if(t==1)return!0;if(t==0)return!1;for(var i=this.select_cells_Array,s=i[0],a=1;a<i.length;a++){if(i[a].user_id&&s.user_id!=i[a].user_id)return Debug.Text("mismatch on user_id","ScheduleViewController.js","ScheduleViewController","enableAddRequestButton",10),!1;if(i[a].shift!=null)if(s.shift&&i[a].shift){if(s.shift.start_time!=i[a].shift.start_time)return Debug.Text("mismatch on start_time","ScheduleViewController.js","ScheduleViewController","enableAddRequestButton",10),!1;if(s.shift.end_time!=i[a].shift.end_time)return Debug.Text("mismatch on end_time","ScheduleViewController.js","ScheduleViewController","enableAddRequestButton",10),!1;if(s.shift.branch_id!=i[a].shift.branch_id)return Debug.Text("mismatch on branch_id","ScheduleViewController.js","ScheduleViewController","enableAddRequestButton",10),!1;if(s.shift.department_id!=i[a].shift.department_id)return Debug.Text("mismatch on department_id","ScheduleViewController.js","ScheduleViewController","enableAddRequestButton",10),!1;if(s.shift.job_id!=i[a].shift.job_id)return Debug.Text("mismatch on job_id","ScheduleViewController.js","ScheduleViewController","enableAddRequestButton",10),!1;if(s.shift.job_item_id!=i[a].shift.job_item_id)return Debug.Text("mismatch on job_item_id","ScheduleViewController.js","ScheduleViewController","enableAddRequestButton",10),!1;if(s.shift.punch_tag_id!=i[a].shift.punch_tag_id)return Debug.Text("mismatch on punch_tag_id","ScheduleViewController.js","ScheduleViewController","enableAddRequestButton",10),!1;if(s.shift.schedule_policy_id!=i[a].shift.schedule_policy_id)return Debug.Text("mismatch on schedule_policy_id","ScheduleViewController.js","ScheduleViewController","enableAddRequestButton",10),!1;if(s.shift.status_id!=i[a].shift.status_id)return Debug.Text("mismatch on status_id","ScheduleViewController.js","ScheduleViewController","enableAddRequestButton",10),!1;if(s.shift.status_id==20&&s.shift.absence_policy_id!=i[a].shift.absence_policy_id)return Debug.Text("mismatch on absence_policy_id","ScheduleViewController.js","ScheduleViewController","enableAddRequestButton",10),!1}else s.shift==null&&i[a].shift&&(s=i[a])}return Debug.Text("All Selected Schedules Match","ScheduleViewController.js","ScheduleViewController","enableAddRequestButton",10),!0}setAutoPunchIcon(e,t){t>0?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setEditMenuAutoPunchIcon(e,t){ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0)}setEditMenuAddRequestIcon(e,t){ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0)}setEditMenuFindAvailableIcon(e,t){ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0)}setDefaultMenuFindAvailabletIcon(e,t){this.editChildPermissionValidate()||ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),t>=1?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuEditTimesheetIcon(e,t){this.select_cells_Array.length===1&&TTUUID.isUUID(this.select_cells_Array[0].user_id)&&this.select_cells_Array[0].user_id!=TTUUID.zero_id?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuImportIcon(e,t,i){PermissionManager.checkTopLevelPermission("ImportCSVSchedule")===!0?ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuEditEmployeeIcon(e,t){this.editChildPermissionValidate("user")||ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),this.select_cells_Array.length===1&&TTUUID.isUUID(this.select_cells_Array[0].user_id)&&this.select_cells_Array[0].user_id!=TTUUID.zero_id?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}onUpdateLayout(){var e=_(this.previous_saved_layout_selector).children("option:selected").attr("value"),t=_(this.previous_saved_layout_selector).children("option:selected").text(),i=this.getSearchPanelDisplayColumns(),s=n.convertLayoutFilterToAPIFilter({data:{filter_data:this.getValidSearchFilter()}}),a={};a.id=e,a.data={},a.data.display_columns=i,a.data.filter_data=s,a.data.mode=n.upCaseFirstLetter(this.getMode()),a.data.strictRange=this.settings_menu.getButton("strict_range_btn").active,a.data.weeklyTotals=this.settings_menu.getButton("weekly_totals_btn").active,a.data.dailyTotals=this.settings_menu.getButton("daily_totals_btn").active,a.data.showAllEmp=this.settings_menu.getButton("all_employee_btn").active;var l=this;this.user_generic_data_api.setUserGenericData(a,{onResult:function(d){d&&d.isValid()&&(l.clearViewLayoutCache(),l.need_select_layout_name=t,l.initLayout())}})}onSaveNewLayout(e){if(n.isSet(e))var t=e;else t=this.save_search_as_input.getValue();if(!(!t||t.length<1)){var i=this.getSearchPanelDisplayColumns(),s=n.convertLayoutFilterToAPIFilter({data:{filter_data:this.getValidSearchFilter()}}),a={};a.script=this.script_name,a.name=t,a.is_default=!1,a.data={},a.data.display_columns=i,a.data.filter_data=s,a.data.mode=n.upCaseFirstLetter(this.getMode()),a.data.strictRange=this.settings_menu.getButton("strict_range_btn").active,a.data.weeklyTotals=this.settings_menu.getButton("weekly_totals_btn").active,a.data.dailyTotals=this.settings_menu.getButton("daily_totals_btn").active,a.data.showAllEmp=this.settings_menu.getButton("all_employee_btn").active;var l=this;this.user_generic_data_api.setUserGenericData(a,{onResult:function(d){d&&d.isValid()?(l.clearViewLayoutCache(),l.need_select_layout_name=t,l.initLayout()):TAlertManager.showErrorAlert(d)}})}}onClearSearch(){var e=!1;if(this.search_panel.getLayoutsArray()&&this.search_panel.getLayoutsArray().length>0){var t=_(this.previous_saved_layout_selector).children("option:contains('"+BaseViewController.default_layout_name+"')").attr("value"),i=BaseViewController.default_layout_name;this.clearSearchPanel(),this.filter_data=null,this.temp_adv_filter_data=null,this.temp_basic_filter_data=null,e=!0}else{this.clearSearchPanel(),this.filter_data=null,this.temp_adv_filter_data=null,this.temp_basic_filter_data=null,this.column_selector.setSelectGridData(this.default_display_columns),this.onSaveNewLayout(BaseViewController.default_layout_name);return}var s=this.getSearchPanelDisplayColumns(),a=n.convertLayoutFilterToAPIFilter({data:{filter_data:this.getValidSearchFilter()}});if(e){var l={};l.id=t,l.data={},l.data.display_columns=s,l.data.filter_data=a}l.data.mode=this.getMode();var d=this;this.user_generic_data_api.setUserGenericData(l,{onResult:function(o){o&&o.isValid()&&(d.clearViewLayoutCache(),d.need_select_layout_name=i,d.initLayout())}})}getSearchPanelDisplayColumns(){var e=[],t=this.column_selector.getSelectItems();return t&&t.length>0&&_.each(t,function(i,s){e.push(s.value)}),e}onSearch(e){if(this.temp_adv_filter_data=null,this.temp_basic_filter_data=null,this.getSearchPanelFilter(),this.search_panel.getLayoutsArray()&&this.search_panel.getLayoutsArray().length>0){var t=_(this.previous_saved_layout_selector).children("option:contains('"+BaseViewController.default_layout_name+"')").attr("value");if(!t){this.onSaveNewLayout(BaseViewController.default_layout_name);return}var i=BaseViewController.default_layout_name}else{this.onSaveNewLayout(BaseViewController.default_layout_name);return}var s=this.getSearchPanelDisplayColumns(),a=n.convertLayoutFilterToAPIFilter({data:{filter_data:this.getValidSearchFilter()}}),l={};l.id=t,l.data={},l.data.display_columns=s,l.data.filter_data=a,l.data.mode=n.upCaseFirstLetter(this.getMode()),l.data.strictRange=this.settings_menu.getButton("strict_range_btn").active,l.data.weeklyTotals=this.settings_menu.getButton("weekly_totals_btn").active,l.data.dailyTotals=this.settings_menu.getButton("daily_totals_btn").active,l.data.showAllEmp=this.settings_menu.getButton("all_employee_btn").active,ProgressBar.showOverlay();var d=this;this.user_generic_data_api.setUserGenericData(l,{onResult:function(o){o&&o.isValid()&&(d.clearViewLayoutCache(),d.need_select_layout_name=i,e||d.initLayout())}})}setSelectLayout(){var e=this;this.select_layout||(this.select_layout={id:""},this.select_layout.data={filter_data:{},filter_sort:{}},this.select_layout.data.display_columns=this.default_display_columns);var t=this.select_layout.data,i=this.buildDisplayColumns(t.display_columns);n.isSet(t.mode)&&t.mode!=""?e.setToggleButtonValue(t.mode.toLowerCase()):LocalCacheData.getAllURLArgs()&&LocalCacheData.getAllURLArgs().mode?e.setToggleButtonValue(LocalCacheData.getAllURLArgs().mode):e.setToggleButtonValue(T.WEEK),t.hasOwnProperty("strictRange")?t.strictRange?this.settings_menu.activateButton("strict_range_btn"):this.settings_menu.deactivateButton("strict_range_btn"):this.settings_menu.activateButton("strict_range_btn"),t.weeklyTotals?this.settings_menu.activateButton("weekly_totals_btn"):this.settings_menu.deactivateButton("weekly_totals_btn"),t.dailyTotals?this.settings_menu.activateButton("daily_totals_btn"):this.settings_menu.deactivateButton("daily_totals_btn"),t.showAllEmp?this.settings_menu.activateButton("all_employee_btn"):this.settings_menu.deactivateButton("all_employee_btn"),this.column_selector.setSelectGridData(i);var s=this.search_panel.getLayoutsArray();if(this.previous_saved_layout_selector.empty(),s&&s.length>0){this.previous_saved_layout_div.css("display","inline");for(var a=s.length,l=0;l<a;l++){var d=s[l];this.previous_saved_layout_selector.append(_('<option value="'+d.id+'"></option>').text(d.name))}_(this.previous_saved_layout_selector.find("option")).filter(function(){return _(this).attr("value")===e.select_layout.id}).prop("selected",!0).attr("selected",!0)}else this.previous_saved_layout_div.css("display","none");LocalCacheData.default_filter_for_next_open_view&&(this.select_layout.data.filter_data=LocalCacheData.default_filter_for_next_open_view.filter_data,this.setDatePickerValue(LocalCacheData.default_filter_for_next_open_view.select_date),this.select_layout.data.mode="Week",e.setToggleButtonValue(t.mode.toLowerCase()),LocalCacheData.default_filter_for_next_open_view=null),this.filter_data=this.select_layout.data.filter_data,this.setSearchPanelFilter(!0)}getMode(){if(this.toggle_button)return this.toggle_button.getValue()}search(e,t){if(LocalCacheData.current_open_primary_controller.viewId==="Schedule"||LocalCacheData.current_open_primary_controller.viewId==="FindAvailable"){this.clearSelection(e),this.setActionsButtonStatus(),this.final_schedule_data_array=[];var i=this,s=n.convertLayoutFilterToAPIFilter(this.select_layout),a,l=this.getMode();this.settings_menu.getButton("all_employee_btn").active&&(s.include_all_users=!0);var d=this.settings_menu.getButton("strict_range_btn").active;t||!this.end_date?(this.start_date===null||t?a=this.start_date_picker.getValue():a=i.start_date.format(),l===T.YEAR&&(this.year_mode_original_date=a)):d?l===T.YEAR?a=this.year_mode_original_date?this.year_mode_original_date:this.start_date_picker.getValue():l===T.MONTH?a=new Date(new Date(i.end_date.getTime()).setDate(i.end_date.getDate()-15)).format():a=i.end_date.format():a=i.start_date.format(),l===null||l==""||a==""||a=="Invalid date"?(n.sendErrorReport("ScheduleViewController invalid mode/date detected."),TAlertManager.showAlert(_.i18n._("Invalid schedule mode or date. Please try again."))):(LocalCacheData.last_schedule_selected_date=a,ProgressBar.showOverlay(),this.api.getCombinedSchedule({filter_data:s},a,l,d,{onResult:function(o){(LocalCacheData.current_open_primary_controller.viewId==="Schedule"||LocalCacheData.current_open_primary_controller.viewId==="FindAvailable")&&(i.full_schedule_data=o.getResult(),!(i.full_schedule_data===!0||!i.full_schedule_data||!i.full_schedule_data.schedule_dates)&&(i.start_date=n.strToDate(i.full_schedule_data.schedule_dates.start_display_date),i.end_date=n.strToDate(i.full_schedule_data.schedule_dates.end_display_date),i.buildCalendars(),e&&(i.setDefaultMenu(!0),i.autoOpenEditViewIfNecessary()),i.searchDone(),i.setWeekModeDragAble()))}}))}}searchDone(){_(".button-rotate").removeClass("button-rotate"),TTPromise.resolve("init","init")}getLastDateOfRow(e){var t=LocalCacheData.getLoginUserPreference().start_week_day==0?7:LocalCacheData.getLoginUserPreference().start_week_day;return e[t-1+"_time"]}setActionsButtonStatus(){if(this.settings_menu){var e=this.getMode();switch(this.settings_menu.enableButton("weekly_totals_btn"),this.settings_menu.enableButton("strict_range_btn"),this.settings_menu.enableButton("daily_totals_btn"),this.settings_menu.enableButton("all_employee_btn"),e){case T.DAY:this.settings_menu.disableButton("weekly_totals_btn"),this.settings_menu.disableButton("strict_range_btn");break;case T.WEEK:break;case T.MONTH:break;case T.YEAR:this.settings_menu.disableButton("weekly_totals_btn"),this.settings_menu.disableButton("daily_totals_btn");break}}}onOverrideClick(){var e=ContextMenuManager.getMenuModelByMenuId(this.determineContextMenuMountAttributes().id),t=e.find(i=>i.id==="override");t.active?this.is_override=!0:this.is_override=!1}onNotifyUserScheduleChangeClick(){var e=ContextMenuManager.getMenuModelByMenuId(this.determineContextMenuMountAttributes().id),t=e.find(i=>i.id==="notify_user_schedule_change");t.active?this.notify_user_schedule_change=!0:this.notify_user_schedule_change=!1}setMoveOrDropMode(e){if(!(this.is_edit||this.is_mass_editing||this.is_add)){var t=ContextMenuManager.getMenuModelByMenuId(this.determineContextMenuMountAttributes().id),i=t.find(r=>r.id==="drag_copy"),s=t.find(r=>r.id==="move"),a=t.find(r=>r.id==="swap");if(!(i===void 0||s===void 0||a===void 0)){ContextMenuManager.activateMenuItem(this.determineContextMenuMountAttributes().id,i.id,!0),ContextMenuManager.activateMenuItem(this.determineContextMenuMountAttributes().id,s.id,!0),ContextMenuManager.activateMenuItem(this.determineContextMenuMountAttributes().id,a.id,!0);var l=!1,d=!1;if(this.copyPermissionValidate()||(l=!0),this.movePermissionValidate()||(d=!0),this.editPermissionValidate(),d&&e==="move")ContextMenuManager.activateMenuItem(this.determineContextMenuMountAttributes().id,i.id,!1);else{var o=t.find(r=>r.id===e);ContextMenuManager.activateMenuItem(this.determineContextMenuMountAttributes().id,o.id,!1)}l&&d?this.select_drag_menu_id=null:this.select_drag_menu_id=e}}}setHolidayDataDic(){if(this.full_schedule_data.holiday_data)for(var e=0;e<this.full_schedule_data.holiday_data.length;e++){var t=this.full_schedule_data.holiday_data[e],i=n.strToDate(t.date_stamp).format(this.weekly_format);this.holiday_data_dic[i]=t}}buildCalendars(e){var i=this;if(this.grid_div=_(this.el).find(".schedule-grid-div"),this.setHolidayDataDic(),this.buildScheduleColumns(),this.buildScheduleSource(),this.buildScheduleGrid(),this.setGridColumnsWidth(),this.setGridSize(),this.setYearGroupHeader(),this.showGridBorders(),!this.grid)return;this.grid.clearGridData();var t=0;if(e||this.grid.grid.css("opacity",0),!this.schedule_source)return;var i=this;a();var s=setInterval(function(){t<i.schedule_source.length?a():l()},10);function a(){for(var d=t;d<t+200&&d<i.schedule_source.length;d++){var o=i.schedule_source[d];i.grid.grid.addRowData(d+1,o)}t=d}function l(){e||i.grid.grid.css("opacity",1),clearInterval(s),i.getMode!==T.YEAR&&i.setScheduleGridRowSpan(),i.highLightSelectDay(),i.setMonthDateRowPosition(),i.setScheduleGridDragAble(),i.setScrollPosition(),i.setMonthDateRowBackGround(),i.setWeeklyTotalHeader()}}getDefaultUser(){var e=!1;return this.schedule_source&&this.schedule_source.length===1&&this.schedule_source[0].user_id!=""?e=this.schedule_source[0].user_id:this.schedule_source&&this.schedule_source.length===1&&typeof this.filter_data=="object"&&typeof this.filter_data.include_user_ids=="object"&&this.filter_data.include_user_ids.value&&this.filter_data.include_user_ids.value.length===1?e=this.filter_data.include_user_ids.value[0]:this.current_edit_record.user_id&&this.current_edit_record.user_id!=""?e=this.current_edit_record.user_id:e=LocalCacheData.getLoginUser().id,e}setWeeklyTotalHeader(){var e=this.settings_menu.getButton("weekly_totals_btn").active;if(_(".size-tr").remove(),_(".group-tr").remove(),!e||this.settings_menu.getButton("weekly_totals_btn").disabled===!0)return;var t=_(_(this.el).find("table[aria-labelledby=gbox_"+this.ui_id+"_grid]")),i=_('<tr class="size-tr" ></tr>'),s=_('<tr class="group-column-tr group-tr" ></tr>'),a=_('<th class="group-column-th"  ><span class="group-column-label"></span></th>'),l=t.find(".jqgfirstrow");o();var d=this.grid.grid.getGridParam("colModel").length;r(d-5,""),r(5,_.i18n._("Total")),i.insertBefore(t.find(".ui-jqgrid-labels")),s.insertBefore(t.find(".ui-jqgrid-labels"));function o(){for(var c=l.children().length,u=0;u<c;u++){var h=_('<th class="" style="border-right: 1px solid #dddddd" ></th>'),m=l.children().eq(u);h.css("width",m.css("width")),h.height(0),i.append(h)}}function r(c,u){var h=a.clone();h.children(0).text(u),h.attr("colspan",c),s.append(h)}this.setGridHeight()}setMonthDateRowBackGround(){this.getMode()===T.MONTH&&_(this.el).find(".month-date-cell").parent().css("background-color","#375979")}setScrollPosition(){this.scroll_position>0&&this.grid.grid.parent().parent().scrollTop(this.scroll_position)}setYearGroupHeader(){if(this.getMode()===T.YEAR){_(".schedule-year-group-header").remove();var e=_(_(this.el).find("table[aria-labelledby=gbox_"+this.ui_id+"_grid]")[0]),t=_('<tr class="group-column-tr schedule-year-group-header" ></tr>'),i=_('<th class="group-column-th"  ><span class="group-column-label"></span></th>'),s=t.clone();_(e.children()[0]).prepend(s);for(var a=e.find("th"),l=a.length,d=0;d<l;d++){var o=_(a[d]),r=o.clone();r.attr("id",""),r.empty(),r.attr("row",""),r.height(0),s.append(r)}var c=_(_(e.children()[0]).children()[0]),u=this.select_layout.data.display_columns.length+1;s=t.clone(),r=i.clone(),r.attr("colspan",u),s.append(r),s.insertAfter(c);for(var h=null,m=null,p=0,d=u;d<l;d++){o=_(a[d]);var b=o.attr("id").split("_"),M=b[b.length-1];if(M==="shifts"||M==="absences"||M==="total_time"||M==="total_time_wage")var v="-1";else v=n.strToDate(M,this.full_format).getMonth();if(!n.isSet(h))h=v,m=M,p=1;else{var y=n.strToDate(m,this.full_format).format("MMM");if(v===h&&d!==l-1)p=p+1;else if(d===l-1?v!==h&&!isNaN(v)?(r.children(0).text(y),r.attr("colspan",p),s.append(r),h=v,m=M,p=1,r=i.clone(),r.children(0).text(y),r.attr("colspan",p),s.append(r)):(p=p+1,r=i.clone(),r.children(0).text(y),r.attr("colspan",p),s.append(r)):(r=i.clone(),r.children(0).text(y),r.attr("colspan",p),s.append(r),h=v,m=M,p=1),v==="-1"){r=i.clone(),r.children(0).text(""),r.attr("colspan",l-d),s.append(r);break}}}}}setMonthDateRowPosition(){if(this.getMode()===T.MONTH){var e=this;this.month_date_row_position={};var t=0;for(var i in this.month_date_row_tr_ids)this.month_date_row_position[t]=this.grid.grid.find("#"+i).position().top,t=t+1;this.grid.grid.parent().parent().scroll(function(){var s=_(this).scrollTop(),a=e.start_date.getDay();if(s<e.month_date_row_position[0]&&e.month_current_header_number!==0){e.month_date_row_tr_ids={},e.month_current_header_number=0;for(var l=0;l<7;l++){var d=new Date(new Date(e.start_date.getTime()).setDate(e.start_date.getDate()+l)),o=d.format(e.weekly_format),r=_(e.el).find("#"+e.ui_id+"_grid_"+c),c=(a+l)%7,u=_(e.el).find("#jqgh_"+e.ui_id+"_grid_"+c);u.text(o),r.removeClass("highlight-header")}e.highLightSelectDay()}else s>e.month_date_row_position[0]&&s<e.month_date_row_position[1]&&e.month_current_header_number!==1?h(0,1):s>e.month_date_row_position[1]&&s<e.month_date_row_position[2]&&e.month_current_header_number!==2?h(1,2):s>e.month_date_row_position[2]&&s<e.month_date_row_position[3]&&e.month_current_header_number!==3?h(2,3):s>e.month_date_row_position[3]&&e.month_current_header_number!==4&&h(3,4);function h(m,p){e.month_date_row_tr_ids={},e.month_current_header_number=p;for(var b=e.month_date_row_array[m],M=0;M<7;M++){var v=(a+M)%7,y=_(e.el).find("#jqgh_"+e.ui_id+"_grid_"+v),g=_(e.el).find("#"+e.ui_id+"_grid_"+v);g.removeClass("highlight-header");var A=b[v+"_full_date"],D=_(e.el).find("#"+e.ui_id+"_grid_"+A);D.hasClass("highlight-header")&&g.addClass("highlight-header"),y.html(b[v])}}})}}setGridHeight(){let e=document.body.scrollHeight,t=e,i=document.querySelector("div.ui-jqgrid-bdiv.ui-corner-bottom"),s=document.querySelector("div.context-border");if(!i||!s)return e;if(t-=i.getBoundingClientRect().top,t-=e-s.getBoundingClientRect().bottom,t-=10,this.getMode()!=T.DAY){var a=_(".schedule-view .grid-div .ui-jqgrid-bdiv");a&&a.length>0&&a[0].scrollWidth>_(".context-border").width()+2&&(t-=n.getScrollbarWidth())}return this.grid.setGridHeight(t),t}setGridColumnsWidth(){var e=this;switch(this.getMode()){case T.DAY:var t,o=10,u=e.schedule_source;for(var i in this.schedule_columns)if(this.schedule_columns[i].is_static_size==!0||this.schedule_columns[i].name=="scrollbar_spacer")this.schedule_columns[i].fixed=!0,this.schedule_columns[i].name!="scrollbar_spacer"&&(t=i);else{var s=n.calculateTextWidth(this.schedule_columns[i].label)+o;if(u&&u.length>0)for(var a in u){var l=n.calculateTextWidth(u[a][this.schedule_columns[i].name]);l>s&&(s=l)}this.schedule_columns[i].width=s,this.schedule_columns[i].fixed=!0}this.calculateScheduleWidth(),_(".day_hour_div .day_hour_span").width(this.day_hour_width);var d=this.day_hour_width*_(".day_hour_div .day_hour_span").length;this.schedule_columns[t].width=d,this.grid.setGridColumnsWidth(this.schedule_columns);break;default:var o=15,r=0,c=_(".context-border").width(),u=e.schedule_source;for(var i in this.schedule_columns){if(!this.schedule_columns[i].is_static_size||this.schedule_columns[i].is_static_size==!1){var s=n.calculateTextWidth(this.schedule_columns[i].label,{padding:o});if(u&&u.length>0){var h=[];for(var a in u){var m=u[a][this.schedule_columns[i].name];if(!h[m]){var l=n.calculateTextWidth(m,{padding:o});l>s&&(s=l),h[m]=!0}}h=null}this.schedule_columns[i].width=s,this.schedule_columns[i].fixed=!0}r+=this.schedule_columns[i].width}this.schedule_columns[0]&&r<c&&(this.schedule_columns[0].width+=c-r),this.grid.setGridColumnsWidth(this.schedule_columns),this.getMode()==T.YEAR&&this.setYearGroupHeader();break}this.setGridHeight()}buildScheduleSource(){this.no_date_array=[],this.has_date_array=[],this.final_schedule_data_array=[];var e=this.getMode();this.no_date_array=this.buildNoDateArray(),this.has_date_array=this.buildHasDateArray(),this.has_date_array.length;var t=this.buildSortFields();switch(this.has_date_array.sort(n.m_sort_by(t)),this.no_date_array.sort(n.m_sort_by(t)),e!==T.MONTH&&(this.final_schedule_data_array=this.no_date_array.concat(this.has_date_array)),this.getMode()){case T.WEEK:this.buildWeeklySource();break;case T.MONTH:this.buildMonthSource();break;case T.YEAR:this.buildYearlySource();break;case T.DAY:this.buildDailySource();break}}buildShiftKey(e){for(var t="",i=0;i<this.shift_key_name_array.length;i++){var s=this.shift_key_name_array[i],a=this.shift_key_name_array[i].replace("_id","");a!=="user"?e[a]?t=e[s]+"-"+t:t="0-"+t:t=e[s]+"-"+t}return t}buildMonthSource(){for(var e=this,t=0,i=0,s=this.month_date_row_array[t],a=this.start_date.getDay(),l=s[a+"_time"],d=[],o=this.has_date_array.slice(),r=0;r<5;r++){for(var c=[],u=o.length,h=!1,m=0;m<u;m++){var p=o[m],b=n.strToDate(p.date_stamp),M=b.getTime();M<l&&(o.splice(m,1),m=m-1,u=u-1,c.push(p))}if(this.settings_menu.getButton("all_employee_btn").active)if(r===0)c=this.no_date_array.slice().concat(c);else{var v=this.buildMonthWeekNoDateArray(c);c=v.slice().concat(c)}if(d[i]=c,(t>2||t===2&&!this.month_date_row_array[3].hasOwnProperty(0))&&(h=!0),!h)t=t+1,i=i+1,s=this.month_date_row_array[t],l=s[a+"_time"];else{i=i+1;var y=this.getLastDateOfRow(this.month_date_row_array[t]),g=new Date(y);l=new Date(g.setDate(g.getDate()+1)).getTime()}}A(-1,d[0]),A(0,d[1]),A(1,d[2]),A(2,d[3]),A(3,d[4]);function A(P,B){if(B.length<1){D(P);return}var f={},S=B.length,x=!1;if(P===e.month_date_row_array.length-1)x=!0;else var k=e.month_date_row_array[P+1],E=0;for(var R=0;R<S;R++){var C=B[R],w;if(C.date_stamp){var W=n.strToDate(C.date_stamp);w=W.getDay()}var j=e.buildShiftKey(C);if(f[j]){for(var q=!1,N=0;N<f[j].length;N++){var H=f[j][N];if(I=e.schedule_source[H],!I[w]){w>=0&&(C.status_id==20?I[w]=e.getAbsenceCellValue(C):I[w]=C.start_time+" - "+C.end_time,I[w+"_data"]=C),q=!0;break}}if(!q){I={},I.user_full_name=C.user_full_name,I.last_name=C.last_name,I.user_id=C.user_id,I.branch_id=C.branch_id,I.department_id=C.department_id,I.schedule_policy_id=C.schedule_policy_id,I.job_id=C.job_id,I.job_item_id=C.job_item_id,I.punch_tag_id=C.punch_tag_id,F=e.select_layout.data.display_columns,z=F.length;for(var O=0;O<z;O++)L=F[O],I[L]=C[L]?C[L]:"";w>=0&&(C.status_id==20?I[w]=e.getAbsenceCellValue(C):I[w]=C.start_time+" - "+C.end_time,I[w+"_data"]=C),x?(e.schedule_source.push(I),f[j].push(e.schedule_source.length-1)):(E=e.schedule_source.indexOf(k),e.schedule_source.splice(E,0,I),f[j].push(E))}}else{var I={};I.user_full_name=C.user_full_name,I.last_name=C.last_name,I.user_id=C.user_id,I.branch_id=C.branch_id,I.department_id=C.department_id,I.schedule_policy_id=C.schedule_policy_id,I.job_id=C.job_id,I.job_item_id=C.job_item_id,I.punch_tag_id=C.punch_tag_id;for(var F=e.select_layout.data.display_columns,z=F.length,O=0;O<z;O++){var L=F[O];I[L]=C[L]?C[L]:""}w>=0&&(C.status_id==20?I[w]=e.getAbsenceCellValue(C):I[w]=C.start_time+" - "+C.end_time,I[w+"_data"]=C),x?(e.schedule_source.push(I),f[j]=[e.schedule_source.length-1]):(E=e.schedule_source.indexOf(k),e.schedule_source.splice(E,0,I),f[j]=[E])}}B.length>0&&D(P,!0)}function D(P,B){if(B&&(P=P+1),P===-1)var f=0;else{var S=e.month_date_row_array[P];B?S?f=e.schedule_source.indexOf(S):f=e.schedule_source.length:f=e.schedule_source.indexOf(S)+1}var x=e.getEmptyWeeklyRow();x.type=U.EMPTY,e.schedule_source.splice(f,0,x)}this.showDailyTotal(),this.showWeeklyTotal()}buildYearlySource(){var e=this,t={};this.schedule_source=[];var i=this.final_schedule_data_array.length;if(i<1){v();return}for(var s=0;s<i;s++){var a=this.final_schedule_data_array[s],l="";if(a.date_stamp){var d=n.strToDate(a.date_stamp);l=d.format(this.full_format)}var o=this.buildShiftKey(a);if(t[o]){for(var p=!1,b=0;b<t[o].length;b++){var M=t[o][b];if(r=this.schedule_source[M],!r[l]){l&&(r[l]=a.status_id==10?"S":"A",r[l+"_data"]=a),p=!0;break}}if(!p){r={},r.user_full_name=a.user_full_name,r.last_name=a.last_name,r.user_id=a.user_id,r.branch_id=a.branch_id,r.department_id=a.department_id,r.schedule_policy_id=a.schedule_policy_id,r.job_id=a.job_id,r.job_item_id=a.job_item_id,r.punch_tag_id=a.punch_tag_id,c=this.select_layout.data.display_columns,u=c.length;for(var h=0;h<u;h++)m=c[h],r[m]=a[m]?a[m]:"";l&&(r[l]=a.status_id==10?"S":"A",r[l+"_data"]=a),this.schedule_source.push(r),t[o].push(this.schedule_source.length-1)}}else{var r={};r.user_full_name=a.user_full_name,r.last_name=a.last_name,r.user_id=a.user_id,r.branch_id=a.branch_id,r.department_id=a.department_id,r.schedule_policy_id=a.schedule_policy_id,r.job_id=a.job_id,r.job_item_id=a.job_item_id,r.punch_tag_id=a.punch_tag_id;for(var c=this.select_layout.data.display_columns,u=c.length,h=0;h<u;h++){var m=c[h];r[m]=a[m]?a[m]:""}l&&(r[l]=a.status_id==10?"S":"A",r[l+"_data"]=a),this.schedule_source.push(r),t[o]=[this.schedule_source.length-1]}}function v(){var y={};y.user_full_name="",y.last_name="",y.user_id="",y.branch_id="",y.type=U.EMPTY,e.schedule_source.push(y)}this.showWeeklyTotal()}buildDailyHeaders(){var e=this,t=this.schedule_columns,i=t[this.select_layout.data.display_columns.length+1],s=-1,a=-1,l="",d="",o="",r="",c=this.has_date_array.length;if(c===0){var u=this.api.getScheduleDefaultData({async:!1}),h=u.getResult(),m=e.getSelectDate();l=m+" "+h.start_time,d=m+" "+h.end_time,M();return}for(var p=0;p<c;p++){var b=this.has_date_array[p];(s===-1||b.start_time_stamp<s)&&(s=b.start_time_stamp,l=b.start_date,o=b.start_time),(a===-1||b.end_time_stamp>a)&&(a=b.end_time_stamp,d=b.end_date,r=b.end_time)}l=n.getStandardDateTimeStr(l,o),d=n.getStandardDateTimeStr(d,r),M();function M(){var v=new Date(n.strToDateTime(l).getTime()-36e5);d=n.strToDateTime(d);var y=v.getMinutes()*6e4,g=_("<div class='day_hour_span'></div>");y>0&&(v=new Date(v.getTime()-y)),e.day_mode_start_date_time=v;var A=(d.getTime()-v.getTime())/36e5,D=_("<div class='day_hour_div'></div>"),P=_("<div class='day-column'></div>"),B=e.start_date.format(e.weekly_format);B=e.setHolidayHeader(B,!0),P.text(B);for(var f=_('<div style="padding:0px !important"></div>'),S="",x="hA",k=0;k<A;k++){var E=g.clone();E=E.text(v.format(x)),k<A-1?S=S+v.format(x)+"|":S=S+v.format(x),f.append(E),v=new Date(v.getTime()+36e5)}D.append(P),D.append(f),e.buildTotalShiftDic(S),i.label=D[0].outerHTML,i.width=e.day_hour_width*A+40,e.day_header_width=i.width}}buildTotalShiftDic(e){var t=e.split("|");this.total_shifts_dic={};for(var i=0;i<t.length;i++){var s={sort_order:i,key:t[i],value:0};this.total_shifts_dic[t[i]]=s}}buildDailySource(){var e=this;this.buildDailyHeaders();var t={};this.schedule_source=[];var i=this.final_schedule_data_array.length;if(i<1){v();return}for(var s=0;s<i;s++){var a=this.final_schedule_data_array[s],l="";if(a.date_stamp){var d=n.strToDate(a.date_stamp);l=d.format(this.full_format)}var o=this.buildShiftKey(a);if(t[o]){for(var p=!1,b=0;b<t[o].length;b++){var M=t[o][b];if(r=this.schedule_source[M],!r[l]){l&&(a.status_id==20?r[l]=e.getAbsenceCellValue(a):r[l]=a.start_time+" - "+a.end_time,r[l+"_data"]=a),p=!0;break}}if(!p){r={},r.user_full_name=a.user_full_name,r.last_name=a.last_name,r.user_id=a.user_id,r.branch_id=a.branch_id,r.department_id=a.department_id,r.schedule_policy_id=a.schedule_policy_id,r.job_id=a.job_id,r.job_item_id=a.job_item_id,r.punch_tag_id=a.punch_tag_id,r.total=n.getTimeUnit(a.total_time),c=this.select_layout.data.display_columns,u=c.length;for(var h=0;h<u;h++){var m=c[h];r[m]=a[m]?a[m]:""}l&&(a.status_id==20?r[l]=e.getAbsenceCellValue(a):r[l]=a.start_time+" - "+a.end_time,r[l+"_data"]=a),this.schedule_source.push(r),t[o].push(this.schedule_source.length-1)}}else{var r={};r.user_full_name=a.user_full_name,r.last_name=a.last_name,r.user_id=a.user_id,r.branch_id=a.branch_id,r.department_id=a.department_id,r.schedule_policy_id=a.schedule_policy_id,r.job_id=a.job_id,r.job_item_id=a.job_item_id,r.punch_tag_id=a.punch_tag_id,r.total=n.getTimeUnit(a.total_time);for(var c=this.select_layout.data.display_columns,u=c.length,h=0;h<u;h++){var m=c[h];r[m]=a[m]?a[m]:""}l&&(a.status_id==20?r[l]=e.getAbsenceCellValue(a):r[l]=a.start_time+" - "+a.end_time,r[l+"_data"]=a),this.schedule_source.push(r),t[o]=[this.schedule_source.length-1]}}function v(){var y=e.getEmptyWeeklyRow();y.type=U.EMPTY,e.schedule_source.push(y)}this.showDailyTotal()}buildWeeklySource(){var e=this,t={};this.schedule_source=[];var i=this.final_schedule_data_array.length;if(i<1){v();return}for(var s=0;s<i;s++){var a=this.final_schedule_data_array[s],l="";if(a.date_stamp){var d=n.strToDate(a.date_stamp);l=d?d.format(this.full_format):null}var o=this.buildShiftKey(a);if(t[o]){for(var p=!1,b=0;b<t[o].length;b++){var M=t[o][b];if(r=this.schedule_source[M],!r[l]){l&&(a.status_id==20?r[l]=e.getAbsenceCellValue(a):r[l]=a.start_time+" - "+a.end_time,r[l+"_data"]=a),p=!0;break}}if(!p){r={},r.user_full_name=a.user_full_name,r.last_name=a.last_name,r.user_id=a.user_id,r.branch_id=a.branch_id,r.department_id=a.department_id,r.schedule_policy_id=a.schedule_policy_id,r.job_id=a.job_id,r.job_item_id=a.job_item_id,r.punch_tag_id=a.punch_tag_id,c=this.select_layout.data.display_columns,u=c.length;for(var h=0;h<u;h++)m=c[h],r[m]=a[m]?a[m]:"";l&&(a.status_id==20?r[l]=e.getAbsenceCellValue(a):r[l]=a.start_time+" - "+a.end_time,r[l+"_data"]=a),this.schedule_source.push(r),t[o].push(this.schedule_source.length-1)}}else{var r={};r.user_full_name=a.user_full_name,r.last_name=a.last_name,r.user_id=a.user_id,r.branch_id=a.branch_id,r.department_id=a.department_id,r.schedule_policy_id=a.schedule_policy_id,r.job_id=a.job_id,r.job_item_id=a.job_item_id,r.punch_tag_id=a.punch_tag_id;for(var c=this.select_layout.data.display_columns,u=c.length,h=0;h<u;h++){var m=c[h];r[m]=a[m]?a[m]:""}l&&(a.status_id==20?r[l]=e.getAbsenceCellValue(a):r[l]=a.start_time+" - "+a.end_time,r[l+"_data"]=a),this.schedule_source.push(r),t[o]=[this.schedule_source.length-1]}}function v(){var y=e.getEmptyWeeklyRow();y.type=U.EMPTY,e.schedule_source.push(y)}this.showDailyTotal(),this.showWeeklyTotal()}getAbsenceCellValue(e){var t;return e.absence_policy?e.note?t="*"+e.absence_policy:t=e.absence_policy:e.note?t="*N/A":t="N/A",t}buildSortFields(){var e=[];if(this.select_layout&&this.select_layout.data){var t=this.select_layout.data.display_columns,i=t.length;i>0&&(e=t.slice())}return e.push("user_full_name"),e.push({name:"start_time_stamp",primer:parseFloat,reverse:!1}),e}buildMonthWeekNoDateArray(e){for(var t={},i=[],s=0,a=e.length;s<a;s++){var l=n.clone(e[s]);t[l.user_id]=!0}for(var d in this.all_user_map)if(!t[d]){var l=n.clone(this.all_user_map[d]);l.date_stamp=!1,i.push(l)}return i}buildNoDateArray(){var e=[],t=[],i,s=this.full_schedule_data.schedule_data;for(var a in s)i={},i.value=s[a],i.sort_key=a,t.push(i);for(var l=t.length,d=0;d<l;d++){var o=t[d];for(var r in o.value){var c=o.value[r];c=this.replaceFalseToEmptyStringForSortFields(c),c.date_stamp||e.push(o.value[r])}}return e}buildHasDateArray(){var e=[];this.all_user_map={};var t=[],i,s=this.full_schedule_data.schedule_data;for(var a in s)i={},i.value=s[a],i.sort_key=a,t.push(i);for(var l=t.length,d=0;d<l;d++){var o=t[d];for(var r in o.value){var c=o.value[r];c=this.replaceFalseToEmptyStringForSortFields(c),this.all_user_map[c.user_id]=n.clone(c),c.date_stamp&&e.push(o.value[r])}}return e}replaceFalseToEmptyStringForSortFields(e){return e.branch||(e.branch=""),e.department||(e.department=""),e.default_branch||(e.default_branch=""),e.default_department||(e.default_department=""),e.job||(e.job=""),e.job_item||(e.job_item=""),e.title||(e.title=""),e}checkIsSelectedCell(e,t){for(var i=0,s=this.select_cells_Array.length;i<s;i++){var a=this.select_cells_Array[i];if(a.row_id.toString()===e.toString()&&a.cell_index.toString()===t.toString())return!0}return!1}buildScheduleGrid(){var e=this,t,i="grid";this.grid?(this.grid.grid.jqGrid("GridUnload",!0),delete this.grid,this.grid=null):(t=_(this.el).find("#grid"),t.attr("id",this.ui_id+"_grid"),i=this.ui_id+"_grid"),i=this.ui_id+"_grid",(!this.schedule_columns||this.schedule_columns.length==0)&&this.buildScheduleColumns(),this.grid=new TTGrid(i,{draggble:!0,altRows:!0,data:[],datatype:"local",sortable:!1,scrollOffset:0,rowNum:1e4,hoverrows:!1,multiselectPosition:"none",ondblClickRow:function(){e.onGridDblClickRow()},onSelectRow:function(s,a,l){var d=_(this).find("#"+s);return d.removeClass("ui-state-highlight").attr("aria-selected",!0),!1},onRightClickRow:function(s,a,l,d){if(!e.checkIsSelectedCell(s,l)){var o=_(d.target).closest("td,th").html(),r=_(this).find("#"+s);r.removeClass("ui-state-highlight").attr("aria-selected",!0),e.onCellSelect("timesheet_grid",s,l,o,this,d)}},onCellSelect:function(s,a,l,d){e.onCellSelect("timesheet_grid",s,a,l,this,d)},colNames:[],viewrecords:!0,winMultiSelect:!1,setGridSize:function(){e.setGridHeight()},onResizeGrid:function(){e.onResizeGrid()}},this.schedule_columns),this.grid.grid.parent().parent().scrollLeft(1e3),this.grid.grid.parent().parent().scroll(function(s){e.scroll_position=_(s.target).scrollTop()}),this.bindGridColumnEvents()}onResizeGrid(){this.getMode()==T.DAY?this.buildCalendars():this.setGridColumnsWidth(),this.setGridHeight()}bindGridColumnEvents(){var e=this.grid.getGridParam("colModel");if(!e)return;var t=e.length;this.t_grid_header_array=[];for(var i=0;i<t;i++){var s=e[i],a=_(_(this.el).find("#gbox_"+this.ui_id+"_grid").find("div #jqgh_"+this.ui_id+"_grid_"+s.name));this.t_grid_header_array.push(a.TGridHeader()),a.bind("click",d)}var l=this;function d(o){var r=_(this).attr("id");if(r=r.substring(10+l.ui_id.length+1,r.length),!(r==="cb"||r==="punch_info")){var c,u=l.getMode();if(u===T.MONTH){var h=l.grid.getGridParam("colModel");c=l.getCellRelatedDate(1,h,_(this).parent().index(),r)}else c=n.strToDate(r,l.full_format);c&&c.getYear()>0&&(l.setDatePickerValue(c.format(n.getLoginUserDateFormat())),l.highLightSelectDay())}}}buildMonthCell(e,t,i,s){var a=this.grid.getGridParam("colModel"),l=t.colModel,d=_("<div class='schedule-content-div'></div>");s&&d.addClass("date-column");var o=_("<span class='schedule-time' ></span>"),r=i[l.name+"_data"],c=i[l.name+"_full_date"];switch(i.type){case U.TOTAL:if(o=_("<span class='schedule-time total'></span>"),this.select_layout.data.display_columns.indexOf(l.index)===-1&&["user_full_name","shifts","absences","total_time","total_time_wage"].indexOf(l.index)===-1){if(!e)var e={shifts:0,absences:0,total_time:0,total_time_wage:0};var u=_("<span class='schedule-time total'></span>"),h=LocalCacheData.getCurrentCurrencySymbol();o.text("S: "+e.shifts+" A: "+e.absences),u.text(n.getTimeUnit(e.total_time)+" = "+h+n.MoneyRound(e.total_time_wage)),d.prepend(u),d.prepend(o),d.css("height","auto")}else o.text(e),d.prepend(o),t.pos===a.length-1&&d.css("padding-right","15px");break;case U.DATE:o.addClass("date"),d.addClass("month-date-cell"),e?(o.html(e),d.attr("id",this.ui_id+"_grid_"+c)):(o.addClass("empty-date"),o.text(".")),d.prepend(o);break;case U.EMPTY:n.isSet(e)||o.text(""),o.addClass("empty"),d.prepend(o);break;default:n.isSet(r)&&((!n.isSet(r.id)||!r.id||r.id&&r.id==TTUUID.zero_id)&&o.addClass("no-id"),r.status_id==20&&o.addClass("red"),r.user_id===TTUUID.zero_id&&d.addClass("yellow-outline")),n.isSet(e)?(n.isSet(r)&&r.note&&e.indexOf("*")==-1&&(e="*"+e),o.text(e),t.pos===a.length-1&&d.css("padding-right","15px")):o.text(""),d.prepend(o);break}return d.get(0).outerHTML}buildYearCell(e,t,i,s){this.grid.getGridParam("colModel");var a=t.colModel,l=_("<div class='schedule-content-div'></div>");if(e&&e.length==1&&i.user_full_name==_.i18n._("OPEN")&&l.addClass("yellow-outline"),s&&l.addClass("date-column"),!e)return l.get(0).outerHTML;var d=_("<span class='schedule-time'></span>"),o=i[a.name+"_data"];switch(i.type){case U.EMPTY:d.addClass("empty"),l.prepend(d);break;default:a.index>=0&&(o&&(!o.id||o.id&&o.id==TTUUID.zero_id)&&d.addClass("no-id"),e==="A"&&d.addClass("absence-cell")),n.isSet(e)?d.text(e):d.text(""),l.prepend(d);break}return l[0].outerHTML}calculateScheduleWidth(){var e=0;for(var t in this.schedule_columns)(!this.schedule_columns[t].is_static_size||this.schedule_columns[t].name=="total"||this.schedule_columns[t].name=="scrollbar_spacer")&&(e+=this.schedule_columns[t].width);return this.grid_div[0]&&this.grid&&(n.isVerticalScrollBarRequired(this.grid_div[0])||this.grid.getGridParam().height<this.grid_div[0].offsetHeight)&&(e+=n.getScrollbarWidth()),this.day_hour_width=Math.floor((_(".context-border").innerWidth()-e)/_(".day_hour_div .day_hour_span").length),Debug.Text("Day Hour Width: "+this.day_hour_width+" Static Width: "+e,"ScheduleViewController.js","ScheduleViewController","calculateScheduleWidth",10),this.day_hour_width<40&&(this.day_hour_width=40),this.day_hour_width}buildDayCell(e,t,i,s){var a=this,l=t.colModel,d=_("<div class='schedule-content-div'></div>");s&&d.addClass("date-column");var o=_("<span class='schedule-time'></span>"),r=i[l.index+"_data"];switch(i.type){case U.TOTAL:if(e&&n.isSet(e.total_time)){var c=_("<div  style='text-align: left'></div>"),u=LocalCacheData.getCurrentCurrencySymbol();if(o=_("<span class='schedule-time total'></span>"),o.text("S: "+e.shifts+" A: "+e.absences+" "+n.getTimeUnit(e.total_time)+" = "+u+e.total_time_wage),d.prepend(o),e.total_shifts_dic){var h=[];for(var m in e.total_shifts_dic)h.push(e.total_shifts_dic[m]);h=h.sort(function(v,y){return n.compare(v,y,"sort_order")});for(var p=0;p<h.length;p++){var r=h[p],b=_('<span class="day_hour_span"></span>');b.text(r.value),b.width(this.day_hour_width),c.append(b)}d.prepend(c)}d.css("height","auto")}else e?(o=_("<span class='schedule-time total'></span>"),o.text(e),d.prepend(o)):l.display_total_column==!0&&(u=LocalCacheData.getCurrentCurrencySymbol(),o=_("<span class='schedule-time total'></span>"),o.text("S: 0 A: 0 00:00 = "+u+"0.00"),d.prepend(o),d.css("height","auto"));break;case U.EMPTY:n.isSet(e)||o.text(""),o.addClass("empty"),d.prepend(o);break;default:if(n.isSet(r)){d.removeClass("schedule-content-div").addClass("schedule-content-day-div"),t.rowId%2===0?o.removeClass("schedule-time").addClass("schedule-day-time even"):o.removeClass("schedule-time").addClass("schedule-day-time");var M=a.getDayShiftWidth(r);o.width(M),o.css("left",a.getDayShiftOffset(r)),(!n.isSet(r.id)||!r.id||r.id==TTUUID.zero_id)&&o.addClass("no-day-id"),r.status_id==20&&(o.removeClass("even"),o.addClass("red-bg")),r.user_id===TTUUID.zero_id&&d.addClass("yellow-outline")}n.isSet(e)?(n.isSet(r)&&r.note&&e.indexOf("*")==-1&&(e="*"+e),o.text(e)):o.text(""),d.prepend(o);break}return d.get(0).outerHTML}getDayShiftOffset(e){var t=n.strToDateTime(n.getStandardDateTimeStr(e.start_date,e.start_time)),i=(t.getTime()-this.day_mode_start_date_time.getTime())/36e5;return i*this.day_hour_width}getDayShiftWidth(e){var t=n.strToDateTime(n.getStandardDateTimeStr(e.start_date,e.start_time)),i=n.strToDateTime(n.getStandardDateTimeStr(e.end_date,e.end_time)),s=(i.getTime()-t.getTime())/36e5;return s*this.day_hour_width}buildWeekCell(e,t,i,s){var a=this.grid.getGridParam("colModel"),l=t.colModel,d=_("<div class='schedule-content-div'></div>");s&&d.addClass("date-column");var o=_("<span class='schedule-time'></span>"),r=i[l.index+"_data"];switch(i.type){case U.TOTAL:if(o=_("<span class='schedule-time total'></span>"),this.select_layout.data.display_columns.indexOf(l.index)===-1&&["user_full_name","shifts","absences","total_time","total_time_wage"].indexOf(l.index)===-1){if(!e)var e={shifts:0,absences:0,total_time:0,total_time_wage:0};var c=_("<span class='schedule-time total'></span>"),u=LocalCacheData.getCurrentCurrencySymbol();o.text("S: "+e.shifts+" A: "+e.absences),c.text(n.getTimeUnit(e.total_time)+" = "+u+n.MoneyRound(e.total_time_wage)),d.prepend(c),d.prepend(o),d.css("height","auto")}else o.text(e),d.prepend(o),t.pos===a.length-1&&d.css("padding-right","15px");break;case U.EMPTY:n.isSet(e)||o.text(""),o.addClass("empty"),d.prepend(o);break;default:n.isSet(r)&&((!n.isSet(r.id)||!r.id||r.id&&r.id==TTUUID.zero_id)&&o.addClass("no-id"),r.status_id==20&&o.addClass("red"),r.user_id===TTUUID.zero_id&&d.addClass("yellow-outline")),n.isSet(e)?(n.isSet(r)&&r.note&&e.indexOf("*")==-1&&(e="*"+e),t.pos===a.length-1&&d.css("padding-right","15px"),o.text(e)):o.text(""),d.prepend(o);break}return d.get(0).outerHTML}onCellFormat(e,t,i){var s=!0;if(t.colModel.index=="user_full_name")s=!1;else for(var a in this.all_columns)if(t.colModel.label==this.all_columns[a].label){s=!1;break}switch(this.getMode()){case T.WEEK:return this.buildWeekCell(e,t,i,s);case T.MONTH:return this.buildMonthCell(e,t,i,s);case T.YEAR:return this.buildYearCell(e,t,i,s);case T.DAY:return this.buildDayCell(e,t,i,s)}return""}onSelectRow(e,t,i){var s=this,a=_(i).find("#"+t);a.removeClass("ui-state-highlight").attr("aria-selected",!0);var l=s.select_cells_Array,d=s.select_cells_Array.length;this.select_all_shifts_array=[],this.select_shifts_array=[],this.select_recurring_shifts_array=[],this.select_cellls_and_shifts_array=[];for(var o=0;o<d;o++){var r=l[o];a=_(i).find("#"+r.row_id);var c=_(a.find("td")[r.cell_index]);c.addClass("ui-state-highlight").attr("aria-selected",!0),r.row_id=r.row_id-0,r.shift?(n.isSet(r.shift.start_date)?r.shift.start_date_num=n.strToDateTime(r.shift.start_date).getTime():r.shift.start_date_num=r.time_stamp_num,r.shift.row_index=r.row_id-1,r.shift.cell_index=r.cell_index-1,r.shift.orginal_row_index=r.row_id,r.shift.orginal_cell_index=r.cell_index,this.select_all_shifts_array.push(r.shift),this.select_cellls_and_shifts_array.push(r),r.shift.id&&r.shift_id!=TTUUID.zero_id?this.select_shifts_array.push(r.shift):this.select_recurring_shifts_array.push(r.shift),this.select_all_shifts_array.sort(function(u,h){if(u.cell_index<h.cell_index)return-1;if(u.cell_index>h.cell_index)return 1;if(u.cell_index===h.cell_index){if(u.row_index<h.row_index)return-1;if(u.row_index>h.row_index)return 1}return 0})):this.select_cellls_and_shifts_array.push(r),this.select_cellls_and_shifts_array.sort(function(u,h){if(u.cell_index<h.cell_index)return-1;if(u.cell_index>h.cell_index)return 1;if(u.cell_index===h.cell_index){if(u.row_id<h.row_id)return-1;if(u.row_id>h.row_id)return 1}return 0})}this.setDefaultMenu()}getCellRelatedDate(e,t,i,s){var a,l=this.schedule_source.indexOf(this.month_date_row_array[0]),d=this.schedule_source.indexOf(this.month_date_row_array[1]),o=this.schedule_source.indexOf(this.month_date_row_array[2]),r=this.schedule_source.indexOf(this.month_date_row_array[3]);return e<l?a=n.strToDate(t[i].index,this.full_format):e>=l&&e<d?a=n.strToDate(this.month_date_row_array[0][s+"_full_date"],this.full_format):e>=d&&e<o?a=n.strToDate(this.month_date_row_array[1][s+"_full_date"],this.full_format):e>=o&&e<r?a=n.strToDate(this.month_date_row_array[2][s+"_full_date"],this.full_format):e>=r&&(a=n.strToDate(this.month_date_row_array[3][s+"_full_date"],this.full_format)),a}getDataByCellIndex(e,t){var i=this,s=i.schedule_source[e],a=i.grid.getGridParam("colModel");if(!a||!a[t]||!s)return null;var l=a[t].name,d=s[l+"_data"];return d}onCellSelect(e,t,i,s,a,l){if(_("#ribbon_view_container .context-menu:visible a").click(),!(i<0)){var d=this,o=0,r,c,u,h,m=[],p,b=this.getMode();m=d.select_cells_Array,o=d.select_cells_Array.length,r=d.schedule_source[t-1];var M=d.schedule_source.indexOf(r);c=d.grid.getGridParam("colModel"),u=c[i].name,h=r[u+"_data"],b===T.MONTH?p=d.getCellRelatedDate(M,c,i,u):p=n.strToDate(u,this.full_format),(!p||p.getTime()<-1)&&(p=new Date);for(var v=0;v<o;v++){var y=m[v],g=_(a).find("#"+y.row_id),A=_(g.find("td")[y.cell_index]);A.removeClass("ui-state-highlight").attr("aria-selected",!1)}if(p)var D=p.format(),P=n.strToDate(D).getTime();else D="",P=0;if(l.ctrlKey||l.metaKey){for(var B=!1,v=0;v<o;v++)if(y=m[v],parseInt(t)===y.row_id&&i===y.cell_index){m.splice(v,1),B=!0;break}B||(m.push({row_id:t,cell_index:i,cell_val:s,shift:h,date:D,time_stamp_num:P,user_id:r.user_id,branch_id:r.branch_id,department_id:r.department_id,job_id:r.job_id,job_item_id:r.job_item_id,punch_tag_id:r.punch_tag_id}),d.select_cells_Array=m,this.select_cells_Array.sort(function(N,H){return n.compare(N,H,"time_stamp_num")}))}else if(l.shiftKey){for(var f=t,S=i,x=t,k=i,v=0;v<o;v++)y=m[v],parseInt(y.row_id)<parseInt(f)?f=y.row_id:parseInt(y.row_id)>parseInt(x)&&(x=y.row_id),parseInt(y.cell_index)<parseInt(S)?S=y.cell_index:parseInt(y.cell_index)>parseInt(k)&&(k=y.cell_index);m[m.length-1]&&m[0]&&m[m.length-1].cell_index>=i&&m[0].cell_index<=i&&m[m.length-1].row_id>=t&&m[0].row_id<=t&&(x=t,k=i),f=parseInt(f),x=parseInt(x),m=[];for(var v=f;v<=x;v++)for(var E=v,R=S;R<=k;R++){var C=R;g=_(a).find("#"+E),A=_(g.find("td")[C]),s=A[0].outerHTML,r=d.schedule_source[E-1],M=d.schedule_source.indexOf(r),c=d.grid.getGridParam("colModel"),u=c[C].name,h=r[u+"_data"],b===T.MONTH?p=d.getCellRelatedDate(M,c,C,u):p=n.strToDate(u,this.full_format),p&&p.getTime()>0?(D=p.format(),P=n.strToDate(D).getTime()):(D="",P=0),m.push({row_id:E.toString(),cell_index:C,cell_val:s,shift:h,date:D,time_stamp_num:P,user_id:r.user_id,branch_id:r.branch_id,department_id:r.department_id,job_id:r.job_id,job_item_id:r.job_item_id,punch_tag_id:r.punch_tag_id})}d.select_cells_Array=m,this.select_cells_Array.sort(function(N,H){return n.compare(N,H,"time_stamp_num")})}else m=[{row_id:t,cell_index:i,cell_val:s,shift:h,date:D,time_stamp_num:P,user_id:r.user_id,branch_id:r.branch_id,department_id:r.department_id,job_id:r.job_id,job_item_id:r.job_item_id,punch_tag_id:r.punch_tag_id}],d.select_cells_Array=m,p&&p.getYear()>0&&(this.setDatePickerValue(p.format(n.getLoginUserDateFormat())),this.highLightSelectDay());d.onSelectRow(e,t,a);var w=_(a).find("#"+t),W=_(w.find("td")[i]);if(W.attr("infor_column")){var j=w.index(),I=parseInt(W.attr("rowspan"));isNaN(I)&&(I=1);var F=w.parent().children().eq(j+I-1),z=F.children().eq(F.children().length-1),O=F.attr("id"),L=F.children().length-1,q=z.find(".schedule-time").text();d.onCellSelect("timesheet_grid",O,L,q,this.grid.grid,{shiftKey:!0})}}}highLightSelectDay(){var e=this.getMode();if(_(".highlight-header").removeClass("highlight-header"),e===T.MONTH){var t=n.strToDate(this.start_date_picker.getValue()),i=t.getDay();t=t.format(this.full_format);var s=_("#"+this.ui_id+"_grid_"+i),a=_(s.children()[1]).text();this.highlight_header=_("#"+this.ui_id+"_grid_"+t),this.highlight_header.length!==1?this.highlight_header=_("#"+this.ui_id+"_grid_"+i):a===this.highlight_header.text()&&(_(".highlight-header").removeClass("highlight-header"),s.addClass("highlight-header"))}else t=n.strToDate(this.start_date_picker.getValue()),t||(t=new Date,this.setDatePickerValue(t.format())),t=t.format(this.full_format),this.highlight_header=_("#"+this.ui_id+"_grid_"+t);e!==T.DAY&&(e===T.MONTH&&this.highlight_header.parent().addClass("highlight-header"),this.highlight_header.addClass("highlight-header"))}buildAllModeCommonColumns(){var e=this;this.shift_key_name_array=["user_id"];for(var t=this.buildDisplayColumns(this.select_layout.data.display_columns),i=t.length,s=0;s<i;s++){var a=t[s],l={name:a.value,index:a.value,label:a.label,width:122,sortable:!1,title:!1,fixed:!0,resizable:!1,formatter:function(){return e.onCellFormat(arguments[0],arguments[1],arguments[2],arguments[3])},cellattr:function(o,r,c,u,h){var m=u.index;return'class="'+m+'_cell" infor_column="true"'}};this.schedule_columns.push(l),this.shift_key_name_array.push(a.value+"_id")}var d={name:"user_full_name",index:"user_full_name",label:_.i18n._("Employee"),width:122,sortable:!1,title:!1,fixed:!0,resizable:!1,formatter:function(){return e.onCellFormat(arguments[0],arguments[1],arguments[2],arguments[3])},cellattr:function(o,r,c,u,h){var m=u.index;return'class="'+m+'_cell" infor_column="true"'}};this.schedule_columns.push(d)}buildMonthRows(){(this.end_date.getTime()-this.start_date.getTime())/864e5+1;var e=new Date(this.start_date.getTime()).getDay();this.schedule_source=[];var t=new Date(new Date(this.start_date.getTime()).setDate(this.start_date.getDate()+7));this.month_date_row_array=[];for(var i=1,s=0;i<5;){var a=e,l=this.getEmptyWeeklyRow();l.type=U.DATE;for(var d=0;d<7;d++){var o=new Date(new Date(t.getTime()).setDate(t.getDate()+s));if(o.getTime()>this.end_date.getTime())break;l[a]=o.format(this.weekly_format),l[a]=this.setHolidayHeader(l[a]),l[a+"_full_date"]=o.format(this.full_format),l[a+"_time"]=o.getTime(),a=a+1,a===7&&(a=0),s=s+1}this.month_date_row_array.push(l),i=i+1,this.schedule_source.push(l)}}getEmptyWeeklyRow(){var e={};e.user_full_name="",e.last_name="",e.user_id="",e.branch_id="",e.department_id="",e.schedule_policy_id="",e.job_id="",e.job_item_id="",e.punch_tag_id=[];for(var t=this.select_layout.data.display_columns,i=t.length,s=0;s<i;s++){var a=t[s];e[a]=""}return e}buildMonthColumns(){var e=this;this.schedule_columns=[],this.buildAllModeCommonColumns(),this.month_date_row_tr_ids={};for(var t=0;t<7;t++){var i=new Date(this.start_date.getTime()),s=new Date(i.setDate(i.getDate()+t)),a=s.getDay(),l=s.format(this.weekly_format),d=a;d===7&&(d=0),l=this.setHolidayHeader(l);var o=s.format(this.full_format),r={resizable:!1,name:d.toString(),index:o,label:l,width:150,fixed:!0,sortable:!1,title:!1,formatter:function(){return e.onCellFormat(arguments[0],arguments[1],arguments[2],arguments[3])},cellattr:function(c,u,h,m,p){h.type===U.DATE&&(e.month_date_row_tr_ids[c]=!0)},is_static_size:!0};this.schedule_columns.push(r)}this.buildWeeklyTotalColumns(),this.schedule_columns.push({name:"scrollbar_spacer",index:"scrollbar_spacer",label:"",width:n.getScrollbarWidth(),sortable:!1,title:!1,fixed:!0,is_static_size:!0}),this.buildMonthRows()}getDayByDayNum(t){var t;switch(t){case 0:t=_.i18n._("S");break;case 1:t=_.i18n._("M");break;case 2:t=_.i18n._("T");break;case 3:t=_.i18n._("W");break;case 4:t=_.i18n._("T");break;case 5:t=_.i18n._("F");break;case 6:t=_.i18n._("S");break}return t}buildYearColumns(){var e=this;this.schedule_columns=[],this.buildAllModeCommonColumns();for(var t=new Date(this.start_date.getTime()),i=new Date(this.end_date.getTime()),s=0;t.format(this.full_format)!==i.format(this.full_format);){t=new Date(new Date(this.start_date.getTime()).setDate(this.start_date.getDate()+s)),t.format(this.weekly_format);var a=t.format(this.full_format),l=this.getDayByDayNum(t.getDay()),d={name:a,index:s,label:l+"<br>"+t.getDate(),width:22,sortable:!1,title:!1,fixed:!0,is_static_size:!0,formatter:function(){return e.onCellFormat(arguments[0],arguments[1],arguments[2],arguments[3])}};this.schedule_columns.push(d),s=s+1}this.schedule_columns.push({name:"scrollbar_spacer",index:s,label:"",width:n.getScrollbarWidth(),sortable:!1,title:!1,fixed:!0,is_static_size:!0})}buildDayColumns(){var e=this;this.schedule_columns=[],this.buildAllModeCommonColumns();var t=new Date(this.start_date.getTime());t.format(this.weekly_format);var i=t.format(this.full_format),s={fixed:!0,resizable:!1,width:500,name:i,index:i,label:"daily_header_replace",is_static_size:!0,sortable:!1,title:!1,display_total_column:!0,formatter:function(){return e.onCellFormat(arguments[0],arguments[1],arguments[2],arguments[3])}};this.schedule_columns.push(s),s={fixed:!0,resizable:!1,width:122,name:"total",index:"total",label:"Total Time",sortable:!1,title:!1,formatter:function(){return e.onCellFormat(arguments[0],arguments[1],arguments[2],arguments[3])}},this.schedule_columns.push(s),this.schedule_columns.push({name:"scrollbar_spacer",index:"scrollbar_spacer",label:"",width:n.getScrollbarWidth(),sortable:!1,title:!1,fixed:!0})}buildWeekColumns(){var e=this;if(this.schedule_columns=[],this.buildAllModeCommonColumns(),!!this.start_date){for(var t=new Date(this.start_date.getTime()),i=new Date(this.end_date.getTime()),s=0;t.format(this.full_format)!==i.format(this.full_format);){t=new Date(new Date(this.start_date.getTime()).setDate(this.start_date.getDate()+s));var a=t.format(this.weekly_format),l=t.format(this.full_format);a=this.setHolidayHeader(a);var d={resizable:!1,name:l.toString(),index:l,label:a,width:150,fixed:!0,sortable:!1,title:!1,formatter:function(){return e.onCellFormat(arguments[0],arguments[1],arguments[2],arguments[3])},is_static_size:!0};this.schedule_columns.push(d),s=s+1}return this.buildWeeklyTotalColumns(),this.schedule_columns.push({name:"scrollbar_spacer",index:"scrollbar_spacer",label:"",width:n.getScrollbarWidth(),sortable:!1,title:!1,fixed:!0,is_static_size:!0}),this.schedule_columns}}setHolidayHeader(e,t){return this.holiday_data_dic&&this.holiday_data_dic[e]&&(t?e=e+" ("+n.htmlEncode(this.holiday_data_dic[e].name)+")":e=e+"<br>"+n.htmlEncode(this.holiday_data_dic[e].name)),e}buildWeeklyTotalColumns(){var e=this,t=this.settings_menu.getButton("weekly_totals_btn").active;if(t){var i={name:"shifts",index:"shifts",label:_.i18n._("Shifts"),width:50,sortable:!1,title:!1,formatter:function(){return e.onCellFormat(arguments[0],arguments[1],arguments[2],arguments[3])},fixed:!0},s={name:"absences",index:"absences",label:_.i18n._("Absences"),width:70,sortable:!1,title:!1,formatter:function(){return e.onCellFormat(arguments[0],arguments[1],arguments[2],arguments[3])},fixed:!0},a={name:"total_time",index:"total_time",label:_.i18n._("Total Time"),width:70,sortable:!1,title:!1,formatter:function(){return e.onCellFormat(arguments[0],arguments[1],arguments[2],arguments[3])},fixed:!0},l={name:"total_time_wage",index:"total_time_wage",label:_.i18n._("Wages"),width:90,sortable:!1,title:!1,formatter:function(){return e.onCellFormat(arguments[0],arguments[1],arguments[2],arguments[3])},fixed:!0};this.schedule_columns.push(i),this.schedule_columns.push(s),this.schedule_columns.push(a),this.schedule_columns.push(l)}}buildScheduleColumns(){this.shift_key_name_array=["user_id"],this.schedule_columns=[];var e=this.getMode();switch(e){case T.WEEK:this.buildWeekColumns();break;case T.MONTH:this.buildMonthColumns();break;case T.YEAR:this.buildYearColumns();break;case T.DAY:this.buildDayColumns();break}}setScheduleGridRowSpan(){for(var e=this,t=this.select_layout.data.display_columns,i=t.length,s=0;s<i;s++){var a=t[s];l(a)}l("user_full_name");function l(d){var o=e.grid.grid.find("[aria-describedby="+e.ui_id+"_grid_"+d+"]"),r=o.length,c=0,u=null,h=null,m=[],p=r-1;b();function b(){for(var M=p;M>=0;M--){var v=_(o[M]),y=_(o[M]).children().eq(0).children().eq(0).text();if(M===r-1)u=y,c=c+1,h=v;else if(u!==y){u=y,h.attr("rowspan",c);for(var g=0;g<m.length;g++){var A=m[g],D=A[0];D.parentNode&&(D.style.display="none")}A=[],c=1,h=v}else if(M===0){if(c=c+1,m.push(h),c>1){v.attr("rowspan",c);for(var g=0;g<m.length;g++)A=m[g],D=A[0],D.parentNode&&(D.style.display="none")}}else c=c+1,m.push(h),h=v}}}}onSetSearchFilterFinished(){}onBuildBasicUIFinished(){}onBuildAdvUIFinished(){}reSetURL(){var e=this.getMode(),t;e?(t="#!m="+this.viewId+"&mode="+e,n.setURLToBrowser(n.getBaseURL()+t)):(t="#!m="+this.viewId,n.setURLToBrowser(n.getBaseURL()+t)),LocalCacheData.setAllURLArgs(n.buildArgDic(t.split("&")))}setURL(){var e="";switch(LocalCacheData.current_doing_context_action){case"new":case"edit":case"view":e=LocalCacheData.current_doing_context_action;break;case"copy_as_new":e="new";break}if(this.canSetURL()){var t=this.edit_view_tab?this.edit_view_tab.find(".edit-view-tab-bar-label").children().eq(this.getEditViewTabIndex()).text():"";t=t.replace(/\/|\s+/g,"");var i=this.getMode();this.current_edit_record&&this.current_edit_record.id&&this.current_edit_record.id!=TTUUID.zero_id?(e?n.setURLToBrowser(n.getBaseURL()+"#!m="+this.viewId+"&mode="+i+"&a="+e+"&id="+this.current_edit_record.id+"&tab="+t):n.setURLToBrowser(n.getBaseURL()+"#!m="+this.viewId+"&mode="+i+"&id="+this.current_edit_record.id),n.trackView(this.viewId,LocalCacheData.current_doing_context_action)):e?e==="edit"?n.setURLToBrowser(n.getBaseURL()+"#!m="+this.viewId+"&mode="+i+"&a=new&tab="+t):n.setURLToBrowser(n.getBaseURL()+"#!m="+this.viewId+"&mode="+i+"&a="+e+"&tab="+t):n.setURLToBrowser(n.getBaseURL()+"#!m="+this.viewId+"&mode="+i)}}clearSelection(e){this.grid&&this.grid.grid&&this.grid.grid.jqGrid("resetSelection"),this.select_cells_Array=[],this.select_cellls_and_shifts_array=[],this.select_all_shifts_array=[],(e||e===void 0)&&this.setDefaultMenu()}render(){var e=this;super.render();var t=[{label:_.i18n._("Daily Totals"),id:"daily_totals_btn",no_group_label:!0,vue_icon:"tticon tticon-settings_black_24dp",action_group:"schedule_settings",multi_select_group:2,visible:!0,command:()=>{!this.checkScheduleData()||!this.grid||!this.grid.grid||(this.buildCalendars(!0),this.onResizeGrid(),this.setScheduleGridRowSpan(),this.setMonthDateRowPosition(),this.setGridColumnsWidth(),this.onSearch(!0))}},{label:_.i18n._("Weekly Totals"),id:"weekly_totals_btn",no_group_label:!0,vue_icon:"tticon tticon-settings_black_24dp",action_group:"schedule_settings",multi_select_group:3,visible:!0,command:()=>{this.checkScheduleData()&&(this.buildCalendars(),this.onResizeGrid(),this.onSearch(!0))}},{label:_.i18n._("Show Unscheduled Employees"),id:"all_employee_btn",no_group_label:!0,vue_icon:"tticon tticon-settings_black_24dp",action_group:"schedule_settings",multi_select_group:1,visible:this.unscheduledEmployeeUIValidate(),command:()=>{this.search(),this.onSearch(!0)}},{label:_.i18n._("Strict Range"),id:"strict_range_btn",active:!0,no_group_label:!0,vue_icon:"tticon tticon-settings_black_24dp",action_group:"schedule_settings",multi_select_group:4,visible:!0,command:()=>{e.search(!1,!0),e.onSearch(!0)}}],i=[{label:_.i18n._("Day"),value:"day"},{label:_.i18n._("Week"),value:"week"},{label:_.i18n._("Month"),value:"month"},{label:_.i18n._("Year"),value:"year"}];this.vue_control_bar_mount_id="vue-schedule-control-bar";var s={view_id:this.viewId,schedule_settings_options:t,schedule_mode_options:i};X.mountComponent(this.vue_control_bar_mount_id,me,s);var a=_(".schedule-view .date-chooser-div");a.empty(),this.start_date_picker=n.loadWidgetByName(FormItemType.DATE_PICKER),this.start_date_picker.TDatePicker({field:"start_date"});var l=_("<span class='label'>"+_.i18n._("Date")+":</span><img class='left-arrow arrow' src="+n.getRealImagePath("images/left_arrow.svg")+"><div class='date-picker-div'></div><img class='right-arrow arrow' src="+n.getRealImagePath("images/right_arrow.svg")+">");a.append(l),a.find(".date-picker-div").append(this.start_date_picker);var d=a.find(".left-arrow"),o=a.find(".right-arrow");d.bind("click",function(){var c=e.getMode(),u,h=e.start_date;if(e.clearSelection(),!!h){switch(c){case T.WEEK:var h=n.strToDate(e.getSelectDate()?e.getSelectDate():new Date().format());u=new Date(new Date(h.getTime()).setDate(h.getDate()-7));break;case T.YEAR:u=new Date(new Date(h.getTime()).setDate(h.getDate()-56));break;case T.DAY:u=new Date(new Date(h.getTime()).setDate(h.getDate()-1));break;case T.MONTH:e.settings_menu.getButton("strict_range_btn").active?u=new Date(new Date(h.getTime()).setDate(h.getDate()-1)):u=new Date(new Date(h.getTime()).setDate(h.getDate()-36));break;default:u=new Date(new Date(h.getTime()).setDate(h.getDate()-1));break}e.setDatePickerValue(u.format()),e.search(!1,!0)}}),o.bind("click",function(){var c=e.getMode(),u=e.end_date,h;if(u){switch(e.clearSelection(),c){case T.WEEK:var u=n.strToDate(e.getSelectDate()?e.getSelectDate():new Date().format());h=new Date(new Date(u.getTime()).setDate(u.getDate()+7));break;case T.YEAR:h=new Date(new Date(u.getTime()).setDate(u.getDate()+56));break;case T.DAY:e.settings_menu.getButton("strict_range_btn").active?h=new Date(new Date(u.getTime()).setDate(u.getDate()+1)):h=new Date(new Date(u.getTime()).setDate(u.getDate()));break;case T.MONTH:default:h=new Date(new Date(u.getTime()).setDate(u.getDate()+1));break}e.setDatePickerValue(h.format()),e.search(!1,!0)}}),this.start_date_picker.bind("formItemChange",function(){e.clearSelection(),e.search(!1,!0)}),_(this.search_panel.find("#layout_selector")).off("change").on("change",function(){e.layout_changed=!0;for(var c=e.search_panel.find("#layout_selector").find("option:selected").attr("value"),u=e.search_panel.getLayoutsArray(),h=u.length,m=0;m<h;m++){var p=u[m];if(p.id==c){e.select_layout=p,e.setSelectLayout(),e.search(!1,!0);break}}n.triggerAnalyticsNavigationOther("searchpanel:layout_change","click",e.viewId)}),this.toggle_button=function(c){var u="week";c.event_bus.on(c.vue_control_bar_mount_id,"scheduleModeOnChange",h,TTEventBusStatics.AUTO_CLEAR_ON_EXIT);function h(b){if(Debug.Text("Toggle button value update! Change event received. ("+b+").","ScheduleViewController.js","ScheduleViewController","updateValueOnChange",10),!b.value){e.toggle_button.setValue(e.getMode());return}u=b.value}function m(){return u}function p(b){u=b,c.event_bus.emit(c.vue_control_bar_mount_id,"setValue",{key:"schedule_mode_options_selected",value:b})}return{getValue:m,setValue:p}}(this),this.settings_menu={getButton(c){return t.find(u=>u.id===c)},enableButton(c){e.event_bus.emit(e.vue_control_bar_mount_id,"setScheduleSettingsState",{item_id:c,item_field:"disabled",item_value:!1})},disableButton(c){e.event_bus.emit(e.vue_control_bar_mount_id,"setScheduleSettingsState",{item_id:c,item_field:"disabled",item_value:!0})},activateButton(c){e.event_bus.emit(e.vue_control_bar_mount_id,"setSettingActive",{item_id:c})},deactivateButton(c){e.event_bus.emit(e.vue_control_bar_mount_id,"setSettingDeactivated",{item_id:c})}};function r(c){Debug.Text("Schedule mode change event received. ("+c+").","ScheduleViewController.js","ScheduleViewController","scheduleModeOnChangeHandler",10),e.scroll_position=0,e.select_all_shifts_array=[],e.select_shifts_array=[],e.select_recurring_shifts_array=[],e.setToggleButtonUrl(),e.search(!0,!0),e.onSearch(!0)}this.event_bus.on(this.vue_control_bar_mount_id,"scheduleModeOnChange",r,TTEventBusStatics.AUTO_CLEAR_ON_EXIT)}checkScheduleData(){return this.full_schedule_data!==!0}showWeeklyTotal(){var e=this.settings_menu.getButton("weekly_totals_btn").active&&!this.settings_menu.getButton("weekly_totals_btn").disabled;if(e)for(var t=0,i=0,s=0,a=0,l=this.getMode(),d=this.schedule_source.length,o=0;o<d;o++){var r=this.schedule_source[o];if(r.type!==U.DATE){for(var c in r){var u=n.isSet(r[c])?r[c]:"";if(n.isSet(u.user_id)||n.isArray(u)&&l===T.YEAR&&u.every(b=>b.total_time_wage))if(l===T.YEAR)for(var h=u.length,m=0;m<h;m++){var p=u[m];p.total_time_wage=parseFloat(p.total_time_wage),p.total_time=parseFloat(p.total_time),n.isSet(p.user_id)&&(a=p.total_time_wage+a,p.status_id==10?(s=p.total_time+s,t=t+1):u.status_id==20&&u.absence_policy_id!=TTUUID.zero_id&&u.absence_policy_id!=TTUUID.not_exist_id&&(s=p.total_time+s,i=i+1))}else u.total_time_wage=parseFloat(u.total_time_wage),u.total_time=parseFloat(u.total_time),a=u.total_time_wage+a,u.status_id==10?(s=u.total_time+s,t=t+1):u.status_id==20&&u.absence_policy_id!=TTUUID.zero_id&&u.absence_policy_id!=TTUUID.not_exist_id&&(s=u.total_time+s,i=i+1);else n.isSet(u.shifts)?(u.total_time_wage=parseFloat(u.total_time_wage),u.total_time=parseFloat(u.total_time),s=u.total_time+s,a=u.total_time_wage+a,t=t+u.shifts,i=i+u.absences):(r.type,U.DATE)}r.total_time=n.getTimeUnit(s),r.total_time_wage=LocalCacheData.getCurrentCurrencySymbol()+n.MoneyRound(a),r.shifts=t,r.absences=i,s=0,a=0,t=0,i=0}}}buildTotalShiftsValues(e,t){var i=n.strToDateTime(t.start_date),s=n.strToDateTime(t.end_date),a=i.getMinutes(),l=s.getMinutes();i.setMinutes(0),s.setMinutes(0);var d=i.format("hA"),o=s.format("hA"),r=Math.ceil(u(i,s)/60/60);if(r<1)e[o].value=e[o].value+Number((l/60).toFixed(0));else{a==0?e[d].value=e[d].value+1:e[d].value=e[d].value+Number(((60-a)/60).toFixed(2));for(var c=1;c<r;c++)i.setHours(i.getHours()+1),d=i.format("hA"),e.hasOwnProperty(d)&&(c==r-1&&l>0?e[d].value=e[d].value+Number((l/60).toFixed(2)):e[d].value=e[d].value+1)}function u(h,m){h||(h=new Date);var p=(m.getTime()-h.getTime())/1e3;return p.toFixed(0)}}showDailyTotal(){var e=this.settings_menu.getButton("daily_totals_btn").active&&!this.settings_menu.getButton("daily_totals_btn").disabled;if(e){for(var t=!0,i=null,s=[],a={},l=this.select_layout.data.display_columns,d=l.length,o=0;o<d;o++){var r=l[o];s.push({key:r,row:null,value:null})}for(var c=s.length,o=0;o<this.schedule_source.length;o++){var u=this.schedule_source[o];if(t){for(var h=0;h<c;h++){var m=s[h];i={type:U.TOTAL},i[m.key]=_.i18n._("Totals"),m.row=i,m.value=u[m.key]}a={type:U.TOTAL},a.user_full_name=_.i18n._("Overall Totals")}for(var p=c-1;p>=0;p--)m=s[p],u[m.key]!==m.value&&o>0&&!t&&o!==0&&(this.schedule_source.splice(o,0,m.row),o=o+1,i={type:U.TOTAL},i[m.key]=_.i18n._("Totals"),m.row=i,m.value=u[m.key]);if(t&&(t=!1),u.type===U.DATE){this.schedule_source.splice(o,0,a),a={type:U.TOTAL},a.user_full_name=_.i18n._("Overall Totals"),o=o+1;continue}for(var b in u){for(var M=n.isSet(u[b])?u[b]:"",v=0;v<c;v++)if(m=s[v],i=m.row,M&&n.isSet(M.user_id)){var y=b.replace("_data",""),g=i[y];!g||!n.isSet(g.total_time)?(i[y]={},g=i[y],g.total_time=0,g.total_shifts_dic=n.clone(this.total_shifts_dic)):g.total_time=parseInt(g.total_time),n.isSet(g.shifts)||(g.shifts=0),n.isSet(g.absences)||(g.absences=0),n.isSet(g.total_time_wage)||(g.total_time_wage=0);var A=u[y+"_data"];A.total_time=parseInt(A.total_time),g.total_time_wage=n.MoneyRound(parseFloat(parseFloat(A.total_time_wage)+parseFloat(g.total_time_wage))),A.status_id==10?(g.total_time=parseFloat(A.total_time)+parseFloat(g.total_time),g.shifts=g.shifts+1,this.getMode()===T.DAY&&this.buildTotalShiftsValues(g.total_shifts_dic,u[b])):A.status_id==20&&A.absence_policy_id!=TTUUID.zero_id&&A.absence_policy_id!=TTUUID.not_exist_id&&(g.total_time=parseFloat(A.total_time)+parseFloat(g.total_time),g.absences=g.absences+1)}M&&n.isSet(M.user_id)&&(y=b.replace("_data",""),g=a[y],(!g||!n.isSet(g.total_time))&&(a[y]={},g=a[y],g.total_time=0,g.total_shifts_dic=n.clone(this.total_shifts_dic)),n.isSet(g.shifts)||(g.shifts=0),n.isSet(g.absences)||(g.absences=0),n.isSet(g.total_time_wage)||(g.total_time_wage=0),A=u[y+"_data"],g.total_time_wage=n.MoneyRound(parseFloat(parseFloat(A.total_time_wage)+parseFloat(g.total_time_wage))),A.status_id==10?(g.total_time=parseFloat(A.total_time)+parseFloat(g.total_time),g.shifts=g.shifts+1,this.getMode()===T.DAY&&this.buildTotalShiftsValues(g.total_shifts_dic,u[b])):A.status_id==20&&A.absence_policy_id!=TTUUID.zero_id&&A.absence_policy_id!=TTUUID.not_exist_id&&(g.total_time=parseFloat(A.total_time)+parseFloat(g.total_time),g.absences=g.absences+1))}if(o===this.schedule_source.length-1){for(var h=s.length-1;h>=0;h--)this.schedule_source.push(s[h].row);this.schedule_source.push(a);break}}}}buildSearchFields(){super.buildSearchFields();var e=this,t={permission_section:"schedule"};PermissionManager.validate(this.permission_id,"view")||PermissionManager.validate(this.permission_id,"view_child")?this.search_fields=[new SearchField({label:_.i18n._("Status"),in_column:1,field:"status_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:_.i18n._("Schedule Branch"),in_column:1,field:"schedule_branch_ids",layout_name:"global_branch",api_class:TTAPI.APIBranch,multiple:!0,basic_search:!0,adv_search:!0,script_name:"BranchView",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:_.i18n._("Schedule Department"),in_column:1,field:"department_ids",layout_name:"global_department",api_class:TTAPI.APIDepartment,multiple:!0,basic_search:!0,adv_search:!0,script_name:"DepartmentView",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:_.i18n._("Default Branch"),in_column:1,field:"default_branch_ids",layout_name:"global_branch",api_class:TTAPI.APIBranch,multiple:!0,basic_search:!1,adv_search:!0,script_name:"BranchView",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:_.i18n._("Default Department"),in_column:1,field:"default_department_ids",layout_name:"global_department",api_class:TTAPI.APIDepartment,multiple:!0,basic_search:!1,adv_search:!0,script_name:"DepartmentView",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:_.i18n._("Group"),in_column:2,multiple:!0,field:"group_ids",layout_name:"global_tree_column",tree_mode:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:_.i18n._("Title"),field:"title_id",in_column:2,layout_name:"global_job_title",api_class:TTAPI.APIUserTitle,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:_.i18n._("Job"),in_column:2,field:"job_id",layout_name:"global_job",api_class:n.getProductEdition()>=20?TTAPI.APIJob:null,multiple:!0,basic_search:!1,adv_search:this.show_job_ui&&n.getProductEdition()>=20,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:_.i18n._("Task"),in_column:2,field:"job_item_id",layout_name:"global_job_item",api_class:n.getProductEdition()>=20?TTAPI.APIJobItem:null,multiple:!0,basic_search:!1,adv_search:this.show_job_item_ui&&n.getProductEdition()>=20,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:_.i18n._("Punch Tags"),in_column:2,field:"punch_tag_id",layout_name:"global_punch_tag",api_class:n.getProductEdition()>=20?TTAPI.APIPunchTag:null,multiple:!0,basic_search:!1,adv_search:this.show_punch_tag_ui&&n.getProductEdition()>=20,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:_.i18n._("Recurring Template"),field:"recurring_schedule_template_control_id",in_column:3,layout_name:"global_recurring_schedule_control",api_class:TTAPI.APIRecurringScheduleTemplateControl,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:_.i18n._("Absence Policy"),field:"absence_policy_id",in_column:3,layout_name:"global_absences",api_class:TTAPI.APIAbsencePolicy,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:_.i18n._("Include Employees"),in_column:3,field:"include_user_ids",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,default_args:t,addition_source_function:function(i,s){return e.onEmployeeSourceCreate(i,s)},form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:_.i18n._("Exclude Employees"),in_column:3,field:"exclude_user_ids",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,default_args:t,addition_source_function:function(i,s){return e.onEmployeeSourceCreate(i,s)},form_item_type:FormItemType.AWESOME_BOX})]:(this.search_fields=[],this.search_fields.push(new SearchField({label:_.i18n._("Status"),in_column:1,field:"status_id",multiple:!0,basic_search:!0,adv_search:!1,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX})),(PermissionManager.validate("punch","edit_branch")||PermissionManager.validate(this.permission_id,"edit_branch"))&&this.search_fields.push(new SearchField({label:_.i18n._("Schedule Branch"),in_column:1,field:"schedule_branch_ids",layout_name:"global_branch",api_class:TTAPI.APIBranch,multiple:!0,basic_search:!0,adv_search:!1,script_name:"BranchView",form_item_type:FormItemType.AWESOME_BOX})),(PermissionManager.validate("punch","edit_department")||PermissionManager.validate(this.permission_id,"edit_department"))&&this.search_fields.push(new SearchField({label:_.i18n._("Schedule Department"),in_column:1,field:"department_ids",layout_name:"global_department",api_class:TTAPI.APIDepartment,multiple:!0,basic_search:!0,adv_search:!1,script_name:"DepartmentView",form_item_type:FormItemType.AWESOME_BOX})))}onSourceDataCreate(e,t){var i=this,s=e.getDisplayColumns(),a={},l={};return _.each(s,function(d,o){return a.id=TTUUID.not_exist_id,a[o.name]=n.default_item,i.select_cells_Array.length>0&&!i.is_mass_editing&&(l.id="-2",l[o.name]=n.selected_item),!1}),(!t||_.type(t)!=="array")&&(t=[]),this.select_cells_Array.length>0&&!i.is_mass_editing&&t.unshift(l),t.unshift(a),t}onSourceDataCreatePunchTag(e,t){var i=e.getDisplayColumns(),s={};return _.each(i,function(a,l){return s.id=TTUUID.not_exist_id,s[l.name]=n.default_item,!1}),(!t||_.type(t)!=="array")&&(t=[]),t.unshift(s),t}onEmployeeSourceCreate(e,t){if(!this.checkOpenPermission())return t;var i=e.getDisplayColumns(),s={};return _.each(i,function(a,l){return s.id=TTUUID.zero_id,s[l.name]=n.open_item,!1}),(!t||_.type(t)!=="array")&&(t=[]),t.unshift(s),t}addOPenField(e,t){}cleanWhenUnloadView(e){this.event_bus.autoClear(),X.unmountComponent(this.vue_control_bar_mount_id),_("#schedule_view_container").remove(),super.cleanWhenUnloadView(e)}setAddRequestIcon(e,t){(n.getProductEdition()<=10||!this.addPermissionValidate("request")||this.edit_only_mode)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),this.enableAddRequestButton()===!0?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}}pe.html_template=`
<div class="view schedule-view" id="schedule_view_container">
	<div class="clear-both-div"></div>
	<div id="vue-schedule-control-bar"></div>
	<div class="clear-both-div"></div>
	<div class="grid-top-border schedule-top-border"></div>
	<div class="grid-div schedule-grid-div">
		<table id="grid"></table>
	</div>
	<div class="grid-bottom-border"></div>
</div>`;var U=function(){};U.TOTAL=1;U.DATE=2;U.EMPTY=3;var T=function(){};T.DAY="day";T.WEEK="week";T.MONTH="month";T.YEAR="year";export{pe as ScheduleViewController};
//# sourceMappingURL=ScheduleViewController-CZF6UHJR.bundle.js.map
