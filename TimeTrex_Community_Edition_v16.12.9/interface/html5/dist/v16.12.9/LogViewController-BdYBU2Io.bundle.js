import{_ as h,j as o}from"./vendor-tTApdY0Y.bundle.js";class b extends BaseViewController{constructor(e={}){h.defaults(e,{el:"#log_view_container",tables:{product:["product","product_price"],user_contact:["user_contact"],users:["users","user_preference","user_wage","authentication"],user_wage:["user_wage"],user_title:["user_title"],user_preference:["user_preference"],user_preference_notification:["user_preference_notification"],ui_kit:["ui_kit"],ui_kit_child:["ui_kit_child"],bank_account:["bank_account"],user_default:["user_default"],user_group:["user_group"],company:["company"],pay_period_schedule:["pay_period_schedule","pay_period","pay_period_schedule_user"],pay_period:["pay_period"],branch:["branch"],department:["department"],hierarchy_control:["hierarchy_control","hierarchy_object_type","hierarchy_user","hierarchy_level"],wage_group:["wage_group"],ethnic_group:["ethnic_group"],currency:["currency"],currency_rate:["currency_rate"],permission_control:["permission_control","permission_user"],custom_field:["custom_field"],station:["station","station_user_group","station_branch","station_department","station_include_user","station_exclude_user"],pay_stub_amendment:["pay_stub_amendment"],recurring_ps_amendment:["recurring_ps_amendment","recurring_ps_amendment_user"],pay_stub_entry_account:["pay_stub_entry_account"],company_deduction:["company_deduction","user_deduction","company_deduction_pay_stub_entry_account"],user_expense:["user_expense"],round_interval_policy:["round_interval_policy"],meal_policy:["meal_policy"],break_policy:["break_policy"],over_time_policy:["over_time_policy"],absence_policy:["absence_policy"],recurring_holiday:["recurring_holiday"],holiday_policy:["holiday_policy","holiday_policy_recurring_holiday"],holidays:["holidays"],premium_policy:["premium_policy"],policy_group:["policy_group","policy_group_user"],document:["document","document_revision"],document_group:["document_group"],document_revision:["document_revision"],schedule_policy:["schedule_policy"],accrual_policy:["accrual_policy","accrual_policy_milestone","accrual_policy_user_modifier"],client:["client","client_contact","client_payment"],report_custom_column:["report_custom_column"],client_contact:["client_contact"],client_payment:["client_payment"],invoice_transaction:["invoice_transaction"],invoice:["invoice"],job:["job","job_exclude_job_item","job_exclude_user","job_include_job_item","job_include_user","job_job_item_group","job_user_branch","job_user_group","job_user_department"],client_group:["client_group"],product_group:["product_group"],job_item:["job_item"],job_group:["job_group"],job_item_group:["job_item_group"],report_schedule:["report_schedule"],accrual_policy_account:["accrual_policy_account"],accrual:["accrual"],accrual_balance:["accrual_balance"],schedule:["schedule"],recurring_schedule_control:["recurring_schedule_control"],recurring_schedule_template_control:["recurring_schedule_template_control","recurring_schedule_template"],punch:["punch","punch_control"],kpi:["kpi"],kpi_group:["kpi_group"],qualification:["qualification"],qualification_group:["qualification_group"],user_skill:["user_skill"],user_education:["user_education"],user_membership:["user_membership"],user_license:["user_license"],user_language:["user_language"],job_vacancy:["job_vacancy"],job_application:["job_application"],job_applicant:["job_applicant"],invoice_district:["invoice_district"],job_applicant_employment:["job_applicant_employment"],job_applicant_reference:["job_applicant_reference"],job_applicant_location:["job_applicant_location"],job_applicant_skill:["job_applicant_skill"],job_applicant_education:["job_applicant_education"],job_applicant_license:["job_applicant_license"],job_applicant_membership:["job_applicant_membership"],job_applicant_language:["job_applicant_language"],tax_policy:["tax_policy"],area_policy:["area_policy"],shipping_policy:["shipping_policy"],payment_gateway:["payment_gateway"],request:["request"],exception_policy_control:["exception_policy_control","exception_policy"],user_review_control:["user_review_control","user_review"],roe:["roe"],expense_policy:["expense_policy"],user_report_data:["user_report_data"],regular_time_policy:["regular_time_policy"],pay_code:["pay_code"],pay_formula_policy:["pay_formula_policy"],contributing_pay_code_policy:["contributing_pay_code_policy"],contributing_shift_policy:["contributing_shift_policy"],accrual_policy_user_modifier:["accrual_policy_user_modifier"],job_item_amendment:["job_item_amendment"],user_date_total:["user_date_total"],pay_stub:["pay_stub","pay_stub_entry"],legal_entity:["legal_entity"],payroll_remittance_agency:["payroll_remittance_agency"],payroll_remittance_agency_event:["payroll_remittance_agency_event"],remittance_source_account:["remittance_source_account"],remittance_destination_account:["remittance_destination_account"],geo_fence:["geo_fence"]},log_detail_grid:null,log_detail_script_name:null}),super(e)}init(e){this.edit_view_tpl="LogEditView.html",this.context_menu_name=o.i18n._("Audit"),this.navigation_label=o.i18n._("Audit"),this.viewId="Log",this.script_name="LogView",this.log_detail_script_name="LogDetailView",this.api=TTAPI.APILog,this.noticeDiv=o(".audit-info"),this.render(),this.sub_view_mode?this.buildContextMenu(!0):this.buildContextMenu()}buildEditViewUI(){super.buildEditViewUI();var e={tab_audit_details:{label:o.i18n._("Audit Details"),html_template:this.getAuditLogTabHtml()}};this.setTabModel(e),this.navigation.AComboBox({api_class:TTAPI.APILog,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_log",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation();var i=this.edit_view_tab.find("#tab_audit_details"),l=i.find(".first-row"),a=Global.loadWidgetByName(FormItemType.TEXT);a.TText({field:"date"}),this.addEditFieldToColumn(o.i18n._("Date"),a,l,""),a=Global.loadWidgetByName(FormItemType.TEXT),a.TText({field:"action"}),this.addEditFieldToColumn(o.i18n._("Action"),a,l),a=Global.loadWidgetByName(FormItemType.TEXT),a.TText({field:"user_name"}),this.addEditFieldToColumn(o.i18n._("Employee"),a,l),a=Global.loadWidgetByName(FormItemType.TEXT),a.TText({field:"description"}),this.addEditFieldToColumn(o.i18n._("Description"),a,l,""),this.initLogDetailsView()}search(e,i,l,a){Global.isSet(e)||(e=!0);var t=this,r={};if(r.filter_data={},r.filter_sort={},r.filter_columns=this.getFilterColumnsFromDisplayColumns(),r.filter_items_per_page=0,this.pager_data)if(LocalCacheData.paging_type===0)i==="next"?r.filter_page=this.pager_data.next_page:r.filter_page=1;else switch(i){case"next":r.filter_page=this.pager_data.next_page;break;case"last":r.filter_page=this.pager_data.previous_page;break;case"start":r.filter_page=1;break;case"end":r.filter_page=this.pager_data.last_page_number;break;case"go_to":r.filter_page=l;break;default:r.filter_page=this.pager_data.current_page;break}else r.filter_page=1;this.select_layout&&this.select_layout.data&&(this.sub_view_mode&&this.parent_key&&(this.select_layout.data.filter_data[this.parent_key]=this.parent_value),Global.isSet(this.getSubViewFilter)&&(this.select_layout.data.filter_data=this.getSubViewFilter(this.select_layout.data.filter_data)),r.filter_data=Global.convertLayoutFilterToAPIFilter(this.select_layout),r.filter_sort=this.select_layout.data.filter_sort),TTUUID.isUUID(this.refresh_id)?(r.filter_data={},r.filter_data.id=[this.refresh_id],this.last_select_ids=r.filter_data.id):this.last_select_ids=this.getGridSelectIdArray(),this.api["get"+this.api.key_name](r,{onResult:function(_){var s=_.getResult(),d;if(Global.isArray(s)?(t.removeNoResultCover(),Global.isSet(t.__createRowId)&&(s=t.__createRowId(s)),s=Global.formatGridData(s,t.api.key_name),d=s.length):t.showNoResultCover(),t.setAuditInfo(),TTUUID.isUUID(t.refresh_id)){t.refresh_id=null;var n=t.grid.grid.getGridParam("data");d=n.length,o.type(n)!=="array"&&(n=[]);var g=!1,c=s[0];if(c){for(var p=0;p<d;p++){var m=n[p];if(m.id==c.id){t.grid.grid.setRowData(c.id,c),g=!0;break}}g||(n.push(c),t.grid.setData(n))}}else{if(t.pager_data=_.getPagerData(),LocalCacheData.paging_type!==0&&(t.paging_widget.setPagerData(t.pager_data),t.paging_widget_2.setPagerData(t.pager_data)),LocalCacheData.paging_type===0&&i==="next"){var v=t.grid.getGridParam("data");s=v.concat(s)}s=t.processResultData(s),t.grid&&(LocalCacheData.paging_type===0&&(!t.pager_data||t.pager_data.is_last_page?t.paging_widget.css("display","none"):t.paging_widget.css("display","block")),t.grid.setData(s),t.setGridColumnsWidth(),t.sub_view_mode&&Global.isSet(t.baseViewSubTabGridResize)&&t.baseViewSubTabGridResize("tab_audit"),t.reSelectLastSelectItems())}t.setGridCellBackGround(),ProgressBar.closeOverlay(),e&&t.setDefaultMenu(!0),LocalCacheData.paging_type===0&&(!t.pager_data||t.pager_data.is_last_page?t.paging_widget.css("display","none"):t.paging_widget.css("display","block")),a&&a(_),e&&t.autoOpenEditViewIfNecessary(),t.searchDone()}})}getGridSetup(){var e=this;return{container_selector:this.sub_view_mode?".edit-view-tab-bar":"body",sub_grid_mode:this.sub_view_mode,onResizeGrid:!0,multiselect:!1,onSelectRow:function(){e.onGridSelectRow()},onCellSelect:function(){e.onGridSelectRow()},onSelectAll:function(){e.onGridSelectAll()},ondblClickRow:function(i){e.onGridDblClickRow(i)},onRightClickRow:function(i){var l=e.getGridSelectIdArray();l.indexOf(i)<0&&(e.grid.grid.resetSelection(),e.grid.grid.setSelection(i),e.onGridSelectRow())},setGridSize:function(){e.baseViewSubTabGridResize("tab_audit")}}}_setGridSizeGridHeight(e){this.pager_data&&this.pager_data.last_page_number>1?this.grid.setGridHeight(o(this.el).parent().parent().parent().height()-101-e):this.grid.setGridHeight(o(this.el).parent().parent().parent().height()-78-e)}setAuditInfo(){var e=(this.parent_edit_record.updated_date||o.i18n._("N/A"))+" "+o.i18n._("by")+" "+(this.parent_edit_record.updated_by||o.i18n._("N/A"))+" ",i=(this.parent_edit_record.created_date||o.i18n._("N/A"))+" "+o.i18n._("by")+" "+(this.parent_edit_record.created_by||o.i18n._("N/A"))+" ";this.noticeDiv.find(".left > .info").text(e),this.noticeDiv.find(".right > .info").text(i)}autoOpenEditViewIfNecessary(){switch(LocalCacheData.current_doing_context_action){case"view":LocalCacheData.edit_id_for_next_open_view&&(this.onViewClick(LocalCacheData.edit_id_for_next_open_view),LocalCacheData.edit_id_for_next_open_view=null);break}this.autoOpenEditOnlyViewIfNecessary()}initLogDetailsView(e){var i=this.edit_view.find("#grid");i&&i.attr("id",this.log_detail_script_name+"_grid");var l=[],a=[{label:o.i18n._("Field"),value:"display_field"},{label:o.i18n._("Before"),value:"old_value"},{label:o.i18n._("After"),value:"new_value"}],t=a.length,r=0;Global.isSet(e)&&e>0&&(r=e);for(var _=r;_<t;_++){var s=a[_],d={name:s.value,index:s.value,label:s.label,width:100,sortable:!1,title:!1};l.push(d)}var n={container_selector:this.sub_view_mode?".edit-view-tab-bar":"body",sub_grid_mode:this.sub_view_mode,onResizeGrid:!0,multiselect:!1};this.log_detail_grid=new TTGrid(this.log_detail_script_name+"_grid",n,l)}initEditViewData(){super.initEditViewData(),Global.getProductEdition()>=15?(this.edit_view_tab.find("#tab_audit_details").find(".detail-grid-row").css("display","block"),this.edit_view.find(".permission-defined-div").css("display","none")):(this.edit_view_tab.find("#tab_audit_details").find(".detail-grid-row").css("display","none"),this.edit_view.find(".permission-defined-div").css("display","block"),this.edit_view.find(".permission-message").html(Global.getUpgradeMessage())),this.log_detail_grid.setGridColumnsWidth()}onGridDblClickRow(){this.onViewDetailClick()}setCurrentEditRecordData(){for(var e in this.current_edit_record){var i=this.edit_view_ui_dic[e];if(Global.isSet(i))switch(e){case"user_name":i.setValue(this.current_edit_record.first_name+" "+this.current_edit_record.last_name);break;default:i.setValue(this.current_edit_record[e]);break}else switch(e){case"details":this.setLogDetailsViewData(this.current_edit_record[e]);break}}this.collectUIDataToCurrentEditRecord(),this.setEditViewDataDone()}setLogDetailsViewData(e){var i=this;Global.isArray(e)?i.removeNoResultCover():i.showDetailNoResultCover(),e=Global.formatGridData(e),i.log_detail_grid.setData(e),i.setLogDetailGridSize()}setLogDetailGridSize(){if(!(!this.log_detail_grid||!o(this.log_detail_grid.grid).is(":visible"))){var e=this.edit_view.find("#tab_audit_details_content_div"),i=this.edit_view.find(".first-row");this.log_detail_grid.grid.setGridWidth(e.width()),this.log_detail_grid.grid.setGridHeight(e.height()-i.height())}}showDetailNoResultCover(){this.removeNoResultCover(),this.no_result_box=Global.loadWidgetByName(WidgetNamesDic.NO_RESULT_BOX),this.no_result_box.NoResultBox({related_view_controller:this,is_new:!1});var e=this.edit_view.find(".grid-div");e.append(this.no_result_box)}showNoResultCover(){super.showNoResultCover(!1)}onEditClick(e,i){this.onViewDetailClick(e,i)}onViewDetailClick(e){var i=this;this.setCurrentEditViewState("view_detail"),i.openEditView();var l={},a=this.getGridSelectIdArray(),t=a.length,r;if(Global.isSet(e))r=e;else if(this.is_viewing)r=this.current_edit_record.id;else if(t>0)r=a[0];else return;l.filter_data={},l.filter_data.id=[r],Global.isSet(this.getSubViewFilter)&&(l.filter_data=this.getSubViewFilter(l.filter_data)),l.filter_columns=this.getFilterColumnsForViewDetails(),this.api["get"+this.api.key_name](l,{onResult:function(_){var s=_.getResult();s||(s=[]),s=s[0],i.sub_view_mode&&i.parent_key&&(s[i.parent_key]=i.parent_value),i.current_edit_record=s,i.initEditView()}})}getFilterColumnsFromDisplayColumns(){var e={};e.id=!0,e.table_name=!0;var i=[];if(this.grid&&(i=this.grid.getGridParam("colModel")),i)for(var l=i.length,a=0;a<l;a++){var t=i[a];e[t.name]=!0}return e}getFilterColumnsForViewDetails(){var e=this.grid.getGridParam("colModel"),i={};i.id=!0,i.table_name=!0,i.details=!0;for(var l=e.length,a=0;a<l;a++){var t=e[a];i[t.name]=!0}return i}setCustomDefaultMenuIcon(e,i,l){switch(e){case"view_detail":l===1?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,i.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,i.id,!1);break}}onCustomContextClick(e){switch(e){case"view_detail":this.onViewDetailClick();break}}setCustomEditMenuIcon(e,i){switch(e){case"view_detail":ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,i.id,!1),ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,i.id,!1);break}}getCustomContextMenuModel(){var e={exclude:["default"],include:[{label:o.i18n._("View Details"),id:"view_detail",group:"editor"},"cancel"]};return e}getSubViewFilter(e){return Global.isSet(this.table_name_key)&&(e.table_name=this.tables[this.table_name_key]),e}searchDone(){o("window").trigger("resize"),TTPromise.resolve("initSubAudit","init"),super.searchDone()}getAuditLogTabHtml(){return`
		<div id="tab_audit_details" class="edit-view-tab-outside">
			<div class="edit-view-tab" id="tab_audit_details_content_div">
				<div class="first-row full-width-column">
				</div>
				<div class="detail-grid-row">
					<div class="grid-div">
						<table id="grid"></table>
					</div>
				</div>
				<div class="save-and-continue-div permission-defined-div" style="top: 240px">
					<span class="message permission-message"></span>
				</div>
			</div>
		</div>`}}b.loadSubView=function(u,e,i){Global.loadViewSource("Log","LogView.html",function(l){var a={updated:o.i18n._("Updated"),created:o.i18n._("Created")},t=h.template(l);Global.isSet(e)&&e(),Global.isSet(u)&&(u.html(t(a)),Global.isSet(i)&&i(sub_log_view_controller))})};b.html_template=`
	<div class="view sub-view logView" id="log_view_container">
	<div class="audit-info">
		<div class="left">
			<div class="label-div"><span class="label"><%= updated %>:</span></div>
			<div class="info"></div>
		</div>
		<div class="right">
			<div class="label-div"><span class="label"><%= created %>:</span></div>
			<div class="info"></div>
		</div>
	</div>
		<div class="clear-both-div"></div>
		<div class="grid-div">
			<div class="grid-top-border"></div>
			<div class="sub-grid-view-div">
				<table id="grid"></table>
			</div>
			<div class="bottom-div">
				<div class="grid-bottom-border"></div>
			</div>
		</div>
	</div>
	`;export{b as LogViewController};
//# sourceMappingURL=LogViewController-BdYBU2Io.bundle.js.map
