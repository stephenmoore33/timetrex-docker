import{_ as p,j as o}from"./vendor-tTApdY0Y.bundle.js";class u extends BaseViewController{constructor(e={}){p.defaults(e,{el:"#time_sheet_authorization_view_container",type_array:null,hierarchy_level_array:null,messages:null,message_control_api:null,authorization_api:null,request_api:null}),super(e)}init(e){this.edit_view_tpl="TimeSheetAuthorizationEditView.html",this.permission_id="punch",this.viewId="TimeSheetAuthorization",this.script_name="TimeSheetAuthorizationView",this.table_name_key="pay_period_time_sheet_verify",this.context_menu_name=o.i18n._("TimeSheet (Authorizations)"),this.navigation_label=o.i18n._("TimeSheet"),this.api=TTAPI.APIPayPeriodTimeSheetVerify,this.request_api=TTAPI.APIRequest,this.message_control_api=TTAPI.APIMessageControl,this.authorization_api=TTAPI.APIAuthorization,this.event_bus=new TTEventBus({view_id:this.viewId}),this.render(),this.buildContextMenu(!0),this.initData(),this.hierarchy_type_id=90}initOptions(){var e=this,t=this.request_api.getHierarchyLevelOptions([-1],{async:!1});if(t&&t.isValid()){var i=t.getResult();e.hierarchy_level_array=Global.buildRecordArray(i),Global.isSet(e.basic_search_field_ui_dic.hierarchy_level)&&e.basic_search_field_ui_dic.hierarchy_level.setSourceData(Global.buildRecordArray(i))}}search(e,t,i,s){this.refresh_id=null,this.updateBadgeCount(),super.search(e,t,i,s)}updateBadgeCount(){this.event_bus.emit("tt_topbar","profile_pending_counts",{object_types:["notification","timesheet_authorization"]})}processResultData(e){for(var t=e.length,i=0;i<t;i++){var s=e[i];s.id==TTUUID.not_exist_id&&(s.id=s.user_id+"_"+s.pay_period_id)}return e}parseToRecordId(e,t){return e?(e=e.toString(),e.indexOf("_")>0?t>=0?e.split("_")[t]:TTUUID.not_exist_id:e):!1}getCustomContextMenuModel(){var e={groups:{action:{label:o.i18n._("Action"),id:this.script_name+"action"},authorization:{label:o.i18n._("Authorization"),id:this.script_name+"authorization"},objects:{label:o.i18n._("Objects"),id:this.script_name+"objects"}},exclude:["default"],include:[{label:o.i18n._("View"),id:"view",group:"action",vue_icon:"tticon tticon-visibility_black_24dp",show_on_right_click:!0},{label:o.i18n._("Cancel"),id:"cancel",group:"action"},{label:o.i18n._("Authorize"),id:"authorization",vue_icon:"tticon tticon-thumb_up_black_24dp",menu_align:"center"},{label:o.i18n._("Pass"),id:"pass",vue_icon:"tticon tticon-redo_black_24dp",menu_align:"center"},{label:o.i18n._("Decline"),id:"decline",vue_icon:"tticon tticon-thumb_down_black_24dp",menu_align:"center"},{label:o.i18n._("Jump To"),id:"jump_to_header",menu_align:"right",action_group:"jump_to",action_group_header:!0,permission_result:!1},{label:o.i18n._("TimeSheet"),id:"timesheet",menu_align:"right",action_group:"jump_to",group:"navigation"},{label:o.i18n._("Schedule"),id:"schedule",menu_align:"right",action_group:"jump_to",group:"navigation"},{label:o.i18n._("Export"),id:"export_excel",group:"other",vue_icon:"tticon tticon-file_upload_black_24dp",menu_align:"right"},{label:o.i18n._("Edit Employee"),id:"edit_employee",menu_align:"right",action_group:"jump_to",group:"navigation"}]};return e}setDefaultMenuViewIcon(e,t,i){(!this.viewPermissionValidate(i)||this.edit_only_mode)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),t===1?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuEditIcon(e,t){(!this.editPermissionValidate("punch")||this.edit_only_mode)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),t===1&&this.editOwnerOrChildPermissionValidate("punch")&&this.parseToRecordId(this.getGridSelectIdArray()[0])!==TTUUID.not_exist_id?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setEditMenuEditIcon(e){(!this.editPermissionValidate("punch")||this.edit_only_mode)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),(!this.is_viewing||!this.editOwnerOrChildPermissionValidate("punch")||this.parseToRecordId(this.current_edit_record.id)===TTUUID.not_exist_id)&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}getFilterColumnsFromDisplayColumns(){var e=[];this.grid&&(e=this.grid.getGridParam("colModel"));var t={};if(t.is_owner=!0,t.id=!0,t.user_id=!0,t.is_child=!0,t.in_use=!0,t.first_name=!0,t.last_name=!0,t.start_date=!0,t.end_date=!0,t.pay_period_id=!0,e)for(var i=e.length,s=0;s<i;s++){var n=e[s];t[n.name]=!0}return t}setDefaultMenuAuthorizationExpenseIcon(e,t){Global.getProductEdition()>=25||ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0)}setCustomDefaultMenuIcon(e,t,i){switch(e){case"send":this.setDefaultMenuSaveIcon(t,i);break;case"authorization":this.setDefaultMenuAuthorizationIcon(t,i);break;case"pass":this.setDefaultMenuPassIcon(t,i);break;case"decline":this.setDefaultMenuDeclineIcon(t,i);break;case"authorization_request":this.setDefaultMenuAuthorizationRequestIcon(t,i);break;case"authorization_timesheet":this.setDefaultMenuAuthorizationTimesheetIcon(t,i);break;case"timesheet":this.setDefaultMenuViewIcon(t,i,"punch");break;case"schedule":this.setDefaultMenuViewIcon(t,i,"schedule");break;case"edit_employee":this.setDefaultMenuViewIcon(t,i,"user");break;case"authorization_expense":this.setDefaultMenuAuthorizationExpenseIcon(t,i);break}}setCustomEditMenuIcon(e,t){switch(e){case"send":this.setEditMenuSaveIcon(t);break;case"authorization":this.setEditMenuAuthorizationIcon(t);break;case"pass":this.setEditMenuPassIcon(t);break;case"decline":this.setEditMenuDeclineIcon(t);break;case"authorization_request":this.setEditMenuAuthorizationRequestIcon(t);break;case"authorization_timesheet":this.setEditMenuAuthorizationTimesheetIcon(t);break;case"timesheet":this.setEditMenuNavViewIcon(t,"punch");break;case"schedule":this.setEditMenuNavViewIcon(t,"schedule");break;case"edit_employee":this.setEditMenuNavEditIcon(t,"user");break;case"authorization_expense":this.setEditMenuAuthorizationExpenseIcon(t);break}}setEditMenuAuthorizationExpenseIcon(e){!this.current_edit_record||!this.current_edit_record.id?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0)}onCustomContextClick(e){switch(e){case"send":this.onSaveClick();break;case"authorization":this.onAuthorizationClick();break;case"pass":this.onPassClick();break;case"decline":this.onDeclineClick();break;case"authorization_request":this.onAuthorizationRequestClick();break;case"authorization_timesheet":break;case"authorization_expense":this.onAuthorizationExpenseClick();break;case"timesheet":case"schedule":case"edit_employee":case"export_excel":this.onNavigationClick(e);break}}handleAuthorizationButtons(e=!0){e==!0?(ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,"authorization",!0),ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,"pass",!0),ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,"decline",!0)):(ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,"authorization",!1),ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,"pass",!1),ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,"decline",!1))}onAuthorizationExpenseClick(){IndexViewController.goToView("ExpenseAuthorization")}onNavigationClick(e){var t=this,i,s={},n=[],a=[],d;switch(t.edit_view&&t.current_edit_record.id?(n.push(t.current_edit_record.id),a.push(t.current_edit_record.user_id),d=t.current_edit_record.start_date):(i=this.getGridSelectIdArray(),o.each(i,function(l,_){var c=t.getRecordFromGridById(_);n.push(c.id),a.push(c.user_id),d=c.start_date})),d=d?Global.strToDateTime(d).format():new Date().format(),e){case"edit_employee":a.length>0&&IndexViewController.openEditView(this,"Employee",a[0]);break;case"timesheet":a.length>0&&(s.user_id=a[0],s.base_date=d,Global.addViewTab(t.viewId,o.i18n._("Authorization - TimeSheet"),window.location.href),IndexViewController.goToView("TimeSheet",s));break;case"schedule":s.filter_data={};var r={value:a};s.filter_data.include_user_ids=r,s.select_date=d,Global.addViewTab(this.viewId,o.i18n._("Authorization - TimeSheet"),window.location.href),IndexViewController.goToView("Schedule",s);break;case"export_excel":this.onExportClick("export"+this.api.key_name);break}}onSaveClick(e){if(Global.isSet(e)||(e=!1),this.is_edit){var t=this,i={};this.is_add=!1,i=this.uniformVariable(i),this.message_control_api.setMessageControl(i,!1,e,{onResult:function(s){t.onSaveResult(s)}})}}onSaveResult(e){var t=this,i;e&&e.isValid()?(i=t.current_edit_record.id,t.onViewClick(i,!0)):(t.setErrorMenu(),t.setErrorTips(e))}validate(){var e=this,t=this.current_edit_record;t=this.uniformVariable(t),this.message_control_api["validate"+this.message_control_api.key_name](t,{onResult:function(i){e.validateResult(i)}})}onAuthorizationClick(){var e=this,t=[],i=this.getGridSelectIdArray(),s=i.length,n=r=>{var l={};return l.authorized=!0,this.parseToRecordId(r.id)==TTUUID.not_exist_id?(l.object_id=TTUUID.not_exist_id,l.user_id=r.user_id,l.pay_period_id=r.pay_period_id):l.object_id=r.id,l.object_type_id=90,l};if(s>0&&!this.is_viewing&&!this.is_edit)for(var a=0;a<s;a++){var d=this.getRecordFromGridById(i[a]);t.push(n(d))}else t.push(n(e.current_edit_record));e.handleAuthorizationButtons(!1),e.authorization_api.setAuthorization(t,{onResult:function(r){r&&r.isValid()?(e.updateBadgeCount(),e.is_edit||e.is_viewing?e.onRightArrowClick(function(){e.search(!1),o().TFeedback({source:"Authorize"})}):(e.search(!0),o().TFeedback({source:"Authorize"}))):TAlertManager.showErrorAlert(r),e.handleAuthorizationButtons(!0)},onError:function(r){e.handleAuthorizationButtons(!0)}})}onPassClick(){var e=this;this.onRightArrowClick(function(){e.search(),o().TFeedback({source:"Pass"})})}onAuthorizationRequestClick(){IndexViewController.goToView("RequestAuthorization")}onCancelClick(e,t,i){var s=this;super.onCancelClick(e,t,function(){i&&i(),s.search()})}onDeclineClick(){var e=this,t=[],i=this.getGridSelectIdArray(),s=i.length,n=r=>{var l={};return l.authorized=!1,this.parseToRecordId(r.id)==TTUUID.not_exist_id?(l.object_id=TTUUID.not_exist_id,l.user_id=r.user_id,l.pay_period_id=r.pay_period_id):l.object_id=r.id,l.object_type_id=90,l};if(s>0&&!this.is_viewing&&!this.is_edit)for(var a=0;a<s;a++){var d=this.getRecordFromGridById(i[a]);t.push(n(d))}else t.push(n(e.current_edit_record));e.handleAuthorizationButtons(!1),e.authorization_api.setAuthorization(t,{onResult:function(r){r&&r.isValid()?(e.updateBadgeCount(),e.is_edit||e.is_viewing?(e.search(!1),e.onRightArrowClick(function(){o().TFeedback({source:"Decline"})})):(e.search(!0),o().TFeedback({source:"Decline"}))):TAlertManager.showErrorAlert(r),e.handleAuthorizationButtons(!0)},onError:function(r){e.handleAuthorizationButtons(!0)}})}onAuthorizationTimesheetClick(){this.search(!1)}uniformVariable(e){var t={};return this.is_edit&&this.current_edit_record!=null?(t.body=this.current_edit_record.body,t.from_user_id=this.current_edit_record.user_id,t.to_user_id=this.current_edit_record.user_id,t.object_id=this.current_edit_record.id,t.object_type_id=90,Global.isFalseOrNull(this.current_edit_record.subject)?t.subject=this.edit_view_ui_dic.subject.getValue():t.subject=this.current_edit_record.subject,t):(e.id=this.parseToRecordId(e.id),e)}getAPIFilters(){var e=this.getCurrentSelectedRecord(),t={};return t.filter_data={},this.parseToRecordId(e)!=TTUUID.not_exist_id?t.filter_data.id=[e]:(t.filter_data.user_id=this.parseToRecordId(e,0),t.filter_data.pay_period_id=this.parseToRecordId(e,1)),t}handleViewAPICallbackResult(e){var t=e.getResult();return this.getCurrentSelectedRecord(),t=this.processResultData(t),t||(t=[]),t=t[0],super.handleViewAPICallbackResult(t)}doViewClickResult(e){super.doViewClickResult(e),AuthorizationHistory.init(this)}onGridDblClickRow(){ProgressBar.showOverlay(),this.onViewClick()}setEditMenuAuthorizationIcon(e){this.is_edit?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0)}setEditMenuPassIcon(e){this.is_edit?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0)}setEditMenuDeclineIcon(e){this.is_edit?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0)}setEditMenuAuthorizationRequestIcon(e){!this.current_edit_record||!this.current_edit_record.id?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0)}setEditMenuAuthorizationTimesheetIcon(e){!this.current_edit_record||!this.current_edit_record.id?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0)}setDefaultMenuSaveIcon(e,t){ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuAuthorizationIcon(e,t){t>0?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuPassIcon(e,t){this.is_viewing||ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuDeclineIcon(e,t){t>0?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuAuthorizationRequestIcon(e,t){ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0)}setDefaultMenuAuthorizationTimesheetIcon(e,t){ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0)}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:o.i18n._("Employee"),in_column:1,field:"user_id",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:o.i18n._("Pay Period"),in_column:1,field:"pay_period_id",layout_name:"global_Pay_period",api_class:TTAPI.APIPayPeriod,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:o.i18n._("Hierarchy Level"),in_column:1,multiple:!1,set_any:!1,field:"hierarchy_level",basic_search:!0,adv_search:!1,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:o.i18n._("Created By"),in_column:2,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:o.i18n._("Updated By"),in_column:2,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX})]}onEditClick(e,t){var i=this;this.is_viewing=!1,this.is_edit=!0,this.is_add=!1,LocalCacheData.current_doing_context_action="edit",i.openEditView(),i.initEditView()}getSubViewFilter(e){return e.length===0&&(e={}),Global.isSet(e.hierarchy_level)||(e.hierarchy_level=1,this.filter_data.hierarchy_level={field:"hierarchy_level",id:"",value:this.basic_search_field_ui_dic.hierarchy_level.getValue(!0)}),e}buildEditViewUI(){super.buildEditViewUI();var e={tab_timesheet_verification:{label:o.i18n._("Message"),is_multi_column:!0}};this.setTabModel(e),this.navigation=null;var t=this.edit_view_tab.find("#tab_timesheet_verification"),i=t.find(".first-column"),s=t.find(".second-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(i);var n=Global.loadWidgetByName(FormItemType.TEXT_INPUT);n.TTextInput({field:"subject",width:359}),this.addEditFieldToColumn(o.i18n._("Subject"),n,i,""),n=Global.loadWidgetByName(FormItemType.TEXT_AREA),n.TTextArea({field:"body",width:600,height:400}),this.addEditFieldToColumn(o.i18n._("Body"),n,i,"",null,null,!0),s.css("display","none")}needShowNavigation(){return!!(this.is_viewing&&this.current_edit_record&&Global.isSet(this.current_edit_record.id)&&this.current_edit_record.id)}buildViewUI(){var e=this.navigation&&this.navigation.getPagerData&&this.navigation.getPagerData(),t=this.navigation&&this.navigation.getSourceData&&this.navigation.getSourceData();super.buildEditViewUI();var i={tab_timesheet_verification:{label:o.i18n._("TimeSheet Verification"),html_template:this.getTimeSheetAuthorizationTabHtml()}};this.setTabModel(i),this.navigation.AComboBox({api_class:TTAPI.APIPayPeriodTimeSheetVerify,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_Pay_period",navigation_mode:!0,show_search_inputs:!0,extendDataProcessWhenSearch:this.processResultData}),this.setNavigation(),e&&t&&(this.navigation.setSourceData(t),this.navigation.setPagerData(e));var s=this.edit_view_tab.find("#tab_timesheet_verification"),n=s.find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(n);var a=Global.loadWidgetByName(FormItemType.TEXT);a.TText({field:"full_name",selected_able:!0}),this.addEditFieldToColumn(o.i18n._("Employee"),a,n,""),a=Global.loadWidgetByName(FormItemType.TEXT),a.TText({field:"status",selected_able:!0}),this.addEditFieldToColumn(o.i18n._("Status"),a,n,""),a=Global.loadWidgetByName(FormItemType.TEXT),a.TText({field:"pay_period",selected_able:!0}),this.addEditFieldToColumn(o.i18n._("Pay Period"),a,n);var d=s.find(".separate");a=Global.loadWidgetByName(FormItemType.SEPARATED_BOX),a.SeparatedBox({label:o.i18n._("Messages")}),this.addEditFieldToColumn(null,a,d),d.css("display","none");var r=s.find(".second-column");this.edit_view_tabs[0].push(r),a=Global.loadWidgetByName(FormItemType.TEXT),a.TText({field:"from",selected_able:!0}),this.addEditFieldToColumn(o.i18n._("From"),a,r,""),a=Global.loadWidgetByName(FormItemType.TEXT),a.TText({field:"subject",selected_able:!0}),this.addEditFieldToColumn(o.i18n._("Subject"),a,r),a=Global.loadWidgetByName(FormItemType.TEXT),a.TText({field:"body",width:600,height:400,selected_able:!0}),this.addEditFieldToColumn(o.i18n._("Body"),a,r,"",null,!0,!0),r.css("display","none")}initEditViewUI(e,t){Global.setUINotready(),TTPromise.add("init","init"),TTPromise.wait();var i=this;this.edit_view&&this.edit_view.remove(),this.edit_view=o(Global.loadViewSource(e,t,null,!0)),this.edit_view_tab=o(this.edit_view.find(".edit-view-tab-bar")),this.edit_view_tab.attr("id",this.ui_id+"_edit_view_tab"),Global.contentContainer().append(this.edit_view),this.initRightClickMenu(RightClickMenuType.EDITVIEW),this.is_viewing?(LocalCacheData.current_doing_context_action="view",this.buildViewUI()):this.is_edit&&(LocalCacheData.current_doing_context_action="edit",this.buildEditViewUI()),i.setEditViewTabHeight()}initEditViewTabs(){var e=this,t={activate:function(i,s){e.onTabShow(i,s)}};super.initEditViewTabs(t)}setCurrentEditRecordData(){for(var e in this.current_edit_record)if(this.current_edit_record.hasOwnProperty(e)){var t=this.edit_view_ui_dic[e];if(Global.isSet(t))switch(e){case"full_name":this.is_viewing&&t.setValue(this.current_edit_record.first_name+" "+this.current_edit_record.last_name);break;case"pay_period":t.setValue(this.current_edit_record.start_date+" "+this.current_edit_record.end_date);break;case"subject":this.is_edit?Global.isSet(this.messages)&&t.setValue("Re: "+this.messages[0].subject):this.is_viewing&&t.setValue(this.current_edit_record[e]);break;default:t.setValue(this.current_edit_record[e]);break}}this.collectUIDataToCurrentEditRecord(),this.setEditViewDataDone()}setEditViewDataDone(){var e=this;super.setEditViewDataDone(),this.is_viewing?(this.initTimeSheetSummary(),this.initExceptionSummary()):Global.isSet(e.messages)&&(e.messages=null)}buildExceptionDisplayColumns(e){for(var t=this.all_exception_columns.length,i=e?e.length:0,s=[],n=0;n<i;n++)for(var a=0;a<t;a++)e[n]===this.all_exception_columns[a].value&&s.push(this.all_exception_columns[a]);return s}initExceptionSummary(){var e=this;this.api_exception||(this.api_exception=TTAPI.APIException),e.buildExceptionGrid(),e.setExceptionGridSize(),this.api_exception.getOptions("columns",{onResult:function(t){var i=t.getResult();if(Global.isSet(e.current_edit_record)==!1)return!1;var s={filter_data:{user_id:e.current_edit_record.user_id,pay_period_id:e.current_edit_record.pay_period_id,type_id:[30,40,50,55,60]},filter_columns:{date_stamp:!0,severity:!0,exception_policy_type:!0,exception_policy_type_id:!0,exception_color:!0,exception_background_color:!0}};e.api_exception.getException(s,{onResult:function(n){e.all_exception_columns=Global.buildColumnArray(i),Global.isSet(e.exception_grid)||o("#exception_grid");var a=["date_stamp","severity","exception_policy_type","exception_policy_type_id","exception_color","exception_background_color"];a=e.buildExceptionDisplayColumns(a);for(var d=[],r=a.length,l=0,_=l;_<r;_++){var c=a[_],h={name:c.value,index:c.value,label:c.label,width:25,sortable:!1,title:!1};d.push(h)}e.buildExceptionGrid(d);var m=n.getResult();!Global.isArray(m)&&TTUUID.isUUID(e.refresh_id)==!1?e.showExceptionGridNoResultCover():(e.removeExceptionGridNoResultCover(),e.exception_grid.setData(Global.formatGridData(n.getResult()))),e.setExceptionGridSize(),o(".exception-title").text(o.i18n._("Exceptions")),o(".exception-title").css("width",e.exception_grid.grid.width()-1+"px !important"),e.setGridCellBackGround()}})}})}buildExceptionGrid(e){var t=this;typeof e>"u"&&(e=[]),this.exception_grid&&(this.exception_grid.grid.jqGrid("GridUnload"),this.exception_grid=null),this.exception_grid=new TTGrid("exception_grid",{container_selector:"#exception_grid",onResizeGrid:!1,multiselect:!1,winMultiSelect:!1,gridComplete:function(){o(this).jqGrid("getGridParam","data").length>0&&t.exception_grid.setGridColumnsWidth()},ondblClickRow:function(i){t.onExceptionGridDblClickRow(i)},sortable:!1,height:160},e)}showExceptionGridNoResultCover(){this.removeExceptionGridNoResultCover(),this.exception_grid_no_result_box=Global.loadWidgetByName(WidgetNamesDic.NO_RESULT_BOX),this.exception_grid_no_result_box.NoResultBox({related_view_controller:this,is_new:!1});var e=o(".exception-grid-div");e.css("position","relative"),this.exception_grid_no_result_box.attr("id","#exception_grid_no_result_box"),this.exception_grid_no_result_box.css("width",parseInt(e.width())+"px"),this.exception_grid_no_result_box.css("height",parseInt(e.height())+"px"),e.append(this.exception_grid_no_result_box)}removeExceptionGridNoResultCover(){this.exception_grid_no_result_box&&this.exception_grid_no_result_box.length>0&&this.exception_grid_no_result_box.remove(),this.exception_grid_no_result_box=null}setEditViewTabSize(){super.setEditViewTabSize(),this.setExceptionGridSize(),this.setTimeSheetSummaryGridSize()}setGridCellBackGround(){var e,t,i,s;if(!(!this.exception_grid||!this.edit_view)&&(e=this.exception_grid.getGridParam("data"),!!e)){t=e.length;for(var i=0;i<t;i++){if(s=e[i],s.exception_background_color){var n=this.edit_view.find("tr[id='"+s.id+"']").find('td[aria-describedby="exception_grid_severity"]');n.css("background-color",s.exception_background_color),n.css("font-weight","bold")}if(s.exception_color){var a=this.edit_view.find("tr[id='"+s.id+"']").find('td[aria-describedby="exception_grid_exception_policy_type_id"]');a.css("color",s.exception_color),a.css("font-weight","bold")}}}}initTimeSheetSummary(){var e=this;if(Global.isSet(this.current_edit_record)==!1)return!1;this.accumulated_total_grid_source_map={},this.api_timesheet||(this.api_timesheet=TTAPI.APITimeSheet),e.buildAccumulatedTotalGrid(),this.api_timesheet.getTimeSheetData(this.current_edit_record.user_id,this.current_edit_record.start_date,{onResult:function(t){if(Global.isSet(e.current_edit_record)==!1)return!1;e.full_timesheet_data=t.getResult(),e.pay_period_data=e.full_timesheet_data.pay_period_data,e.timesheet_verify_data=e.full_timesheet_data.timesheet_verify_data,e.start_date=Global.strToDate(e.full_timesheet_data.timesheet_dates.start_display_date),e.end_date=Global.strToDate(e.full_timesheet_data.timesheet_dates.end_display_date);var i=[],s={name:"punch_info",index:"punch_info",label:" ",width:200,fixed:!0,sortable:!1,title:!1,formatter:e.onCellFormat};i.push(s);var n=e.current_edit_record.start_date,a=e.current_edit_record.end_date;e.getAccumulatedTotalGridPayperiodHeader(),o.i18n._("Week")+""+n+a,e.onCellFormat;var d={name:"pay_period",index:"pay_period",label:o.i18n._("Pay Period")+"<br>"+e.pay_period_header,width:100,sortable:!1,title:!1,formatter:e.onCellFormat};i.push(d),e.buildAccumulatedTotalGrid(i),e.buildAccumulatedTotalData(),e.setTimeSheetSummaryGridSize(),o(".button-rotate").removeClass("button-rotate")}})}buildAccmulatedOrderMap(e){if(e)for(var t in e)for(var i in e[t])this.accmulated_order_map[i]=e[t][i].order}buildSubGridsData(e,t,i,s,n){var a,d=!1;for(var r in e)if(i[r])a=i[r],a[t],e[r].key=r,a[t]=Global.getTimeUnit(e[r].total_time),a[t+"_data"]=e[r],a.parent_key==="accumulated_time"&&e[r].override&&(a.is_override_row=!0);else{a={},a.parent_key=n,a.key=r,n==="accumulated_time"?(r==="total"||r==="worked_time"?a.type=u.TOTAL_ROW:d==!1&&r.indexOf("regular_time")===0?(a.type=u.REGULAR_ROW,d=!0):a.type=u.ACCUMULATED_TIME_ROW,e[r].override&&(a.is_override_row=!0)):n==="premium_time"&&(a.type=u.PREMIUM_ROW),this.accmulated_order_map[r]&&(a.order=this.accmulated_order_map[r]),a.punch_info=e[r].label;var l=r.split("_"),_=!1;l.length>1&&l[1]=="0"&&(_=!0),e[r].key=r,a[t]=Global.getTimeUnit(e[r].total_time),a[t+"_data"]=e[r],_?s.unshift(a):s.push(a),i[r]=a}}buildAccumulatedTotalData(){this.accmulated_order_map={},this.accumulated_total_grid_source=[];var e=this.full_timesheet_data.accumulated_user_date_total_data,t=this.full_timesheet_data.pay_period_accumulated_user_date_total_data,i=t.accumulated_time,s=t.premium_time,n=t.absence_time_taken;e.total&&this.buildAccmulatedOrderMap(e.total),t&&this.buildAccmulatedOrderMap(t),Global.isSet(i)?this.buildSubGridsData(i,"pay_period",this.accumulated_total_grid_source_map,this.accumulated_total_grid_source,"accumulated_time"):(i={total:{label:"Total Time",total_time:"0"}},this.buildSubGridsData(i,"pay_period",this.accumulated_total_grid_source_map,this.accumulated_total_grid_source,"accumulated_time")),Global.isSet(s)&&this.buildSubGridsData(s,"pay_period",this.accumulated_total_grid_source_map,this.accumulated_total_grid_source,"premium_time"),Global.isSet(n)&&this.buildSubGridsData(n,"pay_period",this.accumulated_total_grid_source_map,this.accumulated_total_grid_source,"absence_time"),i={total:{label:"Total Time",total_time:"0"}},this.buildSubGridsData(i,"week",this.accumulated_total_grid_source_map,this.accumulated_total_grid_source,"accumulated_time");for(var a in e)if(a==="total"){var d=e.total;i=d.accumulated_time,s=d.premium_time,n=d.absence_time_taken,Global.isSet(i)&&this.buildSubGridsData(i,"week",this.accumulated_total_grid_source_map,this.accumulated_total_grid_source,"accumulated_time"),Global.isSet(s)&&this.buildSubGridsData(s,"week",this.accumulated_total_grid_source_map,this.accumulated_total_grid_source,"premium_time"),Global.isSet(n)&&this.buildSubGridsData(n,"week",this.accumulated_total_grid_source_map,this.accumulated_total_grid_source,"absence_time");continue}this.sortAccumulatedTotalData(),this.timesheet_authorization_summary_grid.setData(this.accumulated_total_grid_source),o(".timesheet-authorization-summary-title").text(o.i18n._("TimeSheet Summary"))}sortAccumulatedTotalData(){var e=["order","punch_info"];this.accumulated_total_grid_source.sort(Global.m_sort_by(e))}getAccumulatedTotalGridPayperiodHeader(){this.pay_period_header=o.i18n._("No Pay Period");var e=this.timesheet_verify_data.pay_period_id;if(e&&this.pay_period_data)for(var t in this.pay_period_data){var i=this.pay_period_data[t];if(i.id===e){var s=Global.strToDate(i.start_date).format(),n=Global.strToDate(i.end_date).format();this.pay_period_header=s+" to "+n;break}}}buildAccumulatedTotalGrid(e){var t=this;typeof e>"u"&&(e=[]),this.timesheet_authorization_summary_grid&&(this.timesheet_authorization_summary_grid.grid.jqGrid("GridUnload"),this.timesheet_authorization_summary_grid=null);var t=this;this.timesheet_authorization_summary_grid=new TTGrid("timesheet_authorization_summary_grid",{multiselect:!1,winMultiSelect:!1,sortable:!1,onResizeGrid:!1,gridComplete:function(){t.setTimeSheetSummaryGridSize()},ondblClickRow:function(){t.onTimeSheetGridDblClickRow()}},e),this.setTimeSheetSummaryGridSize()}onTimeSheetGridDblClickRow(){var e={filter_data:{}};e.user_id=this.current_edit_record.user_id,e.base_date=Global.strToDateTime(this.current_edit_record.start_date).format(),Global.addViewTab(this.viewId,o.i18n._("TimeSheet (Authorizations)"),window.location.href),IndexViewController.goToView("TimeSheet",e)}onExceptionGridDblClickRow(e){var t=this.exception_grid.grid.jqGrid("getCell",e,"date_stamp");t||(t=Global.strToDateTime(this.current_edit_record.start_date).format());var i={filter_data:{}};i.user_id=this.current_edit_record.user_id,i.base_date=t,Global.addViewTab(this.viewId,o.i18n._("TimeSheet (Authorizations)"),window.location.href),IndexViewController.goToView("TimeSheet",i)}onCellFormat(e,t,i){e=Global.decodeCellValue(e);var s=t.colModel;t.rowid;var n=o("<div class='punch-content-div'></div>"),a;if(t.pos===0)return i.type===u.TOTAL_ROW?(a=o("<span class='total' style='font-size: 11px'></span>"),Global.isSet(e)?a.text(e):a.text(""),a.get(0).outerHTML):i.type===u.REGULAR_ROW?(a=o("<span class='top-line-span' style='font-size: 11px'></span>"),Global.isSet(e)?a.text(e):a.text(""),a.get(0).outerHTML):e;var d,r;return i.type===u.TOTAL_ROW?(r=i[s.name+"_data"],d=o("<span class='total'></span>"),Global.isSet(e)?(r&&(r.hasOwnProperty("override")&&r.override===!0&&d.addClass("absence-override"),r.hasOwnProperty("note")&&r.note&&(e="*"+e)),d.text(e)):d.text(""),n.prepend(d)):i.type===u.REGULAR_ROW?(n.addClass("top-line"),r=i[s.name+"_data"],d=o("<span ></span>"),Global.isSet(e)?(r&&(r.hasOwnProperty("override")&&r.override===!0&&d.addClass("absence-override"),r.hasOwnProperty("note")&&r.note&&(e="*"+e)),d.text(e)):d.text(""),n.prepend(d)):i.type===u.ACCUMULATED_TIME_ROW?(r=i[s.name+"_data"],d=o("<span></span>"),Global.isSet(e)?(r&&(r.hasOwnProperty("override")&&r.override===!0&&d.addClass("absence-override"),r.hasOwnProperty("note")&&r.note&&(e="*"+e)),d.text(e)):d.text(""),n.prepend(d)):(d=o("<span class='punch-time'></span>"),Global.isSet(e)?d.text(e):d.text(""),n.prepend(d)),n.get(0).outerHTML}setExceptionGridSize(){if(this.exception_grid){var e=2,t=this.exception_grid.getData();Global.isArray(t)&&(e+=22*t.length),this.exception_grid.setGridHeight(e)}}setTimeSheetSummaryGridSize(){if(this.timesheet_authorization_summary_grid){var e=2,t=this.timesheet_authorization_summary_grid.getData();Global.isArray(t)&&(e+=22*t.length),this.timesheet_authorization_summary_grid.setGridHeight(e)}}getTimeSheetAuthorizationTabHtml(){return`
		<div id="tab_timesheet_verification" class="edit-view-tab-outside">
			<div class="edit-view-tab" id="tab_timesheet_verification_content_div">
				<div class="first-column full-width-column"></div>
				<div class="authorization-grid-div inside-grid full-width-column">
					<div class="grid-top-border"></div>
					<div class="grid-title separated-box"></div>
					<table id="grid"></table>
					<div class="bottom-div">
						<div class="grid-bottom-border"></div>
					</div>
					<br>
				</div>
				<div class="third-column  timesheet-authorization-grid-div">
					<div class="accumulated-total-grid-title timesheet-authorization-summary-title full-width-column"></div>
					<table id="timesheet_authorization_summary_grid"></table>
				</div>
				<div class="forth-column  exception-grid-div">
					<div class="accumulated-total-grid-title exception-title full-width-column"></div>
					<table id="exception_grid"></table>
				</div>
				<div class="separate full-width-column"></div>
				<div class="second-column full-width-column" style="margin-left: 0"></div>
			</div>
		</div>`}}u.TOTAL_ROW=4;u.REGULAR_ROW=5;u.ABSENCE_ROW=6;u.ACCUMULATED_TIME_ROW=7;u.PREMIUM_ROW=8;export{u as TimeSheetAuthorizationViewController};
//# sourceMappingURL=TimeSheetAuthorizationViewController-DozFPW5F.bundle.js.map
