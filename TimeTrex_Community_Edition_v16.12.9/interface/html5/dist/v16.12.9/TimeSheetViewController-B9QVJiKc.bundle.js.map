{"version":3,"mappings":"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","names":["_sfc_main","new_value","item_id","item","element","value","SelectButton","TTContextButton","_hoisted_1","_hoisted_2","_createStaticVNode","_hoisted_4","_hoisted_5","_hoisted_6","_openBlock","_createElementBlock","_createElementVNode","_createVNode","_component_SelectButton","$data","_cache","$event","_component_TTContextButton","_normalizeClass","event_data","parent_td","input","TextArea","Button","_Fragment","$options","args","_withDirectives","_toDisplayString","_component_TextArea","_component_Button","_withCtx","_createTextVNode","_hoisted_3","_vShow","TimeSheetViewController","options","_","$","Global","is_cancel","p_id","new_item","permission_name","selected_item","field","user","context_menu_model","key","widget","column","$this","tab_model","form_item_input","widgetContainer","tab_punch","tab_punch_column1","filter","release_balance_button","check_box","label","val","job_coder","job_item_coder","punch_tags","get_real_data","punch_tag_coder","good","good_label","bad","bad_label","latitude","longitude","accuracy","map_icon","isChecked","getEnabled","event","_a","date","dates","resultArray","beginDate","endDate","nextDate","record","i","len","temp_item","dates_array","common_record","result","target","doNotValidate","c_value","TTUUID","layout_div","form_item","form_item_label","form_item_input_div","save_btn","update_btn","del_btn","root_props","vue_return","TTVueUtils","TimeSheetControlBar","date_chooser_div","employee_nav_div","date_chooser","date_left_arrow","date_right_arrow","select_date","new_date","continueChangeDate","doNext","reset","left_click","right_click","navigation_widget_div","default_args","selected_user_id","selected_index","source_data","current_open_page","next_select_item","doNextDone","mode","toggle_div","records","flag","user_id","id","resetWage","resetTimeZone","resetManual","pager_data","do_update","default_layout_id","layout_name","filter_data","res","selectId","default_layout_name","save_only","start_date_string","setDefaultMenu","force","columns","grid","grid_id","first_column","second_column","index","table","pay_period_id","pay_period","start_date","end_date","width","punch_column_width","punch_in_out_column","start_date_str","end_date_str","column_width","column_1","column_2","accumulated_total_grid_title","display_columns","column_info","column_header","onColumnHeaderClick","e","row_id","cell_index","m","cell","title","iRow","cell_val","$trs","skips","colored","grid_setup_data","row_index","row","name","context_menu_array","need_break","html_grid_id","title_bar","img","description","title_span","current_date","day_text","date_text","callBack","sort_by_fields","manual_timesheet_data_group_array","override_true_array","override_false_array","manual_timesheet_data","target_map","data","j","widgets","widget_key","has_no_matching_user_date_total_record","note","note_mount_point","TimeSheetNote","updateExistedCell","map_key","map_key_2","item_id_key","job_item_api","job_api","punch_tag_api","department_api","widget_row","render","branch_id","department_id","job_form_item_input","job_id","onJobQuickSearch","job_item_id","disable_plus","disable_minus","disable_dropdowns","invalid","n","field_pay_period_status","setJobItemValueWhenJobChanged","setPunchTagValuesWhenCriteriaChanged","setDepartmentValueWhenBranchChanged","result_data","job","job_item_widget","current_job_item_id","new_arg","task_result","setDefaultData","department_widget","current_department_id","department_result","department","punch_tag_widget","current_punch_tag_ids","punch_tag_result","shouldUpdatePunchTags","intersected_values","punch_tag_id","punch_tag","control_icons","control_icon","isSave","has_value","remove_ids","getRender","getRowRender","inside_editor_div","is_no_manual","is_no_punch","cols","timesheet_grid_div","warning_bar","user_pay_period_check","payPeriodCheck","hire_date","termination_date","select_date_str","date_string","column_date_string","new_tr","new_th","default_th","week_th","pay_period_th","holiday_name_map","standard_date","colspan","size_tr","current_trs","createSizeColumns","createNoPayPeriodColumns","last_pay_period_id","column_number","map_array","y","p_key","createTh","getPayPeriod","end_index","th","$grid","scroll_height","height","timesheet_grid","grid_width","accumulated_grid_width","verification_grid_width","tr","manual_grid_tr","td","cell_value","related_data","col_model","content_div","punch_info","ex_span","time_span_prefix","time_span","time_span_suffix","punch","break_span","related_punch","exception","ex","currency","break_label","break_label_title","label_prefix","label_prefix_title","label_suffix","label_suffix_title","createRequestToolTip","absence","calDAndA","array","a","d","p","row_tr","cells_array","info","cell_td","date_time","b","t","row_data","colModel","data_field","pending_requests","total_requests","obj","date_str","time_stamp_num","found","getCellPunch","getRelatedPunch","status_id","start_row_index","start_cell_index","end_row_index","end_cell_index","tmp_row_index","tmp_cell_index","tmp_row_id","uppermost_row_index","lowermost_row_index","leftmost_cell_index","rightmost_cell_index","r_index","c_index","request_array","request_row_index","request","exception_array","timesheet_data_source_len","exception_row_index","sort_fields","context_btn","grid_selected_length","pId","total","key1","accumulated_user_date_total_data","meal_and_break_total_data","pay_period_accumulated_user_date_total_data","accumulated_time","premium_time","absence_time","column_len","start","total_result","branch_time","department_time","job_time","job_item_time","punch_tag_time","map","result_array","parent_key","key_array","no_id","verify_action_bar","verify_grid_div","verify_btn","verify_title","verify_des","verification_data","pay_period_data","punch_array","user_date_total_array","len1","last_control_id","x","user_date_total","absence_array","row_id_counter","current_data","last_date","new_row","punch_status_id","our_row","find_position","cost_center_cols","last_col_index","header_text","split_header_text_array","split_header_text_month","callback","layouts_array","position","cells","container","span","target_cell","punch_date","target_punch","target_related_punch","target_column_date","first_select_date","time_offset","target_column_date_str","savePunch","new_punch_id","target_id","target_status_id","action_type","api_punch_control","last_date_string","loginUser","format","dateStr","location","full_item","retval","ignoreWarning","current_api","refresh_id","api_args","type","tmp_record_id","input_div","result1","record_id","tab_name","current_column_field","punch_control_id","current_punch_id","current_punch_status_id","type_id","previous_punch_id","tmp_status_id","iconName","post_data","include_users","users","postData","punches","map_options","ids","__vitePreload","module","processed_punches_for_map","default_data","drag_copy_icon","icon","move_icon","drag_invisible","move_invisible","date_dic","doing_save_and_new","prev_punch_id","select_cell","select_item","pre_punch","left_side_punch","navigation_div","retarr","check_fields","dataset","successCallback","moved_unsaved_markers","tab_0_label","date_array","select_employee","actual_time_value","location_data","release_balance","last_date_stamp","total_time","arg","doNotSetFocus","grid_selected_id_array","balance","timesheet_data","is_punch_exist","scroll_adjustment"],"ignoreList":[],"sources":["../../components/timesheet/TimeSheetControlBar.vue","../../components/timesheet/TimeSheetNote.vue","../../views/attendance/timesheet/TimeSheetViewController.js"],"sourcesContent":["<template>\n    <div class=\"tt-horizontal-vue-bar\">\n        <div class=\"bar-column left\"></div>\n        <div class=\"bar-column center\">\n            <div class=\"bar-column date-chooser-div\"></div>\n            <div class=\"bar-column employee-nav-div\">\n                <span class=\"navigation-label\"></span>\n                <img class=\"left-click\"/>\n                <div class=\"navigation-widget-div\"></div>\n                <img class=\"right-click\"/>\n            </div>\n        </div>\n        <div class=\"bar-column right\">\n            <div class=\"bar-column punch-manual\">\n                <SelectButton v-model=\"punch_mode_selected\" :options=\"punch_modes\" optionLabel=\"label\" optionValue=\"value\" @click=\"this.onPunchModeChange();\"/>\n            </div>\n            <div class=\"bar-column menu-item\">\n                <TTContextButton :class=\"['no-wrap']\" :items=\"timesheet_settings_options\" />\n            </div>\n        </div>\n    </div>\n</template>\n\n<script>\nimport SelectButton from 'primevue/selectbutton';\nimport TTContextButton from '@/components/context_menu/TTContextButton';\n\nexport default {\n    name: \"TimeSheetControlBar\",\n    props: {\n        component_id: { // passed in via root props from TimeSheetViewController\n            type: String,\n            default: null\n        },\n        onPunchModeChange: { // passed in via root props from TimeSheetViewController\n            type: Function,\n            default: null\n        },\n        onShowWageClick: { // passed in via root props from TimeSheetViewController\n            type: Function,\n            default: null\n        },\n        onTimezoneClick: { // passed in via root props from TimeSheetViewController\n            type: Function,\n            default: null\n        }\n    },\n    data() {\n        return {\n            punch_mode_selected: 'punch',\n            punch_modes: [\n                { label: $.i18n._( 'Punch' ), value: 'punch' },\n                { label: $.i18n._( 'Manual' ), value: 'manual' },\n            ],\n            timesheet_settings_options: [\n                {\n                    label: $.i18n._( 'Show Wages' ),\n                    id: 'show_wages',\n                    no_group_label: true,\n                    vue_icon: 'tticon tticon-settings_black_24dp',\n                    action_group: 'timesheet_settings',\n                    multi_select_group: 1,\n                    visible: PermissionManager.checkTopLevelPermission( 'Wage' ),\n                    command: () => {\n                        if( this.onShowWageClick && typeof this.onShowWageClick === 'function' ) {\n                            this.onShowWageClick( this.timesheet_settings_options[0].active );\n                        }\n                    }\n                },\n                {\n                    label: $.i18n._( 'Use Employee Timezone' ),\n                    id: 'use_employee_timezone',\n                    no_group_label: true,\n                    vue_icon: 'tticon tticon-settings_black_24dp',\n                    action_group: 'timesheet_settings',\n                    multi_select_group: 2,\n                    visible: ( PermissionManager.validate( 'punch', 'view' ) || PermissionManager.validate( 'punch', 'view_child' ) ),\n                    command: () => {\n                        if( this.onTimezoneClick && typeof this.onTimezoneClick === 'function' ) {\n                            this.onTimezoneClick( this.timesheet_settings_options[1].active );\n                        }\n                    }\n                },\n            ]\n        }\n    },\n    // watch: {\n    //     punch_mode_selected: function ( val ) {\n    //         if( this.onPunchModeChange && typeof this.onPunchModeChange === 'function' ) {\n    //             this.onPunchModeChange( val, false );\n    //         }\n    //     },\n    // },\n    computed: {\n        getPunchMode() { // This way the value is cached if it doesnt change.\n            return this.punch_mode_selected;\n        }\n    },\n    methods: {\n        setPunchMode( new_value ) {\n            if ( new_value === 'punch' || new_value === 'manual' ) { // validate the input potentially coming from outside Vue.\n                this.punch_mode_selected = new_value;\n                return true;\n            } else {\n                Debug.Error( 'Invalid parameters passed to function: ', 'TimeSheetControlBar.vue', 'TimeSheetControlBar', 'setPunchMode', 1 );\n                return false;\n            }\n        },\n        getTimesheetSettingsState( item_id ) {\n            var item = this.timesheet_settings_options.find( element => element.id === item_id );\n            if( item ) {\n                return item.active;\n            } else {\n                Debug.Error( 'Item not found ('+ item_id +'). Check supplied id.', 'TimeSheetControlBar.vue', 'TimeSheetControlBar', 'getTimesheetSettingsState', 1 );\n                return undefined;\n            }\n        },\n        setTimesheetSettingsState( item_id, value ) {\n            var item = this.timesheet_settings_options.find( element => element.id === item_id );\n            if( item ) {\n                item.active = value;\n            } else {\n                Debug.Error( 'Item not found ('+ item_id +'). Check supplied id.', 'TimeSheetControlBar.vue', 'TimeSheetControlBar', 'setTimesheetSettingsState', 1 );\n            }\n        }\n    },\n    components: {\n        SelectButton: SelectButton,\n        TTContextButton: TTContextButton\n    }\n};\n</script>\n\n<style scoped>\n    .tt-horizontal-vue-bar {\n        display: flex;\n        flex-direction: row;\n        justify-content: space-between;\n        align-items: center;\n        margin-top: 3px;\n    }\n    .bar-column {\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        padding: 0 5px;\n    }\n    .bar-column.left,\n    .bar-column.right {\n        width: 25%;\n    }\n    .bar-column.right {\n        justify-content: flex-end;\n    }\n    ::v-deep(.punch-manual .p-button) {\n        padding: .55rem .6rem;\n    }\n    ::v-deep(.p-button-label) {\n        font-size: 12px;\n    }\n</style>","<template>\n    <span v-show=\"show_add_note\" class=\"note-icon tticon tticon-add_black_24dp\" @click=\"noteIconClicked\" ref=\"note_icon\"></span>\n    <div v-show=\"visible\" class=\"note-dialog p-component\" ref=\"dialog\">\n        <h5 class =\"note-label\">{{ label_note }}</h5>\n        <span @click=\"this.visible = false\" class=\"dialog-close\"></span>\n        <TextArea v-model=\"note\" rows=\"4\"/>\n        <Button type=\"submit\" class=\"save-button\" @click=\"saveNote\">{{ label_save }}</Button>\n    </div>\n    <span v-show=\"note !== '' && !show_add_note\" class=\"blue-circle-icon\" ref=\"blue_circle\"></span>\n</template>\n<script>\nimport Button from 'primevue/button';\nimport TextArea from 'primevue/textarea';\n\nexport default {\n    created() {\n        this.event_bus = new TTEventBus( {\n            component_id: this.component_id\n        } );\n\n        this.event_bus.on( 'timesheet_note', 'close_other_notes', ( event_data ) => {\n            if ( event_data.component_id !== this.component_id ) {\n                this.visible = false;\n            }\n        } );\n    },\n    mounted() {\n        this.setNoneVueEvents();\n    },\n    data() {\n        return {\n            visible: false,\n            note: this.starting_note,\n            label_save: $.i18n._( 'Save' ),\n            label_note: $.i18n._( 'Note' ),\n            show_add_note: false,\n        };\n    },\n    props: {\n        component_id: { /* Note: This is passed in via TTVueUtils.mountComponent param, and auto added to root_props. */\n            type: String,\n            default: null\n        },\n        id: {\n            type: String,\n            default: null\n        },\n        starting_note: {\n            type: String,\n            default: ''\n        },\n        //Cells with no hours do not have ID record attached, we need to link this note to a none existant user_date_total record.\n        field_reference: {\n            type: Object,\n            default: null\n        }\n    },\n    methods: {\n        handleMouseOver() {\n            this.show_add_note = true;\n        },\n        handleMouseLeave() {\n            if ( this.field_reference[0] !== document.activeElement ) {\n                this.show_add_note = false;\n            }\n        },\n        setNoneVueEvents() {\n            //Input element exists outside VueJS component, so we need to add event listeners manually outside VueJS context, otherwise it will only trigger on elements in this component.\n            //These events need to be added back to VueJS @mouseover and @mouseleave when entire TimeSheet is converted to VueJS.\n            let parent_td = this.$refs.note_icon.closest( 'td' );\n            parent_td.addEventListener( 'mouseover', this.handleMouseOver );\n            parent_td.addEventListener( 'mouseleave', this.handleMouseLeave );\n\n            let input = parent_td.querySelector( 'input' );\n            input.addEventListener( 'focus', this.handleMouseOver );\n            input.addEventListener( 'blur', this.handleMouseLeave );\n        },\n        noteIconClicked() {\n            this.visible = true;\n            this.event_bus.emit( 'timesheet_note', 'close_other_notes', {\n                component_id: this.component_id\n            } );\n        },\n        saveNote() {\n            this.event_bus.emit( this.component_id, 'saveNote', {\n                note: this.note\n            } );\n            this.visible = false;\n        }\n    },\n    components: {\n        TextArea,\n        Button\n    }\n};\n</script>\n<style scoped>\n.p-inputtextarea {\n    width: 100%;\n}\n\n.save-button {\n    float: right;\n    margin-top: 10px;\n}\n\n.note-icon {\n    position: absolute;\n    top: -5px;\n    right: calc(50% - 36px);\n    cursor: pointer;\n    border: 2px solid #32689b;\n    background: white;\n    border-radius: 50%;\n    z-index: 10;\n    font-size: 15px !important;\n}\n\n.note-label {\n    text-align: left;\n    margin-bottom: 0.5rem;\n}\n\n.blue-circle-icon {\n    position: absolute;\n    top: 2px;\n    right: calc(50% - 25px);\n    width: 5px;\n    height: 5px;\n    background-color: blue;\n    border-radius: 50%;\n    z-index: 10;\n}\n\n.note-dialog {\n    background-color: var(--surface-ground);\n    border-radius: 6px;\n    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);\n    border: 0 none;\n    margin-top: 30px;\n    padding: 10px;\n    z-index: 100;\n    position: fixed;\n    display: block;\n}\n\n.dialog-close {\n    font-size: 1.75rem;\n    position: absolute;\n    right: -5px;\n    top: -13px;\n    margin: .75rem;\n    cursor: pointer\n}\n</style>\n","import '@/global/widgets/filebrowser/TImage';\nimport TTVueUtils from '@/services/TTVueUtils';\nimport TimeSheetControlBar from '@/components/timesheet/TimeSheetControlBar';\nimport TimeSheetNote from '@/components/timesheet/TimeSheetNote';\nimport { TTUUID } from '@/global/TTUUID';\nimport { Global } from '@/global/Global';\n\nexport class TimeSheetViewController extends BaseViewController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tel: '#timesheet_view_container', //Must set el here and can only set string, so events can work\n\t\t\t// _required_files: {\n\t\t\t// \t10: ['TImage'],\n\t\t\t// \t15: ['leaflet-timetrex']\n\t\t\t// },\n\t\t\tstatus_array: null,\n\t\t\ttype_array: null,\n\t\t\temployee_nav: null,\n\t\t\tstart_date_picker: null,\n\t\t\tfull_timesheet_data: null, //full timesheet data\n\t\t\tfull_format: 'ddd-MMM-DD-YYYY',\n\t\t\tweekly_format: 'ddd, MMM DD',\n\t\t\tday_format: 'ddd',\n\t\t\tdate_format: 'MMM DD',\n\t\t\tstart_date: null,\n\t\t\tend_date: null,\n\t\t\tselect_cells_Array: [], //Timesheet grid\n\t\t\tselect_punches_array: [], //Timesheet grid.\n\t\t\tabsence_select_cells_Array: [], //Absence grid\n\t\t\taccumulated_time_cells_array: [],\n\t\t\tpremium_cells_array: [],\n\t\t\ttimesheet_data_source: null,\n\t\t\taccumulated_time_source: null,\n\t\t\taccumulated_time_grid: null,\n\t\t\taccumulated_time_source_map: null,\n\t\t\tbranch_grid: null,\n\t\t\tbranch_source_map: null,\n\t\t\tbranch_source: null,\n\t\t\tdepartment_grid: null,\n\t\t\tdepartment_source_map: null,\n\t\t\tdepartment_source: null,\n\t\t\tjob_grid: null,\n\t\t\tjob_source_map: null,\n\t\t\tjob_source: null,\n\t\t\tjob_item_grid: null,\n\t\t\tjob_item_source_map: null,\n\t\t\tjob_item_source: null,\n\t\t\tpunch_tag_source_map: null,\n\t\t\tpunch_tag_source: null,\n\t\t\tpremium_grid: null,\n\t\t\tpremium_source_map: null,\n\t\t\tpremium_source: null,\n\t\t\tabsence_grid: null,\n\t\t\tabsence_source: null,\n\t\t\tabsence_original_source: null,\n\t\t\taccumulated_total_grid: null,\n\t\t\taccumulated_total_grid_source_map: null,\n\t\t\taccumulated_total_grid_source: null,\n\t\t\tpunch_note_grid: null,\n\t\t\tpunch_note_grid_source: null,\n\t\t\tverification_grid: null,\n\t\t\tverification_grid_source: null,\n\t\t\tgrid_dic: null,\n\t\t\tpay_period_map: null,\n\t\t\tpay_period_data: null,\n\t\t\ttimesheet_verify_data: null,\n\t\t\tapi_timesheet: null,\n\t\t\tapi_user_date_total: null,\n\t\t\tapi_date: null,\n\t\t\tapi_station: null,\n\t\t\tapi_punch: null,\n\t\t\tabsence_model: false,\n\t\t\tselect_drag_menu_id: '', //Do drag move or copy\n\t\t\tis_mass_adding: false,\n\t\t\tdepartment_cell_count: 0,\n\t\t\tbranch_cell_count: 0,\n\t\t\tpremium_cell_count: 0,\n\t\t\tjob_cell_count: 0,\n\t\t\ttask_cell_count: 0,\n\t\t\tpunch_tag_cell_count: 0,\n\t\t\tabsence_cell_count: 0,\n\t\t\tpunch_note_account: 0,\n\t\t\tshow_navigation_box: true,\n\t\t\tstation: null,\n\t\t\tscroll_position: 0,\n\t\t\tjob_api: null,\n\t\t\tjob_item_api: null,\n\t\t\tuser_group_id: null,\n\t\t\tpunch_tag_api: null,\n\t\t\tuser_api: null,\n\t\t\tdepartment_api: null,\n\t\t\tdefault_punch_tag: [],\n\t\t\tprevious_punch_tag_selection: [],\n\t\t\tapi_absence_policy: null,\n\t\t\tpre_total_time: null,\n\t\t\tabsence_available_balance_dataList: {},\n\t\t\tavailable_balance_info: null,\n\t\t\tshow_job_ui: false,\n\t\t\tshow_job_item_ui: false,\n\t\t\tshow_punch_tag_ui: false,\n\t\t\tshow_branch_ui: false,\n\t\t\tshow_department_ui: false,\n\t\t\tshow_good_quantity_ui: false,\n\t\t\tshow_bad_quantity_ui: false,\n\t\t\tshow_note_ui: false,\n\t\t\tshow_station_ui: false,\n\t\t\tshow_absence_job_ui: false,\n\t\t\tshow_absence_job_item_ui: false,\n\t\t\tshow_absence_punch_tag_ui: false,\n\t\t\tshow_absence_branch_ui: false,\n\t\t\tshow_absence_department_ui: false,\n\t\t\tholiday_data_dic: {},\n\t\t\tgrid_div: null,\n\t\t\tactual_time_label: null,\n\t\t\tcolumn_maps: null,\n\t\t\taccmulated_order_map: {},\n\t\t\turl_args_before_set_date_url: {},\n\t\t\tallow_auto_switch: true,\n\t\t\tvue_control_bar_id: '',\n\t\t\tprevious_absence_policy_id: false,\n\t\t\tevents: {},\n\t\t\t//Issue #3286 - Users without permission to display \"Current View\" dropdown still need to load select layout from user generic data\n\t\t\t//This is to ensure the API attempts to update the current layout and not create a new one causing a validation error.\n\t\t\tforce_get_select_layout: true,\n\t\t\tlocation_mass_edit_check_box: null,\n\t\t\tmanual_note_component_ids: [],\n\t\t\tmarked_regular_row: {},\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinit( options ) {\n\t\t////this._super('initialize', options );\n\t\tthis.permission_id = 'punch';\n\t\tthis.viewId = 'TimeSheet';\n\t\tthis.script_name = 'TimeSheetView';\n\t\tthis.context_menu_name = $.i18n._( 'TimeSheet' );\n\t\tthis.navigation_label = $.i18n._( 'TimeSheet' );\n\t\tthis.api = TTAPI.APIPunch;\n\t\tthis.api_timesheet = TTAPI.APITimeSheet;\n\t\tthis.api_user_date_total = TTAPI.APIUserDateTotal;\n\t\tthis.api_date = TTAPI.APITTDate;\n\t\tthis.api_station = TTAPI.APIStation;\n\t\tthis.api_punch = TTAPI.APIPunch;\n\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\tthis.job_api = TTAPI.APIJob;\n\t\t\tthis.job_item_api = TTAPI.APIJobItem;\n\t\t\tthis.punch_tag_api = TTAPI.APIPunchTag;\n\t\t\tthis.department_api = TTAPI.APIDepartment;\n\t\t}\n\t\tthis.api_absence_policy = TTAPI.APIAbsencePolicy;\n\t\tthis.scroll_position = 0;\n\t\tthis.grid_dic = {};\n\t\tthis.event_bus = new TTEventBus({ view_id: this.viewId });\n\n\t\tthis.initPermission();\n\t\tthis.render();\n\t\tthis.buildContextMenu();\n\t\tthis.initData();\n\t}\n\n\tinitEditView() {\n\t\tTTPromise.resolve( 'TimeSheetViewController', 'addclick' );\n\t\tsuper.initEditView();\n\t}\n\n\tonSubViewRemoved( is_cancel ) {\n\t\tif ( !is_cancel ) {\n\t\t\tthis.search();\n\t\t}\n\n\t\tif ( !this.edit_view ) {\n\t\t\tthis.setDefaultMenu();\n\t\t} else {\n\t\t\tthis.setEditMenu();\n\t\t}\n\t}\n\n\tsetScrollPosition() {\n\t\tif ( this.scroll_position > 0 ) {\n\t\t\tthis.grid_div.scrollTop( this.scroll_position );\n\t\t}\n\t}\n\n\tpunchModeValidate( p_id ) {\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'punch';\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'punch_timesheet' ) &&\n\t\t\tPermissionManager.validate( p_id, 'manual_timesheet' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tgetPunchPermissionType() {\n\t\treturn this.absence_model ? 'absence' : 'punch';\n\t}\n\n\tjobUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'punch';\n\t\t}\n\n\t\tif (Global.getProductEdition() >= 20 && PermissionManager.validate( 'job', 'enabled' ) &&\n\t\t\tPermissionManager.validate( p_id, 'edit_job' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tjobItemUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'punch';\n\t\t}\n\n\t\tif (Global.getProductEdition() >= 20 && PermissionManager.validate( p_id, 'edit_job_item' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tpunchTagUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'punch';\n\t\t}\n\n\t\tif (Global.getProductEdition() >= 20 && PermissionManager.validate( p_id, 'edit_punch_tag' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t//Refresh to clear warnning messages after saving from employee edit view\n\tupdateSelectUserAndRefresh( new_item ) {\n\n\t\tthis.employee_nav.updateSelectItem( new_item );\n\n\t\tthis.search();\n\t}\n\n\tbranchUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'punch';\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'edit_branch' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tdepartmentUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'punch';\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'edit_department' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tgoodQuantityUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'punch';\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'edit_quantity' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tbadQuantityUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'punch';\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'edit_quantity' ) &&\n\t\t\tPermissionManager.validate( p_id, 'edit_bad_quantity' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tlocationUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'punch';\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'edit_location' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tnoteUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'punch';\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'edit_note' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tstationValidate() {\n\t\tif ( PermissionManager.validate( 'station', 'enabled' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t/* jshint ignore:start */\n\n\t//Special permission check for views, need override\n\tinitPermission() {\n\t\tsuper.initPermission();\n\n\t\tif ( !PermissionManager.validate( 'punch', 'view' ) && !PermissionManager.validate( 'punch', 'view_child' ) ) {\n\t\t\tthis.show_navigation_box = false;\n\t\t\tthis.show_search_tab = false;\n\t\t} else {\n\t\t\tthis.show_navigation_box = true;\n\t\t\tthis.show_search_tab = true;\n\t\t}\n\n\t\tif ( this.punchModeValidate() ) {\n\t\t\tthis.show_punch_mode_ui = true;\n\t\t} else {\n\t\t\tthis.show_punch_mode_ui = false;\n\t\t}\n\n\t\tthis.allow_auto_switch && this.show_punch_mode_ui && ( this.is_auto_switch = true );\n\n\t\tif ( this.jobUIValidate() ) {\n\t\t\tthis.show_job_ui = true;\n\t\t} else {\n\t\t\tthis.show_job_ui = false;\n\t\t}\n\n\t\tif ( this.jobItemUIValidate() ) {\n\t\t\tthis.show_job_item_ui = true;\n\t\t} else {\n\t\t\tthis.show_job_item_ui = false;\n\t\t}\n\n\n\t\tif ( this.punchTagUIValidate() ) {\n\t\t\tthis.show_punch_tag_ui = true;\n\t\t} else {\n\t\t\tthis.show_punch_tag_ui = false;\n\t\t}\n\n\t\tif ( this.branchUIValidate() ) {\n\t\t\tthis.show_branch_ui = true;\n\t\t} else {\n\t\t\tthis.show_branch_ui = false;\n\t\t}\n\n\t\tif ( this.departmentUIValidate() ) {\n\t\t\tthis.show_department_ui = true;\n\t\t} else {\n\t\t\tthis.show_department_ui = false;\n\t\t}\n\n\t\tif ( this.goodQuantityUIValidate() ) {\n\t\t\tthis.show_good_quantity_ui = true;\n\t\t} else {\n\t\t\tthis.show_good_quantity_ui = false;\n\t\t}\n\n\t\tif ( this.badQuantityUIValidate() ) {\n\t\t\tthis.show_bad_quantity_ui = true;\n\t\t} else {\n\t\t\tthis.show_bad_quantity_ui = false;\n\t\t}\n\n\t\tif ( this.noteUIValidate() ) {\n\t\t\tthis.show_note_ui = true;\n\t\t} else {\n\t\t\tthis.show_note_ui = false;\n\t\t}\n\n\t\tif ( this.locationUIValidate() ) {\n\t\t\tthis.show_location_ui = true;\n\t\t} else {\n\t\t\tthis.show_location_ui = false;\n\t\t}\n\n\t\tif ( this.stationValidate() ) {\n\t\t\tthis.show_station_ui = true;\n\t\t} else {\n\t\t\tthis.show_station_ui = false;\n\t\t}\n\n\t\tif ( this.jobUIValidate( 'absence' ) ) {\n\t\t\tthis.show_absence_job_ui = true;\n\t\t} else {\n\t\t\tthis.show_absence_job_ui = false;\n\t\t}\n\n\t\tif ( this.jobItemUIValidate( 'absence' ) ) {\n\t\t\tthis.show_absence_job_item_ui = true;\n\t\t} else {\n\t\t\tthis.show_absence_job_item_ui = false;\n\t\t}\n\n\t\tif ( this.punchTagUIValidate( 'absence' ) ) {\n\t\t\tthis.show_absence_punch_tag_ui = true;\n\t\t} else {\n\t\t\tthis.show_absence_punch_tag_ui = false;\n\t\t}\n\n\t\tif ( this.branchUIValidate( 'absence' ) ) {\n\t\t\tthis.show_absence_branch_ui = true;\n\t\t} else {\n\t\t\tthis.show_absence_branch_ui = false;\n\t\t}\n\n\t\tif ( this.departmentUIValidate( 'absence' ) ) {\n\t\t\tthis.show_absence_department_ui = true;\n\t\t} else {\n\t\t\tthis.show_absence_department_ui = false;\n\t\t}\n\t}\n\n\t/* jshint ignore:end */\n\n\townerOrChildPermissionValidate( p_id, permission_name, selected_item ) {\n\t\tvar field;\n\t\tif ( permission_name && permission_name.indexOf( 'child' ) > -1 ) {\n\t\t\tfield = 'is_child';\n\t\t} else {\n\t\t\tfield = 'is_owner';\n\t\t}\n\n\t\tvar user = this.getSelectEmployee( true );\n\n\t\tif ( PermissionManager.validate( p_id, permission_name ) && ( !user || !Global.isSet( user[field] ) || ( user && user[field] ) ) ) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tinitOptions() {\n\t\tvar options = [\n\t\t\t{ option_name: 'type', api: this.api },\n\t\t\t{ option_name: 'status', api: this.api },\n\t\t];\n\n\t\tthis.initDropDownOptions( options);\n\t}\n\tgetCustomContextMenuModel() {\n\t\tvar context_menu_model = {\n\t\t\tgroups: {\n\t\t\t\tdrag_and_drop: {\n\t\t\t\t\tlabel: $.i18n._( 'Drag & Drop' ),\n\t\t\t\t\tid: this.viewId + 'drag_and_drop'\n\t\t\t\t}\n\t\t\t},\n\t\t\texclude: [\n\t\t\t\t'export_excel',\n\t\t\t\t'add',\n\t\t\t\t'copy',\n\t\t\t\t'copy_as_new'\n\t\t\t],\n\t\t\tinclude: [\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'New Punch' ),\n\t\t\t\t\tid: 'add_punch',\n\t\t\t\t\taction_group: 'new',\n\t\t\t\t\tgroup: 'editor',\n\t\t\t\t\tvue_icon: 'tticon tticon-add_black_24dp',\n\t\t\t\t\tshow_on_right_click: true,\n\t\t\t\t\tsort_order: 910\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'New Absence' ),\n\t\t\t\t\tid: 'add_absence',\n\t\t\t\t\taction_group: 'new',\n\t\t\t\t\tgroup: 'editor',\n\t\t\t\t\tvue_icon: 'tticon tticon-add_black_24dp',\n\t\t\t\t\tshow_on_right_click: true,\n\t\t\t\t\tsort_order: 920\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'In/Out' ),\n\t\t\t\t\tid: 'in_out',\n\t\t\t\t\taction_group: 'in_out',\n\t\t\t\t\tgroup: 'editor',\n\t\t\t\t\tvue_icon: 'tticon tticon-timer_black_24dp',\n\t\t\t\t\tshow_on_right_click: true,\n\t\t\t\t\tsort_order: 1050\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Drag & Drop: Move' ),\n\t\t\t\t\tid: 'move',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\taction_group: 'move_copy',\n\t\t\t\t\tmulti_select_group: 1\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Drag & Drop: Copy' ),\n\t\t\t\t\tid: 'drag_copy',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\taction_group: 'move_copy',\n\t\t\t\t\tmulti_select_group: 1\n\t\t\t\t},\n\t\t\t]\n\t\t};\n\n\t\tif ( PermissionManager.validate( 'request', 'add' ) ) {\n\t\t\tcontext_menu_model.include.push( {\n\t\t\t\tlabel: $.i18n._( 'Add Request' ),\n\t\t\t\tid: 'AddRequest',\n\t\t\t\tvue_icon: 'tticon tticon-post_add_black_24dp',\n\t\t\t\tmenu_align: 'right',\n\t\t\t\tpermission_result: true,\n\t\t\t\tpermission: true,\n\t\t\t\tshow_on_right_click: true,\n\t\t\t\tsort_order: 1000\n\t\t\t} );\n\t\t}\n\n\t\tif ( ( Global.getProductEdition() >= 15 ) ) {\n\t\t\tcontext_menu_model.include.push(\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Map' ),\n\t\t\t\t\tid: 'map',\n\t\t\t\t\tmenu_align: 'right',\n\t\t\t\t\tvue_icon: 'tticon tticon-map_black_24dp',\n\t\t\t\t\tshow_on_right_click: true,\n\t\t\t\t\tsort_order: 2000,\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tcontext_menu_model.include.push(\n\t\t\t{\n\t\t\t\tlabel: $.i18n._( 'Print' ),\n\t\t\t\tid: 'print',\n\t\t\t\taction_group_header: true,\n\t\t\t\taction_group: 'print_menu',\n\t\t\t\tsort_order: 7000,\n\t\t\t\tmenu_align: 'right',\n\t\t\t\ttype: 2,\n\t\t\t\tpermission_result: true,\n\t\t\t\tpermission: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: $.i18n._( 'Summary' ),\n\t\t\t\tid: 'print_summary',\n\t\t\t\taction_group: 'print_menu',\n\t\t\t\tsort_order: 7000,\n\t\t\t\tmenu_align: 'right'\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: $.i18n._( 'Detailed' ),\n\t\t\t\tid: 'print_detailed',\n\t\t\t\taction_group: 'print_menu',\n\t\t\t\tsort_order: 7000,\n\t\t\t\tmenu_align: 'right'\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: $.i18n._( 'Jump To' ),\n\t\t\t\tid: 'jump_to_header',\n\t\t\t\tmenu_align: 'right',\n\t\t\t\taction_group: 'jump_to',\n\t\t\t\tsort_order: 8000,\n\t\t\t\taction_group_header: true,\n\t\t\t\tpermission_result: false // to hide it in legacy context menu and avoid errors in legacy parsers.\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: $.i18n._( 'Schedules' ),\n\t\t\t\tid: 'schedule',\n\t\t\t\tmenu_align: 'right',\n\t\t\t\taction_group: 'jump_to',\n\t\t\t\tsort_order: 8000\n\t\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: $.i18n._( 'Pay Stubs' ),\n\t\t\t\tid: 'pay_stub',\n\t\t\t\tmenu_align: 'right',\n\t\t\t\taction_group: 'jump_to',\n\t\t\t\tsort_order: 8000\n\t\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: $.i18n._( 'Edit Employee' ),\n\t\t\t\tid: 'edit_employee',\n\t\t\t\tmenu_align: 'right',\n\t\t\t\taction_group: 'jump_to',\n\t\t\t\tsort_order: 8000\n\t\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: $.i18n._( 'Edit Pay Period' ),\n\t\t\t\tid: 'edit_pay_period',\n\t\t\t\tmenu_align: 'right',\n\t\t\t\taction_group: 'jump_to',\n\t\t\t\tsort_order: 8000\n\t\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: $.i18n._( 'Accumulated Time' ),\n\t\t\t\tid: 'accumulated_time',\n\t\t\t\tmenu_align: 'right',\n\t\t\t\taction_group: 'jump_to',\n\t\t\t\tsort_order: 8000\n\t\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: '', //Empty label. vue_icon is displayed instead of text.\n\t\t\t\tid: 'other_header',\n\t\t\t\tmenu_align: 'right',\n\t\t\t\taction_group: 'other',\n\t\t\t\taction_group_header: true,\n\t\t\t\tvue_icon: 'tticon tticon-more_vert_black_24dp',\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: $.i18n._( 'ReCalculate TimeSheet' ),\n\t\t\t\tid: 're_calculate_timesheet',\n\t\t\t\tmenu_align: 'right',\n\t\t\t\taction_group: 'other',\n\t\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: $.i18n._( 'Generate Pay Stub' ),\n\t\t\t\tid: 'generate_pay_stub',\n\t\t\t\tmenu_align: 'right',\n\t\t\t\taction_group: 'other',\n\t\t\t\t},\n\t\t);\n\n\t\treturn context_menu_model;\n\t}\n\n\tparseCustomContextModelForEditViews( context_menu_model ) {\n\n\t\tcontext_menu_model = super.parseCustomContextModelForEditViews( context_menu_model );\n\n\t\tif( this.determineContextMenuMountAttributes().menu_type === 'editview_contextmenu' ) {\n\t\t\tcontext_menu_model.exclude.push(\n\t\t\t\t'move',\n\t\t\t\t'drag_copy',\n\t\t\t\t're_calculate_timesheet',\n\t\t\t\t'generate_pay_stub',\n\t\t\t\t'print',\n\t\t\t\t'print_detailed',\n\t\t\t\t'print_summary',\n\t\t\t)\n\t\t}\n\n\t\treturn context_menu_model;\n\t}\n\n\topenEditView() {\n\t\t//#2295 - Re-initialize previous_absence_policy_id to ensure that previously saved values are passed correctly into the estimation of projected available balance.\n\t\tthis.previous_absence_policy_id = false;\n\n\t\tGlobal.setUINotready();\n\t\tTTPromise.add( 'init', 'init' );\n\t\tTTPromise.wait();\n\t\tif ( !this.edit_view ) {\n\t\t\tthis.is_edit = true;\n\t\t\tthis.initEditViewUI( 'TimeSheet', 'TimeSheetEditView.html' );\n\t\t}\n\t}\n\n\t/* jshint ignore:start */\n\n\t//set widget disablebility if view mode or edit mode\n\tsetEditViewWidgetsMode() {\n\t\tvar did_clean = false;\n\t\tfor ( var key in this.edit_view_ui_dic ) {\n\t\t\tif ( !this.edit_view_ui_dic.hasOwnProperty( key ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tvar widget = this.edit_view_ui_dic[key];\n\t\t\tvar widgetContainer = this.edit_view_form_item_dic[key];\n\t\t\tvar column = widget.parent().parent().parent();\n\t\t\tif ( !column.hasClass( 'v-box' ) ) {\n\t\t\t\tif ( !did_clean ) {\n\t\t\t\t\tdid_clean = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ( this.absence_model ) {\n\t\t\t\tswitch ( key ) {\n\t\t\t\t\tcase 'punch_date':\n\t\t\t\t\tcase 'punch_time':\n\t\t\t\t\tcase 'status_id':\n\t\t\t\t\tcase 'type_id':\n\t\t\t\t\tcase 'quantity':\n\t\t\t\t\tcase 'station_id':\n\t\t\t\t\tcase 'has_image':\n\t\t\t\t\tcase 'latitude':\n\t\t\t\t\tcase 'split_punch_control':\n\t\t\t\t\t\tthis.detachElement( key );\n\t\t\t\t\t\twidget.css( 'opacity', 0 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'punch_dates':\n\t\t\t\t\t\tif ( this.is_mass_adding ) {\n\t\t\t\t\t\t\tthis.attachElement( key );\n\t\t\t\t\t\t\twidget.css( 'opacity', 1 );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.detachElement( key );\n\t\t\t\t\t\t\twidget.css( 'opacity', 0 );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'date_stamp':\n\t\t\t\t\t\tif ( this.is_mass_adding ) {\n\t\t\t\t\t\t\tthis.detachElement( key );\n\t\t\t\t\t\t\twidget.css( 'opacity', 0 );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.attachElement( key );\n\t\t\t\t\t\t\twidget.css( 'opacity', 1 );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'total_time':\n\t\t\t\t\tcase 'src_object_id':\n\t\t\t\t\tcase 'override':\n\t\t\t\t\t\tthis.attachElement( key );\n\t\t\t\t\t\twidget.css( 'opacity', 1 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'available_balance':\n\t\t\t\t\t\tthis.detachElement( key );\n\t\t\t\t\t\twidget.css( 'opacity', 1 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\twidget.css( 'opacity', 1 );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tswitch ( key ) {\n\t\t\t\t\tcase 'punch_dates':\n\t\t\t\t\t\tif ( this.is_mass_adding ) {\n\t\t\t\t\t\t\tthis.attachElement( key );\n\t\t\t\t\t\t\twidget.css( 'opacity', 1 );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.detachElement( key );\n\t\t\t\t\t\t\twidget.css( 'opacity', 0 );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'punch_date':\n\t\t\t\t\t\tif ( this.is_mass_adding ) {\n\t\t\t\t\t\t\tthis.detachElement( key );\n\t\t\t\t\t\t\twidget.css( 'opacity', 0 );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.attachElement( key );\n\t\t\t\t\t\t\twidget.css( 'opacity', 1 );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'quantity':\n\t\t\t\t\t\tif ( this.show_good_quantity_ui && this.show_bad_quantity_ui ) {\n\t\t\t\t\t\t\tthis.attachElement( key );\n\t\t\t\t\t\t\twidget.css( 'opacity', 1 );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'station':\n\t\t\t\t\t\tthis.attachElement( key );\n\t\t\t\t\t\twidget.css( 'opacity', 1 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'punch_time':\n\t\t\t\t\tcase 'status_id':\n\t\t\t\t\tcase 'type_id':\n\t\t\t\t\tcase 'has_image':\n\t\t\t\t\tcase 'latitude':\n\t\t\t\t\t\tthis.attachElement( key );\n\t\t\t\t\t\twidget.css( 'opacity', 1 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'date_stamp':\n\t\t\t\t\tcase 'total_time':\n\t\t\t\t\tcase 'src_object_id':\n\t\t\t\t\tcase 'override':\n\t\t\t\t\t\tthis.detachElement( key );\n\t\t\t\t\t\twidget.css( 'opacity', 0 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\twidget.css( 'opacity', 1 );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ( this.is_viewing ) {\n\t\t\t\tif ( Global.isSet( widget.setEnabled ) ) {\n\t\t\t\t\twidget.setEnabled( false );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif ( Global.isSet( widget.setEnabled ) ) {\n\t\t\t\t\twidget.setEnabled( true );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tgetCustomFieldReferenceField() {\n\t\treturn 'note';\n\t}\n\n\tsetCustomFields() {\n\t\t//Custom fields are only shown on punch types and not on absence types.\n\t\tif ( this.getPunchPermissionType() === 'punch' ) {\n\t\t\tsuper.setCustomFields();\n\t\t}\n\t}\n\n\tbuildEditViewUI() {\n\t\tsuper.buildEditViewUI();\n\n\t\tvar $this = this;\n\n\t\tvar tab_model = {\n\t\t\t'tab_punch': {\n\t\t\t\t'label': this.absence_model ? $.i18n._( 'Absence' ) : $.i18n._( 'Punch' )\n\t\t\t},\n\t\t\t'tab_audit': true,\n\t\t};\n\t\tthis.setTabModel( tab_model );\n\n\t\tvar form_item_input;\n\t\tvar widgetContainer;\n\n\t\t//Tab 0 start\n\n\t\tvar tab_punch = this.edit_view_tab.find( '#tab_punch' );\n\n\t\tvar tab_punch_column1 = tab_punch.find( '.first-column' );\n\n\t\t//Employee\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\tform_item_input.TText( { field: 'first_last_name' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Employee' ), form_item_input, tab_punch_column1, '' );\n\n\t\t//Time\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TIME_PICKER );\n\t\tform_item_input.TTimePicker( { field: 'punch_time', validation_field: 'time_stamp' } );\n\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\t\tthis.actual_time_label = $( '<span class=\\'widget-right-label\\'></span>' );\n\t\twidgetContainer.append( form_item_input );\n\t\twidgetContainer.append( this.actual_time_label );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Time' ), form_item_input, tab_punch_column1, '', widgetContainer, true );\n\n\t\t//Absence Model\n\t\t//Absence Policy Type\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIAbsencePolicy,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_absences',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'src_object_id',\n\t\t\tvalidation_field: 'absence_policy_id'\n\t\t} );\n\n\t\tform_item_input.customSearchFilter = function( filter ) {\n\t\t\treturn $this.setAbsencePolicyFilter( filter );\n\t\t};\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Absence Policy' ), form_item_input, tab_punch_column1, '', null, true );\n\n\t\t//Available Balance\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\tform_item_input.TText( { field: 'available_balance' } );\n\n\t\twidgetContainer = $( '<div class=\\'widget-h-box available-balance-h-box\\'></div>' );\n\t\tthis.available_balance_info = $( '<span class=\"available-balance-info tticon tticon-info_black_24dp\"></span>' );\n\n\t\twidgetContainer.append( form_item_input );\n\t\twidgetContainer.append( this.available_balance_info );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Available Balance' ), [form_item_input], tab_punch_column1, '', widgetContainer, true );\n\n\t\t//Date\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\t\tform_item_input.TDatePicker( { field: 'punch_date', validation_field: 'date_stamp' } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Date' ), form_item_input, tab_punch_column1, '', null, true );\n\n\t\t//Mass Add Date\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\n\t\tform_item_input.TRangePicker( { field: 'punch_dates', validation_field: 'date_stamp' } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Date' ), form_item_input, tab_punch_column1, '', null, true );\n\n\t\t//Absence Model\n\t\t//Date\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\t\tform_item_input.TDatePicker( { field: 'date_stamp' } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Date' ), form_item_input, tab_punch_column1, '', null, true );\n\n\t\t//Absence Model\n\t\t//Time\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\tform_item_input.TTextInput( { field: 'total_time', mode: 'time_unit' } );\n\n\t\tvar widgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\t\tvar release_balance_button = $( '<input id=\\'release-balance-button\\' class=\\'t-button\\' style=\\'margin-left: 5px\\' type=\\'button\\' value=\\'' + $.i18n._( 'Available Balance' ) + '\\'>' );\n\t\trelease_balance_button.css( 'display', 'none' );\n\n\t\trelease_balance_button.click( function() {\n\t\t\t$this.getAvailableBalance( true );\n\t\t} );\n\n\t\twidgetContainer.append( form_item_input );\n\t\twidgetContainer.append( release_balance_button );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Time' ), form_item_input, tab_punch_column1, '', widgetContainer, true );\n\n\t\t//Punch Type\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\t\tform_item_input.TComboBox( { field: 'type_id' } );\n\t\tform_item_input.setSourceData( $this.type_array );\n\n\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\t\tvar check_box = Global.loadWidgetByName( FormItemType.CHECKBOX );\n\t\tcheck_box.TCheckbox( { field: 'disable_rounding' } );\n\t\tvar label = $( '<span class=\\'widget-right-label\\'>' + $.i18n._( 'Disable Rounding' ) + '</span>' );\n\t\twidgetContainer.append( form_item_input );\n\n\t\t// Check if view only mode. To prevent option appearing but disabled, as disabled checkboxes are not very clear - same in PunchViewController\n\t\tif ( this.is_viewing || PermissionManager.validate( 'punch', 'edit_disable_rounding' ) == false ) {\n\t\t\t// dev-note: not sure if we need to pass widgetContainer here, or if we can omit if its only one element now (due to the if is_viewing).\n\t\t\t// to be safe, will continue to use widgetContainer for this case. We only want to affect viewing mode (hide rounding checkbox), less risk of regression to keep widget container in.\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Punch Type' ), form_item_input, tab_punch_column1, '', widgetContainer, true );\n\t\t} else {\n\t\t\twidgetContainer.append( label );\n\t\t\twidgetContainer.append( check_box );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Punch Type' ), [form_item_input, check_box], tab_punch_column1, '', widgetContainer, true );\n\t\t}\n\n\t\t//In Out (Status)\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\n\t\tform_item_input.TComboBox( { field: 'status_id' } );\n\t\tform_item_input.setSourceData( $this.status_array );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'In/Out' ), form_item_input, tab_punch_column1, '', null, true );\n\n\t\t//Default Branch\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIBranch,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_branch',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'branch_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Branch' ), form_item_input, tab_punch_column1, '', null, true );\n\n\t\tif ( !this.absence_model ) {\n\t\t\tif ( !this.show_branch_ui ) {\n\t\t\t\tthis.detachElement( 'branch_id' );\n\t\t\t}\n\t\t} else {\n\t\t\tif ( !this.show_absence_branch_ui ) {\n\t\t\t\tthis.detachElement( 'branch_id' );\n\t\t\t}\n\t\t}\n\n\t\t//Department\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIDepartment,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_department',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'department_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Department' ), form_item_input, tab_punch_column1, '', null, true );\n\n\t\tif ( !this.absence_model ) {\n\t\t\tif ( !this.show_department_ui ) {\n\t\t\t\tthis.detachElement( 'department_id' );\n\t\t\t}\n\t\t} else {\n\t\t\tif ( !this.show_absence_department_ui ) {\n\t\t\t\tthis.detachElement( 'department_id' );\n\t\t\t}\n\t\t}\n\n\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\n\t\t\t//Job\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIJob,\n\t\t\t\tallow_multiple_selection: false,\n\t\t\t\tlayout_name: 'global_job',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tsetRealValueCallBack: ( function( val ) {\n\n\t\t\t\t\tif ( val ) {\n\t\t\t\t\t\tjob_coder.setValue( val.manual_id );\n\t\t\t\t\t}\n\t\t\t\t} ),\n\t\t\t\tfield: 'job_id'\n\t\t\t} );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\tvar job_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tjob_coder.TTextInput( { field: 'job_quick_search', disable_keyup_event: true } );\n\t\t\tjob_coder.addClass( 'job-coder' );\n\n\t\t\twidgetContainer.append( job_coder );\n\t\t\twidgetContainer.append( form_item_input );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Job' ), [form_item_input, job_coder], tab_punch_column1, '', widgetContainer, true );\n\n\t\t\tif ( !this.absence_model ) {\n\t\t\t\tif ( !this.show_job_ui ) {\n\t\t\t\t\tthis.detachElement( 'job_id' );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif ( !this.show_absence_job_ui ) {\n\t\t\t\t\tthis.detachElement( 'job_id' );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//Job Item\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIJobItem,\n\t\t\t\tallow_multiple_selection: false,\n\t\t\t\tlayout_name: 'global_job_item',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tsetRealValueCallBack: ( function( val ) {\n\n\t\t\t\t\tif ( val ) {\n\t\t\t\t\t\tjob_item_coder.setValue( val.manual_id );\n\t\t\t\t\t}\n\t\t\t\t} ),\n\t\t\t\tfield: 'job_item_id'\n\t\t\t} );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\tvar job_item_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tjob_item_coder.TTextInput( { field: 'job_item_quick_search', disable_keyup_event: true } );\n\t\t\tjob_item_coder.addClass( 'job-coder' );\n\n\t\t\twidgetContainer.append( job_item_coder );\n\t\t\twidgetContainer.append( form_item_input );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Task' ), [form_item_input, job_item_coder], tab_punch_column1, '', widgetContainer, true );\n\n\t\t\tif ( !this.absence_model ) {\n\t\t\t\tif ( !this.show_job_item_ui ) {\n\t\t\t\t\tthis.detachElement( 'job_item_id' );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif ( !this.show_absence_job_item_ui ) {\n\t\t\t\t\tthis.detachElement( 'job_item_id' );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//Punch Tag\n\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIPunchTag,\n\t\t\t\tallow_multiple_selection: true,\n\t\t\t\tlayout_name: 'global_punch_tag',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tget_real_data_on_multi: true,\n\t\t\t\tsetRealValueCallBack: ( ( punch_tags, get_real_data ) => {\n\t\t\t\t\tif ( punch_tags ) {\n\t\t\t\t\t\tthis.setPunchTagQuickSearchManualIds( punch_tags, get_real_data );\n\t\t\t\t\t}\n\t\t\t\t} ),\n\t\t\t\tfield: 'punch_tag_id'\n\t\t\t} );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\tvar punch_tag_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tpunch_tag_coder.TTextInput( { field: 'punch_tag_quick_search', disable_keyup_event: true } );\n\t\t\tpunch_tag_coder.addClass( 'job-coder' );\n\n\t\t\twidgetContainer.append( punch_tag_coder );\n\t\t\twidgetContainer.append( form_item_input );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Tags' ), [form_item_input, punch_tag_coder], tab_punch_column1, '', widgetContainer, true );\n\n\t\t\tif ( !this.absence_model ) {\n\t\t\t\tif ( !this.show_punch_tag_ui ) {\n\t\t\t\t\tthis.detachElement( 'punch_tag_id' );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif ( !this.show_absence_punch_tag_ui ) {\n\t\t\t\t\tthis.detachElement( 'punch_tag_id' );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\n\t\t\t//Quanitity\n\n\t\t\tvar good = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tgood.TTextInput( { field: 'quantity' } );\n\t\t\tgood.addClass( 'quantity-input' );\n\n\t\t\tvar good_label = $( '<span class=\\'widget-right-label\\'>' + $.i18n._( 'Good' ) + ': </span>' );\n\n\t\t\tvar bad = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tbad.TTextInput( { field: 'bad_quantity' } );\n\t\t\tbad.addClass( 'quantity-input' );\n\n\t\t\tvar bad_label = $( '<span class=\\'widget-right-label\\'>/ ' + $.i18n._( 'Bad' ) + ': </span>' );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\twidgetContainer.append( good_label );\n\t\t\twidgetContainer.append( good );\n\t\t\twidgetContainer.append( bad_label );\n\t\t\twidgetContainer.append( bad );\n\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Quantity' ), [good, bad], tab_punch_column1, '', widgetContainer, true );\n\n\t\t\tif ( !this.show_bad_quantity_ui && !this.show_good_quantity_ui ) {\n\t\t\t\tthis.detachElement( 'quantity' );\n\t\t\t} else {\n\t\t\t\tif ( !this.show_bad_quantity_ui ) {\n\t\t\t\t\tbad_label.hide();\n\t\t\t\t\tbad.hide();\n\t\t\t\t}\n\n\t\t\t\tif ( !this.show_good_quantity_ui ) {\n\t\t\t\t\tgood_label.hide();\n\t\t\t\t\tgood.hide();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t//Note\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_AREA );\n\t\tform_item_input.TTextArea( { field: 'note', width: '100%' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Note' ), form_item_input, tab_punch_column1, '', null, true, true );\n\t\tform_item_input.parent().width( '45%' );\n\n\t\tif ( !this.show_note_ui ) {\n\t\t\tthis.detachElement( 'note' );\n\t\t}\n\n\t\t//Absence Mode\n\t\t//Override\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.CHECKBOX );\n\t\tform_item_input.TCheckbox( { field: 'override' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Override' ), form_item_input, tab_punch_column1, '', null, true, true );\n\n\t\t//Location\n\t\tif ( Global.getProductEdition() >= 15 ) {\n\n\t\t\tvar latitude = Global.loadWidgetByName( FormItemType.TEXT );\n\t\t\tlatitude.TText( { field: 'latitude' } );\n\t\t\tvar longitude = Global.loadWidgetByName( FormItemType.TEXT );\n\t\t\tlongitude.TText( { field: 'longitude' } );\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box link-widget-box\\'></div>' );\n\t\t\tvar accuracy = Global.loadWidgetByName( FormItemType.TEXT );\n\t\t\taccuracy.TText( { field: 'position_accuracy' } );\n\t\t\tlabel = $( '<span class=\\'widget-right-label\\'>' + $.i18n._( 'Accuracy' ) + ':</span>' );\n\n\t\t\tvar map_icon = $( '<img class=\"widget-h-box-mapIcon\" src=\"framework/leaflet/images/marker-icon-red.png\" >' );\n\n\t\t\tthis.location_wrapper = $( '<div class=\"widget-h-box-mapLocationWrapper\"></div>' );\n\t\t\twidgetContainer.append( map_icon );\n\t\t\twidgetContainer.append( this.location_wrapper );\n\t\t\tthis.location_wrapper.append( latitude );\n\t\t\tthis.location_wrapper.append( $( '<span>, </span>' ) );\n\t\t\tthis.location_wrapper.append( longitude );\n\t\t\tthis.location_wrapper.append( label );\n\t\t\tthis.location_wrapper.append( accuracy );\n\t\t\tthis.location_wrapper.append( $( '<span>m</span>' ) );\n\n\t\t\tif ( this.is_mass_editing ) {\n\t\t\t\tthis.location_mass_edit_check_box = $( ' <div class=\"mass-edit-checkbox-wrapper\"><input type=\"checkbox\" class=\"mass-edit-checkbox\"></input>' +\n\t\t\t\t\t'<label for=\"checkbox-input-1\" class=\"input-helper input-helper--checkbox\"></label></div>' );\n\n\t\t\t\tthis.location_mass_edit_check_box.insertBefore( $( map_icon ) );\n\t\t\t\tthis.location_mass_edit_check_box.change( () => {\n\t\t\t\t\tthis.trigger( 'formItemChange', [this.edit_view_ui_dic.longitude] );\n\t\t\t\t\tthis.trigger( 'formItemChange' [this.edit_view_ui_dic.latitude] );\n\t\t\t\t\tthis.trigger( 'position_accuracy' [this.edit_view_ui_dic.position_accuracy] );\n\t\t\t\t} );\n\n\t\t\t\t//The location field is actually 3 fields in one, longitude, latitude and accuracy.\n\t\t\t\t//Therefore, in mass edit mode it's the widgetContainer that is marked as changed.\n\n\t\t\t\tlet isChecked = () => this.location_mass_edit_check_box.find( '.mass-edit-checkbox' )[0].checked;\n\t\t\t\tlet getEnabled = () => true;\n\n\t\t\t\t//These 3 widgets inside the widgetContainer represent one field and share the same checkbox and enabled state.\n\t\t\t\tlongitude.isChecked = latitude.isChecked = accuracy.isChecked = isChecked;\n\t\t\t\tlongitude.getEnabled = latitude.getEnabled = accuracy.getEnabled = getEnabled;\n\t\t\t}\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Location' ), [latitude, longitude, accuracy], tab_punch_column1, '', widgetContainer, true );\n\t\t\twidgetContainer.click( ( event ) => {\n\t\t\t\tif ( event.target.className != 'mass-edit-checkbox' ) {\n\t\t\t\t\tthis.onMapClick();\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\t// #2117 - Manual location only supported in edit because we need a punch record to append the data to.\n\t\t\tif ( ( !this.is_edit && !this.is_viewing && !this.is_mass_editing ) || !this.show_location_ui ) {\n\t\t\t\twidgetContainer.parents( '.edit-view-form-item-div' ).hide();\n\t\t\t}\n\t\t}\n\n\t\t//Station\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\tform_item_input.TText( { field: 'station_id' } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Station' ), form_item_input, tab_punch_column1, '', null, true, true );\n\n\t\tform_item_input.click( function() {\n\t\t\tif ( $this.current_edit_record.station_id && $this.show_station_ui ) {\n\t\t\t\tIndexViewController.openEditView( $this, 'Station', $this.current_edit_record.station_id );\n\t\t\t}\n\n\t\t} );\n\n\t\t//Split Punch Control\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.CHECKBOX );\n\t\tform_item_input.TCheckbox( { field: 'split_punch_control' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Split Existing Punches' ), form_item_input, tab_punch_column1, '', null, true, true );\n\t\tif ( this.is_mass_adding == false ) {\n\t\t\tthis.detachElement( 'split_punch_control' );\n\t\t}\n\n\t\t//Punch Image\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.IMAGE );\n\t\tform_item_input.TImage( { field: 'punch_image' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Image' ), form_item_input, tab_punch_column1, '', null, true, true );\n\t}\n\n\t/* jshint ignore:end */\n\n\tonEditStationDone() {\n\t\tthis.setStation();\n\t}\n\n\tsetAbsencePolicyFilter( filter ) {\n\t\tif ( !filter.filter_data ) {\n\t\t\tfilter.filter_data = {};\n\t\t}\n\n\t\tfilter.filter_data.user_id = this.current_edit_record?.user_id;\n\n\t\tif ( filter.filter_columns ) {\n\t\t\tfilter.filter_columns.absence_policy = true;\n\t\t}\n\n\t\treturn filter;\n\t}\n\n\tonSetSearchFilterFinished() {\n\t}\n\n\tonBuildBasicUIFinished() {\n\t}\n\n\tonBuildAdvUIFinished() {\n\t}\n\n\tparserDatesRange( date ) {\n\t\tvar dates = date.split( ' - ' );\n\t\tvar resultArray = [];\n\t\tvar beginDate = Global.strToDate( dates[0] );\n\t\tvar endDate = Global.strToDate( dates[1] );\n\n\t\tvar nextDate = beginDate;\n\n\t\twhile ( nextDate.getTime() < endDate.getTime() ) {\n\t\t\tresultArray.push( nextDate.format() );\n\t\t\tnextDate = new Date( new Date( nextDate.getTime() ).setDate( nextDate.getDate() + 1 ) );\n\t\t}\n\n\t\tresultArray.push( dates[1] );\n\n\t\treturn resultArray;\n\t}\n\n\tvalidate() {\n\t\tvar $this = this;\n\t\tvar record = this.current_edit_record;\n\t\tvar i;\n\t\tif ( this.is_mass_editing ) {\n\t\t\trecord = [];\n\t\t\tvar len = this.mass_edit_record_ids.length;\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\tvar temp_item = Global.clone( this.current_edit_record );\n\t\t\t\ttemp_item.id = this.mass_edit_record_ids[i];\n\t\t\t\trecord.push( temp_item );\n\t\t\t}\n\t\t}\n\n\t\tif ( this.is_mass_adding ) {\n\n\t\t\trecord = [];\n\t\t\tvar dates_array = this.current_edit_record.punch_dates;\n\n\t\t\tif ( dates_array && dates_array.indexOf( ' - ' ) > 0 ) {\n\t\t\t\tdates_array = this.parserDatesRange( dates_array );\n\t\t\t}\n\n\t\t\tfor ( var i = 0; i < dates_array.length; i++ ) {\n\t\t\t\tvar common_record = Global.clone( this.current_edit_record );\n\t\t\t\tdelete common_record.punch_dates;\n\t\t\t\tif ( this.absence_model ) {\n\t\t\t\t\tcommon_record.date_stamp = dates_array[i];\n\t\t\t\t} else {\n\t\t\t\t\tcommon_record.punch_date = dates_array[i];\n\t\t\t\t}\n\n\t\t\t\trecord.push( common_record );\n\t\t\t}\n\t\t}\n\n\t\tif ( !this.absence_model ) {\n\n\t\t\tthis.api['validate' + this.api.key_name]( record, {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t$this.validateResult( result );\n\t\t\t\t}\n\t\t\t} );\n\n\t\t} else {\n\n\t\t\tthis.api_user_date_total['validate' + this.api_user_date_total.key_name]( record, {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t$this.clearErrorTips(); //Always clear error\n\n\t\t\t\t\tif ( result && result.isValid() ) {\n\t\t\t\t\t\t$this.setEditMenu();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$this.setErrorMenu();\n\t\t\t\t\t\t$this.setErrorTips( result );\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t} );\n\n\t\t}\n\t}\n\n\t/* jshint ignore:start */\n\tonFormItemChange( target, doNotValidate ) {\n\t\tvar $this = this;\n\t\tthis.setIsChanged( target );\n\t\tthis.setMassEditingFieldsWhenFormChange( target );\n\t\tvar key = target.getField();\n\t\tvar c_value = target.getValue();\n\t\t// Error: TypeError: this.current_edit_record is null in interface/html5/framework/jquery.min.js?v=9.0.5-20151222-094938 line 2 > eval line 1409\n\t\tif ( !this.current_edit_record ) {\n\t\t\treturn;\n\t\t}\n\t\tthis.current_edit_record[key] = c_value;\n\t\tswitch ( key ) {\n\t\t\tcase 'job_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.edit_view_ui_dic['job_quick_search'].setValue( target.getValue( true ) ? ( target.getValue( true ).manual_id ? target.getValue( true ).manual_id : '' ) : '' );\n\t\t\t\t\tthis.setJobItemValueWhenJobChanged( target.getValue( true ), 'job_item_id', {\n\t\t\t\t\t\tstatus_id: 10,\n\t\t\t\t\t\tjob_id: this.current_edit_record.job_id\n\t\t\t\t\t} );\n\t\t\t\t\tthis.edit_view_ui_dic['job_quick_search'].setCheckBox( true );\n\t\t\t\t\tthis.setPunchTagValuesWhenCriteriaChanged( this.getPunchTagFilterData(), 'punch_tag_id' );\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\tcase 'job_item_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.edit_view_ui_dic['job_item_quick_search'].setValue( target.getValue( true ) ? ( target.getValue( true ).manual_id ? target.getValue( true ).manual_id : '' ) : '' );\n\t\t\t\t\tthis.edit_view_ui_dic['job_item_quick_search'].setCheckBox( true );\n\t\t\t\t\tthis.setPunchTagValuesWhenCriteriaChanged( this.getPunchTagFilterData(), 'punch_tag_id' );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'punch_tag_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tif ( c_value !== TTUUID.zero_id && c_value !== false && c_value.length > 0 ) {\n\t\t\t\t\t\tthis.setPunchTagQuickSearchManualIds( target.getSelectItems() );\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.edit_view_ui_dic['punch_tag_quick_search'].setValue( '' );\n\t\t\t\t\t}\n\t\t\t\t\t$this.previous_punch_tag_selection = c_value;\n\t\t\t\t\t//Reset source data to make sure correct punch tags are always shown.\n\t\t\t\t\tthis.edit_view_ui_dic['punch_tag_id'].setSourceData( null );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'branch_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.setPunchTagValuesWhenCriteriaChanged( this.getPunchTagFilterData(), 'punch_tag_id' );\n\t\t\t\t\tthis.setJobValueWhenCriteriaChanged( 'job_id', {\n\t\t\t\t\t\tstatus_id: 10,\n\t\t\t\t\t\tuser_id: this.current_edit_record.user_id,\n\t\t\t\t\t\tpunch_branch_id: this.current_edit_record.branch_id,\n\t\t\t\t\t\tpunch_department_id: this.current_edit_record.department_id\n\t\t\t\t\t} );\n\t\t\t\t\tthis.setDepartmentValueWhenBranchChanged( target.getValue( true ), 'department_id', {\n\t\t\t\t\t\tbranch_id: this.current_edit_record.branch_id,\n\t\t\t\t\t\tuser_id:   this.current_edit_record.user_id\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'user_id':\n\t\t\tcase 'department_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.setPunchTagValuesWhenCriteriaChanged( this.getPunchTagFilterData(), 'punch_tag_id' );\n\t\t\t\t\tthis.setJobValueWhenCriteriaChanged( 'job_id', {\n\t\t\t\t\t\tstatus_id: 10,\n\t\t\t\t\t\tuser_id: this.current_edit_record.user_id,\n\t\t\t\t\t\tpunch_branch_id: this.current_edit_record.branch_id,\n\t\t\t\t\t\tpunch_department_id: this.current_edit_record.department_id\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'job_quick_search':\n\t\t\tcase 'job_item_quick_search':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.onJobQuickSearch( key, c_value );\n\t\t\t\t\tTTPromise.wait( 'BaseViewController', 'onJobQuickSearch', function() {\n\t\t\t\t\t\t$this.setPunchTagValuesWhenCriteriaChanged( $this.getPunchTagFilterData(), 'punch_tag_id' );\n\t\t\t\t\t} );\n\t\t\t\t\t//Don't validate immediately as onJobQuickSearch is doing async API calls, and it would cause a guaranteed validation failure.\n\t\t\t\t\tdoNotValidate = true;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'punch_tag_quick_search':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.onPunchTagQuickSearch( c_value, this.getPunchTagFilterData(), 'punch_tag_id' );\n\n\t\t\t\t\t//Don't validate immediately as onJobQuickSearch is doing async API calls, and it would cause a guaranteed validation failure.\n\t\t\t\t\tdoNotValidate = true;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'punch_dates':\n\t\t\t\tthis.setEditMenu();\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tif ( this.absence_model ) {\n\t\t\tif ( key === 'total_time' ) {\n\n\t\t\t\tif ( this.current_edit_record ) {\n\t\t\t\t\tthis.current_edit_record[key] = Global.parseTimeUnit( c_value );\n\t\t\t\t\t// parsed_total_time_obj = this.api_date.parseTimeUnit( c_value, { async: false } );\n\t\t\t\t\t// if ( parsed_total_time_obj ) {\n\t\t\t\t\t// \tthis.current_edit_record[key] = parsed_total_time_obj.getResult();\n\t\t\t\t\t// }\n\n\t\t\t\t\t//When handling absences, always remove the start/end time stamps otherwise they may be incorrect and trigger a validation error, as the user doesn't see them anyways.\n\t\t\t\t\t// The API will automatically calculated these on save anyways.\n\t\t\t\t\tthis.current_edit_record['start_time_stamp'] = false;\n\t\t\t\t\tthis.current_edit_record['end_time_stamp'] = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( key !== 'override' && this.edit_view_ui_dic['override'] ) {\n\t\t\t\tthis.edit_view_ui_dic['override'].setValue( true );\n\t\t\t\tthis.current_edit_record['override'] = true;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.current_edit_record[key] = c_value;\n\t\t}\n\n\t\tif ( !doNotValidate ) {\n\t\t\tif ( this.absence_model ) {\n\t\t\t\tif ( key === 'total_time' ||\n\t\t\t\t\tkey === 'date_stamp' ||\n\t\t\t\t\tkey === 'punch_dates' ||\n\t\t\t\t\tkey === 'src_object_id' ) {\n\t\t\t\t\tthis.onAvailableBalanceChange();\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.validate();\n\t\t}\n\t}\n\n\t/* jshint ignore:end */\n\n\tbuildSearchAndLayoutUI() {\n\t\tvar layout_div = this.search_panel.find( 'div #saved_layout_content_div' );\n\n\t\tvar form_item = $( $.fn.SearchPanel.html.form_item );\n\t\tvar form_item_label = form_item.find( '.form-item-label' );\n\t\tvar form_item_input_div = form_item.find( '.form-item-input-div' );\n\n\t\tform_item_label.text( $.i18n._( 'Save Search As' ) );\n\n\t\tthis.save_search_as_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\tthis.save_search_as_input.TTextInput();\n\n\t\tvar save_btn = $( '<button class=\"tt-button p-button p-component small-search-panel-button\" type=\"button\">\\n' +\n\t\t\t'<span class=\"tticon tticon-save_black_24dp\"></span>\\n' +\n\t\t\t'<span class=\"p-button-label\">' + $.i18n._( 'Save' ) + '</span>\\n' +\n\t\t\t'</button>' );\n\n\t\tform_item_input_div.append( this.save_search_as_input );\n\t\tform_item_input_div.append( save_btn );\n\n\t\tvar $this = this;\n\t\tsave_btn.click( function() {\n\t\t\t$this.onSaveNewLayout();\n\t\t} );\n\n\t\t//Previous Saved Layout\n\n\t\tthis.previous_saved_layout_div = $( '<div class=\\'previous-saved-layout-div\\'></div>' );\n\n\t\tform_item_input_div.append( this.previous_saved_layout_div );\n\n\t\tform_item_label = $( '<span style=\\'margin-left: 5px\\' >' + $.i18n._( 'Previous Saved Searches' ) + ':</span>' );\n\t\tthis.previous_saved_layout_div.append( form_item_label );\n\n\t\tthis.previous_saved_layout_selector = $( '<select style=\\'margin-left: 5px\\' class=\\'t-select\\'>' );\n\t\tvar update_btn = $( '<button class=\"tt-button p-button p-component small-search-panel-button\" type=\"button\">\\n' +\n\t\t\t'<span class=\"tticon tticon-save_black_24dp\"></span>\\n' +\n\t\t\t'<span class=\"p-button-label\">' + $.i18n._( 'Update' ) + '</span>\\n' +\n\t\t\t'</button>' );\n\n\t\tvar del_btn = $( '<button class=\"tt-button p-button p-component small-search-panel-button\" type=\"button\">\\n' +\n\t\t\t'<span class=\"tticon tticon-delete_black_24dp\"></span>\\n' +\n\t\t\t'<span class=\"p-button-label\">' + $.i18n._( 'Delete' ) + '</span>\\n' +\n\t\t\t'</button>' );\n\n\t\tupdate_btn.click( function() {\n\t\t\t$this.onUpdateLayout();\n\t\t} );\n\n\t\tdel_btn.click( function() {\n\t\t\t$this.onDeleteLayout();\n\t\t} );\n\n\t\tthis.previous_saved_layout_div.append( this.previous_saved_layout_selector );\n\t\tthis.previous_saved_layout_div.append( update_btn );\n\t\tthis.previous_saved_layout_div.append( del_btn );\n\n\t\tlayout_div.append( form_item );\n\n\t\tthis.previous_saved_layout_div.css( 'display', 'none' );\n\t}\n\n\tcheckTimesheetData() {\n\t\tif ( this.full_timesheet_data === true ) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\trender() {\n\n\t\tvar $this = this;\n\t\tsuper.render();\n\n\t\t// Init Vue control bar\n\t\tthis.vue_control_bar_id = 'vue-timesheet-control-bar';\n\n\t\t// Add callbacks here to inject into Vue, for button/menu interactions from Vue back to TT.\n\t\tvar root_props = {\n\t\t\tonPunchModeChange: function() {\n\t\t\t\t//Prevent invalid mode state from being set\n\t\t\t\tif ( !$this.getPunchMode() && $this.toggle_button ) {\n\t\t\t\t\t$this.toggle_button.setValue( LocalCacheData.getAllURLArgs().mode ? LocalCacheData.getAllURLArgs().mode : 'punch' );\n\t\t\t\t}\n\n\t\t\t\t$this.onWageOrModeChange( 'manual' );\n\t\t\t\t$this.onSearch( true );\n\t\t\t},\n\t\t\tonShowWageClick: function() {\n\t\t\t\t$this.onWageOrModeChange( 'wage' );\n\t\t\t\t$this.onSearch( true );\n\t\t\t},\n\t\t\tonTimezoneClick: function() {\n\t\t\t\t$this.onWageOrModeChange( 'timezone' );\n\t\t\t\t$this.onSearch( true );\n\t\t\t}\n\t\t};\n\n\t\t// Proof of concept. Future work should use TTEventBus instead of vue_return, as passing by reference and direct access like this is a Vue anti-pattern.\n\t\t// Carefully use the return objects in vue_return, as interactions between Vue and legacy should be carefully controlled to avoid spagetti code / vue anti patterns.\n\t\tvar vue_return = TTVueUtils.mountComponent( this.vue_control_bar_id, TimeSheetControlBar, root_props );\n\n\t\tvar date_chooser_div = $( '.time-sheet-view .date-chooser-div' );\n\t\tvar employee_nav_div = $( '.time-sheet-view .employee-nav-div' );\n\n\t\t//Issue #3097 - TypeError: Cannot read properties of undefined (reading 'getPunchMode')\n\t\t//The Vue TimeSheetControlBar may already contain dom elements from previous renders (cached?) and needs to be removed.\n\t\t//The parent div needs all children removed to prevent multiple date pickers from being added.\n\t\tdate_chooser_div.empty();\n\n\t\tif ( !this.show_navigation_box ) {\n\t\t\temployee_nav_div.css( 'display', 'none' );\n\t\t} else {\n\t\t\temployee_nav_div.css( 'display', '' );\n\t\t}\n\n\t\tthis.wage_btn = {\n\t\t\tid: this.vue_control_bar_id, // TODO: Do we need this still?\n\t\t\tshow: function() {},\n\t\t\thide: function() {},\n\t\t\tgetValue: function() {\n\t\t\t\tif ( vue_return && vue_return._vue_component_instance ) {\n\t\t\t\t\treturn vue_return._vue_component_instance.getTimesheetSettingsState( 'show_wages' );\n\t\t\t\t}\n\t\t\t},\n\t\t\tsetValue: function( new_value ) {\n\t\t\t\tif ( vue_return && vue_return._vue_component_instance ) {\n\t\t\t\t\tvue_return._vue_component_instance.setTimesheetSettingsState( 'show_wages', new_value );\n\t\t\t\t}\n\t\t\t},\n\t\t\t// TODO Cant use this as a remove, as it would remove the whole control bar. We only want to hide/remove the toggle buttons for mode.\n\t\t\tremove: function() {\n\t\t\t\t// return TTVueUtils.unmountComponent( this.vue_control_bar_id )\n\t\t\t}\n\t\t};\n\n\t\tthis.timezone_btn = {\n\t\t\tid: this.vue_control_bar_id,\n\t\t\tshow: function() {},\n\t\t\thide: function() {},\n\t\t\tgetValue: function() {\n\t\t\t\tif ( vue_return && vue_return._vue_component_instance ) {\n\t\t\t\t\treturn vue_return._vue_component_instance.getTimesheetSettingsState( 'use_employee_timezone' );\n\t\t\t\t}\n\t\t\t},\n\t\t\tsetValue: function( new_value ) {\n\t\t\t\tif ( vue_return && vue_return._vue_component_instance ) {\n\t\t\t\t\tvue_return._vue_component_instance.setTimesheetSettingsState( 'use_employee_timezone', new_value );\n\t\t\t\t}\n\t\t\t},\n\t\t\t// TODO Cant use this as a remove, as it would remove the whole control bar. We only want to hide/remove the toggle buttons for mode.\n\t\t\tremove: function() {\n\t\t\t\t// return TTVueUtils.unmountComponent( this.vue_control_bar_id )\n\t\t\t}\n\t\t};\n\n\t\t//Create Start Date Picker\n\t\tthis.start_date_picker = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\t\tthis.start_date_picker.TDatePicker( { field: 'start_date' } );\n\t\tvar date_chooser = $( '<span class=\\'label\\'>' + $.i18n._( 'Date' ) + ':</span>' +\n\t\t\t'<img class=\\'left-arrow arrow\\' src=' + Global.getRealImagePath( 'images/left_arrow.svg' ) + '>' +\n\t\t\t'<div class=\\'date-picker-div\\'></div>' +\n\t\t\t'<img class=\\'right-arrow arrow\\' src=' + Global.getRealImagePath( 'images/right_arrow.svg' ) + '>' );\n\n\t\tdate_chooser_div.append( date_chooser );\n\t\tdate_chooser_div.find( '.date-picker-div' ).append( this.start_date_picker );\n\n\t\tvar date_left_arrow = date_chooser_div.find( '.left-arrow' );\n\t\tvar date_right_arrow = date_chooser_div.find( '.right-arrow' );\n\n\t\tdate_left_arrow.bind( 'click', function() {\n\t\t\t//Error: TypeError: $this.timesheet_columns is undefined in /interface/html5/framework/jquery.min.js?v=8.0.0-20141230-125919 line 2 > eval line 1569\n\t\t\tif ( !$this.checkTimesheetData() || !$this.timesheet_columns ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar select_date = Global.strToDate( ( ( $this.getSelectDate() ) ? $this.getSelectDate() : new Date().format() ) );\n\t\t\tvar new_date = new Date( new Date( select_date.getTime() ).setDate( select_date.getDate() - 7 ) ).format();\n\t\t\t$this.first_build = true;\n\t\t\tcontinueChangeDate( new_date );\n\n\t\t\t//see #2224 Cannot read property 'date' of undefined\n\t\t\t$this.setDefaultMenu();\n\t\t} );\n\n\t\tdate_right_arrow.bind( 'click', function() {\n\t\t\t//Error: TypeError: $this.timesheet_columns is undefined in /interface/html5/framework/jquery.min.js?v=8.0.0-20141230-125919 line 2 > eval line 1569\n\t\t\tif ( !$this.checkTimesheetData() || !$this.timesheet_columns ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar select_date = Global.strToDate( ( ( $this.getSelectDate() ) ? $this.getSelectDate() : new Date().format() ) );\n\t\t\tvar new_date = new Date( new Date( select_date.getTime() ).setDate( select_date.getDate() + 7 ) ).format();\n\t\t\t$this.first_build = true;\n\t\t\tcontinueChangeDate( new_date );\n\n\t\t\t//see #2224 Cannot read property 'date' of undefined\n\t\t\t$this.setDefaultMenu();\n\t\t} );\n\n\t\tthis.start_date_picker.bind( 'formItemChange', function() {\n\t\t\tvar select_date = $this.getSelectDate() ? $this.getSelectDate() : new Date().format();\n\t\t\t$this.first_build = true;\n\t\t\tcontinueChangeDate( select_date );\n\t\t} );\n\n\t\tfunction continueChangeDate( new_date ) {\n\t\t\t$this.doNextIfNoValueChangeInManualGrid( doNext, reset );\n\n\t\t\tfunction reset() {\n\t\t\t\t$this.setDatePickerValue( LocalCacheData.last_timesheet_selected_date );\n\t\t\t}\n\n\t\t\tfunction doNext() {\n\t\t\t\t$this.setDatePickerValue( new_date );\n\t\t\t\t$this.search();\n\t\t\t}\n\t\t}\n\n\t\t//Create Employee Navigation\n\n\t\tvar label = employee_nav_div.find( '.navigation-label' );\n\t\tvar left_click = employee_nav_div.find( '.left-click' );\n\t\tvar right_click = employee_nav_div.find( '.right-click' );\n\t\tvar navigation_widget_div = employee_nav_div.find( '.navigation-widget-div' );\n\n\t\t//Issue #3097 - TypeError: Cannot read properties of undefined (reading 'getPunchMode')\n\t\t//The Vue TimeSheetControlBar may already contain dom elements from previous renders (cached?) and needs to be removed.\n\t\t//The parent div needs all children removed to prevent multiple employee selectors from being added to the dom.\n\t\tnavigation_widget_div.empty();\n\n\t\tthis.employee_nav = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\t\tvar default_args = { permission_section: 'punch' };\n\t\tthis.employee_nav = this.employee_nav.AComboBox( {\n\t\t\tid: 'employee_navigation',\n\t\t\tapi_class: TTAPI.APIUser,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_user',\n\t\t\tinit_data_immediately: true,\n\t\t\tdefault_args: default_args,\n\t\t\tshow_search_inputs: true,\n\t\t\talways_include_columns: ['default_branch_id', 'default_department_id', 'default_job_id', 'default_job_item_id', 'default_punch_tag_id'],\n\t\t\twidth: 200,\n\t\t\tis_static_width: true, //Use static width so the left/right navigation arrows don't move around based on the length of the employees name.\n\t\t\tsetRealValueCallBack: ( function( val ) {\n\t\t\t\t$this.userValueSet( val );\n\t\t\t} )\n\t\t} );\n\n\t\tnavigation_widget_div.append( this.employee_nav );\n\t\tnavigation_widget_div.bind( 'onClose', () => {\n\t\t\tthis.setEmployeeNavArrowsStatus();\n\t\t} );\n\t\tthis.employee_nav.bind( 'formItemChange', function() {\n\t\t\t$this.doNextIfNoValueChangeInManualGrid( doNext, reset );\n\t\t\tGlobal.triggerAnalyticsEditViewNavigation( 'navigation', $this.viewId );\n\n\t\t\tfunction doNext() {\n\t\t\t\tvar selected_user_id = $this.getSelectEmployee();\n\t\t\t\tif ( !$this.edit_view ) {\n\t\t\t\t\t$this.reSetURL();\n\t\t\t\t}\n\t\t\t\t$this.allow_auto_switch && ( $this.is_auto_switch = true );\n\t\t\t\t$this.first_build = true;\n\t\t\t\t/* jshint ignore:start */\n\t\t\t\tif ( LocalCacheData.last_timesheet_selected_user != selected_user_id ) {\n\t\t\t\t\t$this.search();\n\t\t\t\t}\n\t\t\t\t/* jshint ignore:end */\n\t\t\t\t$this.absence_model = false;\n\t\t\t\t$this.setDefaultMenu();\n\t\t\t}\n\n\t\t\tfunction reset() {\n\t\t\t\t$this.employee_nav.setValue( LocalCacheData.last_timesheet_selected_user );\n\t\t\t}\n\t\t} );\n\n\t\tthis.employee_nav.bind( 'initSourceComplete', function() {\n\t\t\t$this.setEmployeeNavArrowsStatus();\n\t\t} );\n\n\t\tleft_click.attr( 'src', Global.getRealImagePath( 'images/left_arrow.svg' ) );\n\t\tright_click.attr( 'src', Global.getRealImagePath( 'images/right_arrow.svg' ) );\n\t\tright_click.click( function() {\n\t\t\tif ( right_click.hasClass( 'disabled' ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t$this.doNextIfNoValueChangeInManualGrid( doNext );\n\t\t\tGlobal.triggerAnalyticsEditViewNavigation( 'right-arrow', $this.viewId );\n\n\t\t\tfunction doNext() {\n\t\t\t\tvar selected_index = $this.employee_nav.getSelectIndex();\n\t\t\t\tvar source_data = $this.employee_nav.getSourceData();\n\t\t\t\tvar current_open_page = $this.employee_nav.getCurrentOpenPage();\n\t\t\t\tvar next_select_item;\n\t\t\t\tif ( source_data && selected_index < ( source_data.length - 1 ) ) {\n\t\t\t\t\tnext_select_item = $this.employee_nav.getItemByIndex( ( selected_index + 1 ) );\n\t\t\t\t\t$this.employee_nav.setValue( next_select_item );\n\t\t\t\t\tdoNextDone();\n\t\t\t\t} else if ( source_data && selected_index === source_data.length - 1 ) {\n\t\t\t\t\t//onADropDownSearch() makes async calls, so we need to have a doNextDone() callback to trigger to avoid race conditions.\n\t\t\t\t\t$this.employee_nav.onADropDownSearch( 'unselect_grid', ( current_open_page + 1 ), 'first', doNextDone, false ); //Skip triggering FormItemChange as we call search() ourself below anyways, and doing both can cause race conditions and incorrect data to be displayed.\n\t\t\t\t} else {\n\t\t\t\t\tnext_select_item = $this.employee_nav.getItemByIndex( 0 );\n\t\t\t\t\t$this.employee_nav.setValue( next_select_item );\n\t\t\t\t\tdoNextDone();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction doNextDone() {\n\t\t\t\tif ( !$this.edit_view ) {\n\t\t\t\t\t$this.reSetURL();\n\t\t\t\t}\n\t\t\t\t$this.allow_auto_switch && ( $this.is_auto_switch = true );\n\t\t\t\t$this.first_build = true;\n\t\t\t\t$this.search();\n\t\t\t\t$this.setEmployeeNavArrowsStatus();\n\t\t\t}\n\n\t\t} );\n\n\t\tleft_click.click( function() {\n\t\t\tif ( left_click.hasClass( 'disabled' ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t$this.doNextIfNoValueChangeInManualGrid( doNext );\n\t\t\tGlobal.triggerAnalyticsEditViewNavigation( 'left-arrow', $this.viewId );\n\n\t\t\tfunction doNext() {\n\t\t\t\tvar selected_index = $this.employee_nav.getSelectIndex();\n\t\t\t\t//var source_data = $this.employee_nav.getSourceData();\n\t\t\t\tvar current_open_page = $this.employee_nav.getCurrentOpenPage();\n\t\t\t\tvar next_select_item;\n\t\t\t\tif ( selected_index > 0 ) {\n\t\t\t\t\tnext_select_item = $this.employee_nav.getItemByIndex( ( selected_index - 1 ) );\n\t\t\t\t\t$this.employee_nav.setValue( next_select_item );\n\t\t\t\t\tdoNextDone();\n\t\t\t\t} else if ( current_open_page > 1 ) {\n\t\t\t\t\t//onADropDownSearch() makes async calls, so we need to have a doNextDone() callback to trigger to avoid race conditions.\n\t\t\t\t\t$this.employee_nav.onADropDownSearch( 'unselect_grid', ( current_open_page - 1 ), 'last', doNextDone, false ); //Skip triggering FormItemChange as we call search() ourself below anyways, and doing both can cause race conditions and incorrect data to be displayed.\n\t\t\t\t} else {\n\t\t\t\t\t// Error: TypeError: source_data is null in /interface/html5/framework/jquery.min.js?v=8.0.6-20150417-084000 line 2 > eval line 1691\n\t\t\t\t\tnext_select_item = $this.employee_nav.getItemByIndex( 0 );\n\t\t\t\t\t$this.employee_nav.setValue( next_select_item );\n\t\t\t\t\tdoNextDone();\n\t\t\t\t}\n\n\t\t\t\tfunction doNextDone() {\n\t\t\t\t\tif ( !$this.edit_view ) {\n\t\t\t\t\t\t$this.reSetURL();\n\t\t\t\t\t}\n\t\t\t\t\t$this.allow_auto_switch && ( $this.is_auto_switch = true );\n\t\t\t\t\t$this.first_build = true;\n\t\t\t\t\t$this.search();\n\t\t\t\t\t$this.setEmployeeNavArrowsStatus();\n\t\t\t\t}\n\t\t\t}\n\n\t\t} );\n\n\t\tlabel.text( $.i18n._( 'Employee' ) );\n\n\t\t// Create Vue timesheet mode toggle buttons\n\n\t\tif( this.show_punch_mode_ui ) {\n\t\t\t// Create pseudo element to pose as jQuery object but is actually just an interface for the Vue component.\n\t\t\t// TODO: Once more/view component has been converted to Vue, we want to refactor this toggle button logic to make use of more streamlined Vue data features like two way binding.\n\n\t\t\tthis.toggle_button = {\n\t\t\t\tid: this.vue_control_bar_id,\n\t\t\t\tgetValue: function() {\n\t\t\t\t\tif ( vue_return && vue_return._vue_component_instance ) {\n\t\t\t\t\t\treturn vue_return._vue_component_instance.getPunchMode; // its done as a getter function on the Vue side, so no need for brackets.\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetValue: function( new_value ) {\n\t\t\t\t\tif ( vue_return && vue_return._vue_component_instance ) {\n\t\t\t\t\t\tvue_return._vue_component_instance.setPunchMode( new_value );\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t// TODO Cant use this as a remove, as it would remove the whole control bar. We only want to hide/remove the toggle buttons for mode.\n\t\t\t\tremove: function() {\n\t\t\t\t\treturn TTVueUtils.unmountComponent( this.vue_control_bar_id )\n\t\t\t\t}\n\t\t\t};\n\t\t} else {\n\n\t\t\tlet mode = 'punch';\n\n\t\t\tconst toggle_div = document.querySelector( '.punch-manual' );\n\n\t\t\tif ( toggle_div ) {\n\t\t\t\ttoggle_div.style.display = 'none'; //Hide toggle mode button\n\t\t\t}\n\n\t\t\t//If they have manual permission, show manual mode otherwise punch\n\t\t\tif ( Global.getProductEdition() >= 15 && PermissionManager.validate( this.permission_id, 'manual_timesheet' ) ) {\n\t\t\t\tmode = 'manual';\n\t\t\t}\n\n\t\t\tthis.toggle_button = {\n\t\t\t\tgetValue: () => mode, //Always return the mode the user has permission to view.\n\t\t\t\tsetValue: function( new_value ) {\n\t\t\t\t\t//User without permissions cannot change punch mode.\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t}\n\n\tdoNextIfNoValueChangeInManualGrid( doNext, reset, mode ) {\n\t\t!mode && ( mode = 'manual' );\n\t\tvar $this = this;\n\t\tif ( this.getPunchMode() === mode && this.editor ) {\n\t\t\tvar records = this.editor.getValue();\n\t\t\tif ( records.length > 0 ) {\n\t\t\t\tTAlertManager.showConfirmAlert( Global.modify_alert_message, '', function( flag ) {\n\t\t\t\t\tif ( flag ) {\n\t\t\t\t\t\t$this.wait_auto_save && clearTimeout( $this.wait_auto_save );\n\t\t\t\t\t\tdoNext();\n\t\t\t\t\t} else {\n\t\t\t\t\t\treset && reset();\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\tdoNext();\n\t\t\t}\n\t\t} else {\n\t\t\tdoNext();\n\t\t}\n\t}\n\n\tgetPunchMode() {\n\t\t//Mode toggle does not exist if the user doesn't have access to it.\n\t\tif ( this.toggle_button ) {\n\t\t\treturn this.toggle_button.getValue();\n\t\t} else {\n\t\t\treturn 'punch';\n\t\t}\n\t}\n\n\thandleOverrideUserPreferenceCookie( user_id ) {\n\t\tif ( this.timezone_btn.getValue() == true ) {\n\t\t\tsetCookie( 'OverrideUserPreference', window.btoa( '{ \"user_id\": \"' + user_id + '\"}' ) ); //Base64 encode.\n\t\t} else {\n\t\t\tdeleteCookie( 'OverrideUserPreference' );\n\t\t}\n\t}\n\n\tonWageOrModeChange( id ) {\n\t\tthis.first_build = true;\n\t\tvar $this = this;\n\t\tif ( id === 'wage' ) {\n\t\t\tthis.doNextIfNoValueChangeInManualGrid( doNext, resetWage );\n\t\t} else if ( id === 'timezone' ) {\n\t\t\tthis.handleOverrideUserPreferenceCookie( this.getSelectEmployee() );\n\t\t\tthis.doNextIfNoValueChangeInManualGrid( doNext, resetTimeZone );\n\t\t} else if ( id === 'manual' ) {\n\t\t\tthis.doNextIfNoValueChangeInManualGrid( doNext, resetManual, 'punch' );\n\t\t}\n\n\t\tfunction resetWage() {\n\t\t\t$this.wage_btn.setValue( !$this.wage_btn.getValue( true ) );\n\t\t}\n\n\t\tfunction resetTimeZone() {\n\t\t\t$this.timezone_btn.setValue( !$this.timezone_btn.getValue( true ) );\n\t\t}\n\n\t\tfunction resetManual() {\n\t\t\t$this.toggle_button.setValue( 'manual' );\n\t\t}\n\n\t\tfunction doNext() {\n\t\t\tif ( !$this.edit_view ) {\n\t\t\t\t$this.reSetURL();\n\t\t\t}\n\t\t\t$this.search();\n\t\t\t$this.setDefaultMenu();\n\t\t}\n\t}\n\n\tsetEmployeeNavArrowsStatus() {\n\t\tvar $this = this;\n\t\tvar employee_nav_div = $( this.el ).find( '.employee-nav-div' );\n\t\tvar left_click = employee_nav_div.find( '.left-click' );\n\t\tvar right_click = employee_nav_div.find( '.right-click' );\n\t\tvar selected_index = $this.employee_nav.getSelectIndex();\n\t\tvar source_data = $this.employee_nav.getSourceData();\n\n\t\tright_click.removeClass( 'disabled' );\n\t\tleft_click.removeClass( 'disabled' );\n\n\t\tvar pager_data = $this.employee_nav.getPagerData();\n\t\tvar current_open_page = $this.employee_nav.getCurrentOpenPage();\n\n\t\t//Error: Uncaught TypeError: Cannot read property 'length' of null in /interface/html5/#!m=TimeSheet&date=20150102&user_id=null line 1698\n\t\tif ( !source_data || ( selected_index === source_data.length - 1 && current_open_page === pager_data.last_page_number ) ) {\n\t\t\tright_click.addClass( 'disabled' );\n\t\t}\n\n\t\tif ( !source_data || ( selected_index === 0 && current_open_page === 1 ) ) {\n\t\t\tleft_click.addClass( 'disabled' );\n\t\t}\n\t}\n\n\tonClearSearch() {\n\t\tvar do_update = false;\n\t\tvar default_layout_id;\n\t\tif ( this.search_panel.getLayoutsArray() && this.search_panel.getLayoutsArray().length > 0 ) {\n\t\t\tdefault_layout_id = $( this.previous_saved_layout_selector ).children( 'option:contains(\\'' + BaseViewController.default_layout_name + '\\')' ).attr( 'value' );\n\t\t\tvar layout_name = BaseViewController.default_layout_name;\n\t\t\tthis.clearSearchPanel();\n\t\t\tthis.filter_data = null;\n\t\t\tthis.temp_adv_filter_data = null;\n\t\t\tthis.temp_basic_filter_data = null;\n\t\t\tdo_update = true;\n\n\t\t} else {\n\n\t\t\tthis.clearSearchPanel();\n\t\t\tthis.filter_data = null;\n\t\t\tthis.temp_adv_filter_data = null;\n\t\t\tthis.temp_basic_filter_data = null;\n\n\t\t\t//Error: Uncaught TypeError: Cannot read property 'setSelectGridData' of null in /interface/html5/#!m=TimeSheet&date=20141213&user_id=29715 line 1738\n\t\t\tif ( this.column_selector ) {\n\t\t\t\tthis.column_selector.setSelectGridData( this.default_display_columns );\n\t\t\t}\n\n\t\t\t//Error: Uncaught TypeError: Cannot read property 'setValue' of null in /interface/html5/#!m=TimeSheet&date=20150125&user_id=53288 line 1742\n\t\t\tif ( this.sort_by_selector ) {\n\t\t\t\tthis.sort_by_selector.setValue( null );\n\t\t\t}\n\n\t\t\tthis.onSaveNewLayout( BaseViewController.default_layout_name );\n\t\t\treturn;\n\n\t\t}\n\n\t\tvar filter_data =  Global.convertLayoutFilterToAPIFilter( { data: { filter_data: this.getValidSearchFilter() } } );\n\n\t\tvar args;\n\t\tif ( do_update ) {\n\t\t\targs = {};\n\t\t\targs.id = default_layout_id;\n\t\t\targs.data = {};\n\t\t\targs.data.filter_data = filter_data;\n\n\t\t}\n\n\t\tvar $this = this;\n\t\tthis.user_generic_data_api.setUserGenericData( args, {\n\t\t\tonResult: function( res ) {\n\n\t\t\t\tif ( res && res.isValid() ) {\n\t\t\t\t\t$this.clearViewLayoutCache();\n\t\t\t\t\t$this.need_select_layout_name = layout_name;\n\t\t\t\t\t$this.initLayout();\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tonUpdateLayout() {\n\n\t\tvar selectId = $( this.previous_saved_layout_selector ).children( 'option:selected' ).attr( 'value' );\n\t\tvar layout_name = $( this.previous_saved_layout_selector ).children( 'option:selected' ).text();\n\n\t\tvar filter_data =  Global.convertLayoutFilterToAPIFilter( { data: { filter_data: this.getValidSearchFilter() } } );\n\n\t\tvar args = {};\n\t\targs.id = selectId;\n\t\targs.data = {};\n\t\targs.data.filter_data = filter_data;\n\t\targs.data.mode = this.toggle_button.getValue();\n\t\targs.data.show_wage =  this.wage_btn.getValue();\n\t\targs.data.use_employee_timezone = this.timezone_btn.getValue();\n\n\t\tvar $this = this;\n\t\tthis.user_generic_data_api.setUserGenericData( args, {\n\t\t\tonResult: function( res ) {\n\t\t\t\tif ( res && res.isValid() ) {\n\t\t\t\t\t$this.clearViewLayoutCache();\n\t\t\t\t\t$this.need_select_layout_name = layout_name;\n\t\t\t\t\t$this.initLayout();\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tonSaveNewLayout( default_layout_name ) {\n\t\tvar layout_name;\n\t\tif ( Global.isSet( default_layout_name ) ) {\n\t\t\tlayout_name = default_layout_name;\n\t\t} else {\n\t\t\tlayout_name = this.save_search_as_input.getValue();\n\t\t}\n\n\t\tif ( !layout_name || layout_name.length < 1 ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar filter_data =  Global.convertLayoutFilterToAPIFilter( { data: { filter_data: this.getValidSearchFilter() } } );\n\n\t\tvar args = {};\n\t\targs.script = this.script_name;\n\t\targs.name = layout_name;\n\t\targs.is_default = false;\n\t\targs.data = {};\n\t\targs.data.filter_data = filter_data;\n\t\targs.data.mode = this.toggle_button.getValue();\n\t\targs.data.show_wage =  this.wage_btn.getValue();\n\t\targs.data.use_employee_timezone = this.timezone_btn.getValue();\n\n\t\tvar $this = this;\n\t\tthis.user_generic_data_api.setUserGenericData( args, {\n\t\t\tonResult: function( res ) {\n\n\t\t\t\tif ( res && res.isValid() ) {\n\t\t\t\t\t$this.clearViewLayoutCache();\n\t\t\t\t\t$this.need_select_layout_name = layout_name;\n\t\t\t\t\t$this.initLayout();\n\t\t\t\t} else {\n\t\t\t\t\tTAlertManager.showErrorAlert( res );\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tonSearch( save_only ) {\n\t\tGlobal.setUINotready();\n\t\tTTPromise.add( 'init', 'init' );\n\t\tTTPromise.wait();\n\n\t\tthis.temp_adv_filter_data = null;\n\t\tthis.temp_basic_filter_data = null;\n\n\t\tthis.getSearchPanelFilter();\n\t\tvar default_layout_id;\n\t\tvar layout_name;\n\t\tif ( this.search_panel.getLayoutsArray() && this.search_panel.getLayoutsArray().length > 0 ) {\n\t\t\tdefault_layout_id = $( this.previous_saved_layout_selector ).children( 'option:contains(\\'' + BaseViewController.default_layout_name + '\\')' ).attr( 'value' );\n\t\t\tlayout_name = BaseViewController.default_layout_name;\n\n\t\t\tif ( !default_layout_id ) {\n\t\t\t\tthis.onSaveNewLayout( BaseViewController.default_layout_name );\n\t\t\t\treturn;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.onSaveNewLayout( BaseViewController.default_layout_name );\n\t\t\treturn;\n\t\t}\n\n\t\tvar filter_data =  Global.convertLayoutFilterToAPIFilter( { data: { filter_data: this.getValidSearchFilter() } } );\n\n\t\tvar args = {};\n\t\targs.id = default_layout_id;\n\t\targs.data = {};\n\t\targs.data.filter_data = filter_data;\n\t\targs.data.mode = this.toggle_button.getValue();\n\t\targs.data.show_wage =  this.wage_btn.getValue();\n\t\targs.data.use_employee_timezone = this.timezone_btn.getValue();\n\n\t\tProgressBar.showOverlay();\n\t\tvar $this = this;\n\t\tthis.user_generic_data_api.setUserGenericData( args, {\n\t\t\tonResult: function( res ) {\n\n\t\t\t\tif ( res && res.isValid() ) {\n\t\t\t\t\t$this.clearViewLayoutCache();\n\t\t\t\t\t$this.need_select_layout_name = layout_name;\n\t\t\t\t\tif ( !save_only ) {\n                        $this.initLayout();\n                    }\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tupdateManualGrid() {\n\t\tvar $this = this;\n\t\tvar start_date_string = this.start_date_picker.getValue();\n\t\tvar user_id = this.getSelectEmployee();\n\t\tProgressBar.noProgressForNextCall();\n\n\t\t$this.handleOverrideUserPreferenceCookie( user_id );\n\t\t$this.api_timesheet.getTimeSheetData( user_id, start_date_string, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tProgressBar.removeNanobar();\n\t\t\t\t$this.full_timesheet_data = result.getResult();\n\t\t\t\tif ( $this.full_timesheet_data === true || !$this.full_timesheet_data.hasOwnProperty( 'timesheet_dates' ) ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t$this.full_timesheet_data = $this.mergeJobQueueIntoTimeSheetData( $this.full_timesheet_data );\n\t\t\t\t$this.start_date = Global.strToDate( $this.full_timesheet_data.timesheet_dates.start_display_date );\n\t\t\t\t$this.end_date = Global.strToDate( $this.full_timesheet_data.timesheet_dates.end_display_date );\n\t\t\t\t$this.setDefaultMenu();\n\t\t\t\t$this.initInsideEditorData( true );\n\t\t\t\t$this.accumulated_time_source_map = {};\n\t\t\t\t$this.branch_source_map = {};\n\t\t\t\t$this.department_source_map = {};\n\t\t\t\t$this.job_source_map = {};\n\t\t\t\t$this.job_item_source_map = {};\n\t\t\t\t$this.punch_tag_source_map = {};\n\t\t\t\t$this.premium_source_map = {};\n\t\t\t\t$this.accumulated_total_grid_source_map = {};\n\t\t\t\t$this.accumulated_time_source = [];\n\t\t\t\t$this.branch_source = [];\n\t\t\t\t$this.department_source = [];\n\t\t\t\t$this.job_source = [];\n\t\t\t\t$this.job_item_source = [];\n\t\t\t\t$this.punch_tag_source = [];\n\t\t\t\t$this.premium_source = [];\n\t\t\t\t$this.accumulated_total_grid_source = [];\n\t\t\t\t$this.verification_grid_source = [];\n\t\t\t\t$this.onReloadSubGridResult( result );\n\t\t\t}\n\t\t} );\n\t}\n\n\t// Dev Note: TODO/REFACTOR: search() params here differ from BaseViewController.search() this could cause confusion or issues,\n\t// Currently means any search() calls in baseview using the callback param will not work here in TimeSheet.\n\tsearch( setDefaultMenu, force ) {\n\n\t\tthis.accumulated_time_cells_array = []; //reset array since the select cell is clean\n\t\tthis.premium_cells_array = []; //reset array since the select cell is clean\n\t\tthis.accumulated_time_source_map = {};\n\t\tthis.branch_source_map = {};\n\t\tthis.department_source_map = {};\n\t\tthis.job_source_map = {};\n\t\tthis.job_item_source_map = {};\n\t\tthis.punch_tag_source_map = {};\n\t\tthis.premium_source_map = {};\n\t\tthis.accumulated_total_grid_source_map = {};\n\t\tthis.accumulated_time_source = [];\n\t\tthis.branch_source = [];\n\t\tthis.department_source = [];\n\t\tthis.job_source = [];\n\t\tthis.job_item_source = [];\n\t\tthis.punch_tag_source = [];\n\t\tthis.premium_source = [];\n\t\tthis.absence_source = [];\n\t\tthis.accumulated_total_grid_source = [];\n\t\tthis.punch_note_grid_source = [];\n\t\tthis.verification_grid_source = [];\n\t\tthis.select_cells_Array = [];\n\t\tthis.select_punches_array = [];\n\t\tthis.branch_cell_count = 0;\n\t\tthis.department_cell_count = 0;\n\t\tthis.premium_cell_count = 0;\n\t\tthis.job_cell_count = 0;\n\t\tthis.task_cell_count = 0;\n\t\tthis.punch_tag_cell_count = 0;\n\t\tthis.absence_cell_count = 0;\n\t\tthis.punch_note_account = 0;\n\t\tthis.select_punches_array = [];\n\n\t\tvar $this = this;\n\t\tvar filter_data = Global.convertLayoutFilterToAPIFilter( this.select_layout );\n\t\tvar start_date_string = ( this.start_date_picker ) ? this.start_date_picker.getValue() : '';\n\t\tvar user_id = this.getSelectEmployee();\n\t\tif ( !force ) {\n\t\t\tthis.doNextIfNoValueChangeInManualGrid( doNext, reset );\n\t\t} else {\n\t\t\tdoNext();\n\t\t}\n\n\t\tfunction reset() {\n\t\t\t$( '.button-rotate' ).removeClass( 'button-rotate' );\n\t\t}\n\n\t\tfunction doNext() {\n\t\t\tLocalCacheData.last_timesheet_selected_date = start_date_string;\n\t\t\tLocalCacheData.last_timesheet_selected_user = $this.getSelectEmployee();\n\n\t\t\tif ( LocalCacheData.last_timesheet_selected_user ) {\n\t\t\t\tLocalCacheData.last_timesheet_selected_show_wage = ( $this.wage_btn ) ? $this.wage_btn.getValue( true ) : false;\n\t\t\t\tLocalCacheData.last_timesheet_selected_timezone = ( $this.timezone_btn ) ? $this.timezone_btn.getValue( true ) : false;\n\t\t\t\tif ( $this.toggle_button ) {\n\t\t\t\t\tLocalCacheData.last_timesheet_selected_punch_mode = $this.toggle_button.getValue();\n\t\t\t\t}\n\t\t\t\tvar args = { filter_data: filter_data };\n\t\t\t\tProgressBar.showOverlay();\n\t\t\t\t//Error: TypeError: this.api_timesheet.getTimeSheetData is not a function in /interface/html5/framework/jquery.min.js?v=8.0.0-20141117-155153 line 2 > eval line 1885\n\t\t\t\tif ( !$this.api_timesheet || !$this.api_timesheet || typeof ( $this.api_timesheet.getTimeSheetData ) !== 'function' ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ( user_id ) {\n\t\t\t\t\t$this.handleOverrideUserPreferenceCookie( user_id );\n\t\t\t\t\t$this.api_timesheet.getTimeSheetData( user_id, start_date_string, args, {\n\t\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\t\t$this.full_timesheet_data = result.getResult();\n\t\t\t\t\t\t\tif ( $this.full_timesheet_data === true || !$this.full_timesheet_data.hasOwnProperty( 'timesheet_dates' ) ) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t$this.full_timesheet_data = $this.mergeJobQueueIntoTimeSheetData( $this.full_timesheet_data );\n\t\t\t\t\t\t\t$this.start_date = Global.strToDate( $this.full_timesheet_data.timesheet_dates.start_display_date );\n\t\t\t\t\t\t\t$this.end_date = Global.strToDate( $this.full_timesheet_data.timesheet_dates.end_display_date );\n\n\t\t\t\t\t\t\t$this.buildCalendars();\n\n\t\t\t\t\t\t\tif ( setDefaultMenu ) {\n\t\t\t\t\t\t\t\t$this.setDefaultMenu( true );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t$this.searchDone();\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tbuildVerificationGrid() {\n\t\tvar $this = this;\n\n\t\tvar columns = [];\n\t\tif ( !Global.isSet( this.verification_grid ) ) {\n\t\t\tvar grid = $( this.el ).find( '#verification_grid' );\n\t\t\tgrid.attr( 'id', this.ui_id + '_verification_grid' );  //Grid's id is ScriptName + _grid\n\t\t}\n\t\tvar grid_id = this.ui_id + '_verification_grid';\n\n\t\tvar column = {\n\t\t\tname: 'pay_period',\n\t\t\tindex: 'pay_period',\n\t\t\tlabel: $.i18n._( 'Pay Period' ),\n\t\t\twidth: 100,\n\t\t\tsortable: false,\n\t\t\ttitle: false\n\t\t};\n\t\tcolumns.push( column );\n\n\t\tcolumn = {\n\t\t\tname: 'verification',\n\t\t\tindex: 'verification',\n\t\t\tlabel: $.i18n._( 'Window' ),\n\t\t\twidth: 100,\n\t\t\tsortable: false,\n\t\t\ttitle: false\n\t\t};\n\t\tcolumns.push( column );\n\n\t\tif ( this.verification_grid ) {\n\t\t\tthis.verification_grid.unload();\n\t\t\tthis.verification_grid = null;\n\t\t\tthis.grid_dic.verification_grid = null;\n\t\t}\n\n\t\tthis.verification_grid = this.grid_dic.verification_grid = new TTGrid( grid_id, {\n\t\t\thoverrows: false,\n\t\t\tmultiselectPosition: 'none',\n\t\t\tverticalResize: false,\n\t\t\tonResizeGrid: false,\n\t\t\theight: 0,\n\t\t}, columns );\n\t}\n\n\tbuildPunchNoteGrid() {\n\t\tvar $this = this;\n\n\t\tvar columns = [];\n\t\tif ( !Global.isSet( this.punch_note_grid ) ) {\n\t\t\tvar grid = $( this.el ).find( '#punch_note_grid' );\n\n\t\t\t//Grid's id is ScriptName + _grid\n\t\t\tgrid.attr( 'id', this.ui_id + '_punch_note_grid' );\n\t\t}\n\n\t\t//if only put one column in grid. There is a UI bug\n\t\tvar first_column = {\n\t\t\tname: 'invisible_column',\n\t\t\tindex: 'invisible_column',\n\t\t\tlabel: ' ',\n\t\t\twidth: 1,\n\t\t\tsortable: false,\n\t\t\ttitle: false,\n\t\t\thidden: true\n\t\t};\n\t\tcolumns.push( first_column );\n\n\t\tvar second_column = {\n\t\t\tname: 'note',\n\t\t\tindex: 'note',\n\t\t\tlabel: ' ',\n\t\t\twidth: 100,\n\t\t\tsortable: false,\n\t\t\ttitle: false,\n\t\t\tcellattr: function( index, value ) {\n\t\t\t\treturn 'title=\"' + value + '\"';\n\t\t\t}\n\t\t};\n\t\tcolumns.push( second_column );\n\t\tvar grid_id = this.ui_id + '_punch_note_grid';\n\t\tif ( this.punch_note_grid ) {\n\t\t\tthis.punch_note_grid.unload();\n\t\t\tthis.punch_note_grid = null;\n\t\t\tthis.grid_dic.punch_note_grid = null;\n\t\t}\n\n\t\tthis.punch_note_grid = this.grid_dic.punch_note_grid = new TTGrid( grid_id, {\n\t\t\thoverrows: false,\n\t\t\tmultiselectPosition: 'none',\n\t\t\tverticalResize: false,\n\t\t\theight: 0,\n\t\t\tonResizeGrid: function() {\n\t\t\t\t$this.setPunchNoteGridWidth();\n\t\t\t}\n\t\t}, columns );\n\n\t\tthis.setGridHeaderBar( 'punch_note_grid', 'Punch Notes' );\n\n\t\t// setGridHeaderBar() sets the width to 100vw (and sets grid title), but this causes issue as the grid is not full width of the screen unlike the others. Therefore, overide the default width of 100vw with 100%.\n\t\t// Related to issue #2712, and (via bisect) appears to be caused by 4e92c7ab463d9b3418735c0db302a50efc43e8bf when jquery.jqgrid.extend.js was removed in a JS upgrade fix.\n\t\tvar table = $( this.grid_dic.punch_note_grid.grid ).parents( '.ui-jqgrid-view' ).find( '.ui-jqgrid-hbox table' ); //grab the hbox\n\t\ttable.css( 'width', '100%' );\n\t}\n\n\tgetAccumulatedTotalGridPayperiodHeader() {\n\t\tthis.pay_period_header = $.i18n._( 'No Pay Period' );\n\n\t\tvar pay_period_id = this.timesheet_verify_data.pay_period_id;\n\n\t\tif ( pay_period_id && this.pay_period_data ) {\n\n\t\t\tfor ( var key in this.pay_period_data ) {\n\t\t\t\tvar pay_period = this.pay_period_data[key];\n\t\t\t\tif ( pay_period.id === pay_period_id ) {\n\t\t\t\t\tvar start_date = Global.strToDate( pay_period.start_date ).format();\n\t\t\t\t\tvar end_date = Global.strToDate( pay_period.end_date ).format();\n\t\t\t\t\tthis.pay_period_header = start_date + ' ' + $.i18n._( 'to' ) + ' ' + end_date;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tbuildAccumulatedTotalGrid() {\n\t\tvar $this = this;\n\n\t\tvar columns = [];\n\n\t\tif ( !Global.isSet( this.accumulated_total_grid ) ) {\n\t\t\tvar grid = $( this.el ).find( '#accumulated_total_grid' );\n\n\t\t\tgrid.attr( 'id', this.ui_id + '_accumulated_total_grid' );\t//Grid's id is ScriptName + _grid\n\n\t\t\tgrid = $( this.el ).find( '#' + this.ui_id + '_accumulated_total_grid' );\n\t\t}\n\n\t\tvar width = 500;\n\t\tif ( this.wage_btn.getValue( true ) ) {\n\t\t\twidth = 600;\n\t\t}\n\n\t\tvar punch_column_width = 100;\n\t\tif ( this.wage_btn.getValue( true ) ) {\n\t\t\tpunch_column_width = null;\n\t\t}\n\n\t\tvar punch_in_out_column = {\n\t\t\tname: 'punch_info',\n\t\t\tindex: 'punch_info',\n\t\t\tlabel: ' ',\n\t\t\twidth: punch_column_width,\n\t\t\tsortable: false,\n\t\t\ttitle: false,\n\t\t\tformatter: this.onCellFormat\n\t\t};\n\t\tcolumns.push( punch_in_out_column );\n\n\t\tvar start_date_str = this.start_date.format( Global.getLoginUserDateFormat() );\n\t\tvar end_date_str = this.end_date.format( Global.getLoginUserDateFormat() );\n\n\t\tthis.getAccumulatedTotalGridPayperiodHeader();\n\n\t\tvar column_width = 100;\n\t\tif ( this.wage_btn.getValue( true ) ) {\n\t\t\tcolumn_width = 150;\n\t\t}\n\t\tvar column_1 = {\n\t\t\tname: 'week',\n\t\t\tindex: 'week',\n\t\t\tlabel: start_date_str + ' ' + $.i18n._( 'to' ) + ' ' + end_date_str,\n\t\t\twidth: column_width,\n\t\t\tsortable: false,\n\t\t\ttitle: false,\n\t\t\tformatter: this.onCellFormat\n\t\t};\n\t\tvar column_2 = {\n\t\t\tname: 'pay_period',\n\t\t\tindex: 'pay_period',\n\t\t\tlabel: this.pay_period_header,\n\t\t\twidth: column_width,\n\t\t\tsortable: false,\n\t\t\ttitle: false,\n\t\t\tformatter: this.onCellFormat\n\t\t};\n\n\t\tcolumns.push( column_1 );\n\t\tcolumns.push( column_2 );\n\n\t\tvar grid_id = this.ui_id + '_accumulated_total_grid';\n\t\tif ( Global.isSet( this.accumulated_total_grid ) == true ) {\n\t\t\tthis.accumulated_total_grid.unload();\n\t\t\tthis.accumulated_total_grid = null;\n\t\t\tthis.grid_dic.accumulated_total_grid = null;\n\t\t}\n\n\t\tthis.accumulated_total_grid = this.grid_dic.accumulated_total_grid = new TTGrid( grid_id, {\n\t\t\thoverrows: false,\n\t\t\tmultiselectPosition: 'none',\n\t\t\tverticalResize: false,\n\t\t\tonResizeGrid: false,\n\t\t\twidth: width,\n\t\t\theight: 0,\n\t\t}, columns );\n\n\t\tvar accumulated_total_grid_title = $( this.el ).find( '.accumulated-total-grid-title' );\n\t\taccumulated_total_grid_title.css( 'display', 'block' );\n\t\tthis.setAccumulatedTotalGridPayPeriodHeaders( width );\n\t}\n\n\t//Override and disable as bindTimeSheetGridColumnEvents() is used at a different point instead.\n\tbindGridColumnEvents() {\n\t}\n\n\t//Bind column click event to change sort type and save columns to t_grid_header_array to use to set column style (asc or desc)\n\tbindTimeSheetGridColumnEvents() {\n\t\tvar display_columns = this.grid.getGridParam( 'colModel' );\n\n\t\t//Exception taht display column not existed, not sure when this will happen, but may there will be a second time load if this happen\n\t\tif ( !display_columns ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar len = display_columns.length;\n\n\t\tthis.t_grid_header_array = [];\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar column_info = display_columns[i];\n\t\t\tvar column_header = $( $( this.el ).find( '#gbox_' + this.ui_id + '_grid' ).find( 'div #jqgh_' + this.ui_id + '_grid_' + column_info.name ) );\n\n\t\t\tthis.t_grid_header_array.push( column_header.TGridHeader() );\n\t\t\tcolumn_header.bind( 'click', onColumnHeaderClick );\n\t\t}\n\n\t\tvar $this = this;\n\n\t\tfunction onColumnHeaderClick( e ) {\n\t\t\tvar field = $( this ).attr( 'id' );\n\t\t\tfield = field.substring( 10 + $this.ui_id.length + 1, field.length );\n\n\t\t\tif ( field === 'cb' || field === 'punch_info' ) { //first column, check box column.\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar date = Global.strToDate( field, $this.full_format );\n\n\t\t\tif ( date && date.getYear() > 0 ) {\n\t\t\t\t$this.setDatePickerValue( date.format( Global.getLoginUserDateFormat() ) );\n\t\t\t\t$this.highLightSelectDay();\n\t\t\t\t//reLoadSubGridsSource() calls getTimeSheetTotalData and would cause duplicate API requests.\n\t\t\t\t//The reLoadSubGridsSource call is not needed required here, because it will be called in onCellSelect() which is triggered from the click event below.\n\t\t\t\t// $this.reLoadSubGridsSource();\n\t\t\t\t//select first punch cell when clicking the header row\n\t\t\t\t$( $( '.timesheet-grid tr#1 td' )[$( 'th.highlight-header' ).index()] ).click();\n\t\t\t}\n\n\t\t}\n\t}\n\n\tcheckIsSelectedAbsenceCell( row_id, cell_index ) {\n\t\tfor ( var i = 0, m = this.absence_select_cells_Array.length; i < m; i++ ) {\n\t\t\tvar cell = this.absence_select_cells_Array[i];\n\t\t\tif ( cell.row_id == row_id && cell.cell_index === cell_index ) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tbuildAbsenceGrid() {\n\t\tvar $this = this;\n\n\t\tvar grid_id = 'absence_grid';\n\t\tvar title = $.i18n._( 'Absence' );\n\n\t\tif ( this[grid_id] ) {\n\t\t\tthis[grid_id].unload();\n\t\t\tthis[grid_id] = null;\n\t\t\tthis.grid_dic[grid_id] = null;\n\t\t} else {\n\t\t\tvar grid = $( this.el ).find( '#absence_grid' );\n\n\t\t\tgrid.attr( 'id', this.ui_id + '_absence_grid' );  //Grid's id is ScriptName + _grid\n\n\t\t\tgrid = $( this.el ).find( '#' + this.ui_id + '_absence_grid' );\n\t\t}\n\n\t\tthis[grid_id] = this.grid_dic[grid_id] = new TTGrid( this.ui_id + '_absence_grid', {\n\t\t\tsortable: false,\n\t\t\thoverrows: false,\n\t\t\theight: 0, //Start the grid height at 0 instead of parent height to avoid transient scrollbars from causing the width to be inconsistent across tables.\n\t\t\tondblClickRow: function() {\n\t\t\t\t$this.onGridDblClickRow( 'absence' );\n\t\t\t},\n\t\t\tonRightClickRow: function( row_id, iRow, cell_index, e ) {\n\t\t\t\tif ( !$this.checkIsSelectedAbsenceCell( row_id, cell_index ) ) {\n\t\t\t\t\tvar cell_val = $( e.target ).closest( 'td,th' ).html();\n\t\t\t\t\t$this.onCellSelect( 'absence_grid', row_id, cell_index, cell_val, this, e );\n\t\t\t\t\t$this.onSelectRow( 'absence_grid', row_id, this );\n\n\t\t\t\t\tif ( $( '.edit-view:visible' ).length == 0 ) {\n\t\t\t\t\t\t$this.setDefaultMenu();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$this.setEditMenu();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tonCellSelect: function( row_id, cell_index, cell_val, e ) {\n\t\t\t\tif ( $( '.edit-view:visible' ).length == 0 ) {\n\t\t\t\t\t$this.setDefaultMenu();\n\t\t\t\t} else {\n\t\t\t\t\t$this.setEditMenu();\n\t\t\t\t}\n\t\t\t},\n\t\t\tonResizeGrid: function() {\n\t\t\t\tif ( $this.absence_grid && $this.absence_grid.getGridWidth() != $this.getTimeSheetWidth() ) {\n\t\t\t\t\t$this.absence_grid.setGridWidth( $this.getTimeSheetWidth() );\n\t\t\t\t}\n\t\t\t},\n\t\t\tbeforeSelectRow: function( row_id, e ) {\n\t\t\t\te.preventDefault();\n\n\t\t\t\tvar cell_index = 0;\n\t\t\t\tif ( $( e.target ).attr( 'role' ) == 'gridcell' ) {\n\t\t\t\t\tcell_index = $( e.target ).index();\n\t\t\t\t} else {\n\t\t\t\t\tcell_index = $( e.target ).parents( 'td' ).index();\n\t\t\t\t}\n\n\t\t\t\tvar cell_val = $( e.target ).text();\n\n\t\t\t\t$this.onCellSelect( 'absence_grid', row_id, cell_index, cell_val, this, e );\n\t\t\t\t$this.onSelectRow( 'absence_grid', row_id, this );\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tmultiselectPosition: 'none',\n\t\t\twinMultiSelect: false,\n\t\t\tverticalResize: false\n\n\t\t}, this.timesheet_columns, $.i18n._( 'Absence' ) );\n\n\t\tthis.bindTimeSheetGridColumnEvents();\n\t\tthis.setGridHeaderBar( grid_id, title );\n\n\t\tif ( this.grid_dic[grid_id] && this.grid_dic[grid_id].grid ) {\n\t\t\tthis.grid_dic.absence_grid.grid.setGridWidth( this.getTimeSheetWidth() );\n\t\t}\n\t}\n\n\tcheckIsSelectedPunchCell( row_id, cell_index ) {\n\t\tfor ( var i = 0, m = this.select_cells_Array.length; i < m; i++ ) {\n\t\t\tvar cell = this.select_cells_Array[i];\n\t\t\tif ( cell.row_id == row_id && cell.cell_index == cell_index ) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Paired secondary row coloring for timesheet\n\t */\n\tcolorTimeSheetRows() {\n\t\tvar $trs = $( '.timesheet-grid-div .timesheet-grid tr' );\n\t\tvar skips = 0;\n\t\tvar colored = 0;\n\t\tfor ( var i = 1; i < $trs.length - 1; i++ ) {\n\t\t\tif ( skips == 2 && colored < 2 ) {\n\t\t\t\t$( $trs[i] ).addClass( 'ui-priority-secondary' );\n\t\t\t\tcolored++;\n\t\t\t} else if ( colored == 2 ) {\n\t\t\t\tskips = 1; //Resets to 1 because we're skipping this iteration.\n\t\t\t\tcolored = 0;\n\t\t\t} else {\n\t\t\t\tskips++;\n\t\t\t}\n\t\t}\n\t}\n\n\tbuildTimeSheetGrid() {\n\t\tvar grid_id = this.ui_id + '_grid';\n\t\tvar $this = this;\n\n\t\tif ( this.timesheet_grid && !this.first_build ) {\n\t\t\t$.jgrid.guid = 1;\n\t\t} else {\n\t\t\tif ( this.timesheet_grid ) {\n\t\t\t\tthis.timesheet_grid.unload();\n\t\t\t\tthis.timesheet_grid = null;\n\t\t\t\t$.jgrid.guid = 1;\n\t\t\t}\n\t\t\tvar grid = $( this.el ).find( '#timesheet_grid' );\n\t\t\tgrid.attr( 'id', grid_id );\t//Grid's id is ScriptName + _grid\n\n\t\t\tvar grid_setup_data = {\n\t\t\t\tcontainer_selector: '.context-border',\n\t\t\t\taltRows: false,\n\t\t\t\tsortable: false,\n\t\t\t\thoverrows: false,\n\t\t\t\theight: 0, //Start the grid height at 0 instead of parent height to avoid transient scrollbars from causing the width to be inconsistent across tables.\n\t\t\t\tondblClickRow: function( row_id, row_index, cell_index, e ) {\n\t\t\t\t\tvar row = $this.getRowData( 'timesheet_grid', row_id );\n\n\t\t\t\t\t//Make sure double click event doesn't get triggered on a request row (authorized/pending/declined)\n\t\t\t\t\t// as we are already in the process of navigating to that view, so it causes edit view and navigation operations to occur at the same time.\n\t\t\t\t\tif ( row.type !== TimeSheetViewController.REQUEST_ROW ) {\n\t\t\t\t\t\t$this.onGridDblClickRow();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonRightClickRow: function( row_id, iRow, cell_index, e ) {\n\t\t\t\t\tif ( !$this.checkIsSelectedPunchCell( row_id, cell_index ) ) {\n\t\t\t\t\t\tvar cell_val = $( e.target ).closest( 'td,th' ).html();\n\t\t\t\t\t\t$this.onCellSelect( 'timesheet_grid', row_id, cell_index, cell_val, this, e );\n\t\t\t\t\t\t$this.onSelectRow( 'timesheet_grid', row_id, this );\n\n\t\t\t\t\t\tif ( $( '.edit-view:visible' ).length == 0 ) {\n\t\t\t\t\t\t\t$this.setDefaultMenu();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$this.setEditMenu();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonCellSelect: function( row_id, cell_index, cell_val, e ) {\n\t\t\t\t\tif ( $( '.edit-view:visible' ).length == 0 ) {\n\t\t\t\t\t\t$this.setDefaultMenu();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$this.setEditMenu();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonResizeGrid: function() {\n\t\t\t\t\tif ( $this.getPunchMode() === 'manual' ) {\n\t\t\t\t\t\tif ( $this.editor ) {\n\t\t\t\t\t\t\t$this.setManualTimeSheetGridSize();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t$this.setGridSize();\n\t\t\t\t\t$this.setTimeSheetGridPayPeriodHeaders();\n\t\t\t\t\t$this.setTimeSheetGridHolidayHeaders();\n\t\t\t\t},\n\t\t\t\tgridComplete: function() {\n\t\t\t\t\t$this.colorTimeSheetRows();\n\t\t\t\t},\n\t\t\t\tbeforeSelectRow: function( row_id, e ) {\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\tvar cell_index = 0;\n\t\t\t\t\tif ( $( e.target ).attr( 'role' ) == 'gridcell' ) {\n\t\t\t\t\t\tcell_index = $( e.target ).index();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcell_index = $( e.target ).parents( 'td' ).index();\n\t\t\t\t\t}\n\n\t\t\t\t\tvar cell_val = $( e.target ).text();\n\n\t\t\t\t\t$this.onCellSelect( 'timesheet_grid', row_id, cell_index, cell_val, this, e );\n\t\t\t\t\t$this.onSelectRow( 'timesheet_grid', row_id, this );\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tmultiselectPosition: 'none',\n\t\t\t\twinMultiSelect: false,\n\t\t\t\tverticalResize: false\n\t\t\t};\n\n\t\t\tthis.timesheet_grid = this.grid_dic.timesheet_grid = this.grid = new TTGrid( grid_id, grid_setup_data, this.timesheet_columns );\n\t\t\tthis.grid_dic.timesheet_grid.grid.setGridWidth( this.getTimeSheetWidth() );\n\t\t}\n\n\t\tthis.grid_div.scroll( function( e ) {\n\t\t\t$this.scroll_position = $this.grid_div.scrollTop();\n\t\t} );\n\t}\n\n\tonGridDblClickRow( name ) {\n\t\tvar context_menu_array = ContextMenuManager.getMenuModelByMenuId( this.determineContextMenuMountAttributes().id );\n\t\tvar len = context_menu_array.length;\n\t\tvar need_break = false;\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tif ( need_break ) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tlet id = context_menu_array[i].id;\n\t\t\tswitch ( id ) {\n\t\t\t\tcase 'edit':\n\t\t\t\t\tif ( !context_menu_array[i].disabled && context_menu_array[i].visible ) {\n\t\t\t\t\t\tProgressBar.showOverlay();\n\t\t\t\t\t\tthis.onEditClick();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tif ( need_break ) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tlet id = context_menu_array[i].id;\n\t\t\tswitch ( id ) {\n\t\t\t\tcase 'view':\n\t\t\t\t\tneed_break = true;\n\t\t\t\t\tif ( !context_menu_array[i].disabled && context_menu_array[i].visible ) {\n\t\t\t\t\t\tProgressBar.showOverlay();\n\t\t\t\t\t\tthis.onViewClick();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tlet id = context_menu_array[i].id;\n\t\t\tswitch ( id ) {\n\t\t\t\tcase 'add_absence':\n\t\t\t\tcase 'add':\n\t\t\t\tcase 'add_punch':\n\t\t\t\t\t// There are 2 add icons, one for punch and one for absence.\n\t\t\t\t\t// We must ensure to check the right one to provide permissions for the add click or absence will be allowed based on the punch permissions\n\t\t\t\t\tif ( name == 'absence' && id != 'add_absence' ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( !context_menu_array[i].disabled && context_menu_array[i].visible ) {\n\t\t\t\t\t\tif ( this.isPunchCells() ) {\n\t\t\t\t\t\t\tProgressBar.showOverlay();\n\t\t\t\t\t\t\tthis.onAddClick();\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif ( !this.addPermissionValidate( 'punch' ) ) {\n\t\t\t//Regular employees open In/Out view when clicking a timesheet cell.\n\t\t\tMenuManager.openSelectView( 'InOut' );\n\t\t\treturn;\n\t\t}\n\t}\n\n\tisPunchCells() {\n\t\tvar result = false;\n\t\tvar cell = this.select_cells_Array && this.select_cells_Array.length > 0 && this.select_cells_Array[0];\n\t\tvar row = cell && this.timesheet_data_source[parseInt( cell.row_id ) - 1];\n\t\tif ( row && row.type === TimeSheetViewController.PUNCH_ROW ) {\n\t\t\tresult = true;\n\t\t} else if ( this.absence_select_cells_Array && this.absence_select_cells_Array.length > 0 ) {\n\t\t\tresult = true;\n\t\t}\n\t\treturn result;\n\t}\n\n\tbuildAccumulatedGrid() {\n\t\tvar $this = this;\n\n\t\tvar grid_id = 'accumulated_time_grid';\n\t\tvar title = $.i18n._( 'Accumulated Time' );\n\n\t\tif ( this[grid_id] ) {\n\t\t\t//Commenting out the next line replicates TypeError: Failed to execute 'replaceChild' on 'Node': parameter 2 is not of type 'Node'. when using Date left arrow on timesheet.\n\t\t\t//  Also happens when clicking the top-right in-app refresh button too.\n\t\t\tthis[grid_id].unload();\n\t\t\tthis[grid_id] = null;\n\t\t\tthis.grid_dic[grid_id] = null;\n\t\t}\n\n\t\tthis[grid_id] = this.grid_dic[grid_id] = new TTGrid( 'accumulated_time_grid', {\n\t\t\tsortable: false,\n\t\t\thoverrows: false,\n\t\t\theight: 0, //Start the grid height at 0 instead of parent height to avoid transient scrollbars from causing the width to be inconsistent across tables.\n\t\t\tondblClickRow: function() {\n\t\t\t\t$this.onAccumulatedTimeClick();\n\t\t\t},\n\t\t\tonRightClickRow: function( row_id, iRow, cell_index, e ) {\n\t\t\t\tvar cell_val = $( e.target ).closest( 'td,th' ).html();\n\t\t\t\t$this.onCellSelect( 'accumulated_grid', row_id, cell_index, cell_val, this, e );\n\t\t\t\t$this.onSelectRow( 'accumulated_grid', row_id, this );\n\t\t\t},\n\t\t\tonCellSelect: function( row_id, cell_index, cell_val, e ) {\n\t\t\t\t$this.setDefaultMenu();\n\t\t\t},\n\t\t\tonResizeGrid: function() {\n\t\t\t\tif ( $this.grid_dic['accumulated_time_grid'] ) {\n\t\t\t\t\t$this.grid_dic['accumulated_time_grid'].grid.setGridWidth( $this.getTimeSheetWidth() );\n\t\t\t\t}\n\t\t\t},\n\t\t\tbeforeSelectRow: function( row_id, e ) {\n\t\t\t\te.preventDefault();\n\n\t\t\t\tvar cell_index = 0;\n\t\t\t\tif ( $( e.target ).attr( 'role' ) == 'gridcell' ) {\n\t\t\t\t\tcell_index = $( e.target ).index();\n\t\t\t\t} else {\n\t\t\t\t\tcell_index = $( e.target ).parents( 'td' ).index();\n\t\t\t\t}\n\n\t\t\t\tvar cell_val = $( e.target ).text();\n\n\t\t\t\t$this.onCellSelect( 'accumulated_grid', row_id, cell_index, cell_val, this, e );\n\t\t\t\t$this.onSelectRow( 'accumulated_grid', row_id, this );\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tmultiselectPosition: 'none',\n\t\t\twinMultiSelect: false,\n\t\t\tverticalResize: false\n\n\t\t}, this.timesheet_columns );\n\n\t\tthis.setGridHeaderBar( grid_id, title );\n\n\t\tif ( this.grid_dic[grid_id] && this.grid_dic[grid_id].grid ) {\n\t\t\tthis.grid_dic[grid_id].grid.setGridWidth( this.getTimeSheetWidth() );\n\t\t}\n\t}\n\n\tbuildSubGrid( grid_id, title ) {\n\t\tvar $this = this;\n\n\t\tvar html_grid_id = this.ui_id + '_' + grid_id;\n\t\tif ( !Global.isSet( this[grid_id] ) ) {\n\t\t\tvar grid = $( this.el ).find( '#' + grid_id );\n\t\t\tgrid.attr( 'id', html_grid_id );\t//Grid's id is ScriptName + _grid\n\t\t}\n\n\t\tif ( this[grid_id] ) {\n\t\t\tthis[grid_id].unload();\n\t\t\tthis[grid_id] = null;\n\t\t\tthis.grid_dic[grid_id] = null;\n\t\t}\n\n\t\tif ( grid_id === 'premium_grid' ) {\n\t\t\tthis[grid_id] = this.grid_dic[grid_id] = new TTGrid( html_grid_id, {\n\t\t\t\thoverrows: false,\n\t\t\t\tmultiselectPosition: 'none',\n\t\t\t\twinMultiSelect: false,\n\t\t\t\theight: 0, //Start the grid height at 0 instead of parent height to avoid transient scrollbars from causing the width to be inconsistent across tables.\n\t\t\t\tonSelectRow: function( row_id, flag, e ) {\n\t\t\t\t\t$this.onSelectRow( 'premium_grid', row_id, this );\n\t\t\t\t},\n\t\t\t\tonRightClickRow: function( row_id, iRow, cell_index, e ) {\n\t\t\t\t\tvar cell_val = $( e.target ).closest( 'td,th' ).html();\n\t\t\t\t\t$this.onCellSelect( 'premium_grid', row_id, cell_index, cell_val, this, e );\n\t\t\t\t\t$this.onSelectRow( 'premium_grid', row_id, this );\n\t\t\t\t},\n\t\t\t\tonCellSelect: function( row_id, cell_index, cell_val, e ) {\n\t\t\t\t\t$this.unsetSelectedCells( 'timesheet_grid' );\n\t\t\t\t\t$this.unsetSelectedCells( 'absence_grid' );\n\t\t\t\t\t$this.onCellSelect( 'premium_grid', row_id, cell_index, cell_val, this, e );\n\t\t\t\t\t$this.select_punches_array = [];\n\t\t\t\t\t$this.setDefaultMenu();\n\t\t\t\t},\n\t\t\t\tondblClickRow: function() {\n\t\t\t\t\tif ( grid_id === 'premium_grid' ) {\n\t\t\t\t\t\t$this.onAccumulatedTimeClick();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonResizeGrid: function() {\n\t\t\t\t\tif ( $this.grid_dic[grid_id] ) {\n\t\t\t\t\t\t$this.grid_dic[grid_id].grid.setGridWidth( $this.getTimeSheetWidth() );\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tverticalResize: false\n\t\t\t}, this.timesheet_columns );\n\n\t\t\t//subgrids might not be rendered, so we need to check for them in the grid_dic first.\n\t\t\tif ( this[grid_id] && this[grid_id].grid ) {\n\t\t\t\tthis[grid_id].grid.addClass( 'premium-grid' );\n\t\t\t}\n\t\t} else {\n\t\t\tthis[grid_id] = this.grid_dic[grid_id] = new TTGrid( html_grid_id, {\n\t\t\t\thoverrows: false,\n\t\t\t\tmultiselectPosition: 'none',\n\t\t\t\twinMultiSelect: false,\n\t\t\t\theight: 0, //Start the grid height at 0 instead of parent height to avoid transient scrollbars from causing the width to be inconsistent across tables.\n\t\t\t\tonCellSelect: function( row_id, cell_index, cell_val, e ) {\n\t\t\t\t\t$this.unsetSelectedCells( 'timesheet_grid' );\n\t\t\t\t\t$this.unsetSelectedCells( 'absence_grid' );\n\n\t\t\t\t\t$this.onCellSelect( grid_id, row_id, cell_index, cell_val, this, e );\n\t\t\t\t\t$this.select_punches_array = [];\n\t\t\t\t\t$this.setDefaultMenu();\n\t\t\t\t},\n\t\t\t\tonResizeGrid: function() {\n\t\t\t\t\tif ( $this.grid_dic[grid_id] ) {\n\t\t\t\t\t\t$this.grid_dic[grid_id].grid.setGridWidth( $this.getTimeSheetWidth() );\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tverticalResize: false\n\t\t\t}, this.timesheet_columns );\n\t\t}\n\n\t\tthis.setGridHeaderBar( grid_id, title );\n\n\t\t//this loop hits all possible grids. subgrids might not be rendered, so we need to check for them in the grid_dic first.\n\t\tif ( this.grid_dic[grid_id] && this.grid_dic[grid_id].grid ) {\n\t\t\tthis.grid_dic[grid_id].grid.setGridWidth( this.getTimeSheetWidth() );\n\t\t}\n\t}\n\n\tsetGridSExpendOrCollapseStatus( grid_id, title ) {\n\t\tif ( this.grid_dic[grid_id] ) {\n\t\t\tvar grid = this.grid_dic[grid_id].grid;\n\t\t\tvar table = $( $( this.el ).find( 'table[aria-labelledby=gbox_' + this.ui_id + '_' + grid_id + ']' )[0] );\n\t\t\tvar title_bar = table.find( '.title-bar' );\n\t\t\tthis.setGridHeight( grid_id );\n\n\t\t\tif ( LocalCacheData.timesheet_sub_grid_expended_dic[grid_id] !== true ) {\n\t\t\t\tgrid.setGridHeight( 0 );\n\t\t\t}\n\n\t\t\tthis.updateGridHeaderBar( grid_id, title );\n\t\t}\n\t}\n\n\t//Show expend and collapse button in grid title bar\n\tsetGridExpendButton( grid_id, title ) {\n\t\tvar $this = this;\n\t\tvar table = $( $( this.el ).find( 'table[aria-labelledby=gbox_' + this.ui_id + '_' + grid_id + ']' )[0] );\n\t\tvar title_bar = table.find( '.title-bar' );\n\n\t\tif ( title_bar.find( '.grid-expend-btn' ).length === 0 ) { //prevent doubling up of expand arrows.\n\t\t\tvar img = $( '<img>' );\n\t\t\timg.addClass( 'grid-expend-btn' );\n\n\t\t\tif ( !Global.isSet( LocalCacheData.timesheet_sub_grid_expended_dic[grid_id] ) ||\n\t\t\t\tLocalCacheData.timesheet_sub_grid_expended_dic[grid_id] === true ) {\n\n\t\t\t\timg.attr( 'src', Global.getRealImagePath( 'images/big_collapse.png' ) );\n\t\t\t\tLocalCacheData.timesheet_sub_grid_expended_dic[grid_id] = true;\n\n\t\t\t} else {\n\t\t\t\timg.attr( 'src', Global.getRealImagePath( 'images/big_expand.png' ) );\n\t\t\t\tLocalCacheData.timesheet_sub_grid_expended_dic[grid_id] = false;\n\t\t\t}\n\n\t\t\ttitle_bar.append( img );\n\n\t\t\tthis.setGridSExpendOrCollapseStatus( grid_id, title );\n\n\t\t\timg.click( function( e ) {\n\n\t\t\t\tif ( LocalCacheData.timesheet_sub_grid_expended_dic[grid_id] === true ) {\n\t\t\t\t\t$( this ).attr( 'src', Global.getRealImagePath( 'images/big_expand.png' ) );\n\t\t\t\t\tLocalCacheData.timesheet_sub_grid_expended_dic[grid_id] = false;\n\t\t\t\t\t$this.setGridSExpendOrCollapseStatus( grid_id, title );\n\t\t\t\t} else {\n\t\t\t\t\t$( this ).attr( 'src', Global.getRealImagePath( 'images/big_collapse.png' ) );\n\t\t\t\t\tLocalCacheData.timesheet_sub_grid_expended_dic[grid_id] = true;\n\t\t\t\t\t$this.setGridSExpendOrCollapseStatus( grid_id, title );\n\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t}\n\n\tupdateGridHeaderBar( grid_id, description ) {\n\t\tvar label = description;\n\t\tvar table = $( $( this.el ).find( 'table[aria-labelledby=gbox_' + this.ui_id + '_' + grid_id + ']' )[0] );\n\t\tvar title_span = table.find( '.title-span' );\n\t\tvar count = 0;\n\n\t\tif ( LocalCacheData.timesheet_sub_grid_expended_dic[grid_id] !== true ) {\n\t\t\tswitch ( grid_id ) {\n\t\t\t\tcase 'branch_grid':\n\t\t\t\t\tlabel = label + ' (' + ( this.branch_cell_count ) + ')';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'department_grid':\n\t\t\t\t\tlabel = label + ' (' + ( this.department_cell_count ) + ')';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'job_item_grid':\n\t\t\t\t\tlabel = label + ' (' + ( this.task_cell_count ) + ')';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'punch_tag_grid':\n\t\t\t\t\tlabel = label + ' (' + ( this.punch_tag_cell_count ) + ')';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'job_grid':\n\t\t\t\t\tlabel = label + ' (' + ( this.job_cell_count ) + ')';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'premium_grid':\n\t\t\t\t\tlabel = label + ' (' + ( this.premium_cell_count ) + ')';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'absence_grid':\n\t\t\t\t\tlabel = label + ' (' + ( this.absence_cell_count ) + ')';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'punch_note_grid':\n\t\t\t\t\tlabel = label + ' (' + ( this.punch_note_account ) + ')';\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\ttitle_span.text( label );\n\t}\n\n\tsetGridHeaderBar( grid_id, label ) {\n\t\tvar table = $( this.grid_dic[grid_id].grid ).parents( '.ui-jqgrid-view' ).find( '.ui-jqgrid-hbox table' ); //grab the hbox\n\t\t//table.empty();\n\t\ttable.css( 'width', '100vw' ); //set default width of timesheet tables to the width of the screen to set the header widths.\n\n\t\tvar label = $.i18n._( label );\n\n\t\ttable.find( 'tr:first' ).hide();\n\t\tvar title_bar = $( '<div class=\\'title-bar\\'><span class=\\'title-span\\'>' + label + '</span></div>' );\n\t\ttable.append( title_bar );\n\t}\n\n\tbuildManualTimeSheetsColumns() {\n\t\tthis.day_dic = {};\n\t\tfor ( var i = 0; i < 7; i++ ) {\n\t\t\tvar current_date = new Date( new Date( this.start_date.getTime() ).setDate( this.start_date.getDate() + i ) );\n\t\t\tvar day_text = current_date.format( this.day_format );\n\t\t\tvar date_text = current_date.format( this.date_format );\n\t\t\tthis.day_dic['day_' + i] = { value: day_text + '<br>' + date_text, field: current_date.format() };\n\t\t}\n\t}\n\n\tgetManualTimeSheetData( callBack ) {\n\t\tvar $this = this;\n\n\t\tvar user_id = this.getSelectEmployee();\n\t\tif ( user_id ) {\n\t\t\tvar args = {};\n\t\t\targs.filter_data = {\n\t\t\t\tuser_id: user_id,\n\t\t\t\tobject_type_id: 10,\n\t\t\t\tstart_date: this.start_date.format(),\n\t\t\t\tend_date: this.end_date.format()\n\t\t\t};\n\t\t\targs.filter_columns = {\n\t\t\t\t'id': true,\n\t\t\t\t'date_stamp': true,\n\t\t\t\t'total_time': true,\n\t\t\t\t'object_type': true,\n\t\t\t\t'name': true,\n\t\t\t\t'branch_id': true,\n\t\t\t\t'department_id': true,\n\t\t\t\t'branch': true,\n\t\t\t\t'department': true,\n\t\t\t\t'job': true,\n\t\t\t\t'job_item': true,\n\t\t\t\t'job_id': true,\n\t\t\t\t'job_item_id': true,\n\t\t\t\t'punch_tag': true,\n\t\t\t\t'punch_tag_id': true,\n\t\t\t\t'note': true,\n\t\t\t\t'override': true\n\t\t\t};\n\t\t\tthis.api_user_date_total.getUserDateTotal( args, true, {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t$this.manual_timesheet_data = result.getResult();\n\t\t\t\t\tcallBack();\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t}\n\n\tbuildManualTimeSheetData() {\n\t\tthis.time_sheet_data_overrode_true_map = {};\n\t\tthis.time_sheet_data_overrode_false_map = {};\n\t\tvar sort_by_fields = ['branch_id', 'department_id', 'job_id', 'job_item_id', 'punch_tag_id'],\n\t\t\tmanual_timesheet_data_group_array = [],\n\t\t\toverride_true_array = [],\n\t\t\toverride_false_array = [];\n\t\tthis.manual_timesheet_data.sort( Global.m_sort_by( sort_by_fields ) );\n\t\tmanual_timesheet_data_group_array = _.groupBy( this.manual_timesheet_data, 'override' );\n\t\toverride_true_array = manual_timesheet_data_group_array[true];\n\t\toverride_false_array = manual_timesheet_data_group_array[false];\n\t\tdoNext( override_true_array, this.time_sheet_data_overrode_true_map );\n\t\tdoNext( override_false_array, this.time_sheet_data_overrode_false_map );\n\n\t\tfunction doNext( manual_timesheet_data, target_map ) {\n\t\t\t!manual_timesheet_data && ( manual_timesheet_data = [] );\n\t\t\tfor ( var i = 0, m = manual_timesheet_data.length; i < m; i++ ) {\n\t\t\t\tvar data = manual_timesheet_data[i];\n\n\t\t\t\tvar key = data.branch_id + '-' + data.department_id + '-' + data.job_id + '-' + data.job_item_id;\n\t\t\t\tif ( !target_map[key] ) {\n\t\t\t\t\ttarget_map[key] = {};\n\t\t\t\t\ttarget_map[key].branch_id = data.branch_id;\n\t\t\t\t\ttarget_map[key].department_id = data.department_id;\n\t\t\t\t\ttarget_map[key].job_id = data.job_id;\n\t\t\t\t\ttarget_map[key].job_item_id = data.job_item_id;\n\t\t\t\t\ttarget_map[key].punch_tag_id = data.punch_tag_id;\n\t\t\t\t\ttarget_map[key].branch = data.branch;\n\t\t\t\t\ttarget_map[key].department = data.department;\n\t\t\t\t\ttarget_map[key].job = data.job;\n\t\t\t\t\ttarget_map[key].job_item = data.job_item;\n\t\t\t\t\ttarget_map[key].punch_tag = data.punch_tag;\n\t\t\t\t\ttarget_map[key].override = data.override;\n\t\t\t\t\ttarget_map[key][data.date_stamp] = data;\n\t\t\t\t} else if ( target_map[key][data.date_stamp] ) {\n\t\t\t\t\t// If already has data in this day, create next row.\n\t\t\t\t\tvar j = 1;\n\t\t\t\t\twhile ( true ) {\n\t\t\t\t\t\tif ( !target_map[key + '-' + j] ) {\n\t\t\t\t\t\t\ttarget_map[key + '-' + j] = {};\n\t\t\t\t\t\t\ttarget_map[key + '-' + j].branch_id = data.branch_id;\n\t\t\t\t\t\t\ttarget_map[key + '-' + j].department_id = data.department_id;\n\t\t\t\t\t\t\ttarget_map[key + '-' + j].job_id = data.job_id;\n\t\t\t\t\t\t\ttarget_map[key + '-' + j].job_item_id = data.job_item_id;\n\t\t\t\t\t\t\ttarget_map[key + '-' + j].punch_tag_id = data.punch_tag_id;\n\t\t\t\t\t\t\ttarget_map[key + '-' + j].branch = data.branch;\n\t\t\t\t\t\t\ttarget_map[key + '-' + j].department = data.department;\n\t\t\t\t\t\t\ttarget_map[key + '-' + j].job = data.job;\n\t\t\t\t\t\t\ttarget_map[key + '-' + j].punch_tag = data.punch_tag;\n\t\t\t\t\t\t\ttarget_map[key + '-' + j].override = data.override;\n\t\t\t\t\t\t\ttarget_map[key + '-' + j][data.date_stamp] = data;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t} else if ( !target_map[key + '-' + j][data.date_stamp] ) {\n\t\t\t\t\t\t\ttarget_map[key + '-' + j][data.date_stamp] = data;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tj = j + 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\ttarget_map[key][data.date_stamp] = data;\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n\n\tbuildManualNotes( widgets, data ) {\n\t\tfor ( let widget_key in widgets ) {\n\t\t\tlet item = widgets[widget_key];\n\n\t\t\t//Notes may be placed on days that do not have a user_date_total record yet. We need to check this is a day widget and that no user_date_total record exists for that day.\n\t\t\t//In which case we need to create a user_date_total for that day and in the appropriate place.\n\t\t\tlet has_no_matching_user_date_total_record = false;\n\t\t\tfor ( let i = 0; i < 7; i++ ) {\n\t\t\t\tlet current_date = new Date( new Date( this.start_date.getTime() ).setDate( this.start_date.getDate() + i ) ).format();\n\n\t\t\t\tif ( typeof item.getField === 'function' && item.getField() === current_date ) {\n\t\t\t\t\tif ( !data[current_date] ) {\n\t\t\t\t\t\thas_no_matching_user_date_total_record = true;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( typeof item.getField === 'function' && item.getEnabled() && ( has_no_matching_user_date_total_record || ( data[item.getField()] && data[item.getField()].id ) ) ) {\n\t\t\t\tlet id = '';\n\t\t\t\tif ( has_no_matching_user_date_total_record ) {\n\t\t\t\t\tid = 'id-' + TTUUID.generateUUID();\n\t\t\t\t} else {\n\t\t\t\t\tid = 'id-' + data[item.getField()].id;\n\t\t\t\t}\n\n\t\t\t\tif ( document.getElementById( id ) ) {\n\t\t\t\t\tcontinue; //Note component already mounted.\n\t\t\t\t}\n\t\t\t\tlet note = '';\n\t\t\t\tif ( !has_no_matching_user_date_total_record ) {\n\t\t\t\t\tnote = data[item.getField()].note || '';\n\t\t\t\t}\n\n\t\t\t\tlet note_mount_point = document.createElement( 'div' );\n\t\t\t\tnote_mount_point.id = id;\n\t\t\t\tnote_mount_point.className = 'timesheet-manual-note';\n\n\t\t\t\titem[0].parentNode.prepend( note_mount_point );\n\t\t\t\titem[0].style.position = 'inherit';\n\n\t\t\t\tTTVueUtils.mountComponent( id, TimeSheetNote, {\n\t\t\t\t\tid: id,\n\t\t\t\t\tstarting_note: note,\n\t\t\t\t\tfield_reference: item\n\t\t\t\t} );\n\n\t\t\t\tthis.manual_note_component_ids.push( id );\n\n\t\t\t\tthis.event_bus.on( id, 'saveNote', ( event_data ) => {\n\t\t\t\t\tif ( !data[item.getField()] ) {\n\t\t\t\t\t\t//Note is being added to a cell with no user_date_total record.\n\t\t\t\t\t\tdata[item.getField()] = {};\n\t\t\t\t\t}\n\t\t\t\t\tdata[item.getField()].note = event_data.note;\n\t\t\t\t\twidgets.is_changed = true;\n\t\t\t\t\tthis.onSaveClick();\n\t\t\t\t}, TTEventBusStatics.AUTO_CLEAR_ON_EXIT );\n\t\t\t}\n\t\t}\n\t}\n\n\tinitInsideEditorData( updateExistedCell ) {\n\t\tif ( !updateExistedCell && this.manual_note_component_ids.length > 0 ) {\n\t\t\tthis.manual_note_component_ids.forEach( ( id ) => {\n\t\t\t\tTTVueUtils.unmountComponent( id );\n\t\t\t} );\n\t\t}\n\n\t\tvar $this = this;\n\t\tfor ( var key in this.day_dic ) {\n\t\t\tthis.$( '#' + key + '_date' ).html( this.day_dic[key].value );\n\t\t\tthis.$( '#' + key + '_date' ).addClass( 'manual_grid_day_' + Global.strToDate( this.day_dic[key].field ).format( this.full_format ) );\n\t\t\tthis.$( '#' + key + '_date' ).attr( 'current_date', 'manual_grid_day_' + Global.strToDate( this.day_dic[key].field ).format( this.full_format ) );\n\t\t\tthis.$( '#' + key + '_date' ).unbind( 'click' ).bind( 'click', function( e ) {\n\t\t\t\tvar target = e.currentTarget;\n\t\t\t\tvar field = $( target ).attr( 'current_date' );\n\t\t\t\tfield = field.substring( 16, field.length );\n\t\t\t\tvar date = Global.strToDate( field, $this.full_format );\n\t\t\t\tif ( date && date.getYear() > 0 ) {\n\t\t\t\t\t$this.setDatePickerValue( date.format( Global.getLoginUserDateFormat() ) );\n\t\t\t\t\t$this.highLightSelectDay();\n\t\t\t\t\t$this.reLoadSubGridsSource();\n\t\t\t\t}\n\t\t\t} );\n\t\t\tthis.$( '.is-saving-manual-grid' ).removeClass( 'is-saving-manual-grid' );\n\t\t}\n\t\tif ( this.is_auto_switch ) {\n\t\t\tthis.is_auto_switch = false;\n\t\t\tdoNext();\n\t\t} else {\n\t\t\tthis.getManualTimeSheetData( function() {\n\t\t\t\tdoNext();\n\t\t\t} );\n\t\t}\n\n\t\tfunction doNext() {\n\t\t\t$this.is_saving_manual_grid = false;\n\t\t\t$this.setDefaultMenu();\n\t\t\tif ( !updateExistedCell ) {\n\t\t\t\t$this.editor.removeAllRows();\n\t\t\t\tif ( $this.manual_timesheet_data.length > 0 ) {\n\t\t\t\t\t$this.buildManualTimeSheetData();\n\t\t\t\t\t_.map( $this.time_sheet_data_overrode_false_map, function( data ) {\n\t\t\t\t\t\t$this.editor.addRow( data );\n\t\t\t\t\t} );\n\t\t\t\t\t_.map( $this.time_sheet_data_overrode_true_map, function( data ) {\n\t\t\t\t\t\t$this.editor.addRow( data );\n\t\t\t\t\t} );\n\t\t\t\t\tif ( _.isEmpty( $this.time_sheet_data_overrode_true_map ) ) {\n\t\t\t\t\t\t$this.editor.addRow();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t$this.editor.addRow();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif ( $this.manual_timesheet_data.length > 0 ) {\n\t\t\t\t\t$this.buildManualTimeSheetData();\n\t\t\t\t\tfor ( var map_key in $this.time_sheet_data_overrode_true_map ) {\n\t\t\t\t\t\tvar data = $this.time_sheet_data_overrode_true_map[map_key];\n\t\t\t\t\t\tfor ( var map_key_2 in data ) {\n\t\t\t\t\t\t\tvar item = data[map_key_2];\n\t\t\t\t\t\t\tif ( Array.isArray( item ) || !_.isObject( item ) ) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tvar key = $this.generateManualTimeSheetRecordKey( item );\n\t\t\t\t\t\t\tvar item_id_key = item.id + '-' + key;\n\n\t\t\t\t\t\t\t//Check to see if the record with no ID (pre-save) exists, and if so update it, or replace it with the saved record.\n\t\t\t\t\t\t\tif ( $this.manual_grid_records_map[item_id_key] ) {\n\t\t\t\t\t\t\t\t$this.manual_grid_records_map[item_id_key][item.date_stamp].setValue( item.total_time );\n\t\t\t\t\t\t\t\t$this.buildManualNotes( $this.manual_grid_records_map[item_id_key], data );\n\t\t\t\t\t\t\t} else if ( $this.manual_grid_records_map[key] ) {\n\t\t\t\t\t\t\t\t$this.manual_grid_records_map[key].current_edit_item[item.date_stamp] = item;\n\t\t\t\t\t\t\t\t$this.manual_grid_records_map[key][item.date_stamp].setValue( item.total_time );\n\t\t\t\t\t\t\t\t$this.buildManualNotes( $this.manual_grid_records_map[key], data );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ( $this.save_manual_grid_after_save ) {\n\t\t\t\t$this.autoSaveManualPunch();\n\t\t\t\t$this.save_manual_grid_after_save = false;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\tinsideEditorAddRow( data, index ) {\n\t\tvar $this = this;\n\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\tvar job_item_api = TTAPI.APIJobItem;\n\t\t\tvar job_api = TTAPI.APIJob;\n\t\t\tvar punch_tag_api = TTAPI.APIPunchTag;\n\t\t\tvar department_api = TTAPI.APIDepartment;\n\t\t}\n\t\tvar args;\n\t\tif ( !data ) {\n\t\t\tdata = {};\n\t\t\tif ( index >= 0 ) {\n\t\t\t\tvar widget_row = this.rows_widgets_array[index - 3];\n\t\t\t\tif ( this.parent_controller.show_branch_ui ) {\n\t\t\t\t\tif ( widget_row.branch_id ) {\n\t\t\t\t\t\tdata.branch_id = widget_row.branch_id.getValue();\n\t\t\t\t\t} else if ( widget_row.current_edit_item && widget_row.current_edit_item.branch_id ) {\n\t\t\t\t\t\tdata.branch_id = widget_row.current_edit_item.branch_id;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdata.branch_id = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif ( this.parent_controller.show_department_ui ) {\n\t\t\t\t\tif ( widget_row.department_id ) {\n\t\t\t\t\t\tdata.department_id = widget_row.department_id.getValue();\n\t\t\t\t\t} else if ( widget_row.current_edit_item && widget_row.current_edit_item.department_id ) {\n\t\t\t\t\t\tdata.department_id = widget_row.current_edit_item.department_id;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdata.department_id = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif ( this.parent_controller.show_job_ui && Global.getProductEdition() >= 20 ) {\n\t\t\t\t\tif ( widget_row.job_id ) {\n\t\t\t\t\t\tdata.job_id = widget_row.job_id.getValue();\n\t\t\t\t\t} else if ( widget_row.current_edit_item && widget_row.current_edit_item.job_id ) {\n\t\t\t\t\t\tdata.job_id = widget_row.current_edit_item.job_id;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdata.job_id = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif ( this.parent_controller.show_job_item_ui && Global.getProductEdition() >= 20 ) {\n\t\t\t\t\tif ( widget_row.job_item_id ) {\n\t\t\t\t\t\tdata.job_item_id = widget_row.job_item_id.getValue();\n\t\t\t\t\t} else if ( widget_row.current_edit_item && widget_row.current_edit_item.job_item_id ) {\n\t\t\t\t\t\tdata.job_item_id = widget_row.current_edit_item.job_item_id;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdata.job_item_id = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif ( this.parent_controller.show_punch_tag_ui && Global.getProductEdition() >= 20 ) {\n\t\t\t\t\tif ( widget_row.punch_tag_id ) {\n\t\t\t\t\t\tdata.punch_tag_id = widget_row.punch_tag_id.getValue();\n\t\t\t\t\t} else if ( widget_row.current_edit_item && widget_row.current_edit_item.punch_tag_id ) {\n\t\t\t\t\t\tdata.punch_tag_id = widget_row.current_edit_item.punch_tag_id;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdata.punch_tag_id = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t\tvar row = this.getRowRender(); //Get Row render\n\t\tvar render = this.getRender(); //get render, should be a table\n\t\tvar widgets = {}; //Save each row's widgets\n\t\tvar form_item_input;\n\t\t//Build row widgets\n\t\t//Branch\n\t\tif ( this.parent_controller.show_branch_ui ) {\n\t\t\tif ( data.hasOwnProperty( 'override' ) && !data.override ) {\n\t\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\t\t\tform_item_input.TText( { field: 'branch' } );\n\t\t\t\tform_item_input.setValue( data.branch );\n\t\t\t\trow.children().eq( 2 ).append( form_item_input );\n\t\t\t} else {\n\t\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\t\t\t\tform_item_input.AComboBox( {\n\t\t\t\t\tapi_class: TTAPI.APIBranch,\n\t\t\t\t\twidth: 90,\n\t\t\t\t\tlayout_name: 'global_branch',\n\t\t\t\t\tshow_search_inputs: true,\n\t\t\t\t\tset_empty: true,\n\t\t\t\t\tfield: 'branch_id',\n\t\t\t\t\tis_static_width: true\n\t\t\t\t} );\n\t\t\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\t\t\targs = {};\n\t\t\t\targs.filter_data = { user_id: this.parent_controller.getSelectEmployee() };\n\t\t\t\tform_item_input.setDefaultArgs( args );\n\t\t\t\tvar branch_id = data.hasOwnProperty( 'branch_id' ) ? data.branch_id : this.parent_controller.getSelectEmployee( true ).default_branch_id;\n\t\t\t\tform_item_input.setValue( data.hasOwnProperty( 'branch_id' ) ? data.branch_id : this.parent_controller.getSelectEmployee( true ).default_branch_id );\n\t\t\t\trow.children().eq( 2 ).append( form_item_input );\n\t\t\t}\n\t\t} else {\n\t\t\trow.children().eq( 2 ).hide();\n\t\t}\n\t\t//Department\n\t\tif ( this.parent_controller.show_department_ui ) {\n\t\t\tif ( data.hasOwnProperty( 'override' ) && !data.override ) {\n\t\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\t\t\tform_item_input.TText( { field: 'department' } );\n\t\t\t\tform_item_input.setValue( data.department );\n\t\t\t\trow.children().eq( 3 ).append( form_item_input );\n\t\t\t} else {\n\t\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\t\t\t\tform_item_input.AComboBox( {\n\t\t\t\t\tapi_class: TTAPI.APIDepartment,\n\t\t\t\t\twidth: 90,\n\t\t\t\t\tlayout_name: 'global_department',\n\t\t\t\t\tshow_search_inputs: true,\n\t\t\t\t\tset_empty: true,\n\t\t\t\t\tfield: 'department_id',\n\t\t\t\t\tis_static_width: true\n\t\t\t\t} );\n\t\t\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\t\t\targs = {};\n\t\t\t\targs.filter_data = { user_id: this.parent_controller.getSelectEmployee(), branch_id: branch_id };\n\t\t\t\tform_item_input.setDefaultArgs( args );\n\t\t\t\tvar department_id = data.hasOwnProperty( 'department_id' ) ? data.department_id : this.parent_controller.getSelectEmployee( true ).default_department_id;\n\t\t\t\tform_item_input.setValue( data.hasOwnProperty( 'department_id' ) ? data.department_id : this.parent_controller.getSelectEmployee( true ).default_department_id );\n\t\t\t\trow.children().eq( 3 ).append( form_item_input );\n\t\t\t}\n\t\t} else {\n\t\t\trow.children().eq( 3 ).hide();\n\t\t}\n\t\t//Job\n\t\tif ( this.parent_controller.show_job_ui && Global.getProductEdition() >= 20 ) {\n\t\t\tif ( data.hasOwnProperty( 'override' ) && !data.override ) {\n\t\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\t\t\tform_item_input.TText( { field: 'job' } );\n\t\t\t\tform_item_input.setValue( data.job );\n\t\t\t\trow.children().eq( 4 ).append( form_item_input );\n\t\t\t} else {\n\t\t\t\tvar job_form_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\t\t\t\tjob_form_item_input.AComboBox( {\n\t\t\t\t\tapi_class: TTAPI.APIJob,\n\t\t\t\t\twidth: 90,\n\t\t\t\t\tlayout_name: 'global_job',\n\t\t\t\t\tshow_search_inputs: true,\n\t\t\t\t\tset_empty: true,\n\t\t\t\t\talways_include_columns: ['group_id'],\n\t\t\t\t\tfield: 'job_id',\n\t\t\t\t\tis_static_width: true,\n\t\t\t\t\tsetRealValueCallBack: ( function( val ) {\n\t\t\t\t\t\tif ( val ) {\n\t\t\t\t\t\t\tjob_coder.setValue( val.manual_id );\n\t\t\t\t\t\t}\n\t\t\t\t\t} )\n\t\t\t\t} );\n\t\t\t\twidgets[job_form_item_input.getField()] = job_form_item_input;\n\t\t\t\t// Set default args\n\t\t\t\targs = {};\n\t\t\t\targs.filter_data = { status_id: 10, user_id: this.parent_controller.getSelectEmployee() };\n\t\t\t\tjob_form_item_input.setDefaultArgs( args );\n\t\t\t\tvar job_id = data.hasOwnProperty( 'job_id' ) ? data.job_id : this.parent_controller.getSelectEmployee( true ).default_job_id;\n\t\t\t\tjob_form_item_input.setValue( job_id );\n\t\t\t\tvar job_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\t\tjob_coder.TTextInput( { field: 'job_quick_search', disable_keyup_event: true, width: 30 } );\n\t\t\t\tjob_coder.css( 'display', 'inline-block' );\n\t\t\t\tjob_form_item_input.css( 'display', 'inline-block' );\n\t\t\t\trow.children().eq( 4 ).append( job_coder );\n\t\t\t\trow.children().eq( 4 ).append( job_form_item_input );\n\t\t\t\tjob_coder.unbind( 'formItemChange' ).bind( 'formItemChange', function( e, target ) {\n\t\t\t\t\tonJobQuickSearch( target.getField(), target.getValue() );\n\t\t\t\t} );\n\t\t\t}\n\t\t} else {\n\t\t\trow.children().eq( 4 ).hide();\n\t\t}\n\n\t\t//Task\n\t\tif ( this.parent_controller.show_job_item_ui && Global.getProductEdition() >= 20 ) {\n\t\t\tif ( data.hasOwnProperty( 'override' ) && !data.override ) {\n\t\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\t\t\tform_item_input.TText( { field: 'job_item' } );\n\t\t\t\tform_item_input.setValue( data.job_item );\n\t\t\t\trow.children().eq( 5 ).append( form_item_input );\n\t\t\t} else {\n\t\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\t\t\t\tform_item_input.AComboBox( {\n\t\t\t\t\tapi_class: TTAPI.APIJobItem,\n\t\t\t\t\twidth: 90,\n\t\t\t\t\tlayout_name: 'global_job_item',\n\t\t\t\t\tshow_search_inputs: true,\n\t\t\t\t\tset_empty: true,\n\t\t\t\t\talways_include_columns: ['group_id'],\n\t\t\t\t\tfield: 'job_item_id',\n\t\t\t\t\tis_static_width: true,\n\t\t\t\t\tsetRealValueCallBack: ( function( val ) {\n\t\t\t\t\t\tif ( val ) {\n\t\t\t\t\t\t\tjob_item_coder.setValue( val.manual_id );\n\t\t\t\t\t\t}\n\t\t\t\t\t} )\n\t\t\t\t} );\n\t\t\t\targs = {};\n\t\t\t\targs.filter_data = { status_id: 10, job_id: job_id };\n\t\t\t\tform_item_input.setDefaultArgs( args );\n\t\t\t\tvar job_item_id = data.hasOwnProperty( 'job_item_id' ) ? data.job_item_id : this.parent_controller.getSelectEmployee( true ).default_job_item_id;\n\t\t\t\tform_item_input.setValue( data.hasOwnProperty( 'job_item_id' ) ? data.job_item_id : this.parent_controller.getSelectEmployee( true ).default_job_item_id );\n\t\t\t\tvar job_item_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\t\tjob_item_coder.TTextInput( { field: 'job_item_quick_search', disable_keyup_event: true, width: 30 } );\n\t\t\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\t\t\tjob_item_coder.css( 'display', 'inline-block' );\n\t\t\t\tform_item_input.css( 'display', 'inline-block' );\n\t\t\t\trow.children().eq( 5 ).append( job_item_coder );\n\t\t\t\trow.children().eq( 5 ).append( form_item_input );\n\t\t\t\tjob_item_coder.unbind( 'formItemChange' ).bind( 'formItemChange', function( e, target ) {\n\t\t\t\t\tonJobQuickSearch( target.getField(), target.getValue() );\n\t\t\t\t} );\n\t\t\t}\n\t\t} else {\n\t\t\trow.children().eq( 5 ).hide();\n\t\t}\n\n\t\t//Punch Tag\n\t\tif ( this.parent_controller.show_punch_tag_ui && Global.getProductEdition() >= 20 ) {\n\t\t\tif ( data.hasOwnProperty( 'override' ) && !data.override ) {\n\t\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\t\t\tform_item_input.TText( { field: 'punch_tag' } );\n\t\t\t\tform_item_input.setValue( data.punch_tag );\n\t\t\t\trow.children().eq( 6 ).append( form_item_input );\n\t\t\t} else {\n\t\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\t\t\t\tform_item_input.AComboBox( {\n\t\t\t\t\tapi_class: TTAPI.APIPunchTag,\n\t\t\t\t\tallow_multiple_selection: true,\n\t\t\t\t\twidth: 90,\n\t\t\t\t\tlayout_name: 'global_punch_tag',\n\t\t\t\t\tshow_search_inputs: true,\n\t\t\t\t\tset_empty: true,\n\t\t\t\t\talways_include_columns: ['group_id'],\n\t\t\t\t\tfield: 'punch_tag_id',\n\t\t\t\t\tis_static_width: true\n/*\t\t\t\t\tsetRealValueCallBack: ( function( val ) {\n\t\t\t\t\t\tif ( val ) {\n\t\t\t\t\t\t\tpunch_tag_coder.setValue( val.manual_id );\n\t\t\t\t\t\t}\n\t\t\t\t\t} )*/\n\t\t\t\t} );\n\t\t\t\targs = {};\n\t\t\t\targs.filter_data = {\n\t\t\t\t\tstatus_id: 10,\n\t\t\t\t\tuser_id: this.parent_controller.getSelectEmployee( true ).id,\n\t\t\t\t\tbranch_id: branch_id,\n\t\t\t\t\tdepartment_id: department_id,\n\t\t\t\t\tjob_id: job_id,\n\t\t\t\t\tjob_item_id: job_item_id\n\t\t\t\t};\n\t\t\t\tform_item_input.setDefaultArgs( args );\n\t\t\t\tform_item_input.setValue( data.hasOwnProperty( 'punch_tag_id' ) ? data.punch_tag_id : this.parent_controller.getSelectEmployee( true ).default_punch_tag_id );\n\t\t\t\t//var punch_tag_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\t\t//punch_tag_coder.TTextInput( { field: 'punch_tag_quick_search', disable_keyup_event: true, width: 30 } );\n\t\t\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\t\t\t//punch_tag_coder.css( 'display', 'inline-block' );\n\t\t\t\tform_item_input.css( 'display', 'inline-block' );\n\t\t\t\t//row.children().eq( 6 ).append( punch_tag_coder );\n\t\t\t\trow.children().eq( 6 ).append( form_item_input );\n/*\t\t\t\tpunch_tag_coder.unbind( 'formItemChange' ).bind( 'formItemChange', function( e, target ) {\n\t\t\t\t\tonPunchTagQuickSearch( target.getField(), target.getValue() );\n\t\t\t\t} );*/\n\t\t\t}\n\t\t} else {\n\t\t\trow.children().eq( 6 ).hide();\n\t\t}\n\n\t\t//day 0\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\tform_item_input.TTextInput( {\n\t\t\tfield: this.parent_controller.day_dic['day_0'].field,\n\t\t\twidth: 55,\n\t\t\tmode: 'time_unit',\n\t\t\tneed_parser_sec: true,\n\t\t\tdo_validate: false\n\t\t} );\n\t\tform_item_input.setValue( data[form_item_input.getField()] ? data[form_item_input.getField()].total_time : 0 );\n\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\trow.children().eq( 7 ).append( form_item_input );\n\n\t\t//day 1\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\tform_item_input.TTextInput( {\n\t\t\tfield: this.parent_controller.day_dic['day_1'].field,\n\t\t\twidth: 55,\n\t\t\tmode: 'time_unit',\n\t\t\tneed_parser_sec: true,\n\t\t\tdo_validate: false\n\t\t} );\n\t\tform_item_input.setValue( data[form_item_input.getField()] ? data[form_item_input.getField()].total_time : 0 );\n\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\trow.children().eq( 8 ).append( form_item_input );\n\n\t\t//day 2\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\tform_item_input.TTextInput( {\n\t\t\tfield: this.parent_controller.day_dic['day_2'].field,\n\t\t\twidth: 55,\n\t\t\tmode: 'time_unit',\n\t\t\tneed_parser_sec: true,\n\t\t\tdo_validate: false\n\t\t} );\n\t\tform_item_input.setValue( data[form_item_input.getField()] ? data[form_item_input.getField()].total_time : 0 );\n\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\trow.children().eq( 9 ).append( form_item_input );\n\n\t\t//day 3\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\tform_item_input.TTextInput( {\n\t\t\tfield: this.parent_controller.day_dic['day_3'].field,\n\t\t\twidth: 55,\n\t\t\tmode: 'time_unit',\n\t\t\tneed_parser_sec: true,\n\t\t\tdo_validate: false\n\t\t} );\n\t\tform_item_input.setValue( data[form_item_input.getField()] ? data[form_item_input.getField()].total_time : 0 );\n\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\trow.children().eq( 10 ).append( form_item_input );\n\n\t\t//day 4\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\tform_item_input.TTextInput( {\n\t\t\tfield: this.parent_controller.day_dic['day_4'].field,\n\t\t\twidth: 55,\n\t\t\tmode: 'time_unit',\n\t\t\tneed_parser_sec: true,\n\t\t\tdo_validate: false\n\t\t} );\n\t\tform_item_input.setValue( data[form_item_input.getField()] ? data[form_item_input.getField()].total_time : 0 );\n\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\trow.children().eq( 11 ).append( form_item_input );\n\n\t\t//day 5\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\tform_item_input.TTextInput( {\n\t\t\tfield: this.parent_controller.day_dic['day_5'].field,\n\t\t\twidth: 55,\n\t\t\tmode: 'time_unit',\n\t\t\tneed_parser_sec: true,\n\t\t\tdo_validate: false\n\t\t} );\n\t\tform_item_input.setValue( data[form_item_input.getField()] ? data[form_item_input.getField()].total_time : 0 );\n\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\trow.children().eq( 12 ).append( form_item_input );\n\n\t\t//day 6\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\tform_item_input.TTextInput( {\n\t\t\tfield: this.parent_controller.day_dic['day_6'].field,\n\t\t\twidth: 55,\n\t\t\tmode: 'time_unit',\n\t\t\tneed_parser_sec: true,\n\t\t\tdo_validate: false\n\t\t} );\n\t\tform_item_input.setValue( data[form_item_input.getField()] ? data[form_item_input.getField()].total_time : 0 );\n\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\trow.children().eq( 13 ).append( form_item_input );\n\t\tif ( data.hasOwnProperty( 'override' ) && !data.override ) {\n\t\t\trow.children().eq( 1 ).children().hide();\n\t\t}\n\n\t\tvar disable_plus = false;\n\t\tvar disable_minus = false;\n\t\tvar disable_dropdowns = false;\n\n\t\tfor ( var key in widgets ) {\n\t\t\tvar item = widgets[key];\n\n\t\t\t//disable if all pay_periods visible are not open.\n\t\t\tvar invalid = 0;\n\n\t\t\tfor ( var n in this.parent_controller.full_timesheet_data.pay_period_data ) {\n\t\t\t\tif ( this.parent_controller.full_timesheet_data.pay_period_data[n].status_id != 10 && this.parent_controller.full_timesheet_data.pay_period_data[n].status_id != 30 ) {\n\t\t\t\t\tinvalid++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( invalid > 0 && invalid == Object.keys( this.parent_controller.full_timesheet_data.pay_period_data ).length ) {\n\t\t\t\tif ( this.parent_controller.full_timesheet_data.punch_data.length != 0 ) {\n\t\t\t\t\tdisable_plus = true;\n\t\t\t\t\tdisable_minus = true;\n\t\t\t\t\tif ( Object.keys( data ).length == 0 ) {\n\t\t\t\t\t\treturn; //don't show a blank row if all pay periods are closed\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//disable fields under closed pay periods\n\t\t\tif ( this.parent_controller.full_timesheet_data.pay_period_data[this.parent_controller.full_timesheet_data.timesheet_dates.pay_period_date_map[item.getField()]] ) {\n\t\t\t\tvar field_pay_period_status = parseInt( this.parent_controller.full_timesheet_data.pay_period_data[this.parent_controller.full_timesheet_data.timesheet_dates.pay_period_date_map[item.getField()]].status_id );\n\t\t\t\tif ( field_pay_period_status != 10 && field_pay_period_status != 30 ) {\n\t\t\t\t\titem.setEnabled && item.setEnabled( false );\n\t\t\t\t\tif ( item.getField() != 'branch_id' && item.getField() != 'department_id' && item.getField() != 'job_id' && item.getField() != 'job_item_id' && item.getField() != 'punch_tag_id' && typeof data[item.getField()] != 'undefined' ) {\n\t\t\t\t\t\t//only disable dropdowns if there is data in the disabled fields\n\t\t\t\t\t\tdisable_dropdowns = true;\n\t\t\t\t\t\tdisable_minus = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( data.hasOwnProperty( 'override' ) && !data.override ) {\n\t\t\t\titem.setEnabled && item.setEnabled( false );\n\t\t\t\titem.getValue() > 0 && item.hasClass( 't-text-input' ) >= 0 && item.css( 'color', 'red' );\n\t\t\t}\n\t\t\titem.unbind( 'formItemChange' ).bind( 'formItemChange', function( e, target ) {\n\t\t\t\ttarget.is_changed = true;\n\t\t\t\tif ( target.getField() === 'job_id' ) {\n\t\t\t\t\twidgets.is_changed = true;\n\t\t\t\t\tjob_coder.setValue( target.getValue( true ) ? ( target.getValue( true ).manual_id ? target.getValue( true ).manual_id : '' ) : '' );\n\t\t\t\t\tsetJobItemValueWhenJobChanged( target.getValue( true ) );\n\t\t\t\t\tsetPunchTagValuesWhenCriteriaChanged( data );\n\t\t\t\t} else if ( target.getField() === 'job_item_id' ) {\n\t\t\t\t\twidgets.is_changed = true;\n\t\t\t\t\tjob_item_coder.setValue( target.getValue( true ) ? ( target.getValue( true ).manual_id ? target.getValue( true ).manual_id : '' ) : '' );\n\t\t\t\t\tsetPunchTagValuesWhenCriteriaChanged( data );\n\t\t\t\t} else if ( target.getField() === 'branch_id' ) {\n\t\t\t\t\twidgets.is_changed = true;\n\t\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\t\tsetDepartmentValueWhenBranchChanged( data );\n\t\t\t\t\t}\n\t\t\t\t} else if ( target.getField() === 'department_id' ) {\n\t\t\t\t\twidgets.is_changed = true;\n\t\t\t\t} else if ( target.getField() === 'punch_tag_id' ) {\n\t\t\t\t\twidgets.is_changed = true;\n\t\t\t\t}\n\t\t\t\t$this.parent_controller.autoSaveManualPunch();\n\t\t\t} );\n\t\t}\n\n\t\tif ( disable_dropdowns ) {\n\t\t\tfor ( var key in widgets ) {\n\t\t\t\tvar item = widgets[key];\n\t\t\t\tif ( item.getField() == 'branch_id' || item.getField() == 'department_id' || item.getField() == 'job_id' || item.getField() == 'job_item_id' ) {\n\t\t\t\t\tif ( item.getField() == 'job_id' || item.getField() == 'job_item_id' || item.getField() == 'punch_tag_id' ) {\n\t\t\t\t\t\titem.parents( 'td' ).find( 'input[type=\"text\"]' ).hide(); //hide job and task lookup box\n\t\t\t\t\t}\n\t\t\t\t\titem.setEnabled && item.setEnabled( false );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( disable_plus == true ) {\n\t\t\trow.find( '.plus-icon' ).hide();\n\t\t}\n\n\t\tif ( disable_minus == true ) {\n\t\t\trow.find( '.minus-icon' ).hide();\n\t\t}\n\n\t\tif ( typeof index != 'undefined' ) {\n\t\t\trow.insertAfter( $( render ).find( 'tr' ).eq( index ) );\n\t\t\tthis.rows_widgets_array.splice( ( index ), 0, widgets );\n\n\t\t} else {\n\t\t\t$( render ).append( row );\n\t\t\tthis.rows_widgets_array.push( widgets );\n\t\t}\n\n\t\t$this.parent_controller.buildManualNotes( widgets, data );\n\n\t\t//Save current set item\n\t\twidgets.current_edit_item = data;\n\t\tthis.addIconsEvent( row ); //Bind event to add and minus icon\n\n\t\tfunction onJobQuickSearch( key, value ) {\n\t\t\tvar args = {};\n\t\t\tif ( key === 'job_quick_search' ) {\n\t\t\t\targs.filter_data = {\n\t\t\t\t\tmanual_id: value,\n\t\t\t\t\tuser_id: $this.parent_controller.getSelectEmployee(),\n\t\t\t\t\tstatus_id: '10'\n\t\t\t\t};\n\t\t\t\tjob_api.getJob( args, {\n\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\tvar result_data = result.getResult();\n\t\t\t\t\t\twidgets.is_changed = true;\n\t\t\t\t\t\t$this.parent_controller.autoSaveManualPunch();\n\t\t\t\t\t\tif ( result_data.length > 0 ) {\n\t\t\t\t\t\t\twidgets['job_id'].setValue( result_data[0].id );\n\t\t\t\t\t\t\tsetJobItemValueWhenJobChanged( result_data[0] );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twidgets['job_id'].setValue( '' );\n\t\t\t\t\t\t\tsetJobItemValueWhenJobChanged( false );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} else if ( key === 'job_item_quick_search' ) {\n\t\t\t\targs.filter_data = { manual_id: value, job_id: widgets['job_id'].getValue(), status_id: '10' };\n\t\t\t\tjob_item_api.getJobItem( args, {\n\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\tvar result_data = result.getResult();\n\t\t\t\t\t\twidgets.is_changed = true;\n\t\t\t\t\t\t$this.parent_controller.autoSaveManualPunch();\n\t\t\t\t\t\tif ( result_data.length > 0 ) {\n\t\t\t\t\t\t\twidgets['job_item_id'].setValue( result_data[0].id );\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twidgets['job_item_id'].setValue( '' );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t}\n\n\t\tfunction setJobItemValueWhenJobChanged( job ) {\n\t\t\tvar job_item_widget = widgets['job_item_id'];\n\t\t\tif ( !job_item_widget ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar current_job_item_id = job_item_widget.getValue();\n\t\t\tjob_item_widget.setSourceData( null );\n\t\t\tvar args = {};\n\t\t\targs.filter_data = { status_id: 10, job_id: widgets['job_id'].getValue() };\n\t\t\tjob_item_widget.setDefaultArgs( args );\n\t\t\tif ( current_job_item_id ) {\n\t\t\t\tvar new_arg = Global.clone( args );\n\t\t\t\tnew_arg.filter_data.id = current_job_item_id;\n\t\t\t\tnew_arg.filter_columns = job_item_widget.getColumnFilter();\n\t\t\t\tjob_item_api.getJobItem( new_arg, {\n\t\t\t\t\tonResult: function( task_result ) {\n\t\t\t\t\t\tvar data = task_result.getResult();\n\t\t\t\t\t\tif ( data.length > 0 ) {\n\t\t\t\t\t\t\tjob_item_widget.setValue( current_job_item_id );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsetDefaultData();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t} else {\n\t\t\t\tsetDefaultData();\n\t\t\t}\n\n\t\t\tfunction setDefaultData() {\n\t\t\t\tif ( widgets['job_id'].getValue() ) {\n\t\t\t\t\tjob_item_widget.setValue( job.default_item_id );\n\t\t\t\t\tif ( job.default_item_id === false || job.default_item_id === 0 ) {\n\t\t\t\t\t\tjob_item_coder.setValue( '' );\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tjob_item_widget.setValue( '' );\n\t\t\t\t\tjob_item_coder.setValue( '' );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction setDepartmentValueWhenBranchChanged() {\n\t\t\tvar department_widget = widgets['department_id'];\n\t\t\tif ( !department_widget ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdepartment_widget.setSourceData( null );\n\t\t\tvar args = {};\n\t\t\targs.filter_data = {\n\t\t\t\tuser_id: $this.parent_controller.getSelectEmployee( true ).id,\n\t\t\t\tbranch_id: widgets['branch_id'].getValue()\n\t\t\t};\n\t\t\tvar current_department_id = department_widget.getValue();\n\t\t\tdepartment_widget.setDefaultArgs( args );\n\n\t\t\tif ( current_department_id ) {\n\t\t\t\tvar new_arg = Global.clone( args );\n\n\t\t\t\tnew_arg.filter_columns = department_widget.getColumnFilter();\n\t\t\t\tdepartment_api.getDepartment( new_arg, {\n\t\t\t\t\tonResult: function( department_result ) {\n\n\t\t\t\t\t\tvar data = department_result.getResult();\n\n\t\t\t\t\t\tif ( data.length > 0 && data.some( department => department.id === current_department_id ) ) {\n\t\t\t\t\t\t\tdepartment_widget.setValue( current_department_id );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsetDefaultData();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t} else {\n\t\t\t\tsetDefaultData();\n\t\t\t}\n\n\t\t\tfunction setDefaultData() {\n\t\t\t\tdepartment_widget.setValue( '' );\n\t\t\t}\n\t\t}\n\n\t\tfunction setPunchTagValuesWhenCriteriaChanged() {\n\t\t\tif ( ( Global.getProductEdition() <= 15 ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar punch_tag_widget = widgets['punch_tag_id'];\n\t\t\tif ( !punch_tag_widget ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar current_punch_tag_ids = punch_tag_widget.getValue();\n\t\t\tpunch_tag_widget.setSourceData( null );\n\t\t\tvar args = {};\n\t\t\targs.filter_data = {\n\t\t\t\tstatus_id: 10,\n\t\t\t\tuser_id: $this.parent_controller.getSelectEmployee( true ).id,\n\t\t\t\tbranch_id: widgets['branch_id'] ? widgets['branch_id'].getValue() : TTUUID.zero_id,\n\t\t\t\tdepartment_id: widgets['department_id'] ? widgets['department_id'].getValue() : TTUUID.zero_id,\n\t\t\t\tjob_id: widgets['job_id'] ? widgets['job_id'].getValue() : TTUUID.zero_id,\n\t\t\t\tjob_item_id: widgets['job_item_id'] ? widgets['job_item_id'].getValue() : TTUUID.zero_id\n\t\t\t};\n\t\t\tpunch_tag_widget.setDefaultArgs( args );\n\n\t\t\tif ( current_punch_tag_ids && current_punch_tag_ids.length > 0 ) {\n\t\t\t\tvar new_arg = Global.clone( args );\n\n\t\t\t\tnew_arg.manual_id = current_punch_tag_ids;\n\t\t\t\tpunch_tag_api.getPunchTag( new_arg, {\n\t\t\t\t\tonResult: function( punch_tag_result ) {\n\t\t\t\t\t\tvar data = punch_tag_result.getResult();\n\n\t\t\t\t\t\tif ( data.length > 0 ) {\n\t\t\t\t\t\t\tif ( current_punch_tag_ids !== TTUUID.zero_id && current_punch_tag_ids.length > 0 && shouldUpdatePunchTags( current_punch_tag_ids, data ) ) {\n\t\t\t\t\t\t\t\t//Compare current selected punch tags and the list of punch tags from the API and remove invalid punch tags.\n\t\t\t\t\t\t\t\tvar intersected_values = current_punch_tag_ids.filter( punch_tag_id => data.some( punch_tag => punch_tag_id === punch_tag.id ) );\n\t\t\t\t\t\t\t\tpunch_tag_widget.setValue( intersected_values );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsetDefaultData();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t} else {\n\t\t\t\tsetDefaultData();\n\t\t\t}\n\n\t\t\tfunction setDefaultData() {\n\t\t\t\tpunch_tag_widget.setValue( '' );\n\t\t\t}\n\t\t}\n\n\t\tfunction shouldUpdatePunchTags( current_punch_tag_ids, data ) {\n\t\t\t//If the data returned from the API does not contain every currently selected punch tag then we need to remove invalid tags.\n\t\t\tif ( current_punch_tag_ids.every( punch_tag_id => data.some( punch_tag => punch_tag.id === punch_tag_id ) ) === false ) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\t//In the scenario where the user does not have permission to edit punch branch, department, job, job item and punch tag. (All of them)\n\t\t//Then the minus icon should not be centered as the <td> is too large and it looks out of place.\n\t\tif ( this.parent_controller.getPunchMode() === 'manual' ) {\n\t\t\tif ( this.parent_controller.timesheet_columns.length === 9 ) { // Plus and Minus icon + 7 days of the week.\n\t\t\t\tvar control_icons = document.querySelectorAll( '.control-icon' );\n\n\t\t\t\tfor ( var control_icon of control_icons ) {\n\t\t\t\t\tcontrol_icon.style.textAlign = 'left';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tautoSaveManualPunch() {\n\t\tvar $this = this;\n\t\tif ( this.is_saving_manual_grid ) {\n\t\t\tthis.save_manual_grid_after_save = true;\n\t\t\treturn;\n\t\t}\n\t\tthis.wait_auto_save && clearTimeout( this.wait_auto_save );\n\t\tthis.wait_auto_save = setTimeout( function() {\n\t\t\tif ( $this.getPunchMode() === 'manual' ) {\n\t\t\t\tProgressBar.showOverlay();\n\t\t\t\t$this.onSaveClick();\n\t\t\t}\n\t\t}, 2000 );\n\t}\n\n\tinsideEditorGetValue( isSave ) {\n\t\tvar len = this.rows_widgets_array.length;\n\t\tvar result = [];\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar row = this.rows_widgets_array[i];\n\t\t\tfor ( var j = 0; j < 7; j++ ) {\n\t\t\t\tvar current_date = new Date( new Date( this.parent_controller.start_date.getTime() ).setDate( this.parent_controller.start_date.getDate() + j ) );\n\t\t\t\tvar field = current_date.format();\n\t\t\t\tvar common_record = {};\n\t\t\t\tif ( !row[field] ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tcommon_record.total_time = row[field].getValue();\n\t\t\t\tif ( row[field].is_changed || ( row.is_changed && row.current_edit_item[field] ) ) {\n\t\t\t\t\trow.branch_id && ( common_record.branch_id = row.branch_id.getValue() );\n\t\t\t\t\trow.department_id && ( common_record.department_id = row.department_id.getValue() );\n\t\t\t\t\trow.job_id && ( common_record.job_id = row.job_id.getValue() );\n\t\t\t\t\trow.job_item_id && ( common_record.job_item_id = row.job_item_id.getValue() );\n\t\t\t\t\trow.punch_tag_id && ( common_record.punch_tag_id = row.punch_tag_id.getValue() );\n\t\t\t\t\tcommon_record.date_stamp = field;\n\t\t\t\t\tcommon_record.user_id = this.parent_controller.getSelectEmployee();\n\t\t\t\t\tcommon_record.object_type_id = 10;\n\t\t\t\t\tcommon_record.override = true;\n\t\t\t\t\tif ( row.current_edit_item[field] && row.current_edit_item[field].hasOwnProperty('note') ) { //Make sure we support blank notes to clear out the note field.\n\t\t\t\t\t\tcommon_record.note = row.current_edit_item[field].note;\n\t\t\t\t\t}\n\t\t\t\t\tcommon_record.row = row;\n\t\t\t\t\trow.current_edit_item[field] && ( common_record.id = row.current_edit_item[field].id );\n\t\t\t\t\tresult.push( common_record );\n\t\t\t\t\tif ( isSave ) {\n\t\t\t\t\t\trow[field].is_changed = false;\n\t\t\t\t\t\trow[field].addClass( 'is-saving-manual-grid' );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ( isSave ) {\n\t\t\t\trow.is_changed = false;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tinsideEditorRemoveRow( row ) {\n\t\tvar $this = this;\n\t\tvar index = row[0].rowIndex - 3;\n\t\tvar widget_row = this.rows_widgets_array[index];\n\t\tvar has_value = false;\n\t\tfor ( var j = 0; j < 7; j++ ) {\n\t\t\tvar current_date = new Date( new Date( this.parent_controller.start_date.getTime() ).setDate( this.parent_controller.start_date.getDate() + j ) );\n\t\t\tvar field = current_date.format();\n\t\t\tif ( widget_row[field].getValue() > 0 || widget_row.current_edit_item[field] ) {\n\t\t\t\thas_value = true;\n\t\t\t\tTAlertManager.showConfirmAlert( $.i18n._( 'You are about to delete the entire week worth of time for this row. Are you sure you wish to continue?' ), '', doNext );\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\t!has_value && doNext( true );\n\n\t\tfunction doNext( flag ) {\n\t\t\tif ( flag ) {\n\t\t\t\tvar remove_ids = [];\n\t\t\t\tfor ( var j = 0; j < 7; j++ ) {\n\t\t\t\t\tvar current_date = new Date( new Date( $this.parent_controller.start_date.getTime() ).setDate( $this.parent_controller.start_date.getDate() + j ) );\n\t\t\t\t\tvar field = current_date.format();\n\t\t\t\t\twidget_row.current_edit_item[field] && ( remove_ids.push( widget_row.current_edit_item[field].id ) );\n\t\t\t\t}\n\t\t\t\tif ( remove_ids.length > 0 ) {\n\t\t\t\t\tProgressBar.noProgressForNextCall();\n\t\t\t\t\tProgressBar.showNanobar();\n\t\t\t\t\t$this.is_saving_manual_grid = true;\n\t\t\t\t\t$this.parent_controller.setDefaultMenu();\n\t\t\t\t\t$this.api.deleteUserDateTotal( remove_ids, {\n\t\t\t\t\t\tonResult: function() {\n\t\t\t\t\t\t\t$this.parent_controller.reLoadSubGridsSource( true );\n\t\t\t\t\t\t\tProgressBar.removeNanobar();\n\t\t\t\t\t\t\t$this.parent_controller.setDefaultMenu();\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t\trow.remove();\n\t\t\t\t$this.rows_widgets_array.splice( index, 1 );\n\t\t\t\tif ( $this.rows_widgets_array.length === 0 ) {\n\t\t\t\t\t$this.addRow();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tbuildManualTimeSheetGrid() {\n\t\tvar args = {\n\t\t\tbranch: $.i18n._( 'Branch' ),\n\t\t\tdepartment: $.i18n._( 'Department' ),\n\t\t\tjob: $.i18n._( 'Job' ),\n\t\t\ttask: $.i18n._( 'Task' ),\n\t\t\tpunch_tag: $.i18n._( 'Tags' )\n\t\t};\n\n\t\tthis.editor = Global.loadWidgetByName( FormItemType.INSIDE_EDITOR );\n\t\tthis.editor.InsideEditor( {\n\t\t\ttitle: '',\n\t\t\taddRow: this.insideEditorAddRow,\n\t\t\tgetValue: this.insideEditorGetValue,\n\t\t\tsetValue: this.insideEditorSetValue,\n\t\t\tremoveRow: this.insideEditorRemoveRow,\n\t\t\tparent_controller: this,\n\t\t\trender: getRender(),\n\t\t\trender_args: args,\n\t\t\tapi: this.api_user_date_total,\n\t\t\trender_inline_html: true,\n\t\t\trow_render: getRowRender()\n\t\t} );\n\n\t\tfunction getRender() {\n\t\t\treturn `<table class=\"inside-editor-render grid-inside-editor-render\">\n\t\t\t\t\t\t<tr class=\"manual-timesheet-size-tr\">\n\t\t\t\t\t\t\t<td style=\"width: 25px\"></td>\n\t\t\t\t\t\t\t<td style=\"width: 25px\"></td>\n\t\t\t\t\t\t\t<td class=\"branch-header\" style=\"width: 120px\"></td>\n\t\t\t\t\t\t\t<td class=\"department-header\" style=\"width: 120px\"></td>\n\t\t\t\t\t\t\t<td class=\"job-header\" style=\"width: 120px\"></td>\n\t\t\t\t\t\t\t<td class=\"job-item-header\" style=\"width: 120px\"></td>\n\t\t\t\t\t\t\t<td class=\"punch-tag-header\" style=\"width: 120px\"></td>\n\t\t\t\t\t\t\t<td style=\"width: 50px\"></td>\n\t\t\t\t\t\t\t<td style=\"width: 50px\"></td>\n\t\t\t\t\t\t\t<td style=\"width: 50px\"></td>\n\t\t\t\t\t\t\t<td style=\"width: 50px\"></td>\n\t\t\t\t\t\t\t<td style=\"width: 50px\"></td>\n\t\t\t\t\t\t\t<td style=\"width: 50px\"></td>\n\t\t\t\t\t\t\t<td style=\"width: 50px\"></td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr class=\"title\">\n\t\t\t\t\t\t\t<td></td>\n\t\t\t\t\t\t\t<td></td>\n\t\t\t\t\t\t\t<td class=\"branch-header\"><%= branch %></td>\n\t\t\t\t\t\t\t<td class=\"department-header\"><%= department %></td>\n\t\t\t\t\t\t\t<td class=\"job-header\"><%= job %></td>\n\t\t\t\t\t\t\t<td class=\"job-item-header\"><%= task %></td>\n\t\t\t\t\t\t\t<td class=\"punch-tag-header\"><%= punch_tag %></td>\n\t\t\t\t\t\t\t<td id=\"day_0_date\"></td>\n\t\t\t\t\t\t\t<td id=\"day_1_date\"></td>\n\t\t\t\t\t\t\t<td id=\"day_2_date\"></td>\n\t\t\t\t\t\t\t<td id=\"day_3_date\"></td>\n\t\t\t\t\t\t\t<td id=\"day_4_date\"></td>\n\t\t\t\t\t\t\t<td id=\"day_5_date\"></td>\n\t\t\t\t\t\t\t<td id=\"day_6_date\"></td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>`;\n\t\t}\n\n\t\tfunction getRowRender() {\n\t\t\treturn `<tr class=\"inside-editor-row data-row\">\n\t\t\t\t\t\t<td class=\"cell control-icon\">\n\t\t\t\t\t\t\t<button class=\"plus-icon\" onclick=\"\"></button>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"cell control-icon\">\n\t\t\t\t\t\t\t<button class=\"minus-icon \" onclick=\"\"></button>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"branch \"></td>\n\t\t\t\t\t\t<td class=\"department \"></td>\n\t\t\t\t\t\t<td class=\"job \"></td>\n\t\t\t\t\t\t<td class=\"task \"></td>\n\t\t\t\t\t\t<td class=\"punch_tag \"></td>\n\t\t\t\t\t\t<td class=\"day-0 \"></td>\n\t\t\t\t\t\t<td class=\"day-1 \"></td>\n\t\t\t\t\t\t<td class=\"day-2 \"></td>\n\t\t\t\t\t\t<td class=\"day-3 \"></td>\n\t\t\t\t\t\t<td class=\"day-4 \"></td>\n\t\t\t\t\t\t<td class=\"day-5 \"></td>\n\t\t\t\t\t\t<td class=\"day-6 \"></td>\n\t\t\t\t\t</tr>`;\n\t\t}\n\n\t\tvar inside_editor_div = this.$( '.manual-timesheet-inside-editor-div' );\n\t\tinside_editor_div.append( this.editor );\n\t}\n\n\tbuildCalendars() {\n\t\tvar $this = this;\n\t\tif ( this.is_auto_switch ) {\n\t\t\tthis.getManualTimeSheetData( function() {\n\t\t\t\tif ( $this.manual_timesheet_data.length > 0 ) {\n\t\t\t\t\t$this.buildManualTimeSheetData();\n\t\t\t\t\tvar is_no_manual = _.isEmpty( $this.time_sheet_data_overrode_true_map );\n\t\t\t\t\tvar is_no_punch = _.isEmpty( $this.time_sheet_data_overrode_false_map );\n\t\t\t\t\tif ( is_no_manual && !is_no_punch && $this.toggle_button.getValue() !== 'manual' ) {\n\t\t\t\t\t\t$this.toggle_button.setValue( 'punch' );\n\t\t\t\t\t\t$this.is_auto_switch = false;\n\t\t\t\t\t} else if ( !is_no_manual && is_no_punch ) {\n\t\t\t\t\t\t$this.toggle_button.setValue( 'manual' );\n\t\t\t\t\t}\n\t\t\t\t\t$this.reSetURL();\n\t\t\t\t\tdoNext();\n\t\t\t\t} else {\n\t\t\t\t\t$this.getPunchMode() === 'punch' && ( $this.is_auto_switch = false );\n\t\t\t\t\tdoNext();\n\t\t\t\t}\n\t\t\t} );\n\t\t} else {\n\t\t\tdoNext();\n\t\t}\n\n\t\tfunction doNext() {\n\t\t\t$this.pay_period_data = $this.full_timesheet_data.pay_period_data;\n\t\t\t$this.pay_period_map = $this.full_timesheet_data.timesheet_dates.pay_period_date_map;\n\t\t\t$this.timesheet_verify_data = $this.full_timesheet_data.timesheet_verify_data;\n\t\t\t$this.grid_div = $( $this.el ).find( '.timesheet-grid-div' );\n\t\t\t// Punch grid\n\t\t\t$this.buildTimeSheetsColumns();\n\t\t\t$this.buildTimeSheetGrid();\n\t\t\tif ( $this.getPunchMode() === 'manual' ) {\n\t\t\t\t$this.$( '.timesheet-punch-grid-wrapper' ).hide();\n\t\t\t\t$this.$( '.manual-timesheet-inside-editor-div' ).show();\n\t\t\t\tif ( !$this.editor ) {\n\t\t\t\t\t$this.buildManualTimeSheetsColumns();\n\t\t\t\t\t$this.buildManualTimeSheetGrid();\n\t\t\t\t\t$this.initInsideEditorData();\n\t\t\t\t} else {\n\t\t\t\t\t$this.buildManualTimeSheetsColumns();\n\t\t\t\t\t$this.initInsideEditorData();\n\t\t\t\t}\n\t\t\t\tif ( !$this.show_job_ui || Global.getProductEdition() < 20 ) {\n\t\t\t\t\t$this.$( '.job-header' ).hide();\n\t\t\t\t}\n\t\t\t\tif ( !$this.show_job_item_ui || Global.getProductEdition() < 20 ) {\n\t\t\t\t\t$this.$( '.job-item-header' ).hide();\n\t\t\t\t}\n\t\t\t\tif ( !$this.show_punch_tag_ui || Global.getProductEdition() < 20 ) {\n\t\t\t\t\t$this.$( '.punch-tag-header' ).hide();\n\t\t\t\t}\n\t\t\t\tif ( !$this.show_branch_ui ) {\n\t\t\t\t\t$this.$( '.branch-header' ).hide();\n\t\t\t\t}\n\t\t\t\tif ( !$this.show_department_ui ) {\n\t\t\t\t\t$this.$( '.department-header' ).hide();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t$this.$( '.timesheet-punch-grid-wrapper' ).show();\n\t\t\t\t$this.$( '.manual-timesheet-inside-editor-div' ).hide();\n\t\t\t}\n\n\t\t\t$this.buildAccumulatedGrid();\n\n\t\t\t$this.buildSubGrid( 'branch_grid', 'Branch' );\n\t\t\t$this.buildSubGrid( 'department_grid', 'Department' );\n\t\t\t$this.buildSubGrid( 'job_grid', 'Job' );\n\t\t\t$this.buildSubGrid( 'job_item_grid', 'Task' );\n\t\t\t$this.buildSubGrid( 'punch_tag_grid', 'Tags' );\n\t\t\t$this.buildSubGrid( 'premium_grid', 'Premium' );\n\t\t\t$this.buildAbsenceGrid();\n\t\t\t$this.showGridBorders();\n\t\t\t$this.buildAccumulatedTotalGrid();\n\t\t\t$this.buildPunchNoteGrid();\n\t\t\t$this.buildVerificationGrid();\n\t\t\t//TimeSheet grid\n\t\t\t$this.buildTimeSheetSource(); //Create punch data\n\t\t\t$this.buildTimeSheetRequests();\n\t\t\t//Accumulated Time, Branch, Department, Job, Task, Pre\n\t\t\t$this.buildSubGridsSource();\n\t\t\t//Make sure exception rows goes after Lanuch and break create from buildSubGridsSource\n\t\t\t$this.buildTimeSheetExceptions();\n\t\t\t//Absence Grid source\n\t\t\t$this.buildAbsenceSource(); //Create punch data\n\t\t\t//Show punch notes in a grid\n\t\t\t$this.buildPunchNoteGridSource();\n\t\t\t//buildVerificationGridSource\n\t\t\t$this.buildVerificationGridSource();\n\t\t\t$this.setGridExpendButton( 'accumulated_time_grid', $.i18n._( 'Accumulated Time' ) );\n\t\t\t$this.setGridExpendButton( 'branch_grid', $.i18n._( 'Branch' ) );\n\t\t\t$this.setGridExpendButton( 'department_grid', $.i18n._( 'Department' ) );\n\t\t\t$this.setGridExpendButton( 'job_grid', $.i18n._( 'Job' ) );\n\t\t\t$this.setGridExpendButton( 'job_item_grid', $.i18n._( 'Task' ) );\n\t\t\t$this.setGridExpendButton( 'punch_tag_grid', $.i18n._( 'Tags' ) );\n\t\t\t$this.setGridExpendButton( 'premium_grid', $.i18n._( 'Premium' ) );\n\t\t\t$this.setGridExpendButton( 'absence_grid', $.i18n._( 'Absence' ) );\n\t\t\t$this.setGridExpendButton( 'punch_note_grid', $.i18n._( 'Punch Notes' ) );\n\n\t\t\tif ( $this.getPunchMode() === 'punch' ) {\n\t\t\t\t//var selection = $this.grid.getSelection(); //provides memory of selected cells\n\t\t\t\t$this.grid.setData( $this.timesheet_data_source, true );\n\t\t\t\t//$this.grid.setTimesheetSelection( selection ); //resets selection after refreshing grid data -- currently broken, see setTimesheetSelection() for details.\n\t\t\t}\n\n\t\t\tif ( typeof $this.accumulated_time_grid.setData == 'function' ) {\n\t\t\t\t$this.accumulated_time_grid.setData( $this.accumulated_time_source, false );\n\t\t\t}\n\n\t\t\tif ( typeof $this.branch_grid.setData == 'function' ) {\n\t\t\t\t$this.branch_grid.setData( $this.branch_source, false );\n\t\t\t}\n\n\t\t\tif ( typeof $this.department_grid.setData == 'function' ) {\n\t\t\t\t$this.department_grid.setData( $this.department_source, false );\n\t\t\t}\n\n\t\t\tif ( typeof $this.job_grid.setData == 'function' ) {\n\t\t\t\t$this.job_grid.setData( $this.job_source, false );\n\t\t\t}\n\n\t\t\tif ( typeof $this.job_item_grid.setData == 'function' ) {\n\t\t\t\t$this.job_item_grid.setData( $this.job_item_source, false );\n\t\t\t}\n\n\t\t\tif ( typeof $this.punch_tag_grid.setData == 'function' ) {\n\t\t\t\t$this.punch_tag_grid.setData( $this.punch_tag_source, false );\n\t\t\t}\n\n\t\t\tif ( typeof $this.premium_grid.setData == 'function' ) {\n\t\t\t\t$this.premium_grid.setData( $this.premium_source, false );\n\t\t\t}\n\n\t\t\tif ( $this.absence_grid ) {\n\t\t\t\t$this.absence_grid.setData( $this.absence_source, false );\n\t\t\t}\n\n\t\t\tif ( $this.accumulated_total_grid_source.length === 0 ) {\n\t\t\t\t$this.accumulated_total_grid_source.push();\n\t\t\t}\n\n\t\t\t$this.accumulated_total_grid.setData( $this.accumulated_total_grid_source, false );\n\t\t\t$this.punch_note_grid.setData( $this.punch_note_grid_source, false );\n\t\t\t$this.verification_grid.setData( $this.verification_grid_source, false );\n\n\t\t\t$this.setGridSize();\n\n\t\t\t$this.setTimeSheetGridPayPeriodHeaders();\n\t\t\t$this.setTimeSheetGridHolidayHeaders();\n\t\t\t$this.highLightSelectDay();\n\t\t\t$this.autoOpenEditViewIfNecessary();\n\t\t\t$this.setScrollPosition();\n\t\t\t$this.initRightClickMenu();\n\t\t\t$this.initRightClickMenu( RightClickMenuType.ABSENCE_GRID );\n\t\t\t$this.showWarningMessageIfAny();\n\t\t\t$this.setPunchModeClass();\n\n\t\t\tif ( $this.getPunchMode() != 'punch' ) {\n\t\t\t\tvar cols = $this.getManualPayPeriodDefaultTrColspan();\n\t\t\t\tfor ( var i = 0; i < cols; i++ ) {\n\t\t\t\t\t$( '.sub-grid td:nth-child(' + i + ')' ).css( 'border-right', 'none' );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tsearchDone() {\n\t\t$( '.button-rotate' ).removeClass( 'button-rotate' ); //the rotate icon from search panel\n\n\t\tTTPromise.resolve( 'init', 'init' );\n\t\tTTPromise.wait();\n\n\t\t//Check this.setGridSize() where we resize the grids if a scrollbar is detected to ensure all grids remain the same width after each one is built.\n\t\t// TTPromise.wait( null, null, function () {\n\t\t//  //This was triggering JS exception: Permission denied to access property \"apply\" -- Seems like its no longer needed either.\n\t\t// \t$( window ).trigger( 'resize' );\n\t\t// } );\n\t}\n\n\tshowWarningMessageIfAny() {\n\t\tvar $this = this;\n\t\tvar timesheet_grid_div;\n\t\tvar warning_bar = $( this.el ).find( '.timesheet-warning-title-bar' );\n\t\twarning_bar.length > 0 && warning_bar.remove() && ( warning_bar = $( this.el ).find( '.timesheet-warning-title-bar' ) );\n\t\tif ( this.getPunchMode() === 'punch' ) {\n\t\t\ttimesheet_grid_div = $( this.el ).find( '#gbox_' + this.ui_id + '_grid' );\n\t\t} else {\n\t\t\ttimesheet_grid_div = $( this.el ).find( '.manual-timesheet-inside-editor-div' );\n\t\t}\n\n\t\tvar user = this.getSelectEmployee( true );\n\t\tvar user_pay_period_check = payPeriodCheck( user );\n\n\t\t//There seems to be a race condition here where if the server hasn't returned all the user data for the dropdown box (due to being slow/including many columns), \"user.id\" will exist, but no other object properties will.\n\t\t//  This could trigger the below error message(s) to show when they shouldn't. So now we check to make sure there is at least more than 1 object property, and we check that the object properties actually exist and are actually blank, as compared to just checking that they don't exist previously.\n\t\tif ( Global.isObject( user ) && Object.keys( user ).length > 1 && ( ( user.hasOwnProperty( 'pay_period_schedule_id' ) && user.pay_period_schedule_id == '' ) || ( user.hasOwnProperty( 'policy_group_id' ) && user.policy_group_id == '' ) || user_pay_period_check == false ) ) {\n\t\t\twarning_bar = $( '<div class=\\'timesheet-warning-title-bar\\'><span class=\\'p-message\\'></span><span class=\\'g-message\\'></span><span class=\\'pp-message\\'></span></div>' );\n\t\t\twarning_bar.insertBefore( timesheet_grid_div );\n\n\t\t\tif ( user.hasOwnProperty( 'pay_period_schedule_id' ) && user.pay_period_schedule_id == '' ) { //!user.pay_period_schedule_id\n\t\t\t\twarning_bar.children().eq( 0 ).html( $.i18n._( 'WARNING: Employee is not assigned to a pay period schedule.' ) );\n\t\t\t} else {\n\t\t\t\twarning_bar.children().eq( 0 ).html( '' );\n\t\t\t}\n\t\t\tif ( user.hasOwnProperty( 'policy_group_id' ) && user.policy_group_id == '' ) { //!user.policy_group_id\n\t\t\t\twarning_bar.children().eq( 1 ).html( $.i18n._( 'WARNING: Employee is not assigned to a policy group.' ) );\n\t\t\t} else {\n\t\t\t\twarning_bar.children().eq( 1 ).html( '' );\n\t\t\t}\n\n\t\t\tif ( user_pay_period_check == false ) {\n\t\t\t\twarning_bar.children().eq( 2 ).html( $.i18n._( 'WARNING: Employee has day(s) not assigned to a pay period. Please perform a pay period import to correct.' ) );\n\t\t\t} else {\n\t\t\t\twarning_bar.children().eq( 2 ).html( '' );\n\t\t\t}\n\n\t\t} else {\n\t\t\tif ( warning_bar.length > 0 ) {\n\t\t\t\twarning_bar.remove();\n\t\t\t}\n\t\t}\n\n\t\tfunction payPeriodCheck( user ) {\n\t\t\tif ( $this.start_date ) {\n\t\t\t\tvar hire_date = user.hire_date;\n\t\t\t\tvar termination_date = user.termination_date;\n\n\t\t\t\tfor ( var i = 0; i < 7; i++ ) {\n\t\t\t\t\tvar select_date = new Date( new Date( $this.start_date.getTime() ).setDate( $this.start_date.getDate() + i ) );\n\t\t\t\t\tvar select_date_str = select_date.format();\n\n\t\t\t\t\t//Error: Uncaught TypeError: Cannot read property 'getTime' of null in interface/html5/index.php?user_name=dustin#!m=TimeSheet&date=20151214&user_id=38599&show_wage=0 line 2947\n\t\t\t\t\tif ( !select_date ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( select_date.getTime() < new Date().getTime() && !$this.getPayPeriod( select_date_str ) &&\n\t\t\t\t\t\t( !hire_date || select_date.getTime() >= Global.strToDate( hire_date ).getTime() ) &&\n\t\t\t\t\t\t( !termination_date || select_date.getTime() <= Global.strToDate( termination_date ).getTime() ) ) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tautoOpenEditViewIfNecessary() {\n\t\t//Auto open edit view. Should set in IndexController\n\n\t\tswitch ( LocalCacheData.current_doing_context_action ) {\n\t\t\tcase 'edit':\n\t\t\t\tif ( LocalCacheData.edit_id_for_next_open_view ) {\n\t\t\t\t\tthis.onEditClick( LocalCacheData.edit_id_for_next_open_view, LocalCacheData.getAllURLArgs().t );\n\t\t\t\t\tLocalCacheData.edit_id_for_next_open_view = null;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\tcase 'view':\n\t\t\t\tif ( LocalCacheData.edit_id_for_next_open_view ) {\n\t\t\t\t\tthis.onViewClick( LocalCacheData.edit_id_for_next_open_view, LocalCacheData.getAllURLArgs().t );\n\t\t\t\t\tLocalCacheData.edit_id_for_next_open_view = null;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'new':\n\t\t\t\tif ( !this.edit_view ) {\n\t\t\t\t\tif ( LocalCacheData.getAllURLArgs().t === 'absence' ) {\n\t\t\t\t\t\tthis.absence_model = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.absence_model = false;\n\t\t\t\t\t}\n\t\t\t\t\tthis.onAddClick();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\n\t\tthis.autoOpenEditOnlyViewIfNecessary();\n\t}\n\n\tgetWeekDayIndexFromADate( date_string ) {\n\n\t\tvar len = this.timesheet_columns.length;\n\n\t\tfor ( var i = 1; i < len; i++ ) {\n\t\t\tvar column = this.timesheet_columns[i];\n\t\t\tvar column_date_string = Global.strToDate( column.index, this.full_format ).format();\n\t\t\tif ( date_string === column_date_string ) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\n\t\treturn 7;\n\t}\n\n\tsetAccumulatedTotalGridPayPeriodHeaders( width ) {\n\t\tvar table = $( $( this.el ).find( 'table[aria-labelledby=gbox_' + this.ui_id + '_accumulated_total_grid]' )[0] );\n\t\ttable.width( width );\n\n\t\tvar new_tr = $( '<tr class=\"group-column-tr\"  role=\"rowheader\"  >' +\n\t\t\t'</tr>' );\n\n\t\tvar new_th = $( '<th class=\"group-column-th\" >' +\n\t\t\t'<span class=\"group-column-label\"></span>' +\n\t\t\t'</th>' );\n\n\t\tvar default_th = new_th.clone();\n\n\t\tvar week_th = new_th.clone();\n\n\t\tvar pay_period_th = new_th.clone();\n\n\t\tweek_th.children( 0 ).text( $.i18n._( 'Week' ) );\n\t\tpay_period_th.children( 0 ).text( $.i18n._( 'Pay Period' ) );\n\n\t\tnew_tr.append( default_th );\n\t\tnew_tr.append( week_th );\n\t\tnew_tr.append( pay_period_th );\n\n\t\ttable.find( '.rowheader' ).remove();\n\t\ttable.find( 'thead' ).prepend( new_tr );\n\t}\n\n\tsetTimeSheetGridHolidayHeaders() {\n\t\tvar holiday_name_map = {};\n\t\tif ( this.full_timesheet_data && this.full_timesheet_data.holiday_data ) {\n\t\t\tfor ( var i = 0; i < this.full_timesheet_data.holiday_data.length; i++ ) {\n\t\t\t\tvar item = this.full_timesheet_data.holiday_data[i];\n\t\t\t\tvar standard_date = Global.strToDate( item.date_stamp ).format( this.full_format );\n\n\t\t\t\tvar cell = $( '<div></div>' );\n\t\t\t\tif ( this.getPunchMode() === 'manual' ) {\n\t\t\t\t\tcell = $( '.manual_grid_day_' + standard_date );\n\t\t\t\t} else {\n\t\t\t\t\tcell = $( 'div[id=\"jqgh_' + this.ui_id + '_grid_' + standard_date + '\"]' );\n\t\t\t\t}\n\n\t\t\t\tif ( cell && cell.text().indexOf( item.name ) == -1 && !holiday_name_map[item.name] ) {\n\t\t\t\t\tcell.html( cell.html() + '<br>' + Global.htmlEncode( item.name ) );\n\t\t\t\t\tholiday_name_map[item.name] = true;\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\t}\n\n\tgetManualPayPeriodDefaultTrColspan() {\n\t\tvar colspan = 2;\n\t\tif ( this.show_branch_ui ) {\n\t\t\tcolspan++;\n\t\t}\n\n\t\tif ( this.show_department_ui ) {\n\t\t\tcolspan++;\n\t\t}\n\n\t\tif ( this.show_job_ui ) {\n\t\t\tcolspan++;\n\t\t}\n\n\t\tif ( this.show_job_item_ui ) {\n\t\t\tcolspan++;\n\t\t}\n\n\t\tif ( this.show_punch_tag_ui ) {\n\t\t\tcolspan++;\n\t\t}\n\n\t\treturn colspan;\n\t}\n\n\tsetTimeSheetGridPayPeriodHeaders() {\n\t\tvar $this = this;\n\t\tvar table,\n\t\t\tsize_tr;\n\t\tif ( this.getPunchMode() === 'punch' ) {\n\t\t\ttable = $( $( this.el ).find( 'table[aria-labelledby=gbox_' + this.ui_id + '_grid]' )[0] );\n\t\t\tsize_tr = $( '<tr class=\"size-tr\" role=\"row\" style=\"height: 0;\" >' + '</tr>' );\n\t\t} else {\n\t\t\ttable = this.$( '.grid-inside-editor-render' );\n\t\t\ttable.find( '.group-column-tr' ).remove();\n\t\t\tsize_tr = $( this.$( '.grid-inside-editor-render' ).find( 'tr' )[0] );\n\t\t}\n\n\t\ttable.find( '.group-column-tr' ).remove();\n\n\t\tvar new_tr = $( '<tr class=\"group-column-tr pay_period_header_row\"></tr>' );\n\t\tvar new_th = $( '<th class=\"group-column-th\"><span class=\"group-column-label\"></span></th>' );\n\t\tvar current_trs = table.find( '.ui-jqgrid-labels' );\n\n\t\t// createSizeColumns was added in 2014. When manual timesheet mode was added in 2016, things were refactored and this should have been pulled out.\n\t\t// Leaving it in causes  header row solumns to be out of alignment with the timesheet punch grid by a few pixels.\n\t\tif ( this.getPunchMode() === 'punch' ) {\n\t\t\tcreateSizeColumns();\n\t\t\tsize_tr.insertBefore( table.find( 'thead .ui-jqgrid-labels' ) );\n\t\t}\n\n\t\tvar default_th;\n\t\tif ( Object.keys( this.pay_period_data ).length === 0 ) {\n\t\t\tdefault_th = new_th.clone();\n\t\t\tnew_tr.append( default_th );\n\t\t\tif ( this.getPunchMode() === 'manual' ) {\n\t\t\t\tdefault_th.attr( 'colspan', this.getManualPayPeriodDefaultTrColspan() );\n\t\t\t}\n\t\t\tcreateNoPayPeriodColumns( 7 );\n\t\t\tnew_tr.insertAfter( size_tr );\n\t\t\treturn;\n\t\t}\n\t\tvar current_end_index = 0;\n\t\tvar last_pay_period_id;\n\t\tvar column_number = 0;\n\t\tvar pay_period;\n\t\tvar map_array = [];\n\t\tfor ( var y = 0; y < this.column_maps.length; y++ ) {\n\t\t\tvar p_key = this.column_maps[y];\n\t\t\tvar pay_period_id = this.pay_period_map[p_key];\n\t\t\tif ( !pay_period_id ) {\n\t\t\t\tpay_period_id = -1;\n\t\t\t}\n\t\t\tmap_array.push( { date: p_key, time_stamp: Global.strToDate( p_key ).getTime(), id: pay_period_id } );\n\t\t}\n\n\t\tdefault_th = new_th.clone();\n\t\tnew_tr.append( default_th );\n\t\tif ( this.getPunchMode() === 'manual' ) {\n\t\t\tdefault_th.attr( 'colspan', this.getManualPayPeriodDefaultTrColspan() );\n\t\t}\n\t\tfor ( var j = 0; j < map_array.length; j++ ) {\n\t\t\tif ( !last_pay_period_id ) {\n\t\t\t\tlast_pay_period_id = map_array[j].id;\n\t\t\t\tpay_period = getPayPeriod( map_array[j].id );\n\t\t\t\tcolumn_number = column_number + 1;\n\t\t\t} else if ( last_pay_period_id !== map_array[j].id ) {\n\t\t\t\tif ( pay_period ) {\n\t\t\t\t\tcreateTh();\n\t\t\t\t} else {\n\t\t\t\t\tcreateNoPayPeriodColumns( column_number );\n\t\t\t\t}\n\t\t\t\tlast_pay_period_id = map_array[j].id;\n\t\t\t\tpay_period = getPayPeriod( map_array[j].id );\n\t\t\t\tcolumn_number = 1;\n\n\t\t\t} else {\n\t\t\t\tcolumn_number = column_number + 1;\n\t\t\t}\n\t\t\tif ( j === map_array.length - 1 && column_number > 0 ) {\n\t\t\t\tif ( pay_period ) {\n\t\t\t\t\tcreateTh();\n\t\t\t\t} else {\n\t\t\t\t\tcreateNoPayPeriodColumns( column_number );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t$( '.pay_period_header_row' ).remove();\n\t\tnew_tr.insertAfter( size_tr );\n\n\t\tfunction createTh() {\n\t\t\tvar start_date = Global.strToDate( pay_period.start_date ).format();\n\t\t\tvar end_date = Global.strToDate( pay_period.end_date ).format();\n\t\t\tvar colspan = column_number;\n\t\t\tvar pay_period_th = new_th.clone();\n\t\t\tpay_period_th.children( 0 ).text( start_date + ' ' + $.i18n._( 'to' ) + ' ' + end_date );\n\t\t\tpay_period_th.attr( 'colspan', colspan );\n\t\t\t/* jshint ignore:start */\n\t\t\tif ( pay_period.status_id == 12 || pay_period.status_id == 20 ) {\n\t\t\t\tpay_period_th.css( 'background', '#EC0000' );\n\t\t\t} else if ( pay_period.status_id == 30 ) {\n\t\t\t\tpay_period_th.css( 'background', '#EED614' );\n\t\t\t}\n\t\t\t/* jshint ignore:end */\n\t\t\tnew_tr.append( pay_period_th );\n\t\t}\n\n\t\tfunction getPayPeriod( id ) {\n\t\t\tfor ( var key in $this.pay_period_data ) {\n\t\t\t\tvar pay_period = $this.pay_period_data[key];\n\t\t\t\tif ( pay_period.id === id ) {\n\t\t\t\t\treturn pay_period;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction createNoPayPeriodColumns( end_index ) {\n\t\t\tvar pay_period_th = new_th.clone();\n\t\t\tpay_period_th.addClass( 'no_pay_period_header' );\n\t\t\tpay_period_th.children( 0 ).text( $.i18n._( 'No Pay Period' ) );\n\t\t\tpay_period_th.attr( 'colspan', end_index );\n\t\t\tnew_tr.append( pay_period_th );\n\t\t}\n\n\t\tfunction createSizeColumns() {\n\t\t\tvar len = current_trs.children().length;\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\tvar th = $( '<td class=\"\"  role=\"gridcell\">' + '</td>' );\n\t\t\t\tvar item = current_trs.children().eq( i );\n\t\t\t\t//th.width( item.width() );\n\t\t\t\tth.height( 0 );\n\t\t\t\tth.css( 'width', item.css( 'width' ) );\n\t\t\t\tsize_tr.append( th );\n\t\t\t}\n\n\t\t}\n\t}\n\n\tsetPayPeriodHeaderSize() {\n\n\t\tvar table = $( $( this.el ).find( 'table[aria-labelledby=gbox_' + this.ui_id + '_grid]' ) );\n\t\tvar size_tr = table.find( '.size-tr' );\n\n\t\tif ( size_tr.length === 0 ) {\n\t\t\treturn;\n\t\t}\n\t\t/**\n\t\t * #2353 - tiemsheet sizing fix\n\t\t *\n\t\t * Due to firefox reporting th widths incorrectly via the $.width() function, the sizes must come from the (tr.jqgfirstrow) of the data table\n\t\t * firefox also refuses to set the width of the first row of th's via the $.width() function, so we ned to ship the css values directly into the inline css using the css function\n\t\t */\n\t\tvar current_trs = table.find( '.jqgfirstrow' );\n\t\tvar len = current_trs.children().length;\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar item = current_trs.children().eq( i );\n\t\t\tsize_tr.children().eq( i ).css( 'width', item.css( 'width' ) );\n\t\t}\n\t}\n\n\thighLightSelectDay( e ) {\n\n\t\tif ( this.highlight_header ) {\n\t\t\tthis.highlight_header.removeClass( 'highlight-header' );\n\t\t}\n\n\t\t//Error: TypeError: select_date is null in interface/html5/framework/jquery.min.js?v=9.0.1-20151022-081724 line 2 > eval line 3214\n\t\tvar select_date = Global.strToDate( this.start_date_picker.getValue() );\n\t\t!select_date && ( select_date = new Date() );\n\n\t\tif ( this.getPunchMode() === 'punch' ) {\n\t\t\tselect_date = select_date.format( this.full_format );\n\t\t\tthis.highlight_header = $( '#' + this.ui_id + '_grid_' + select_date );\n\t\t} else {\n\t\t\tselect_date = select_date.format( this.full_format );\n\t\t\tthis.highlight_header = $( '.manual_grid_day_' + select_date );\n\t\t}\n\n\t\tthis.highlight_header.addClass( 'highlight-header' );\n\n\t\tif ( $( '.timesheet-grid tr td.ui-state-highlight' ).length == 0 && !e ) {\n\t\t\t$( $( '.timesheet-grid tr#1 td' )[this.highlight_header.index()] ).addClass( 'ui-state-highlight' );\n\t\t\t$( $( '.timesheet-grid tr#1 td' )[this.highlight_header.index()] ).click(); //trigger grid selection events\n\t\t}\n\t}\n\n\t/* jshint ignore:start */\n\tsetGridHeight( grid_id ) {\n\t\tvar grid = this.grid_dic[grid_id];\n\t\tif ( grid.grid ) {\n\t\t\tgrid = grid.grid;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t\tvar len = 0;\n\n\t\tswitch ( grid_id ) {\n\t\t\tcase 'timesheet_grid':\n\t\t\t\tlen = this.timesheet_data_source.length;\n\t\t\t\tbreak;\n\t\t\tcase 'accumulated_time_grid':\n\t\t\t\tlen = this.accumulated_time_source.length;\n\t\t\t\tbreak;\n\t\t\tcase 'branch_grid':\n\t\t\t\tlen = this.branch_source.length;\n\t\t\t\tbreak;\n\t\t\tcase 'department_grid':\n\t\t\t\tlen = this.department_source.length;\n\t\t\t\tbreak;\n\t\t\tcase 'job_grid':\n\t\t\t\tlen = this.job_source.length;\n\t\t\t\tbreak;\n\t\t\tcase 'job_item_grid':\n\t\t\t\tlen = this.job_item_source.length;\n\t\t\t\tbreak;\n\t\t\tcase 'punch_tag_grid':\n\t\t\t\tlen = this.punch_tag_source.length;\n\t\t\t\tbreak;\n\t\t\tcase 'premium_grid':\n\t\t\t\tlen = this.premium_source.length;\n\t\t\t\tbreak;\n\t\t\tcase 'absence_grid':\n\t\t\t\tlen = this.absence_source.length;\n\t\t\t\tbreak;\n\t\t\tcase 'accumulated_total_grid':\n\t\t\t\tlen = this.accumulated_total_grid_source.length;\n\t\t\t\tbreak;\n\t\t\tcase 'punch_note_grid':\n\t\t\t\tlen = this.punch_note_grid_source.length;\n\t\t\t\tbreak;\n\t\t\tcase 'verification_grid':\n\t\t\t\tlen = this.verification_grid_source.length;\n\t\t}\n\n\t\tif ( LocalCacheData.timesheet_sub_grid_expended_dic[grid_id] === true ||\n\t\t\tgrid_id === 'timesheet_grid' ||\n\t\t\tgrid_id === 'accumulated_total_grid' ||\n\t\t\tgrid_id === 'punch_note_grid' ||\n\t\t\tgrid_id === 'verification_grid' ) {\n\t\t\tgrid.setGridHeight( len * 22 );\n\t\t} else {\n\t\t\tgrid.setGridHeight( 0 );\n\n\t\t}\n\n\t\t//dont't show scroll bar of grid\n\t\tgrid.parent().parent().css( 'overflow', 'hidden' );\n\n\t\t//Do not show grid if no data in it\n\t\tif ( len === 0 && grid_id !== 'accumulated_time_grid' && grid_id !== 'verification_grid' ) {\n\t\t\tgrid.parent().parent().parent().parent().hide();\n\t\t} else {\n\t\t\tgrid.parent().parent().parent().parent().show();\n\t\t}\n\t}\n\n\t/* jshint ignore:end */\n\n\tsetGridColumnsWidth() {\n\t\t//BaseViewController definition of this function resizes the main grid of a view, but we want to resize all grids in this view.\n\t\t//The BaseViewController version would be called when expanding/collapsing the search panel causing only the main grid to be resized and be misaligned with the others.\n\t\tthis.setGridSize();\n\t}\n\n\tsetGridSize() {\n\t\tvar $this = this;\n\n\t\t//TTGrid backwards compatible.\n\t\tvar $grid = this.grid;\n\t\tif ( $grid.grid ) {\n\t\t\t$grid = $grid.grid;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t\tif ( ( !$grid || !$( $grid ).is( ':visible' ) ) && ( !this.editor || !this.editor.is( ':visible' ) ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor ( var key in this.grid_dic ) {\n\t\t\tif ( key != 'punch_note_grid' && key != 'accumulated_total_grid' && key != 'verification_grid' ) {\n\t\t\t\tif ( !this.grid_dic[key].grid ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tvar grid = this.grid_dic[key].grid;\n\t\t\t\tthis.setGridHeight( key ); //Set height before width so scrollbar doesn't affect things.\n\t\t\t\tgrid.setGridWidth( this.getTimeSheetWidth() );\n\t\t\t}\n\t\t}\n\n\t\tthis.setGridHeight( 'accumulated_total_grid' ); //can't set height on this grid. until we fix what's wrong with it.\n\n\t\tthis.grid_dic['verification_grid'].grid.setGridWidth( 400 );\n\t\tthis.setGridHeight( 'verification_grid' );\n\n\t\tthis.setPunchNoteGridWidth( this.grid_dic['punch_note_grid'].grid );\n\t\tthis.setGridHeight( 'punch_note_grid' ); //can't set height on this grid. until we fix what's wrong with it.\n\n\t\tlet scroll_height = document.body.scrollHeight;\n\n\t\tlet height = scroll_height;\n\n\t\tlet timesheet_grid = document.querySelector( 'div.timesheet-grid-div' );\n\t\tif ( timesheet_grid ) { //Issue #3060 - JavaScript exceptions of trying to read getBoundingClientRect of null elements.\n\t\t\theight -= timesheet_grid.getBoundingClientRect().top;\n\t\t}\n\t\tlet context_border = document.querySelector( 'div.context-border' );\n\t\tif ( context_border ) { //Issue #3060 - JavaScript exceptions of trying to read getBoundingClientRect of null elements.\n\t\t\theight -= ( scroll_height - document.querySelector( 'div.context-border' ).getBoundingClientRect().bottom );\n\t\t}\n\t\theight -= 10; //Manual fine tuning to fit better.\n\n\t\tthis.grid_div.height( height );\n\t\tthis.grid.setGridWidth( this.getTimeSheetWidth() );\n\n\t\tthis.setPayPeriodHeaderSize();\n\n\t\tif ( this.getPunchMode() === 'manual' ) {\n\t\t\t$this.setManualTimeSheetGridSize();\n\t\t}\n\n\t\t//Because a scrollbar has appeared in the middle of resizing the top grids compared to the bottom grid, the page may have expanded to show the scrollbar and we may need to resize the grids (width) again to take into account.\n\t\t//This is manifested itself in misaligned columns between the two grids.\n\t\tif ( Global.isVerticalScrollBarRequired( $('.timesheet-grid-div')[0] ) ) {\n\t\t\tfor ( var key in this.grid_dic ) {\n\t\t\t\tif ( key != 'punch_note_grid' && key != 'accumulated_total_grid' && key != 'verification_grid' ) {\n\t\t\t\t\tif ( !this.grid_dic[key].grid ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tvar grid = this.grid_dic[key].grid;\n\t\t\t\t\tgrid.setGridWidth( this.getTimeSheetWidth() );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tsetPunchNoteGridWidth( grid ) {\n\t\tif ( !grid ) {\n\t\t\tif ( !this.punch_note_grid || !this.punch_note_grid.grid ) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tgrid = this.punch_note_grid.grid;\n\t\t}\n\n\t\tvar grid_width = grid.width();\n\n\t\tvar accumulated_grid_width = ( this.accumulated_total_grid && this.accumulated_total_grid.grid ) ? this.accumulated_total_grid.getWidth() : 0;\n\t\tvar verification_grid_width = ( this.verification_grid && this.verification_grid.grid ) ? this.verification_grid.getWidth() : 0;\n\n\t\tif ( this.verification_grid_source.length !== 0 ) {\n\t\t\tgrid_width = Math.floor( this.getTimeSheetWidth() - ( accumulated_grid_width + verification_grid_width + 7 ) );\n\t\t} else {\n\t\t\tgrid_width = Math.floor( this.getTimeSheetWidth() - ( 7 + accumulated_grid_width ) );\n\t\t}\n\t\tgrid_width = Math.abs( grid_width );\n\n\t\tif ( grid_width != grid.width() ) {\n\t\t\t//Debug.Text(\"Setting punch note grid width to \" + grid_width, 'TimesheetViewConroller.js', 'TimesheetViewConroller', 'setGridHeight', 10);\n\t\t\tgrid.setGridWidth( grid_width );\n\t\t\t$( 'td.notes_grid_td_container' ).css( 'width', '100%' );\n\t\t}\n\t}\n\n\tsetManualTimeSheetGridSize() {\n\t\tvar tr = $( this.accumulated_time_grid.grid.find( 'tr:first-child' )[0] );\n\t\tvar manual_grid_tr = $( this.editor.find( 'table' ).find( 'tr:first-child' )[0] );\n\t\tvar index = 0;\n\t\tfor ( var i = 0, m = manual_grid_tr.children().length; i < m; i++ ) {\n\t\t\tvar td = $( manual_grid_tr.children()[i] );\n\t\t\tif ( !td.is( ':visible' ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t$( td ).css( 'width', $( tr.children()[index] ).css( 'width' ) );\n\t\t\tindex++;\n\t\t}\n\n\t\tthis.editor.width( this.accumulated_time_grid.getGridWidth() );\n\t}\n\n\tonCellFormat( cell_value, related_data, row ) {\n\t\tvar col_model = related_data.colModel;\n\t\tvar row_id = related_data.rowid;\n\t\tvar content_div = $( '<div class=\\'punch-content-div\\'></div>' );\n\t\tvar punch_info;\n\t\tvar ex_span;\n\t\tvar i;\n\t\tvar time_span_prefix;\n\t\tvar time_span;\n\t\tvar time_span_suffix;\n\t\tvar punch;\n\t\tvar break_span;\n\t\tvar related_punch;\n\t\tvar exception;\n\t\tvar len;\n\t\tvar text;\n\t\tvar ex;\n\t\tvar data;\n\t\tvar currency = LocalCacheData.getCurrentCurrencySymbol();\n\n\t\tcell_value = Global.decodeCellValue( cell_value );\n\t\tif ( related_data.pos === 0 ) {\n\t\t\tif ( row.type === TimeSheetViewController.TOTAL_ROW ) {\n\t\t\t\tpunch_info = $( '<span class=\\'total\\' style=\\'font-size: 11px\\'></span>' );\n\t\t\t\tif ( Global.isSet( cell_value ) ) {\n\t\t\t\t\tpunch_info.text( cell_value );\n\t\t\t\t} else {\n\t\t\t\t\tpunch_info.text( '' );\n\t\t\t\t}\n\n\t\t\t\treturn punch_info.get( 0 ).outerHTML;\n\t\t\t} else if ( row.type === TimeSheetViewController.REGULAR_ROW ) {\n\t\t\t\tpunch_info = $( '<span class=\\'top-line-span\\' style=\\'font-size: 11px\\'></span>' );\n\t\t\t\tif ( Global.isSet( cell_value ) ) {\n\t\t\t\t\tpunch_info.text( cell_value );\n\t\t\t\t} else {\n\t\t\t\t\tpunch_info.text( '' );\n\t\t\t\t}\n\t\t\t\treturn punch_info.get( 0 ).outerHTML;\n\t\t\t}\n\n\t\t\treturn cell_value;\n\t\t}\n\n\t\tif ( row.type === TimeSheetViewController.PUNCH_ROW ) {\n\t\t\tpunch = row[col_model.name + '_data'];\n\t\t\trelated_punch = row[col_model.name + '_related_data'];\n\t\t\ttime_span_prefix = $( '<span class=\\'punch-prefix\\'></span>' );\n\t\t\ttime_span = $( '<span class=\\'punch-time\\'></span>' );\n\t\t\ttime_span_suffix = $( '<span class=\\'punch-suffix\\'></span>' );\n\t\t\tbreak_span = $( '<span class=\\'punch-break\\'></span>' );\n\n\t\t\tif ( punch ) {\n\t\t\t\texception = punch.exception;\n\n\t\t\t\tvar break_label = '';\n\t\t\t\tvar break_label_title = '';\n\t\t\t\tif ( punch.type_id == 20 ) {\n\t\t\t\t\tbreak_label = 'L';\n\t\t\t\t\tbreak_label_title = $.i18n._('Lunch');\n\t\t\t\t} else if ( punch.type_id == 30 ) {\n\t\t\t\t\tbreak_label = 'B';\n\t\t\t\t\tbreak_label_title = $.i18n._('Break');\n\t\t\t\t}\n\n\t\t\t\tvar label_prefix = '';\n\t\t\t\tvar label_prefix_title = '';\n\t\t\t\tif ( punch.note != '' ) {\n\t\t\t\t\tlabel_prefix = '*';\n\t\t\t\t\tlabel_prefix_title = $.i18n._('Note') +': '+ punch.note;\n\t\t\t\t}\n\n\t\t\t\tvar label_suffix = '';\n\t\t\t\tvar label_suffix_title = '';\n\t\t\t\tif ( punch.id == TTUUID.not_exist_id ) {\n\t\t\t\t\tlabel_suffix = 'P';\n\t\t\t\t\tlabel_suffix_title = 'P='+ $.i18n._('Processing');\n\t\t\t\t}\n\t\t\t\tif ( punch.latitude && punch.latitude != 0 && punch.longitude && punch.longitude != 0 ) {\n\t\t\t\t\tlabel_suffix = 'G';\n\t\t\t\t\tlabel_suffix_title = 'G='+ $.i18n._('GPS Location');\n\t\t\t\t}\n\n\t\t\t\tif ( punch.has_image ) {\n\t\t\t\t\tlabel_suffix = label_suffix + 'F';\n\t\t\t\t\tlabel_suffix_title = label_suffix_title + ' F='+ $.i18n._('Punch Image');\n\t\t\t\t}\n\n\t\t\t\tif ( punch.tainted ) {\n\t\t\t\t\ttime_span.css( 'color', '#ff0000' );\n\t\t\t\t}\n\t\t\t} else if ( related_punch ) {\n\t\t\t\texception = related_punch.exception;\n\t\t\t}\n\n\t\t\tif ( Global.isSet( label_prefix ) && label_prefix != '' ) {\n\t\t\t\ttime_span_prefix.text( label_prefix );\n\t\t\t\ttime_span_prefix.attr( 'title', label_prefix_title );\n\t\t\t\tcontent_div.append( time_span_prefix );\n\t\t\t}\n\n\t\t\tif ( Global.isSet( cell_value ) ) {\n\t\t\t\ttime_span.text( cell_value );\n\t\t\t} else {\n\t\t\t\ttime_span.text( '' );\n\t\t\t}\n\t\t\tcontent_div.append( time_span );\n\n\t\t\tif ( Global.isSet( label_suffix ) && label_suffix != ''  ) {\n\t\t\t\ttime_span_suffix.text( label_suffix );\n\t\t\t\ttime_span_suffix.attr( 'title', label_suffix_title );\n\t\t\t\tcontent_div.append( time_span_suffix );\n\t\t\t}\n\n\t\t\tif ( Global.isSet( break_label ) && break_label != '' ) {\n\t\t\t\tbreak_span.text( break_label );\n\t\t\t\tbreak_span.attr( 'title', break_label_title );\n\t\t\t\tcontent_div.append( break_span );\n\t\t\t}\n\n\t\t\tif ( exception ) {\n\t\t\t\tlen = exception.length;\n\t\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\t\tex = exception[i];\n\t\t\t\t\tex_span = $( '<span class=\\'punch-exceptions\\'></span>' );\n\t\t\t\t\tex_span.css( 'color', ex.exception_color );\n\t\t\t\t\tex_span.text( ex.exception_policy_type_id );\n\t\t\t\t\tex_span.attr( 'title', ex.exception_policy_type_id + ': ' + ex.exception_policy_type );\n\t\t\t\t\tcontent_div.prepend( ex_span );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// ex_span = $( '<span class=\\'punch-exceptions\\'></span>' );\n\t\t\t\t// ex_span.text( ' ' );\n\t\t\t\t// content_div.prepend( ex_span );\n\t\t\t}\n\n\t\t} else if ( row.type === TimeSheetViewController.EXCEPTION_ROW ) {\n\t\t\texception = row[col_model.name + '_exceptions'];\n\n\t\t\tif ( Global.isSet( exception ) ) {\n\t\t\t\tlen = exception.length;\n\t\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\t\tex = exception[i];\n\t\t\t\t\tex_span = $( '<span class=\\'punch-exceptions-center\\'></span>' );\n\t\t\t\t\tex_span.css( 'color', ex.exception_color );\n\t\t\t\t\tex_span.text( ex.exception_policy_type_id );\n\t\t\t\t\tex_span.attr( 'title', ex.exception_policy_type_id + ': ' + ex.exception_policy_type );\n\n\t\t\t\t\tcontent_div.append( ex_span );\n\t\t\t\t}\n\t\t\t}\n\n\t\t} else if ( row.type === TimeSheetViewController.REQUEST_ROW ) {\n\t\t\ttime_span = $( '<span class=\\'request\\'></span>' );\n\t\t\tif ( Global.isSet( cell_value ) ) {\n\t\t\t\ttime_span.text( cell_value );\n\t\t\t\ttime_span.attr( 'title', createRequestToolTip( row[col_model.name + '_request'] ) );\n\t\t\t} else {\n\t\t\t\ttime_span.text( '' );\n\t\t\t}\n\t\t\tcontent_div.prepend( time_span );\n\n\t\t} else if ( row.type === TimeSheetViewController.TOTAL_ROW ) {\n\n\t\t\tdata = row[col_model.name + '_data'];\n\t\t\ttime_span = $( '<span class=\\'total\\'></span>' );\n\n\t\t\tif ( Global.isSet( cell_value ) ) {\n\n\t\t\t\tif ( data ) {\n\n\t\t\t\t\tif ( data.hasOwnProperty( 'note' ) && data.note ) {\n\t\t\t\t\t\tcell_value = '*' + cell_value;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( time_sheet_view_controller.wage_btn && time_sheet_view_controller.wage_btn.getValue( true ) && data.hasOwnProperty( 'total_time_amount' ) && data.total_time_amount && data.hasOwnProperty( 'hourly_rate' ) && data.hourly_rate ) {\n\t\t\t\t\t\ttime_span = $( '<div class=\\'total--bold time-sheet-view-wage-container\\'></div>' );\n\t\t\t\t\t\tcell_value = '<span class=\"time-sheet-view-wage-hour-rate\">' + currency + Global.MoneyRound( data.hourly_rate ) + '/hr @</span>' +\n\t\t\t\t\t\t\t'<span class=\"time-sheet-view-wage-value\">' + cell_value +\n\t\t\t\t\t\t\t'</span ><span class=\"time-sheet-view-wage-amount\" >= ' + currency + Global.MoneyRound( data.total_time_amount ) +\n\t\t\t\t\t\t\t'</span>';\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( time_sheet_view_controller.getPunchMode() === 'punch' ) {\n\t\t\t\t\t\tif ( data.hasOwnProperty( 'override' ) && data.override === true ) {\n\t\t\t\t\t\t\ttime_span.addClass( 'absence-override' );\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif ( !data.override && row.key === 'worked_time' ) {\n\t\t\t\t\t\t\ttime_span.addClass( 'absence-override' );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttime_span.html( cell_value );\n\n\t\t\t} else {\n\t\t\t\ttime_span.text( '' );\n\t\t\t}\n\t\t\tcontent_div.prepend( time_span );\n\n\t\t} else if ( row.type === TimeSheetViewController.REGULAR_ROW ) {\n\n\t\t\tcontent_div.addClass( 'top-line' );\n\n\t\t\tdata = row[col_model.name + '_data'];\n\n\t\t\ttime_span = $( '<span></span>' );\n\t\t\tif ( Global.isSet( cell_value ) ) {\n\n\t\t\t\tif ( data ) {\n\n\t\t\t\t\tif ( data.hasOwnProperty( 'note' ) && data.note ) {\n\t\t\t\t\t\tcell_value = '*' + cell_value;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( time_sheet_view_controller.wage_btn && time_sheet_view_controller.wage_btn.getValue( true ) && data.hasOwnProperty( 'total_time_amount' ) && data.total_time_amount && data.hasOwnProperty( 'hourly_rate' ) && data.hourly_rate ) {\n\t\t\t\t\t\ttime_span = $( '<div class=\\'time-sheet-view-wage-container\\'></div>' );\n\t\t\t\t\t\tcell_value = '<span class=\"time-sheet-view-wage-hour-rate\">' + currency + Global.MoneyRound( data.hourly_rate ) + '/hr @</span>' +\n\t\t\t\t\t\t\t'<span class=\"time-sheet-view-wage-value\">' + cell_value +\n\t\t\t\t\t\t\t'</span ><span class=\"time-sheet-view-wage-amount\" >= ' + currency + Global.MoneyRound( data.total_time_amount ) +\n\t\t\t\t\t\t\t'</span>';\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( data.hasOwnProperty( 'override' ) && data.override === true ) {\n\t\t\t\t\t\ttime_span.addClass( 'absence-override' );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttime_span.html( cell_value );\n\t\t\t} else {\n\t\t\t\ttime_span.text( '' );\n\t\t\t}\n\t\t\tcontent_div.prepend( time_span );\n\n\t\t} else if ( row.type === TimeSheetViewController.ABSENCE_ROW ) {\n\n\t\t\tvar absence = row[col_model.name + '_data'];\n\t\t\ttime_span = $( '<span></span>' );\n\n\t\t\tif ( Global.isSet( cell_value ) ) {\n\n\t\t\t\tif ( absence ) {\n\n\t\t\t\t\tif ( absence.override === true ) {\n\t\t\t\t\t\ttime_span.addClass( 'absence-override' );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( absence.note ) {\n\t\t\t\t\t\tcell_value = '*' + cell_value;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttime_span.text( cell_value );\n\n\t\t\t} else {\n\t\t\t\ttime_span.text( '' );\n\t\t\t}\n\t\t\tcontent_div.prepend( time_span );\n\n\t\t} else if ( row.type === TimeSheetViewController.ACCUMULATED_TIME_ROW ||\n\t\t\trow.type === TimeSheetViewController.PREMIUM_ROW ) {\n\t\t\tdata = row[col_model.name + '_data'];\n\t\t\ttime_span = $( '<span  style=\\'width: 100%\\'></span>' );\n\n\t\t\tif ( Global.isSet( cell_value ) ) {\n\n\t\t\t\tif ( data ) {\n\n\t\t\t\t\tif ( data.hasOwnProperty( 'note' ) && data.note ) {\n\t\t\t\t\t\tcell_value = '*' + cell_value;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( time_sheet_view_controller.wage_btn && time_sheet_view_controller.wage_btn.getValue( true ) && data.hasOwnProperty( 'total_time_amount' ) && data.total_time_amount && data.hasOwnProperty( 'hourly_rate' ) && data.hourly_rate ) {\n\t\t\t\t\t\ttime_span = $( '<div class=\\'time-sheet-view-wage-container\\'></div>' );\n\t\t\t\t\t\tcell_value = '<span class=\"time-sheet-view-wage-hour-rate\">' + currency + Global.MoneyRound( data.hourly_rate ) + '/hr @</span>' +\n\t\t\t\t\t\t\t'<span class=\"time-sheet-view-wage-value\">' + cell_value +\n\t\t\t\t\t\t\t'</span ><span class=\"time-sheet-view-wage-amount\" >= ' + currency + Global.MoneyRound( data.total_time_amount ) +\n\t\t\t\t\t\t\t'</span>';\n\t\t\t\t\t}\n\t\t\t\t\tif ( data.hasOwnProperty( 'override' ) && data.override === true ) {\n\t\t\t\t\t\ttime_span.addClass( 'absence-override' );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttime_span.html( cell_value );\n\n\t\t\t} else {\n\t\t\t\ttime_span.text( '' );\n\t\t\t}\n\t\t\tcontent_div.prepend( time_span );\n\n\t\t} else {\n\t\t\ttime_span = $( '<span class=\\'punch-time\\'></span>' );\n\t\t\tif ( Global.isSet( cell_value ) ) {\n\t\t\t\ttime_span.text( cell_value );\n\t\t\t} else {\n\t\t\t\ttime_span.text( '' );\n\t\t\t}\n\t\t\tcontent_div.prepend( time_span );\n\t\t}\n\n\t\tfunction createRequestToolTip( value ) {\n\t\t\tvar label;\n\t\t\tif ( Global.isArray( value ) ) {\n\t\t\t\tlabel = calDAndA( value );\n\t\t\t} else if ( Global.isObject( value ) && value.status ) {\n\t\t\t\tlabel = value.status; //Use the label directly from the API.\n\t\t\t}\n\n\t\t\tfunction calDAndA( array ) {\n\t\t\t\tvar len = array.length;\n\t\t\t\tvar a = 0;\n\t\t\t\tvar d = 0;\n\t\t\t\tvar p = 0;\n\t\t\t\tvar label = '';\n\t\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\t\tvar item = array[i];\n\t\t\t\t\tif ( item.status_id == 50 ) {\n\t\t\t\t\t\ta = a + 1;\n\t\t\t\t\t} else if ( item.status_id == 55 ) {\n\t\t\t\t\t\td = d + 1;\n\t\t\t\t\t} else if ( item.status_id == 30 ) {\n\t\t\t\t\t\tp = p + 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif ( a > 0 ) {\n\t\t\t\t\tlabel += ' ' + $.i18n._( 'Authorized' ) + ': ' + a;\n\t\t\t\t}\n\t\t\t\tif ( p > 0 ) {\n\t\t\t\t\tlabel += ' ' + $.i18n._( 'Pending' ) + ': ' + p;\n\t\t\t\t}\n\t\t\t\tif ( d > 0 ) {\n\t\t\t\t\tlabel += ' ' + $.i18n._( 'Declined' ) + ': ' + d;\n\t\t\t\t}\n\t\t\t\treturn label;\n\t\t\t}\n\n\t\t\treturn label;\n\t\t}\n\n\t\tcontent_div.addClass( 'date-column' );\n\n\t\treturn content_div.get( 0 ).outerHTML;\n\t}\n\n\tonSelectRow( grid_id, row_id, target ) {\n\t\tvar $this = this;\n\t\tvar row_tr = $( target ).find( 'tr#' + row_id );\n\t\t$this.timesheet_grid.grid.find( 'td.ui-state-highlight' ).removeClass( 'ui-state-highlight' );\n\t\tvar cells_array = [];\n\t\tvar len = 0;\n\t\tif ( grid_id === 'timesheet_grid' ) {\n\t\t\tcells_array = $this.select_cells_Array;\n\t\t\tlen = $this.select_cells_Array.length;\n\t\t\t$this.absence_select_cells_Array = [];\n\t\t} else if ( grid_id === 'absence_grid' ) {\n\t\t\tcells_array = $this.absence_select_cells_Array;\n\t\t\tlen = $this.absence_select_cells_Array.length;\n\t\t\t$this.select_cells_Array = [];\n\t\t} else if ( grid_id === 'accumulated_grid' ) {\n\t\t\tcells_array = $this.accumulated_time_cells_array;\n\t\t\tlen = $this.accumulated_time_cells_array.length;\n\t\t} else if ( grid_id === 'premium_grid' ) {\n\t\t\tcells_array = $this.premium_cells_array;\n\t\t\tlen = $this.premium_cells_array.length;\n\t\t}\n\t\tthis.select_punches_array = [];\n\t\t/* jshint ignore:start */\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar info = cells_array[i];\n\t\t\trow_tr = $( target ).find( '#' + info.row_id );\n\t\t\tvar cell_td = $( row_tr.find( 'td' )[info.cell_index] );\n\t\t\tcell_td.addClass( 'ui-state-highlight' ).attr( 'aria-selected', true );\n\n\t\t\tif ( info.punch && info.punch.id ) {\n\n\t\t\t\tif ( Global.isSet( info.punch.time_stamp ) ) { //date + time number\n\t\t\t\t\tvar date = Global.strToDate( info.punch.punch_date ).format( 'MM-DD-YYYY' );\n\t\t\t\t\tvar date_time = date + ' ' + info.punch.punch_time;\n\t\t\t\t\tinfo.punch.time_stamp_num = Global.strToDateTime( date_time ).getTime();\n\t\t\t\t} else {\n\t\t\t\t\tinfo.punch.time_stamp_num = info.time_stamp_num; //Uer time_stamp_num from cell select setting, a date number\n\t\t\t\t}\n\t\t\t\tthis.select_punches_array.push( info.punch );\n\t\t\t\tthis.select_punches_array.sort( function( a, b ) {\n\t\t\t\t\treturn Global.compare( a, b, 'time_stamp_num' );\n\t\t\t\t} );\n\t\t\t}\n\t\t}\n\t\t/* jshint ignore:end */\n\t}\n\n\tunsetSelectedCells( grid_id ) {\n\t\tif ( grid_id == 'accumulated_grid' ) {\n\t\t\tgrid_id = 'accumulated_time_grid';\n\t\t}\n\n\t\tif ( this.last_clicked_grid_id && grid_id != this.last_clicked_grid_id ) {\n\t\t\t//Use window setTimeout to make this code asyncchronous for speed, it's the fastest way.\n\t\t\t//web worker : 850ms\n\t\t\t//inline code : 700ms\n\t\t\t//setTimeout: 400ms\n\t\t\twindow.setTimeout( function( t, n ) {\n\t\t\t\tt.grid_dic[n].grid.trigger( 'reloadGrid' );\n\t\t\t}, 0, this, this.last_clicked_grid_id );\n\t\t}\n\n\t\t//this.setDefaultMenu();\n\t\tthis.last_clicked_grid_id = grid_id;\n\t}\n\n\tgetRowData( grid_id, row_id ) {\n\t\tvar $this = this;\n\n\t\tvar row_data = null;\n\n\t\tif ( grid_id === 'absence_grid' ) {\n\t\t\trow_data = $this.absence_grid.getGridParam( 'data' );\n\t\t} else if ( grid_id === 'accumulated_grid' ) {\n\t\t\trow_data = $this.accumulated_time_grid.getGridParam( 'data' );\n\t\t} else if ( grid_id === 'premium_grid' ) {\n\t\t\trow_data = $this.premium_grid.getGridParam( 'data' );\n\t\t} else { //Should be: timesheet_grid\n\t\t\trow_data = $this.grid.getGridParam( 'data' );\n\t\t}\n\n\t\tvar row = false;\n\n\t\tfor ( var i in row_data ) {\n\t\t\tif ( row_data[i].id == row_id ) {\n\t\t\t\trow = row_data[i];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn row;\n\t}\n\n\tonCellSelect( grid_id, row_id, cell_index, cell_val, target, e ) {\n\t\t$( '#ribbon_view_container .context-menu:visible a' ).click();\n\n\t\tif ( cell_index < 0 ) {\n\t\t\tthis.unsetSelectedCells( grid_id );\n\t\t\tthis.setDefaultMenu();\n\t\t\treturn true; //continue default processing.\n\t\t}\n\n\t\tcell_index = parseInt( cell_index );\n\n\t\tvar $this = this;\n\t\tvar row;\n\t\tvar colModel;\n\t\tvar data_field;\n\t\tvar punch;\n\t\tvar related_punch;\n\t\tvar cells_array = [];\n\t\tvar date;\n\n\t\tif ( !this.is_edit && !this.is_add ) {\n\t\t\t$this.absence_model = false;\n\t\t}\n\n\t\trow = $this.getRowData( grid_id, row_id );\n\n\t\tif ( grid_id === 'timesheet_grid' ) {\n\t\t\tcells_array = $this.select_cells_Array;\n\n\t\t\tcolModel = $this.grid.getGridParam( 'colModel' );\n\t\t\tdata_field = colModel[cell_index].name;\n\n\t\t\tif ( row.type === TimeSheetViewController.REQUEST_ROW ) {\n\t\t\t\tvar filter = { filter_data: {} };\n\t\t\t\tfilter.filter_data.user_id = this.getSelectEmployee();\n\t\t\t\tfilter.filter_data.start_date = $this.full_timesheet_data.timesheet_dates.start_display_date;\n\t\t\t\tfilter.filter_data.end_date = $this.full_timesheet_data.timesheet_dates.end_display_date;\n\t\t\t\tfilter.filter_data.id = [];\n\n\t\t\t\t$this.unsetSelectedCells( grid_id );\n\t\t\t\tvar pending_requests = 0;\n\t\t\t\tvar total_requests = 0;\n\t\t\t\tif ( Global.isArray( row[data_field + '_request'] ) ) {\n\t\t\t\t\tfor ( var n in row[data_field + '_request'] ) {\n\t\t\t\t\t\tvar obj = row[data_field + '_request'][n];\n\t\t\t\t\t\tfilter.filter_data.id.push( obj.id );\n\t\t\t\t\t\tif ( obj.status == $.i18n._( 'PENDING' ) ) {\n\t\t\t\t\t\t\tpending_requests += 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttotal_requests += 1;\n\t\t\t\t\t}\n\t\t\t\t} else if ( row[data_field + '_request'] ) {\n\t\t\t\t\t//is object;\n\t\t\t\t\tfilter.filter_data.id.push( row[data_field + '_request'].id );\n\t\t\t\t\tif ( row[data_field + '_request'].status == $.i18n._( 'PENDING' ) ) {\n\t\t\t\t\t\tpending_requests = 1;\n\t\t\t\t\t}\n\t\t\t\t\ttotal_requests = 1;\n\t\t\t\t} else {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tGlobal.addViewTab( this.viewId, $.i18n._( 'TimeSheet' ), window.location.href );\n\n\t\t\t\tif ( total_requests > 0 ) {\n\t\t\t\t\tif ( this.getSelectEmployee() != LocalCacheData.getLoginUser().id && pending_requests > 0 ) {\n\t\t\t\t\t\t//Handle cases where an administrator who can see all requests might click on a pending request cell and want to be taken to MyAccount -> Requests\n\t\t\t\t\t\t//rather than MyAccount -> Request Authorization, which wouldn't show anything.\n\t\t\t\t\t\tif ( this.ownerOrChildPermissionValidate( 'request', 'view_child', filter.filter_data.id ) ) {\n\t\t\t\t\t\t\tIndexViewController.goToView( 'RequestAuthorization', filter );\n\t\t\t\t\t\t} else if ( this.viewPermissionValidate( 'request', filter.filter_data.id ) ) {\n\t\t\t\t\t\t\tIndexViewController.goToView( 'Request', filter );\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//If the request isn't pending, then go to MyAccount -> Requests, and MyAccount -> Request Authorization wouldn't show anything.\n\t\t\t\t\t\tif ( this.viewPermissionValidate( 'request', filter.filter_data.id ) ) {\n\t\t\t\t\t\t\tIndexViewController.goToView( 'Request', filter );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( row && row[data_field + '_data'] ) {\n\t\t\t\tpunch = row[data_field + '_data'];\n\t\t\t} else {\n\t\t\t\tpunch = null;\n\t\t\t}\n\n\t\t\trelated_punch = row[data_field + '_related_data'];\n\n\t\t\tdate = Global.strToDate( data_field, this.full_format );\n\t\t} else if ( grid_id === 'absence_grid' ) {\n\t\t\tcells_array = $this.absence_select_cells_Array;\n\n\t\t\tcolModel = $this.absence_grid.getGridParam( 'colModel' );\n\n\t\t\tdata_field = colModel[cell_index].name;\n\n\t\t\t// Error: Uncaught TypeError: Cannot read property 'punch_info_data' of undefined in interface/html5/#!m=TimeSheet&date=20151220&user_id=null&show_wage=0 line 3761\n\t\t\tif ( row ) {\n\t\t\t\tpunch = row[data_field + '_data'];\n\t\t\t} else {\n\t\t\t\tpunch = null;\n\t\t\t}\n\n\t\t\tdate = Global.strToDate( data_field, this.full_format );\n\n\t\t\t$this.absence_model = true;\n\t\t} else if ( grid_id === 'accumulated_grid' ) {\n\n\t\t\tcells_array = $this.accumulated_time_cells_array;\n\n\t\t\tcolModel = $this.accumulated_time_grid.getGridParam( 'colModel' );\n\n\t\t\tdata_field = colModel[cell_index].name;\n\n\t\t\tif ( row ) {\n\t\t\t\tpunch = row[data_field + '_data'];\n\t\t\t} else {\n\t\t\t\tpunch = null;\n\t\t\t}\n\n\t\t\tdate = Global.strToDate( data_field, this.full_format );\n\t\t} else if ( grid_id === 'premium_grid' ) {\n\n\t\t\tcells_array = $this.premium_cells_array;\n\n\t\t\tcolModel = $this.premium_grid.getGridParam( 'colModel' );\n\n\t\t\tdata_field = colModel[cell_index].name;\n\n\t\t\tif ( row ) {\n\t\t\t\tpunch = row[data_field + '_data'];\n\t\t\t} else {\n\t\t\t\tpunch = null;\n\t\t\t}\n\n\t\t\tdate = Global.strToDate( data_field, this.full_format );\n\n\t\t}\n\n\t\tif ( Global.isValidDate( date ) == false ) {\n\t\t\t$this.unsetSelectedCells( grid_id );\n\t\t\treturn false;\n\t\t}\n\n\t\tvar info;\n\t\tvar row_tr;\n\t\tvar cell_td;\n\t\t//Clean all select cells first\n\t\tfor ( var i = 0; i < cells_array.length; i++ ) {\n\t\t\tinfo = cells_array[i];\n\t\t\trow_tr = $( target ).find( '#' + info.row_id );\n\t\t\t$( target ).find( 'tr' ).removeClass( 'ui-state-highlight' );\n\t\t\tcell_td = $( row_tr.find( 'td' )[info.cell_index] );\n\t\t\tcell_td.removeClass( 'ui-state-highlight' ).attr( 'aria-selected', false );\n\t\t}\n\n\t\tvar date_str;\n\t\tvar time_stamp_num;\n\n\t\t// Add multiple selectiend_display_date if click cell and hold ctrl or command\n\t\tif ( e.ctrlKey || e.metaKey ) {\n\t\t\tvar found = false;\n\t\t\tfor ( var i = 0; i < cells_array.length; i++ ) {\n\t\t\t\tinfo = cells_array[i];\n\t\t\t\tif ( row_id == info.row_id && cell_index == info.cell_index ) {\n\t\t\t\t\tcells_array.splice( i, 1 );\n\t\t\t\t\tfound = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdate_str = date.format();\n\t\t\ttime_stamp_num = date.getTime();\n\n\t\t\tif ( !found ) {\n\t\t\t\tif ( grid_id === 'timesheet_grid' ) {\n\t\t\t\t\tpunch = getCellPunch( row_id, cell_index );\n\t\t\t\t\trelated_punch = getRelatedPunch( row_id, cell_index );\n\t\t\t\t\tcells_array.push( {\n\t\t\t\t\t\trow_id: row_id,\n\t\t\t\t\t\tcell_index: cell_index,\n\t\t\t\t\t\tcell_val: cell_val,\n\t\t\t\t\t\tpunch: punch,\n\t\t\t\t\t\trelated_punch: related_punch,\n\t\t\t\t\t\tdate: date_str,\n\t\t\t\t\t\ttime_stamp_num: time_stamp_num\n\t\t\t\t\t} );\n\n\t\t\t\t\t$this.select_cells_Array = cells_array;\n\t\t\t\t\t$this.select_cells_Array.sort( Global.m_sort_by( ['time_stamp_num', 'row_id'] ) );\n\t\t\t\t} else if ( grid_id === 'absence_grid' ) {\n\t\t\t\t\tcells_array.push( {\n\t\t\t\t\t\trow_id: row_id,\n\t\t\t\t\t\tcell_index: cell_index,\n\t\t\t\t\t\tcell_val: cell_val,\n\t\t\t\t\t\tpunch: punch,\n\t\t\t\t\t\tdate: date_str,\n\t\t\t\t\t\ttime_stamp_num: time_stamp_num,\n\t\t\t\t\t\tsrc_object_id: ( row.punch_info_id ) ? row.punch_info_id : null,\n\t\t\t\t\t} );\n\n\t\t\t\t\t$this.absence_select_cells_Array = cells_array;\n\t\t\t\t\t$this.absence_select_cells_Array.sort( Global.m_sort_by( ['time_stamp_num', 'row_id'] ) );\n\t\t\t\t} else if ( grid_id === 'premium_grid' ) {\n\t\t\t\t\tcells_array = [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\trow_id: row_id,\n\t\t\t\t\t\t\tcell_index: cell_index,\n\t\t\t\t\t\t\tcell_val: cell_val,\n\t\t\t\t\t\t\tdate: date_str,\n\t\t\t\t\t\t\ttime_stamp_num: time_stamp_num\n\t\t\t\t\t\t}\n\t\t\t\t\t];\n\n\t\t\t\t\t$this.premium_cells_array = cells_array;\n\t\t\t\t}\n\t\t\t}\n\t\t} else if ( e.shiftKey && cells_array.length > 0 ) {\n\t\t\tvar status_id = cells_array[0].status_id; //Get status_id of first punch so we can defaults to that on new.\n\n\t\t\t//cell.row_id is numeric here.\n\t\t\tvar start_row_index = parseInt( cells_array[0].row_id );\n\t\t\tvar start_cell_index = parseInt( cells_array[0].cell_index );\n\n\t\t\tvar end_row_index = row_id;\n\t\t\tvar end_cell_index = cell_index;\n\n\t\t\tif ( start_row_index > end_row_index ) {\n\t\t\t\tvar tmp_row_index = start_row_index;\n\t\t\t\tstart_row_index = end_row_index;\n\t\t\t\tend_row_index = tmp_row_index;\n\t\t\t}\n\n\t\t\tif ( start_cell_index > end_cell_index ) {\n\t\t\t\tvar tmp_cell_index = start_cell_index;\n\t\t\t\tstart_cell_index = end_cell_index;\n\t\t\t\tend_cell_index = tmp_cell_index;\n\t\t\t}\n\n\t\t\tfor ( var i = 0; i < cells_array.length; i++ ) {\n\t\t\t\tinfo = cells_array[i];\n\n\t\t\t\tvar tmp_row_id = parseInt( info.row_id );\n\n\t\t\t\tif ( tmp_row_id < start_row_index ) {\n\t\t\t\t\tstart_row_index = tmp_row_id;\n\t\t\t\t}\n\t\t\t\tif ( tmp_row_id > end_row_index ) {\n\t\t\t\t\tend_row_index = tmp_row_id;\n\t\t\t\t}\n\n\t\t\t\tif ( info.cell_index < start_cell_index ) {\n\t\t\t\t\tstart_cell_index = info.cell_index;\n\t\t\t\t}\n\t\t\t\tif ( info.cell_index > end_cell_index ) {\n\t\t\t\t\tend_cell_index = info.cell_index;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//If the click is inside the existing selection, truncate the existing selection to the click.\n\t\t\t//Check in ScheduleViewController.js for related change\n\t\t\t//Make sure to check for cells_array and cells_array.length before the other checks or when the user clicks into another grid while holding shift, it throws the following error:\n\t\t\t//Cannot read property 'cell_index' of undefined\n\n\t\t\tvar uppermost_row_index = parseInt( cells_array[0].row_id );\n\t\t\tvar lowermost_row_index = parseInt( cells_array[cells_array.length - 1].row_id );\n\t\t\tvar leftmost_cell_index = parseInt( cells_array[0].cell_index );\n\t\t\tvar rightmost_cell_index = parseInt( cells_array[cells_array.length - 1].cell_index );\n\n\t\t\tif ( cells_array && cells_array.length > 0 && cells_array[cells_array.length - 1].cell_index && cells_array[0].cell_index\n\t\t\t\t&& rightmost_cell_index >= cell_index\n\t\t\t\t&& leftmost_cell_index <= cell_index\n\t\t\t\t&& lowermost_row_index >= row_id\n\t\t\t\t&& uppermost_row_index <= row_id ) {\n\t\t\t\tend_row_index = row_id;\n\t\t\t\tend_cell_index = cell_index;\n\t\t\t}\n\n\t\t\t//build cells_array\n\t\t\tcells_array = [];\n\n\t\t\tfor ( var i = start_row_index; i <= end_row_index; i++ ) {\n\t\t\t\tvar r_index = i;\n\t\t\t\tfor ( var j = start_cell_index; j <= end_cell_index; j++ ) {\n\t\t\t\t\tvar c_index = j;\n\n\t\t\t\t\trow_tr = $( target ).find( 'tr#' + r_index );\n\n\t\t\t\t\tcell_td = $( row_tr.find( 'td' )[c_index] );\n\n\t\t\t\t\tcell_val = cell_td[0].outerHTML;\n\n\t\t\t\t\tif ( grid_id === 'timesheet_grid' ) {\n\t\t\t\t\t\tpunch = getCellPunch( i, j );\n\t\t\t\t\t\trelated_punch = getRelatedPunch( i, j );\n\n\t\t\t\t\t\tdate = Global.strToDate( data_field, this.full_format );\n\n\t\t\t\t\t\tdate_str = date.format();\n\t\t\t\t\t\ttime_stamp_num = date.getTime();\n\n\t\t\t\t\t\tcells_array.push( {\n\t\t\t\t\t\t\trow_id: r_index,\n\t\t\t\t\t\t\tcell_index: c_index,\n\t\t\t\t\t\t\tcell_val: cell_val,\n\t\t\t\t\t\t\tpunch: punch,\n\t\t\t\t\t\t\tstatus_id: status_id,\n\t\t\t\t\t\t\trelated_punch: related_punch,\n\t\t\t\t\t\t\tdate: date_str,\n\t\t\t\t\t\t\ttime_stamp_num: time_stamp_num\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t} else if ( grid_id === 'absence_grid' ) {\n\t\t\t\t\t\tcolModel = $this.absence_grid.getGridParam( 'colModel' );\n\n\t\t\t\t\t\tdata_field = colModel[c_index].name;\n\n\t\t\t\t\t\tpunch = row[data_field + '_data'];\n\n\t\t\t\t\t\tdate = Global.strToDate( data_field, this.full_format );\n\n\t\t\t\t\t\tdate_str = date.format();\n\t\t\t\t\t\ttime_stamp_num = date.getTime();\n\n\t\t\t\t\t\tcells_array.push( {\n\t\t\t\t\t\t\trow_id: r_index, //see bug #2149\n\t\t\t\t\t\t\t//row_id: r_index.toString(),\n\t\t\t\t\t\t\tcell_index: c_index,\n\t\t\t\t\t\t\tcell_val: cell_val,\n\t\t\t\t\t\t\tpunch: punch,\n\t\t\t\t\t\t\tdate: date_str,\n\t\t\t\t\t\t\ttime_stamp_num: time_stamp_num,\n\t\t\t\t\t\t\tsrc_object_id: ( row.punch_info_id ) ? row.punch_info_id : null,\n\t\t\t\t\t\t} );\n\t\t\t\t\t} else if ( grid_id === 'accumulated_grid' ) {\n\t\t\t\t\t\tcells_array = [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\trow_id: row_id,\n\t\t\t\t\t\t\t\tcell_index: cell_index,\n\t\t\t\t\t\t\t\tcell_val: cell_val,\n\t\t\t\t\t\t\t\tdate: date_str,\n\t\t\t\t\t\t\t\ttime_stamp_num: time_stamp_num\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t];\n\t\t\t\t\t\t$this.accumulated_time_cells_array = cells_array;\n\t\t\t\t\t} else if ( grid_id === 'premium_grid' ) {\n\t\t\t\t\t\tcells_array = [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\trow_id: row_id,\n\t\t\t\t\t\t\t\tcell_index: cell_index,\n\t\t\t\t\t\t\t\tcell_val: cell_val,\n\t\t\t\t\t\t\t\tdate: date_str,\n\t\t\t\t\t\t\t\ttime_stamp_num: time_stamp_num\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t];\n\t\t\t\t\t\t$this.premium_cells_array = cells_array;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( grid_id === 'timesheet_grid' ) {\n\t\t\t\t$this.select_cells_Array = cells_array;\n\t\t\t\t$this.select_cells_Array.sort( Global.m_sort_by( ['time_stamp_num', 'row_id'] ) );\n\t\t\t} else if ( grid_id === 'absence_grid' ) {\n\t\t\t\t$this.absence_select_cells_Array = cells_array;\n\t\t\t\t$this.absence_select_cells_Array.sort( Global.m_sort_by( ['time_stamp_num', 'row_id'] ) );\n\t\t\t} else if ( grid_id === 'accumulated_grid' ) {\n\t\t\t\t$this.accumulated_time_cells_array = cells_array;\n\t\t\t\t$this.accumulated_time_cells_array.sort( Global.m_sort_by( ['time_stamp_num', 'row_id'] ) );\n\t\t\t} else if ( grid_id === 'premium_grid' ) {\n\t\t\t\t$this.premium_cells_array = cells_array;\n\t\t\t\t$this.premium_cells_array.sort( Global.m_sort_by( ['time_stamp_num', 'row_id'] ) );\n\t\t\t}\n\n\t\t} else {\n\t\t\tdate_str = date ? date.format() : '';\n\t\t\ttime_stamp_num = date ? date.getTime() : 0;\n\t\t\tif ( grid_id === 'timesheet_grid' ) {\n\t\t\t\t//get the punch data.\n\t\t\t\tpunch = getCellPunch( row_id, cell_index );\n\n\t\t\t\trelated_punch = getRelatedPunch( row_id, cell_index );\n\n\t\t\t\tcells_array = [\n\t\t\t\t\t{\n\t\t\t\t\t\trow_id: row_id,\n\t\t\t\t\t\tcell_index: cell_index,\n\t\t\t\t\t\tcell_val: cell_val,\n\t\t\t\t\t\tpunch: punch,\n\t\t\t\t\t\tstatus_id: ( row && row.status_id ) ? row.status_id : null,\n\t\t\t\t\t\trelated_punch: related_punch,\n\t\t\t\t\t\tdate: date_str,\n\t\t\t\t\t\ttime_stamp_num: time_stamp_num\n\t\t\t\t\t}\n\t\t\t\t];\n\n\t\t\t\t$this.select_cells_Array = cells_array;\n\t\t\t} else if ( grid_id === 'absence_grid' ) {\n\t\t\t\tcells_array = [\n\t\t\t\t\t{\n\t\t\t\t\t\trow_id: row_id,\n\t\t\t\t\t\tcell_index: cell_index,\n\t\t\t\t\t\tcell_val: cell_val,\n\t\t\t\t\t\tpunch: punch,\n\t\t\t\t\t\tdate: date_str,\n\t\t\t\t\t\ttime_stamp_num: time_stamp_num,\n\t\t\t\t\t\tsrc_object_id: ( row.punch_info_id ) ? row.punch_info_id : null,\n\t\t\t\t\t}\n\t\t\t\t];\n\n\t\t\t\t$this.absence_select_cells_Array = cells_array;\n\t\t\t} else if ( grid_id === 'accumulated_grid' ) {\n\t\t\t\tcells_array = [\n\t\t\t\t\t{\n\t\t\t\t\t\trow_id: row_id,\n\t\t\t\t\t\tcell_index: cell_index,\n\t\t\t\t\t\tcell_val: cell_val,\n\t\t\t\t\t\tdate: date_str,\n\t\t\t\t\t\ttime_stamp_num: time_stamp_num\n\t\t\t\t\t}\n\t\t\t\t];\n\n\t\t\t\t$this.accumulated_time_cells_array = cells_array;\n\t\t\t} else if ( grid_id === 'premium_grid' ) {\n\t\t\t\tcells_array = [\n\t\t\t\t\t{\n\t\t\t\t\t\trow_id: row_id,\n\t\t\t\t\t\tcell_index: cell_index,\n\t\t\t\t\t\tcell_val: cell_val,\n\t\t\t\t\t\tdate: date_str,\n\t\t\t\t\t\ttime_stamp_num: time_stamp_num\n\t\t\t\t\t}\n\t\t\t\t];\n\n\t\t\t\t$this.premium_cells_array = cells_array;\n\t\t\t}\n\n\t\t\tif ( date && date.getYear() > 0 ) {\n\t\t\t\tthis.setDatePickerValue( date.format( Global.getLoginUserDateFormat() ) );\n\t\t\t\tthis.highLightSelectDay( e );\n\t\t\t\tthis.reLoadSubGridsSource();\n\t\t\t}\n\n\t\t\tthis.unsetSelectedCells( grid_id );\n\t\t}\n\n\t\t//now set the selected punches array\n\t\tthis.select_punches_array = [];\n\t\tfor ( var n in cells_array ) {\n\t\t\tif ( cells_array[n].punch ) {\n\t\t\t\tthis.select_punches_array.push( cells_array[n].punch );\n\t\t\t}\n\t\t}\n\t\tthis.setTimesheetGridDragAble();\n\n\t\tfunction getCellPunch( row_id, cell_index ) {\n\t\t\tvar punch = null;\n\t\t\trow = null;\n\t\t\tfor ( var i in $this.timesheet_data_source ) {\n\t\t\t\tif ( $this.timesheet_data_source[i].id == row_id ) {\n\t\t\t\t\trow = $this.timesheet_data_source[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( row ) {\n\t\t\t\tcolModel = $this.grid.getGridParam( 'colModel' );\n\t\t\t\tdata_field = colModel[cell_index].name;\n\t\t\t\tpunch = row[data_field + '_data'] ? row[data_field + '_data'] : null;\n\t\t\t}\n\t\t\treturn punch;\n\t\t}\n\n\t\tfunction getRelatedPunch( row_id, cell_index ) {\n\t\t\tvar related_punch = null;\n\t\t\trow = null;\n\t\t\tfor ( var i in $this.timesheet_data_source ) {\n\t\t\t\tif ( $this.timesheet_data_source[i].id == row_id ) {\n\t\t\t\t\trow = $this.timesheet_data_source[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\t//row = $this.timesheet_data_source[row_id -1 ];\n\t\t\tif ( row ) {\n\t\t\t\tcolModel = $this.grid.getGridParam( 'colModel' );\n\t\t\t\tdata_field = colModel[cell_index].name;\n\t\t\t\trelated_punch = row[data_field + '_related_data'] ? row[data_field + '_related_data'] : null;\n\t\t\t}\n\t\t\treturn related_punch;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tget_selected_punch_array() {\n\t}\n\n\tbuildTimeSheetRequests() {\n\t\tvar request_array = this.full_timesheet_data.request_data;\n\t\tvar len = request_array.length;\n\t\tvar request_row_index = null;\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar request = request_array[i];\n\n\t\t\tvar date_string = Global.strToDate( request.date_stamp ).format( this.full_format );\n\n\t\t\tvar row;\n\t\t\t//Build Exception row at bottom\n\t\t\tif ( !request_row_index ) {\n\t\t\t\trow = {};\n\t\t\t\trow.punch_info = $.i18n._( 'Requests' );\n\t\t\t\trow.user_id = request.user_id;\n\t\t\t\trow[date_string] = request.status;\n\t\t\t\trow[date_string + '_request'] = request;\n\n\t\t\t\trow.type = TimeSheetViewController.REQUEST_ROW;\n\t\t\t\tthis.timesheet_data_source.push( row );\n\t\t\t\trequest_row_index = this.timesheet_data_source.length - 1;\n\t\t\t} else {\n\t\t\t\trow = this.timesheet_data_source[request_row_index];\n\t\t\t\tif ( !Global.isSet( row[date_string + '_request'] ) ) {\n\t\t\t\t\trow[date_string] = request.status;\n\t\t\t\t\trow[date_string + '_request'] = request;\n\t\t\t\t} else {\n\n\t\t\t\t\tif ( $.type( row[date_string + '_request'] ) === 'array' ) {\n\t\t\t\t\t\trow[date_string + '_request'].push( request );\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\trow[date_string + '_request'] = [row[date_string + '_request']];\n\t\t\t\t\t\trow[date_string + '_request'].push( request );\n\t\t\t\t\t}\n\n\t\t\t\t\trow[date_string] = calDAndA( row[date_string + '_request'] );\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\n\t\tfunction calDAndA( array ) {\n\t\t\tvar len = array.length;\n\t\t\tvar a = 0;\n\t\t\tvar d = 0;\n\t\t\tvar p = 0;\n\t\t\tvar label = '';\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\tvar item = array[i];\n\t\t\t\tif ( item.status_id == 50 ) {\n\t\t\t\t\ta = a + 1;\n\t\t\t\t} else if ( item.status_id == 55 ) {\n\t\t\t\t\td = d + 1;\n\t\t\t\t} else if ( item.status_id == 30 ) {\n\t\t\t\t\tp = p + 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ( a > 0 ) {\n\t\t\t\tlabel += ' A: ' + a;\n\t\t\t}\n\t\t\tif ( p > 0 ) {\n\t\t\t\tlabel += ' P: ' + p;\n\t\t\t}\n\t\t\tif ( d > 0 ) {\n\t\t\t\tlabel += ' D: ' + d;\n\t\t\t}\n\t\t\treturn label;\n\t\t}\n\t}\n\n\tbuildTimeSheetExceptions() {\n\t\tvar exception_array = this.full_timesheet_data.exception_data;\n\n\t\tvar len = exception_array.length;\n\t\tvar timesheet_data_source_len = this.timesheet_data_source.length;\n\t\tvar exception_row_index = null;\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar ex = exception_array[i];\n\t\t\tvar date_string = Global.strToDate( ex.date_stamp ).format( this.full_format );\n\t\t\tvar row;\n\t\t\t//Build Exception row at bottom\n\t\t\tif ( !exception_row_index ) {\n\t\t\t\trow = {};\n\t\t\t\trow.punch_info = $.i18n._( 'Exceptions' );\n\t\t\t\trow.user_id = ex.user_id;\n\t\t\t\trow[date_string] = '';\n\t\t\t\trow[date_string + '_exceptions'] = [ex];\n\n\t\t\t\trow.type = TimeSheetViewController.EXCEPTION_ROW;\n\t\t\t\tthis.timesheet_data_source.push( row );\n\t\t\t\texception_row_index = this.timesheet_data_source.length - 1;\n\t\t\t} else {\n\t\t\t\trow = this.timesheet_data_source[exception_row_index];\n\t\t\t\tif ( !Global.isSet( row[date_string + '_exceptions'] ) ) {\n\t\t\t\t\trow[date_string + '_exceptions'] = [ex];\n\t\t\t\t} else {\n\t\t\t\t\trow[date_string + '_exceptions'].push( ex );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar punch;\n\t\t\tvar j;\n\t\t\tif ( !Global.isFalseOrNull( ex.punch_id ) ) {\n\n\t\t\t\tfor ( var j = 0; j < timesheet_data_source_len; j++ ) {\n\t\t\t\t\trow = this.timesheet_data_source[j];\n\n\t\t\t\t\tif ( !row[date_string] ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( row[date_string + '_data'] ) {\n\t\t\t\t\t\tpunch = row[date_string + '_data'];\n\t\t\t\t\t} else if ( row[date_string + '_related__data'] ) {\n\t\t\t\t\t\tpunch = row[date_string + '_related_data'];\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( punch && punch.id === ex.punch_id && !punch.exception ) {\n\t\t\t\t\t\tpunch.exception = [ex];\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t} else if ( !Global.isFalseOrNull( ex.punch_control_id ) ) {\n\t\t\t\tfor ( var j = 0; j < timesheet_data_source_len; j++ ) {\n\t\t\t\t\trow = this.timesheet_data_source[j];\n\n\t\t\t\t\tif ( !row[date_string] ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( row[date_string + '_data'] ) {\n\t\t\t\t\t\tpunch = row[date_string + '_data'];\n\t\t\t\t\t} else if ( row[date_string + '_related__data'] ) {\n\t\t\t\t\t\tpunch = row[date_string + '_related_data'];\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( punch && punch.punch_control_id === ex.punch_control_id && !punch.exception ) {\n\t\t\t\t\t\tpunch.exception = [ex];\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Make sure Totle_time go to last item\n\tsortAccumulatedTotalData() {\n\n\t\tvar sort_fields = ['order', 'punch_info'];\n\t\tthis.accumulated_total_grid_source.sort( Global.m_sort_by( sort_fields ) );\n\t}\n\n\t// Make sure total time go to last item\n\tsortAccumulatedTimeData() {\n\n\t\tvar sort_fields = ['order', 'punch_info'];\n\t\tthis.accumulated_time_source.sort( Global.m_sort_by( sort_fields ) );\n\t}\n\n\treLoadSubGridsSource( force ) {\n\t\t// Error: Uncaught TypeError: Cannot read property 'pay_period_id' of undefined in interface/html5/#!m=TimeSheet&date=20151214&user_id=null&show_wage=0 line 4290\n\t\tif ( !this.full_timesheet_data || !this.full_timesheet_data.timesheet_verify_data ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( !force ) {\n\t\t\tif ( this.full_timesheet_data.timesheet_verify_data.pay_period_id === this.pay_period_map[this.getSelectDate()] ||\n\t\t\t\t( !Global.isSet( this.full_timesheet_data.timesheet_verify_data.pay_period_id ) && !this.pay_period_map[this.getSelectDate()] )\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.accumulated_time_source_map = {};\n\t\tthis.branch_source_map = {};\n\t\tthis.department_source_map = {};\n\t\tthis.job_source_map = {};\n\t\tthis.job_item_source_map = {};\n\t\tthis.punch_tag_source_map = {};\n\t\tthis.premium_source_map = {};\n\t\tthis.accumulated_total_grid_source_map = {};\n\t\tthis.accumulated_time_source = [];\n\t\tthis.branch_source = [];\n\t\tthis.department_source = [];\n\t\tthis.job_source = [];\n\t\tthis.job_item_source = [];\n\t\tthis.punch_tag_source = [];\n\t\tthis.premium_source = [];\n\t\tthis.accumulated_total_grid_source = [];\n\t\tthis.verification_grid_source = [];\n\t\tvar $this = this;\n\t\tvar start_date_string = this.start_date_picker.getValue();\n\t\tvar user_id = this.getSelectEmployee();\n\t\tthis.api_timesheet.getTimeSheetTotalData( user_id, start_date_string, {\n\t\t\tonResult: function( result ) {\n\t\t\t\t$this.onReloadSubGridResult( result );\n\t\t\t}\n\t\t} );\n\t}\n\n\tonReloadSubGridResult( result ) {\n\t\tvar $this = this;\n\t\tresult = result.getResult();\n\t\t$this.full_timesheet_data.accumulated_user_date_total_data = result.accumulated_user_date_total_data;\n\t\t$this.full_timesheet_data.meal_and_break_total_data = result.meal_and_break_total_data;\n\t\t$this.full_timesheet_data.pay_period_accumulated_user_date_total_data = result.pay_period_accumulated_user_date_total_data;\n\t\t$this.full_timesheet_data.timesheet_verify_data = result.timesheet_verify_data;\n\t\t$this.full_timesheet_data.pay_period_data = result.pay_period_data;\n\t\t$this.timesheet_verify_data = $this.full_timesheet_data.timesheet_verify_data;\n\n\t\t$this.buildSubGridsSource();\n\t\t$this.buildPunchNoteGridSource();\n\t\t$this.buildAccumulatedTotalGrid();\n\t\t$this.buildVerificationGridSource();\n\n\t\t$this.accumulated_time_grid.setData( $this.accumulated_time_source, false );\n\t\t$this.branch_grid.setData( $this.branch_source, false );\n\t\t$this.department_grid.setData( $this.department_source, false );\n\t\t$this.job_grid.setData( $this.job_source, false );\n\t\t$this.job_item_grid.setData( $this.job_item_source, false );\n\t\t$this.punch_tag_grid.setData( $this.punch_tag_source, false );\n\t\t$this.premium_grid.setData( $this.premium_source, false );\n\n\t\tif ( $this.accumulated_total_grid_source.length === 0 ) {\n\t\t\t$this.accumulated_total_grid_source.push();\n\t\t}\n\t\t$this.accumulated_total_grid.setData( $this.accumulated_total_grid_source, false );\n\n\t\t$this.punch_note_grid.setData( $this.punch_note_grid_source, false );\n\t\t$this.verification_grid.setData( $this.verification_grid_source, false );\n\n\t\t$this.setGridSize();\n\t}\n\n\tsetDefaultMenuEditIcon( context_btn, grid_selected_length ) {\n\t\tlet p_id = this.getPunchPermissionType();\n\n\t\tif ( !this.editPermissionValidate( p_id ) || this.edit_only_mode ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t}\n\n\t\tif ( grid_selected_length === 1 && this.editOwnerOrChildPermissionValidate( p_id ) && ( this.getPunchMode() === 'punch' || p_id === 'absence' ) ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t} else {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t\tif( grid_selected_length !== 0 ) {\n\t\t\t\t// This ensures the edit icon is still visible when nothing is selected, but should still be disabled. (to keep consistency with old design)\n\t\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t\t}\n\t\t}\n\t}\n\n\tsetEditMenuAddIcon( context_btn ) {\n\t\tlet p_id = this.getPunchPermissionType();\n\n\t\tif ( !this.addPermissionValidate( p_id ) || this.edit_only_mode ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t}\n\n\t\tif ( this.is_add == true ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tsetEditMenuDeleteIcon( context_btn ) {\n\t\tlet p_id = this.getPunchPermissionType();\n\n\t\tif ( !this.deletePermissionValidate( p_id ) || this.edit_only_mode ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t}\n\n\t\tif ( ( !this.current_edit_record || !this.current_edit_record.id ) || !this.deleteOwnerOrChildPermissionValidate( p_id ) ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tsetEditMenuDeleteAndNextIcon( context_btn ) {\n\t\tlet p_id = this.getPunchPermissionType();\n\n\t\tif ( !this.deletePermissionValidate( p_id ) || this.edit_only_mode ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t}\n\n\t\tif ( ( !this.current_edit_record || !this.current_edit_record.id ) || !this.deleteOwnerOrChildPermissionValidate( p_id ) ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tsetEditMenuEditIcon( context_btn, pId ) {\n\t\tlet p_id = this.getPunchPermissionType();\n\n\t\tif ( !this.editPermissionValidate( p_id ) || this.edit_only_mode || this.is_mass_editing ) {\n\t\t\t//Not shown in edit only mode or mass edit. Mass edit should only show mass edit (need to set that part in mass edit icon).\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\n\t\tif ( !this.is_viewing || !this.editOwnerOrChildPermissionValidate( p_id ) ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tsetDefaultMenuDeleteIcon( context_btn, grid_selected_length ) {\n\t\tlet p_id = this.getPunchPermissionType();\n\n\t\tif ( !this.deletePermissionValidate( p_id ) || this.edit_only_mode ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t}\n\n\t\tif ( grid_selected_length >= 1 && this.deleteOwnerOrChildPermissionValidate( p_id ) && ( this.getPunchMode() === 'punch' || p_id === 'absence' ) ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t} else {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tsetDefaultMenuDeleteAndNextIcon( context_btn, grid_selected_length ) {\n\t\tlet p_id = this.getPunchPermissionType();\n\n\t\tif ( !this.deletePermissionValidate( p_id ) || this.edit_only_mode ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t}\n\n\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t}\n\n\tsetDefaultMenuViewIcon( context_btn, grid_selected_length ) {\n\t\tlet p_id = this.getPunchPermissionType();\n\n\t\tif ( !this.viewPermissionValidate( p_id ) || this.edit_only_mode ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t}\n\n\t\tif ( grid_selected_length === 1 && this.viewOwnerOrChildPermissionValidate() && ( this.getPunchMode() === 'punch' || p_id === 'absence' ) ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t} else {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tsetDefaultMenuAddPunchIcon( context_btn, grid_selected_length ) {\n\t\tlet p_id = 'punch';\n\n\t\tif ( !this.addPermissionValidate( p_id ) || this.edit_only_mode ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\n\t\tif ( this.getPunchMode() === 'manual' && p_id !== 'absence' ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tsetDefaultMenuAddAbsenceIcon( context_btn, grid_selected_length ) {\n\t\tlet p_id = 'absence';\n\n\t\tif ( !this.addPermissionValidate( p_id ) || this.edit_only_mode ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\n\t\tif ( this.getPunchMode() === 'manual' && p_id !== 'absence' ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tsetDefaultMenuSaveIcon( context_btn, grid_selected_length ) {\n\t\tlet p_id = this.getPunchPermissionType();\n\n\t\tif ( ( !this.addPermissionValidate( p_id ) && !this.editPermissionValidate( p_id ) ) ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t}\n\t\tif ( this.getPunchMode() === 'manual' ) {\n\t\t\tif ( ( !this.addPermissionValidate( p_id ) && !this.editPermissionValidate( p_id ) ) ) {\n\t\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t\t}\n\t\t\tif ( this.is_saving_manual_grid ) {\n\t\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t\t}\n\t\t} else {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tbuildAccmulatedOrderMap( total ) {\n\n\t\tif ( !total ) {\n\t\t\treturn;\n\t\t}\n\t\tfor ( var key in total ) {\n\n\t\t\tfor ( var key1 in total[key] ) {\n\t\t\t\tthis.accmulated_order_map[key1] = total[key][key1].order;\n\t\t\t}\n\n\t\t}\n\t}\n\n\tbuildSubGridsSource() {\n\t\tvar accumulated_user_date_total_data = this.full_timesheet_data.accumulated_user_date_total_data;\n\t\tvar meal_and_break_total_data = this.full_timesheet_data.meal_and_break_total_data;\n\t\tvar pay_period_accumulated_user_date_total_data = this.full_timesheet_data.pay_period_accumulated_user_date_total_data;\n\n\t\tthis.accmulated_order_map = {};\n\n\t\t// Save the order, will do sort after all data prepared.\n\t\tif ( accumulated_user_date_total_data.total ) {\n\t\t\tthis.buildAccmulatedOrderMap( accumulated_user_date_total_data.total );\n\t\t}\n\n\t\tif ( pay_period_accumulated_user_date_total_data ) {\n\t\t\tthis.buildAccmulatedOrderMap( pay_period_accumulated_user_date_total_data );\n\t\t}\n\n\t\t//Build Accumulated Total Grid Pay_period column data\n\t\tvar accumulated_time = pay_period_accumulated_user_date_total_data.accumulated_time;\n\t\tvar premium_time = pay_period_accumulated_user_date_total_data.premium_time;\n\t\tvar absence_time = pay_period_accumulated_user_date_total_data.absence_time_taken;\n\n\t\tthis.marked_regular_row = {};\n\t\tif ( Global.isSet( accumulated_time ) ) {\n\t\t\tthis.buildSubGridsData( accumulated_time, 'pay_period', this.accumulated_total_grid_source_map, this.accumulated_total_grid_source, 'accumulated_time' );\n\t\t} else {\n\t\t\taccumulated_time = { total: { label: $.i18n._( 'Total Time' ), total_time: '0' } };\n\t\t\tthis.buildSubGridsData( accumulated_time, 'pay_period', this.accumulated_total_grid_source_map, this.accumulated_total_grid_source, 'accumulated_time' );\n\t\t}\n\n\t\tif ( Global.isSet( premium_time ) ) {\n\t\t\tthis.buildSubGridsData( premium_time, 'pay_period', this.accumulated_total_grid_source_map, this.accumulated_total_grid_source, 'premium_time' );\n\t\t}\n\n\t\tif ( Global.isSet( absence_time ) ) {\n\t\t\tthis.buildSubGridsData( absence_time, 'pay_period', this.accumulated_total_grid_source_map, this.accumulated_total_grid_source, 'absence_time' );\n\t\t}\n\n\t\tthis.accumulated_time_grid.grid.clearGridData(); //Clear accumulate time grid data before repopulating it, otherwise the data seems to get corrupted and display odd things, especially when removing an entire week on the manual timesheet. (total time still appears even after its removed)\n\n\t\t//Build Accumulated Total Grid Pay_period column data end\n\t\tvar column_len = this.timesheet_columns.length;\n\t\taccumulated_time = { total: { label: $.i18n._( 'Total Time' ), total_time: '0' } };\n\t\tvar date_string;\n\t\tvar date;\n\n\t\t//Start on column that is right before the 7 days of the week.\n\t\tvar start = ( column_len - 7 - 1 );\n\t\tfor ( var i = start; i < column_len; i++ ) {\n\t\t\tdate_string = this.timesheet_columns[i].name ? this.timesheet_columns[i].name : '';\n\t\t\tif ( date_string.indexOf( 'empty_cell' ) >= 0 || date_string.indexOf( 'punch_info' ) >= 0 ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tthis.buildSubGridsData( accumulated_time, date_string, this.accumulated_time_source_map, this.accumulated_time_source, 'accumulated_time' );\n\t\t}\n\t\tthis.buildSubGridsData( accumulated_time, 'week', this.accumulated_total_grid_source_map, this.accumulated_total_grid_source, 'accumulated_time' );\n\n\t\tfor ( var key in accumulated_user_date_total_data ) {\n\n\t\t\t//Build Accumulated Total Grid week column data\n\t\t\tif ( key === 'total' ) {\n\t\t\t\tvar total_result = accumulated_user_date_total_data.total;\n\t\t\t\taccumulated_time = total_result.accumulated_time;\n\t\t\t\tpremium_time = total_result.premium_time;\n\t\t\t\tabsence_time = total_result.absence_time_taken;\n\n\t\t\t\tif ( Global.isSet( accumulated_time ) ) {\n\n\t\t\t\t\tthis.buildSubGridsData( accumulated_time, 'week', this.accumulated_total_grid_source_map, this.accumulated_total_grid_source, 'accumulated_time' );\n\t\t\t\t}\n\n\t\t\t\tif ( Global.isSet( premium_time ) ) {\n\t\t\t\t\tthis.buildSubGridsData( premium_time, 'week', this.accumulated_total_grid_source_map, this.accumulated_total_grid_source, 'premium_time' );\n\t\t\t\t}\n\n\t\t\t\tif ( Global.isSet( absence_time ) ) {\n\t\t\t\t\tthis.buildSubGridsData( absence_time, 'week', this.accumulated_total_grid_source_map, this.accumulated_total_grid_source, 'absence_time' );\n\t\t\t\t}\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t//Build Accumulated Total Grid week column data end\n\t\t\t//Build all sub grids data\n\t\t\t//Error: Uncaught TypeError: Cannot read property 'format' of null in interface/html5/#!m=TimeSheet&date=20151117&user_id=35367&show_wage=0 line 4478\n\t\t\tdate = Global.strToDate( key );\n\t\t\tif ( !date ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tdate_string = date.format( this.full_format );\n\n\t\t\t//Error: Uncaught TypeError: Cannot read property 'accumulated_time' of undefined\n\t\t\tif ( typeof accumulated_user_date_total_data[key] != 'undefined' ) {\n\t\t\t\taccumulated_time = accumulated_user_date_total_data[key].accumulated_time;\n\t\t\t\tvar branch_time = accumulated_user_date_total_data[key].branch_time;\n\t\t\t\tvar department_time = accumulated_user_date_total_data[key].department_time;\n\t\t\t\tvar job_time = accumulated_user_date_total_data[key].job_time;\n\t\t\t\tvar job_item_time = accumulated_user_date_total_data[key].job_item_time;\n\t\t\t\tvar punch_tag_time = accumulated_user_date_total_data[key].punch_tag_time;\n\t\t\t\tpremium_time = accumulated_user_date_total_data[key].premium_time;\n\t\t\t} else {\n\t\t\t\tDebug.Text( 'ERROR: accumulated_user_date_total_data[key] is null or undefined!', 'TimesheetViewController.js', 'TimesheetViewController', 'buildSubGridsSource', 1 );\n\t\t\t}\n\n\t\t\tif ( Global.isSet( accumulated_time ) ) {\n\t\t\t\tthis.buildSubGridsData( accumulated_time, date_string, this.accumulated_time_source_map, this.accumulated_time_source, 'accumulated_time' );\n\t\t\t}\n\n\t\t\tif ( Global.isSet( branch_time ) ) {\n\n\t\t\t\tthis.buildSubGridsData( branch_time, date_string, this.branch_source_map, this.branch_source, 'branch_time' );\n\t\t\t}\n\n\t\t\tif ( Global.isSet( department_time ) ) {\n\n\t\t\t\tthis.buildSubGridsData( department_time, date_string, this.department_source_map, this.department_source, 'department_time' );\n\t\t\t}\n\n\t\t\tif ( Global.isSet( job_time ) ) {\n\n\t\t\t\tthis.buildSubGridsData( job_time, date_string, this.job_source_map, this.job_source, 'job_time' );\n\t\t\t}\n\n\t\t\tif ( Global.isSet( job_item_time ) ) {\n\n\t\t\t\tthis.buildSubGridsData( job_item_time, date_string, this.job_item_source_map, this.job_item_source, 'job_item_time' );\n\t\t\t}\n\n\t\t\tif ( Global.isSet( punch_tag_time ) ) {\n\n\t\t\t\tthis.buildSubGridsData( punch_tag_time, date_string, this.punch_tag_source_map, this.punch_tag_source, 'punch_tag_time' );\n\t\t\t}\n\n\t\t\tif ( Global.isSet( premium_time ) ) {\n\n\t\t\t\tthis.buildSubGridsData( premium_time, date_string, this.premium_source_map, this.premium_source, 'premium_time' );\n\t\t\t}\n\n\t\t}\n\n\t\tthis.sortAccumulatedTotalData();\n\t\tthis.sortAccumulatedTimeData();\n\n\t\tif ( Global.isSet( meal_and_break_total_data ) ) {\n\n\t\t\tfor ( var key in meal_and_break_total_data ) {\n\t\t\t\t// Error: Uncaught TypeError: Cannot read property 'format' of null in interface/html5/#!m=TimeSheet&date=20151119&user_id=55338&show_wage=0 line 4527\n\t\t\t\tdate = Global.strToDate( key );\n\t\t\t\tif ( !date ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tdate_string = date.format( this.full_format );\n\n\t\t\t\tthis.buildBreakAndLunchData( meal_and_break_total_data[key], date_string );\n\n\t\t\t}\n\n\t\t}\n\t}\n\n\tbuildBreakAndLunchData( array, date_string ) {\n\t\tvar row;\n\t\tfor ( var key in array ) {\n\t\t\tif ( !this.accumulated_time_source_map[key] ) {\n\t\t\t\trow = {};\n\t\t\t\trow.punch_info = array[key].break_name;\n\t\t\t\tarray[key].key = key;\n\t\t\t\trow[date_string] = Global.getTimeUnit( array[key].total_time ) + ' (' + array[key].total_breaks + ')';\n\t\t\t\trow[date_string + '_data'] = array[key];\n\t\t\t\tthis.timesheet_data_source.push( row );\n\t\t\t\tthis.accumulated_time_source_map[key] = row;\n\t\t\t} else {\n\t\t\t\trow = this.accumulated_time_source_map[key];\n\t\t\t\tif ( !row[date_string] ) {\n\t\t\t\t\tarray[key].key = key;\n\t\t\t\t\trow[date_string] = Global.getTimeUnit( array[key].total_time ) + ' (' + array[key].total_breaks + ')';\n\n\t\t\t\t\trow[date_string + '_data'] = array[key];\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\t}\n\n\taddCellCount( key ) {\n\t\tswitch ( key ) {\n\t\t\tcase 'branch_time':\n\t\t\t\tthis.branch_cell_count = this.branch_cell_count + 1;\n\t\t\t\tbreak;\n\t\t\tcase 'department_time':\n\t\t\t\tthis.department_cell_count = this.department_cell_count + 1;\n\t\t\t\tbreak;\n\n\t\t\tcase 'premium_time':\n\t\t\t\tthis.premium_cell_count = this.premium_cell_count + 1;\n\t\t\t\tbreak;\n\t\t\tcase 'job_time':\n\t\t\t\tthis.job_cell_count = this.job_cell_count + 1;\n\t\t\t\tbreak;\n\t\t\tcase 'job_item_time':\n\t\t\t\tthis.task_cell_count = this.task_cell_count + 1;\n\t\t\t\tbreak;\n\t\t\tcase 'punch_tag_time':\n\t\t\t\tthis.punch_tag_cell_count = this.punch_tag_cell_count + 1;\n\t\t\t\tbreak;\n\n\t\t}\n\t}\n\n\tbuildSubGridsData( array, date_string, map, result_array, parent_key ) {\n\t\tvar row;\n\n\t\tvar start_date = this.start_date_picker.getValue();\n\n\t\tif ( !this.marked_regular_row[start_date] ) {\n\t\t\tthis.marked_regular_row[start_date] = false; //Only mark the first regular time row in the week, as thats where the bold top-line is going to go.\n\t\t}\n\n\t\tfor ( var key in array ) {\n\t\t\tif ( !map[key] ) {\n\t\t\t\trow = {};\n\t\t\t\trow.parent_key = parent_key;\n\t\t\t\trow.key = key;\n\n\t\t\t\tif ( parent_key === 'accumulated_time' ) {\n\n\t\t\t\t\tif ( key === 'total' || key === 'worked_time' ) {\n\t\t\t\t\t\trow.type = TimeSheetViewController.TOTAL_ROW;\n\t\t\t\t\t} else if ( ( this.marked_regular_row[start_date] == false || this.marked_regular_row[start_date] == key ) && key.indexOf( 'regular_time' ) === 0 ) {\n\t\t\t\t\t\trow.type = TimeSheetViewController.REGULAR_ROW;\n\t\t\t\t\t\tthis.marked_regular_row[start_date] = key;\n\t\t\t\t\t} else {\n\t\t\t\t\t\trow.type = TimeSheetViewController.ACCUMULATED_TIME_ROW;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( array[key].override ) {\n\t\t\t\t\t\trow.is_override_row = true;\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( parent_key === 'premium_time' ) {\n\t\t\t\t\trow.type = TimeSheetViewController.PREMIUM_ROW;\n\t\t\t\t}\n\n\t\t\t\tif ( this.accmulated_order_map[key] ) {\n\t\t\t\t\trow.order = this.accmulated_order_map[key];\n\t\t\t\t}\n\n\t\t\t\trow.punch_info = array[key].label;\n\n\t\t\t\tvar key_array = key.split( '_' );\n\t\t\t\tvar no_id = false;\n\t\t\t\tif ( key_array.length > 1 && key_array[1] == '0' ) {\n\t\t\t\t\tno_id = true;\n\t\t\t\t}\n\n\t\t\t\tarray[key].key = key;\n\t\t\t\trow[date_string] = Global.getTimeUnit( array[key].total_time );\n\t\t\t\trow[date_string + '_data'] = array[key];\n\n\t\t\t\t//if id == 0, put the row as first row.\n\t\t\t\tif ( no_id ) {\n\t\t\t\t\tresult_array.unshift( row );\n\t\t\t\t} else {\n\t\t\t\t\tresult_array.push( row );\n\t\t\t\t}\n\n\t\t\t\tmap[key] = row;\n\t\t\t} else {\n\t\t\t\trow = map[key];\n\t\t\t\tif ( row[date_string] && key === 'total' ) { //Override total cell data since we set all to 00:00 at beginning\n\t\t\t\t\tarray[key].key = key;\n\t\t\t\t\trow[date_string] = Global.getTimeUnit( array[key].total_time );\n\t\t\t\t\trow[date_string + '_data'] = array[key];\n\n\t\t\t\t\tif ( row.parent_key === 'accumulated_time' ) {\n\t\t\t\t\t\tif ( array[key].override ) {\n\t\t\t\t\t\t\trow.is_override_row = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\tarray[key].key = key;\n\t\t\t\t\trow[date_string] = Global.getTimeUnit( array[key].total_time );\n\t\t\t\t\trow[date_string + '_data'] = array[key];\n\n\t\t\t\t\tif ( row.parent_key === 'accumulated_time' ) {\n\t\t\t\t\t\tif ( array[key].override ) {\n\t\t\t\t\t\t\trow.is_override_row = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tthis.addCellCount( parent_key );\n\t\t}\n\t}\n\n\ttimeSheetVerifyPermissionValidate() {\n\t\tif ( PermissionManager.validate( 'punch', 'verify_time_sheet' ) &&\n\t\t\tthis.timesheet_verify_data.hasOwnProperty( 'pay_period_verify_type_id' ) &&\n\t\t\tthis.timesheet_verify_data.pay_period_verify_type_id != 10 ) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tbuildVerificationGridSource() {\n\t\tthis.verification_grid_source = [];\n\t\tvar $this = this;\n\t\tvar verify_action_bar = $( this.el ).find( '.verification-action-bar' );\n\t\tvar verify_grid_div = $( this.el ).find( '.verification-grid-div' );\n\t\tvar verify_btn = $( this.el ).find( '.verify-button' );\n\t\tvar verify_title = $( this.el ).find( '.verification-grid-title' );\n\t\tvar verify_des = $( this.el ).find( '.verify-description' );\n\n\t\tif ( this.timeSheetVerifyPermissionValidate() &&\n\t\t\tGlobal.isSet( this.timesheet_verify_data.pay_period_id ) &&\n\t\t\tGlobal.isSet( this.timesheet_verify_data.pay_period_verify_type_id ) &&\n\t\t\tthis.timesheet_verify_data.pay_period_verify_type_id !== '10' ) {\n\n\t\t\tif ( !this.timesheet_verify_data.display_verify_button ) {\n\t\t\t\tverify_btn.css( 'display', 'none' );\n\t\t\t\tverify_title.css( 'display', 'none' );\n\t\t\t} else {\n\t\t\t\tverify_btn.css( 'display', 'inline-block' );\n\t\t\t\tverify_title.css( 'display', 'block' );\n\t\t\t}\n\n\t\t\tverify_grid_div.css( 'display', 'block' );\n\t\t\tverify_des.text( this.timesheet_verify_data.verification_status_display );\n\n\t\t\tif ( this.timesheet_verify_data.verification_box_color ) {\n\t\t\t\tverify_action_bar.css( 'background', this.timesheet_verify_data.verification_box_color );\n\t\t\t} else {\n\t\t\t\tverify_action_bar.css( 'background', '#ffffff' );\n\t\t\t}\n\n\t\t\tverify_btn.unbind( 'click' ).bind( 'click', Global.debounce( function VerifyTimeSheet( e ) {\n\t\t\t\t$(e.target).prop( 'disabled', true ); //Disable the verify button during processing to avoid the user from getting impatient and clicking it multiple times.\n\n\t\t\t\tTAlertManager.showConfirmAlert( $this.timesheet_verify_data.verification_confirmation_message, $.i18n._('TimeSheet Verification Agreement'), function( flag ) {\n\t\t\t\t\tif ( flag ) {\n\t\t\t\t\t\t$this.api_timesheet.verifyTimeSheet( $this.getSelectEmployee(), $this.timesheet_verify_data.pay_period_id, {\n\t\t\t\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\t\t\t\t$(e.target).prop( 'disabled', false );\n\n\t\t\t\t\t\t\t\t\tif ( result && result.isValid() ) {\n\t\t\t\t\t\t\t\t\t\t$this.search();\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tTAlertManager.showErrorAlert( result );\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tonError: function() {\n\t\t\t\t\t\t\t\t\t$(e.target).prop( 'disabled', false );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$(e.target).prop( 'disabled', false );\n\t\t\t\t\t}\n\t\t\t\t}, $.i18n._('I Agree'), $.i18n._( 'I Do Not Agree' ) );\n\t\t\t}, Global.calcDebounceWaitTimeBasedOnNetwork(), true ) );\n\t\t} else {\n\t\t\tverify_btn.css( 'display', 'none' );\n\t\t\tverify_grid_div.css( 'display', 'none' );\n\t\t\treturn;\n\t\t}\n\n\t\tvar verification_data = this.timesheet_verify_data.verification_window_dates.start + ' ' + $.i18n._( 'to' ) + ' ' + this.timesheet_verify_data.verification_window_dates.end;\n\n\t\tvar pay_period_data = this.pay_period_header;\n\n\t\tthis.verification_grid_source.push( { pay_period: pay_period_data, verification: verification_data } );\n\n\t\t//This can be called by clicking on a different date column header, or using the top right refresh icon, so not all grids are resized at that time necessarily.\n\t\t$this.setGridHeight( 'verification_grid' );\n\t}\n\n\tbuildPunchNoteGridSource() {\n\t\tthis.punch_note_grid_source = [];\n\t\tvar punch_array = this.full_timesheet_data.punch_data;\n\t\tvar user_date_total_array = this.full_timesheet_data.user_date_total_data;\n\t\tvar len = punch_array.length;\n\t\tvar len1 = user_date_total_array.length;\n\t\tvar last_control_id = '';\n\t\tvar date;\n\t\tvar date_string;\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar punch = punch_array[i];\n\t\t\tdate = Global.strToDate( punch.date_stamp );\n\t\t\tdate_string = date.format();\n\t\t\tif ( punch.note && punch.punch_control_id !== last_control_id ) {\n\t\t\t\tthis.punch_note_account = this.punch_note_account + 1;\n\t\t\t\tthis.punch_note_grid_source.push( { note: date_string + ' @ ' + punch.punch_time + ': ' + punch.note.replace( /\\n/g, ' ' ) } );\n\t\t\t\tlast_control_id = punch.punch_control_id;\n\t\t\t}\n\t\t}\n\t\tfor ( var x = 0; x < len1; x++ ) {\n\t\t\tvar user_date_total = user_date_total_array[x];\n\t\t\tdate = Global.strToDate( user_date_total.date_stamp );\n\t\t\tdate_string = date.format();\n\t\t\tif ( user_date_total.note ) {\n\t\t\t\tthis.punch_note_account = this.punch_note_account + 1;\n\t\t\t\tthis.punch_note_grid_source.push( { note: date_string + ' @ ' + Global.getTimeUnit( user_date_total.total_time ) + ': ' + user_date_total.note.replace( /\\n/g, ' ' ) } );\n\t\t\t}\n\t\t}\n\t}\n\n\tbuildAbsenceSource() {\n\t\tvar map = {};\n\t\tthis.absence_source = [];\n\t\tthis.absence_original_source = [];\n\t\tvar absence_array = this.full_timesheet_data.user_date_total_data;\n\t\tvar len = absence_array.length;\n\t\tvar row;\n\t\tvar row_id_counter = 1;\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar absence = absence_array[i];\n\n\t\t\tif ( absence.object_type_id != 50 ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis.absence_original_source.push( absence );\n\t\t\tvar date = Global.strToDate( absence.date_stamp );\n\t\t\tvar date_string = date.format( this.full_format );\n\t\t\tvar key = absence.src_object_id + '-' + absence.pay_code_id;\n\n\t\t\tif ( !map[key] ) {\n\t\t\t\trow = {};\n\t\t\t\trow.id = row_id_counter;\n\t\t\t\trow.type = TimeSheetViewController.ABSENCE_ROW;\n\t\t\t\trow.punch_info = absence.name; //Was: absence.absence_policy\n\t\t\t\trow.punch_info_id = absence.src_object_id;\n\t\t\t\trow.user_id = absence.user_id;\n\t\t\t\trow[date_string] = Global.getTimeUnit( absence.total_time );\n\t\t\t\trow[date_string + '_data'] = absence;\n\t\t\t\tthis.absence_source.push( row );\n\t\t\t\tmap[key] = row;\n\t\t\t} else {\n\t\t\t\trow = map[key];\n\t\t\t\tif ( row[date_string] ) {\n\t\t\t\t\trow = {};\n\t\t\t\t\trow.id = row_id_counter;\n\t\t\t\t\trow.type = TimeSheetViewController.ABSENCE_ROW;\n\t\t\t\t\trow.punch_info = absence.name; //Was: absence.absence_policy\n\t\t\t\t\trow.punch_info_id = absence.src_object_id;\n\t\t\t\t\trow.user_id = absence.user_id;\n\t\t\t\t\trow[date_string] = Global.getTimeUnit( absence.total_time );\n\n\t\t\t\t\trow[date_string + '_data'] = absence;\n\t\t\t\t\tthis.absence_source.push( row );\n\t\t\t\t\tmap[key] = row;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tthis.lastDayIsOverride( date, row, absence );\n\t\t\t\t\trow[date_string] = Global.getTimeUnit( absence.total_time );\n\t\t\t\t\trow[date_string + '_data'] = absence;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trow_id_counter++;\n\n\t\t\tthis.absence_cell_count = this.absence_cell_count + 1;\n\n\t\t}\n\n\t\tif ( this.absence_source.length === 0 ) {\n\t\t\trow = {};\n\t\t\trow.id = 1;\n\t\t\trow.punch_info = '';\n\t\t\trow.user_id = this.getSelectEmployee();\n\t\t\tthis.absence_source.push( row );\n\t\t}\n\t}\n\n\tlastDayIsOverride( current_date, row, current_data ) {\n\n\t\tvar last_date = new Date( new Date( current_date.getTime() ).setDate( current_date.getDate() - 1 ) );\n\n\t\tvar date_str = last_date.format( this.full_format );\n\n\t\tvar data = row[date_str + '_data'];\n\n\t\tif ( data && data.override && current_data.src_object_id === data.src_object_id ) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tbuildTimeSheetSource() {\n\t\tthis.select_punches_array = [];\n\t\tthis.timesheet_data_source = [];\n\n\t\tvar punch_array = this.full_timesheet_data.punch_data;\n\t\tvar len = punch_array.length;\n\t\tvar row;\n\t\tvar new_row;\n\t\tvar row_id_counter = 1;\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar punch = punch_array[i];\n\t\t\t// Error: TypeError: Global.strToDate(...) is null in interface/html5/framework/jquery.min.js?v=9.0.1-20151022-081724 line 2 > eval line 4869\n\t\t\t// Punch must have a date\n\t\t\tif ( !punch.date_stamp ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tvar date = Global.strToDate( punch.date_stamp );\n\t\t\tvar date_string = date.format( this.full_format );\n\n\t\t\tvar punch_status_id = punch.status_id;\n\n\t\t\t//row 1.\n\t\t\tif ( i === 0 ) {\n\t\t\t\trow = {};\n\t\t\t\trow.id = row_id_counter;\n\t\t\t\trow_id_counter++;\n\t\t\t\trow.punch_info = punch.status;\n\t\t\t\trow.status_id = punch_status_id;\n\t\t\t\trow.user_id = punch.user_id;\n\t\t\t\trow[date_string] = punch.punch_time;\n\t\t\t\trow[date_string + '_data'] = punch;\n\t\t\t\trow[date_string + '_related_data'] = null;\n\t\t\t\trow.status_id = punch_status_id;\n\t\t\t\trow.type = TimeSheetViewController.PUNCH_ROW;\n\t\t\t\tthis.timesheet_data_source.push( row );\n\n\t\t\t\tif ( punch_status_id == 10 ) {\n\n\t\t\t\t\tvar our_row = {};\n\t\t\t\t\tour_row.punch_info = $.i18n._( 'Out' );\n\t\t\t\t\tour_row.user_id = punch.user_id;\n\t\t\t\t\tour_row[date_string] = '';\n\t\t\t\t\tour_row[date_string + '_data'] = null;\n\t\t\t\t\tour_row[date_string + '_related_data'] = punch;\n\t\t\t\t\tour_row.status_id = 20;\n\t\t\t\t\tour_row.type = TimeSheetViewController.PUNCH_ROW;\n\t\t\t\t\tour_row.id = row_id_counter;\n\t\t\t\t\trow_id_counter++;\n\t\t\t\t\tthis.timesheet_data_source.push( our_row );\n\n\t\t\t\t} else {\n\t\t\t\t\tnew_row = {};\n\t\t\t\t\tnew_row.punch_info = $.i18n._( 'In' );\n\t\t\t\t\tnew_row.user_id = punch.user_id;\n\t\t\t\t\tnew_row[date_string] = '';\n\t\t\t\t\tnew_row[date_string + '_data'] = null;\n\t\t\t\t\tnew_row[date_string + '_related_data'] = punch;\n\t\t\t\t\tnew_row.status_id = 10;\n\t\t\t\t\tnew_row.type = TimeSheetViewController.PUNCH_ROW;\n\t\t\t\t\tnew_row.id = row_id_counter;\n\t\t\t\t\trow_id_counter++;\n\t\t\t\t\tthis.timesheet_data_source.splice( this.timesheet_data_source.length - 1, 0, new_row );\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tvar find_position = false;\n\t\t\t\tvar timesheet_data_source_len = this.timesheet_data_source.length;\n\t\t\t\tfor ( var j = 0; j < timesheet_data_source_len; j++ ) {\n\t\t\t\t\trow = this.timesheet_data_source[j];\n\t\t\t\t\tif ( row[date_string] ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else if ( !row[date_string] && row[date_string + '_related_data'] ) {\n\t\t\t\t\t\tvar related_punch = row[date_string + '_related_data'];\n\n\t\t\t\t\t\tif ( related_punch.punch_control_id === punch.punch_control_id ) {\n\t\t\t\t\t\t\trow[date_string] = punch.punch_time;\n\t\t\t\t\t\t\trow[date_string + '_data'] = punch;\n\t\t\t\t\t\t\tfind_position = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if ( !row[date_string] && !row[date_string + '_related_data'] && punch.status_id == row.status_id ) {\n\t\t\t\t\t\trow[date_string] = punch.punch_time;\n\t\t\t\t\t\trow[date_string + '_data'] = punch;\n\t\t\t\t\t\trow[date_string + '_related_data'] = null;\n\t\t\t\t\t\tfind_position = true;\n\n\t\t\t\t\t\tif ( punch.status_id == 10 ) {\n\t\t\t\t\t\t\tnew_row = this.timesheet_data_source[j + 1];\n\t\t\t\t\t\t\tnew_row[date_string] = '';\n\t\t\t\t\t\t\tnew_row[date_string + '_data'] = null;\n\t\t\t\t\t\t\tnew_row[date_string + '_related_data'] = punch;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnew_row = this.timesheet_data_source[j - 1];\n\t\t\t\t\t\t\tnew_row[date_string] = '';\n\t\t\t\t\t\t\tnew_row[date_string + '_data'] = null;\n\t\t\t\t\t\t\tnew_row[date_string + '_related_data'] = punch;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t//Need add a new row\n\t\t\t\tif ( !find_position ) {\n\t\t\t\t\trow = {};\n\t\t\t\t\trow.punch_info = punch.status;\n\t\t\t\t\trow.user_id = punch.user_id;\n\t\t\t\t\trow[date_string] = punch.punch_time;\n\t\t\t\t\trow[date_string + '_data'] = punch;\n\t\t\t\t\trow[date_string + '_related_data'] = null;\n\t\t\t\t\trow.status_id = punch_status_id;\n\t\t\t\t\trow.type = TimeSheetViewController.PUNCH_ROW;\n\t\t\t\t\trow.id = row_id_counter;\n\t\t\t\t\trow_id_counter++;\n\t\t\t\t\tthis.timesheet_data_source.push( row );\n\n\t\t\t\t\tif ( punch_status_id == 10 ) {\n\n\t\t\t\t\t\tnew_row = {};\n\t\t\t\t\t\tnew_row.punch_info = $.i18n._( 'Out' );\n\t\t\t\t\t\tnew_row.user_id = punch.user_id;\n\t\t\t\t\t\tnew_row[date_string] = '';\n\t\t\t\t\t\tnew_row[date_string + '_data'] = null;\n\t\t\t\t\t\tnew_row[date_string + '_related_data'] = punch;\n\t\t\t\t\t\tnew_row.status_id = 20;\n\t\t\t\t\t\tnew_row.type = TimeSheetViewController.PUNCH_ROW;\n\t\t\t\t\t\tnew_row.id = row_id_counter;\n\t\t\t\t\t\trow_id_counter++;\n\t\t\t\t\t\tthis.timesheet_data_source.push( new_row );\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnew_row = {};\n\t\t\t\t\t\tnew_row.punch_info = $.i18n._( 'In' );\n\t\t\t\t\t\tnew_row.user_id = punch.user_id;\n\t\t\t\t\t\tnew_row[date_string] = '';\n\t\t\t\t\t\tnew_row[date_string + '_data'] = null;\n\t\t\t\t\t\tnew_row[date_string + '_related_data'] = punch;\n\t\t\t\t\t\tnew_row.status_id = 10;\n\t\t\t\t\t\tnew_row.type = TimeSheetViewController.PUNCH_ROW;\n\t\t\t\t\t\tnew_row.id = row_id_counter;\n\t\t\t\t\t\trow_id_counter++;\n\t\t\t\t\t\tthis.timesheet_data_source.splice( this.timesheet_data_source.length - 1, 0, new_row );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\trow = {};\n\t\trow.punch_info = $.i18n._( 'In' );\n\t\trow.user_id = this.getSelectEmployee();\n\t\trow.status_id = 10;\n\t\trow.type = TimeSheetViewController.PUNCH_ROW;\n\t\trow.id = row_id_counter;\n\t\trow_id_counter++;\n\t\tthis.timesheet_data_source.push( row );\n\n\t\trow = {};\n\t\trow.punch_info = $.i18n._( 'Out' );\n\t\trow.user_id = this.getSelectEmployee();\n\t\trow.status_id = 20;\n\t\trow.type = TimeSheetViewController.PUNCH_ROW;\n\t\trow.id = row_id_counter;\n\t\trow_id_counter++;\n\t\tthis.timesheet_data_source.push( row );\n\t}\n\n\tbuildTimeSheetsColumns() {\n\t\tthis.timesheet_columns = [];\n\t\tif ( this.getPunchMode() === 'manual' ) {\n\t\t\tvar cost_center_cols = [\n\t\t\t\t{ 'name': 'plus_sign', 'width': 25 },\n\t\t\t\t{ 'name': 'minus_sign', 'width': 25 }\n\t\t\t];\n\n\t\t\tif ( this.show_branch_ui ) {\n\t\t\t\tcost_center_cols.push( { 'name': 'branch', 'width': 125 } );\n\t\t\t}\n\n\t\t\tif ( this.show_department_ui ) {\n\t\t\t\tcost_center_cols.push( { 'name': 'department', 'width': 125 } );\n\t\t\t}\n\n\t\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\t\tif ( this.show_job_ui ) {\n\t\t\t\t\tcost_center_cols.push( { 'name': 'job', 'width': 170 } );\n\t\t\t\t}\n\n\t\t\t\tif ( this.show_job_item_ui ) {\n\t\t\t\t\tcost_center_cols.push( { 'name': 'job_item', 'width': 170 } );\n\t\t\t\t}\n\n\t\t\t\tif ( this.show_punch_tag_ui ) {\n\t\t\t\t\tcost_center_cols.push( { 'name': 'punch_tag', 'width': 170 } );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar last_col_index = cost_center_cols.length - 1;\n\t\t\tfor ( var i = 0; i < cost_center_cols.length; i++ ) {\n\t\t\t\tif ( i == last_col_index ) {\n\t\t\t\t\tvar column = {\n\t\t\t\t\t\tname: 'punch_info',\n\t\t\t\t\t\tindex: 'punch_info',\n\t\t\t\t\t\tlabel: ' ',\n\t\t\t\t\t\twidth: 170,\n\t\t\t\t\t\tsortable: false,\n\t\t\t\t\t\ttitle: false,\n\t\t\t\t\t\tformatter: this.onCellFormat,\n\t\t\t\t\t\tfixed: true\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tvar column = {\n\t\t\t\t\t\tname: 'empty_cell_' + i,\n\t\t\t\t\t\tindex: 'empty_cell_' + i,\n\t\t\t\t\t\tlabel: ' ',\n\t\t\t\t\t\twidth: cost_center_cols[i].width,\n\t\t\t\t\t\tsortable: false,\n\t\t\t\t\t\ttitle: false,\n\t\t\t\t\t\tfixed: true\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tthis.timesheet_columns.push( column );\n\t\t\t}\n\t\t} else {\n\t\t\tvar punch_in_out_column = {\n\t\t\t\tname: 'punch_info',\n\t\t\t\tindex: 'punch_info',\n\t\t\t\tlabel: ' ',\n\t\t\t\t//if not set to 0 in punch timesheet mode, the date column headers are a few px out of alignment and look bad.\n\t\t\t\t//see #2091 notes for link to the percent-based js fiddle\n\t\t\t\twidth: 100,\n\t\t\t\tsortable: false,\n\t\t\t\ttitle: false,\n\t\t\t\tformatter: this.onCellFormat,\n\t\t\t\tfixed: false\n\t\t\t};\n\t\t\tthis.timesheet_columns.push( punch_in_out_column );\n\t\t}\n\n\t\t//save full week columns map use to build no pey period column\n\t\tthis.column_maps = [];\n\t\tfor ( var i = 0; i < 7; i++ ) {\n\t\t\tvar current_date = new Date( new Date( this.start_date.getTime() ).setDate( this.start_date.getDate() + i ) );\n\t\t\tvar header_text = current_date.format( this.weekly_format );\n\n\t\t\t//Localize the day of week and month text.\n\t\t\tif ( LocalCacheData.getLoginData().language != 'en' && Global.isString( header_text ) ) {\n\t\t\t\tvar split_header_text_array = header_text.split( ',' );\n\t\t\t\tvar split_header_text_month = split_header_text_array[1].split( ' ' );\n\t\t\t\theader_text = $.i18n._( split_header_text_array[0] ) + ', ' + $.i18n._( split_header_text_month[1] ) + ' ' + split_header_text_month[2];\n\t\t\t}\n\n\t\t\tvar data_field = current_date.format( this.full_format );\n\n\t\t\tthis.column_maps.push( current_date.format() );\n\n\t\t\tvar column_info = {\n\t\t\t\tresizable: false,\n\t\t\t\tname: data_field,\n\t\t\t\tindex: data_field,\n\t\t\t\tlabel: header_text,\n\t\t\t\twidth: 100,\n\t\t\t\tsortable: false,\n\t\t\t\ttitle: false,\n\t\t\t\tformatter: this.onCellFormat\n\t\t\t};\n\t\t\tthis.timesheet_columns.push( column_info );\n\t\t}\n\n\t\treturn this.timesheet_columns;\n\t}\n\n\tgetDefaultDisplayColumns( callback ) {\n\t\t// Overriden to allow use of initLayout in BaseViewController, but no default display columns in this view, hence this function is 'disabled'\n\t\tcallback();\n\t}\n\n\tsetSelectLayout() {\n\t\tvar $this = this;\n\n\t\tif ( !Global.isSet( this.grid ) ) {\n\t\t\tvar grid = $( this.el ).find( '#grid' );\n\n\t\t\tgrid.attr( 'id', this.ui_id + '_grid' );  //Grid's id is ScriptName + _grid\n\n\t\t\tgrid = $( this.el ).find( '#' + this.ui_id + '_grid' );\n\t\t}\n\n\t\tif ( !this.select_layout ) { //Set to defalt layout if no layout at all\n\t\t\tthis.select_layout = { id: '' };\n\t\t\tthis.select_layout.data = { filter_data: {}, filter_sort: {} };\n\t\t}\n\n\t\tif ( this.select_layout.data.mode ) {\n\t\t\tthis.toggle_button.setValue( this.select_layout.data.mode );\n\t\t}\n\n\t\tthis.wage_btn.setValue( this.select_layout.data.show_wage ? true : false );\n\n\t\tthis.timezone_btn.setValue( this.select_layout.data.use_employee_timezone ? true : false );\n\n\t\t//search panel doesn't always exist.\n\t\tif ( this.search_panel ) {\n\t\t\t//Set Previous Saved layout combobox in layout panel\n\t\t\tvar layouts_array = this.search_panel.getLayoutsArray();\n\t\t\tif ( this.previous_saved_layout_selector ) {\n\t\t\t\tthis.previous_saved_layout_selector.empty();\n\t\t\t}\n\n\t\t\tif ( layouts_array && layouts_array.length > 0 ) {\n\t\t\t\tthis.previous_saved_layout_div.css( 'display', 'inline' );\n\n\t\t\t\tvar len = layouts_array.length;\n\t\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\t\tvar item = layouts_array[i];\n\t\t\t\t\tthis.previous_saved_layout_selector.append( $( '<option value=\"' + item.id + '\"></option>' ).text( item.name ) );\n\t\t\t\t}\n\n\t\t\t\t$( this.previous_saved_layout_selector.find( 'option' ) ).filter( function() {\n\t\t\t\t\treturn $( this ).attr( 'value' ) === $this.select_layout.id;\n\t\t\t\t} ).prop( 'selected', true ).attr( 'selected', true );\n\n\t\t\t} else {\n\t\t\t\tif ( this.previous_saved_layout_div ) {\n\t\t\t\t\tthis.previous_saved_layout_div.css( 'display', 'none' );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//replace select layout filter_data to filter set in onNavigation function when goto view from navigation context group\n\t\t\tif ( LocalCacheData.default_filter_for_next_open_view ) {\n\t\t\t\tthis.select_layout.data.filter_data = LocalCacheData.default_filter_for_next_open_view.filter_data;\n\t\t\t\tLocalCacheData.default_filter_for_next_open_view = null;\n\t\t\t}\n\n\t\t\tthis.filter_data = this.select_layout.data.filter_data;\n\n\t\t\tthis.setSearchPanelFilter( true ); //Auto change to property tab when set value to search fields.\n\t\t}\n\n\t\t// this.search( true ); // get punches base on userid, data and filter - commented out as this is already called in BaseViewController.initLayout()\n\t}\n\n\t//Start Drag\n\tsetTimesheetGridDragAble() {\n\t\tvar $this = this;\n\n\t\tvar position = 0;\n\t\tvar cells = this.grid.grid.find( '.date-column' ).parents( 'td' );\n\t\tcells.attr( 'draggable', true );\n\n\t\tcells.off( 'dragstart' ).on( 'dragstart', function( event ) {\n\n\t\t\tvar td = event.target;\n\t\t\tif ( $this.select_punches_array.length < 1 || !$( td ).hasClass( 'ui-state-highlight' ) || !$this.select_drag_menu_id ) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tvar container = $( '<div class=\\'drag-holder-div\\'></div>' );\n\n\t\t\tvar len = $this.select_punches_array.length;\n\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\tvar punch = $this.select_punches_array[i];\n\n\t\t\t\tvar span = $( '<span class=\\'drag-span\\'></span>' );\n\t\t\t\tspan.text( punch.status + ': ' + punch.time_stamp );\n\t\t\t\tcontainer.append( span );\n\t\t\t}\n\n\t\t\t$( 'body' ).find( '.drag-holder-div' ).remove();\n\n\t\t\t$( 'body' ).append( container );\n\n\t\t\tevent.originalEvent.dataTransfer.setData( 'Text', 'timesheet' );//JUST ELEMENT references is ok here NO ID\n\n\t\t\tif ( event.originalEvent.dataTransfer.setDragImage ) {\n\t\t\t\tevent.originalEvent.dataTransfer.setDragImage( container[0], 0, 0 );\n\t\t\t}\n\n\t\t\treturn true;\n\n\t\t} );\n\n\t\tcells.off( 'dragover' ).on( 'dragover', function( e ) {\n\n\t\t\tvar event = e.originalEvent;\n\n\t\t\tevent.preventDefault();\n\t\t\tvar $this = this;\n\t\t\tvar target = $( this );\n\n\t\t\t$( '.timesheet-drag-over' ).removeClass( 'timesheet-drag-over' );\n\t\t\t$( '.drag-over-top' ).removeClass( 'drag-over-top' );\n\t\t\t$( '.drag-over-center' ).removeClass( 'drag-over-center' );\n\t\t\t$( '.drag-over-bottom' ).removeClass( ' drag-over-bottom' );\n\n\t\t\t$( $this ).addClass( 'timesheet-drag-over' );\n\n\t\t\t//judge which area mouse on in the target cell and set proper style, Keep checking this in drag event.\n\t\t\tif ( event.pageY - target.offset().top <= 8 ) {\n\t\t\t\tposition = -1;\n\t\t\t\ttarget.removeClass( 'drag-over-top drag-over-center drag-over-bottom' ).addClass( 'drag-over-top' );\n\t\t\t} else if ( event.pageY - target.offset().top >= target.height() - 5 ) {\n\t\t\t\tposition = 1;\n\t\t\t\ttarget.removeClass( 'drag-over-top drag-over-center drag-over-bottom' ).addClass( 'drag-over-bottom' );\n\t\t\t} else {\n\t\t\t\tposition = 0;\n\t\t\t\ttarget.removeClass( 'drag-over-top drag-over-center drag-over-bottom' ).addClass( 'drag-over-center' );\n\t\t\t}\n\n\t\t} );\n\n\t\tcells.off( 'dragend' ).on( 'dragend', function( event ) {\n\n\t\t\t$( '.timesheet-drag-over' ).removeClass( 'timesheet-drag-over' );\n\t\t\t$( '.drag-over-top' ).removeClass( 'drag-over-top' );\n\t\t\t$( '.drag-over-center' ).removeClass( 'drag-over-center' );\n\t\t\t$( '.drag-over-bottom' ).removeClass( ' drag-over-bottom' );\n\t\t\t$( 'body' ).find( '.drag-holder-div' ).remove();\n\n\t\t} );\n\n\t\tcells.off( 'drop' ).on( 'drop', function( event ) {\n\n\t\t\tevent.preventDefault();\n\t\t\tif ( event.stopPropagation ) {\n\t\t\t\tevent.stopPropagation(); // stops the browser from redirecting.\n\t\t\t}\n\n\t\t\t$( this ).removeClass( 'drag-over-top drag-over-center drag-over-bottom timesheet-drag-over' );\n\t\t\tvar target_cell = event.currentTarget;\n\t\t\tvar i = 0; //start index;\n\n\t\t\tif ( $( target_cell ).index() === 0 ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t//Error: Uncaught TypeError: Cannot read property 'punch_date' of undefined in /interface/html5/#!m=TimeSheet&date=20141118&user_id=32916 line 4563\n\t\t\tif ( !$this.select_punches_array || !$this.select_punches_array[i] ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar punch = $this.select_punches_array[i];\n\n\t\t\tvar punch_date = Global.strToDate( punch.punch_date );\n\n\t\t\tvar row = $this.timesheet_data_source[target_cell.parentNode.rowIndex - 1];\n\n\t\t\t//Error: Uncaught TypeError: Cannot read property 'status_id' of undefined in /interface/html5/#!m=TimeSheet&date=20150108&user_id=1068 line 5174\n\t\t\tif ( !row ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar colModel = $this.grid.getGridParam( 'colModel' );\n\n\t\t\tvar data_field = colModel[target_cell.cellIndex].name;\n\n\t\t\tvar target_punch = row[data_field + '_data'];\n\n\t\t\tvar target_related_punch = row[data_field + '_related_data'];\n\n\t\t\tvar target_column_date = Global.strToDate( data_field, $this.full_format );\n\n\t\t\tvar first_select_date = punch_date;\n\n\t\t\tvar time_offset = target_column_date.getTime() - punch_date.getTime();\n\n\t\t\tvar target_column_date_str = target_column_date.format();\n\n\t\t\tsavePunch();\n\n\t\t\tfunction savePunch() {\n\t\t\t\t//Error: Uncaught TypeError: Cannot read property 'date_stamp' of undefined in /interface/html5/#!m=TimeSheet&date=20141229&user_id=39555 line 5207\n\t\t\t\tif ( !$this.select_punches_array ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar new_punch_id = punch.id;\n\t\t\t\tvar target_id = false;\n\t\t\t\tvar target_status_id = row.status_id;\n\t\t\t\tvar action_type = $this.select_drag_menu_id === 'move' ? 1 : 0;\n\n\t\t\t\t//Issue #2008 - All in-punches need target_id to be false to ensure that each pair retains its punch_control settings.\n\t\t\t\t//Most out-punches need their target id to be the related in-punch.\n\t\t\t\t//If these conditions are not met, copying groups of punches with different punch_control data will result in all copied punches having the same punch_control data as the first punch pair.\n\t\t\t\tif ( target_punch && punch.status_id == 20 ) {\n\t\t\t\t\ttarget_id = target_punch.id;\n\t\t\t\t\ttarget_status_id = false;\n\t\t\t\t} else if ( target_related_punch ) {\n\t\t\t\t\ttarget_id = target_related_punch.id;\n\t\t\t\t\tif ( target_related_punch.status_id == 10 ) {\n\t\t\t\t\t\tposition = 1;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tposition = -1;\n\t\t\t\t\t}\n\t\t\t\t\ttarget_status_id = false;\n\t\t\t\t}\n\n\t\t\t\tvar api_punch_control = TTAPI.APIPunchControl;\n\n\t\t\t\tapi_punch_control.dragNdropPunch( new_punch_id, target_id, target_status_id, position, action_type, target_column_date_str, {\n\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\tvar result_data = result.getResult();\n\t\t\t\t\t\t//Error: Uncaught TypeError: Cannot read property 'date_stamp' of undefined in interface/html5/#!m=TimeSheet&date=20150831&user_id=129895&show_wage=0 line 5286\n\t\t\t\t\t\tif ( result && result.isValid() && $this.select_punches_array && $this.select_punches_array.length > 0 ) {\n\t\t\t\t\t\t\ti = i + 1;\n\t\t\t\t\t\t\tif ( i > $this.select_cells_Array.length - 1 ) {\n\t\t\t\t\t\t\t\t$this.search( true );\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t//Error: Uncaught TypeError: Cannot read property 'date_stamp' of undefined in interface/html5/#!m=TimeSheet&date=20150831&user_id=129895&show_wage=0 line 5286\n\t\t\t\t\t\t\tif ( !$this.select_punches_array[i] ) {\n\t\t\t\t\t\t\t\t$this.search( true );\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\twhile ( !$this.select_punches_array[i].date_stamp ) {\n\t\t\t\t\t\t\t\ti = i + 1;\n\t\t\t\t\t\t\t\tif ( i > $this.select_cells_Array.length - 1 ) {\n\t\t\t\t\t\t\t\t\t$this.search( true );\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tposition = 1; //put next punch below last one\n\t\t\t\t\t\t\tvar last_date_string = target_column_date_str;\n\t\t\t\t\t\t\tpunch = $this.select_punches_array[i];\n\t\t\t\t\t\t\tpunch_date = Global.strToDate( punch.punch_date );\n\t\t\t\t\t\t\trow = $this.timesheet_data_source[target_cell.parentNode.rowIndex - 1];\n\t\t\t\t\t\t\tcolModel = $this.grid.getGridParam( 'colModel' );\n\t\t\t\t\t\t\tdata_field = colModel[target_cell.cellIndex].name;\n\t\t\t\t\t\t\ttime_offset = punch_date.getTime() - first_select_date.getTime();\n\t\t\t\t\t\t\t//drop column date\n\t\t\t\t\t\t\ttarget_column_date = Global.strToDate( data_field, $this.full_format );\n\t\t\t\t\t\t\t//Real target column date str\n\t\t\t\t\t\t\ttarget_column_date_str = new Date( target_column_date.getTime() + time_offset ).format();\n\t\t\t\t\t\t\ttarget_punch = { id: result_data };\n\t\t\t\t\t\t\ttarget_related_punch = null;\n\t\t\t\t\t\t\tif ( target_column_date_str !== last_date_string ) {\n\t\t\t\t\t\t\t\tposition = 0;\n\t\t\t\t\t\t\t\ttarget_punch = null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tsavePunch();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tTAlertManager.showAlert( $.i18n._( 'Unable to drag and drop punch to the specified location' ) );\n\t\t\t\t\t\t\tif ( i > 0 ) {\n\t\t\t\t\t\t\t\t$this.search( true );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t} );\n\t}\n\n\tsetPunchModeClass() {\n\t\tthis.$el.removeClass( 'timesheet-punch-mode' );\n\t\tthis.$el.removeClass( 'timesheet-manual-mode' );\n\t\tthis.getPunchMode() === 'punch' ? this.$el.addClass( 'timesheet-punch-mode' ) : this.$el.addClass( 'timesheet-manual-mode' );\n\t}\n\n\tinitData() {\n\t\tvar $this = this;\n\t\tGlobal.removeViewTab( this.viewId );\n\t\tvar loginUser = LocalCacheData.getLoginUser();\n\t\tthis.initOptions();\n\t\tProgressBar.showOverlay();\n\t\t// Set Wage\n\t\tif ( !LocalCacheData.last_timesheet_selected_show_wage ) {\n\t\t\tthis.wage_btn.setValue( false );\n\t\t} else {\n\t\t\tthis.wage_btn.setValue( LocalCacheData.last_timesheet_selected_show_wage );\n\t\t}\n\n\t\t//Error: TypeError: Cannot read property 'show_wage' of null\n\t\t//just need to check that the variable exists before checking properties for the case of the LocalCacheData being empty\n\t\tif ( Global.isSet( LocalCacheData.getAllURLArgs() ) && LocalCacheData.getAllURLArgs().show_wage ) {\n\t\t\tthis.wage_btn.setValue( LocalCacheData.getAllURLArgs().show_wage === '1' ? true : false );\n\t\t}\n\n\t\t// Set Use Employee TimeSheet\n\t\tif ( !LocalCacheData.last_timesheet_selected_timezone ) {\n\t\t\tthis.timezone_btn.setValue( false );\n\t\t} else {\n\t\t\tthis.timezone_btn.setValue( LocalCacheData.last_timesheet_selected_timezone );\n\t\t}\n\n\t\t//Error: TypeError: Cannot read property 'show_wage' of null\n\t\t//just need to check that the variable exists before checking properties for the case of the LocalCacheData being empty\n\t\tif ( Global.isSet( LocalCacheData.getAllURLArgs() ) && LocalCacheData.getAllURLArgs().timezone ) {\n\t\t\tthis.timezone_btn.setValue( LocalCacheData.getAllURLArgs().timezone === '1' ? true : false );\n\t\t}\n\n\t\t// Set punch mode\n\t\tif ( !this.show_punch_mode_ui ) {\n\t\t\tif ( !PermissionManager.validate( this.permission_id, 'punch_timesheet' ) && !PermissionManager.validate( this.permission_id, 'manual_timesheet' ) ) {\n\t\t\t\tthis.toggle_button.setValue( 'punch' );\n\t\t\t} else {\n\t\t\t\tif ( PermissionManager.validate( this.permission_id, 'punch_timesheet' ) ) {\n\t\t\t\t\tthis.toggle_button.setValue( 'punch' );\n\t\t\t\t}\n\t\t\t\tif ( Global.getProductEdition() >= 15 && PermissionManager.validate( this.permission_id, 'manual_timesheet' ) ) {\n\t\t\t\t\tthis.toggle_button.setValue( 'manual' );\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif ( !LocalCacheData.last_timesheet_selected_punch_mode ) {\n\t\t\t\tthis.toggle_button.setValue( 'punch' );\n\n\t\t\t} else {\n\t\t\t\tthis.toggle_button.setValue( LocalCacheData.last_timesheet_selected_punch_mode );\n\t\t\t}\n\t\t\tif ( LocalCacheData.getAllURLArgs().mode ) {\n\t\t\t\t// Fix wrong value from url\n\t\t\t\tthis.toggle_button.setValue( LocalCacheData.getAllURLArgs().mode === 'manual' ? 'manual' : 'punch' );\n\t\t\t}\n\t\t}\n\n\t\tif ( Global.UNIT_TEST_MODE == true ) {\n\t\t\tLocalCacheData.last_timesheet_selected_date = '15-Feb-18';\n\t\t}\n\t\t//replace select layout filter_data to filter set in onNavigation function when goto view from navigation context group\n\t\tif ( LocalCacheData.default_filter_for_next_open_view ) {\n\t\t\tthis.employee_nav.setValue( LocalCacheData.default_filter_for_next_open_view.user_id );\n\t\t\tthis.setDatePickerValue( LocalCacheData.default_filter_for_next_open_view.base_date );\n\t\t} else {\n\t\t\tif ( LocalCacheData.getAllURLArgs().user_id ) {\n\t\t\t\tthis.employee_nav.setValue( LocalCacheData.getAllURLArgs().user_id );\n\t\t\t} else if ( LocalCacheData.last_timesheet_selected_user ) {\n\t\t\t\tthis.employee_nav.setValue( LocalCacheData.last_timesheet_selected_user );\n\t\t\t} else {\n\t\t\t\t//Default set current login user as select Employee\n\t\t\t\tthis.employee_nav.setValue( loginUser );\n\t\t\t}\n\n\t\t\tif ( !LocalCacheData.last_timesheet_selected_date ) { //Saved current select date in cache. so still select last select date when go to other view and back\n\t\t\t\tif ( LocalCacheData.current_select_date && Global.strToDate( LocalCacheData.current_select_date, 'YYYY-MM-DD' ) ) { //Select date get from URL.\n\t\t\t\t\tthis.setDatePickerValue( Global.strToDate( LocalCacheData.current_select_date, 'YYYY-MM-DD' ).format() );\n\t\t\t\t\tLocalCacheData.current_select_date = '';\n\t\t\t\t} else {\n\t\t\t\t\tvar date = new Date();\n\t\t\t\t\tvar format = Global.getLoginUserDateFormat();\n\t\t\t\t\tvar dateStr = date.format( format );\n\t\t\t\t\tthis.setDatePickerValue( dateStr );\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tthis.setDatePickerValue( LocalCacheData.last_timesheet_selected_date );\n\t\t\t}\n\t\t}\n\n\t\t//Issue #3268 - Race condition where previous search layout will not exist in UI when expected as API for custom field data has not returned yet.\n\t\t//Timesheet overrides initData() from BaseViewController that waits on the custom field promise to resolve before continuing.\n\t\tTTPromise.wait( 'BaseViewController', 'getCustomFields', function() {\n\t\t\t$this.initLayout();\n\t\t} );\n\n\t\tthis.setMoveOrDropMode( this.select_drag_menu_id ? this.select_drag_menu_id : 'move' );\n\t}\n\n\tsetDatePickerValue( val ) {\n\t\tthis.start_date_picker.setValue( val );\n\n\t\tvar default_date = this.start_date_picker.getDefaultFormatValue();\n\n\t\tvar user_id = this.getSelectEmployee();\n\n\t\tif ( user_id &&\n\t\t\t!this.edit_view &&\n\t\t\t//Removing date from the generated URLs to avoid bookmarking to stale dates by users.\n\t\t\t//(window.location.href.indexOf( 'date=' + default_date ) === -1 || window.location.href.indexOf( 'user_id=' + this.getSelectEmployee() === -1 )) ) {\n\t\t\t( window.location.href.indexOf( 'user_id=' + user_id ) === -1 ) ) {\n\n\t\t\t//var location = Global.getBaseURL() + '#!m=' + this.viewId + '&date=' + default_date + '&user_id=' + this.getSelectEmployee() + '&show_wage=' + this.wage_btn.getValue( true ) + '&mode=' + this.toggle_button.getValue();\n\t\t\tvar location = Global.getBaseURL() + '#!m=' + this.viewId + '&user_id=' + user_id + '&show_wage=' + this.wage_btn.getValue( true ) + '&mode=' + this.toggle_button.getValue();\n\n\t\t\tif ( LocalCacheData.getAllURLArgs() ) {\n\t\t\t\tfor ( var key in LocalCacheData.getAllURLArgs() ) {\n\t\t\t\t\t//if ( key === 'm' || key === 'date' || key === 'user_id' || key === 'show_wage' || key === 'mode' ) {\n\t\t\t\t\tif ( key === 'm' || key === 'user_id' || key === 'show_wage' || key === 'timezone' || key === 'mode' ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tlocation = location + '&' + key + '=' + LocalCacheData.getAllURLArgs()[key];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tGlobal.setURLToBrowser( location );\n\n\t\t}\n\n\t\tLocalCacheData.last_timesheet_selected_date = val;\n\t}\n\n\tbuildSearchFields() {\n\n\t\tsuper.buildSearchFields();\n\t\tthis.search_fields = [\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Punch Branch' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'branch_id',\n\t\t\t\tlayout_name: 'global_branch',\n\t\t\t\tapi_class: TTAPI.APIBranch,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Punch Department' ),\n\t\t\t\tfield: 'department_id',\n\t\t\t\tin_column: 1,\n\t\t\t\tlayout_name: 'global_department',\n\t\t\t\tapi_class: TTAPI.APIDepartment,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Job' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'job_id',\n\t\t\t\tlayout_name: 'global_job',\n\t\t\t\tapi_class: ( Global.getProductEdition() >= 20 ) ? TTAPI.APIJob : null,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: ( this.show_job_item_ui && ( Global.getProductEdition() >= 20 ) ),\n\t\t\t\tadv_search: false,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Task' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'job_item_id',\n\t\t\t\tlayout_name: 'global_job_item',\n\t\t\t\tapi_class: ( Global.getProductEdition() >= 20 ) ? TTAPI.APIJobItem : null,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: ( this.show_job_item_ui && ( Global.getProductEdition() >= 20 ) ),\n\t\t\t\tadv_search: false,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Tags' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'punch_tag_id',\n\t\t\t\tlayout_name: 'global_punch_tag',\n\t\t\t\tapi_class: ( Global.getProductEdition() >= 20 ) ? TTAPI.APIPunchTag : null,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: ( this.show_punch_tag_ui && ( Global.getProductEdition() >= 20 ) ),\n\t\t\t\tadv_search: false,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} )\n\t\t];\n\t}\n\n\tgetSelectEmployee( full_item ) {\n\t\tvar user = false;\n\t\tif ( this.show_navigation_box && this.employee_nav && typeof this.employee_nav.getValue == 'function' ) {\n\t\t\tuser = this.employee_nav.getValue( true ); //Always try to get the object (not the id), however in some cases like recalculating timesheets it still seems to return the ID instead of the object.\n\t\t}\n\n\t\t//Convert object if it isn't already, to make logic lower down easier.\n\t\tif ( Global.isObject( user ) == false ) {\n\t\t\tuser = { id: user };\n\t\t}\n\n\t\tif ( Global.isObject( user ) == false || ( Global.isObject( user ) == true && ( user.hasOwnProperty( 'id' ) == false || TTUUID.isUUID( user.id ) == false ) ) ) {\n\t\t\tuser = LocalCacheData.getLoginUser();\n\n\t\t\tif ( Global.isObject( user ) == false || ( Global.isObject( user ) == true && ( user.hasOwnProperty( 'id' ) == false || TTUUID.isUUID( user.id ) == false ) ) ) {\n\t\t\t\t//currently logged in user object is corrupt.\n\t\t\t\tMenuManager.doLogout();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tif ( full_item != true && ( Global.isObject( user ) == true && user.hasOwnProperty( 'id' ) == true && TTUUID.isUUID( user.id ) == true ) ) {\n\t\t\tuser = user.id;\n\t\t}\n\n\t\treturn user;\n\t}\n\n\tgetSelectDate() {\n\t\tif ( this.start_date_picker ) {\n\t\t\tvar retval = this.start_date_picker.getValue();\n\n\t\t\tif ( retval == 'Invalid date' ) {\n\t\t\t\tretval = new Date();\n\t\t\t}\n\n\t\t\treturn retval;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tonDeleteResult( result ) {\n\t\tvar $this = this;\n\t\t$this.timesheet_grid.grid.find( 'td.ui-state-highlight' ).removeClass( 'ui-state-highlight' );\n\t\tProgressBar.closeOverlay();\n\t\tif ( result && result.isValid() ) {\n\t\t\tif ( $this.edit_view ) {\n\t\t\t\tif ( LocalCacheData.current_doing_context_action === 'delete' ) {\n\t\t\t\t\t$this.removeEditView();\n\t\t\t\t} else if ( $this.edit_view && LocalCacheData.current_doing_context_action === 'delete_and_next' ) {\n\t\t\t\t\t$this.onRightArrowClick();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.setCurrentEditViewState( '' );\n\t\t\t}\n\t\t} else {\n\t\t\t$this.revertEditViewState();\n\t\t\tTAlertManager.showErrorAlert( result );\n\t\t}\n\n\t\t// refresh and rebuild search grid, as well as default menu\n\t\t$this.first_build = true;\n\t\t$this.search();\n\t\t$this.setDefaultMenu(); //Default menu needs to be set as we need to deactivate icons that are valid for the predeletion selection\n\t}\n\n\tgetDeleteSelectedRecordId() {\n\t\tvar retval = [];\n\t\tif ( this.edit_view ) {\n\t\t\tretval.push( this.current_edit_record.id );\n\t\t} else {\n\t\t\tfor ( var i in this.select_punches_array ) {\n\t\t\t\tvar item = this.select_punches_array[i];\n\t\t\t\tretval.push( item.id );\n\t\t\t}\n\t\t}\n\t\treturn retval;\n\t}\n\n\treSetURL() {\n\t\t//var args = '#!m=' + this.viewId + '&date=' + this.start_date_picker.getDefaultFormatValue() + '&user_id=' + this.getSelectEmployee() + '&show_wage=' + this.wage_btn.getValue( true ) + '&mode=' + this.toggle_button.getValue();\n\t\tvar args = '#!m=' + this.viewId + '&user_id=' + this.getSelectEmployee() + '&show_wage=' + this.wage_btn.getValue( true ) + '&timezone=' + this.timezone_btn.getValue( true ) + '&mode=' + this.toggle_button.getValue();\n\t\tGlobal.setURLToBrowser( Global.getBaseURL() + args );\n\t\tLocalCacheData.setAllURLArgs( Global.buildArgDic( args.split( '&' ) ) );\n\t}\n\n\tonSaveAndContinue( ignoreWarning ) {\n\t\tvar $this = this;\n\t\tif ( !Global.isSet( ignoreWarning ) ) {\n\t\t\tignoreWarning = false;\n\t\t}\n\t\tthis.is_changed = false;\n\t\tLocalCacheData.current_doing_context_action = 'save_and_continue';\n\t\tvar current_api = this.getCurrentAPI();\n\n\t\tif ( this.is_mass_adding && this.current_edit_record.punch_dates && this.current_edit_record.punch_dates.length === 1 ) {\n\t\t\tthis.current_edit_record.punch_date = this.current_edit_record.punch_dates[0];\n\t\t}\n\n\t\tcurrent_api.setIsIdempotent( true ); //Force to idempotent API call to avoid duplicate network requests from causing errors displayed to the user.\n\t\tcurrent_api['set' + current_api.key_name]( this.current_edit_record, false, ignoreWarning, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tif ( result && result.isValid() ) {\n\t\t\t\t\tvar result_data = result.getResult();\n\t\t\t\t\tvar refresh_id;\n\t\t\t\t\tif ( result_data === true ) {\n\t\t\t\t\t\trefresh_id = $this.current_edit_record.id;\n\n\t\t\t\t\t} else if ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) {\n\t\t\t\t\t\trefresh_id = result_data;\n\t\t\t\t\t}\n\t\t\t\t\t$this.search();\n\t\t\t\t\t$this.onEditClick( refresh_id, $this.getPunchPermissionType() );\n\n\t\t\t\t\t//#2295 - Re-initialize previous_absence_policy_id to ensure that previously saved values are passed correctly into the estimation of projected available balance.\n\t\t\t\t\t$this.previous_absence_policy_id = false;\n\n\t\t\t\t\t$this.onSaveAndContinueDone( result );\n\t\t\t\t} else {\n\t\t\t\t\t$this.setErrorMenu();\n\t\t\t\t\t$this.setErrorTips( result );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tgetSelectedRecordId( record ) {\n\t\tvar retval = false;\n\n\t\tif ( Global.isSet( record ) ) {\n\t\t\tif ( Global.isObject( record ) && record.id ) {\n\t\t\t\tretval = record.id;\n\t\t\t} else if ( Global.isString( record ) && TTUUID.isUUID( record ) ) {\n\t\t\t\tretval = record;\n\t\t\t}\n\t\t} else {\n\t\t\tif ( this.select_punches_array.length > 0 ) {\n\t\t\t\tretval = this.select_punches_array[0].id;\n\t\t\t} else {\n\t\t\t\tretval = null;\n\t\t\t}\n\t\t}\n\n\t\treturn retval;\n\t}\n\n\tgetViewSelectedRecordId( record ) {\n\t\treturn this.getSelectedRecordId( record );\n\t}\n\n\tdoViewAPICall( filter, api_args ) {\n\t\tvar current_api = this.getCurrentAPI();\n\t\tvar callback = { onResult: this.handleViewAPICallbackResult.bind( this ) };\n\t\tif ( api_args ) {\n\t\t\t// If api_args specified, use api_args.filter, and ignore function filter parameter.\n\t\t\tapi_args.push( callback );\n\t\t\treturn current_api['get' + current_api.key_name].apply( current_api, api_args );\n\t\t} else {\n\t\t\treturn current_api['get' + current_api.key_name]( filter, callback );\n\t\t}\n\t}\n\n\tonViewClick( record, type ) {\n\t\tvar tmp_record_id = this.getViewSelectedRecordId( record );\n\t\tif ( Global.isFalseOrNull( tmp_record_id ) || tmp_record_id == TTUUID.not_exist_id ) {\n\t\t\tTAlertManager.showAlert( $.i18n._( 'This punch is still being processed, please try again later.' )  );\n\t\t\tProgressBar.closeOverlay();\n\t\t\treturn;\n\t\t}\n\n\t\tif ( type ) {\n\t\t\tif ( type === 'absence' ) {\n\t\t\t\tthis.absence_model = true;\n\t\t\t} else {\n\t\t\t\tthis.absence_model = false;\n\t\t\t}\n\t\t}\n\t\tsuper.onViewClick( record );\n\t}\n\n\tbuildOtherFieldUI( field, label ) {\n\n\t\tif ( !this.edit_view_tab ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar form_item_input;\n\t\tvar $this = this;\n\t\tvar tab_punch = this.edit_view_tab.find( '#tab_punch' );\n\t\tvar tab_punch_column1 = tab_punch.find( '.first-column' );\n\n\t\tif ( $this.edit_view_ui_dic[field] ) {\n\t\t\tform_item_input = $this.edit_view_ui_dic[field];\n\t\t\tform_item_input.setValue( $this.current_edit_record[field] );\n\t\t} else {\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tform_item_input.TTextInput( { field: field } );\n\t\t\tvar input_div = $this.addEditFieldToColumn( label, form_item_input, tab_punch_column1 );\n\n\t\t\tinput_div.insertBefore( this.edit_view_form_item_dic['note'] );\n\n\t\t\tform_item_input.setValue( $this.current_edit_record[field] );\n\t\t}\n\t\tform_item_input.css( 'opacity', 1 );\n\t\tform_item_input.css( 'minWidth', 300 );\n\n\t\tif ( $this.is_viewing ) {\n\t\t\tform_item_input.setEnabled( false );\n\t\t} else {\n\t\t\tform_item_input.setEnabled( true );\n\t\t}\n\t}\n\n\tonMassEditClick() {\n\t\tvar $this = this;\n\t\tLocalCacheData.current_doing_context_action = 'mass_edit';\n\t\tthis.is_mass_editing = true;\n\t\t$this.openEditView();\n\t\tthis.is_mass_adding = false;\n\t\tthis.is_viewing = false;\n\n\t\tvar current_api = this.getCurrentAPI();\n\n\t\tvar filter = {};\n\t\tthis.mass_edit_record_ids = [];\n\n\t\t$.each( this.select_punches_array, function( index, value ) {\n\t\t\t$this.mass_edit_record_ids.push( value.id );\n\t\t} );\n\n\t\tfilter.filter_data = {};\n\t\tfilter.filter_data.id = this.mass_edit_record_ids;\n\n\t\tcurrent_api['getCommon' + current_api.key_name + 'Data']( filter, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tvar result_data = result.getResult();\n\t\t\t\tcurrent_api['getOptions']( 'unique_columns', {\n\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\t$this.unique_columns = result.getResult();\n\t\t\t\t\t\tcurrent_api['getOptions']( 'linked_columns', {\n\t\t\t\t\t\t\tonResult: function( result1 ) {\n\n\t\t\t\t\t\t\t\t$this.linked_columns = result1.getResult();\n\n\t\t\t\t\t\t\t\tif ( $this.sub_view_mode && $this.parent_key ) {\n\t\t\t\t\t\t\t\t\tresult_data[$this.parent_key] = $this.parent_value;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif ( !Global.isSet( result_data.time_stamp ) ) {\n\t\t\t\t\t\t\t\t\tresult_data.time_stamp = false;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t$this.current_edit_record = result_data;\n\t\t\t\t\t\t\t\t$this.initEditView();\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tsetSubLogViewFilter() {\n\t\tif ( !this.sub_log_view_controller ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.sub_log_view_controller.getSubViewFilter = function( filter ) {\n\n\t\t\tif ( !this.parent_view_controller.absence_model ) {\n\t\t\t\tfilter['table_name_object_id'] = {\n\t\t\t\t\t'punch': [this.parent_edit_record.id],\n\t\t\t\t\t'punch_control': [this.parent_edit_record.punch_control_id]\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tfilter['table_name'] = 'user_date_total';\n\t\t\t\tfilter['object_id'] = this.parent_edit_record.id;\n\n\t\t\t}\n\n\t\t\treturn filter;\n\t\t};\n\n\t\treturn true;\n\t}\n\n\tgetEditSelectedRecordId( record_id ) {\n\t\treturn this.getSelectedRecordId( record_id );\n\t}\n\n\tdoEditAPICall( filter, api_args ) {\n\t\tvar current_api = this.getCurrentAPI();\n\t\tvar callback = { onResult: this.handleEditAPICallbackResult.bind( this ) };\n\t\tif ( api_args ) {\n\t\t\t// If api_args specified, use api_args.filter, and ignore function filter parameter.\n\t\t\tapi_args.push( callback );\n\t\t\treturn current_api['get' + current_api.key_name].apply( current_api, api_args );\n\t\t} else {\n\t\t\treturn current_api['get' + current_api.key_name]( filter, callback );\n\t\t}\n\t}\n\n\tonEditClick( record_id, type ) {\n\t\tvar tmp_record_id = this.getViewSelectedRecordId( record_id );\n\t\tif ( Global.isFalseOrNull( tmp_record_id ) || tmp_record_id == TTUUID.not_exist_id ) {\n\t\t\tTAlertManager.showAlert( $.i18n._( 'This punch is still being processed, please try again later.' )  );\n\t\t\tProgressBar.closeOverlay();\n\t\t\treturn;\n\t\t}\n\n\t\tif ( type ) {\n\t\t\tif ( type === 'absence' ) {\n\t\t\t\tthis.absence_model = true;\n\t\t\t} else {\n\t\t\t\tthis.absence_model = false;\n\t\t\t}\n\t\t}\n\t\tsuper.onEditClick( record_id );\n\t}\n\n\tsetURL() {\n\t\tvar t = this.getPunchPermissionType();\n\t\tvar a = '';\n\t\tswitch ( LocalCacheData.current_doing_context_action ) {\n\t\t\tcase 'new':\n\t\t\tcase 'edit':\n\t\t\tcase 'view':\n\t\t\t\ta = LocalCacheData.current_doing_context_action;\n\t\t\t\tbreak;\n\t\t\tcase 'copy_as_new':\n\t\t\t\ta = 'new';\n\t\t\t\tbreak;\n\t\t}\n\n\t\tvar tab_name = this.edit_view_tab ? this.edit_view_tab.find( '.edit-view-tab-bar-label' ).children().eq( this.getEditViewTabIndex() ).text() : '';\n\t\ttab_name = tab_name.replace( /\\/|\\s+/g, '' );\n\n\t\t//Error: Unable to get property 'id' of undefined or null reference in /interface/html5/views/BaseViewController.js?v=8.0.0-20141117-132941 line 2234\n\t\tif ( this.current_edit_record && this.current_edit_record.id ) {\n\n\t\t\tif ( a ) {\n\t\t\t\t//Global.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&date=' + this.start_date_picker.getDefaultFormatValue() + '&user_id=' + this.getSelectEmployee() + '&show_wage=' + this.wage_btn.getValue( true ) + '&mode=' + this.toggle_button.getValue() + '&a=' + a + '&id=' + this.current_edit_record.id + '&t=' + t +\n\t\t\t\tGlobal.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&user_id=' + this.getSelectEmployee() + '&show_wage=' + this.wage_btn.getValue( true ) + '&mode=' + this.toggle_button.getValue() + '&a=' + a + '&id=' + this.current_edit_record.id + '&t=' + t + '&tab=' + tab_name );\n\t\t\t} else {\n\t\t\t\t//Global.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&date=' + this.start_date_picker.getDefaultFormatValue() + '&user_id=' + this.getSelectEmployee() + '&show_wage=' + this.wage_btn.getValue( true ) + '&mode=' + this.toggle_button.getValue() + '&id=' + this.current_edit_record.id + '&t=' + t );\n\t\t\t\tGlobal.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&user_id=' + this.getSelectEmployee() + '&show_wage=' + this.wage_btn.getValue( true ) + '&mode=' + this.toggle_button.getValue() + '&id=' + this.current_edit_record.id + '&t=' + t );\n\t\t\t}\n\n\t\t\tGlobal.trackView();\n\n\t\t} else {\n\n\t\t\tif ( a ) {\n\t\t\t\t//Global.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&date=' + this.start_date_picker.getDefaultFormatValue() + '&user_id=' + this.getSelectEmployee() + '&show_wage=' + this.wage_btn.getValue( true ) + '&mode=' + this.toggle_button.getValue() + '&a=' + a + '&t=' + t +\n\t\t\t\tGlobal.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&user_id=' + this.getSelectEmployee() + '&show_wage=' + this.wage_btn.getValue( true ) + '&mode=' + this.toggle_button.getValue() + '&a=' + a + '&t=' + t + '&tab=' + tab_name );\n\t\t\t} else {\n\t\t\t\t//Global.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&date=' + this.start_date_picker.getDefaultFormatValue() + '&user_id=' + this.getSelectEmployee() + '&show_wage=' + this.wage_btn.getValue( true ) + '&mode=' + this.toggle_button.getValue() + '&t=' + t );\n\t\t\t\tGlobal.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&user_id=' + this.getSelectEmployee() + '&show_wage=' + this.wage_btn.getValue( true ) + '&mode=' + this.toggle_button.getValue() + '&t=' + t );\n\t\t\t}\n\n\t\t}\n\t}\n\n\tonCustomContextClick( id ) {\n\t\tswitch ( id ) {\n\t\t\tcase 'add': //This is caught by onContextMenuClick(), so we have to use a different id: add_punch instead.\n\t\t\tcase 'add_punch':\n\t\t\t\tthis.absence_model = false;\n\t\t\t\tthis.onAddClick();\n\t\t\t\tbreak;\n\t\t\tcase 'add_absence':\n\t\t\t\tthis.absence_model = true;\n\t\t\t\tthis.onAddClick();\n\t\t\t\tbreak;\n\t\t\tcase 'move':\n\t\t\tcase 'drag_copy':\n\t\t\t\tthis.setMoveOrDropMode( id );\n\t\t\t\tbreak;\n\t\t\tcase 'in_out':\n\t\t\t\tMenuManager.openSelectView( 'InOut' );\n\t\t\t\tbreak;\n\t\t\tcase 'schedule':\n\t\t\tcase 'pay_stub':\n\t\t\tcase 'edit_employee':\n\t\t\tcase 'edit_pay_period':\n\t\t\t\tthis.onNavigationClick( id );\n\t\t\t\tbreak;\n\t\t\tcase 're_calculate_timesheet':\n\t\t\tcase 'generate_pay_stub':\n\t\t\t\tthis.onWizardClick( id );\n\t\t\t\tbreak;\n\t\t\tcase 'map':\n\t\t\t\tthis.onMapClick( id );\n\t\t\t\tbreak;\n\t\t\tcase 'accumulated_time':\n\t\t\t\tthis.onAccumulatedTimeClick( id );\n\t\t\t\tbreak;\n\t\t\tcase 'AddRequest':\n\t\t\t\t// Preventing TypeError: Cannot read property 'date' of undefined\n\t\t\t\tif ( this.select_cells_Array.length > 0 ) {\n\t\t\t\t\tthis.addRequestFromTimesheetCell( id );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'print_summary':\n\t\t\tcase 'print_detailed':\n\t\t\t\tthis.onReportMenuClick( id );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\taddRequestFromTimesheetCell( id ) {\n\t\tif ( Global.getProductEdition() <= 10 ) {\n\t\t\tTAlertManager.showAlert( Global.getUpgradeMessage() );\n\t\t\treturn false;\n\t\t}\n\n\t\tvar current_column_field = Global.strToDate( this.select_cells_Array[0].date ? this.select_cells_Array[0].date : this.start_date_picker.getValue() ).format( this.full_format );\n\n\t\tif ( this.select_cells_Array[0].punch ) {\n\t\t\tvar punch_control_id = this.select_cells_Array[0].punch.punch_control_id;\n\t\t\tvar current_punch_id = this.select_cells_Array[0].punch.id;\n\t\t\tvar current_punch_status_id = this.select_cells_Array[0].punch.status_id;\n\t\t\tvar type_id = this.select_cells_Array[0].punch.type_id;\n\t\t\tvar user_id = this.select_cells_Array[0].punch.user_id;\n\t\t} else {\n\t\t\tvar user_id = this.getSelectEmployee();\n\t\t\tvar punch_control_id = null;\n\t\t\tvar current_punch_id = null;\n\t\t\tvar current_punch_status_id = 10;\n\t\t\tvar type_id = 10;\n\t\t}\n\n\t\tvar previous_punch_id = null;\n\t\tif ( !current_punch_id ) {\n\t\t\t//row_id is numeric here.\n\t\t\tif ( this.select_cells_Array[0].row_id > 1 && this.timesheet_data_source[this.select_cells_Array[0].row_id - 2] && this.timesheet_data_source[this.select_cells_Array[0].row_id - 2][current_column_field + '_data'] ) {\n\t\t\t\tprevious_punch_id = this.timesheet_data_source[this.select_cells_Array[0].row_id - 2][current_column_field + '_data'].id;\n\t\t\t\ttype_id = this.timesheet_data_source[this.select_cells_Array[0].row_id - 2][current_column_field + '_data'].type_id;\n\t\t\t\tvar tmp_status_id = this.timesheet_data_source[this.select_cells_Array[0].row_id - 2][current_column_field + '_data'].status_id;\n\n\t\t\t\t// Issue #2895 - Request text would show a break / lunch out even though the last punch was an in.\n\t\t\t\tif ( current_punch_status_id == 10 && tmp_status_id == 10 && type_id != 10 ) { //Status 10=In,20=Out  -- Type: 10=Normal, 20=Lunch, 30=Break\n\t\t\t\t\t// This has to be a normal out punch as the last punch was an in.\n\t\t\t\t\ttype_id = 10;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//blank and has no previous punch so we need to infer status_id from the selected row's status\n\t\t\tif ( this.timesheet_data_source[this.select_cells_Array[0].row_id - 1] ) {\n\t\t\t\tcurrent_punch_status_id = this.timesheet_data_source[this.select_cells_Array[0].row_id - 1].status_id;\n\t\t\t}\n\t\t}\n\n\t\tvar date = this.select_cells_Array[0].time_stamp_num / 1000;\n\t\tvar $this = this;\n\t\tthis.api_punch.getRequestDefaultData(\n\t\t\tuser_id,\n\t\t\tdate,\n\t\t\tpunch_control_id,\n\t\t\tprevious_punch_id,\n\t\t\tcurrent_punch_status_id,\n\t\t\ttype_id,\n\t\t\tcurrent_punch_id, {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\tvar request = result.getResult();\n\t\t\t\t\tIndexViewController.openEditView( $this, 'Request', request, null, 'openAddView' );\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tgetPayPeriod( date ) {\n\t\tvar current_date = this.getSelectDate();\n\n\t\t//if pass a date in, use the date\n\t\tif ( date ) {\n\t\t\tcurrent_date = date;\n\t\t}\n\n\t\tif ( this.pay_period_map && this.pay_period_map[current_date] && this.pay_period_map[current_date] != TTUUID.zero_id && TTUUID.isUUID( this.pay_period_map[current_date] ) == true ) {\n\t\t\treturn this.pay_period_map[current_date];\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tonNavigationClick( iconName ) {\n\n\t\tif ( !this.checkTimesheetData() ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar post_data;\n\n\t\tswitch ( iconName ) {\n\t\t\tcase 'in_out':\n\t\t\t\tIndexViewController.openEditView( LocalCacheData.current_open_primary_controller, 'InOut' );\n\t\t\t\tbreak;\n\t\t\tcase 'edit_employee':\n\t\t\t\tIndexViewController.openEditView( this, 'Employee', this.getSelectEmployee() );\n\t\t\t\tbreak;\n\t\t\tcase 'edit_pay_period':\n\t\t\t\tvar pay_period_id = this.getPayPeriod();\n\t\t\t\tif ( pay_period_id ) {\n\t\t\t\t\tIndexViewController.openEditView( this, 'PayPeriods', pay_period_id );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'schedule':\n\t\t\t\tvar filter = { filter_data: {} };\n\t\t\t\tvar include_users = { value: [this.getSelectEmployee()] };\n\t\t\t\tfilter.filter_data.include_user_ids = include_users;\n\t\t\t\tfilter.select_date = this.getSelectDate();\n\n\t\t\t\tGlobal.addViewTab( this.viewId, $.i18n._( 'TimeSheet' ), window.location.href );\n\t\t\t\tIndexViewController.goToView( 'Schedule', filter );\n\n\t\t\t\tbreak;\n\t\t\tcase 'pay_stub':\n\t\t\t\tfilter = { filter_data: {} };\n\t\t\t\tvar users = { value: [this.getSelectEmployee()] };\n\t\t\t\tfilter.filter_data.user_id = users;\n\n\t\t\t\tGlobal.addViewTab( this.viewId, $.i18n._( 'TimeSheet' ), window.location.href );\n\t\t\t\tIndexViewController.goToView( 'PayStub', filter );\n\n\t\t\t\tbreak;\n\t\t\tcase 'print_summary':\n\n\t\t\t\tfilter = { time_period: {} };\n\t\t\t\tfilter.time_period.time_period = 'custom_pay_period';\n\t\t\t\tfilter.time_period.pay_period_id = this.timesheet_verify_data.pay_period_id;\n\t\t\t\tfilter.include_user_id = [this.getSelectEmployee()];\n\t\t\t\tpost_data = { 0: filter, 1: 'pdf_timesheet' };\n\t\t\t\tthis.doFormIFrameCall( post_data );\n\t\t\t\tbreak;\n\t\t\tcase 'print_detailed':\n\t\t\t\tfilter = { time_period: {} };\n\t\t\t\tfilter.time_period.time_period = 'custom_pay_period';\n\t\t\t\tfilter.time_period.pay_period_id = this.timesheet_verify_data.pay_period_id;\n\t\t\t\tfilter.include_user_id = [this.getSelectEmployee()];\n\t\t\t\tpost_data = { 0: filter, 1: 'pdf_timesheet_detail' };\n\t\t\t\tthis.doFormIFrameCall( post_data );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tdoFormIFrameCall( postData ) {\n\t\tGlobal.APIFileDownload( 'APITimesheetDetailReport', 'getTimesheetDetailReport', postData );\n\t}\n\n\tonAccumulatedTimeClick() {\n\t\tif ( PermissionManager.checkTopLevelPermission( 'AccumulatedTime' ) ) {\n\t\t\tvar select_date = Global.strToDate( this.getSelectDate() ).format( 'YYYY-MM-DD' );\n\t\t\tIndexViewController.openEditView( this, 'UserDateTotalParent', select_date );\n\t\t}\n\t}\n\n\tonMapClick() {\n\t\t// only trigger map load in specific product editions.\n\t\tif ( ( Global.getProductEdition() >= 15 ) ) {\n\n\t\t\t// TODO: this is repeated below, perhaps in future now that getFilterColumnsFromDisplayColumns() is commented out, this can be consolidated?\n\t\t\tvar data = {\n\t\t\t\tfilter_columns: {\n\t\t\t\t\tid: true,\n\t\t\t\t\tlatitude: true,\n\t\t\t\t\tlongitude: true,\n\t\t\t\t\tpunch_date: true,\n\t\t\t\t\tpunch_time: true,\n\t\t\t\t\tposition_accuracy: true,\n\t\t\t\t\tuser_id: true\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tvar punches = [];\n\t\t\tvar map_options = {};\n\n\t\t\tif ( this.edit_view ) {\n\t\t\t\tpunches.push( this.current_edit_record );\n\t\t\t\tif ( !this.is_viewing ) {\n\t\t\t\t\t// make sure that when view only (so no save) marker is not draggable, and thus no new marker can be added either.\n\t\t\t\t\tmap_options.single_marker_draggable = true;\n\t\t\t\t}\n\t\t\t} else if ( this.select_punches_array && this.select_punches_array.length > 0 ) {\n\t\t\t\tvar ids = [];\n\t\t\t\tthis.select_punches_array.map( function( punch ) {\n\t\t\t\t\tif ( punch.id ) {\n\t\t\t\t\t\tids.push( punch.id );\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t\tdata.filter_data = Global.convertLayoutFilterToAPIFilter( this.select_layout );\n\t\t\t\tif ( data.filter_data && ids.length > 0 ) {\n\t\t\t\t\tdata.filter_data.id = ids;\n\t\t\t\t}\n\t\t\t\t// data.filter_columns = this.getFilterColumnsFromDisplayColumns()\n\t\t\t\tdata.filter_columns.first_name = true;\n\t\t\t\tdata.filter_columns.last_name = true;\n\t\t\t\tdata.filter_columns.user_id = true;\n\t\t\t\tdata.filter_columns.date_stamp = true; // #2735 - grouping punches by date_stamp instead of punch_date, to allow cross date punch controls to plot distances.\n\t\t\t\tdata.filter_columns.punch_date = true;\n\t\t\t\tdata.filter_columns.punch_time = true;\n\t\t\t\tdata.filter_columns.time_stamp = true;\n\t\t\t\tdata.filter_columns.status = true;\n\t\t\t\tdata.filter_columns.punch_control_id = true;\n\t\t\t\tdata.filter_columns.branch = true;\n\t\t\t\tdata.filter_columns.branch_id = true;\n\t\t\t\tdata.filter_columns.department = true;\n\t\t\t\tdata.filter_columns.department_id = true;\n\t\t\t\tdata.filter_columns.job_manual_id = true;\n\t\t\t\tdata.filter_columns.job = true;\n\t\t\t\tdata.filter_columns.job_id = true;\n\t\t\t\tdata.filter_columns.job_item_manual_id = true;\n\t\t\t\tdata.filter_columns.job_item = true; // also known as Task\n\t\t\t\tdata.filter_columns.job_item_id = true;\n\t\t\t\tdata.filter_columns.punch_tag = true;\n\t\t\t\tdata.filter_columns.punch_tag_id = true;\n\t\t\t\tdata.filter_columns.total_time = true;\n\t\t\t\tdata.filter_columns.latitude = true;\n\t\t\t\tdata.filter_columns.longitude = true;\n\t\t\t\tdata.filter_columns.position_accuracy = true;\n\n\t\t\t\tpunches = this.api.getPunch( data, { async: false } ).getResult();\n\t\t\t}\n\n\t\t\t// There is not enough detail in the 'punches' data pulled from the grid, get the full data from api, like PunchesViewController\n\t\t\t// Note there seems to be a multple ways to get the data e.g. select_punches_array,\n\t\t\t// but other view controllers use .getGridSelectIdArray() and theres also select_cells_Array.\n\t\t\t// TODO-future: Perhaps look at a future refactor/consolidation of all these?\n\n\t\t\tif ( Global.isArray( punches ) ) {\n\t\t\t\timport( /* webpackChunkName: \"leaflet-timetrex\" */ '@/framework/leaflet/leaflet-timetrex' ).then(( module )=>{\n\t\t\t\t\tvar processed_punches_for_map = module.TTConvertMapData.processPunchesFromViewController( punches, map_options );\n\t\t\t\t\tIndexViewController.openEditView( this, 'Map', processed_punches_for_map );\n\t\t\t\t}).catch( Global.importErrorHandler );\n\t\t\t} else {\n\t\t\t\tDebug.Text( 'ERROR: Either punches is not an array, or data is empty', 'TimeSheetViewController.js', 'TimeSheetViewController', 'onMapClick', 1 );\n\t\t\t\tTAlertManager.showAlert( $.i18n._( 'Selected punches no longer exist, unable to map.' ) );\n\t\t\t}\n\t\t}\n\t}\n\n\tonWizardClick( iconName ) {\n\n\t\tvar $this = this;\n\t\tswitch ( iconName ) {\n\t\t\tcase 're_calculate_timesheet':\n\t\t\t\tvar default_data = {};\n\t\t\t\tdefault_data.user_id = this.getSelectEmployee();\n\n\t\t\t\tvar pay_period_id = this.getPayPeriod();\n\t\t\t\tif ( pay_period_id ) {\n\t\t\t\t\tdefault_data.pay_period_id = pay_period_id;\n\t\t\t\t}\n\t\t\t\tIndexViewController.openWizard( 'ReCalculateTimeSheetWizard', default_data, function() {\n\n\t\t\t\t\t$this.onReCalTimeSheetDone();\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\tcase 'generate_pay_stub':\n\n\t\t\t\tdefault_data = {};\n\t\t\t\tdefault_data.user_id = this.getSelectEmployee();\n\n\t\t\t\tpay_period_id = this.getPayPeriod();\n\t\t\t\tif ( pay_period_id ) {\n\t\t\t\t\tdefault_data.pay_period_id = [pay_period_id];\n\t\t\t\t} else {\n\t\t\t\t\tdefault_data.pay_period_id = [];\n\t\t\t\t}\n\t\t\t\tIndexViewController.openWizard( 'GeneratePayStubWizard', default_data, function() {\n\t\t\t\t\t$this.search();\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tonReCalTimeSheetDone() {\n\t\t//Its possible the user has navigated away from the timesheet while a recalculation is in progress, if so, don't try to refresh the timesheet.\n\t\t//Also fixes: Uncaught TypeError: Failed to execute 'replaceChild' on 'Node': parameter 2 is not of type 'Node'.\n\n\t\tif ( MenuManager.isCurrentView( 'TimeSheet' ) ) {\n\t\t\tMenuManager.goToView( 'TimeSheet', true );\n\t\t\t//this.initData(); //Do a generic view refresh rather than just initData() as its less likely to cause problems.\n\t\t}\n\t}\n\n\tsetMoveOrDropMode( id ) {\n\t\tvar context_menu_array = ContextMenuManager.getMenuModelByMenuId( this.determineContextMenuMountAttributes().id );\n\t\tvar drag_copy_icon = context_menu_array.find( icon => icon.id === 'drag_copy' );\n\t\tvar move_icon = context_menu_array.find( icon => icon.id === 'move' );\n\n\t\tif ( drag_copy_icon === undefined || move_icon === undefined ) {\n\t\t\treturn;\n\t\t}\n\n\t\tContextMenuManager.activateMenuItem( this.determineContextMenuMountAttributes().id, drag_copy_icon.id, true );\n\t\tContextMenuManager.activateMenuItem( this.determineContextMenuMountAttributes().id, move_icon.id, true );\n\t\tvar drag_invisible = false;\n\t\tvar move_invisible = false;\n\n\t\tif ( !this.copyPermissionValidate() ) {\n\t\t\tdrag_invisible = true;\n\t\t}\n\n\t\tif ( !this.movePermissionValidate() ) {\n\t\t\tmove_invisible = true;\n\t\t}\n\n\t\tif ( move_invisible && id === 'move' ) {\n\t\t\tContextMenuManager.activateMenuItem( this.determineContextMenuMountAttributes().id, drag_copy_icon.id, false );\n\t\t} else {\n\t\t\tvar icon = context_menu_array.find( icon => icon.id === id );\n\t\t\tContextMenuManager.activateMenuItem( this.determineContextMenuMountAttributes().id, icon.id, false );\n\t\t}\n\n\t\tif ( drag_invisible && move_invisible ) {\n\t\t\tthis.select_drag_menu_id = null;\n\t\t} else {\n\t\t\tthis.select_drag_menu_id = id;\n\t\t}\n\t}\n\n\tgetSelectDateArray() {\n\n\t\tvar result = [];\n\n\t\tvar cells_array = this.absence_model ? this.absence_select_cells_Array : this.select_cells_Array;\n\n\t\tvar len = cells_array.length;\n\n\t\tvar date_dic = {};\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar item = cells_array[i];\n\t\t\tdate_dic[item.date] = true;\n\t\t}\n\n\t\tfor ( var key in date_dic ) {\n\t\t\tresult.push( key );\n\t\t}\n\n\t\tif ( result.length === 0 ) {\n\t\t\tresult = [this.getSelectDate()];\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tonAddClick( doing_save_and_new ) {\n\t\tTTPromise.add( 'TimeSheetViewController', 'addclick' );\n\t\tTTPromise.wait();\n\t\tvar $this = this;\n\t\tthis.setCurrentEditViewState( 'new' );\n\t\tthis.is_mass_adding = true; //Is always true because we always want the user to be able to select multiple dates.\n\t\tvar punch_control_id = null;\n\t\tvar prev_punch_id = null;\n\t\tvar related_punch = null;\n\t\tvar date = this.getSelectDate();\n\t\tvar status_id = 10, type_id = 10, select_cell;\n\n\t\tif ( !this.absence_model ) {\n\t\t\tif ( this.select_cells_Array.length === 1 ) {\n\t\t\t\tvar select_item = this.select_cells_Array[0];\n\t\t\t\tif ( select_item.related_punch ) {\n\t\t\t\t\trelated_punch = select_item.related_punch;\n\t\t\t\t\tpunch_control_id = select_item.related_punch.punch_control_id;\n\t\t\t\t\tprev_punch_id = select_item.related_punch.id;\n\t\t\t\t} else {\n\t\t\t\t\t//Error: Uncaught TypeError: Cannot read property 'format' of null in interface/html5/#!m=TimeSheet&date=20151006&user_id=51085&show_wage=0 line 6292\n\t\t\t\t\tvar current_column_field = Global.strToDate( select_item.date ? select_item.date : this.start_date_picker.getValue() ).format( this.full_format );\n\n\t\t\t\t\tif ( select_item && select_item.punch && select_item.punch.punch_control_id ) {\n\t\t\t\t\t\tpunch_control_id = select_item.punch.punch_control_id;\n\t\t\t\t\t}\n\n\t\t\t\t\t//row_id is numeric here\n\t\t\t\t\tif ( this.timesheet_data_source && this.timesheet_data_source[select_item.row_id - 2] ) {\n\t\t\t\t\t\tvar pre_punch = this.timesheet_data_source[select_item.row_id - 2][current_column_field + '_data'];\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( pre_punch ) {\n\t\t\t\t\t\tprev_punch_id = pre_punch.id;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t\t// To use proper context menu for each punch or abseonce mode.\n\t\t\tthis.setDefaultMenu();\n\t\t\t$this.openEditView();\n\n\t\t\tif ( doing_save_and_new ) {\n\t\t\t\tdate = this.current_edit_record.punch_date;\n\t\t\t\trelated_punch = null;\n\t\t\t\tif ( this.current_edit_record.status_id == 10 ) {\n\t\t\t\t\tpunch_control_id = this.current_edit_record.punch_control_id;\n\t\t\t\t} else {\n\t\t\t\t\tpunch_control_id = null;\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( this.select_cells_Array.length === 1 ) {\n\t\t\t\tselect_cell = this.select_cells_Array[0];\n\t\t\t\tstatus_id = select_cell.status_id;\n\n\t\t\t\tvar select_date = Global.strToDate( this.start_date_picker.getValue() );\n\t\t\t\tvar new_date = new Date( new Date( select_date.getTime() ).setDate( select_date.getDate() - 1 ) );\n\t\t\t\tif ( new_date.getTime() < this.start_date.getTime() ) {\n\t\t\t\t\ttype_id = 10;\n\t\t\t\t} else {\n\t\t\t\t\tvar row_data = this.timesheet_data_source[select_cell.row_id - 1];\n\t\t\t\t\t//Error: Unable to get property 'Sun-Dec-13-2015_data' of undefined or null reference in interface/html5/ line 6362\n\t\t\t\t\tvar left_side_punch = row_data && row_data[new_date.format( this.full_format ) + '_data'];\n\t\t\t\t\tif ( left_side_punch ) {\n\t\t\t\t\t\ttype_id = left_side_punch.type_id;\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttype_id = 10;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tselect_cell = this.select_cells_Array[0];\n\t\t\t\tif ( select_cell && select_cell.status_id ) {\n\t\t\t\t\tstatus_id = select_cell.status_id;\n\t\t\t\t} else {\n\t\t\t\t\tstatus_id = 10; //In\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.api['get' + this.api.key_name + 'DefaultData']( this.getSelectEmployee(),\n\t\t\t\tdate,\n\t\t\t\tpunch_control_id,\n\t\t\t\tprev_punch_id,\n\t\t\t\tstatus_id,\n\t\t\t\ttype_id,\n\t\t\t\t{\n\t\t\t\t\tonResult: function( result ) {\n\n\t\t\t\t\t\tvar result_data = result.getResult();\n\n\t\t\t\t\t\tif ( !Global.isSet( result_data.time_stamp ) ) {\n\t\t\t\t\t\t\tresult_data.time_stamp = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresult_data.punch_date = $this.getSelectDate();\n\n\t\t\t\t\t\tif ( doing_save_and_new ) {\n\t\t\t\t\t\t\tresult_data.punch_date = $this.current_edit_record.punch_date;\n\n\t\t\t\t\t\t\tif ( $this.current_edit_record.status_id == 10 ) {\n\t\t\t\t\t\t\t\tresult_data.status_id = 20;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tresult_data.status_id = 10;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$this.current_edit_record = result_data;\n\t\t\t\t\t\t$this.initEditView();\n\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t} else { //Absence model branch\n\n\t\t\tif ( doing_save_and_new ) {\n\t\t\t\tdate = this.current_edit_record.date_stamp;\n\t\t\t}\n\t\t\t// To use proper context menu for each punch or abseonce mode.\n\t\t\t$this.setDefaultMenu();\n\t\t\t$this.openEditView();\n\t\t\tthis.api_user_date_total['get' + this.api_user_date_total.key_name + 'DefaultData']( this.getSelectEmployee(),\n\t\t\t\tdate,\n\t\t\t\t{\n\t\t\t\t\tonResult: function( result ) {\n\n\t\t\t\t\t\tvar result_data = result.getResult();\n\n\t\t\t\t\t\tif ( !Global.isSet( result_data.time_stamp ) ) {\n\t\t\t\t\t\t\tresult_data.time_stamp = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( Global.isSet( $this.absence_select_cells_Array[0] ) ) {\n\t\t\t\t\t\t\tresult_data.src_object_id = $this.absence_select_cells_Array[0].src_object_id;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresult_data.object_type_id = 50;\n\n\t\t\t\t\t\tresult_data.date_stamp = $this.getSelectDate();\n\t\t\t\t\t\t$this.current_edit_record = result_data;\n\t\t\t\t\t\t$this.initEditView();\n\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t}\n\t}\n\n\tremoveEditView() {\n\t\tsuper.removeEditView();\n\t\tif ( this.absence_select_cells_Array.length > 0 ) {\n\t\t\tthis.absence_model = true;\n\t\t} else {\n\t\t\tthis.absence_model = false;\n\t\t}\n\t\tthis.setDefaultMenu();\n\t}\n\n\tisMassDate() {\n\t\t//Error: Unable to get property 'punch_dates' of undefined or null reference in /interface/html5/ line 6300\n\t\tif ( this.is_mass_adding && this.current_edit_record && this.current_edit_record.punch_dates && this.current_edit_record.punch_dates.length > 1 ) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tsetEditMenuSaveAndContinueIcon( context_btn ) {\n\t\tthis.saveAndContinueValidate( context_btn, this.getPunchPermissionType() );\n\n\t\tif ( this.is_mass_editing || this.is_viewing || this.isMassDate() ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tonSaveAndNewClick( ignoreWarning ) {\n\t\tvar $this = this;\n\t\tif ( !Global.isSet( ignoreWarning ) ) {\n\t\t\tignoreWarning = false;\n\t\t}\n\t\tvar current_api = this.getCurrentAPI();\n\t\tLocalCacheData.current_doing_context_action = 'new';\n\n\t\tvar record = this.current_edit_record;\n\n\t\tif ( this.is_mass_adding ) {\n\n\t\t\trecord = [];\n\t\t\tvar dates_array = this.current_edit_record.punch_dates;\n\n\t\t\tif ( dates_array && dates_array.indexOf( ' - ' ) > 0 ) {\n\t\t\t\tdates_array = this.parserDatesRange( dates_array );\n\t\t\t}\n\n\t\t\tfor ( var i = 0; i < dates_array.length; i++ ) {\n\t\t\t\tvar common_record = Global.clone( this.current_edit_record );\n\t\t\t\tdelete common_record.punch_dates;\n\t\t\t\tif ( this.absence_model ) {\n\t\t\t\t\tcommon_record.date_stamp = dates_array[i];\n\t\t\t\t} else {\n\t\t\t\t\tcommon_record.punch_date = dates_array[i];\n\t\t\t\t}\n\n\t\t\t\trecord.push( common_record );\n\t\t\t}\n\t\t}\n\n\t\tcurrent_api.setIsIdempotent( true ); //Force to idempotent API call to avoid duplicate network requests from causing errors displayed to the user.\n\t\tcurrent_api['set' + current_api.key_name]( record, false, ignoreWarning, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tif ( result && result.isValid() ) {\n\t\t\t\t\t$this.search( false );\n\t\t\t\t\t$this.onAddClick( true );\n\t\t\t\t} else {\n\t\t\t\t\t$this.setErrorMenu();\n\t\t\t\t\t$this.setErrorTips( result );\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\t_continueDoCopyAsNew() {\n\t\tvar $this = this;\n\t\tLocalCacheData.current_doing_context_action = 'copy_as_new';\n\t\tthis.is_mass_adding = true;\n\n\t\tif ( Global.isSet( this.edit_view ) ) {\n\t\t\tthis.current_edit_record.id = '';\n\n\t\t\tif ( !this.absence_model ) {\n\n\t\t\t\tthis.current_edit_record.punch_control_id = '';\n\n\t\t\t\tif ( this.current_edit_record.status_id == 10 ) {\n\t\t\t\t\tthis.current_edit_record.status_id = 20;\n\n\t\t\t\t} else {\n\t\t\t\t\tthis.current_edit_record.status_id = 10;\n\t\t\t\t}\n\n\t\t\t\tthis.edit_view_ui_dic['status_id'].setValue( this.current_edit_record.status_id );\n\t\t\t}\n\n\t\t\tvar navigation_div = this.edit_view.find( '.navigation-div' );\n\t\t\tnavigation_div.css( 'display', 'none' );\n\t\t\tthis.openEditView();\n\t\t\tthis.initEditView();\n\t\t\tthis.setEditMenu();\n\t\t\tthis.setTabStatus();\n\t\t\tthis.is_changed = false;\n\t\t\tProgressBar.closeOverlay();\n\t\t}\n\t}\n\n\tonSaveAndCopy( ignoreWarning ) {\n\t\tvar $this = this;\n\t\tif ( !Global.isSet( ignoreWarning ) ) {\n\t\t\tignoreWarning = false;\n\t\t}\n\t\tvar current_api = this.getCurrentAPI();\n\t\tthis.is_changed = false;\n\t\tLocalCacheData.current_doing_context_action = 'save_and_copy';\n\t\tvar record = this.current_edit_record;\n\t\tif ( this.is_mass_adding ) {\n\n\t\t\trecord = [];\n\t\t\tvar dates_array = this.current_edit_record.punch_dates;\n\n\t\t\tif ( dates_array && dates_array.indexOf( ' - ' ) > 0 ) {\n\t\t\t\tdates_array = this.parserDatesRange( dates_array );\n\t\t\t}\n\n\t\t\tfor ( var i = 0; i < dates_array.length; i++ ) {\n\t\t\t\tvar common_record = Global.clone( this.current_edit_record );\n\t\t\t\tdelete common_record.punch_dates;\n\t\t\t\tif ( this.absence_model ) {\n\t\t\t\t\tcommon_record.date_stamp = dates_array[i];\n\t\t\t\t} else {\n\t\t\t\t\tcommon_record.punch_date = dates_array[i];\n\t\t\t\t}\n\n\t\t\t\trecord.push( common_record );\n\t\t\t}\n\t\t}\n\n\t\tthis.clearNavigationData();\n\n\t\tcurrent_api.setIsIdempotent( true ); //Force to idempotent API call to avoid duplicate network requests from causing errors displayed to the user.\n\t\tcurrent_api['set' + current_api.key_name]( record, false, ignoreWarning, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tif ( result && result.isValid() ) {\n\t\t\t\t\tvar result_data = result.getResult();\n\t\t\t\t\t$this.search( false );\n\t\t\t\t\t$this.onCopyAsNewClick();\n\t\t\t\t} else {\n\t\t\t\t\t$this.setErrorMenu();\n\t\t\t\t\t$this.setErrorTips( result );\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tgetCurrentAPI() {\n\t\tvar current_api = this.api;\n\n\t\tif ( this.absence_model ) {\n\t\t\tcurrent_api = this.api_user_date_total;\n\t\t}\n\n\t\treturn current_api;\n\t}\n\n\tgenerateManualTimeSheetRecordKey( item ) {\n\t\tvar key = item.date_stamp + '-' + ( ( this.show_branch_ui && item.branch_id ) ? item.branch_id : TTUUID.zero_id ) +\n\t\t\t'-' + ( ( this.show_department_ui && item.department_id ) ? item.department_id : TTUUID.zero_id )\n\t\t\t+ '-' + ( ( this.show_job_ui && item.job_id && Global.getProductEdition() >= 20 ) ? item.job_id : TTUUID.zero_id ) +\n\t\t\t'-' + ( ( this.show_job_item_ui && item.job_item_id && Global.getProductEdition() >= 20 ) ? item.job_item_id : TTUUID.zero_id ) +\n\t\t\t'-' + ( ( this.show_punch_tag_ui && item.punch_tag_id && item.punch_tag_id.length > 0 && Global.getProductEdition() >= 20 ) ? item.punch_tag_id : TTUUID.zero_id ) +\n\t\t\t'-' + item.total_time;\n\n\t\treturn key;\n\t}\n\n\tcreateCurrentManualGridRecordsMap( records ) {\n\t\tthis.manual_grid_records_map = {};\n\n\t\tfor ( var i = 0, m = records.length; i < m; i++ ) {\n\t\t\tvar item = records[i];\n\n\t\t\tvar key = this.generateManualTimeSheetRecordKey( item );\n\t\t\tif ( item.id ) {\n\t\t\t\tkey = item.id + '-' + key;\n\t\t\t}\n\n\t\t\tthis.manual_grid_records_map[key] = item.row;\n\t\t\tdelete item.row;\n\t\t}\n\t}\n\n\t//Don't send records with blank total_time to the API, to better handle cases where the employees hire date is in the middle of the week and they accidently enter time on the Monday, which cause a popup validation error.\n\t//This allows them to get out of the scenario by simply clearing out the field or setting it back to 0.\n\tfilterManualGridRecords( records ) {\n\t\tvar retarr = Array();\n\n\t\tfor ( var i = 0; i < records.length; i++ ) {\n\t\t\tvar item = records[i];\n\n\t\t\tif ( item.id || ( !item.id && item.hasOwnProperty( 'total_time' ) && ( item.total_time != 0 || item.note ) ) ) { //Notes can be added to records that do not yet have hours set.\n\t\t\t\tretarr.push( item );\n\t\t\t}\n\t\t}\n\n\t\treturn retarr;\n\t}\n\n\tonSaveClick( ignoreWarning ) {\n\t\tvar $this = this;\n\t\tvar record;\n\t\t// Save manual punch\n\t\tif ( this.getPunchMode() === 'manual' && !this.edit_view ) {\n\t\t\tvar records = this.editor.getValue( true ); // reset is_changed\n\t\t\tif ( records.length > 0 ) {\n\t\t\t\tthis.wait_auto_save && clearTimeout( this.wait_auto_save );\n\t\t\t\tthis.createCurrentManualGridRecordsMap( records );\n\t\t\t\tProgressBar.noProgressForNextCall();\n\t\t\t\tthis.is_saving_manual_grid = true;\n\t\t\t\tthis.setDefaultMenu();\n\n\t\t\t\trecords = this.filterManualGridRecords( records );\n\t\t\t\tif ( records.length > 0 ) {\n\t\t\t\t\tthis.api_user_date_total['set' + this.api_user_date_total.key_name]( records, {\n\t\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\t\tif ( !result.isValid() ) {\n\t\t\t\t\t\t\t\tTAlertManager.showErrorAlert( result );\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$this.updateManualGrid();\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\n\t\t\t\t} else {\n\t\t\t\t\t$this.updateManualGrid();\n\t\t\t\t}\n\n\t\t\t\tProgressBar.showNanobar();\n\t\t\t\tProgressBar.closeOverlay();\n\t\t\t} else {\n\t\t\t\tProgressBar.closeOverlay();\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\t//Save normal punch\n\t\tif ( !Global.isSet( ignoreWarning ) ) {\n\t\t\tignoreWarning = false;\n\t\t}\n\t\tLocalCacheData.current_doing_context_action = 'save';\n\t\tvar current_api = this.getCurrentAPI();\n\n\t\tif ( this.is_mass_editing ) {\n\n\t\t\tvar check_fields = {};\n\t\t\tfor ( var key in this.edit_view_ui_dic ) {\n\t\t\t\tvar widget = this.edit_view_ui_dic[key];\n\n\t\t\t\tif ( Global.isSet( widget.isChecked ) ) {\n\t\t\t\t\tif ( widget.isChecked() ) {\n\t\t\t\t\t\tcheck_fields[key] = this.current_edit_record[key];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trecord = [];\n\t\t\t$.each( this.mass_edit_record_ids, function( index, value ) {\n\t\t\t\tvar common_record = Global.clone( check_fields );\n\t\t\t\tcommon_record.id = value;\n\t\t\t\trecord.push( common_record );\n\n\t\t\t} );\n\t\t} else {\n\t\t\trecord = this.current_edit_record;\n\t\t}\n\n\t\t// Error: Uncaught TypeError: Cannot read property 'punch_dates' of null in /interface/html5/#!m=TimeSheet&date=20150323&user_id=69543 line 6448\n\t\tif ( this.is_mass_adding && this.current_edit_record ) {\n\n\t\t\trecord = [];\n\t\t\tvar dates_array = this.current_edit_record.punch_dates;\n\n\t\t\tif ( dates_array && dates_array.indexOf( ' - ' ) > 0 ) {\n\t\t\t\tdates_array = this.parserDatesRange( dates_array );\n\t\t\t}\n\n\t\t\tfor ( var i = 0; i < dates_array.length; i++ ) {\n\t\t\t\tvar common_record = Global.clone( this.current_edit_record );\n\t\t\t\tdelete common_record.punch_dates;\n\t\t\t\tif ( this.absence_model ) {\n\t\t\t\t\tcommon_record.date_stamp = dates_array[i];\n\t\t\t\t} else {\n\t\t\t\t\tcommon_record.punch_date = dates_array[i];\n\t\t\t\t}\n\n\t\t\t\trecord.push( common_record );\n\t\t\t}\n\t\t}\n\n\t\tcurrent_api.setIsIdempotent( true ); //Force to idempotent API call to avoid duplicate network requests from causing errors displayed to the user.\n\t\tcurrent_api['set' + current_api.key_name]( record, false, ignoreWarning, {\n\t\t\tonResult: function( result ) {\n\n\t\t\t\tif ( result && result.isValid() ) {\n\t\t\t\t\t$this.first_build = true;\n\t\t\t\t\t$this.search();\n\n\t\t\t\t\t$this.removeEditView();\n\n\t\t\t\t\t//#2295 - Re-initialize previous_absence_policy_id to ensure that previously saved values are passed correctly into the estimation of projected available balance.\n\t\t\t\t\t$this.previous_absence_policy_id = false;\n\t\t\t\t} else {\n\t\t\t\t\t$this.setErrorMenu();\n\t\t\t\t\t$this.setErrorTips( result );\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tonMapSaveClick( dataset, successCallback ) {\n\t\tthis.savePunchPosition( dataset, successCallback );\n\t}\n\n\tsavePunchPosition( moved_unsaved_markers, successCallback ) {\n\t\tif ( !moved_unsaved_markers || moved_unsaved_markers.length !== 1 ) {\n\t\t\tDebug.Text( 'ERROR: Invalid params/data passed to function.', 'TimesheetViewConroller.js', 'TimesheetViewConroller', 'savePunchPosition', 1 );\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( this.is_mass_editing == true ) {\n\t\t\tthis.location_mass_edit_check_box.find( '.mass-edit-checkbox' )[0].checked = true;\n\t\t}\n\n\t\tthis.setLocationValue( moved_unsaved_markers[0] );\n\t\tsuccessCallback();\n\t\tthis.is_changed = true;\n\t\treturn true;\n\t}\n\n\tgetOtherFieldTypeId() {\n\t\tvar res = 15;\n\n\t\tif ( this.absence_model ) {\n\t\t\tres = 0;\n\t\t}\n\n\t\treturn res;\n\t}\n\n\t/**\n\t * This function is special as it handles an edit view that deals with both absences and punches.\n\t * This is the only place where 2 different data layouts need to be handled by the same navigation without a change of view.\n\t */\n\tsetEditViewData() {\n\t\tvar $this = this;\n\t\tvar navigation_div = this.edit_view.find( '.navigation-div' );\n\t\tvar navigation_widget_div = navigation_div.find( '.navigation-widget-div' );\n\n\t\tthis.is_changed = false;\n\n\t\tif ( Global.isSet( this.current_edit_record.id ) && this.current_edit_record.id ) {\n\t\t\t//fixing both #2171 and #2227\n\t\t\t//preventing unclickable navigation and \"cannot find property or function has of undefined.\"\n\t\t\tnavigation_div.css( 'display', 'block' );\n\t\t\tthis.navigation = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\t//Set Navigation Awesomebox\n\t\t\tif ( this.absence_model ) {\n\t\t\t\tthis.navigation.AComboBox( {\n\t\t\t\t\tid: this.script_name + '_navigation',\n\t\t\t\t\tlayout_name: 'global_absence'\n\t\t\t\t} );\n\n\t\t\t\tif ( this.absence_original_source ) {\n\t\t\t\t\tthis.navigation.setSourceData( this.absence_original_source );\n\t\t\t\t\tthis.navigation.is_punch_nav = false;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.navigation.AComboBox( {\n\t\t\t\t\tid: this.script_name + '_navigation',\n\t\t\t\t\tlayout_name: 'global_timesheet'\n\t\t\t\t} );\n\n\t\t\t\tif ( this.full_timesheet_data ) {\n\t\t\t\t\tthis.navigation.setSourceData( this.full_timesheet_data.punch_data );\n\t\t\t\t\tthis.navigation.is_punch_nav = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.navigation.setValue( this.current_edit_record );\n\n\t\t\tnavigation_widget_div.html( this.navigation );\n\t\t\t// #2122 - Fixes navigation errors including: \"Cannot read property 'current_page' of null\" & \"Cannot read property 'has' of null\"\n\t\t\t// Prevents user clicking on drop-down to navigate to the first record then immediately clicking the left arrow which triggers the errors.\n\t\t\tthis.setNavigation();\n\n\t\t} else {\n\t\t\tnavigation_div.css( 'display', 'none' );\n\t\t}\n\n\t\tfor ( var key in this.edit_view_ui_dic ) {\n\n\t\t\t//Set all UI field to current edit record, we need validate all UI fielld when save and validate\n\t\t\tif ( !Global.isSet( $this.current_edit_record[key] ) && !this.is_mass_editing ) {\n\t\t\t\t$this.current_edit_record[key] = false;\n\t\t\t}\n\t\t}\n\n\t\tif ( this.is_mass_editing ) {\n\t\t\tfor ( var key in this.edit_view_ui_dic ) {\n\t\t\t\tvar widget = this.edit_view_ui_dic[key];\n\t\t\t\tif ( Global.isSet( widget.setMassEditMode ) ) {\n\t\t\t\t\twidget.setMassEditMode( true );\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t$.each( this.unique_columns, function( index, value ) {\n\n\t\t\t\tif ( Global.isSet( $this.edit_view_ui_dic[value] ) && Global.isSet( $this.edit_view_ui_dic[value].setEnabled ) ) {\n\t\t\t\t\t$this.edit_view_ui_dic[value].setEnabled( false );\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t}\n\n\t\tthis.setNavigationArrowsEnabled();\n\n\t\t// Create this function alone because of the column value of view is different from each other, some columns need to be handle specially. and easily to rewrite this function in sub-class.\n\t\tthis.setCurrentEditRecordData();\n\n\t\t//Init *Please save this record before modifying any related data* box\n\t\tthis.edit_view.find( '.save-and-continue-div' ).SaveAndContinueBox( { related_view_controller: this } );\n\t\tthis.edit_view.find( '.save-and-continue-div' ).css( 'display', 'none' );\n\n\t\tthis.initTabData();\n\t\tthis.switchToProperTab();\n\t}\n\n\tsetCurrentEditRecordData() {\n\t\t//Set current edit record data to all widgets\n\t\tvar $this = this;\n\n\t\tvar tab_0_label = this.edit_view.find( 'a[ref=tab_punch]' );\n\t\tif ( tab_0_label ) {\n\t\t\tif ( this.absence_model ) {\n\t\t\t\ttab_0_label.text( $.i18n._( 'Absence' ) );\n\t\t\t} else {\n\t\t\t\ttab_0_label.text( $.i18n._( 'Punch' ) );\n\t\t\t}\n\t\t}\n\n\t\t//This needs to be done here or the user id gets stuck and subsequent punches for subordinates go to the admin's timesheet.\n\t\tthis.current_edit_record.user_id = this.getSelectEmployee();\n\n\t\tfor ( var key in this.current_edit_record ) {\n\n\t\t\tif ( !this.current_edit_record.hasOwnProperty( key ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tvar widget = this.edit_view_ui_dic[key];\n\t\t\tvar args;\n\t\t\tif ( Global.isSet( widget ) ) {\n\t\t\t\tswitch ( key ) {\n\t\t\t\t\tcase 'punch_dates':\n\t\t\t\t\t\tvar date_array;\n\t\t\t\t\t\tif ( !this.current_edit_record.punch_dates ) {\n\t\t\t\t\t\t\tdate_array = this.getSelectDateArray();\n\t\t\t\t\t\t\tthis.current_edit_record.punch_dates = date_array;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdate_array = this.current_edit_record.punch_dates;\n\t\t\t\t\t\t}\n\t\t\t\t\t\twidget.setValue( date_array );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'first_last_name':\n\t\t\t\t\t\tvar select_employee = this.getSelectEmployee( true ); //Get full item\n\t\t\t\t\t\t//Error: Uncaught TypeError: Cannot read property 'first_name' of null in interface/html5/#!m=TimeSheet&date=null&user_id=null&show_wage=0&a=new&t=punch&tab=Punch line 6810\n\t\t\t\t\t\tif ( select_employee ) {\n\t\t\t\t\t\t\twidget.setValue( select_employee['first_name'] + ' ' + select_employee['last_name'] );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'total_time':\n\t\t\t\t\t\tif ( this.absence_model ) {\n\t\t\t\t\t\t\tvar result = Global.getTimeUnit( this.current_edit_record[key] );\n\t\t\t\t\t\t\twidget.setValue( result );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'station_id':\n\t\t\t\t\t\tif ( this.current_edit_record[key] ) {\n\t\t\t\t\t\t\tthis.setStation();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twidget.setValue( 'N/A' );\n\t\t\t\t\t\t\twidget.css( 'cursor', 'default' );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'punch_image':\n\t\t\t\t\t\tvar station_form_item = this.edit_view_form_item_dic['station_id'];\n\t\t\t\t\t\tif ( this.current_edit_record['has_image'] ) {\n\t\t\t\t\t\t\tthis.attachElement( 'punch_image' );\n\t\t\t\t\t\t\twidget.setValue( ServiceCaller.getURLByObjectType( 'file_download' ) + '&object_type=punch_image&parent_id=' + this.current_edit_record.user_id + '&object_id=' + this.current_edit_record.id );\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.detachElement( 'punch_image' );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_id':\n\t\t\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\t\t\targs = {};\n\t\t\t\t\t\t\targs.filter_data = {\n\t\t\t\t\t\t\t\tstatus_id: 10,\n\t\t\t\t\t\t\t\tuser_id: this.current_edit_record.user_id,\n\t\t\t\t\t\t\t\tpunch_branch_id: this.current_edit_record.branch_id,\n\t\t\t\t\t\t\t\tpunch_department_id: this.current_edit_record.department_id\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\twidget.setDefaultArgs( args );\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_item_id':\n\t\t\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\t\t\targs = {};\n\t\t\t\t\t\t\targs.filter_data = { status_id: 10, job_id: this.current_edit_record.job_id };\n\t\t\t\t\t\t\twidget.setDefaultArgs( args );\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'punch_tag_id':\n\t\t\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t\tthis.previous_punch_tag_selection = this.current_edit_record[key];\n\n\t\t\t\t\t\t\tvar punch_tag_widget = widget;\n\t\t\t\t\t\t\tTTPromise.wait( null, null, function() {\n\t\t\t\t\t\t\t\t//Update default args for punch tags AComboBox last as they rely on data from job, job item and related fields.\n\t\t\t\t\t\t\t\tvar args = {};\n\t\t\t\t\t\t\t\targs.filter_data = $this.getPunchTagFilterData();\n\t\t\t\t\t\t\t\tpunch_tag_widget.setDefaultArgs( args );\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'branch_id':\n\t\t\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\t\t\tvar args = {};\n\t\t\t\t\t\t\targs.filter_data = { user_id: this.current_edit_record.user_id };\n\t\t\t\t\t\t\twidget.setDefaultArgs( args );\n\t\t\t\t\t\t}\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'department_id':\n\t\t\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\t\t\tvar args = {};\n\t\t\t\t\t\t\targs.filter_data = { user_id: this.current_edit_record.user_id, branch_id: this.current_edit_record.branch_id };\n\t\t\t\t\t\t\twidget.setDefaultArgs( args );\n\t\t\t\t\t\t}\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_quick_search':\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_item_quick_search':\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'punch_tag_quick_search':\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'latitude':\n\t\t\t\t\tcase 'longitude':\n\t\t\t\t\tcase 'position_accuracy':\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t\tif ( this.absence_model ) {\n\n\t\t\tif ( this.current_edit_record.id ) {\n\t\t\t\tthis.pre_total_time = this.current_edit_record.total_time;\n\t\t\t} else {\n\t\t\t\tthis.pre_total_time = 0;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.pre_total_time = 0;\n\t\t}\n\n\t\tvar actual_time_value;\n\t\tif ( this.current_edit_record.id ) {\n\n\t\t\tif ( this.current_edit_record.actual_time_stamp ) {\n\t\t\t\tactual_time_value = $.i18n._( 'Actual Time' ) + ': ' + this.current_edit_record.actual_time_stamp;\n\t\t\t} else {\n\t\t\t\tactual_time_value = 'N/A';\n\t\t\t}\n\n\t\t}\n\n\t\tthis.setLocationValue( this.current_edit_record );\n\n\t\tthis.actual_time_label.text( actual_time_value );\n\n\t\tthis.onAvailableBalanceChange();\n\n\t\tthis.setEditMenu(); //To make sure save & continue icon disabled correct when multi dates\n\n\t\tthis.setEditViewDataDone();\n\t}\n\n\tsetEditViewDataDone() {\n\t\tsuper.setEditViewDataDone();\n\t\t//can't check is_edit here because in timesheet it can be both.\n\t\tif ( this.is_viewing == true && ( this.current_edit_record.latitude == 0 || this.current_edit_record.longitude == 0 ) ) {\n\t\t\t$( '.widget-h-box-mapLocationWrapper' ).parents( '.edit-view-form-item-div' ).hide();\n\t\t} else {\n\t\t\tif ( this.show_location_ui ) {\n\t\t\t\t$( '.widget-h-box-mapLocationWrapper' ).parents( '.edit-view-form-item-div' ).show();\n\t\t\t}\n\t\t}\n\t}\n\n\tsetLocationValue( location_data ) {\n\t\tif ( Global.getProductEdition() >= 15\n\t\t\t&& this.edit_view_ui_dic['latitude']\n\t\t\t&& this.edit_view_ui_dic['longitude']\n\t\t\t&& this.edit_view_ui_dic['position_accuracy']\n\t\t) {\n\t\t\tif ( location_data ) {\n\t\t\t\tthis.current_edit_record.latitude = location_data.latitude;\n\t\t\t\tthis.current_edit_record.longitude = location_data.longitude;\n\t\t\t\tthis.current_edit_record.position_accuracy = location_data.position_accuracy;\n\t\t\t}\n\t\t\tthis.edit_view_ui_dic['latitude'].setValue( this.current_edit_record.latitude );\n\t\t\tthis.edit_view_ui_dic['longitude'].setValue( this.current_edit_record.longitude );\n\t\t\tthis.edit_view_ui_dic['position_accuracy'].setValue( this.current_edit_record.position_accuracy ? this.current_edit_record.position_accuracy : 0 );\n\n\t\t\tif ( !this.current_edit_record.latitude && !this.is_mass_editing ) {\n\t\t\t\tthis.location_wrapper.hide();\n\t\t\t} else {\n\t\t\t\tif ( this.show_location_ui ) {\n\t\t\t\t\tthis.location_wrapper.show();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tonAvailableBalanceChange() {\n\t\tif ( this.current_edit_record.hasOwnProperty( 'src_object_id' ) &&\n\t\t\tthis.current_edit_record.src_object_id && !this.is_mass_editing ) {\n\t\t\tthis.getAvailableBalance( false );\n\t\t} else {\n\t\t\tthis.detachElement( 'available_balance' );\n\t\t}\n\t\tthis.editFieldResize();\n\t}\n\n\tgetAvailableBalance( release_balance ) {\n\t\tif ( Global.isSet( this.current_edit_record ) == false ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar $this = this;\n\t\tvar result_data;\n\n\t\t//On first run, set previous_absence_policy_id.\n\t\tif ( this.previous_absence_policy_id == false ) {\n\t\t\tthis.previous_absence_policy_id = this.current_edit_record.src_object_id;\n\t\t}\n\n\t\tif ( this.absence_model ) {\n\n\t\t\tvar last_date_stamp = this.current_edit_record.date_stamp;\n\t\t\tvar total_time = this.current_edit_record.total_time;\n\n\t\t\tif ( this.is_mass_adding ) {\n\t\t\t\tlast_date_stamp = this.current_edit_record.punch_dates;\n\t\t\t\tif ( $.type( last_date_stamp ) === 'string' && last_date_stamp.indexOf( ' - ' ) > 0 ) {\n\t\t\t\t\tlast_date_stamp = this.parserDatesRange( last_date_stamp ); //Converts last_date_stamp into an array so we can get the last date below.\n\t\t\t\t}\n\n\t\t\t\tif ( $.type( last_date_stamp ) === 'array' && last_date_stamp.length > 0 ) {\n\t\t\t\t\ttotal_time = ( total_time * last_date_stamp.length );\n\t\t\t\t\tlast_date_stamp = last_date_stamp[ ( last_date_stamp.length - 1 ) ];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.api_absence_policy.getProjectedAbsencePolicyBalance(\n\t\t\t\tthis.current_edit_record.src_object_id,\n\t\t\t\tthis.getSelectEmployee(),\n\t\t\t\tlast_date_stamp,\n\t\t\t\ttotal_time,\n\t\t\t\tthis.pre_total_time,\n\t\t\t\tthis.previous_absence_policy_id,\n\t\t\t\t{\n\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\tif ( release_balance ) {\n\t\t\t\t\t\t\t$this.releaseBalance( result.getResult().available_balance );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$this.getBalanceHandler( result, last_date_stamp );\n\n\t\t\t\t\t\t\t// If the selected Absence Policy is not linked to any accrual.\n\t\t\t\t\t\t\t// The \"Remaining Balance\" button should not appear as there is no balance.\n\t\t\t\t\t\t\tif ( $this.is_viewing == true ) {\n\t\t\t\t\t\t\t\t$( '#release-balance-button' ).css( 'display', 'none' );\n\t\t\t\t\t\t\t} else if ( Global.isObject( result ) ) {\n\t\t\t\t\t\t\t\tvar result_data = result.getResult();\n\t\t\t\t\t\t\t\tif ( !result_data ) {\n\t\t\t\t\t\t\t\t\t$( '#release-balance-button' ).css( 'display', 'none' );\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t$( '#release-balance-button' ).css( 'display', '' );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$( '#release-balance-button' ).css( 'display', 'none' );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\n\t\t}\n\t}\n\n\tsetStation() {\n\n\t\tvar $this = this;\n\t\tvar arg = { filter_data: { id: this.current_edit_record.station_id } };\n\n\t\tthis.api_station.getStation( arg, {\n\t\t\tonResult: function( result ) {\n\n\t\t\t\t$this.station = result.getResult()[0];\n\n\t\t\t\tvar widget = $this.edit_view_ui_dic['station_id'];\n\t\t\t\tif ( $this.station ) {\n\t\t\t\t\t//Error: Uncaught TypeError: Cannot read property 'setValue' of undefined in /interface/html5/#!m=TimeSheet&date=20140925 line 6017\n\t\t\t\t\tif ( widget ) {\n\t\t\t\t\t\twidget.setValue( $this.station.type + '-' + $this.station.description );\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tif ( widget ) {\n\t\t\t\t\t\twidget.setValue( 'N/A' );\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ( PermissionManager.validate( 'station', 'view' ) ||\n\t\t\t\t\t( PermissionManager.validate( 'station', 'view_child' ) && $this.station.is_child ) ||\n\t\t\t\t\t( PermissionManager.validate( 'station', 'view_own' ) && $this.station.is_owner ) ) {\n\t\t\t\t\t$this.show_station_ui = true;\n\t\t\t\t} else {\n\t\t\t\t\t$this.show_station_ui = false;\n\t\t\t\t}\n\n\t\t\t\t// Error: TypeError: form_item_input is undefined in interface/html5/framework/jquery.min.js?v=9.0.1-20151022-091549 line 2 > eval line 7119\n\t\t\t\tif ( $this.show_station_ui && widget ) {\n\t\t\t\t\twidget.css( 'cursor', 'pointer' );\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tgetSelectedItems() {\n\t\tvar selected_item = null;\n\t\tif ( this.edit_view ) {\n\t\t\treturn [this.current_edit_record];\n\t\t} else {\n\n\t\t\tif ( this.select_punches_array.length > 0 ) {\n\t\t\t\treturn this.select_punches_array;\n\t\t\t}\n\t\t}\n\n\t\treturn [];\n\t}\n\n\tgetSelectedItem() {\n\n\t\tvar selected_item = null;\n\t\tif ( this.edit_view ) {\n\t\t\tselected_item = this.current_edit_record;\n\t\t} else {\n\n\t\t\tif ( this.select_punches_array.length > 0 ) {\n\t\t\t\tselected_item = this.select_punches_array[0];\n\t\t\t} else {\n\t\t\t\tselected_item = null;\n\t\t\t}\n\t\t}\n\n\t\treturn Global.clone( selected_item );\n\t}\n\n\taddPermissionValidate( p_id ) {\n\t\tif ( !Global.isSet( p_id ) ) {\n\t\t\tp_id = this.permission_id;\n\t\t}\n\n\t\tif ( p_id === 'report' ) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'add' ) && this.editPermissionValidate( p_id ) ) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tsetDefaultMenu( doNotSetFocus ) {\n\t\t//TimeSheet uses a different grid than other views and needs \"select_punches_array\" instead of \"this.getGridSelectIdArray()\" for grid_selected_length\n\t\tsuper.setDefaultMenu( doNotSetFocus, this.select_punches_array.length );\n\t\t//Set move or drop mode after rest of menu.\n\t\tthis.setMoveOrDropMode( this.select_drag_menu_id ? this.select_drag_menu_id : 'move' ); // Ensure Move/Copy selections are set when closing pop-up windows from Jump-To menu, like Add Request.\n\t}\n\n\tsetCustomDefaultMenuIcon( id, context_btn, grid_selected_length ) {\n\t\tswitch ( id ) {\n\t\t\tcase 'add_punch':\n\t\t\t\tthis.setDefaultMenuAddPunchIcon( context_btn, grid_selected_length );\n\t\t\t\tif ( this.getPunchPermissionType() === 'punch' ) {\n\t\t\t\t\tContextMenuManager.activateSplitButtonItem( this.determineContextMenuMountAttributes().id, context_btn.id );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'add_absence':\n\t\t\t\tthis.setDefaultMenuAddAbsenceIcon( context_btn, grid_selected_length );\n\t\t\t\tif ( this.getPunchPermissionType() === 'absence' ) {\n\t\t\t\t\tContextMenuManager.activateSplitButtonItem( this.determineContextMenuMountAttributes().id, context_btn.id );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'in_out':\n\t\t\t\tthis.setDefaultMenuInOutIcon( context_btn, grid_selected_length );\n\t\t\t\tbreak;\n\t\t\tcase 'move':\n\t\t\t\tif ( !this.movePermissionValidate( this.getPunchPermissionType() ) ) {\n\t\t\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t\t\t}\n\t\t\t\tif ( this.getPunchMode() == 'manual' ) {\n\t\t\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t\t\t} else {\n\t\t\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'edit_pay_period':\n\t\t\t\tthis.setDefaultMenuEditPayPeriodIcon( context_btn, grid_selected_length );\n\t\t\t\tbreak;\n\t\t\tcase 'print':\n\t\t\t\tthis.setDefaultMenuPrintIcon( context_btn, grid_selected_length );\n\t\t\t\tbreak;\n\t\t\tcase 'edit_employee':\n\t\t\t\tthis.setDefaultMenuEditEmployeeIcon( context_btn, grid_selected_length );\n\t\t\t\tbreak;\n\t\t\tcase 'pay_stub':\n\t\t\t\tthis.setDefaultMenuPayStubIcon( context_btn, grid_selected_length );\n\t\t\t\tbreak;\n\t\t\tcase 're_calculate_timesheet':\n\t\t\t\tthis.setDefaultMenuReCalculateTimesheet( context_btn, grid_selected_length );\n\t\t\t\tbreak;\n\t\t\tcase 'generate_pay_stub':\n\t\t\t\tthis.setDefaultMenuGeneratePayStubIcon( context_btn, grid_selected_length );\n\t\t\t\tbreak;\n\t\t\tcase 'schedule':\n\t\t\t\tthis.setDefaultMenuScheduleIcon( context_btn, grid_selected_length );\n\t\t\t\tbreak;\n\t\t\tcase 'accumulated_time':\n\t\t\t\tthis.setDefaultMenuAccumulatedTimeIcon( context_btn );\n\t\t\t\tbreak;\n\t\t\tcase 'AddRequest':\n\t\t\t\tthis.setAddRequestIcon( context_btn );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tsetEditMenuDragCopyIcon( context_btn, grid_selected_length ) {\n\t\tif ( !this.copyPermissionValidate( this.getPunchPermissionType() ) || this.edit_only_mode ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t}\n\n\t\tif ( this.getPunchMode() == 'manual' ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t} else {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t}\n\t}\n\n\tsetDefaultMenuDragCopyIcon( context_btn, grid_selected_length ) {\n\t\tif ( !this.copyPermissionValidate( this.getPunchPermissionType() ) || this.edit_only_mode ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t}\n\n\t\tif ( this.getPunchMode() == 'manual' ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t} else {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t}\n\t}\n\n\tsetDefaultMenuScheduleIcon( context_btn, grid_selected_length ) {\n\t\tif ( !PermissionManager.checkTopLevelPermission( 'Schedule' ) || this.edit_only_mode ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t}\n\t}\n\n\treCalculateEditPermissionValidate() {\n\n\t\tvar p_id = this.permission_id;\n\n\t\tif ( PermissionManager.validate( p_id, 'edit' ) || this.ownerOrChildPermissionValidate( p_id, 'edit_child' ) ) {\n\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tsetDefaultMenuReCalculateTimesheet( context_btn, grid_selected_length ) {\n\n\t\tif ( !this.reCalculateEditPermissionValidate() ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t}\n\t}\n\n\tsetDefaultMenuGeneratePayStubIcon( context_btn, grid_selected_length ) {\n\n\t\tif ( !PermissionManager.checkTopLevelPermission( 'GeneratePayStubs' ) ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t}\n\t}\n\n\tsetDefaultMenuPayStubIcon( context_btn, grid_selected_length ) {\n\n\t\tif ( !PermissionManager.checkTopLevelPermission( 'PayStub' ) ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t}\n\t}\n\n\tsetDefaultMenuEditPayPeriodIcon( context_btn, grid_selected_length ) {\n\n\t\tif ( !this.editPermissionValidate( 'pay_period_schedule' ) ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t}\n\n\t\tvar $this = this;\n\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\tif ( $this.getPayPeriod() ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t}\n\t}\n\n\tsetDefaultMenuAccumulatedTimeIcon( context_btn ) {\n\n\t\tif ( !PermissionManager.checkTopLevelPermission( 'AccumulatedTime' ) || this.edit_only_mode ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t}\n\t}\n\n\tsetDefaultMenuEditEmployeeIcon( context_btn, grid_selected_length ) {\n\n\t\tif ( !this.editChildPermissionValidate( 'user' ) ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t}\n\t}\n\n\tsetDefaultMenuInOutIcon( context_btn ) {\n\t\tif ( this.addPermissionValidate( 'punch' ) ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t} else {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n            ContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t}\n\t}\n\n\tsetEditMenuInOutIcon( context_btn ) {\n\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t}\n\n\teditOwnerOrChildPermissionValidate( p_id, selected_item ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = this.permission_id;\n\t\t}\n\n\t\tif ( !selected_item ) {\n\t\t\tselected_item = this.getSelectEmployee( true );\n\t\t}\n\n\t\tif ( p_id === 'report' ) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (\n\t\t\tPermissionManager.validate( p_id, 'edit' ) ||\n\t\t\t( selected_item && selected_item.is_owner && PermissionManager.validate( p_id, 'edit_own' ) ) ||\n\t\t\t( selected_item && selected_item.is_child && PermissionManager.validate( p_id, 'edit_child' ) ) ) {\n\n\t\t\treturn true;\n\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tviewOwnerOrChildPermissionValidate( p_id, selected_item ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = this.permission_id;\n\t\t}\n\n\t\tif ( p_id === 'report' ) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif ( !selected_item ) {\n\t\t\tselected_item = this.getSelectEmployee( true );\n\t\t}\n\n\t\tif (\n\t\t\tPermissionManager.validate( p_id, 'view' ) ||\n\t\t\t( selected_item && selected_item.is_owner && PermissionManager.validate( p_id, 'view_own' ) ) ||\n\t\t\t( selected_item && selected_item.is_child && PermissionManager.validate( p_id, 'view_child' ) ) ) {\n\n\t\t\treturn true;\n\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tdeleteOwnerOrChildPermissionValidate( p_id, selected_item ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = this.permission_id;\n\t\t}\n\n\t\tif ( !selected_item ) {\n\t\t\tselected_item = this.getSelectEmployee( true );\n\t\t}\n\n\t\tif ( p_id === 'report' ) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (\n\t\t\tPermissionManager.validate( p_id, 'delete' ) ||\n\t\t\t( selected_item && selected_item.is_owner && PermissionManager.validate( p_id, 'delete_own' ) ) ||\n\t\t\t( selected_item && selected_item.is_child && PermissionManager.validate( p_id, 'delete_child' ) ) ) {\n\n\t\t\treturn true;\n\n\t\t}\n\n\t\treturn false;\n\t}\n\n\teditChildPermissionValidate( p_id, selected_item ) {\n\t\tif ( !Global.isSet( p_id ) ) {\n\t\t\tp_id = this.permission_id;\n\t\t}\n\n\t\tif ( !Global.isSet( selected_item ) ) {\n\t\t\tselected_item = this.getSelectEmployee( true );\n\t\t}\n\n\t\tif ( p_id === 'report' ) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif ( !PermissionManager.validate( p_id, 'enabled' ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'edit' ) ||\n\t\t\tthis.ownerOrChildPermissionValidate( p_id, 'edit_child', selected_item ) ) {\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tonReportMenuClick( id ) {\n\t\tthis.onNavigationClick( id );\n\t}\n\n\tsetDefaultMenuPrintIcon( context_btn, grid_selected_length ) {\n\n\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t}\n\n\tsetEditMenuMapIcon( context_btn ) {\n\t\tsuper.setDefaultMenuMapIcon( context_btn );\n\n\t\tif ( context_btn.disabled == true ) {\n\t\t\tif ( this.absence_model || this.getPunchMode() == 'manual' ) {\n\t\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t\t}\n\t\t}\n\t}\n\n\tsetEditMenuSaveAndAddIcon( context_btn ) {\n\t\tthis.saveAndNewValidate( context_btn, this.getPunchPermissionType() );\n\n\t\tif ( this.is_viewing || this.is_mass_editing ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tsetDefaultMenuMapIcon( context_btn, grid_selected_length ) {\n\t\tsuper.setDefaultMenuMapIcon( context_btn );\n\n\t\tif ( context_btn.disabled == true ) {\n\t\t\tif ( this.absence_model || this.getPunchMode() == 'manual' ) {\n\t\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t\t}\n\t\t}\n\t}\n\n\tsetEditMenuSaveAndNextIcon( context_btn ) {\n\t\tif ( !this.editPermissionValidate( this.getPunchPermissionType() ) || this.edit_only_mode ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t}\n\n\t\tif ( ( !this.current_edit_record || !this.current_edit_record.id ) || this.is_viewing || this.is_mass_adding ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tsetEditMenuSaveAndCopyIcon( context_btn ) {\n\t\tthis.saveAndNewValidate( context_btn, this.getPunchPermissionType() );\n\n\t\tif ( this.is_viewing || this.is_mass_editing ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tsetEditMenuCopyAndAddIcon( context_btn ) {\n\t\tif ( !this.addPermissionValidate( this.getPunchPermissionType() ) ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t}\n\n\t\tif ( ( !this.current_edit_record || !this.current_edit_record.id ) || this.is_viewing || this.is_mass_adding ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\n\tsetCustomEditMenuIcon( id, context_btn ) {\n\t\tswitch ( id ) {\n\t\t\tcase 'add':\n\t\t\tcase 'add_punch':\n\t\t\t\tthis.setEditMenuAddIcon( context_btn );\n\t\t\t\tif ( this.getPunchPermissionType() === 'punch' ) {\n\t\t\t\t\tContextMenuManager.activateSplitButtonItem( this.determineContextMenuMountAttributes().id, context_btn.id );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'add_absence':\n\t\t\t\tthis.setEditMenuAddIcon( context_btn );\n\t\t\t\tif ( this.getPunchPermissionType() === 'absence' ) {\n\t\t\t\t\tContextMenuManager.activateSplitButtonItem( this.determineContextMenuMountAttributes().id, context_btn.id );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'view':\n\t\t\t\tthis.setEditMenuViewIcon( context_btn );\n\t\t\t\tbreak;\n\t\t\tcase 'in_out':\n\t\t\t\tthis.setEditMenuInOutIcon( context_btn );\n\t\t\t\tbreak;\n\t\t\tcase 'drag_copy':\n\t\t\t\tthis.setEditMenuDragCopyIcon( context_btn );\n\t\t\t\tbreak;\n\t\t\tcase 'move':\n\t\t\t\tif ( !this.movePermissionValidate( this.getPunchPermissionType() ) ) {\n\t\t\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'accumulated_time':\n\t\t\t\tthis.setDefaultMenuAccumulatedTimeIcon( context_btn );\n\t\t\t\tbreak;\n\t\t\tcase 'export_excel':\n\t\t\t\tthis.setDefaultMenuExportIcon( context_btn );\n\t\t\t\tbreak;\n\t\t\tcase 'edit_employee':\n\t\t\t\tthis.setDefaultMenuEditEmployeeIcon( context_btn );\n\t\t\t\tbreak;\n\t\t\tcase 'edit_pay_period':\n\t\t\t\tthis.setDefaultMenuEditPayPeriodIcon( context_btn );\n\t\t\t\tbreak;\n\t\t\tcase 're_calculate_timesheet':\n\t\t\t\tthis.setDefaultMenuReCalculateTimesheet( context_btn );\n\t\t\t\tbreak;\n\t\t\tcase 'generate_pay_stub':\n\t\t\t\tthis.setDefaultMenuGeneratePayStubIcon( context_btn );\n\t\t\t\tbreak;\n\t\t\tcase 'AddRequest':\n\t\t\t\tthis.setAddRequestIcon( context_btn );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tenableAddRequestButton() {\n\t\tvar grid_selected_id_array = this.select_cells_Array;\n\t\tvar grid_selected_length = grid_selected_id_array.length;\n\n\t\tif ( grid_selected_length == 1 ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tcleanWhenUnloadView( callBack ) {\n\t\tTTVueUtils.unmountComponent( this.vue_control_bar_id );\n\t\tif ( this.manual_note_component_ids.length > 0 ) {\n\t\t\tthis.manual_note_component_ids.forEach( ( id ) => {\n\t\t\t\tTTVueUtils.unmountComponent( id );\n\t\t\t} );\n\t\t}\n\n\t\t$( '#timesheet_view_container' ).remove();\n\t\tsuper.cleanWhenUnloadView( callBack );\n\t}\n\n\tsetAddRequestIcon( context_btn, grid_selected_length ) {\n\t\tif ( Global.getProductEdition() <= 10 || !this.addPermissionValidate( 'request' ) || this.edit_only_mode ) {\n\t\t\tContextMenuManager.hideMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false )\n\t\t}\n\n\t\tif ( this.enableAddRequestButton() === true ) {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, true );\n\t\t} else {\n\t\t\tContextMenuManager.disableMenuItem( this.determineContextMenuMountAttributes().id, context_btn.id, false );\n\t\t}\n\t}\n\n\tuserValueSet( val ) {\n\t\t//If the value here is null, the timesheet data will be missing therefore we want to force the value to the currently logged in user.\n\t\t//Mostly caused when developers switch instances or databases during testing.\n\t\tif ( typeof val == 'undefined' ) {\n\t\t\tthis.employee_nav.setValue( LocalCacheData.getLoginUser() );\n\t\t\tDebug.Text( 'ERROR: Invalid User ID in URL. Switching to current User ID.', 'TimesheetViewConroller.js', 'TimesheetViewConroller', 'userValueSet', 10 );\n\t\t}\n\t}\n\n\t// Get available accrual balance for currently selected absence policy type and insert into the time field.\n\treleaseBalance( balance ) {\n\n\t\t//Balance could be positive or negative.\n\t\t//If the balance can be fully displayed in the preferred time unit, is that format.\n\t\t//Otherwise we need to release fractions of a minute, so force through \"HH:MM:SS\" and wrap it in quotes so it doesn't get rounded.\n\t\tif ( Global.parseTimeUnit( '\"'+  Global.getTimeUnit( balance ) +'\"' ) == balance ) {\n\t\t\tthis.edit_view_ui_dic['total_time'].setValue( Global.getTimeUnit( balance ) );\n\t\t} else {\n\t\t\tthis.edit_view_ui_dic['total_time'].setValue( '\"' + Global.getTimeUnit( balance, 12 ) + '\"' ); //12=\"HH:MM:SS\"\n\t\t}\n\n\t\t// Trigger field onFormChange to update available balance field and other data.\n\t\tthis.edit_view_ui_dic['total_time'].trigger( 'change' );\n\t}\n\n\tmergeJobQueueIntoTimeSheetData( timesheet_data ) {\n\t\t//Check locally if there is a queued job queue punch within the last 15 minutes (900 seconds).\n\t\tif ( LocalCacheData.getJobQueuePunchData() && LocalCacheData.getJobQueuePunchData().user_id === this.getSelectEmployee() && ( ( new Date().getTime() / 1000 ) - LocalCacheData.getJobQueuePunchData().epoch ) < ( 60 * 15 ) ) {\n\t\t\t//Check if punch is duplicate and alreaxy exists.\n\t\t\tlet is_punch_exist = false;\n\t\t\tfor( let i = 0; i < timesheet_data.punch_data.length; i++ ) {\n\t\t\t\tif( timesheet_data.punch_data[i].actual_time_stamp == LocalCacheData.getJobQueuePunchData().actual_time_stamp\n\t\t\t\t\t&& timesheet_data.punch_data[i].status_id == LocalCacheData.getJobQueuePunchData().status_id\n\t\t\t\t\t&& timesheet_data.punch_data[i].type_id == LocalCacheData.getJobQueuePunchData().type_id\n\t\t\t\t) {\n\t\t\t\t\tis_punch_exist = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( is_punch_exist === true ) {\n\t\t\t\t//Punch already exists, remove duplicate.\n\t\t\t\tLocalCacheData.setJobQueuePunchData( null );\n\t\t\t} else {\n\t\t\t\ttimesheet_data.punch_data.push( LocalCacheData.getJobQueuePunchData() );\n\t\t\t}\n\t\t}\n\n\t\treturn timesheet_data;\n\t}\n\n\tgetTimeSheetWidth() {\n\t\tlet scroll_adjustment = Global.isVerticalScrollBarRequired( $('.timesheet-grid-div')[0] ) ? Global.getScrollbarWidth() : 0;\n\t\treturn ( $( '.context-border' ).width() - scroll_adjustment );\n\t}\n}\n\nTimeSheetViewController.PUNCH_ROW = 1;\nTimeSheetViewController.EXCEPTION_ROW = 2;\nTimeSheetViewController.REQUEST_ROW = 3;\nTimeSheetViewController.TOTAL_ROW = 4;\nTimeSheetViewController.REGULAR_ROW = 5;\nTimeSheetViewController.ABSENCE_ROW = 6;\nTimeSheetViewController.ACCUMULATED_TIME_ROW = 7;\nTimeSheetViewController.PREMIUM_ROW = 8;\n\nTimeSheetViewController.html_template = `\n\t<div class=\"view time-sheet-view\" id=\"timesheet_view_container\">\n\t\t<div class=\"clear-both-div\"></div>\n\t\t<div class=\"control-bar\">\n\t\t\t<div id=\"vue-timesheet-control-bar\"></div>\n\t\t</div>\n\t\t<div class=\"clear-both-div\"></div>\n\t\t<div class=\"grid-top-border\"></div>\n\t\t<div class=\"timesheet-grid-div\">\n\t\t\t<div class=\"timesheet-punch-grid-wrapper\">\n\t\t\t\t<table id=\"grid\" class=\"timesheet-grid\"></table>\n\t\t\t</div>\n\t\t\t<div class=\"inside-editor-div manual-timesheet-inside-editor-div\"></div>\n\t\t\t<table class=\"accumulated-time-grid sub-grid\" id=\"accumulated_time_grid\"></table>\n\t\t\t<table class=\" sub-grid\" id=\"branch_grid\"></table>\n\t\t\t<table class=\" sub-grid\" id=\"department_grid\"></table>\n\t\t\t<table class=\" sub-grid\" id=\"job_grid\"></table>\n\t\t\t<table class=\" sub-grid\" id=\"job_item_grid\"></table>\n\t\t\t<table class=\" sub-grid\" id=\"premium_grid\"></table>\n\t\t\t<table class=\" sub-grid\" id=\"absence_grid\"></table>\n\t\t\t<table class=\"total_grids_div\" id=\"total_grids_table\">\n\t\t\t\t<tr style=\"vertical-align:top;\">\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<div class=\"accumulated-total-grid-title\" style=\"display: none\"><%=accumulated_time%></div>\n\t\t\t\t\t\t<table id=\"accumulated_total_grid\"></table>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td class=\"notes_grid_td_container\">\n\t\t\t\t\t\t<table id=\"punch_note_grid\" class=\"float-right\"></table>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<div class=\"verification-grid-div\">\n\t\t\t\t\t\t\t<div class=\"verification-grid-title\" style=\"display: none\"><%=timesheet_verification%></div>\n\t\t\t\t\t\t\t<table id=\"verification_grid\" class=\"float-right\"></table>\n\t\t\t\t\t\t\t<div class=\"verification-action-bar\">\n\t\t\t\t\t\t\t\t<span class=\"verify-description\"></span>\n\t\t\t\t\t\t\t\t<button class=\"verify-button t-button\" style=\"display: none\"><%=verify%></button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t</div>\n\t\t<div class=\"bottom-div\">\n\t\t\t<div class=\"grid-bottom-border\"></div>\n\t\t</div>\n\t</div>\n`;"],"file":"v16.12.9/TimeSheetViewController-B9QVJiKc.bundle.js"}