import{_ as T,j as a}from"./vendor-tTApdY0Y.bundle.js";import{G as d}from"./main_ui-z76rxVqJ.entry.bundle.js";class B extends BaseViewController{constructor(r={}){T.defaults(r,{authorization_history:null,selected_absence_policy_record:null,enable_edit_view_ui:!1}),super(r)}setGridCellBackGround(){if(this.grid){var r=this.grid.getGridParam("data");if(r)for(var e=r.length,t=0;t<e;t++){var _=r[t];_.status_id==30&&a("tr#"+_.id).addClass("bolder-request")}}}onCancelClick(r,e,t){TTPromise.add("base","onCancelClick");var _=this;if(this.current_edit_record&&this.current_edit_record.id)var o=this.current_edit_record.id;LocalCacheData.current_doing_context_action="cancel",this.is_changed&&!r?TAlertManager.showConfirmAlert(d.modify_alert_message,null,function(i){i===!0&&l()}):l();function l(){!_.edit_view&&_.parent_view_controller&&_.sub_view_mode?(_.parent_view_controller.is_changed=!1,_.parent_view_controller.buildContextMenu(!0),_.parent_view_controller.onCancelClick()):_.is_edit&&o?(ContextMenuManager.unmountContextMenu(_.determineContextMenuMountAttributes().id),_.setCurrentEditViewState("view"),_.onViewClick(o,!0),_.setEditMenu()):_.removeEditView(),t&&t(),_.search(!1),d.setUIInitComplete(),ProgressBar.closeOverlay(),TTPromise.resolve("base","onCancelClick")}}overlappingShiftUIValidate(){return!(!PermissionManager.validate("schedule","enabled")||!(PermissionManager.validate("schedule","view")||PermissionManager.validate("schedule","view_own")||PermissionManager.validate("schedule","view_child")))}onCloseIconClick(){this.onCancelClick()}buildDataForAPI(r){var e=this.getAdvancedFieldNames();if(this.viewId=="RequestAuthorization"&&(!TTUUID.isUUID(r.request_schedule_id)||r.request_schedule_id==TTUUID.zero_id))return e.forEach(i=>{r.hasOwnProperty(i)&&delete r[i]}),r;var t=LocalCacheData.loginUser.id;d.isSet(this.current_edit_record.user_id)&&(t=this.current_edit_record.user_id);var _={user_id:t},o={};for(var l in this.current_edit_record)l=="start_date"&&this.edit_view_ui_dic[l]&&(_.date_stamp=this.edit_view_ui_dic[l].getValue()),e.indexOf(l)>-1?l=="request_schedule_id"?o.id=this.current_edit_record.request_schedule_id:l=="request_schedule_status_id"?o.status_id=this.edit_view_ui_dic.request_schedule_status_id.getValue():this.edit_view_ui_dic[l]&&(o[l]=this.edit_view_ui_dic[l].getValue()):l=="available_balance"||l=="job_item_quick_search"||l=="job_quick_search"||(_[l]=this.current_edit_record[l]);return d.getProductEdition()>=15&&(PermissionManager.validate("request","add_advanced")||d.isEmpty(o)==!1)&&(this.current_edit_record.type_id==30||this.current_edit_record.type_id==40)&&(_.request_schedule=o),_}buildDataFromAPI(r){if(d.isSet(r)&&d.isSet(r.request_schedule)){for(var e in r.request_schedule)e=="id"?r.request_schedule_id=r.request_schedule.id:e=="status_id"?r.request_schedule_status_id=r.request_schedule.status_id:typeof r[e]>"u"&&(r[e]=r.request_schedule[e]);delete r.request_schedule,this.pre_request_schedule=!1}else this.pre_request_schedule=!0;var t=r;return t}showAdvancedFields(r){if(d.getProductEdition()>=15&&(PermissionManager.validate("request","add_advanced")||TTUUID.isUUID(this.current_edit_record.request_schedule_id)&&this.current_edit_record.request_schedule_id!=TTUUID.zero_id&&this.current_edit_record.request_schedule_id!=TTUUID.not_exist_id)&&(this.current_edit_record.type_id==30||this.current_edit_record.type_id==40)&&(!this.pre_request_schedule||this.is_add)){var e=this.getAdvancedFieldNames();if(this.edit_view_ui_dic){for(var t=0;t<e.length;t++){if(e[t]=="absence_policy_id"&&this.edit_view_ui_dic.request_schedule_status_id&&this.edit_view_ui_dic.request_schedule_status_id.getValue()!=20){this.edit_view_ui_dic[e[t]].parents(".edit-view-form-item-div").hide();continue}this.edit_view_ui_dic[e[t]]&&(e[t]=="branch_id"&&!this.show_branch_ui?this.edit_view_ui_dic[e[t]].parents(".edit-view-form-item-div").hide():e[t]=="department_id"&&!this.show_department_ui?this.edit_view_ui_dic[e[t]].parents(".edit-view-form-item-div").hide():e[t]=="job_id"&&!this.show_job_ui?this.edit_view_ui_dic[e[t]].parents(".edit-view-form-item-div").hide():e[t]=="job_item_id"&&!this.show_job_item_ui?this.edit_view_ui_dic[e[t]].parents(".edit-view-form-item-div").hide():e[t]=="punch_tag_id"&&!this.show_punch_tag_ui?this.edit_view_ui_dic[e[t]].parents(".edit-view-form-item-div").hide():e[t]=="available_balance"&&!this.is_viewing?this.edit_view_ui_dic[e[t]].parents(".edit-view-form-item-div").hide():this.edit_view_ui_dic[e[t]].parents(".edit-view-form-item-div").show())}this.edit_view_ui_dic.date&&this.edit_view_ui_dic.date_stamp.parents(".edit-view-form-item-div").hide(),this.edit_view_ui_dic.available_balance&&this.is_viewing==!0&&this.viewId=="Request"&&this.edit_view_ui_dic.available_balance.parents(".edit-view-form-item-div").hide(),this.current_edit_record.type_id!=30&&this.current_edit_record.type_id!=40?this.edit_view_ui_dic.total_time&&(this.edit_view_ui_dic.total_time.parents(".edit-view-form-item-div").hide(),this.edit_view_ui_dic.overlap_type_id.parents(".edit-view-form-item-div").hide(),this.edit_view_ui_dic.is_replace_with_open_shift.parents(".edit-view-form-item-div").hide()):r!=!1&&this.getScheduleTotalTime()}}else this.edit_view_ui_dic.date_stamp&&this.edit_view_ui_dic.date_stamp.parents(".edit-view-form-item-div").show(),this.hideAdvancedFields()}hideAdvancedFields(){var r=this.getAdvancedFieldNames();if(this.edit_view_ui_dic){this.edit_view_ui_dic.request_schedule_status_id&&this.edit_view_ui_dic.request_schedule_status_id.setValue(10);for(var e=0;e<r.length;e++)this.edit_view_ui_dic[r[e]]&&this.edit_view_ui_dic[r[e]].parents(".edit-view-form-item-div").hide();this.edit_view_ui_dic.date&&this.edit_view_ui_dic.date.parents(".edit-view-form-item-div").show()}}getAdvancedFieldNames(){return["request_id","request_schedule_status_id","request_schedule_id","start_date","end_date","sun","mon","tue","wed","thu","fri","sat","start_time","end_time","total_time","schedule_policy_id","absence_policy_id","branch_id","department_id","job_id","job_item_id","punch_tag_id","schedule_policy","absence_policy","branch","department","job","job_item","available_balance","overlap_type_id","is_replace_with_open_shift"]}getScheduleTotalTime(){if(d.getProductEdition()>=15&&(this.current_edit_record.type_id==30||this.current_edit_record.type_id==40)&&this.edit_view_ui_dic&&this.edit_view_ui_dic.total_time){var r=!1;this.current_edit_record.start_date&&this.current_edit_record.start_time&&(r=this.current_edit_record.start_date+" "+this.current_edit_record.start_time);var e=!1;this.current_edit_record.start_date&&this.current_edit_record.end_time&&(e=this.current_edit_record.start_date+" "+this.current_edit_record.end_time);var t=this.current_edit_record.schedule_policy_id?this.current_edit_record.schedule_policy_id:null,_=this.current_edit_record.user_id;if(typeof _>"u"&&LocalCacheData.getLoginUser().id&&(_=LocalCacheData.getLoginUser().id),r&&e){var o=TTAPI.APISchedule,l=o.getScheduleTotalTime(r,e,t,_,{async:!1});l&&l.isValid()&&l.getResult()?this.total_time=l.getResult():this.total_time=0;var i=1;this.current_edit_record.start_date!=this.current_edit_record.end_date&&(i=d.getDaysInSpan(this.current_edit_record.start_date,this.current_edit_record.end_date,this.current_edit_record.sun,this.current_edit_record.mon,this.current_edit_record.tue,this.current_edit_record.wed,this.current_edit_record.thu,this.current_edit_record.fri,this.current_edit_record.sat));var u=this.total_time*i;a("#total_info").text(a.i18n._("x %s Day(s) = %s",i,d.getTimeUnit(u))),this.current_edit_record.total_time=this.total_time;var n=d.getTimeUnit(this.total_time);this.edit_view_ui_dic.total_time.setValue(n),this.edit_view_ui_dic.total_time.parents(".edit-view-form-item-div").show()}else this.edit_view_ui_dic.total_time&&this.edit_view_ui_dic.total_time.parents(".edit-view-form-item-div").hide()}else this.edit_view_ui_dic.total_time&&this.edit_view_ui_dic.total_time.parents(".edit-view-form-item-div").hide();this.onAvailableBalanceChange()}onWorkingStatusChanged(){d.getProductEdition()>=15&&(this.showAbsencePolicyField(),this.showCreateOpenShift())}showCreateOpenShift(){PermissionManager.checkTopLevelPermission("RequestAuthorization")&&this.current_edit_record&&this.current_edit_record.request_schedule_status_id==20?this.attachElement("is_replace_with_open_shift"):this.detachElement("is_replace_with_open_shift")}showAbsencePolicyField(r){if(this.edit_view_ui_dic.request_schedule_status_id&&this.edit_view_ui_dic.absence_policy_id){var r=this.edit_view_ui_dic.type_id?this.edit_view_ui_dic.type_id.getValue():this.current_edit_record.type_id,e=this.edit_view_ui_dic.request_schedule_status_id.getValue();e==20&&(r==30||r==40)?(this.edit_view_ui_dic.absence_policy_id.parents(".edit-view-form-item-div").show(),(this.viewId=="Request"&&this.is_viewing)==!1&&this.onAvailableBalanceChange()):(this.edit_view_ui_dic.absence_policy_id.parents(".edit-view-form-item-div").hide(),this.edit_view_ui_dic.available_balance.parents(".edit-view-form-item-div").hide())}}onDateStampChanged(){d.getProductEdition()>=15&&PermissionManager.validate("request","add_advanced")&&(this.edit_view_ui_dic.start_date.setValue(this.current_edit_record.date_stamp),this.current_edit_record.start_date=this.current_edit_record.date_stamp)}onStartDateChanged(){this.edit_view_ui_dic.date_stamp.setValue(this.current_edit_record.start_date),this.current_edit_record.date_stamp=this.current_edit_record.start_date}getAvailableBalance(){if(!(this.is_viewing&&this.viewId=="Request"||d.isSet(this.current_edit_record)==!1))if((this.viewId!="Request"||this.is_viewing==!1)&&this.current_edit_record.absence_policy_id&&(PermissionManager.validate("request","add_advanced")||TTUUID.isUUID(this.current_edit_record.request_schedule_id)&&this.current_edit_record.request_schedule_id!=TTUUID.zero_id&&this.current_edit_record.request_schedule_id!=TTUUID.not_exist_id)&&LocalCacheData.loginUser.id&&this.current_edit_record.total_time&&this.current_edit_record.total_time!=0&&this.current_edit_record.start_date){var r=1;this.current_edit_record.start_date!=this.current_edit_record.end_date&&(r=d.getDaysInSpan(this.current_edit_record.start_date,this.current_edit_record.end_date,this.current_edit_record.sun,this.current_edit_record.mon,this.current_edit_record.tue,this.current_edit_record.wed,this.current_edit_record.thu,this.current_edit_record.fri,this.current_edit_record.sat));var e=this,t=this.current_edit_record.user_id,_=this.current_edit_record.total_time*r,o=this.current_edit_record.date_stamp,l=this.current_edit_record.absence_policy_id?this.current_edit_record.absence_policy_id:TTUUID.zero_id;t&&o&&_&&this.api_absence_policy.getProjectedAbsencePolicyBalance(l,t,o,_,{onResult:function(i){e.edit_view_ui_dic&&e.edit_view_ui_dic.available_balance&&(e.getBalanceHandler(i,o),i&&e.selected_absence_policy_record?e.edit_view_ui_dic.available_balance.parents(".edit-view-form-item-div").show():e.edit_view_ui_dic.available_balance.parents(".edit-view-form-item-div").hide())}})}else(this.current_edit_record.absence_policy_id==!1||this.current_edit_record.absence_policy_id==TTUUID.zero_id)&&this.edit_view_ui_dic.available_balance&&this.edit_view_ui_dic.available_balance.parents(".edit-view-form-item-div").hide()}getFilterColumnsFromDisplayColumns(r){var e=[];r?this.authorization_history.authorization_history_grid&&(e=AuthorizationHistory.getAuthorizationHistoryDefaultDisplayColumns()):this.grid&&(e=this.grid.getGridParam("colModel"));var t={};if(t.is_owner=!0,t.id=!0,t.is_child=!0,t.in_use=!0,t.first_name=!0,t.last_name=!0,t.user_id=!0,t.status_id=!0,e)for(var _=e.length,o=0;o<_;o++){var l=e[o];t[l.name]=!0}return t}jobUIValidate(){return!!(PermissionManager.validate("job","enabled")&&PermissionManager.validate("punch","edit_job"))}jobItemUIValidate(){return!!PermissionManager.validate("punch","edit_job_item")}punchTagUIValidate(){return!!PermissionManager.validate("punch","edit_punch_tag")}branchUIValidate(){return!!PermissionManager.validate("punch","edit_branch")}departmentUIValidate(){return!!PermissionManager.validate("punch","edit_department")}processAPICallbackResult(r){return this.current_edit_record=this.buildDataFromAPI(r[0]),this.current_edit_record&&this.current_edit_record.total_time&&(this.current_edit_record.total_time=d.getTimeUnit(this.current_edit_record.total_time)),r}doViewClickResult(r){d.isSet(this.current_edit_record.start_date)&&this.edit_view_tab&&this.edit_view_tab.find("#tab_request").find(".third-column").show(),this.initEditView(),this.initViewingView(),this.onWorkingStatusChanged();var e=this;return EmbeddedMessage.init(this.current_edit_record.id,50,this,this.edit_view,this.edit_view_tab,this.edit_view_ui_dic,function(){e.authorization_history=AuthorizationHistory.init(e),e.setEditMenu()}),this.clearCurrentSelectedRecord()}onViewClick(r,e){e&&this.clearEditView(),super.onViewClick(r)}setSubLogViewFilter(){return this.sub_log_view_controller?(this.sub_log_view_controller.getSubViewFilter=function(r){return r.table_name_object_id={request:[this.parent_edit_record.id],request_schedule:[this.parent_edit_record.request_schedule_id]},r},!0):!1}initViewingView(){this.showAdvancedFields()}initEditViewUI(r,e){d.setUINotready(),TTPromise.add("init","init"),TTPromise.wait();var t=this;this.edit_view&&this.edit_view.remove(),this.edit_view=a(d.loadViewSource(r,e,null,!0)),this.edit_view_tab=a(this.edit_view.find(".edit-view-tab-bar")),this.edit_view_tab.attr("id",this.ui_id+"_edit_view_tab"),d.contentContainer().append(this.edit_view),this.initRightClickMenu(RightClickMenuType.EDITVIEW),this.is_viewing?(LocalCacheData.current_doing_context_action="view",this.buildViewUI()):this.is_edit&&(LocalCacheData.current_doing_context_action="edit",this.buildEditViewUI(),ContextMenuManager.unmountContextMenu(this.determineContextMenuMountAttributes().id),this.buildContextMenu(!0)),t.setEditViewTabHeight()}initEditViewTabs(){var r=this,e={activate:function(t,_){r.onTabShow(t,_)}};super.initEditViewTabs(e)}onEditClick(r,e){this.setCurrentEditViewState("edit"),this.initEditViewUI(this.viewId,this.edit_view_tpl),this.initEditView(),this.edit_view_ui_dic.body.setValue(""),this.setEditMenu()}buildViewUI(){super.buildEditViewUI();var r=this,e={tab_request:{label:a.i18n._("Request"),html_template:this.getRequestTabHtml()},tab_audit:!0};this.setTabModel(e),this.navigation.AComboBox({api_class:TTAPI.APIRequest,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_request",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation();var i,t,_,o=this.edit_view_tab.find("#tab_request"),l=o.find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(l),i=d.loadWidgetByName(FormItemType.TEXT),i.TText({field:"full_name"}),this.addEditFieldToColumn(a.i18n._("Employee"),i,l);var i=d.loadWidgetByName(FormItemType.TEXT);i.TText({field:"type",set_empty:!1}),this.addEditFieldToColumn(a.i18n._("Type"),i,l);var i=d.loadWidgetByName(FormItemType.TEXT);if(i.TText({field:"date_stamp"}),this.addEditFieldToColumn(a.i18n._("Date"),i,l),d.getProductEdition()>=15){var i=d.loadWidgetByName(FormItemType.COMBO_BOX);i.TComboBox({field:"request_schedule_status_id",set_empty:!1}),i.setSourceData({10:"Working",20:"Absent"}),this.addEditFieldToColumn(a.i18n._("Status"),i,l),i.bind("change",function(p){r.onWorkingStatusChanged()}),i=d.loadWidgetByName(FormItemType.AWESOME_BOX),i.AComboBox({api_class:TTAPI.APIAbsencePolicy,allow_multiple_selection:!1,layout_name:"global_absences",set_empty:!0,field:"absence_policy_id",customSearchFilter:function(p){return r.setAbsencePolicyFilter(p)},setRealValueCallBack:function(p){r.selected_absence_policy_record=p,r.onAvailableBalanceChange()}}),this.addEditFieldToColumn(a.i18n._("Absence Policy"),i,l),i=d.loadWidgetByName(FormItemType.TEXT),i.TText({field:"available_balance"}),t=a("<div class='widget-h-box available-balance-h-box'></div>"),this.available_balance_info=a('<span class="available-balance-info tticon tticon-info_black_24dp"></span>'),t.append(i),t.append(this.available_balance_info),this.addEditFieldToColumn(a.i18n._("Available Balance"),i,l,"",t,!0),i=d.loadWidgetByName(FormItemType.DATE_PICKER),i.TDatePicker({field:"start_date"}),this.addEditFieldToColumn(a.i18n._("Start Date"),i,l,""),i=d.loadWidgetByName(FormItemType.DATE_PICKER),i.TDatePicker({field:"end_date"}),this.addEditFieldToColumn(a.i18n._("End Date"),i,l,"");var u=d.loadWidgetByName(FormItemType.CHECKBOX);u.TCheckbox({field:"sun"});var n=d.loadWidgetByName(FormItemType.CHECKBOX);n.TCheckbox({field:"mon"});var s=d.loadWidgetByName(FormItemType.CHECKBOX);s.TCheckbox({field:"tue"});var c=d.loadWidgetByName(FormItemType.CHECKBOX);c.TCheckbox({field:"wed"});var v=d.loadWidgetByName(FormItemType.CHECKBOX);v.TCheckbox({field:"thu"});var h=d.loadWidgetByName(FormItemType.CHECKBOX);h.TCheckbox({field:"fri"});var f=d.loadWidgetByName(FormItemType.CHECKBOX);f.TCheckbox({field:"sat"}),t=a("<div></div>");var w=a("<span class='widget-top-label'> "+a.i18n._("Sun")+" <br>  </span>"),y=a("<span class='widget-top-label'> "+a.i18n._("Mon")+" <br>  </span>"),C=a("<span class='widget-top-label'> "+a.i18n._("Tue")+" <br>  </span>"),I=a("<span class='widget-top-label'> "+a.i18n._("Wed")+" <br>  </span>"),E=a("<span class='widget-top-label'> "+a.i18n._("Thu")+" <br>  </span>"),A=a("<span class='widget-top-label'> "+a.i18n._("Fri")+" <br>  </span>"),q=a("<span class='widget-top-label'> "+a.i18n._("Sat")+" <br>  </span>");if(w.append(u),y.append(n),C.append(s),I.append(c),E.append(v),A.append(h),q.append(f),t.append(w),t.append(y),t.append(C),t.append(I),t.append(E),t.append(A),t.append(q),t.addClass("request_edit_view_effective_days"),this.addEditFieldToColumn(a.i18n._("Effective Days"),[u,n,s,c,v,h,f],l,"",t,!1,!0),i=d.loadWidgetByName(FormItemType.TIME_PICKER),i.TTimePicker({field:"start_time"}),this.addEditFieldToColumn(a.i18n._("In"),i,l),i=d.loadWidgetByName(FormItemType.TIME_PICKER),i.TTimePicker({field:"end_time"}),this.addEditFieldToColumn(a.i18n._("Out"),i,l),i=d.loadWidgetByName(FormItemType.TEXT),i.TText({field:"total_time"}),t=a("<div class='widget-h-box'></div>"),_=a("<span class='widget-right-label' id='total_info'></span>"),t.append(i),t.append(_),this.addEditFieldToColumn(a.i18n._("Total"),i,l,"",t),d.getProductEdition()>=15&&this.overlappingShiftUIValidate()==!0){var i=d.loadWidgetByName(FormItemType.COMBO_BOX);i.TComboBox({field:"overlap_type_id",set_empty:!1}),i.setSourceData(this.overlap_type_array),t=a("<div class='widget-h-box overlapping-shift-h-box'></div>"),this.overlapping_shift_info=a('<span style="position: relative; top: -3px; left: 3px;" id="overlapping-shift-total"></span><span id="overlapping-shift-icon" class="overlapping-shift-info tticon tticon-info_black_24dp"></span>'),t.append(i),t.append(this.overlapping_shift_info),this.addEditFieldToColumn(a.i18n._("Overlapping Shift(s)"),i,l,"",t,!0),i=d.loadWidgetByName(FormItemType.CHECKBOX),i.TCheckbox({field:"is_replace_with_open_shift"}),t=a("<div class='widget-h-box'></div>"),_=a("<span class='widget-right-label'>( "+a.i18n._("For Absences")+" )</span>"),t.append(i),t.append(_),this.addEditFieldToColumn(a.i18n._("Create Open Shift"),i,l,"",t,!0)}if(i=d.loadWidgetByName(FormItemType.AWESOME_BOX),i.AComboBox({api_class:TTAPI.APISchedulePolicy,allow_multiple_selection:!1,layout_name:"global_schedule",show_search_inputs:!0,set_empty:!0,field:"schedule_policy_id"}),this.addEditFieldToColumn(a.i18n._("Schedule Policy"),i,l),i=d.loadWidgetByName(FormItemType.AWESOME_BOX),i.AComboBox({api_class:TTAPI.APIBranch,allow_multiple_selection:!1,layout_name:"global_branch",show_search_inputs:!0,set_empty:!0,field:"branch_id"}),this.addEditFieldToColumn(a.i18n._("Branch"),i,l),this.show_branch_ui||this.detachElement("branch_id"),i=d.loadWidgetByName(FormItemType.AWESOME_BOX),i.AComboBox({api_class:TTAPI.APIDepartment,allow_multiple_selection:!1,layout_name:"global_department",show_search_inputs:!0,set_empty:!0,field:"department_id"}),this.addEditFieldToColumn(a.i18n._("Department"),i,l),this.show_department_ui||this.detachElement("department_id"),d.getProductEdition()>=20){i=d.loadWidgetByName(FormItemType.AWESOME_BOX),i.AComboBox({api_class:TTAPI.APIJob,allow_multiple_selection:!1,layout_name:"global_job",show_search_inputs:!0,set_empty:!0,setRealValueCallBack:function(p){p&&m.setValue(p.manual_id)},field:"job_id",added_items:[{value:"-1",label:d.default_item},{value:"-2",label:d.selected_item}]}),t=a("<div class='widget-h-box'></div>");var m=d.loadWidgetByName(FormItemType.TEXT_INPUT);m.TTextInput({field:"job_quick_search",disable_keyup_event:!0}),m.addClass("job-coder"),t.append(m),t.append(i),this.addEditFieldToColumn(a.i18n._("Job"),[i,m],l,"",t,!0),this.show_job_ui||this.detachElement("job_id"),i=d.loadWidgetByName(FormItemType.AWESOME_BOX),i.AComboBox({api_class:TTAPI.APIJobItem,allow_multiple_selection:!1,layout_name:"global_job_item",show_search_inputs:!0,set_empty:!0,setRealValueCallBack:function(p){p&&g.setValue(p.manual_id)},field:"job_item_id",added_items:[{value:"-1",label:d.default_item},{value:"-2",label:d.selected_item}]}),t=a("<div class='widget-h-box'></div>");var g=d.loadWidgetByName(FormItemType.TEXT_INPUT);g.TTextInput({field:"job_item_quick_search",disable_keyup_event:!0}),g.addClass("job-coder"),t.append(g),t.append(i),this.addEditFieldToColumn(a.i18n._("Task"),[i,g],l,"",t,!0),this.show_job_item_ui||this.detachElement("job_item_id"),i=d.loadWidgetByName(FormItemType.AWESOME_BOX),i.AComboBox({api_class:TTAPI.APIPunchTag,allow_multiple_selection:!0,layout_name:"global_punch_tag",show_search_inputs:!0,set_empty:!0,setRealValueCallBack:p=>{p&&this.setPunchTagQuickSearchManualIds(p)},field:"punch_tag_id"}),t=a("<div class='widget-h-box'></div>");var b=d.loadWidgetByName(FormItemType.TEXT_INPUT);b.TTextInput({field:"punch_tag_quick_search",disable_keyup_event:!0}),b.addClass("job-coder"),t.append(b),t.append(i),this.addEditFieldToColumn(a.i18n._("Punch Tags"),[i,b],l,"",t,!0),this.show_punch_tag_ui||this.detachElement("punch_tag_id")}}EmbeddedMessage.initUI(this,o)}setAbsencePolicyFilter(r){return r.filter_data||(r.filter_data={}),r.filter_data.user_id=this.current_edit_record.user_id,r.filter_columns&&(r.filter_columns.absence_policy=!0),r}needShowNavigation(){return!!(this.is_viewing&&this.current_edit_record&&d.isSet(this.current_edit_record.id)&&this.current_edit_record.id)}onNavigationClick(r){var e=this,t,_,o,l,i;switch(r){case"timesheet":t={filter_data:{}},d.isSet(this.current_edit_record)?(t.user_id=this.current_edit_record.user_id?this.current_edit_record.user_id:LocalCacheData.loginUser.id,t.base_date=this.current_edit_record.date_stamp,d.addViewTab(e.viewId,a.i18n._("Authorization - Request"),window.location.href),IndexViewController.goToView("TimeSheet",t)):(_={},o=this.getGridSelectIdArray(),l=o.length,l>0&&(i=o[0],_.filter_data={},_.filter_columns={user_id:!0,date_stamp:!0},_.filter_data.id=[i],this.api["get"+this.api.key_name](_,{onResult:function(n){var s=n.getResult();s||(s=[]),s=s[0],t.user_id=s.user_id,t.base_date=s.date_stamp,d.addViewTab(e.viewId,a.i18n._("Authorization - Request"),window.location.href),IndexViewController.goToView("TimeSheet",t)}})));break;case"edit_employee":t={filter_data:{}},d.isSet(this.current_edit_record)?IndexViewController.openEditView(this,"Employee",this.current_edit_record.user_id?this.current_edit_record.user_id:LocalCacheData.loginUser.id):(_={},o=this.getGridSelectIdArray(),l=o.length,l>0&&(i=o[0],_.filter_data={},_.filter_columns={user_id:!0},_.filter_data.id=[i],this.api["get"+this.api.key_name](_,{onResult:function(n){var s=n.getResult();s||(s=[]),s=s[0],IndexViewController.openEditView(e,"Employee",s.user_id)}})));break;case"schedule":t={filter_data:{}};var u=null;d.isSet(this.current_edit_record)?(u=[this.current_edit_record.user_id?this.current_edit_record.user_id:LocalCacheData.loginUser.id],t.filter_data.include_user_ids={value:u},t.select_date=this.current_edit_record.date_stamp,d.addViewTab(e.viewId,a.i18n._("Authorization - Request"),window.location.href),IndexViewController.goToView("Schedule",t)):(_={},o=this.getGridSelectIdArray(),l=o.length,l>0&&(i=o[0],_.filter_data={},_.filter_columns={user_id:!0,date_stamp:!0},_.filter_data.id=[i],this.api["get"+this.api.key_name](_,{onResult:function(n){var s=n.getResult();s||(s=[]),s=s[0],u=[s.user_id],t.filter_data.include_user_ids=u,t.select_date=s.date_stamp,d.addViewTab(e.viewId,a.i18n._("Authorization - Request"),window.location.href),IndexViewController.goToView("Schedule",t)}})));break}}initPermission(){PermissionManager.validate(this.permission_id,"view")||PermissionManager.validate(this.permission_id,"view_child")?this.show_search_tab=!0:this.show_search_tab=!1,this.jobUIValidate()?this.show_job_ui=!0:this.show_job_ui=!1,this.jobItemUIValidate()?this.show_job_item_ui=!0:this.show_job_item_ui=!1,this.punchTagUIValidate()?this.show_punch_tag_ui=!0:this.show_punch_tag_ui=!1,this.branchUIValidate()?this.show_branch_ui=!0:this.show_branch_ui=!1,this.departmentUIValidate()?this.show_department_ui=!0:this.show_department_ui=!1;var r=TTAPI.APICompany;if(r&&T.isFunction(r.isBranchAndDepartmentAndJobAndJobItemAndPunchTagEnabled))var e=r.isBranchAndDepartmentAndJobAndJobItemAndPunchTagEnabled({async:!1});e?(e=e.getResult(),e.branch||(this.show_branch_ui=!1),e.department||(this.show_department_ui=!1),e.job||(this.show_job_ui=!1),e.job_item||(this.show_job_item_ui=!1),e.punch_tag||(this.show_punch_tag_ui=!1)):(this.show_branch_ui=!1,this.show_department_ui=!1,this.show_job_ui=!1,this.show_job_item_ui=!1,this.show_punch_tag_ui=!1)}setEditMenuEditIcon(r){this.editPermissionValidate("request")||ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,r.id,!1),this.editOwnerOrChildPermissionValidate("request")?this.enable_edit_view_ui=!0:this.enable_edit_view_ui=!1,(!this.editOwnerOrChildPermissionValidate("request")||this.is_add||this.is_edit)&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,r.id,!1)}getOverlappingShifts(){let r=this;if(!this.current_edit_record||!this.current_edit_record.type_id||this.overlappingShiftUIValidate()==!1||d.getProductEdition()<15||!(this.current_edit_record.type_id==30||this.current_edit_record.type_id==40))return;let e={};e.start_date=this.current_edit_record.start_date,e.end_date=this.current_edit_record.end_date,e.user_id=this.current_edit_record.user_id,e.start_time=this.current_edit_record.start_time,e.end_time=this.current_edit_record.end_time,e.overlap_type_id=this.current_edit_record.overlap_type_id,e.schedule_policy_id=this.current_edit_record.schedule_policy_id,e.absence_policy_id=this.current_edit_record.absence_policy_id,e.request_schedule_status_id=this.current_edit_record.request_schedule_status_id,e.requested_days={},e.requested_days[0]=this.current_edit_record.sun,e.requested_days[1]=this.current_edit_record.mon,e.requested_days[2]=this.current_edit_record.tue,e.requested_days[3]=this.current_edit_record.wed,e.requested_days[4]=this.current_edit_record.thu,e.requested_days[5]=this.current_edit_record.fri,e.requested_days[6]=this.current_edit_record.sat,e.is_replace_with_open_shift=this.current_edit_record.is_replace_with_open_shift,this.schedule_api.getOverlappingShifts(e,{onResult:function(t){let _=t.getResult();!_||!_.split||(r.overlapping_shift_data=_,r.buildOverlappingShiftInfo())}})}buildOverlappingShiftInfo(){let r=this;if(!this.current_edit_record)return;let e="",t=this.overlapping_shift_data.split,_=0,o=0,l=0,i=0,u=10;if(_=this.overlapping_shift_data.no_overlap.length,l+=this.overlapping_shift_data.no_overlap.reduce((n,s)=>parseFloat(n)+parseFloat(s.total_time),0),this.current_edit_record.overlap_type_id==10?(_+=this.overlapping_shift_data.open_replaced.length,l+=this.overlapping_shift_data.open_replaced.reduce((n,s)=>parseFloat(n)+parseFloat(s.total_time),0)):this.current_edit_record.overlap_type_id==20&&(_+=t.length,l+=t.reduce((n,s)=>n+s.total_time,0)),this.current_edit_record.is_replace_with_open_shift==!0&&(_+=this.overlapping_shift_data.open_replaced.length,l+=this.overlapping_shift_data.open_replaced.reduce((n,s)=>parseFloat(n)+parseFloat(s.total_time),0)),o=this.overlapping_shift_data.original.filter(n=>!n.not_unique&&!n.do_not_split).length,i=this.overlapping_shift_data.original.filter(n=>!n.not_unique&&!n.do_not_split).reduce((n,s)=>parseFloat(n)+parseFloat(s.total_time),0),a("#overlapping-shift-total").text("( "+o+" / "+_+" )"),Array.isArray(t)){let n={};for(let s=0;s<t.length;s++)if(t[s].split_state!=="no_split"&&(n[t[s].split_parent]||(n[t[s].split_parent]=[]),n[t[s].split_parent].push(t[s]),u==10)){let c=this.overlapping_shift_data.original.find(v=>v.id===t[s].split_parent);c&&parseFloat(t[s].total_time)/parseFloat(c.total_time)*100<50&&(u=20)}if(e+='<table class="overlapping-info-table">',this.current_edit_record.overlap_type_id!=u){let s=u==10?a.i18n._("Replace"):a.i18n._("Split");e+='<tr><th colspan="3" style="text-align: center; color: red;">'+a.i18n._("Suggested Overlapping Shift(s) Mode")+": <strong>"+s+"</strong></th></tr>",a("#overlapping-shift-icon").css("color","red")}else a("#overlapping-shift-icon").css("color","");this.current_edit_record.overlap_type_id==20&&t.length>0?e+='<th colspan="3" style="text-align: center">'+a.i18n._("Overlapping Shifts")+"</th></tr>":this.current_edit_record.overlap_type_id==10&&this.overlapping_shift_data.open_replaced.length>0&&(e+='<tr><th colspan="3" style="text-align: center">'+a.i18n._("Replaced Shifts")+"</th></tr>"),T.size(n)>0&&(e+=this.getOverlappingShiftHeaderHtml());for(let s in n){let c=this.overlapping_shift_data.original.find(h=>h.id===n[s][0].split_parent);e+="<tr>",e+="<td>"+c.start_date+"</td>",e+="<td>"+c.start_time+" - "+c.end_time+" = "+d.getTimeUnit(c.total_time)+"</td>";let v=!1;for(let h=0;h<n[s].length;h++)if(this.current_edit_record.overlap_type_id==20||n[s][h].split_state==="new"||n[s][h].split_state==="replaced"){v===!0&&(e+="</tr>",e+="<tr>",e+="<td>"+n[s][h].start_date+"</td>",e+="<td></td>");let f=n[s][h].split_state==="new"?a.i18n._("New"):a.i18n._("Modified"),w=n[s][h].is_absence?"overlap-absence":"";e+='<td class ="'+w+'">'+n[s][h].start_time+" - "+n[s][h].end_time+" = "+d.getTimeUnit(n[s][h].total_time)+" ["+f+"] </td>",v===!0&&(e+="</tr>"),v=!0}e+="</tr>"}if(Array.isArray(this.overlapping_shift_data.no_overlap)&&this.overlapping_shift_data.no_overlap.length>0){e+='<tr style="border-bottom: 15px solid transparent;"></tr>',e+='<tr><th colspan="3" style="text-align: center">'+a.i18n._("New Shifts (Not Overlapping)")+"</th></tr>",T.size(n)===0&&(e+=this.getOverlappingShiftHeaderHtml());for(let s=0;s<this.overlapping_shift_data.no_overlap.length;s++){let c=this.current_edit_record.request_schedule_status_id==20?"overlap-absence":"";e+='<tr class="'+c+'">',e+="<td>"+this.overlapping_shift_data.no_overlap[s].start_date+"</td>",e+="<td></td>",e+="<td>"+this.overlapping_shift_data.no_overlap[s].start_time+" - "+this.overlapping_shift_data.no_overlap[s].end_time+" = "+d.getTimeUnit(this.overlapping_shift_data.no_overlap[s].total_time)+"</td>",e+="<tr>"}}if(this.current_edit_record.is_replace_with_open_shift==!0&&Array.isArray(this.overlapping_shift_data.open_replaced)&&this.overlapping_shift_data.open_replaced.length>0){e+='<tr style="border-bottom: 15px solid transparent;"></tr>',e+='<tr><th colspan="3" style="text-align: center">'+a.i18n._("New Open Shifts")+"</th></tr>";for(let s=0;s<this.overlapping_shift_data.open_replaced.length;s++)e+="<tr>",e+="<td>"+this.overlapping_shift_data.open_replaced[s].start_date+"</td>",e+="<td></td>",e+="<td>"+this.overlapping_shift_data.open_replaced[s].start_time+" - "+this.overlapping_shift_data.open_replaced[s].end_time+" = "+d.getTimeUnit(this.overlapping_shift_data.open_replaced[s].total_time)+"</td>",e+="<tr>"}this.overlapping_shift_data.original.length>0||this.overlapping_shift_data.no_overlap.length>0?(e+='<tr style="border-bottom: 15px solid transparent;"></tr>',e+='<tr style="text-align: center"> <th>'+a.i18n._("Total Shifts")+"</th><th>"+o+" = "+d.getTimeUnit(i)+"</th> <th>"+_+" = "+d.getTimeUnit(l)+"</th></tr>"):e+='<tr><th colspan="3" style="text-align: center">'+a.i18n._("No New or Overlapping Shifts")+"</th>"+e+"</tr>",e+="</table>"}r.overlapping_shift_info&&r.overlapping_shift_info.qtip({show:{event:"click",delay:10,effect:!0},hide:{event:["unfocus click"]},style:{width:525,classes:"overlapping-info-display"},content:e})}getOverlappingShiftHeaderHtml(){return`<tr>
					<th style="text-align: center">`+a.i18n._("Date")+`</th>
					<th style="text-align: center">`+a.i18n._("Before")+`</th>
					<th style="text-align: center">`+a.i18n._("After")+`</th>
				</tr>
				`}uniformMessageVariable(r){var e={};return e.subject=this.edit_view_ui_dic.subject.getValue(),e.body=this.edit_view_ui_dic.body.getValue(),e.object_id=this.current_edit_record.id,e.object_type_id=50,e}getRequestTabHtml(){return`
		<div id="tab_request" class="edit-view-tab-outside">
			<div class="edit-view-tab" id="tab_request_content_div">
				<div class="first-column full-width-column"></div>
				<div class="authorization-grid-div inside-grid full-width-column">
					<div class="grid-top-border"></div>
					<div class="grid-title separated-box"></div>
					<table id="grid"></table>
					<div class="bottom-div">
						<div class="grid-bottom-border"></div>
					</div>
				</div>
				<div class="separate full-width-column"></div>
				<div class="second-column embedded-message-template full-width-column" style="margin-left: 0"></div>
			</div>
		</div>`}}export{B as RequestViewCommonController};
//# sourceMappingURL=RequestViewCommonController-DYz5psWn.bundle.js.map
