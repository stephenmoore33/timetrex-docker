import{j as d}from"./vendor-tTApdY0Y.bundle.js";class g extends BaseViewController{setSelectLayout(e){var t=this,a;Global.isSet(this.grid)||(a=d(this.el).find("#grid"),a.attr("id",this.ui_id+"_grid"),a=d(this.el).find("#"+this.ui_id+"_grid"));var i=[];this.select_layout||(this.select_layout={id:""},this.select_layout.data={filter_data:{},filter_sort:{}},this.select_layout.data.display_columns=this.default_display_columns);var s=this.select_layout.data;s.display_columns.length<1&&(s.display_columns=this.default_display_columns);var o=this.buildDisplayColumns(s.display_columns);o.length,Global.isSet(e)&&e>0;var r=o[0],l={name:r.value,index:r.value,label:t.grid_table_name,width:100,sortable:!1,title:!1};i.push(l),this.grid&&(this.grid.jqGrid("GridUnload"),this.grid=null),this.grid=new TTGrid(this.ui_id+"_grid",{multiselect:!1,winMultiSelect:!1,tree_mode:!0,onSelectRow:d.proxy(this.onGridSelectRow,this)},i),this.bindGridColumnEvents(),this.setGridHeaderStyle(),this.filter_data=this.select_layout.data.filter_data,this.showGridBorders(),t.setGridSize()}search(e,t,a){var i=this;Global.isSet(e)||(e=!0);var s={};s.filter_data={},s.filter_sort={},s.filter_columns=this.getFilterColumnsFromDisplayColumns(),s.filter_items_per_page=0,this.sub_view_mode&&this.parent_key&&(this.select_layout.data.filter_data[this.parent_key]=this.parent_value,Global.isSet(this.getSubViewFilter)&&(this.select_layout.data.filter_data=this.getSubViewFilter(this.select_layout.data.filter_data))),this.last_select_ids=this.getGridSelectIdArray(),s.filter_data=Global.convertLayoutFilterToAPIFilter(this.select_layout),s.filter_sort=this.select_layout.data.filter_sort,this.api["get"+this.api.key_name](s,!1,!1,{onResult:function(o){var r=o.getResult();r=Global.buildTreeRecord(r),i.grid_current_page_items=r,Global.isArray(r)?i.removeNoResultCover():i.showNoResultCover(),i.reSetGridTreeData(r),i.setGridSize(),ProgressBar.closeOverlay(),e&&i.setDefaultMenu(),LocalCacheData.paging_type===0&&(!i.pager_data||i.pager_data.is_last_page?i.paging_widget.css("display","none"):i.paging_widget.css("display","block")),i.reSelectLastSelectItems(),i.autoOpenEditViewIfNecessary(),i.searchDone()}})}setDefaultMenu(e){var t=this.getSelectedItem(),a=ContextMenuManager.getMenuModelByMenuId(this.determineContextMenuMountAttributes().id);if(t!==null&&t.id==TTUUID.zero_id){for(var i=a.length,s=this.getGridSelectIdArray(),o=s.length,r=0;r<i;r++){let l=a[r];a[r].id=="add"?this.setDefaultMenuAddIcon(l,o):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,l.id,!1)}return}super.setDefaultMenu(e)}onEditClick(e,t){if(e===TTUUID.zero_id)return!1;super.onEditClick(e,t)}reSetGridTreeData(e){var t=this,a=this.grid.getGridParam("colModel");this.grid.grid.jqGrid("GridUnload"),this.grid=null,this.grid=new TTGrid(this.ui_id+"_grid",{multiselect:!1,winMultiSelect:!1,datastr:e,datatype:"jsonstring",sortable:!1,onSelectRow:function(i){d("#ribbon_view_container .context-menu:visible a").click(),t.grid_select_id_array=[i],t.setDefaultMenu()},ondblClickRow:function(){t.getEditSelectedRecordId()!==TTUUID.zero_id&&t.onGridDblClickRow()},gridview:!0,treeGrid:!0,treeGridModel:"adjacency",treedatatype:"local",ExpandColumn:"name"},a)}getGridSelectIdArray(){var e=[];return e=this.grid_select_id_array,e}initLayout(){var e=this;this.real_this=this.constructor.__super__,e.getDefaultDisplayColumns(function(){e.setSelectLayout(),e.search()})}getAllColumns(e){var t=this;this.api.getOptions("columns",{onResult:function(a){var i=a.getResult();t.all_columns=Global.buildColumnArray(i),e&&e()}})}setCurrentEditRecordData(){for(var e in this.current_edit_record){var t=this.edit_view_ui_dic[e];if(Global.isSet(t))switch(e){case"parent_id":t.setSourceData(this.grid_current_page_items),t.setValue(this.current_edit_record[e]);break;default:t.setValue(this.current_edit_record[e]);break}}this.collectUIDataToCurrentEditRecord(),this.setEditViewDataDone()}setEditViewData(){var e=this;if(this.is_changed=!1,!this.edit_only_mode){var t=this.edit_view.find(".navigation-div");if(Global.isSet(this.current_edit_record.id)&&this.current_edit_record.id){if(t.css("display","block"),!this.navigation.getSourceData()){this.navigation.setSourceData(this.grid_current_page_items.filter(s=>s.id!==TTUUID.zero_id));var a={};a.filter_data=Global.convertLayoutFilterToAPIFilter(this.select_layout),a.filter_sort=this.select_layout.data.filter_sort,this.navigation.setDefaultArgs(a)}this.navigation.setValue(this.current_edit_record)}else t.css("display","none")}for(var i in this.edit_view_ui_dic)!Global.isSet(e.current_edit_record[i])&&!this.is_mass_editing&&(e.current_edit_record[i]=!1);this.setNavigationArrowsStatus(),this.setNavigationArrowsEnabled(),this.setCurrentEditRecordData(),this.edit_view.find(".save-and-continue-div").SaveAndContinueBox({related_view_controller:this}),this.edit_view.find(".save-and-continue-div").css("display","none"),this.edit_view_tab.tabs("option","active")===1&&(this.current_edit_record.id?(this.edit_view_tab.find("#tab_audit").find(".first-column-sub-view").css("display","block"),this.initSubLogView("tab_audit")):(this.edit_view_tab.find("#tab_audit").find(".first-column-sub-view").css("display","none"),this.edit_view.find(".save-and-continue-div").css("display","block"))),this.switchToProperTab()}addIdFieldToNavigation(e){return d.each(e,function(t,a){d(a).each(function(i,s){s.id=s._id_})}),e}doViewAPICall(e){return super.doViewAPICall(e,[e,!1,!1])}handleViewAPICallbackResult(e){return this.handleAPICallbackResult(e)}handleAPICallbackResult(e){var t=e.getResult(),a=this.getCurrentSelectedRecord();t=Global.getParentIdByTreeRecord(Global.buildTreeRecord(t),a),t=t[0],t.id=a,super.handleViewAPICallbackResult(t)}handleEditAPICallbackResult(e){return this.handleAPICallbackResult(e)}onDeleteDone(e){this.grid_select_id_array=[],this.setDefaultMenu(),this.removeDeletedRows()}onSaveDone(e){this.grid_select_id_array=[]}doEditAPICall(e){return super.doEditAPICall(e,[e,!1,!1])}_continueDoCopyAsNew(){var e=this;if(this.setCurrentEditViewState("new"),LocalCacheData.current_doing_context_action="copy_as_new",Global.isSet(this.edit_view)){this.current_edit_record.id="";var t=this.edit_view.find(".navigation-div");t.css("display","none"),this.setEditMenu(),this.setTabStatus(),this.is_changed=!1,ProgressBar.closeOverlay()}else{var a={},i=this.getGridSelectIdArray(),s=i.length;if(s>0)var o=i[0];else{TAlertManager.showAlert(d.i18n._("No selected record"));return}a.filter_data={},this.api["get"+this.api.key_name](a,!1,!1,{onResult:function(r){var l=r.getResult();if(l=Global.buildTreeRecord(l),l=Global.getParentIdByTreeRecord(l,o),!l){TAlertManager.showAlert(d.i18n._("Record does not exist")),e.onCancelClick();return}e.openEditView(),l=l[0],e.sub_view_mode&&e.parent_key&&(l[e.parent_key]=e.parent_value),e.current_edit_record=l,e.current_edit_record.id="",e.initEditView()}})}}buildEditViewUI(){var e=this;if(ContextMenuManager.getMenu(this.determineContextMenuMountAttributes().id)===void 0?this.buildContextMenu():Debug.Warn("Context Menu ("+this.determineContextMenuMountAttributes().id+") already exists for: "+this.viewId,"BaseTreeViewController.js","BaseTreeViewController","buildEditViewUI",10),!this.edit_only_mode){var t=this.edit_view.find(".navigation-div"),a=t.find(".navigation-label"),i=t.find(".navigation-widget-div");this.navigation=Global.loadWidgetByName(FormItemType.AWESOME_BOX),a.text(this.navigation_label),i.append(this.navigation)}this.edit_view_close_icon=this.edit_view.find(".close-icon"),this.edit_view_close_icon.hide(),this.edit_view_close_icon.click(function(){e.onCloseIconClick()});var s=Array();s[this.primary_tab_key]={label:this.primary_tab_label},s.tab_audit={label:d.i18n._("Audit"),init_callback:"initSubLogView",display_on_mass_edit:!1,display_on_add:!1},this.setTabModel(s),this.navigation.AComboBox({id:this.script_name+"_navigation",tree_mode:!0,allow_multiple_selection:!1,layout_name:"global_tree_column",navigation_mode:!0,show_search_inputs:!1,on_tree_grid_row_select:function(u,c){e.onTreeGridNavigationRowSelect(u,c)}});var o=t.find(".left-click"),r=t.find(".right-click");o.attr("src",Global.getRealImagePath("images/left_arrow.svg")),r.attr("src",Global.getRealImagePath("images/right_arrow.svg")),this.setNavigation();var l=this.edit_view_tab.find("#"+this.primary_tab_key),_=l.find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(_);var n=Global.loadWidgetByName(FormItemType.AWESOME_BOX);n.AComboBox({tree_mode:!0,allow_multiple_selection:!1,show_search_inputs:!1,layout_name:"global_tree_column",set_empty:!0,field:"parent_id"}),this.addEditFieldToColumn(d.i18n._("Parent"),n,_,""),n=Global.loadWidgetByName(FormItemType.TEXT_INPUT),n.TTextInput({field:"name",width:"100%"}),this.addEditFieldToColumn(d.i18n._("Name"),n,_,""),n.parent().width("45%")}}export{g as BaseTreeViewController};
//# sourceMappingURL=BaseTreeViewController-D_H2B3QY.bundle.js.map
