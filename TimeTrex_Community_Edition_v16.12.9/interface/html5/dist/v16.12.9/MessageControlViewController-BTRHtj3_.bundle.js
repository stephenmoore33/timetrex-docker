import{_ as u,j as a}from"./vendor-tTApdY0Y.bundle.js";import{l as _}from"./linkify-string.es-CAumhp2W.bundle.js";class f extends BaseViewController{constructor(e={}){u.defaults(e,{el:"#message_control_view_container",object_type_array:null,is_request:!1,is_message:!1,messages:null,request_api:null,folder_id:null,navigation_source_data:null,isReloadViewUI:!1,current_select_message_control_data:null}),super(e)}init(e){this.edit_view_tpl="MessageControlEditView.html",this.permission_id="message",this.viewId="MessageControl",this.script_name="MessageControlView",this.table_name_key="message_control",this.context_menu_name=a.i18n._("Message"),this.api=TTAPI.APIMessageControl,this.request_api=TTAPI.APIRequest,this.folder_id=10,this.event_bus=new TTEventBus({view_id:this.viewId}),this.render(),this.buildContextMenu(),this.initData()}initOptions(){this.initDropDownOption("object_type")}buildSearchFields(){super.buildSearchFields();var e={};e.permission_section="message",this.search_fields=[new SearchField({label:a.i18n._("Employee"),in_column:1,field:"user_id",default_args:e,layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:a.i18n._("Type"),in_column:1,multiple:!0,field:"object_type_id",basic_search:!0,adv_search:!1,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:a.i18n._("Subject"),in_column:1,field:"subject",multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:a.i18n._("Created By"),in_column:2,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:a.i18n._("Updated By"),in_column:2,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX})]}getSubViewFilter(e){return e.length===0&&(e={}),e.folder_id=this.folder_id,e}getCustomContextMenuModel(){var e={exclude:["default"],include:[{label:a.i18n._("New"),id:"add",vue_icon:"tticon tticon-add_black_24dp"},{label:a.i18n._("View"),id:"view",vue_icon:"tticon tticon-visibility_black_24dp",show_on_right_click:!0,sort_order:1010},{label:a.i18n._("Reply"),id:"edit",vue_icon:"tticon tticon-reply_black_24dp"},{label:a.i18n._("Delete"),id:"delete_icon",action_group:"delete",vue_icon:"tticon tticon-delete_black_24dp"},{label:a.i18n._("Delete & Next"),id:"delete_and_next",action_group:"delete",vue_icon:"tticon tticon-delete_black_24dp"},{label:a.i18n._("Send"),id:"send",vue_icon:"tticon tticon-send_black_24dp"},{label:a.i18n._("Cancel"),id:"cancel",permission_result:!0,permission:null,sort_order:1990},{label:a.i18n._("Folder: Inbox"),id:"inbox",action_group:"message_type",multi_select_group:1,selected:!0,permission_result:!0,permission:null},{label:a.i18n._("Folder: Sent"),id:"sent",action_group:"message_type",multi_select_group:1,selected:!1,permission_result:!0,permission:null},{label:a.i18n._("Export"),id:"export_excel",vue_icon:"tticon tticon-file_upload_black_24dp",menu_align:"right",permission_result:!0,permission:null,sort_order:9e3}]};return e}setCustomDefaultMenuIcon(e,t,i){switch(e){case"close_misc":this.setDefaultMenuCloseMiscIcon(t,i);break;case"send":this.setDefaultMenuSendIcon(t,i);break;case"cancel":this.setDefaultMenuCancelIcon(t,i);break;case"inbox":this.folder_id===10&&this.setCurrentSelectedIcon(t),this.setDefaultMenuInboxIcon(t,i);break;case"sent":this.folder_id===20&&this.setCurrentSelectedIcon(t),this.setDefaultMenuSentIcon(t,i);break}}onGridDblClickRow(){for(var e=ContextMenuManager.getMenuModelByMenuId(this.determineContextMenuMountAttributes().id),t=e.length,i=!1,s=0;s<t&&!i;s++){let n=e[s];switch(e[s].id){case"view":i=!0,n.visible&&!n.disabled&&(ProgressBar.showOverlay(),this.onViewClick());break}}}onCustomContextClick(e,t){switch(t||(t=ContextMenuManager.getMenuModelByMenuId(this.determineContextMenuMountAttributes().id).find(i=>i.id==e)),e){case"send":this.onSaveClick();break;case"close_misc":case"cancel":this.onCancelClick(e);break;case"inbox":this.setCurrentSelectedIcon(t),this.onInboxClick();break;case"sent":this.setCurrentSelectedIcon(t),this.onSentClick();break}}onCancelClick(e){var t=this;LocalCacheData.current_doing_context_action="cancel",this.is_changed?TAlertManager.showConfirmAlert(Global.modify_alert_message,null,function(s){s===!0&&i()}):i();function i(){e==="cancel"&&t.isReloadViewUI?(t.isReloadViewUI=!1,ContextMenuManager.unmountContextMenu(t.determineContextMenuMountAttributes().id),t.onViewClick(t.current_select_message_control_data)):(t.removeEditView(),t.isReloadViewUI=!1),Global.setUIInitComplete(),ProgressBar.closeOverlay(),TTPromise.resolve("base","onCancelClick")}}onSaveResult(e){var t=this;if(e&&e.isValid()){var i=e.getResult();this.edit_only_mode||(i===!0?t.refresh_id=t.current_edit_record.id:TTUUID.isUUID(i)&&i!=TTUUID.zero_id&&i!=TTUUID.not_exist_id&&(t.refresh_id=i),t.search(!1)),t.onSaveDone(e),t.isReloadViewUI?(t.isReloadViewUI=!1,t.removeEditView(),t.onViewClick(t.current_select_message_control_data)):t.removeEditView(),a().TFeedback({source:"Save"})}else t.setErrorMenu(),t.setErrorTips(e)}onInboxClick(){this.folder_id=10,this.search()}onSentClick(){this.folder_id=20,this.search()}setCustomEditMenuIcon(e,t){switch(e){case"close_misc":this.setEditMenuCloseMiscIcon(t);break;case"send":this.setEditMenuSendIcon(t);break;case"inbox":this.setEditMenuInboxIcon(t);break;case"sent":this.setEditMenuSentIcon(t);break}}getIsPunchOrRequest(){let e=null;return this.is_message?e="message":this.is_request&&(e="request"),e}setCurrentSelectedIcon(e){var t=ContextMenuManager.getMenuModelByMenuId(this.determineContextMenuMountAttributes().id);if(e){for(var i=t.length,s=0;s<i;s++){let n=t[s];t[s].id,n.active&&ContextMenuManager.activateMenuItem(this.determineContextMenuMountAttributes().id,n.id,!0)}ContextMenuManager.activateMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}}setDefaultMenuDeleteAndNextIcon(e,t){ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuDeleteIcon(e,t){t>=1?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuEditIcon(e,t){this.is_edit||this.is_viewing?ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),t===1?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuViewIcon(e,t){t===1?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuAddIcon(e,t){}setEditMenuCloseMiscIcon(e){}setEditMenuSendIcon(e){this.is_edit||this.is_add?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setEditMenuInboxIcon(e){ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setEditMenuSentIcon(e){ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuCloseMiscIcon(e,t){ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuSendIcon(e,t){this.is_edit||this.is_viewing?ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuInboxIcon(e,t){}setDefaultMenuSentIcon(e,t){}setGridCellBackGround(){if(this.grid){var e=this.grid.getGridParam("data");if(e)for(var t=e.length,i=0;i<t;i++){var s=e[i];s.status_id==10&&a("tr[id='"+s.id+"'] td").css("font-weight","bold")}}}getFilterColumnsFromDisplayColumns(){var e={};e.id=!0,e.is_child=!0,e.is_owner=!0,e.object_type_id=!0,e.object_id=!0,e.status_id=!0,e.from_user_id=!0,e.to_user_id=!0;var t=[];if(this.grid&&(t=this.grid.getGridParam("colModel")),t)for(var i=t.length,s=0;s<i;s++){var n=t[s];e[n.name]=!0}return e}initEditViewUI(e,t){this.edit_view&&this.edit_view.remove(),this.edit_view=a(Global.loadViewSource(e,t,null,!0)),this.edit_view_tab=a(this.edit_view.find(".edit-view-tab-bar")),this.edit_view_tab.attr("id",this.ui_id+"_edit_view_tab"),this.folder_id==10?this.navigation_label=a.i18n._("From"):this.folder_id==20&&(this.navigation_label=a.i18n._("To")),ContextMenuManager.unmountContextMenu(this.determineContextMenuMountAttributes().id),Global.contentContainer().append(this.edit_view),this.initRightClickMenu(RightClickMenuType.EDITVIEW),this.buildEditViewUI(),this.setEditViewTabHeight()}initEditViewTabs(){var e=this,t={activate:function(i,s){e.onTabShow(i,s)}};super.initEditViewTabs(t)}getViewSelectedRecordId(e){var t,i=this.getGridSelectIdArray(),s=i.length;if(Global.isSet(e))t=e;else if(s>0)t=this.getRecordFromGridById(i[0]);else return TTPromise.reject("MessageControllViewController","onViewClick"),null;return t.object_type_id==50?(t.object_id,this.is_request=!0,this.is_message=!1):(t.id,this.is_request=!1,this.is_message=!0),t}getCurrentSelectedRecord(e){var t=this.current_selected_record;if(!t)return!1;var i;return t.object_type_id&&t.object_type_id==50?i=t.object_id:i=t.id,e===!0?t:i}handleViewAPICallbackResult(e){var t;return e&&e.getResult?(t=e.getResult(),this.is_request?t=t[0]:t=t.length>1?t.reverse():t[0]):t=e,super.handleViewAPICallbackResult(t)}doViewAPICall(e){var t={onResult:this.handleViewAPICallbackResult.bind(this)};return this.is_request?this.request_api.getRequest(e,t):this.api.getMessage(e,t)}doViewClickResult(e){if(this.current_select_message_control_data=this.getCurrentSelectedRecord(!0),!this.current_select_message_control_data.hasOwnProperty("to_user_id")){var t={filter_data:{id:this.current_select_message_control_data.id}},i=this.api.getMessageControl(t,{async:!1}).getResult()[0];i&&(this.current_select_message_control_data=i)}var s=super.doViewClickResult(e);return TTPromise.resolve("MessageControllViewController","onViewClick"),s}getAPIFilters(){var e=this.getCurrentSelectedRecord(),t={};return t.filter_data={},t.filter_data.id=e,t}onViewClick(e,t){TTPromise.add("MessageControllViewController","onViewClick"),TTPromise.wait();var i=this;this.setCurrentEditViewState("view"),i.isReloadViewUI=!0;var s=this.getViewSelectedRecordId(e);if(!Global.isFalseOrNull(s)){this.setCurrentSelectedRecord(s);var n=this.getAPIFilters();return this.openEditView(),this.doViewAPICall(n)}}setURL(){if(LocalCacheData.current_doing_context_action==="edit"){LocalCacheData.current_doing_context_action="";return}var e="";switch(LocalCacheData.current_doing_context_action){case"new":case"edit":case"view":e=LocalCacheData.current_doing_context_action;break;case"copy_as_new":e="new";break}if(this.canSetURL()){var t=this.edit_view_tab?this.edit_view_tab.find(".edit-view-tab-bar-label").children().eq(this.getEditViewTabIndex()).text():"";t=t.replace(/\/|\s+/g,""),this.current_select_message_control_data&&this.current_select_message_control_data.id?(e&&(this.is_request?Global.setURLToBrowser(Global.getBaseURL()+"#!m="+this.viewId+"&a="+e+"&id="+this.current_select_message_control_data.id+"&t=request&object_id="+this.current_select_message_control_data.object_id+"&tab="+t):Global.setURLToBrowser(Global.getBaseURL()+"#!m="+this.viewId+"&a="+e+"&id="+this.current_select_message_control_data.id+"&t=message&tab="+t)),Global.trackView()):e?e==="edit"?Global.setURLToBrowser(Global.getBaseURL()+"#!m="+this.viewId+"&a=new&t="+(this.is_request?"request":"message")+"&tab="+t):Global.setURLToBrowser(Global.getBaseURL()+"#!m="+this.viewId+"&a="+e+"&t="+(this.is_request?"request":"message")+"&tab="+t):Global.setURLToBrowser(Global.getBaseURL()+"#!m="+this.viewId)}}initEditViewData(){if(!this.edit_only_mode&&this.navigation){var e=this.grid.getGridParam("data"),t=this.edit_view.find(".navigation-div"),i;if(this.current_select_message_control_data&&this.current_select_message_control_data.hasOwnProperty("id")&&this.current_select_message_control_data.hasOwnProperty("subject")?i=this.current_select_message_control_data:i=Global.isArray(this.current_edit_record)?this.current_edit_record[0]:this.current_edit_record,this.navigation_source_data=i,this.is_viewing&&Global.isSet(i.id)&&i.id){if(t.css("display","block"),!this.navigation.getSourceData()){this.navigation.setSourceData(e),this.navigation.setRowPerPage(LocalCacheData.getLoginUserPreference().items_per_page),this.navigation.setPagerData(this.pager_data);var s={};s.filter_data=Global.convertLayoutFilterToAPIFilter(this.select_layout),s.filter_sort=this.select_layout.data.filter_sort,this.navigation.setDefaultArgs(s)}this.navigation.setValue(i)}else t.css("display","none")}this.setUIWidgetFieldsToCurrentEditRecord(),this.setNavigationArrowsEnabled(),this.setCurrentEditRecordData(),this.edit_view.find(".save-and-continue-div").SaveAndContinueBox({related_view_controller:this}),this.edit_view.find(".save-and-continue-div").css("display","none")}setNavigation(){var e=this;this.navigation.setPossibleDisplayColumns(this.buildDisplayColumnsByColumnModel(this.grid.getGridParam("colModel")),this.buildDisplayColumns(this.default_display_columns)),this.navigation.unbind("formItemChange").bind("formItemChange",function(t,i){i.getField();var s=i.getValue(!0);s&&(s.id!==e.navigation_source_data.id&&(ProgressBar.showOverlay(),e.is_viewing?e.onViewClick(s):e.onEditClick(s)),e.setNavigationArrowsEnabled())})}onEditClick(e,t){this.setCurrentEditViewState("edit"),this.is_request=!1,this.is_message=!1;var i=this.getGridSelectIdArray(),s={};this.edit_view?s=this.current_select_message_control_data:s=this.getRecordFromGridById(i[0]),this.current_edit_record=s,this.initEditViewUI(this.viewId,this.edit_view_tpl),this.initEditView()}buildEditViewUI(){var e=this.navigation&&this.navigation.getPagerData&&this.navigation.getPagerData(),t=this.navigation&&this.navigation.getSourceData&&this.navigation.getSourceData();super.buildEditViewUI();var i={tab_message:{label:a.i18n._("Message")}};this.setTabModel(i),this.edit_only_mode||(this.navigation.AComboBox({api_class:TTAPI.APIMessageControl,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_message_user",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation()),e&&t&&(this.navigation.setSourceData(t),this.navigation.setPagerData(e));var s,n=this.edit_view_tab.find("#tab_message"),r=n.find(".first-column"),l=n.find(".second-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(r),this.edit_view_tabs[0].push(l),l.css("display","none"),s=Global.loadWidgetByName(FormItemType.TEXT),s.TText({field:"full_name",selected_able:!0}),this.addEditFieldToColumn(a.i18n._("Employee"),s,r,"",null,!0),s=Global.loadWidgetByName(FormItemType.TEXT),s.TText({field:"date_stamp",selected_able:!0}),this.addEditFieldToColumn(a.i18n._("Date"),s,r,"",null,!0),s=Global.loadWidgetByName(FormItemType.TEXT),s.TText({field:"type",selected_able:!0}),this.addEditFieldToColumn(a.i18n._("Type"),s,r,"",null,!0);var d=n.find(".separate");s=Global.loadWidgetByName(FormItemType.SEPARATED_BOX),s.SeparatedBox({label:a.i18n._("Messages")}),this.addEditFieldToColumn(null,s,d,"",null,!0,null,"separated_box"),s=Global.loadWidgetByName(FormItemType.AWESOME_BOX),s.AComboBox({api_class:TTAPI.APIMessageControl,column_option_key:"user_columns",allow_multiple_selection:!0,layout_name:"global_message_user",show_search_inputs:!0,set_empty:!0,custom_key_name:"User",field:"to_user_id"});var o={};o.permission_section="message",s.setDefaultArgs(o),this.addEditFieldToColumn(a.i18n._("Employee(s)"),s,r,"",null,!0),s=Global.loadWidgetByName(FormItemType.TEXT),s.TText({field:"from_full_name"}),this.addEditFieldToColumn(a.i18n._("Employee(s)"),s,r,"",null,!0),s=Global.loadWidgetByName(FormItemType.TEXT_INPUT),s.TTextInput({field:"subject"}),this.addEditFieldToColumn(a.i18n._("Subject"),s,r,"",null,!0),s=Global.loadWidgetByName(FormItemType.TEXT_AREA),s.TTextArea({field:"body",width:600,height:400}),this.addEditFieldToColumn(a.i18n._("Body"),s,r,"",null,!0,!0)}setEditViewWidgetsMode(){this.switchMessageOrRequestWidgets(),super.setEditViewWidgetsMode()}switchMessageOrRequestWidgets(){var e;for(var t in this.edit_view_ui_dic)this.edit_view_ui_dic.hasOwnProperty(t)&&this.detachElement(t);this.detachElement("separated_box"),this.edit_view_tab.find("#tab_message").find(".edit-view-tab .second-column.message-container").remove(),this.is_request?(e="Request",this.attachElement("full_name"),this.attachElement("date_stamp"),this.attachElement("type"),this.attachElement("separated_box"),this.edit_view_tab.find("#tab_message").find(".edit-view-tab .first-column").show()):this.is_message?(e="Message",this.edit_view_tab.find("#tab_message").find(".edit-view-tab .first-column").hide()):this.is_add?(e="New Message",this.attachElement("to_user_id"),this.attachElement("subject"),this.attachElement("body"),this.edit_view_tab.find("#tab_message").find(".edit-view-tab .first-column").show()):this.is_edit&&(e="Reply",this.attachElement("from_full_name"),this.attachElement("subject"),this.attachElement("body"),this.edit_view_tab.find("#tab_message").find(".edit-view-tab .first-column").show());var i={tab_message:{label:a.i18n._(e),is_multi_column:!0}};this.setTabModel(i)}refreshCurrentRecord(){var e=this.navigation.getItemByIndex(this.navigation.getSelectIndex());ProgressBar.showOverlay(),this.onViewClick(e),this.setNavigationArrowsEnabled()}onRightOrLeftArrowClickCallBack(e){ProgressBar.showOverlay(),this.onViewClick(e),this.setNavigationArrowsEnabled()}onAddClick(){TTPromise.add("Message","add"),TTPromise.wait();var e=this;this.is_viewing=!1,this.is_edit=!1,this.is_add=!0,this.isReloadViewUI=!1,LocalCacheData.current_doing_context_action="new",this.is_request=!1,this.is_message=!1,e.openEditView();var t={};LocalCacheData.default_filter_for_next_open_view&&(t.to_user_id=LocalCacheData.default_filter_for_next_open_view.to_user_id,LocalCacheData.default_filter_for_next_open_view=null),e.current_edit_record=t,e.initEditView()}initEditView(){super.initEditView(),TTPromise.resolve("Message","add")}setEditMenuAddIcon(e){this.edit_only_mode&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),this.is_add||this.is_changed?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0)}setEditMenuEditIcon(e){this.edit_only_mode&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),this.is_viewing||ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setEditMenuDeleteIcon(e){this.edit_only_mode&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),(!this.current_select_message_control_data||this.is_edit||this.is_add)&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setEditMenuDeleteAndNextIcon(e){this.edit_only_mode&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),(!this.current_select_message_control_data||this.is_edit||this.is_add)&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}validate(){var e=this,t=this.current_edit_record;Global.isSet(this.edit_view_ui_dic.subject)?t.subject=this.edit_view_ui_dic.subject.getValue():Global.isSet(this.edit_view_ui_dic.message_subject)?t.subject=this.edit_view_ui_dic.message_subject.getValue():Global.isSet(this.edit_view_ui_dic.request_subject)&&(t.subject=this.edit_view_ui_dic.request_subject.getValue()),t=this.uniformVariable(t),this.api["validate"+this.api.key_name](t,{onResult:function(i){e.validateResult(i)}})}onSaveClick(e){LocalCacheData.current_doing_context_action="save",this.collectUIDataToCurrentEditRecord();var t=this.current_edit_record;Global.isSet(e)||(e=!1),Global.isSet(this.edit_view_ui_dic.subject)?t.subject=this.edit_view_ui_dic.subject.getValue():Global.isSet(this.edit_view_ui_dic.message_subject)?t.subject=this.edit_view_ui_dic.message_subject.getValue():Global.isSet(this.edit_view_ui_dic.request_subject)&&(t.subject=this.edit_view_ui_dic.request_subject.getValue()),t=this.uniformVariable(t),this.doSaveAPICall(t,e)}uniformVariable(e){var t={};return this.is_edit?(t.subject=e.subject,t.body=e.body,e.object_type_id!=50?(t.to_user_id=e.from_user_id,t.object_type_id=5,t.object_id=LocalCacheData.loginUser.id,t.parent_id=e.id):(t.object_id=e.object_id,t.to_user_id=LocalCacheData.loginUser.id,t.object_type_id=50,t.parent_id=1),t):(this.is_add&&(e.object_type_id=5,e.object_id=LocalCacheData.loginUser.id,e.parent_id=0),e)}search(e,t,i,s){this.event_bus.emit("tt_topbar","profile_pending_counts",{object_types:["notification","message"]}),super.search(e,t,i,s)}setCurrentEditRecordData(){var e=this;if(this.is_message)this.setMessages();else{for(var t in this.current_edit_record)if(this.current_edit_record.hasOwnProperty(t)){var i=this.edit_view_ui_dic[t];if(Global.isSet(i))switch(t){case"from_full_name":i.setValue(this.current_edit_record.from_first_name+" "+this.current_edit_record.from_last_name);break;case"to_full_name":i.setValue(this.current_edit_record.to_first_name+" "+this.current_edit_record.to_last_name);break;case"full_name":i.setValue(this.current_edit_record.first_name+" "+this.current_edit_record.last_name);break;case"subject":this.is_edit?Global.isArray(this.messages)?i.setValue("Re: "+this.messages[0].subject):i.setValue("Re: "+this.current_edit_record[t]):this.is_viewing&&i.setValue(this.current_edit_record[t]);break;case"message_body":case"request_body":i.setValue(this.current_edit_record[t]);break;default:i.setValue(this.current_edit_record[t]);break}}this.is_message&&this.current_edit_record&&this.current_edit_record.status_id==10&&this.api.markRecipientMessageAsRead([this.current_edit_record.id],{onResult:function(s){e.search(!1)}}),this.collectUIDataToCurrentEditRecord()}this.setEditViewDataDone()}autoOpenEditViewIfNecessary(){switch(LocalCacheData.current_doing_context_action){case"view":if(LocalCacheData.edit_id_for_next_open_view){var e={};e.id=LocalCacheData.edit_id_for_next_open_view,LocalCacheData.getAllURLArgs().t==="request"&&(e.object_id=LocalCacheData.getAllURLArgs().object_id,e.object_type_id=50),this.onViewClick(e),LocalCacheData.edit_id_for_next_open_view=null}break;case"new":this.onAddClick();break}this.autoOpenEditOnlyViewIfNecessary()}getDeleteSelectedRecordId(){var e=[];if(this.edit_view){if(!this.current_select_message_control_data){TAlertManager.showAlert(a.i18n._("Invalid Message id"));return}e.push(this.current_select_message_control_data.id)}else e=super.getDeleteSelectedRecordId();return e}doDeleteAPICall(e,t){var i=t||{onResult:(function(s){this.isReloadViewUI=!1,this.onDeleteResult(s,e)}).bind(this)};return this.api["delete"+this.api.key_name](e,this.folder_id,i)}setEditViewDataDone(){var e=this;super.setEditViewDataDone(),this.is_viewing?this.is_request&&this.initEmbeddedMessageData():Global.isSet(e.messages)&&(e.messages=null)}setMessages(e){var t=[];e?this.messages=e:this.messages=this.current_edit_record,Global.isArray(this.messages)||(this.messages=[this.messages]),this.edit_view_tab.find("#tab_message").find(".edit-view-tab .second-column.message-container").remove();for(var i=a("<div></div>"),s=0;s<this.messages.length;s++){var n=this.messages[s];if(n.hasOwnProperty("id")){n.status_id==10&&t.push(n.id);var r=a("<div></div>",{class:"second-column full-width-column message-container"});if(s>0&&r.append('<div class="message-separator"></div>'),this.is_message)this.addMessageRow(r,"From","msg_from_full_name",n.from_first_name+" "+n.from_last_name),this.addMessageRow(r,"To","msg_to_full_name",n.to_first_name+" "+n.to_last_name),this.addMessageRow(r,"Date","msg_updated_date",n.updated_date),this.addMessageRow(r,"Subject","msg_subject",n.subject),this.addMessageRow(r,"Body","msg_body",n.body,!0,!0);else if(this.is_request)this.addMessageRow(r,"From","req_from_full_name",n.from_first_name+" "+n.from_last_name+"@"+n.updated_date),this.addMessageRow(r,"Subject","req_subject",n.subject),this.addMessageRow(r,"Body","req_body",n.body,!0,!0);else return;i.append(r)}}if(this.edit_view_tab.find("#tab_message").find(".edit-view-tab").append(i.html()),t.length>0){var l=this;this.api.markRecipientMessageAsRead(t,{onResult:function(d){l.search(!1)}})}}addMessageRow(e,t,i,s,n,r){var l=Global.loadWidgetByName(FormItemType.TEXT);l.TText({field:i,selected_able:!0}),this.addEditFieldToColumn(a.i18n._(t),l,e,"",null,null,n),r?(l.html(_(s,{target:"_blank",nl2br:!0,className:"linkified"})),l.setResizeEvent()):l.setValue(s),l.css("opacity","1"),delete this.edit_view_ui_dic[i]}initEmbeddedMessageData(){var e=this,t={};t.filter_data={},t.filter_data.object_type_id=50,t.filter_data.object_id=this.current_edit_record.id,e.api.getEmbeddedMessage(t,{onResult:function(i){if(e.edit_view){var s=i.getResult();e.setMessages(s)}}})}}export{f as MessageControlViewController};
//# sourceMappingURL=MessageControlViewController-BTRHtj3_.bundle.js.map
