import{_ as c,j as a}from"./vendor-tTApdY0Y.bundle.js";import"./TImageBrowser-CvdFimWY.bundle.js";import"./CameraBrowser-ZqjxPQAO.bundle.js";import"./TImageAdvBrowser-CQSTdPda.bundle.js";import"./TImage-D3G3HRb1.bundle.js";import"./TImageCutArea-DleUw4Kb.bundle.js";class m extends BaseWizardController{constructor(t={}){c.defaults(t,{el:".wizard-bg"}),super(t)}init(t){this.title=a.i18n._("Image Upload Wizard"),this.steps=3,this.current_step=1,this.render()}render(){super.render(),this.initCurrentStep()}buildCurrentStepUI(){var t=this;switch(this.content_div.empty(),this.current_step){case 1:t.next_btn.removeClass("disable-image");var e=this.getLabel();e.text(a.i18n._("Please choose the image source"));var r=this.getComboBox("image_type");r.setSourceData([{value:"file",label:a.i18n._("File")},{value:"camera",label:a.i18n._("Camera")}]),this.stepsWidgetDic[this.current_step]={},this.stepsWidgetDic[this.current_step][r.getField()]=r,this.content_div.append(e),this.content_div.append(r),this.removeDropZone();break;case 2:var s=this.stepsDataDic[1];s.image_type!=="camera"&&Global.initFileDragAndDrop(this.$el.find(".wizard")[0],p=>{this.attachDragAndDropFile(p)}),e=this.getLabel();var i;s.image_type==="file"?(e.text(a.i18n._("Choose image file to upload")),i=this.getFileBrowser("image_data",null,500,350)):(e.text(a.i18n._("Take picture from camera")),i=this.getCameraBrowser("image_data"),i.unbind("NoImageChange").bind("NoImageChange",function(){t.next_btn.addClass("disable-image"),Global.glowAnimation.stop(t.next_btn)})),i.unbind("change").bind("change",function(){t.next_btn.removeClass("disable-image"),Global.glowAnimation.start(t.next_btn,"#00ff00")}),this.stepsWidgetDic[this.current_step]={},this.stepsWidgetDic[this.current_step][i.getField()]=i,this.content_div.append(e),this.content_div.append(i),t.next_btn.addClass("disable-image");break;case 3:t.next_btn.removeClass("disable-image"),e=this.getLabel(),e.text(a.i18n._("Crop and resize image")),i=this.getImageCutArea("image_cut"),this.stepsWidgetDic[this.current_step]={},this.stepsWidgetDic[this.current_step][i.getField()]=i;var n=a(' <form enctype="multipart/form-data" class="browser-form"></form>');this.stepsWidgetDic[this.current_step].hide_form=n,this.content_div.append(e),this.content_div.append(i),this.content_div.append(n),this.removeDropZone();break}}buildCurrentStepData(){var t=this.stepsDataDic[this.current_step],e=this.stepsWidgetDic[this.current_step];switch(this.current_step){case 1:t&&e.image_type.setValue(t.image_type);break;case 2:this.stepsDataDic[1].image_type==="camera"&&e.image_data.showCamera(),Global.setWidgetEnabled(this.next_btn,!1);break;case 3:e.image_cut.setImage(this.stepsDataDic[2].img_src)}}onDoneClick(){var t=this;super.onDoneClick(),this.saveCurrentStep();var e=this.stepsWidgetDic[this.current_step],r=this.stepsDataDic[this.current_step],s=new FormData(e.hide_form[0]),i=r.after_img_src&&r.after_img_src.split(",");i&&i.length>0&&(s.append("file_data",i[1]),s.append("base64_encoded",!0),s.append("mime_type",i[0].split(";")[0].split(":")[1]),s.append("file_name",this.stepsDataDic[2].file_name),this.call_back&&this.call_back(s)),t.onCloseClick()}onCloseClick(){var t=this.stepsWidgetDic[this.current_step];this.current_step===3&&t.image_cut.clearSelect(),this.current_step===2&&this.stepsDataDic[1].image_type==="camera"&&t.image_data.stopCamera(),a(this.el).remove(),LocalCacheData.current_open_wizard_controllers=LocalCacheData.current_open_wizard_controllers.filter(e=>e.wizard_id!==this.wizard_id)}onNextClick(){if(!this.next_btn.hasClass("disable-image")){var t=this.stepsWidgetDic[this.current_step];this.current_step===3&&t.image_cut.clearSelect(),this.current_step===2&&this.stepsDataDic[1].image_type==="camera"&&(t.image_data.stopCamera(),Global.glowAnimation.stop(this.next_btn)),this.saveCurrentStep(),this.current_step=this.current_step+1,this.initCurrentStep()}}onBackClick(){if(!this.back_btn.hasClass("disable-image")){var t=this.stepsWidgetDic[this.current_step];this.current_step===3&&t.image_cut.clearSelect(),this.current_step===2&&this.stepsDataDic[1].image_type==="camera"&&(t.image_data.stopCamera(),Global.glowAnimation.stop(this.next_btn)),this.saveCurrentStep(),this.current_step=this.current_step-1,this.initCurrentStep()}}saveCurrentStep(){this.stepsDataDic[this.current_step]={};var t=this.stepsDataDic[this.current_step],e=this.stepsWidgetDic[this.current_step];switch(this.current_step){case 1:t.image_type=e.image_type.getValue();break;case 2:t.img_src=e.image_data.getImageSrc(),t.file_name=e.image_data.getFileName();break;case 3:t.after_img_src=e.image_cut.getAfterImageSrc();break}}setDefaultDataToSteps(){if(!this.default_data)return null;this.stepsDataDic[2]={},this.stepsDataDic[3]={},this.getDefaultData("user_id")&&(this.stepsDataDic[3].user_id=this.getDefaultData("user_id")),this.getDefaultData("pay_period_id")&&(this.stepsDataDic[2].pay_period_id=this.getDefaultData("pay_period_id"))}removeDropZone(){let t=this.$el.find(".file-drop-zone-highlight");t.length>0&&t.remove()}attachDragAndDropFile(t){let e=new DataTransfer;e.items.add(t[0]),this.stepsWidgetDic[2].image_data[0].querySelector("input").files=e.files,this.stepsWidgetDic[2].image_data.trigger("change"),this.stepsWidgetDic[2].image_data.find("input").trigger("change")}}export{m as UserPhotoWizardController};
//# sourceMappingURL=UserPhotoWizardController-KrqvQB6k.bundle.js.map
