{"version":3,"file":"TImageBrowser-CvdFimWY.bundle.js","sources":["../../global/widgets/filebrowser/TImageBrowser.js"],"sourcesContent":["( function( $ ) {\n\n\t$.fn.TImageBrowser = function( options ) {\n\t\tGlobal.addCss( 'global/widgets/filebrowser/TImageBrowser.css' );\n\t\tvar opts = $.extend( {}, $.fn.TImageBrowser.defaults, options );\n\n\t\tvar $this = this;\n\t\tvar field;\n\t\tvar id = 'file_browser';\n\t\tvar name = 'file_data';\n\t\tvar browser;\n\n\t\tvar accept_filter = '';\n\t\tvar file = null;\n\n\t\tvar default_width = 177;\n\t\tvar default_height = 42;\n\t\tvar enabled = true;\n\n\t\tthis.setEnabled = function( val ) {\n\t\t\tenabled = val;\n\n\t\t\tvar btn = this.find( '.browser-form input' );\n\n\t\t\tif ( !val ) {\n\t\t\t\tbtn.attr( 'disabled', true );\n\t\t\t\tbtn.removeClass( 'disable-element' ).addClass( 'disable-element' );\n\t\t\t} else {\n\t\t\t\tbtn.removeAttr( 'disabled' );\n\t\t\t\tbtn.removeClass( 'disable-element' );\n\t\t\t}\n\t\t};\n\n\t\tthis.clearErrorStyle = function() {\n\t\t};\n\n\t\tthis.getFileName = function() {\n\t\t\treturn browser.val();\n\t\t};\n\n\t\tthis.getField = function() {\n\t\t\treturn field;\n\t\t};\n\n\t\tthis.setEnableDelete = function( val ) {\n\t\t\tvar image = $this.find( '.image' );\n\t\t\tif ( !val ) {\n\t\t\t\timage.removeAttr( 'enable-delete' );\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\timage.attr( 'enable-delete', 1 );\n\t\t\t}\n\t\t};\n\n\t\tthis.getValue = function() {\n\t\t\t//If the raw file data came from a File Upload Wizard that uses this widget as well, just return it verbatim.\n\t\t\tif ( file ) {\n\t\t\t\treturn file;\n\t\t\t}\n\n\t\t\tvar form_data;\n\t\t\tif ( browser && browser.val() ) {\n\n\t\t\t\tif ( typeof FormData == 'undefined' ) {\n\t\t\t\t\tform_data = $this.find( '.browser-form' );\n\t\t\t\t} else {\n\t\t\t\t\tform_data = new FormData( $( $this.find( '.browser-form' ) )[0] );\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tform_data = null;\n\t\t\t}\n\n\t\t\treturn form_data;\n\t\t};\n\n\t\tthis.setValue = function( val ) {\n\t\t\tif ( !val ) {\n\t\t\t\tval = '';\n\t\t\t}\n\t\t};\n\n\t\tthis.getImageSrc = function() {\n\t\t\tvar image = $this.find( '.image' );\n\t\t\treturn image.attr( 'src' );\n\t\t};\n\n\t\tthis.setImage = function( val ) {\n\t\t\tvar image = $this.find( '.image' );\n\n\t\t\tif ( !val ) {\n\t\t\t\timage.attr( 'src', '' );\n\t\t\t\timage.hide();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar d = new Date();\n\t\t\timage.hide();\n\t\t\timage.attr( 'src', val + '&t=' + d.getTime() );\n\t\t\timage.css( 'height', 'auto' );\n\t\t\timage.css( 'width', 'auto' );\n\n\t\t};\n\n\t\tvar onImageLoad = function( image ) {\n\n\t\t\tvar image_height = $( image ).height() > 0 ? $( image ).height() : image.naturalHeight;\n\t\t\tvar image_width = $( image ).width() > 0 ? $( image ).width() : image.naturalWidth;\n\n\t\t\tif ( image_height > default_height ) {\n\t\t\t\t$( image ).css( 'height', default_height );\n\n\t\t\t}\n\n\t\t\tif ( image_width > default_width ) {\n\t\t\t\t$( image ).css( 'width', default_width );\n\t\t\t\t$( image ).css( 'height', 'auto' );\n\t\t\t}\n\n\t\t\t// This causes extreme (10x) performance degradation on Bootstrap 5.1.0 and later. (Related TText setResizeEvent call)\n\t\t\t// $this.trigger( 'setSize' );\n\n\t\t\tif ( image_height < 5 ) {\n\t\t\t\t$( image ).hide();\n\t\t\t} else {\n\t\t\t\t$( image ).show();\n\t\t\t}\n\t\t};\n\n\t\tthis.each( function() {\n\t\t\tvar o = $.meta ? $.extend( {}, opts, $( this ).data() ) : opts;\n\n\t\t\tfield = o.field;\n\n\t\t\tif ( o.default_width > 0 ) {\n\t\t\t\tdefault_width = o.default_width;\n\t\t\t}\n\n\t\t\tif ( o.default_height > 0 ) {\n\t\t\t\tdefault_height = o.default_height;\n\t\t\t}\n\n\t\t\tif ( Global.isSet( o.name ) ) {\n\t\t\t\tname = o.name;\n\t\t\t}\n\n\t\t\tif ( Global.isSet( accept_filter ) ) {\n\t\t\t\taccept_filter = o.accept_filter;\n\t\t\t}\n\n\t\t\tif ( Global.isSet( o.file ) ) {\n\t\t\t\tfile = o.file\n\t\t\t}\n\n\t\t\tbrowser = $( this ).find( '.browser' );\n\t\t\tvar image = $( this ).find( '.image' );\n\t\t\timage.hide();\n\t\t\timage.on( 'load', function() {\n\t\t\t\tonImageLoad( this );\n\t\t\t} );\n\n\t\t\tif ( accept_filter ) {\n\t\t\t\tbrowser.attr( 'accept', accept_filter );\n\t\t\t} else {\n\t\t\t\taccept_filter = 'image/*';\n\t\t\t\tbrowser.attr( 'accept', 'image/*' );\n\t\t\t}\n\n\t\t\tbrowser.attr( 'id', id );\n\t\t\tbrowser.attr( 'name', name );\n\n\t\t\tif ( Global.isSet( o.changeHandler ) ) {\n\t\t\t\t$this.bind( 'imageChange', o.changeHandler );\n\t\t\t}\n\t\t\tif ( Global.isSet( o.deleteImageHandler ) ) {\n\t\t\t\tthis.find( '.file-browser' ).on( 'deleteClick', function() {\n\t\t\t\t\to.deleteImageHandler();\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\tbrowser.bind( 'change', function() {\n\t\t\t\timage.hide();\n\n\t\t\t\tif ( ( this.files && this.files[0] ) || o.file ) {\n\t\t\t\t\tlet main_div = this.parentNode;\n\n\t\t\t\t\t//If this is a custom file input, we need to get the label and change it's text to the file name to show the user what file they selected\n\t\t\t\t\tif ( main_div.classList.contains( 'custom-file-browser' ) ) {\n\t\t\t\t\t\tlet label = main_div.querySelector( '.file-browser-label' );\n\t\t\t\t\t\tif ( label ) {\n\t\t\t\t\t\t\tif ( this.files && this.files[0] ) {\n\t\t\t\t\t\t\t\tlabel.innerText = this.files[0].name;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tlabel.innerText = '';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( typeof FileReader != 'undefined' ) {\n\t\t\t\t\tvar files = !!this.files ? this.files : [];\n\n\t\t\t\t\t// If no files were selected, or no FileReader support, return\n\t\t\t\t\tif ( !files.length || !window.FileReader ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( accept_filter === 'image/*' ) {\n\t\t\t\t\t\t// Create a new instance of the FileReader\n\t\t\t\t\t\tvar reader = new FileReader();\n\n\t\t\t\t\t\t// Read the local file as a DataURL\n\t\t\t\t\t\treader.readAsDataURL( files[0] );\n\n\t\t\t\t\t\t// When loaded, set image data as background of div\n\t\t\t\t\t\treader.onloadend = function() {\n\t\t\t\t\t\t\tvar url = this.result;\n\t\t\t\t\t\t\timage.attr( 'src', url );\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t$this.trigger( 'imageChange', [$this] );\n\t\t\t} );\n\n\t\t\tif ( Global.isSet( o.file ) ) { //File name should already be specified, so trigger change event so it looks like it was already uploaded.\n\t\t\t\tbrowser.trigger( 'change' );\n\t\t\t}\n\n\t\t\tthis.addEventListener( 'click', function( e ) {\n\t\t\t\tlet main_div = this.querySelector( '.custom-file-browser' );\n\n\t\t\t\tif ( main_div ) {\n\t\t\t\t\tmain_div.querySelector( 'input.browser' ).click();\n\t\t\t\t}\n\t\t\t} );\n\n\t\t} );\n\n\t\treturn this;\n\n\t};\n\n\t$.fn.TImageBrowser.defaults = {};\n\t$.fn.TImageBrowser.html_template = `\n\t<div class=\"file-browser\">\n\t\t<img class=\"image\">\n\t\t<form enctype=\"multipart/form-data\" class=\"browser-form\">\n\t\t\t<input name=\"file_data\" class=\"browser\" type=\"file\"/>\n\t\t</form>\n\t</div>\n\t`;\n\n} )( jQuery );"],"names":["$","options","opts","$this","field","id","name","browser","accept_filter","file","default_width","default_height","val","btn","image","form_data","d","onImageLoad","image_height","image_width","o","main_div","label","files","reader","url","e","jQuery"],"mappings":"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"}