import{_ as v,j as r}from"./vendor-tTApdY0Y.bundle.js";class y extends BaseViewController{constructor(e={}){v.defaults(e,{el:"#accrual_policy_user_modifier_view_container",user_api:null,parent_view:null,result_details:null}),super(e)}init(e){this.parent_view=this.parent_view_controller.viewId==="Employee"?"employee":"accrual_policy",this.parent_view==="employee"?(this.context_menu_name=r.i18n._("Accruals"),this.navigation_label=r.i18n._("Accrual")):this.parent_view==="accrual_policy"&&(this.context_menu_name=r.i18n._("Employee Settings"),this.navigation_label=r.i18n._("Employee Accrual Modifier")),this.edit_view_tpl="AccrualPolicyUserModifierEditView.html",this.permission_id="accrual_policy",this.script_name="AccrualPolicyUserModifierView",this.viewId="AccrualPolicyUserModifier",this.table_name_key="accrual_policy_user_modifier",this.api=TTAPI.APIAccrualPolicyUserModifier,this.user_api=TTAPI.APIUser,this.render(),this.sub_view_mode?this.buildContextMenu(!0):this.buildContextMenu(),this.sub_view_mode||this.initData()}getCustomContextMenuModel(){var e={exclude:["add","copy"],include:["default"]};return e}setSubLogViewFilter(){return this.sub_log_view_controller?(this.sub_log_view_controller.getSubViewFilter=function(e){return e.table_name_object_id={accrual_policy_user_modifier:[this.parent_edit_record.accrual_policy_id]},e},!0):!1}onAddClick(){var e=this;this.setCurrentEditViewState("new"),e.openEditView();var i;if(e.sub_view_mode&&e.parent_key)switch(e.parent_key){case"user_id":i=e.parent_value;break;case"accrual_policy_id":i=!1;break}else i=!1;e.api["get"+e.api.key_name+"DefaultData"](i,{onResult:function(l){e.onAddResult(l)}})}setSelectLayout(e){var i=this,l;Global.isSet(this.grid)||(l=r(this.el).find("#grid"),l.attr("id",this.ui_id+"_grid"),l=r(this.el).find("#"+this.ui_id+"_grid"));var t=[],a;this.select_layout||(this.select_layout={id:""},this.select_layout.data={filter_data:{},filter_sort:{}},this.select_layout.data.display_columns=this.default_display_columns);var s=this.select_layout.data;s.display_columns.length<1&&(s.display_columns=this.default_display_columns);var o=this.buildDisplayColumns(s.display_columns);if(!this.sub_view_mode){this.column_selector.setSelectGridData(o),this.sort_by_selector.setSourceData(this.buildSortSelectorUnSelectColumns(o)),this.sort_by_selector.setValue(this.buildSortBySelectColumns());var d=this.search_panel.getLayoutsArray();this.setPreviousSavedSearchSourcesAndValue(d)}if(o.length,Global.isSet(e)&&e>0,!this.grid){this.parent_view==="accrual_policy"?(a={name:"full_name",index:"full_name",label:r.i18n._("Employee"),width:50,sortable:!1,title:!1},t.push(a)):this.parent_view==="employee"&&(a={name:"accrual_policy",index:"accrual_policy",label:r.i18n._("Accrual Policy"),width:50,sortable:!1,title:!1},t.push(a)),a={name:"length_of_service_date",index:"length_of_service_date",label:r.i18n._("Length of Service Date"),width:80,sortable:!1,title:!1},t.push(a),a={name:"length_of_service_modifier",index:"length_of_service_modifier",label:r.i18n._("Length of Service Modifier"),width:90,sortable:!1,title:!1},t.push(a),a={name:"accrual_rate_modifier",index:"accrual_rate_modifier",label:r.i18n._("Accrual Rate Modifier"),width:80,sortable:!1,title:!1},t.push(a),a={name:"annual_maximum_time_modifier",index:"annual_maximum_time_modifier",label:r.i18n._("Annual Accrual Maximum Modifier"),width:110,sortable:!1,title:!1},t.push(a),a={name:"maximum_time_modifier",index:"maximum_time_modifier",label:r.i18n._("Accrual Maximum Balance Modifier"),width:110,sortable:!1,title:!1},t.push(a),a={name:"rollover_time_modifier",index:"rollover_time_modifier",label:r.i18n._("Annual Maximum Rollover Modifier"),width:110,sortable:!1,title:!1},t.push(a),i.sub_view_mode&&r("#tab_accruals:visible").length>0;var _=this.getGridSetup();this.grid=new TTGrid(this.ui_id+"_grid",_,t)}i.setGridSize(),LocalCacheData.paging_type===0?(this.paging_widget.parent().length>0&&this.paging_widget.remove(),this.paging_widget.css("width",this.grid.width()),this.grid.grid.append(this.paging_widget),this.paging_widget.click(r.proxy(this.onPaging,this))):this.paging_widget.parent().length<1&&(r(this.el).find(".total-number-div").append(this.paging_widget),r(this.el).find(".bottom-div").append(this.paging_widget_2),this.paging_widget.bind("paging",r.proxy(this.onPaging2,this)),this.paging_widget_2.bind("paging",r.proxy(this.onPaging2,this))),this.bindGridColumnEvents(),this.setGridHeaderStyle(),LocalCacheData.default_filter_for_next_open_view&&(this.select_layout.data.filter_data=LocalCacheData.default_filter_for_next_open_view.filter_data,LocalCacheData.default_filter_for_next_open_view=null),this.filter_data=this.select_layout.data.filter_data,this.sub_view_mode||this.setSearchPanelFilter(!0),this.showGridBorders()}setGridSetup(){var e=this;return{height:200,onResizeGrid:!0,sub_grid_mode:this.sub_view_mode,container_selector:container,onSelectRow:function(){e.onGridSelectRow()},onCellSelect:function(){e.onGridSelectRow()},onSelectAll:function(){e.onGridSelectAll()},ondblClickRow:function(i){e.onGridDblClickRow(i)},onRightClickRow:function(i){var l=e.getGridSelectIdArray();l.indexOf(i)<0&&(e.grid.grid.resetSelection(),e.grid.grid.setSelection(i),e.onGridSelectRow())}}}getFilterColumnsFromDisplayColumns(){var e=[];this.grid&&(e=this.grid.grid.getGridParam("colModel"));var i={};if(i.is_owner=!0,i.id=!0,i.user_id=!0,i.accrual_policy_id=!0,i.is_child=!0,i.in_use=!0,i.first_name=!0,i.last_name=!0,i.type_id=!0,e)for(var l=e.length,t=0;t<l;t++){var a=e[t];i[a.name]=!0}return i}doEditAPICall(e,i,l){var t=this.getCurrentSelectedRecord();if(TTUUID.isUUID(t)&&t!=TTUUID.not_exist_id&&t!=TTUUID.zero_id)return super.doEditAPICall(e,i,l);var a=this.getRecordFromGridById(t);return a&&a.id&&(a.id=""),this.handleEditAPICallbackResult(a)}doViewAPICall(e,i,l){var t=this.getCurrentSelectedRecord();if(TTUUID.isUUID(t)&&t!=TTUUID.not_exist_id&&t!=TTUUID.zero_id)return super.doViewAPICall(e,i,l);var a=this.getRecordFromGridById(t);return a&&a.id&&(a.id=""),this.handleViewAPICallbackResult(a)}onSaveResult(e){var i=this;if(e&&e.isValid()){var l=e.getResult();this.edit_only_mode||(l===!0?i.refresh_id=i.current_edit_record.id:TTUUID.isUUID(l)&&l!=TTUUID.zero_id&&l!=TTUUID.not_exist_id&&(i.refresh_id=l),Global.isSet(i.refresh_id)===!1&&(i.result_details=e.getDetails()),i.search()),i.onSaveDone(e),i.removeEditView()}else i.setErrorMenu(),i.setErrorTips(e)}search(e,i,l,t){Global.isSet(e)||(e=!0);var a=this,s={};if(s.filter_data={},s.filter_sort={},s.filter_columns=this.getFilterColumnsFromDisplayColumns(),s.filter_items_per_page=0,this.pager_data)if(LocalCacheData.paging_type===0)i==="next"?s.filter_page=this.pager_data.next_page:s.filter_page=1;else switch(i){case"next":s.filter_page=this.pager_data.next_page;break;case"last":s.filter_page=this.pager_data.previous_page;break;case"start":s.filter_page=1;break;case"end":s.filter_page=this.pager_data.last_page_number;break;case"go_to":s.filter_page=l;break;default:s.filter_page=this.pager_data.current_page;break}else s.filter_page=1;this.sub_view_mode&&this.parent_key&&(this.select_layout.data.filter_data[this.parent_key]=this.parent_value),Global.isSet(this.getSubViewFilter)&&(this.select_layout.data.filter_data=this.getSubViewFilter(this.select_layout.data.filter_data)),s.filter_data=Global.convertLayoutFilterToAPIFilter(this.select_layout),s.filter_sort=this.select_layout.data.filter_sort,TTUUID.isUUID(this.refresh_id)?(s.filter_data={},s.filter_data.id=[this.refresh_id],this.last_select_ids=s.filter_data.id):Global.isSet(this.result_details)&&this.result_details.length>0?(this.result_details=r.map(this.result_details,function(o){return o===!0?0:o}),this.last_select_ids=Global.concatArraysUniqueWithSort(this.result_details,this.getGridSelectIdArray())):this.last_select_ids=this.getGridSelectIdArray(),this.api["get"+this.api.key_name](s,{onResult:function(o){var d=o.getResult(),_;if(Global.isArray(d)?(a.removeNoResultCover(),Global.isSet(a.__createRowId)&&(d=a.__createRowId(d)),d=Global.formatGridData(d,a.api.key_name),_=d.length):a.showNoResultCover(),TTUUID.isUUID(a.refresh_id)){a.refresh_id=null;var c=a.grid.getData();_=c.length,r.type(c)!=="array"&&(c=[]);var f=!1,n=d[0];if(n){for(var p=[],m=0;m<_;m++){var u=c[m];if(u.id==n.id){a.grid.grid.setRowData(n.id,n),f=!0;break}u.id<0&&u.user_id==n.user_id||p.push(u)}f||(a.search(),a.reSelectLastSelectItems(),a.highLightGridRowById(n.id))}}else{if(a.pager_data=o.getPagerData(),LocalCacheData.paging_type!==0&&(a.paging_widget.setPagerData(a.pager_data),a.paging_widget_2.setPagerData(a.pager_data)),LocalCacheData.paging_type===0&&i==="next"){var g=a.grid.getData();d=g.concat(d)}a.grid&&(a.grid.setData(d),a.reSelectLastSelectItems())}a.result_details=null,a.setGridCellBackGround(),ProgressBar.closeOverlay(),e&&a.setDefaultMenu(!0),LocalCacheData.paging_type===0&&(!a.pager_data||a.pager_data.is_last_page?a.paging_widget.css("display","none"):a.paging_widget.css("display","block")),t&&t(o),e&&a.autoOpenEditViewIfNecessary(),a.searchDone()}})}buildEditViewUI(){super.buildEditViewUI();var e={tab_employee_accrual_modifier:{label:this.parent_view==="employee"?r.i18n._("Accrual"):r.i18n._("Employee Accrual Modifier")},tab_audit:!0};this.setTabModel(e),this.navigation.AComboBox({api_class:TTAPI.APIAccrualPolicyUserModifier,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_wage",show_search_inputs:!0,navigation_mode:!0}),this.setNavigation();var i=this.edit_view_tab.find("#tab_employee_accrual_modifier"),l=i.find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(l);var t;t=Global.loadWidgetByName(FormItemType.AWESOME_BOX),t.AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!1,layout_name:"global_user",show_search_inputs:!0,set_empty:!0,field:"user_id"}),this.addEditFieldToColumn(r.i18n._("Employee"),t,l,"",null,!0);var a={};a.filter_data={},a.filter_data.type_id=[20,30],t=Global.loadWidgetByName(FormItemType.AWESOME_BOX),t.AComboBox({api_class:TTAPI.APIAccrualPolicy,allow_multiple_selection:!1,layout_name:"global_accrual",show_search_inputs:!0,set_empty:!0,field:"accrual_policy_id"}),t.setDefaultArgs(a),this.addEditFieldToColumn(r.i18n._("Accrual Policy"),t,l,""),t=Global.loadWidgetByName(FormItemType.DATE_PICKER),t.TDatePicker({field:"length_of_service_date",width:120}),this.addEditFieldToColumn(r.i18n._("Length of Service Date"),t,l,"",null),t=Global.loadWidgetByName(FormItemType.SEPARATED_BOX),t.SeparatedBox({label:r.i18n._("Modifier Rates")}),this.addEditFieldToColumn(null,t,l,"",null,!0,!1,"separated_1"),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"length_of_service_modifier",width:40}),this.addEditFieldToColumn(r.i18n._("Length of Service"),t,l),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"accrual_rate_modifier",width:40}),this.addEditFieldToColumn(r.i18n._("Accrual Rate"),t,l),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"annual_maximum_time_modifier",width:40}),this.addEditFieldToColumn(r.i18n._("Annual Accrual Maximum"),t,l,"",null,!0),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"maximum_time_modifier",width:40}),this.addEditFieldToColumn(r.i18n._("Accrual Maximum Balance"),t,l),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"rollover_time_modifier",width:40}),this.addEditFieldToColumn(r.i18n._("Annual Maximum Rollover"),t,l),t=Global.loadWidgetByName(FormItemType.SEPARATED_BOX),t.SeparatedBox({label:r.i18n._("Current Milestone")+": "}),this.addEditFieldToColumn(null,t,l,"",null,!0,!1,"separated_2"),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"accrual_rate"}),this.addEditFieldToColumn(r.i18n._("Accrual Rate"),t,l,"",null,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"maximum_time"}),this.addEditFieldToColumn(r.i18n._("Accrual Maximum Balance Time"),t,l,"",null,!0),t=Global.loadWidgetByName(FormItemType.TEXT),t.TText({field:"rollover_time"}),this.addEditFieldToColumn(r.i18n._("Accrual Maximum Rollover"),t,l,"",null,!0)}setCurrentEditRecordData(){for(var e in this.current_edit_record)if(this.current_edit_record.hasOwnProperty(e)){var i=this.edit_view_ui_dic[e];if(Global.isSet(i))switch(e){default:i.setValue(this.current_edit_record[e]);break}}this.current_edit_record.type_id==30?this.attachElement("annual_maximum_time_modifier"):this.detachElement("annual_maximum_time_modifier"),this.setAccrualPolicyDataFromUserModifier(),this.getAccrualPolicyDataFromUserModifier(),this.collectUIDataToCurrentEditRecord(),this.setEditViewDataDone()}onFormItemChange(e,i){var l=this;this.setIsChanged(e),this.setMassEditingFieldsWhenFormChange(e);var t=e.getField(),a=e.getValue();switch(t){case"user_id":this.is_add?this.api["get"+this.api.key_name+"DefaultData"](a,{onResult:function(s){var o=s.getResult();o||(o=[]),l.sub_view_mode&&l.parent_key==="accrual_policy_id"&&(o[l.parent_key]=l.parent_value),l.current_edit_record=o,l.setCurrentEditRecordData(),l.validate()}}):(this.current_edit_record[t]=a,this.validate(),this.getAccrualPolicyDataFromUserModifier());break;default:this.current_edit_record[t]=a,this.validate(),this.getAccrualPolicyDataFromUserModifier();break}}getAccrualPolicyDataFromUserModifier(){var e=this,i={};if(this.is_mass_editing){for(var l in this.edit_view_ui_dic)if(this.edit_view_ui_dic.hasOwnProperty(l)){var t=this.edit_view_ui_dic[l];Global.isSet(t.isChecked)&&t.isChecked()&&t.getEnabled()&&(i[l]=t.getValue())}}else i=this.current_edit_record;i=this.uniformVariable(i),this.api.getAccrualPolicyDataFromUserModifier(i,{onResult:function(a){var s=a.getResult();e.setAccrualPolicyDataFromUserModifier(s)}})}setAccrualPolicyDataFromUserModifier(e){var i=this;if(Global.isSet(e)&&!Global.isFalseOrNull(e)){var l=0;if(e&&e.accrual_policy_type_id&&e.accrual_policy_type_id==20?l=Global.getTimeUnit(e.accrual_rate):l=e.accrual_rate,!i.edit_view_form_item_dic.separated_2)return;i.edit_view_form_item_dic.separated_2.find(".label").text(r.i18n._("Current Milestone")+": "+e.milestone_number),i.edit_view_ui_dic.accrual_rate.setValue(l),i.edit_view_ui_dic.maximum_time.setValue(Global.getTimeUnit(e.maximum_time)),i.edit_view_ui_dic.rollover_time.setValue(Global.getTimeUnit(e.rollover_time)),i.attachElement("separated_2"),i.attachElement("accrual_rate"),i.attachElement("maximum_time"),i.attachElement("rollover_time")}else i.is_edit||(i.detachElement("separated_2"),i.detachElement("accrual_rate"),i.detachElement("maximum_time"),i.detachElement("rollover_time"))}removeEditView(){super.removeEditView(),this.parent_view==="accrual_policy"&&(this.context_menu_name=r.i18n._("Employee Settings"),r(".ribbonTabLabel").find("a[ref="+this.viewId+"ContextMenu]").text(r.i18n._("Employee Settings")))}getAPIFilters(){var e=super.getAPIFilters();return this.sub_view_mode&&this.parent_key&&(e.filter_data[this.parent_key]=this.parent_value),e}onMassEditClick(){var e=this;e.is_add=!1,e.is_viewing=!1,e.is_mass_editing=!0,LocalCacheData.current_doing_context_action="mass_edit",e.openEditView();var i={},l=this.getGridSelectIdArray();l.length,this.mass_edit_record_ids=[],r.each(l,function(t,a){e.mass_edit_record_ids.push(a)}),i.filter_data={},i.filter_data.id=this.mass_edit_record_ids,this.sub_view_mode&&this.parent_key&&(i.filter_data[this.parent_key]=this.parent_value),this.api["getCommon"+this.api.key_name+"Data"](i,{onResult:function(t){var a=t.getResult();a||(a=[]),e.api.getOptions("unique_columns",{onResult:function(s){e.unique_columns=s.getResult(),e.api.getOptions("linked_columns",{onResult:function(o){e.linked_columns=o.getResult(),e.sub_view_mode&&e.parent_key&&(a[e.parent_key]=e.parent_value),e.current_edit_record=a,e.initEditView()}})}})}})}validate(){var e=this,i;this.is_mass_editing?(i=[],r.each(this.mass_edit_record_ids,function(l,t){var a={};t<0?a=e.getRecordFromGridById(t):a.id=t;for(var s in e.edit_view_ui_dic)if(e.edit_view_ui_dic.hasOwnProperty(s)){var o=e.edit_view_ui_dic[s];if(Global.isSet(o.isChecked)&&o.isChecked()&&o.getEnabled())switch(s){case"user_id":break;default:a[s]=o.getValue();break}}var d=Global.clone(a);d=e.uniformVariable(d),i.push(d)})):i=this.current_edit_record,i=this.uniformVariable(i),this.api["validate"+this.api.key_name](i,{onResult:function(l){e.validateResult(l)}})}onSaveClick(e){var i=this,l;Global.isSet(e)||(e=!1),LocalCacheData.current_doing_context_action="save",this.is_mass_editing?(l=[],r.each(this.mass_edit_record_ids,function(t,a){var s={};a<0?s=i.getRecordFromGridById(a):s.id=a;for(var o in i.edit_view_ui_dic){var d=i.edit_view_ui_dic[o];if(Global.isSet(d.isChecked)&&d.isChecked())switch(o){case"user_id":break;default:s[o]=i.current_edit_record[o];break}}var _=Global.clone(s);_=i.uniformVariable(_),l.push(_)})):(l=this.current_edit_record,l=this.uniformVariable(l)),this.api["set"+this.api.key_name](l,!1,e,{onResult:function(t){i.onSaveResult(t)}})}setDefaultMenuDeleteIcon(e,i,l){(!this.addPermissionValidate(l)&&!this.editPermissionValidate(l)||this.edit_only_mode)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1);var t=this.getGridSelectIdArray(),a=!1;for(var s in t)TTUUID.isUUID(t[s])&&(a=!0);a||ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}searchDone(){super.searchDone(),TTPromise.resolve("AccrualView","init")}setEditViewWidgetsMode(){var e={};for(var i in this.edit_view_ui_dic)if(this.edit_view_ui_dic.hasOwnProperty(i)){var l=this.edit_view_ui_dic[i];l.css("opacity",1);var t=l.parent().parent().parent(),a=t.parent().attr("id");t.hasClass("v-box")||e[a]||(e[a]=!0),this.is_viewing||this.parent_view==="employee"&&(i==="accrual_policy_id"||i==="user_id")?Global.isSet(l.setEnabled)&&l.setEnabled(!1):Global.isSet(l.setEnabled)&&l.setEnabled(!0)}}}y.loadSubView=function(h,e,i){Global.loadViewSource("AccrualPolicyUserModifier","SubAccrualPolicyUserModifierView.html",function(l){var t={};if(Global.isSet(e)){var a=e(l),s=a.template;t=a.args}Global.isSet(h)&&(h.html(s(t)),Global.isSet(i)&&i(sub_accrual_policy_user_modifier_view_controller))})};export{y as AccrualPolicyUserModifierViewController};
//# sourceMappingURL=AccrualPolicyUserModifierViewController-CGcYpZYl.bundle.js.map
