import{_ as c,j as r}from"./vendor-tTApdY0Y.bundle.js";class p extends BaseViewController{constructor(e={}){c.defaults(e,{el:"#recurring_schedule_control_view_container",user_status_array:null,user_group_array:null,user_api:null,user_group_api:null}),super(e)}init(e){this.edit_view_tpl="RecurringScheduleControlEditView.html",this.permission_id="recurring_schedule",this.viewId="RecurringScheduleControl",this.script_name="RecurringScheduleControlView",this.table_name_key="recurring_schedule_control",this.context_menu_name=r.i18n._("Recurring Schedules"),this.navigation_label=r.i18n._("Recurring Schedule"),this.api=TTAPI.APIRecurringScheduleControl,this.user_api=TTAPI.APIUser,this.user_group_api=TTAPI.APIUserGroup,this.event_bus=new TTEventBus({view_id:this.viewId}),this.render(),this.buildContextMenu(),this.initData()}initOptions(){var e=this;this.initDropDownOption("status","user_status_id",this.user_api,function(t){t=t.getResult(),e.user_status_array=Global.buildRecordArray(t)}),this.user_group_api.getUserGroup("",!1,!1,{onResult:function(t){t=t.getResult(),t=Global.buildTreeRecord(t),e.user_group_array=t,!e.sub_view_mode&&e.basic_search_field_ui_dic.group_id&&(e.basic_search_field_ui_dic.group_id.setSourceData(t),e.adv_search_field_ui_dic.group_id.setSourceData(t))}})}buildEditViewUI(){super.buildEditViewUI();var e={tab_recurring_schedule:{label:r.i18n._("Recurring Schedule")},tab_audit:!0};this.setTabModel(e);var t,i;this.navigation.AComboBox({api_class:TTAPI.APIRecurringScheduleControl,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_recurring_schedule_control",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation();var l=this.edit_view_tab.find("#tab_recurring_schedule"),a=l.find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(a),t=Global.loadWidgetByName(FormItemType.AWESOME_BOX),t.AComboBox({api_class:TTAPI.APIRecurringScheduleTemplateControl,allow_multiple_selection:!1,layout_name:"global_recurring_template_control",show_search_inputs:!0,set_empty:!0,field:"recurring_schedule_template_control_id"}),this.addEditFieldToColumn(r.i18n._("Template"),t,a,""),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"start_week",width:40}),this.addEditFieldToColumn(r.i18n._("Template Start Week"),t,a),t=Global.loadWidgetByName(FormItemType.DATE_PICKER),t.TDatePicker({field:"start_date"}),this.addEditFieldToColumn(r.i18n._("Start Date"),t,a,"",null),t=Global.loadWidgetByName(FormItemType.DATE_PICKER),t.TDatePicker({field:"end_date"}),i=r("<div class='widget-h-box'></div>");var s=r("<span class='widget-right-label'>"+r.i18n._("(Leave blank for no end date)")+"</span>");i.append(t),i.append(s),this.addEditFieldToColumn(r.i18n._("End Date"),t,a,"",i),t=Global.loadWidgetByName(FormItemType.TEXT_INPUT),t.TTextInput({field:"display_weeks",width:20}),this.addEditFieldToColumn(r.i18n._("Display Weeks"),t,a,"",null),Global.getProductEdition()>=15&&(t=Global.loadWidgetByName(FormItemType.CHECKBOX),t.TCheckbox({field:"auto_fill"}),i=r("<div class='widget-h-box'></div>"),s=r("<span class='widget-right-label t-checkbox-padding-left'> ("+r.i18n._("Punches employees in/out automatically")+")</span>"),i.append(t),i.append(s),this.addEditFieldToColumn(r.i18n._("Auto-Punch"),t,a,"",i)),t=Global.loadWidgetByName(FormItemType.AWESOME_BOX);var n={};Global.getProductEdition()>=15?(t.AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:this.is_add===!0,layout_name:"global_user",show_search_inputs:!0,set_any:!0,field:"user_id",custom_first_label:Global.empty_item,addition_source_function:function(d,o){if(!o)return o;var u=t.createItem(TTUUID.zero_id,Global.open_item);return o.unshift(u),o},added_items:[{value:TTUUID.zero_id,label:Global.open_item}]}),n.permission_section="recurring_schedule",t.setDefaultArgs(n)):(t.AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:this.is_add===!0,layout_name:"global_user",show_search_inputs:!0,set_any:!0,custom_first_label:Global.empty_item,field:"user_id"}),n.permission_section="recurring_schedule",t.setDefaultArgs(n)),this.addEditFieldToColumn(r.i18n._("Employees"),t,a,"",null,!0)}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:r.i18n._("Employee Status"),in_column:1,field:"user_status_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:r.i18n._("Template"),in_column:1,field:"recurring_schedule_template_control_id",layout_name:"global_recurring_template_control",api_class:TTAPI.APIRecurringScheduleTemplateControl,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:r.i18n._("Employee"),in_column:1,field:"user_id",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!0,addition_source_function:this.onEmployeeSourceCreate,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:r.i18n._("Group"),in_column:1,multiple:!0,field:"group_id",layout_name:"global_tree_column",tree_mode:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:r.i18n._("Title"),field:"title_id",in_column:1,layout_name:"global_job_title",api_class:TTAPI.APIUserTitle,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:r.i18n._("Default Branch"),in_column:2,field:"default_branch_id",layout_name:"global_branch",api_class:TTAPI.APIBranch,multiple:!0,basic_search:!0,adv_search:!0,script_name:"BranchView",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:r.i18n._("Default Department"),in_column:2,field:"default_department_id",layout_name:"global_department",api_class:TTAPI.APIDepartment,multiple:!0,basic_search:!0,adv_search:!0,script_name:"DepartmentView",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:r.i18n._("Created By"),in_column:2,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:r.i18n._("Updated By"),in_column:2,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX})]}onEmployeeSourceCreate(e,t){if(Global.getProductEdition()<=10)return t;var i=e.getDisplayColumns(),l={};return r.each(i,function(a,s){return l.id=TTUUID.zero_id,l[s.name]=Global.open_item,!1}),(!t||r.type(t)!=="array")&&(t=[]),t.unshift(l),t}getCustomContextMenuModel(){var e={exclude:[],include:[{label:r.i18n._("Jump To"),id:"jump_to_header",menu_align:"right",action_group:"jump_to",action_group_header:!0,permission_result:!1},{label:r.i18n._("Recurring Templates"),id:"recurring_template",menu_align:"right",action_group:"jump_to",group:"navigation"},{label:r.i18n._("Schedules"),id:"schedule",menu_align:"right",action_group:"jump_to",group:"navigation"}]};return e}onCustomContextClick(e){switch(e){case"recurring_template":case"schedule":case"export_excel":this.onNavigationClick(e);break}}onMassEditClick(){var e=this;e.is_add=!1,e.is_viewing=!1,e.is_mass_editing=!0,LocalCacheData.current_doing_context_action="mass_edit";var t={},i=this.getGridSelectIdArray();i.length,this.mass_edit_record_ids=[],r.each(i,function(l,a){e.mass_edit_record_ids.push(a)}),t.filter_data={},t.filter_data.id=this.mass_edit_record_ids,this.api["getCommon"+this.api.key_name+"Data"](t,{onResult:function(l){var a=l.getResult();if(a.id){e.onEditClick(a.id);return}e.openEditView(),a||(a=[]),e.api.getOptions("unique_columns",{onResult:function(s){e.unique_columns=s.getResult(),e.api.getOptions("linked_columns",{onResult:function(n){e.linked_columns=n.getResult(),e.sub_view_mode&&e.parent_key&&(a[e.parent_key]=e.parent_value),e.current_edit_record=a,e.initEditView()}})}})}})}onSaveResult(e){if(super.onSaveResult(e),e&&e.isValid()){var t=e.getAttributeInAPIDetails("system_job_queue");t&&this.event_bus.emit("tt_topbar","toggle_job_queue_spinner",{show:!0,get_job_data:!0})}}onSaveClick(e){Global.isSet(e)||(e=!1);var t;if(LocalCacheData.current_doing_context_action="save",this.is_mass_editing){var i=this.getChangedFields();t=this.buildMassEditSaveRecord(this.mass_edit_record_ids,i)}else this.is_mass_adding?t=this.buildMassAddRecord(this.current_edit_record):t=this.getRecordsFromUserIDs();this.doSaveAPICall(t,e)}onSaveAndCopy(e){var t=this;Global.isSet(e)||(e=!1),this.is_add=!0,this.is_changed=!1,LocalCacheData.current_doing_context_action="save_and_copy";var i=this.getRecordsFromUserIDs();this.clearNavigationData(),this.api["set"+this.api.key_name](i,!1,e,{onResult:function(l){t.onSaveAndCopyResult(l)}})}onSaveAndNewClick(e){var t=this;Global.isSet(e)||(e=!1),this.setCurrentEditViewState("new");var i=this.getRecordsFromUserIDs();this.api["set"+this.api.key_name](i,!1,e,{onResult:function(l){t.onSaveAndNewResult(l)}})}onSaveAndContinue(e){var t=this;Global.isSet(e)||(e=!1),this.is_changed=!1,this.is_add=!1,LocalCacheData.current_doing_context_action="save_and_continue";var i=this.getRecordsFromUserIDs();this.doSaveAPICall(i,e,{onResult:function(l){t.onSaveAndContinueResult(l)}})}validate(e){if(this.enable_validation){if(e==null)var e=this.api;var t=this,i={};if(this.is_mass_editing){var l=this.getChangedFields();i=this.buildMassEditSaveRecord(this.mass_edit_record_ids,l)}else i=this.getRecordsFromUserIDs();e["validate"+e.key_name](i,{onResult:function(a){t.validateResult(a)}})}else Debug.Text("Validation disabled","BaseViewController.js","BaseViewController","validate",10)}getRecordsFromUserIDs(){var e;if(Array.isArray(this.current_edit_record.user_id)){e=[];for(var t=0;t<this.current_edit_record.user_id.length;t++){var i=Global.clone(this.current_edit_record);i.user_id=this.current_edit_record.user_id[t],i=this.uniformVariable(i),e.push(i)}}else e=this.current_edit_record,e=this.uniformVariable(e);return e}onNavigationClick(e){var t=this;switch(e){case"schedule":var i={filter_data:{}},l=this.getSelectedItem(),a=null,s=new Date;if(Global.isSet(l.user_id))a=[l.user_id],i.filter_data.include_user_ids={value:a},i.select_date=s.format(),Global.addViewTab(this.viewId,r.i18n._("Recurring Schedules"),window.location.href),IndexViewController.goToView("Schedule",i);else{var n={};n.filter_data={},n.filter_data.id=[l.id],n.filter_columns={user_id:!0},this.api["get"+this.api.key_name](n,{onResult:function(d){var o=d.getResult();o||(o=[]),o=o[0],a=[o.user_id],i.filter_data.include_user_ids={value:a},i.select_date=s.format(),Global.addViewTab(t.viewId,r.i18n._("Recurring Schedules"),window.location.href),IndexViewController.goToView("Schedule",i)}})}break;case"recurring_template":i={filter_data:{}},l=this.getSelectedItem(),Global.isSet(l.recurring_schedule_template_control_id)?(i.filter_data.id=[l.recurring_schedule_template_control_id],Global.addViewTab(this.viewId,r.i18n._("Recurring Schedules"),window.location.href),IndexViewController.goToView("RecurringScheduleTemplateControl",i)):(n={},n.filter_data={},n.filter_data.id=[l.id],this.api["get"+this.api.key_name](n,{onResult:function(d){var o=d.getResult();o||(o=[]),o=o[0],i.filter_data.id=[o.recurring_schedule_template_control_id],Global.addViewTab(t.viewId,r.i18n._("Recurring Schedules"),window.location.href),IndexViewController.goToView("RecurringScheduleTemplateControl",i)}}));break;case"export_excel":this.onExportClick("exportRecurringScheduleControl");break}}setCustomDefaultMenuIcon(e,t,i){switch(e){case"recurring_template":this.setDefaultMenuRecurringTemplateIcon(t,i);break;case"schedule":this.setDefaultMenuScheduleIcon(t,i);break}}setDefaultMenuRecurringTemplateIcon(e,t,i){(!this.viewPermissionValidate(i)||this.edit_only_mode)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),t===1?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuScheduleIcon(e,t,i){(!PermissionManager.checkTopLevelPermission("Schedule")||this.edit_only_mode)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),t===1?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}search(e,t,i,l){Global.isSet(e)||(e=!0);var a=this,s={};if(s.filter_data={},s.filter_sort={},s.filter_columns=this.getFilterColumnsFromDisplayColumns(),s.filter_items_per_page=0,this.pager_data)if(LocalCacheData.paging_type===0)t==="next"?s.filter_page=this.pager_data.next_page:s.filter_page=1;else switch(t){case"next":s.filter_page=this.pager_data.next_page;break;case"last":s.filter_page=this.pager_data.previous_page;break;case"start":s.filter_page=1;break;case"end":s.filter_page=this.pager_data.last_page_number;break;case"go_to":s.filter_page=i;break;default:s.filter_page=this.pager_data.current_page;break}else s.filter_page=1;this.sub_view_mode&&this.parent_key&&(this.select_layout.data.filter_data[this.parent_key]=this.parent_value),Global.isSet(this.getSubViewFilter)&&(this.select_layout.data.filter_data=this.getSubViewFilter(this.select_layout.data.filter_data)),s.filter_data=Global.convertLayoutFilterToAPIFilter(this.select_layout),s.filter_sort=this.select_layout.data.filter_sort,this.last_select_ids=this.getGridSelectIdArray(),this.api["get"+this.api.key_name](s,{onResult:function(n){var d=n.getResult();if(Global.isArray(d)?(a.removeNoResultCover(),Global.isSet(a.__createRowId)&&(d=a.__createRowId(d)),d=Global.formatGridData(d,a.api.key_name)):a.showNoResultCover(),a.pager_data=n.getPagerData(),LocalCacheData.paging_type!==0&&(a.paging_widget.setPagerData(a.pager_data),a.paging_widget_2.setPagerData(a.pager_data)),LocalCacheData.paging_type===0&&t==="next"){var o=a.grid.getGridParam("data");d=o.concat(d)}for(var u=d.length,_=0;_<u;_++)d[_];a.grid&&(a.grid.setData(d),a.reSelectLastSelectItems()),a.setGridCellBackGround(),ProgressBar.closeOverlay(),e&&a.setDefaultMenu(!0),LocalCacheData.paging_type===0&&(!a.pager_data||a.pager_data.is_last_page?a.paging_widget.css("display","none"):a.paging_widget.css("display","block")),l&&l(n),e&&a.autoOpenEditViewIfNecessary(),a.searchDone()}})}getFilterColumnsFromDisplayColumns(){var e={};return e.user_id=!0,this._getFilterColumnsFromDisplayColumns(e,!0)}setCustomEditMenuIcon(e,t){switch(e){case"recurring_template":this.setEditMenuRecurringTemplateIcon(t);break;case"schedule":this.setEditMenuScheduleIcon(t);break}}setEditMenuRecurringTemplateIcon(e,t){(!this.viewPermissionValidate(t)||this.edit_only_mode)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),(!this.current_edit_record||!this.current_edit_record.id)&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setEditMenuScheduleIcon(e,t){(!this.viewPermissionValidate(t)||this.edit_only_mode)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),(!this.current_edit_record||!this.current_edit_record.id)&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}}export{p as RecurringScheduleControlViewController};
//# sourceMappingURL=RecurringScheduleControlViewController-C-gMjTpj.bundle.js.map
