import{_ as b,j as a}from"./vendor-tTApdY0Y.bundle.js";class f extends BaseViewController{constructor(t={}){b.defaults(t,{el:"#user_date_total_view_container",punch_tag_api:null,default_punch_tag:[],previous_punch_tag_selection:[]}),super(t)}init(t){this.edit_view_tpl="UserDateTotalEditView.html",this.permission_id="user_date_total",this.script_name="UserDateTotalView",this.viewId="UserDateTotal",this.table_name_key="user_date_total",this.context_menu_name=a.i18n._("Accumulated Time"),this.navigation_label=a.i18n._("Accumulated Time"),this.api=TTAPI.APIUserDateTotal,this.currency_api=TTAPI.APICurrency,Global.getProductEdition()>=20&&(this.job_api=TTAPI.APIJob,this.job_item_api=TTAPI.APIJobItem,this.punch_tag_api=TTAPI.APIPunchTag),PermissionManager.validate(this.permission_id,"add")||PermissionManager.validate(this.permission_id,"edit")?a(this.el).find(".warning-message").text(a.i18n._("WARNING: Manually modifying Accumulated Time records may prevent policies from being calculated properly and should only be done as a last resort when instructed to do so by a support representative.")):a(this.el).find(".warning-message").hide(),this.initPermission(),this.render(),this.sub_view_mode?this.buildContextMenu(!0):this.buildContextMenu(),this.sub_view_mode||this.initData()}setGridSize(){var t=a(this.el).find(".warning-message").outerHeight()*2+27;this.grid.grid.setGridHeight(a(this.el).parents("#tab_user_date_total_parent").height()-t)}setGridCellBackGround(){if(this.grid){var t=this.grid.getGridParam("data");if(t)for(var e=t.length,i=0;i<e;i++){var r=t[i];r.is_override===!0&&a("tr[id='"+r.id+"']").addClass("user-data-total-override")}}}initOptions(){this.initDropDownOption("object_type")}getCustomContextMenuModel(){var t={exclude:["copy","export_excel"],include:["default"]};return t}onFormItemChange(t,e){var i=this;this.setIsChanged(t),this.setMassEditingFieldsWhenFormChange(t);var r=t.getField(),l=t.getValue();switch(this.current_edit_record[r]=l,r){case"object_type_id":this.onTypeChange(!0);break;case"regular_policy_id":case"absence_policy_id":case"overtime_policy_id":case"premium_policy_id":case"break_policy_id":case"meal_policy_id":this.current_edit_record.src_object_id=l,delete this.current_edit_record[r],this.onSrcObjectChange(r);break;case"total_time":this.current_edit_record.total_time==0&&(this.edit_view_ui_dic.start_time_stamp.setValue(""),this.edit_view_ui_dic.end_time_stamp.setValue(""),this.current_edit_record.start_time_stamp="",this.current_edit_record.end_time_stamp="",this.edit_view_form_item_dic.start_time_stamp.find("input").trigger("change",""),this.edit_view_form_item_dic.end_time_stamp.find("input").trigger("change","")),this.calculateAmount();break;case"hourly_rate":this.calculateAmount();break;case"job_id":Global.getProductEdition()>=20&&(this.edit_view_ui_dic.job_quick_search.setValue(t.getValue(!0)&&t.getValue(!0).manual_id?t.getValue(!0).manual_id:""),this.setJobItemValueWhenJobChanged(t.getValue(!0),"job_item_id",{status_id:10,job_id:this.current_edit_record.job_id}),this.edit_view_ui_dic.job_quick_search.setCheckBox(!0),this.setPunchTagValuesWhenCriteriaChanged(this.getPunchTagFilterData(),"punch_tag_id"));break;case"job_item_id":Global.getProductEdition()>=20&&(this.edit_view_ui_dic.job_item_quick_search.setValue(t.getValue(!0)&&t.getValue(!0).manual_id?t.getValue(!0).manual_id:""),this.edit_view_ui_dic.job_item_quick_search.setCheckBox(!0),this.setPunchTagValuesWhenCriteriaChanged(this.getPunchTagFilterData(),"punch_tag_id"));break;case"punch_tag_id":Global.getProductEdition()>=20&&(l!==TTUUID.zero_id&&l!==!1&&l.length>0?this.setPunchTagQuickSearchManualIds(t.getSelectItems()):this.edit_view_ui_dic.punch_tag_quick_search.setValue(""),i.previous_punch_tag_selection=l,this.edit_view_ui_dic.punch_tag_id.setSourceData(null));break;case"user_id":case"branch_id":case"department_id":Global.getProductEdition()>=20&&(this.setPunchTagValuesWhenCriteriaChanged(this.getPunchTagFilterData(),"punch_tag_id"),this.setJobValueWhenCriteriaChanged("job_id",{status_id:10,user_id:this.current_edit_record.user_id,punch_branch_id:this.current_edit_record.branch_id,punch_department_id:this.current_edit_record.department_id}));break;case"job_quick_search":case"job_item_quick_search":Global.getProductEdition()>=20&&(this.onJobQuickSearch(r,l),TTPromise.wait("BaseViewController","onJobQuickSearch",function(){i.setPunchTagValuesWhenCriteriaChanged(i.getPunchTagFilterData(),"punch_tag_id")}),e=!0);break;case"punch_tag_quick_search":Global.getProductEdition()>=20&&(this.onPunchTagQuickSearch(l,this.getPunchTagFilterData(),"punch_tag_id"),e=!0);break}r!=="override"&&(this.edit_view_ui_dic.override.setValue(!0),this.current_edit_record.override=!0,this.edit_view_form_item_dic.override.find("input").trigger("change","1")),e||this.validate()}calculateAmount(){this.current_edit_record.total_time_amount=this.current_edit_record.total_time/3600*parseFloat(this.current_edit_record.hourly_rate),this.edit_view_ui_dic.total_time_amount.setValue(this.current_edit_record.total_time_amount.toFixed(4))}onAddClick(){var t=this;this.setCurrentEditViewState("new"),t.openEditView(),t.api&&t.api["get"+t.api.key_name+"DefaultData"](this.parent_edit_record.user_id,this.parent_edit_record.date_stamp,{onResult:function(e){t.onAddResult(e)}})}onAddResult(t){var e=this,i=t.getResult();i||(i=[]),i.company=LocalCacheData.current_company.name,e.sub_view_mode&&e.parent_key&&(i[e.parent_key]=e.parent_value),i.date_stamp||(i.date_stamp=this.parent_edit_record.date_stamp),e.current_edit_record=i,e.initEditView()}initPermission(){super.initPermission(),this.jobUIValidate()?this.show_job_ui=!0:this.show_job_ui=!1,this.jobItemUIValidate()?this.show_job_item_ui=!0:this.show_job_item_ui=!1,this.punchTagUIValidate()?this.show_punch_tag_ui=!0:this.show_punch_tag_ui=!1,this.branchUIValidate()?this.show_branch_ui=!0:this.show_branch_ui=!1,this.departmentUIValidate()?this.show_department_ui=!0:this.show_department_ui=!1,this.goodQuantityUIValidate()?this.show_good_quantity_ui=!0:this.show_good_quantity_ui=!1,this.badQuantityUIValidate()?this.show_bad_quantity_ui=!0:this.show_bad_quantity_ui=!1,this.noteUIValidate()?this.show_note_ui=!0:this.show_note_ui=!1}noteUIValidate(t){return t||(t="punch"),!!PermissionManager.validate(t,"edit_note")}branchUIValidate(t){return t||(t="punch"),!!PermissionManager.validate(t,"edit_branch")}departmentUIValidate(t){return t||(t="punch"),!!PermissionManager.validate(t,"edit_department")}jobUIValidate(t){return t||(t="punch"),!!(PermissionManager.validate("job","enabled")&&PermissionManager.validate(t,"edit_job"))}jobItemUIValidate(t){return t||(t="punch"),!!PermissionManager.validate(t,"edit_job_item")}punchTagUIValidate(t){return t||(t="punch"),!!PermissionManager.validate(t,"edit_punch_tag")}goodQuantityUIValidate(t){return t||(t="punch"),!!PermissionManager.validate(t,"edit_quantity")}badQuantityUIValidate(t){return t||(t="punch"),!!(PermissionManager.validate(t,"edit_quantity")&&PermissionManager.validate(t,"edit_bad_quantity"))}setCurrency(){if(Global.isSet(this.current_edit_record.user_id)){var t={};t.filter_data={user_id:this.current_edit_record.user_id},this.currency_api.getCurrency(t,!1,!1,{onResult:function(e){e=e.getResult(),Global.isArray(e)?(a(".userDateTotal-currency").text(e[0].symbol),a(".userDateTotal-code").text(e[0].iso_code)):(a(".userDateTotal-currency").text(""),a(".userDateTotal-code").text(""))}})}}setCurrentEditRecordData(){var t=this;this.setCurrency();for(var e in this.current_edit_record)if(this.current_edit_record.hasOwnProperty(e)){var i=this.edit_view_ui_dic[e];switch(e){case"user_id":var r=this.edit_view_ui_dic.first_last_name;TTAPI.APIUser.getUser({filter_data:{id:this.current_edit_record[e]}},{onResult:function(_){if(_&&_.isValid())var d=_.getResult()[0];d&&d.first_name?r.setValue(d.first_name+" "+d.last_name):r.setValue("")}});break;case"job_id":if(Global.getProductEdition()>=20){var l={};l.filter_data={status_id:10,user_id:this.current_edit_record.user_id,punch_branch_id:this.current_edit_record.branch_id,punch_department_id:this.current_edit_record.department_id},i.setDefaultArgs(l),i.setValue(this.current_edit_record[e])}break;case"date_stamp":i.setEnabled(!1),i.setValue(this.current_edit_record[e]);break;case"punch_tag_id":if(Global.getProductEdition()>=20){i.setValue(this.current_edit_record[e]),this.previous_punch_tag_selection=this.current_edit_record[e];var s=i;TTPromise.wait(null,null,function(){var _={};_.filter_data=t.getPunchTagFilterData(),s.setDefaultArgs(_)})}break;default:i&&i.setValue(this.current_edit_record[e]);break}}this.collectUIDataToCurrentEditRecord(),this.setEditViewDataDone()}setEditViewDataDone(){super.setEditViewDataDone(),this.onTypeChange()}onTypeChange(t){this.detachElement("regular_policy_id"),this.detachElement("absence_policy_id"),this.detachElement("overtime_policy_id"),this.detachElement("premium_policy_id"),this.detachElement("meal_policy_id"),this.detachElement("break_policy_id");var e="";this.current_edit_record.object_type_id==20?e="regular_policy_id":this.current_edit_record.object_type_id==25||this.current_edit_record.object_type_id==50?e="absence_policy_id":this.current_edit_record.object_type_id==30?e="overtime_policy_id":this.current_edit_record.object_type_id==40?e="premium_policy_id":this.current_edit_record.object_type_id==100||this.current_edit_record.object_type_id==101?e="meal_policy_id":(this.current_edit_record.object_type_id==110||this.current_edit_record.object_type_id==111)&&(e="break_policy_id"),e?(this.attachElement(e),t?(this.edit_view_ui_dic[e].setValue(""),this.edit_view_ui_dic.pay_code_id.setValue(""),this.current_edit_record.src_object_id=!1,this.current_edit_record.pay_code_id=!1,this.edit_view_ui_dic.pay_code_id.setEnabled(!0)):this.current_edit_record.src_object_id&&(this.edit_view_ui_dic[e].setValue(this.current_edit_record.src_object_id),this.edit_view_ui_dic.pay_code_id.setEnabled(!1))):(this.edit_view_ui_dic.pay_code_id.setEnabled(!0),this.current_edit_record.src_object_id=!1),this.editFieldResize()}onSrcObjectChange(t){var e=this.edit_view_ui_dic[t].getValue(!0);e&&e.pay_code_id?(this.edit_view_ui_dic.pay_code_id.setEnabled(!1),this.edit_view_ui_dic.pay_code_id.setValue(e.pay_code_id),this.current_edit_record.pay_code_id=e.pay_code_id):(this.edit_view_ui_dic.pay_code_id.setEnabled(!0),this.edit_view_ui_dic.pay_code_id.setValue(""),this.current_edit_record.pay_code_id=!1)}search(t,e,i,r){this.refresh_id=null,super.search(t,e,i,r)}getProperObjectType(){for(var t=[],e=0;e<this.object_type_array.length;e++){var i=this.object_type_array[e];(i.value==20||i.value==25||i.value==30||i.value==40||i.value==100||i.value==110)&&t.push(i)}return t}buildEditViewUI(){super.buildEditViewUI();var t={tab_user_date_total:{label:a.i18n._("Accumulated Time"),is_multi_column:!0},tab_audit:!0};this.setTabModel(t),this.navigation.AComboBox({api_class:TTAPI.APIUserDateTotal,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_wage",show_search_inputs:!0,navigation_mode:!0}),this.setNavigation();var e,i,r=this.edit_view_tab.find("#tab_user_date_total"),l=r.find(".first-column"),s=r.find(".second-column");if(e=Global.loadWidgetByName(FormItemType.TEXT),e.TText({field:"first_last_name"}),this.addEditFieldToColumn(a.i18n._("Employee"),e,l,""),e=Global.loadWidgetByName(FormItemType.DATE_PICKER),e.TDatePicker({field:"date_stamp"}),this.addEditFieldToColumn(a.i18n._("Date"),e,l),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"total_time",mode:"time_unit",need_parser_sec:!0}),this.addEditFieldToColumn(a.i18n._("Time"),e,l,"",null,!0),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"object_type_id"}),e.setSourceData(this.getProperObjectType()),this.addEditFieldToColumn(a.i18n._("Type"),e,l),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIRegularTimePolicy,allow_multiple_selection:!1,layout_name:"global_regular_time",show_search_inputs:!0,set_empty:!0,field:"regular_policy_id"}),this.addEditFieldToColumn(a.i18n._("Policy"),e,l,null,null,!0),this.detachElement("regular_policy_id"),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIAbsencePolicy,allow_multiple_selection:!1,layout_name:"global_absences",show_search_inputs:!0,set_empty:!0,field:"absence_policy_id"}),this.addEditFieldToColumn(a.i18n._("Policy"),e,l,null,null,!0),this.detachElement("absence_policy_id"),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIOverTimePolicy,allow_multiple_selection:!1,layout_name:"global_over_time",show_search_inputs:!0,set_empty:!0,field:"overtime_policy_id"}),this.addEditFieldToColumn(a.i18n._("Policy"),e,l,null,null,!0),this.detachElement("overtime_policy_id"),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIPremiumPolicy,allow_multiple_selection:!1,layout_name:"global_premium",show_search_inputs:!0,set_empty:!0,field:"premium_policy_id"}),this.addEditFieldToColumn(a.i18n._("Policy"),e,l,null,null,!0),this.detachElement("premium_policy_id"),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIMealPolicy,allow_multiple_selection:!1,layout_name:"global_meal",show_search_inputs:!0,set_empty:!0,field:"meal_policy_id"}),this.addEditFieldToColumn(a.i18n._("Policy"),e,l,null,null,!0),this.detachElement("meal_policy_id"),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIBreakPolicy,allow_multiple_selection:!1,layout_name:"global_break",show_search_inputs:!0,set_empty:!0,field:"break_policy_id"}),this.addEditFieldToColumn(a.i18n._("Policy"),e,l,null,null,!0),this.detachElement("break_policy_id"),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIPayCode,allow_multiple_selection:!1,layout_name:"global_pay_code",show_search_inputs:!0,set_empty:!0,field:"pay_code_id"}),this.addEditFieldToColumn(a.i18n._("Pay Code"),e,l),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIBranch,allow_multiple_selection:!1,layout_name:"global_branch",show_search_inputs:!0,set_empty:!0,field:"branch_id"}),this.addEditFieldToColumn(a.i18n._("Branch"),e,l,"",null,!0),this.show_branch_ui||this.detachElement("branch_id"),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIDepartment,allow_multiple_selection:!1,layout_name:"global_department",show_search_inputs:!0,set_empty:!0,field:"department_id"}),this.addEditFieldToColumn(a.i18n._("Department"),e,l,"",null,!0),this.show_department_ui||this.detachElement("department_id"),Global.getProductEdition()>=20){e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIJob,allow_multiple_selection:!1,layout_name:"global_job",show_search_inputs:!0,set_empty:!0,setRealValueCallBack:function(o){o&&_.setValue(o.manual_id)},field:"job_id"}),i=a("<div class='widget-h-box'></div>");var _=Global.loadWidgetByName(FormItemType.TEXT_INPUT);_.TTextInput({field:"job_quick_search",disable_keyup_event:!0}),_.addClass("job-coder"),i.append(_),i.append(e),this.addEditFieldToColumn(a.i18n._("Job"),[e,_],l,"",i,!0),this.show_job_ui||this.detachElement("job_id"),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIJobItem,allow_multiple_selection:!1,layout_name:"global_job_item",show_search_inputs:!0,set_empty:!0,setRealValueCallBack:function(o){o&&d.setValue(o.manual_id)},field:"job_item_id"}),i=a("<div class='widget-h-box'></div>");var d=Global.loadWidgetByName(FormItemType.TEXT_INPUT);d.TTextInput({field:"job_item_quick_search",disable_keyup_event:!0}),d.addClass("job-coder"),i.append(d),i.append(e),this.addEditFieldToColumn(a.i18n._("Task"),[e,d],l,"",i,!0),this.show_job_item_ui||this.detachElement("job_item_id"),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIPunchTag,allow_multiple_selection:!0,layout_name:"global_punch_tag",show_search_inputs:!0,set_empty:!0,get_real_data_on_multi:!0,setRealValueCallBack:(o,g)=>{o&&this.setPunchTagQuickSearchManualIds(o,g)},field:"punch_tag_id"}),i=a("<div class='widget-h-box'></div>");var p=Global.loadWidgetByName(FormItemType.TEXT_INPUT);p.TTextInput({field:"punch_tag_quick_search",disable_keyup_event:!0}),p.addClass("job-coder"),i.append(p),i.append(e),this.addEditFieldToColumn(a.i18n._("Tags"),[e,p],l,"",i,!0),this.show_punch_tag_ui||this.detachElement("punch_tag_id")}e=Global.loadWidgetByName(FormItemType.DATE_PICKER),e.TDatePicker({field:"start_time_stamp",mode:"date_time"}),this.addEditFieldToColumn(a.i18n._("Start Date/Time"),e,s,"",null,!0,!0),e=Global.loadWidgetByName(FormItemType.DATE_PICKER),e.TDatePicker({field:"end_time_stamp",mode:"date_time"}),this.addEditFieldToColumn(a.i18n._("End Date/Time"),e,s,"",null,!0,!0),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APICurrency,allow_multiple_selection:!1,layout_name:"global_currency",show_search_inputs:!0,field:"currency_id",set_empty:!0}),this.addEditFieldToColumn(a.i18n._("Currency"),e,s),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"base_hourly_rate",width:90}),i=a("<div class='widget-h-box'></div>");var u=a("<span class='userDateTotal-currency widget-left-label'></span>"),c=a("<span class='userDateTotal-code widget-right-label'></span>");if(i.append(u),i.append(e),i.append(c),this.addEditFieldToColumn(a.i18n._("Base Hourly Rate"),e,s,"",i,!0),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"hourly_rate",width:90}),i=a("<div class='widget-h-box'></div>"),u=a("<span class='userDateTotal-currency widget-left-label'></span>"),c=a("<span class='userDateTotal-code widget-right-label'></span>"),i.append(u),i.append(e),i.append(c),this.addEditFieldToColumn(a.i18n._("Hourly Rate"),e,s,"",i,!0),e=Global.loadWidgetByName(FormItemType.TEXT),e.TText({field:"total_time_amount"}),i=a("<div class='widget-h-box'></div>"),u=a("<span class='userDateTotal-currency widget-left-label'></span>"),c=a("<span class='userDateTotal-code widget-right-label'></span>"),i.append(u),i.append(e),i.append(c),this.addEditFieldToColumn(a.i18n._("Total Amount"),e,s,"",i,!0),Global.getProductEdition()>=20){var h=Global.loadWidgetByName(FormItemType.TEXT_INPUT);h.TTextInput({field:"quantity",width:50}),h.addClass("quantity-input");var y=a("<span class='widget-right-label'>"+a.i18n._("Good")+": </span>"),m=Global.loadWidgetByName(FormItemType.TEXT_INPUT);m.TTextInput({field:"bad_quantity",width:50}),m.addClass("quantity-input");var T=a("<span class='widget-right-label'>/ "+a.i18n._("Bad")+": </span>");i=a("<div class='widget-h-box'></div>"),i.append(y),i.append(h),i.append(T),i.append(m),this.addEditFieldToColumn(a.i18n._("Quantity"),[h,m],s,"",i,!0),!this.show_bad_quantity_ui&&!this.show_good_quantity_ui?this.detachElement("quantity"):(this.show_bad_quantity_ui||(T.hide(),m.hide()),this.show_good_quantity_ui||(y.hide(),h.hide()))}e=Global.loadWidgetByName(FormItemType.TEXT_AREA),e.TTextArea({field:"note",width:"100%"}),this.addEditFieldToColumn(a.i18n._("Note"),e,s,"",null,!0,!0),e.parent().width("45%"),this.show_note_ui||this.detachElement("note"),e=Global.loadWidgetByName(FormItemType.CHECKBOX),e.TCheckbox({field:"override"}),this.addEditFieldToColumn(a.i18n._("Override"),e,s,"",null,!0,!0)}cleanWhenUnloadView(t){a("#user_date_total_view_container").remove(),super.cleanWhenUnloadView(t)}}f.loadView=function(n){Global.loadViewSource("UserDateTotal","UserDateTotalView.html",function(t){var e={},i=b.template(t);Global.isSet(n)?n.html(i(e)):Global.contentContainer().html(i(e))})};f.loadSubView=function(n,t,e){Global.loadViewSource("UserDateTotal","SubUserDateTotalView.html",function(i){var r={},l=b.template(i);Global.isSet(t)&&t(),Global.isSet(n)&&(n.html(l(r)),Global.isSet(e)&&TTPromise.wait("BaseViewController","initialize",function(){e(sub_user_date_total_view_controller)}))})};export{f as UserDateTotalViewController};
//# sourceMappingURL=UserDateTotalViewController-WFwtPey1.bundle.js.map
