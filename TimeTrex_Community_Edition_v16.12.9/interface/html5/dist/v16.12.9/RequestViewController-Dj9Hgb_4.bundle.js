import{_ as A,j as i}from"./vendor-tTApdY0Y.bundle.js";class S extends RequestViewCommonController{constructor(e={}){A.defaults(e,{el:"#request_view_container",type_array:null,request_type_array:null,status_array:null,api_request_schedule:null,authorization_api:null,schedule_api:null,hierarchy_type_id:!1,punch_tag_api:null,default_punch_tag:[],previous_punch_tag_selection:[],overlapping_shift_data:{},messages:null}),super(e)}init(e){this.edit_view_tpl="RequestEditView.html",this.permission_id="request",this.viewId="Request",this.script_name="RequestView",this.table_name_key="request",this.context_menu_name=i.i18n._("Requests"),this.navigation_label=i.i18n._("Request"),this.api=TTAPI.APIRequest,this.api_absence_policy=TTAPI.APIAbsencePolicy,this.api_schedule=TTAPI.APISchedule,this.message_control_api=TTAPI.APIMessageControl,Global.getProductEdition()>=15&&(this.api_request_schedule=TTAPI.APIRequestSchedule,this.schedule_api=TTAPI.APISchedule),Global.getProductEdition()>=20&&(this.job_api=TTAPI.APIJob,this.job_item_api=TTAPI.APIJobItem,this.punch_tag_api=TTAPI.APIPunchTag),this.authorization_api=TTAPI.APIAuthorization,this.initPermission(),this.render(),this.buildContextMenu(),this.initData()}initOptions(e){var t=[{option_name:"status"},{option_name:"type"}];Global.getProductEdition()>=15&&t.push({option_name:"overlap_type",api:TTAPI.APIRequestSchedule}),this.initDropDownOptions(t,function(s){e&&e(s)})}buildEditViewUI(){super.buildEditViewUI();var e={tab_request:{label:i.i18n._("Message")},tab_audit:!0};this.setTabModel(e);var t=this.edit_view.find("a[ref=tab_audit]");t.css("display","none");var s=this.edit_view_tab.find("#tab_request"),d=s.find(".first-column"),l=s.find(".second-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(d);var r=Global.loadWidgetByName(FormItemType.TEXT_INPUT);r.TTextInput({field:"subject",width:359}),this.addEditFieldToColumn(i.i18n._("Subject"),r,d,""),r=Global.loadWidgetByName(FormItemType.TEXT_AREA),r.TTextArea({field:"body",width:600,height:400}),this.addEditFieldToColumn(i.i18n._("Body"),r,d,"",null,null,!0),l.css("display","none")}buildAddViewUI(){super.buildEditViewUI();var e=this,t={tab_request:{label:i.i18n._("Request"),is_multi_column:!0},tab_audit:!0};this.setTabModel(t);var s=this.edit_view.find("a[ref=tab_audit]");s.css("display","none");var d=this.edit_view_tab.find("#tab_request"),l=d.find(".first-column"),r=d.find(".second-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(l),this.edit_view_tabs[0].push(r);var a,n,c;if(a=Global.loadWidgetByName(FormItemType.TEXT),a.TText({field:"full_name"}),this.addEditFieldToColumn(i.i18n._("Employee"),a,l,""),a=Global.loadWidgetByName(FormItemType.COMBO_BOX),a.TComboBox({field:"type_id",set_empty:!1}),a.setSourceData(e.type_array),this.addEditFieldToColumn(i.i18n._("Type"),a,l),a=Global.loadWidgetByName(FormItemType.DATE_PICKER),a.TDatePicker({field:"date_stamp"}),n=i("<div class='widget-h-box'></div>"),c=i("<span class='widget-right-label'> "+i.i18n._("(Use the first or only date affected by this request)")+"</span>"),n.append(a),n.append(c),this.addEditFieldToColumn(i.i18n._("Date"),a,l,"",n),Global.getProductEdition()>=15&&PermissionManager.validate("request","add_advanced")){a=Global.loadWidgetByName(FormItemType.COMBO_BOX),a.TComboBox({field:"request_schedule_status_id",set_empty:!1}),a.setSourceData({10:"Working",20:"Absent"}),this.addEditFieldToColumn(i.i18n._("Status"),a,l),a=Global.loadWidgetByName(FormItemType.AWESOME_BOX),a.AComboBox({api_class:TTAPI.APIAbsencePolicy,customSearchFilter:function(){return{filter_data:{user_id:LocalCacheData.getLoginUser().id}}},allow_multiple_selection:!1,layout_name:"global_absences",set_empty:!0,field:"absence_policy_id"}),this.addEditFieldToColumn(i.i18n._("Absence Policy"),a,l),a=Global.loadWidgetByName(FormItemType.TEXT),a.TText({field:"available_balance"}),n=i("<div class='widget-h-box available-balance-h-box'></div>"),this.available_balance_info=i('<span class="available-balance-info tticon tticon-info_black_24dp"></span>'),n.append(a),n.append(this.available_balance_info),this.addEditFieldToColumn(i.i18n._("Available Balance"),a,l,"",n,!0),a=Global.loadWidgetByName(FormItemType.DATE_PICKER),a.TDatePicker({field:"start_date"}),this.addEditFieldToColumn(i.i18n._("Start Date"),a,l,""),a=Global.loadWidgetByName(FormItemType.DATE_PICKER),a.TDatePicker({field:"end_date"}),this.addEditFieldToColumn(i.i18n._("End Date"),a,l,"");var p=Global.loadWidgetByName(FormItemType.CHECKBOX);p.TCheckbox({field:"sun"});var m=Global.loadWidgetByName(FormItemType.CHECKBOX);m.TCheckbox({field:"mon"});var b=Global.loadWidgetByName(FormItemType.CHECKBOX);b.TCheckbox({field:"tue"});var f=Global.loadWidgetByName(FormItemType.CHECKBOX);f.TCheckbox({field:"wed"});var g=Global.loadWidgetByName(FormItemType.CHECKBOX);g.TCheckbox({field:"thu"});var v=Global.loadWidgetByName(FormItemType.CHECKBOX);v.TCheckbox({field:"fri"});var T=Global.loadWidgetByName(FormItemType.CHECKBOX);T.TCheckbox({field:"sat"}),n=i("<div></div>");var y=i("<span class='widget-top-label'> "+i.i18n._("Sun")+" <br>  </span>"),C=i("<span class='widget-top-label'> "+i.i18n._("Mon")+" <br>  </span>"),I=i("<span class='widget-top-label'> "+i.i18n._("Tue")+" <br>  </span>"),M=i("<span class='widget-top-label'> "+i.i18n._("Wed")+" <br>  </span>"),E=i("<span class='widget-top-label'> "+i.i18n._("Thu")+" <br>  </span>"),w=i("<span class='widget-top-label'> "+i.i18n._("Fri")+" <br>  </span>"),P=i("<span class='widget-top-label'> "+i.i18n._("Sat")+" <br>  </span>");if(y.append(p),C.append(m),I.append(b),M.append(f),E.append(g),w.append(v),P.append(T),n.append(y),n.append(C),n.append(I),n.append(M),n.append(E),n.append(w),n.append(P),n.addClass("request_edit_view_effective_days"),this.addEditFieldToColumn(i.i18n._("Effective Days"),[p,m,b,f,g,v,T],l,"",n,!1,!0),a=Global.loadWidgetByName(FormItemType.TIME_PICKER),a.TTimePicker({field:"start_time"}),this.addEditFieldToColumn(i.i18n._("In"),a,l),a=Global.loadWidgetByName(FormItemType.TIME_PICKER),a.TTimePicker({field:"end_time"}),this.addEditFieldToColumn(i.i18n._("Out"),a,l),a=Global.loadWidgetByName(FormItemType.TEXT),a.TText({field:"total_time"}),n=i("<div class='widget-h-box'></div>"),c=i("<span class='widget-right-label' id='total_info'></span>"),n.append(a),n.append(c),this.addEditFieldToColumn(i.i18n._("Total"),a,l,"",n),Global.getProductEdition()>=15&&this.overlappingShiftUIValidate()==!0){var a=Global.loadWidgetByName(FormItemType.COMBO_BOX);a.TComboBox({field:"overlap_type_id",set_empty:!1}),a.setSourceData(this.overlap_type_array),n=i("<div class='widget-h-box overlapping-shift-h-box'></div>"),this.overlapping_shift_info=i('<span style="position: relative; top: -3px; left: 3px;" id="overlapping-shift-total"></span><span id="overlapping-shift-icon" class="overlapping-shift-info tticon tticon-info_black_24dp"></span>'),n.append(a),n.append(this.overlapping_shift_info),this.addEditFieldToColumn(i.i18n._("Overlapping Shift(s)"),a,l,"",n,!0)}if(a=Global.loadWidgetByName(FormItemType.AWESOME_BOX),a.AComboBox({api_class:TTAPI.APISchedulePolicy,allow_multiple_selection:!1,layout_name:"global_schedule",show_search_inputs:!0,set_empty:!0,field:"schedule_policy_id"}),this.addEditFieldToColumn(i.i18n._("Schedule Policy"),a,l),a=Global.loadWidgetByName(FormItemType.AWESOME_BOX),a.AComboBox({api_class:TTAPI.APIBranch,allow_multiple_selection:!1,layout_name:"global_branch",show_search_inputs:!0,set_empty:!0,field:"branch_id"}),this.show_branch_ui&&this.addEditFieldToColumn(i.i18n._("Branch"),a,l),a=Global.loadWidgetByName(FormItemType.AWESOME_BOX),a.AComboBox({api_class:TTAPI.APIDepartment,allow_multiple_selection:!1,layout_name:"global_department",show_search_inputs:!0,set_empty:!0,field:"department_id"}),this.show_department_ui&&this.addEditFieldToColumn(i.i18n._("Department"),a,l),Global.getProductEdition()>=20){a=Global.loadWidgetByName(FormItemType.AWESOME_BOX),a.AComboBox({api_class:TTAPI.APIJob,allow_multiple_selection:!1,layout_name:"global_job",show_search_inputs:!0,set_empty:!0,setRealValueCallBack:function(o){o&&_.setValue(o.manual_id)},field:"job_id",added_items:[{value:"-1",label:Global.default_item},{value:"-2",label:Global.selected_item}]}),n=i("<div class='widget-h-box'></div>");var _=Global.loadWidgetByName(FormItemType.TEXT_INPUT);_.TTextInput({field:"job_quick_search",disable_keyup_event:!0}),_.addClass("job-coder"),n.append(_),n.append(a),this.addEditFieldToColumn(i.i18n._("Job"),[a,_],l,"",n,!0),this.show_job_ui||this.detachElement("job_id"),a=Global.loadWidgetByName(FormItemType.AWESOME_BOX),a.AComboBox({api_class:TTAPI.APIJobItem,allow_multiple_selection:!1,layout_name:"global_job_item",show_search_inputs:!0,set_empty:!0,setRealValueCallBack:function(o){o&&u.setValue(o.manual_id)},field:"job_item_id",added_items:[{value:"-1",label:Global.default_item},{value:"-2",label:Global.selected_item}]}),n=i("<div class='widget-h-box'></div>");var u=Global.loadWidgetByName(FormItemType.TEXT_INPUT);u.TTextInput({field:"job_item_quick_search",disable_keyup_event:!0}),u.addClass("job-coder"),n.append(u),n.append(a),this.addEditFieldToColumn(i.i18n._("Task"),[a,u],l,"",n,!0),this.show_job_item_ui||this.detachElement("job_item_id"),a=Global.loadWidgetByName(FormItemType.AWESOME_BOX),a.AComboBox({api_class:TTAPI.APIPunchTag,allow_multiple_selection:!0,layout_name:"global_punch_tag",show_search_inputs:!0,set_empty:!0,setRealValueCallBack:o=>{o&&this.setPunchTagQuickSearchManualIds(o)},field:"punch_tag_id"}),n=i("<div class='widget-h-box'></div>");var h=Global.loadWidgetByName(FormItemType.TEXT_INPUT);h.TTextInput({field:"punch_tag_quick_search",disable_keyup_event:!0}),h.addClass("job-coder"),n.append(h),n.append(a),this.addEditFieldToColumn(i.i18n._("Tags"),[a,h],l,"",n,!0),this.show_punch_tag_ui||this.detachElement("punch_tag_id")}}a=Global.loadWidgetByName(FormItemType.TEXT_AREA),a.TTextArea({field:"message",width:400,height:300}),this.addEditFieldToColumn(i.i18n._("Reason / Message"),a,l,"",null,null,!0),Global.getProductEdition()>=15&&PermissionManager.validate("request","add_advanced")&&(this.edit_view_ui_dic.available_balance.parents(".edit-view-form-item-div").hide(),this.hideAdvancedFields()),this.onTypeChanged(),this.onWorkingStatusChanged()}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:i.i18n._("Employee"),in_column:1,field:"user_id",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:i.i18n._("Type"),in_column:1,field:"type_id",multiple:!0,basic_search:!0,adv_search:!1,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:i.i18n._("Start Date"),in_column:1,field:"start_date",basic_search:!0,adv_search:!1,form_item_type:FormItemType.DATE_PICKER}),new SearchField({label:i.i18n._("End Date"),in_column:1,field:"end_date",basic_search:!0,adv_search:!1,form_item_type:FormItemType.DATE_PICKER}),new SearchField({label:i.i18n._("Status"),in_column:2,field:"status_id",multiple:!0,basic_search:!0,adv_search:!1,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:i.i18n._("Created By"),in_column:2,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:i.i18n._("Updated By"),in_column:2,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX})]}getCustomContextMenuModel(){var e={exclude:["default"],include:[{label:i.i18n._("New"),id:"add",group:"editor",vue_icon:"tticon tticon-add_black_24dp",show_on_right_click:!0},{label:i.i18n._("View"),id:"view",group:"editor",vue_icon:"tticon tticon-visibility_black_24dp",show_on_right_click:!0,sort_order:1010},{label:i.i18n._("Reply"),id:"edit",vue_icon:"tticon tticon-reply_black_24dp"},{label:i.i18n._("Send"),id:"send",group:"editor",vue_icon:"tticon tticon-send_black_24dp"},{label:i.i18n._("Delete"),id:"delete_icon",action_group:"delete",group:"editor",vue_icon:"tticon tticon-delete_black_24dp",show_on_right_click:!0},{label:i.i18n._("Delete & Next"),id:"delete_and_next",action_group:"delete",group:"editor",vue_icon:"tticon tticon-delete_black_24dp"},{label:i.i18n._("Cancel"),id:"cancel",group:"editor",sort_order:1990},{label:i.i18n._("Jump To"),id:"jump_to_header",menu_align:"right",action_group:"jump_to",action_group_header:!0,permission_result:!1},{label:i.i18n._("TimeSheet"),id:"timesheet",menu_align:"right",action_group:"jump_to",group:"navigation"},{label:i.i18n._("Schedule"),id:"schedule",menu_align:"right",action_group:"jump_to",group:"navigation"},{label:i.i18n._("Export"),id:"export_excel",menu_align:"right",vue_icon:"tticon tticon-file_upload_black_24dp",sort_order:100},{label:i.i18n._("Edit Employee"),id:"edit_employee",menu_align:"right",action_group:"jump_to"}]};return e}setCurrentEditRecordData(e){var t=this;e&&(this.current_edit_record=e),this.current_edit_record||(this.current_edit_record={});for(var s in this.current_edit_record)if(this.current_edit_record.hasOwnProperty(s)){var d=this.edit_view_ui_dic[s];if(Global.isSet(d))switch(s){case"full_name":this.is_add?d.setValue(LocalCacheData.loginUser.first_name+" "+LocalCacheData.loginUser.last_name):this.is_viewing&&d.setValue(this.current_edit_record.first_name+" "+this.current_edit_record.last_name);break;case"subject":this.is_edit&&this.messages?d.setValue("Re: "+this.messages[0].subject):this.is_viewing&&d.setValue(this.current_edit_record[s]);break;case"punch_tag_id":if(Global.getProductEdition()>=20){d.setValue(this.current_edit_record[s]),this.previous_punch_tag_selection=this.current_edit_record[s];var l=d;TTPromise.wait(null,null,function(){var r={};r.filter_data=t.getPunchTagFilterData(),l.setDefaultArgs(r)})}break;default:d.setValue(this.current_edit_record[s]);break}}this.collectUIDataToCurrentEditRecord(),this.is_add&&(this.current_edit_record.user_id=LocalCacheData.loginUser.id),this.setEditViewDataDone()}setEditViewDataDone(){var e=this;super.setEditViewDataDone(),this.is_viewing||Global.isSet(e.messages)&&(e.messages=null),Global.getProductEdition()>=15&&e.getOverlappingShifts()}initViewingView(){if(super.initViewingView(),this.edit_view_ui_dic.message&&this.edit_view_ui_dic.message.parents(".edit-view-form-item-div").hide(),Global.getProductEdition()>=15&&(this.edit_view_ui_dic.type_id==30||this.edit_view_ui_dic.type_id==40)){var e=["sun","mon","tue","wed","thu","fri","sat"],t=!1;for(var s in this.current_edit_record)if(e.indexOf(s)>-1){for(var d=0;d<7;d++)if(this.current_edit_record[s]!==0&&this.current_edit_record[s]!==!1){t=!0;break}t?this.edit_view_ui_dic.sun.parents(".edit-view-form-item-div").show():this.edit_view_ui_dic.sun.parents(".edit-view-form-item-div").hide()}}}setURL(){if(LocalCacheData.current_doing_context_action==="edit"){LocalCacheData.current_doing_context_action="";return}super.setURL()}setCustomDefaultMenuIcon(e,t,s){switch(e){case"send":this.setDefaultMenuSendIcon(t,s);break;case"timesheet":this.setDefaultMenuViewIcon(t,s,"punch");break;case"schedule":this.setDefaultMenuViewIcon(t,s,"schedule");break;case"edit_employee":this.setDefaultMenuEditEmployeeIcon(t,s,"user");break}}setCustomEditMenuIcon(e,t){switch(e){case"send":this.setEditMenuSaveIcon(t);break;case"timesheet":this.setEditMenuNavViewIcon(t,"punch");break;case"schedule":this.setEditMenuNavViewIcon(t,"schedule");break;case"edit_employee":this.setEditMenuNavEditIcon(t,"user");break}}setDefaultMenuCancelIcon(e,t,s){!this.sub_view_mode&&!this.is_viewing&&(ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1))}setDefaultMenuExportIcon(e,t,s){this.edit_only_mode||this.is_viewing||this.is_edit||this.is_add?(ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)):(t==0||this.grid==null)&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setEditMenuAddIcon(e,t){super.setEditMenuAddIcon(e,t),(this.is_edit||this.is_add)&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setEditMenuDeleteAndNextIcon(e,t){(this.is_edit||this.is_add)&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setEditMenuNavViewIcon(e,t){(this.is_edit||this.is_add)&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setEditMenuDeleteIcon(e,t){(this.is_edit||this.is_add)&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}onTypeChanged(e){if(this.current_edit_record&&Global.getProductEdition()>=15&&PermissionManager.validate("request","add_advanced")&&(this.current_edit_record.type_id==30||this.current_edit_record.type_id==40)){this.edit_view_ui_dic.date_stamp&&this.edit_view_ui_dic.date_stamp.parents(".edit-view-form-item-div").hide(),this.current_edit_record.date_stamp!=null&&this.current_edit_record.start_date==""&&(this.edit_view_ui_dic.start_date.setValue(this.current_edit_record.date_stamp),this.current_edit_record.start_date=this.current_edit_record.date_stamp),this.current_edit_record.date_stamp!=null&&this.current_edit_record.end_date==""&&(this.edit_view_ui_dic.end_date.setValue(this.current_edit_record.date_stamp),this.current_edit_record.end_date=this.current_edit_record.date_stamp),this.showAdvancedFields(!1),this.edit_view_ui_dic.type_id.getValue()==30?this.edit_view_ui_dic.request_schedule_status_id.setValue(20):this.edit_view_ui_dic.type_id.getValue()==40&&this.edit_view_ui_dic.request_schedule_status_id.setValue(10),e&&(e.request_schedule_status_id=this.edit_view_ui_dic.request_schedule_status_id.getValue()),this.onWorkingStatusChanged();var t=this;this.setRequestFormDefaultData(e,function(){t.getAvailableBalance(),t.setCurrentEditRecordData(t.current_edit_record),t.getScheduleTotalTime()})}else this.hideAdvancedFields(),this.edit_view_ui_dic.date_stamp&&this.edit_view_ui_dic.date_stamp.parents(".edit-view-form-item-div").show(),this.onWorkingStatusChanged()}setRequestFormDefaultData(e,t){if(Global.getProductEdition()>=15&&PermissionManager.validate("request","add_advanced")&&(this.current_edit_record.type_id==30||this.current_edit_record.type_id==40))if(e==null){var s=this;this.enable_validation=!1,this.setUIWidgetFieldsToCurrentEditRecord();var d=this.uniformVariable(this.buildDataForAPI(this.current_edit_record));this.api_request_schedule.getRequestScheduleDefaultData(d,{onResult:function(l){e=l.getResult(),e.request_schedule_status_id=e.status_id,e.date_stamp=e.start_date,s.setDefaultData(e,!0),t&&t()}})}else e.date_stamp=e.start_date,e=this.buildDataFromAPI(e),this.setDefaultData(e,!0),t&&t()}onAvailableBalanceChange(){Global.getProductEdition()>=15&&PermissionManager.validate("request","add_advanced")&&(this.edit_view_ui_dic&&this.edit_view_ui_dic.absence_policy_id&&this.edit_view_ui_dic.request_schedule_status_id.getValue()==20&&this.edit_view_ui_dic.absence_policy_id.getValue()!=TTUUID.zero_id?this.getAvailableBalance():this.edit_view_ui_dic&&this.edit_view_ui_dic.available_balance&&this.edit_view_ui_dic.available_balance.parents(".edit-view-form-item-div").hide())}onSaveDone(e){var t;return this.is_edit?(this.onViewClick(this.current_edit_record.id),t=!1):t=!0,i().TFeedback({source:"Send"}),LocalCacheData.current_open_primary_controller&&LocalCacheData.current_open_primary_controller.viewId==="TimeSheet"&&LocalCacheData.current_open_primary_controller.search(),t}uniformVariable(e){if(typeof e=="object"&&(e.user_id=LocalCacheData.loginUser.id,e.first_name=LocalCacheData.loginUser.first_name,e.last_name=LocalCacheData.loginUser.last_name),this.is_add)e=this.buildDataForAPI(e);else if(this.is_edit){var t=this.uniformMessageVariable(e);return e&&e.request_schedule&&(t.request_schedule=e.request_schedule),t}return e}onSaveClick(e){var t=this;LocalCacheData.current_doing_context_action="save",Global.isSet(e)||(e=!1);for(var s in t.current_edit_record)t.edit_view_ui_dic[s]!=null&&(t.current_edit_record[s]=t.edit_view_ui_dic[s].getValue());if(this.is_add)d=this.uniformVariable(t.current_edit_record),this.api["set"+this.api.key_name](d,!1,e,{onResult:function(l){t.onSaveResult(l)}});else if(this.is_edit){var d={};this.is_add=!1,this.setCurrentEditRecordData(),d=this.uniformVariable(this.current_edit_record),EmbeddedMessage.reply([d],e,function(l){if(l&&l.isValid()){var r=t.current_edit_record.id;t.removeEditView(),t.onViewClick(r)}else t.setErrorTips(l),t.setErrorMenu()})}}search(e,t,s,d){this.refresh_id=null,super.search(e,t,s,d)}setEditMenuEditIcon(e){(!this.editPermissionValidate("request")||this.edit_only_mode||this.is_mass_editing)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),(!this.is_viewing||!this.editOwnerOrChildPermissionValidate("request"))&&ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuEditIcon(e,t){(!this.editPermissionValidate("request")||this.edit_only_mode||!this.is_edit||!this.is_viewing)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuScheduleIcon(e,t,s){(!PermissionManager.checkTopLevelPermission("Schedule")||this.edit_only_mode)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),t===1?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuSendIcon(e,t,s){(!this.addPermissionValidate(s)||this.edit_only_mode||!this.is_edit||!this.is_viewing)&&ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}setDefaultMenuEditEmployeeIcon(e,t){this.editChildPermissionValidate("user")||ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1),t===1?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,e.id,!1)}onCustomContextClick(e){switch(e){case"timesheet":case"schedule":case"edit_employee":this.onNavigationClick(e);break;case"send":this.onSaveClick();break}}setEditViewWidgetsMode(){for(var e in this.edit_view_ui_dic){var t=this.edit_view_ui_dic[e];t.css("opacity",1);var s=t.parent().parent().parent();s.hasClass("v-box"),this.is_viewing?Global.isSet(t.setEnabled)&&t.setEnabled(!1):Global.isSet(t.setEnabled)&&t.setEnabled(!0)}}onFormItemChange(e,t){var s=this;this.collectUIDataToCurrentEditRecord(),this.setIsChanged(e),this.setMassEditingFieldsWhenFormChange(e);var d=e.getField(),l=e.getValue();this.current_edit_record[d]=l;var r=!1;switch(d){case"job_id":Global.getProductEdition()>=20&&(this.edit_view_ui_dic.job_quick_search.setValue(e.getValue(!0)&&e.getValue(!0).manual_id?e.getValue(!0).manual_id:""),this.setJobItemValueWhenJobChanged(e.getValue(!0),"job_item_id"),this.edit_view_ui_dic.job_quick_search.setCheckBox(!0),this.setPunchTagValuesWhenCriteriaChanged(this.getPunchTagFilterData(),"punch_tag_id"));break;case"job_item_id":Global.getProductEdition()>=20&&(this.edit_view_ui_dic.job_item_quick_search.setValue(e.getValue(!0)&&e.getValue(!0).manual_id?e.getValue(!0).manual_id:""),this.edit_view_ui_dic.job_item_quick_search.setCheckBox(!0),this.setPunchTagValuesWhenCriteriaChanged(this.getPunchTagFilterData(),"punch_tag_id"));break;case"punch_tag_id":Global.getProductEdition()>=20&&(l!==TTUUID.zero_id&&l!==!1&&l.length>0?this.setPunchTagQuickSearchManualIds(e.getSelectItems()):this.edit_view_ui_dic.punch_tag_quick_search.setValue(""),s.previous_punch_tag_selection=l,this.edit_view_ui_dic.punch_tag_id.setSourceData(null));break;case"user_id":case"branch_id":case"department_id":Global.getProductEdition()>=20&&this.setPunchTagValuesWhenCriteriaChanged(this.getPunchTagFilterData(),"punch_tag_id");break;case"job_quick_search":case"job_item_quick_search":Global.getProductEdition()>=20&&(this.onJobQuickSearch(d,l,"job_id","job_item_id"),TTPromise.wait("BaseViewController","onJobQuickSearch",function(){s.setPunchTagValuesWhenCriteriaChanged(s.getPunchTagFilterData(),"punch_tag_id")}));break;case"punch_tag_quick_search":Global.getProductEdition()>=20&&(this.onPunchTagQuickSearch(l,this.getPunchTagFilterData(),"punch_tag_id"),t=!0);break;case"type_id":this.edit_view_ui_dic.absence_policy_id&&(this.current_edit_record.type_id===30||this.current_edit_record.type_id===40)&&(this.edit_view_ui_dic.absence_policy_id.setValue(TTUUID.zero_id),this.current_edit_record.absence_policy_id=TTUUID.zero_id),t=!0,this.onTypeChanged();break;case"overlap_type_id":Global.getProductEdition()>=15&&this.getOverlappingShifts();break;case"date_stamp":this.onDateStampChanged();break;case"request_schedule_status_id":this.onWorkingStatusChanged();break;case"start_date":this.current_edit_record.start_date=this.edit_view_ui_dic.start_date.getValue(),this.current_edit_record.date_stamp=this.edit_view_ui_dic.start_date.getValue(),this.onStartDateChanged(),this.setRequestFormDefaultData(null,function(){a(),Global.getProductEdition()>=15&&s.getOverlappingShifts()}),r=!0;break;case"end_date":this.current_edit_record.end_date=this.edit_view_ui_dic.end_date.getValue(),this.setRequestFormDefaultData(null,function(){a(),Global.getProductEdition()>=15&&s.getOverlappingShifts()}),r=!0;break;case"start_time":case"end_time":Global.getProductEdition()>=15&&this.getOverlappingShifts();break;case"sun":case"mon":case"tue":case"wed":case"thu":case"fri":case"sat":this.getScheduleTotalTime(),Global.getProductEdition()>=15&&this.getOverlappingShifts();break;case"schedule_policy_id":Global.getProductEdition()>=15&&s.getOverlappingShifts();break;case"absence_policy_id":this.selected_absence_policy_record=this.edit_view_ui_dic.absence_policy_id.getValue();break;case"is_replace_with_open_shift":Global.getProductEdition()>=15&&this.getOverlappingShifts();break}r||a();function a(){(d==="date_stamp"||d==="start_date_stamps"||d==="start_date"||d==="end_date"||d==="start_date_stamp"||d==="start_time"||d==="end_time"||d==="schedule_policy_id"||d==="absence_policy_id")&&(s.current_edit_record.date_stamp!==""&&s.current_edit_record.start_time!==""&&s.current_edit_record.end_time!==""?s.getScheduleTotalTime():s.onAvailableBalanceChange()),t||s.validate(),s.setEditMenu()}}validate(){var e=this,t=this.current_edit_record;t=this.uniformVariable(t);var s=this.message_control_api;this.is_add&&(t=this.buildDataForAPI(t),s=this.api),s["validate"+s.key_name](t,{onResult:function(d){e.validateResult(d)}})}onAddClick(e){TTPromise.add("Request","add"),TTPromise.wait();var t=this;this.edit_view&&this.removeEditView(),this.setCurrentEditViewState("new"),this.openEditView(),this.buildAddViewUI(),t.api&&typeof t.api["get"+t.api.key_name+"DefaultData"]=="function"&&t.api["get"+t.api.key_name+"DefaultData"]({onResult:function(s){e&&(s=i.extend({},s.getResult(),e)),t.onAddResult(s),t.onDateStampChanged(),s.type_id?t.onTypeChanged(s):t.getScheduleTotalTime(),TTPromise.resolve("Request","add")}})}openAddView(e){this.sub_view_mode=!0,this.edit_only_mode=!0;var t=this;this.initOptions(function(){t.onAddClick(e)})}}export{S as RequestViewController};
//# sourceMappingURL=RequestViewController-Dj9Hgb_4.bundle.js.map
