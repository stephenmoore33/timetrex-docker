import{_ as p,j as r}from"./vendor-tTApdY0Y.bundle.js";class y extends BaseViewController{constructor(i={}){p.defaults(i,{el:"#product_view_container",type_array:null,apply_frequency_array:null,month_of_year_array:null,day_of_month_array:null,day_of_week_array:null,length_of_service_unit_array:null,date_api:null,group_api:null,product_price_api:null}),super(i)}init(i){this.edit_view_tpl="ProductEditView.html",this.permission_id="product",this.viewId="Product",this.script_name="ProductView",this.table_name_key="product",this.context_menu_name=r.i18n._("Products"),this.navigation_label=r.i18n._("Product"),this.api=TTAPI.APIProduct,this.date_api=TTAPI.APITTDate,this.group_api=TTAPI.APIProductGroup,this.product_price_api=TTAPI.APIProductPrice,this.render(),this.buildContextMenu(),this.initData()}initOptions(i){var t=this,d=[{option_name:"type",field_name:null,api:null},{option_name:"status",field_name:null,api:null},{option_name:"unit_price_type",field_name:null,api:null},{option_name:"weight_unit",field_name:null,api:null},{option_name:"dimension_unit",field_name:null,api:null},{option_name:"country",field_name:null,api:TTAPI.APICompany}];this.initDropDownOptions(d,function(o){t.group_api.getProductGroup("",!1,!1,{onResult:function(e){e=e.getResult(),e=Global.buildTreeRecord(e),t.edit_only_mode||!t.sub_view_mode&&t.basic_search_field_ui_dic.group_id&&t.basic_search_field_ui_dic.group_id.setSourceData(e),t.group_array=e,i&&i(o)}})})}buildEditViewUI(){super.buildEditViewUI();var i=this,t={tab_product:{label:r.i18n._("Product")},tab_pricing:{label:r.i18n._("Pricing"),html_template:this.getProductPricingTabHtml()},tab_shipping:{label:r.i18n._("Shipping")},tab_audit:!0};this.setTabModel(t),this.navigation.AComboBox({api_class:TTAPI.APIProduct,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_product",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation();var d=this.edit_view_tab.find("#tab_product"),o=d.find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(o);var e=Global.loadWidgetByName(FormItemType.COMBO_BOX);e.TComboBox({field:"type_id",set_empty:!1}),e.setSourceData(i.type_array),this.addEditFieldToColumn(r.i18n._("Type"),e,o,""),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"status_id",set_empty:!1}),e.setSourceData(i.status_array),this.addEditFieldToColumn(r.i18n._("Status"),e,o,""),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({tree_mode:!0,allow_multiple_selection:!1,layout_name:"global_tree_column",set_empty:!0,field:"group_id"}),e.setSourceData(i.group_array),this.addEditFieldToColumn(r.i18n._("Group"),e,o),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"part_number"}),this.addEditFieldToColumn(r.i18n._("Part Number"),e,o,""),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"name",width:"100%"}),this.addEditFieldToColumn(r.i18n._("Name"),e,o,""),e.parent().width("45%"),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"description",width:"100%"}),this.addEditFieldToColumn(r.i18n._("Description"),e,o,""),e.parent().width("45%"),e=Global.loadWidgetByName(FormItemType.CHECKBOX),e.TCheckbox({field:"description_locked"}),this.addEditFieldToColumn(r.i18n._("Lock Description"),e,o),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"upc"}),this.addEditFieldToColumn(r.i18n._("UPC"),e,o,""),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"quantity"}),this.addEditFieldToColumn(r.i18n._("Current Stock"),e,o,""),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APITaxPolicy,allow_multiple_selection:!0,layout_name:"global_tax_policy",show_search_inputs:!0,set_empty:!0,field:"include_tax_policy"}),this.addEditFieldToColumn(r.i18n._("Include Tax Policy"),e,o,""),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APITaxPolicy,allow_multiple_selection:!0,layout_name:"global_tax_policy",show_search_inputs:!0,set_empty:!0,field:"exclude_tax_policy"}),this.addEditFieldToColumn(r.i18n._("Exclude Tax Policy"),e,o,""),e=Global.loadWidgetByName(FormItemType.TAG_INPUT),e.TTagInput({field:"tag",object_type_id:900}),this.addEditFieldToColumn(r.i18n._("Tags"),e,o,"",null,null,!0);var a=this.edit_view_tab.find("#tab_pricing"),l=a.find(".first-column");this.edit_view_tabs[1]=[],this.edit_view_tabs[1].push(l),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"unit_cost",width:80}),this.addEditFieldToColumn(r.i18n._("Unit Cost"),e,l,""),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APICurrency,allow_multiple_selection:!1,layout_name:"global_currency",show_search_inputs:!0,field:"currency_id"}),this.addEditFieldToColumn(r.i18n._("Currency"),e,l),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"minimum_purchase_quantity",width:80}),this.addEditFieldToColumn(r.i18n._("Minimum Quantity"),e,l,""),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"maximum_purchase_quantity",width:80}),this.addEditFieldToColumn(r.i18n._("Maximum Quantity"),e,l,""),e=Global.loadWidgetByName(FormItemType.CHECKBOX),e.TCheckbox({field:"price_locked"}),this.addEditFieldToColumn(r.i18n._("Lock Price"),e,l),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"unit_price_type_id"}),e.setSourceData(i.unit_price_type_array),this.addEditFieldToColumn(r.i18n._("Price Type"),e,l,""),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"unit_price",width:80}),this.addEditFieldToColumn(r.i18n._("Unit Price"),e,l,"",null,!0);var _=a.find(".inside-editor-div"),s={quantity:r.i18n._("Quantity"),unit_price:r.i18n._("Unit Price")};this.editor=Global.loadWidgetByName(FormItemType.INSIDE_EDITOR),this.editor.InsideEditor({addRow:this.insideEditorAddRow,removeRow:this.insideEditorRemoveRow,getValue:this.insideEditorGetValue,setValue:this.insideEditorSetValue,render:u(),render_args:s,render_inline_html:!0,row_render:c(),parent_controller:this});function u(){return`
				<table class="inside-editor-render">
					<tr class="title">
						<td style="width: 200px"><%= quantity %></td>
						<td style="width: 200px"><%= unit_price %></td>
						<td style="width: 25px"></td>
						<td style="width: 25px"></td>
					</tr>
				</table>`}function c(){return`
			<tr class="inside-editor-row data-row">
				<td class="quantity cell"></td>
				<td class="unit-price cell"></td>
				<td class="cell control-icon">
					<button class="plus-icon" onclick=""></button>
				</td>
				<td class="cell control-icon">
					<button class="minus-icon " onclick=""></button>
				</td>
			</tr>`}_.append(this.editor);var m=this.edit_view_tab.find("#tab_shipping"),n=m.find(".first-column");this.edit_view_tabs[2]=[],this.edit_view_tabs[2].push(n),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"weight_unit_id"}),e.setSourceData(i.weight_unit_array),this.addEditFieldToColumn(r.i18n._("Weight Unit"),e,n,""),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"weight"}),this.addEditFieldToColumn(r.i18n._("Weight"),e,n,""),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"dimension_unit_id"}),e.setSourceData(i.dimension_unit_array),this.addEditFieldToColumn(r.i18n._("Dimension Unit"),e,n,""),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"dimension_length"}),this.addEditFieldToColumn(r.i18n._("Length"),e,n,""),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"dimension_width"}),this.addEditFieldToColumn(r.i18n._("Width"),e,n,""),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"dimension_height"}),this.addEditFieldToColumn(r.i18n._("Height"),e,n,""),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"origin_country",set_empty:!0}),e.setSourceData(i.country_array),this.addEditFieldToColumn(r.i18n._("Origin Country"),e,n,""),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"tariff_code"}),this.addEditFieldToColumn(r.i18n._("Tariff Code"),e,n,""),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"customs_unit_value"}),this.addEditFieldToColumn(r.i18n._("Custom Unit Value"),e,n,"")}onTypeChange(){this.current_edit_record.type_id!=10&&this.current_edit_record.type_id!=62?(r(this.edit_view_tab.find("ul li")[2]).hide(),this.getEditViewTabIndex()==2&&this.edit_view_tab.tabs("option","active",0)):r(this.edit_view_tab.find("ul li")[2]).show(),(this.current_edit_record.unit_price_type_id==20||this.current_edit_record.unit_price_type_id==30)&&!this.is_mass_editing?(this.detachElement("unit_price"),this.editor.css("display","block")):(this.attachElement("unit_price"),this.editor.css("display","none")),this.editFieldResize()}onFormItemChange(i,t){this.setIsChanged(i),this.setMassEditingFieldsWhenFormChange(i);var d=i.getField(),o=i.getValue();this.current_edit_record[d]=o,(d==="type_id"||d==="unit_price_type_id")&&this.onTypeChange(),t||this.validate()}insideEditorSetValue(i){i.length,this.removeAllRows();for(var t=0;t<i.length;t++)if(Global.isSet(i[t])){var d=i[t];d.accrual_rate=Global.getTimeUnit(d.accrual_rate),d.maximum_time=Global.getTimeUnit(d.maximum_time),d.rollover_time=Global.getTimeUnit(d.rollover_time),Global.isSet(this.parent_id)&&(d.id=""),this.addRow(d)}}insideEditorAddRow(i,t){i||(i={});var d=this.getRowRender(),o=this.getRender(),e={},a,l,_;a=Global.loadWidgetByName(FormItemType.TEXT_INPUT),a.TTextInput({field:"quantity",width:60}),a.setValue(i.quantity?i.quantity:0),l=r("<div class='widget-h-box'></div>"),_=r("<span class='widget-right-label'> "+r.i18n._("or more")+"</span>"),l.append(a),l.append(_),e[a.getField()]=a,d.children().eq(0).append(l),this.setWidgetEnableBaseOnParentController(a),a=Global.loadWidgetByName(FormItemType.TEXT_INPUT),a.TTextInput({field:"unit_price",width:60}),a.setValue(i.unit_price?i.unit_price:"0.00"),l=r("<div class='widget-h-box'></div>"),l.append(a),e[a.getField()]=a,d.children().eq(1).append(l),this.setWidgetEnableBaseOnParentController(a),e.current_edit_item=i,this.parent_controller.current_edit_record.id||(e.current_edit_item.id=""),typeof t<"u"?(d.insertAfter(r(o).find("tr").eq(t)),this.rows_widgets_array.splice(t,0,e)):(r(o).append(d),this.rows_widgets_array.push(e)),this.parent_controller.is_viewing&&d.find(".control-icon").hide(),this.addIconsEvent(d),this.removeLastRowLine()}insideEditorRemoveRow(i){var t=i[0].rowIndex-1,d=this.rows_widgets_array[t].current_edit_item.id;TTUUID.isUUID(d)&&d!=TTUUID.zero_id&&d!=TTUUID.not_exist_id&&this.delete_ids.push(d),i.remove(),this.rows_widgets_array.splice(t,1),this.removeLastRowLine()}insideEditorGetValue(i){for(var t=this.rows_widgets_array.length,d=[],o=0;o<t;o++){var e=this.rows_widgets_array[o],a=e.current_edit_item;a.quantity=e.quantity.getValue(),a.unit_price=e.unit_price.getValue(),a.product_id=i,d.push(a)}return d}setEditViewDataDone(){super.setEditViewDataDone(),this.onTypeChange(),this.initInsideEditorData()}initInsideEditorData(){var i=this,t={};t.filter_data={},(!this.current_edit_record||!this.current_edit_record.id)&&!this.copied_record_id?(i.editor.removeAllRows(),i.editor.addRow()):(t.filter_data.product_id=this.current_edit_record.id?this.current_edit_record.id:this.copied_record_id,this.copied_record_id="",this.product_price_api.getProductPrice(t,!0,{onResult:function(d){if(i.edit_view){var o=d.getResult();o===!0?i.editor.addRow():o.length>0&&i.editor.setValue(o)}}}))}saveInsideEditorData(i){if(this.current_edit_record.unit_price_type_id!=20&&this.current_edit_record.unit_price_type_id!=30||this.is_mass_editing){Global.isSet(i)&&i();return}var t=this,d=this.editor.getValue(this.refresh_id),o=t.editor.delete_ids;o.length>0&&t.product_price_api.deleteProductPrice(o,{onResult:function(e){e&&e.isValid()&&(t.editor.delete_ids=[])}}),t.product_price_api.setProductPrice(d,{onResult:function(e){e.getResult(),Global.isSet(i)&&i()}})}onSaveResult(i){var t=this;if(i&&i.isValid()){var d=i.getResult();d===!0&&t.current_edit_record.id?t.refresh_id=t.current_edit_record.id:TTUUID.isUUID(d)&&d!=TTUUID.zero_id&&d!=TTUUID.not_exist_id?t.refresh_id=d:(Debug.Arr(this.current_edit_record,"ERROR: Unable to determine refresh_id after save! Current edit record: ","ProductViewController.js","ProductViewController","onSaveResult",10),Debug.Arr(d,"ERROR: Unable to determine refresh_id after save! result_data: ","ProductViewController.js","ProductViewController","onSaveResult",10)),t.saveInsideEditorData(function(){t.search(),t.onSaveDone(i),t.removeEditView()})}else t.setErrorTips(i),t.setErrorMenu()}onSaveAndCopyResult(i){var t=this;if(i&&i.isValid()){var d=i.getResult();d===!0?t.refresh_id=t.current_edit_record.id:TTUUID.isUUID(d)&&d!=TTUUID.zero_id&&d!=TTUUID.not_exist_id&&(t.refresh_id=d),t.saveInsideEditorData(function(){t.search(!1),t.onCopyAsNewClick()})}else t.setErrorTips(i),t.setErrorMenu()}_continueDoCopyAsNew(){if(this.setCurrentEditViewState("new"),LocalCacheData.current_doing_context_action="copy_as_new",Global.isSet(this.edit_view))for(var i=0;i<this.editor.rows_widgets_array.length;i++)this.editor.rows_widgets_array[i].current_edit_item.id="";super._continueDoCopyAsNew()}onCopyAsNewResult(i){var t=this,d=i.getResult();if(!d){TAlertManager.showAlert(r.i18n._("Record does not exist")),t.onCancelClick();return}t.openEditView(),d=d[0],this.copied_record_id=d.id,d.id="",t.sub_view_mode&&t.parent_key&&(d[t.parent_key]=t.parent_value),t.current_edit_record=d,t.initEditView()}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:r.i18n._("Name"),in_column:1,field:"name",multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:r.i18n._("Type"),in_column:1,field:"type_id",multiple:!0,basic_search:!0,adv_search:!1,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:r.i18n._("Status"),in_column:1,field:"status_id",multiple:!0,basic_search:!0,adv_search:!1,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:r.i18n._("Group"),in_column:1,multiple:!0,field:"group_id",layout_name:"global_tree_column",tree_mode:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:r.i18n._("Tags"),field:"tag",basic_search:!0,adv_search:!1,in_column:1,object_type_id:900,form_item_type:FormItemType.TAG_INPUT}),new SearchField({label:r.i18n._("Part Number"),in_column:2,field:"part_number",multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:r.i18n._("Description"),in_column:2,field:"description",multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:r.i18n._("Created By"),in_column:2,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:r.i18n._("Updated By"),in_column:2,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX})]}getProductPricingTabHtml(){return`<div id="tab_pricing" class="edit-view-tab-outside">
					<div class="edit-view-tab" id="tab_pricing_content_div">
						<div class="first-column full-width-column">
						</div>
						<div class="inside-editor-div full-width-column">
						</div>
					</div>
				</div>`}}export{y as ProductViewController};
//# sourceMappingURL=ProductViewController-DHrJkkOF.bundle.js.map
