const __vite__fileDeps=["./main_ui-CaF8IcSp.css","./leaflet-timetrex-DIHfnHxo.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{_ as y}from"./main_ui-z76rxVqJ.entry.bundle.js";import{_ as I,j as i}from"./vendor-tTApdY0Y.bundle.js";class E extends BaseViewController{constructor(t={}){I.defaults(t,{el:"#job_view_container",status_array:null,job_group_array:null,job_group_api:null,user_group_api:null,job_item_group_api:null,job_detail_report_api:null,user_group_selection_type_array:null,user_branch_selection_type_array:null,user_department_selection_type_array:null,job_item_group_selection_type_array:null,user_title_selection_type_id_array:null,user_group_array:null,sub_document_view_controller:null,sub_job_item_amendment_view_controller:null,document_object_type_id:null,date_api:null,report_template:null,country_array:null,province_array:null,e_province_array:null,company_api:null}),super(t)}init(t){this.edit_view_tpl="JobEditView.html",this.permission_id="job",this.viewId="Job",this.script_name="JobView",this.table_name_key="job",this.context_menu_name=i.i18n._("Job"),this.navigation_label=i.i18n._("Job"),this.document_object_type_id=60,this.api=TTAPI.APIJob,this.date_api=TTAPI.APITTDate,this.job_group_api=TTAPI.APIJobGroup,this.user_group_api=TTAPI.APIUserGroup,this.job_item_group_api=TTAPI.APIJobItemGroup,this.job_detail_report_api=TTAPI.APIJobDetailReport,this.company_api=TTAPI.APICompany,this.render(),this.buildContextMenu(),this.initData()}initOptions(){var t=this,a=[{option_name:"status",api:this.api},{option_name:"user_group_selection_type",api:this.api},{option_name:"user_branch_selection_type",api:this.api},{option_name:"user_department_selection_type",api:this.api},{option_name:"user_title_selection_type_id",api:this.api},{option_name:"job_item_group_selection_type",api:this.api},{option_name:"country",field_name:"country",api:this.company_api}];this.initDropDownOptions(a),this.job_group_api.getJobGroup("",!1,!1,{onResult:function(o){o=o.getResult(),o=Global.buildTreeRecord(o),!t.sub_view_mode&&t.basic_search_field_ui_dic.group_id&&(t.basic_search_field_ui_dic.group_id.setSourceData(o),t.adv_search_field_ui_dic.group_id.setSourceData(o)),t.job_group_array=o}}),this.user_group_api.getUserGroup("",!1,!1,{onResult:function(o){o=o.getResult(),o=Global.buildTreeRecord(o),t.user_group_array=o}}),this.job_item_group_api.getJobItemGroup("",!1,!1,{onResult:function(o){o=o.getResult(),o=Global.buildTreeRecord(o),t.job_item_group_array=o}}),this.job_detail_report_api.getTemplate("view_job_detail",{onResult:function(o){o=o.getResult(),t.report_template=o}})}getCustomContextMenuModel(){var t={exclude:[],include:[{label:i.i18n._("Import"),id:"import_icon",menu_align:"right",action_group:"import_export",group:"other",vue_icon:"tticon tticon-file_download_black_24dp",permission_result:PermissionManager.checkTopLevelPermission("ImportCSVJob"),permission:null,sort_order:9010},{label:i.i18n._("Map"),id:"map",menu_align:"right",group:"other",vue_icon:"tticon tticon-map_black_24dp",sort_order:8e3},{label:"",id:"other_header",menu_align:"right",action_group:"other",action_group_header:!0,vue_icon:"tticon tticon-more_vert_black_24dp"},{label:i.i18n._("Invoice"),id:"job_invoice",menu_align:"right",action_group:"other",permission_result:PermissionManager.checkTopLevelPermission("JobInvoice"),permission:null},{label:i.i18n._("Report"),id:"print",menu_align:"right",action_group:"other"}]};return t}onCustomContextClick(t){switch(t){case"import_icon":this.onOtherIconsClick("ImportCSVWizard");break;case"job_invoice":this.onOtherIconsClick("JobInvoiceWizard");break;case"print":this.generatePDFReport();break}}setCustomEditMenuIcon(t,a){switch(t){case"job_invoice":this.setMenuJobInvoiceIcon(a);break}}setCustomDefaultMenuIcon(t,a){switch(t){case"job_invoice":this.setMenuJobInvoiceIcon(a);break}}setMenuJobInvoiceIcon(t,a,o){PermissionManager.checkTopLevelPermission("JobInvoice")===!0?ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,t.id,!0):ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,t.id,!1)}setDefaultMenuImportIcon(t,a,o){PermissionManager.checkTopLevelPermission("ImportCSVJob")===!0?ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,t.id,!0):ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,t.id,!1)}onMapClick(){if(Global.getProductEdition()>=15){this.is_viewing=!1,ProgressBar.showProgressBar();var t={filter_columns:{id:!0,name:!0,address1:!0,address2:!0,city:!0,province:!0,country:!0,postal_code:!0,latitude:!0,longitude:!0}},a=this.getGridSelectIdArray();t.filter_data=Global.convertLayoutFilterToAPIFilter(this.select_layout),a.length>0&&(t.filter_data.id=a);var o=this.api.getJob(t,{async:!1}).getResult();this.is_mass_editing||y(()=>import("./leaflet-timetrex-D9Z7_Af6.bundle.js"),__vite__mapDeps([0,1]),import.meta.url).then(_=>{var e=_.TTConvertMapData.processBasicFromGenericViewController(o);IndexViewController.openEditView(this,"Map",e)}).catch(Global.importErrorHandler)}}getSelectEmployee(t){var a;return t?a=LocalCacheData.getLoginUser():a=LocalCacheData.getLoginUser().id,a}generatePDFReport(){var t=this,a,o=[];if(t.edit_view&&t.current_edit_record.id?o.push(t.current_edit_record.id):(a=this.getGridSelectIdArray(),i.each(a,function(e,m){var s=t.getRecordFromGridById(m);o.push(s.id)})),o.length>0){if(this.report_template){this.report_template.include_job_id=o;var _=[];_.push(this.report_template),_.push("pdf_job_detail"),this.doFormIFrameCall(_)}}else{TAlertManager.showAlert(i.i18n._("No selected record")),ProgressBar.closeOverlay();return}}doFormIFrameCall(t){Global.APIFileDownload("APIJobDetailReport","getJobDetailReport",t)}removeEditView(){super.removeEditView(),this.sub_job_item_amendment_view_controller=null}onOtherIconsClick(t){var a=this;IndexViewController.openWizard(t,null,function(){a.search()})}buildEditViewUI(){super.buildEditViewUI();var t=this,a={tab_job:{label:i.i18n._("Job"),is_multi_column:!0},tab_location:{label:i.i18n._("Location")},tab_employee_criteria:{label:i.i18n._("Employee Criteria")},tab_task_criteria:{label:i.i18n._("Task Criteria")},tab_task_amendments:{label:i.i18n._("Task Amendments"),init_callback:"initSubJobItemAmendmentView",display_on_mass_edit:!1},tab_attachment:!0,tab_audit:!0};this.setTabModel(a),this.navigation.AComboBox({api_class:TTAPI.APIJob,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_job",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation();var o=this.edit_view_tab.find("#tab_job"),_=o.find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(_);var e,m;e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"status_id"}),e.setSourceData(t.status_array),this.addEditFieldToColumn(i.i18n._("Status"),e,_,""),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"name",width:"100%"}),this.addEditFieldToColumn(i.i18n._("Name"),e,_),e.parent().width("45%"),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"description",width:"100%"}),this.addEditFieldToColumn(i.i18n._("Description"),e,_),e.parent().width("45%"),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"manual_id",width:65}),this.addEditFieldToColumn(i.i18n._("Code"),e,_),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({tree_mode:!0,allow_multiple_selection:!1,layout_name:"global_tree_column",set_empty:!0,field:"group_id"}),e.setSourceData(t.job_group_array),this.addEditFieldToColumn(i.i18n._("Group"),e,_),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIClient,allow_multiple_selection:!1,layout_name:"global_client",show_search_inputs:!0,set_empty:!0,field:"client_id"}),this.addEditFieldToColumn(i.i18n._("Client"),e,_),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIBranch,allow_multiple_selection:!1,layout_name:"global_branch",show_search_inputs:!0,set_empty:!0,field:"branch_id"}),this.addEditFieldToColumn(i.i18n._("Branch"),e,_),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIDepartment,allow_multiple_selection:!1,layout_name:"global_department",show_search_inputs:!0,set_empty:!0,field:"department_id"}),this.addEditFieldToColumn(i.i18n._("Department"),e,_),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!1,layout_name:"global_user",show_search_inputs:!0,set_empty:!0,field:"supervisor_user_id"}),this.addEditFieldToColumn(i.i18n._("Supervisor"),e,_),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIJobItem,allow_multiple_selection:!1,layout_name:"global_job_item",show_search_inputs:!0,set_empty:!0,field:"default_item_id"}),this.addEditFieldToColumn(i.i18n._("Default Task"),e,_),Global.getProductEdition()>=20&&(e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIGEOFence,allow_multiple_selection:!0,layout_name:"global_geo_fence",show_search_inputs:!0,set_empty:!0,field:"geo_fence_ids"}),this.addEditFieldToColumn(i.i18n._("Allowed GEO Fences"),e,_)),e=Global.loadWidgetByName(FormItemType.TAG_INPUT),e.TTagInput({field:"tag",object_type_id:600}),this.addEditFieldToColumn(i.i18n._("Tags"),e,_,"",null,null,!0);var s=o.find(".second-column");this.edit_view_tabs[0].push(s),e=Global.loadWidgetByName(FormItemType.DATE_PICKER),e.TDatePicker({field:"start_date"}),this.addEditFieldToColumn(i.i18n._("Start Date"),e,s),e=Global.loadWidgetByName(FormItemType.DATE_PICKER),e.TDatePicker({field:"end_date"}),this.addEditFieldToColumn(i.i18n._("End Date"),e,s),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"estimate_time",mode:"time_unit",need_parser_sec:!0}),m=i("<div class='widget-h-box'></div>");var p=i("<span style='margin-bottom: 5px; margin-top: 0; width: 300px; display: block;'>"+i.i18n._("Set estimates to 0 to use Task Billable Amounts instead.")+" </span>");m.append(p),m.append(e),this.addEditFieldToColumn(i.i18n._("Estimate Time"),e,s,"",m,!0,!1),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"billable_rate",width:86}),this.addEditFieldToColumn(i.i18n._("Billable Rate"),e,s),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"minimum_time",mode:"time_unit",need_parser_sec:!0}),this.addEditFieldToColumn(i.i18n._("Minimum Time"),e,s,"",null),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"estimate_quantity",width:150}),this.addEditFieldToColumn(i.i18n._("Estimate Quantity"),e,s),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"estimate_bad_quantity",width:150}),this.addEditFieldToColumn(i.i18n._("Estimate Bad Quantity"),e,s),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"bad_quantity_rate",width:150}),this.addEditFieldToColumn(i.i18n._("Bad Quantity Rate"),e,s),e=Global.loadWidgetByName(FormItemType.TEXT_AREA),e.TTextArea({field:"note",width:"100%"}),this.addEditFieldToColumn(i.i18n._("Note"),e,s,"",null,null,!0),e.parent().width("45%");var b=this.edit_view_tab.find("#tab_location"),d=b.find(".first-column");this.edit_view_tabs[1]=[],this.edit_view_tabs[1].push(d),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"address1",width:"100%"}),this.addEditFieldToColumn(i.i18n._("Address (Line 1)"),e,d),e.parent().width("45%"),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"address2",width:"100%"}),this.addEditFieldToColumn(i.i18n._("Address (Line 2)"),e,d),e.parent().width("45%"),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"city",width:149}),this.addEditFieldToColumn(i.i18n._("City"),e,d),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"country",set_empty:!0}),e.setSourceData(t.country_array),this.addEditFieldToColumn(i.i18n._("Country"),e,d),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"province"}),e.setSourceData([]),this.addEditFieldToColumn(i.i18n._("Province/State"),e,d),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"postal_code",width:149}),this.addEditFieldToColumn(i.i18n._("Postal/ZIP Code"),e,d),e=Global.loadWidgetByName(FormItemType.TEXT_AREA),e.TTextArea({field:"location_note",width:"100%"}),this.addEditFieldToColumn(i.i18n._("Location Note"),e,d,"",null,null,!0),e.parent().width("45%");var h=this.edit_view_tab.find("#tab_employee_criteria"),u=h.find(".first-column");this.edit_view_tabs[2]=[],this.edit_view_tabs[2].push(u);var l=i("<div class='v-box'></div>");e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"user_group_selection_type_id"}),e.setSourceData(t.user_group_selection_type_array);var n=this.putInputToInsideFormItem(e,i.i18n._("Selection Type"));l.append(n),l.append("<div class='clear-both-div'></div>");var r=Global.loadWidgetByName(FormItemType.AWESOME_BOX);r.AComboBox({tree_mode:!0,allow_multiple_selection:!0,layout_name:"global_tree_column",set_empty:!0,field:"user_group_ids"}),r.setSourceData(t.user_group_array),n=this.putInputToInsideFormItem(r,i.i18n._("Selection")),l.append(n),this.addEditFieldToColumn(i.i18n._("Employee Groups"),[e,r],u,"",l,!1,!0),l=i("<div class='v-box'></div>"),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"user_title_selection_type_id",set_empty:!1}),e.setSourceData(t.user_title_selection_type_id_array),n=this.putInputToInsideFormItem(e,i.i18n._("Selection Type")),l.append(n),l.append("<div class='clear-both-div'></div>"),r=Global.loadWidgetByName(FormItemType.AWESOME_BOX),r.AComboBox({api_class:TTAPI.UserTitle,allow_multiple_selection:!0,layout_name:"global_user_title",show_search_inputs:!0,set_empty:!0,field:"user_title_ids"}),n=this.putInputToInsideFormItem(r,i.i18n._("Selection")),l.append(n),this.addEditFieldToColumn(i.i18n._("Employee Titles"),[e,r],u,"",l,!1,!0),l=i("<div class='v-box'></div>"),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"user_branch_selection_type_id"}),e.setSourceData(t.user_branch_selection_type_array),n=this.putInputToInsideFormItem(e,i.i18n._("Selection Type")),l.append(n),l.append("<div class='clear-both-div'></div>"),r=Global.loadWidgetByName(FormItemType.AWESOME_BOX),r.AComboBox({api_class:TTAPI.APIBranch,allow_multiple_selection:!0,layout_name:"global_branch",show_search_inputs:!0,set_empty:!0,field:"user_branch_ids"}),n=this.putInputToInsideFormItem(r,i.i18n._("Selection")),l.append(n),this.addEditFieldToColumn(i.i18n._("Punch Branches"),[e,r],u,"",l,!1,!0),l=i("<div class='v-box'></div>"),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"user_department_selection_type_id"}),e.setSourceData(t.user_department_selection_type_array),n=this.putInputToInsideFormItem(e,i.i18n._("Selection Type")),l.append(n),l.append("<div class='clear-both-div'></div>"),r=Global.loadWidgetByName(FormItemType.AWESOME_BOX),r.AComboBox({api_class:TTAPI.APIDepartment,allow_multiple_selection:!0,layout_name:"global_department",show_search_inputs:!0,set_empty:!0,field:"user_department_ids"}),n=this.putInputToInsideFormItem(r,i.i18n._("Selection")),l.append(n),this.addEditFieldToColumn(i.i18n._("Punch Departments"),[e,r],u,"",l,!1,!0),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!0,layout_name:"global_user",show_search_inputs:!0,set_empty:!0,field:"include_user_ids"}),this.addEditFieldToColumn(i.i18n._("Include Employees"),e,u),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!0,layout_name:"global_user",show_search_inputs:!0,set_empty:!0,field:"exclude_user_ids"}),this.addEditFieldToColumn(i.i18n._("Exclude Employees"),e,u,"");var T=this.edit_view_tab.find("#tab_task_criteria"),c=T.find(".first-column");this.edit_view_tabs[3]=[],this.edit_view_tabs[3].push(c),l=i("<div class='v-box'></div>"),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"job_item_group_selection_type_id"}),e.setSourceData(t.job_item_group_selection_type_array),n=this.putInputToInsideFormItem(e,i.i18n._("Selection Type")),l.append(n),l.append("<div class='clear-both-div'></div>"),r=Global.loadWidgetByName(FormItemType.AWESOME_BOX),r.AComboBox({tree_mode:!0,allow_multiple_selection:!0,layout_name:"global_tree_column",set_empty:!0,field:"job_item_group_ids"}),r.setSourceData(t.job_item_group_array),n=this.putInputToInsideFormItem(r,i.i18n._("Selection")),l.append(n),this.addEditFieldToColumn(i.i18n._("Task Groups"),[e,r],c,"",l,!1,!0),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIJobItem,allow_multiple_selection:!0,layout_name:"global_job_item",show_search_inputs:!0,set_empty:!0,field:"include_job_item_ids"}),this.addEditFieldToColumn(i.i18n._("Include Tasks"),e,c),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIJobItem,allow_multiple_selection:!0,layout_name:"global_job_item",show_search_inputs:!0,set_empty:!0,field:"exclude_job_item_ids"}),this.addEditFieldToColumn(i.i18n._("Exclude Tasks"),e,c,"")}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:i.i18n._("Status"),in_column:1,field:"status_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:i.i18n._("Code"),in_column:1,field:"manual_id",multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:i.i18n._("Name"),in_column:1,field:"name",multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:i.i18n._("Description"),in_column:1,field:"description",multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:i.i18n._("Supervisor"),in_column:1,field:"supervisor",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:i.i18n._("Tags"),field:"tag",basic_search:!0,adv_search:!0,in_column:1,object_type_id:600,form_item_type:FormItemType.TAG_INPUT}),new SearchField({label:i.i18n._("Group"),in_column:2,multiple:!0,field:"group_id",layout_name:"global_tree_column",tree_mode:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:i.i18n._("Branch"),in_column:2,field:"branch_id",layout_name:"global_branch",api_class:TTAPI.APIBranch,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:i.i18n._("Department"),in_column:2,field:"department_id",layout_name:"global_department",api_class:TTAPI.APIDepartment,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:i.i18n._("Client"),in_column:2,field:"client_id",layout_name:"global_client",api_class:TTAPI.APIClient,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:i.i18n._("Created By"),in_column:2,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:i.i18n._("Updated By"),in_column:2,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX})]}checkTabPermissions(t){var a=!1;switch(t){case"tab_task_amendments":(PermissionManager.validate("job_item","edit")||PermissionManager.validate("job_item","edit_child")||PermissionManager.validate("job_item","edit_own"))&&(a=!0);break;default:a=super.checkTabPermissions(t);break}return a}initSubJobItemAmendmentView(){var t=this;if(!this.current_edit_record.id){TTPromise.resolve("BaseViewController","onTabShow");return}if(this.sub_job_item_amendment_view_controller){this.sub_job_item_amendment_view_controller.buildContextMenu(!0),this.sub_job_item_amendment_view_controller.setDefaultMenu(),t.sub_job_item_amendment_view_controller.parent_key="job_id",t.sub_job_item_amendment_view_controller.parent_value=t.current_edit_record.id,t.sub_job_item_amendment_view_controller.parent_edit_record=t.current_edit_record,t.sub_job_item_amendment_view_controller.parent_view_controller=t,t.sub_job_item_amendment_view_controller.initData();return}Global.loadScript("views/attendance/job_item_amendment/JobItemAmendmentViewController.js",function(){var _=t.edit_view_tab.find("#tab_task_amendments"),e=_.find(".first-column-sub-view");Global.trackView("SubJobItemAmendmentView"),JobItemAmendmentViewController.loadSubView(e,a,o)});function a(){}function o(_){t.sub_job_item_amendment_view_controller=_,t.sub_job_item_amendment_view_controller.parent_key="job_id",t.sub_job_item_amendment_view_controller.parent_value=t.current_edit_record.id,t.sub_job_item_amendment_view_controller.parent_edit_record=t.current_edit_record,t.sub_job_item_amendment_view_controller.parent_view_controller=t,t.sub_job_item_amendment_view_controller.initData()}}setCurrentEditRecordData(){this.setDefaultData({user_branch_selection_type_id:10,user_department_selection_type_id:10,user_group_selection_type_id:10,job_item_group_selection_type_id:10});for(var t in this.current_edit_record){var a=this.edit_view_ui_dic[t];if(Global.isSet(a))switch(t){case"country":this.current_edit_record[t]||(this.current_edit_record[t]=LocalCacheData.getCurrentCompany().country),this.eSetProvince(this.current_edit_record[t]),a.setValue(this.current_edit_record[t]);break;case"province":this.current_edit_record[t]||(this.current_edit_record[t]=LocalCacheData.getCurrentCompany().province),a.setValue(this.current_edit_record[t]);break;default:a.setValue(this.current_edit_record[t]);break}}this.collectUIDataToCurrentEditRecord(),this.setEditViewDataDone()}setEditViewDataDone(){super.setEditViewDataDone(),this.onEmployeeGroupSelectionTypeChange(),this.onEmployeeTitleSelectionTypeChange(),this.onBranchSelectionTypeChange(),this.onDepartmentSelectionTypeChange(),this.isDisableIncludeEmployees(),this.onJobItemGroupSelectionTypeChange(),this.isDisableIncludeTasks()}onFormItemChange(t,a){this.setIsChanged(t),this.setMassEditingFieldsWhenFormChange(t);var o=t.getField(),_=t.getValue();switch(o){case"country":var e=this.edit_view_ui_dic.province;e.setValue(null);break}this.current_edit_record[o]=_,o==="country"&&this.onCountryChange(),o==="user_group_selection_type_id"&&this.onEmployeeGroupSelectionTypeChange(),o==="user_title_selection_type_id"&&this.onEmployeeTitleSelectionTypeChange(),o==="user_branch_selection_type_id"&&this.onBranchSelectionTypeChange(),o==="user_department_selection_type_id"&&this.onDepartmentSelectionTypeChange(),o==="job_item_group_selection_type_id"&&this.onJobItemGroupSelectionTypeChange(),this.isDisableIncludeEmployees(),this.isDisableIncludeTasks(),a||this.validate()}eSetProvince(t,a){var o=this,_=o.edit_view_ui_dic.province;!t||t==="-1"||t==="0"?(o.e_province_array=[],_.setSourceData([])):this.company_api.getOptions("province",t,{onResult:function(e){e=e.getResult(),e||(e=[]),o.e_province_array=Global.buildRecordArray(e),a&&o.e_province_array.length>0&&(o.current_edit_record.province=o.e_province_array[0].value,_.setValue(o.current_edit_record.province)),_.setSourceData(o.e_province_array)}})}isDisableIncludeEmployees(){this.edit_view_ui_dic.user_group_ids.getEnabled()||this.edit_view_ui_dic.user_branch_ids.getEnabled()||this.edit_view_ui_dic.user_department_ids.getEnabled()?this.edit_view_ui_dic.include_user_ids.setEnabled(!0):this.edit_view_ui_dic.include_user_ids.setEnabled(!1)}isDisableIncludeTasks(){this.edit_view_ui_dic.job_item_group_ids.getEnabled()?this.edit_view_ui_dic.include_job_item_ids.setEnabled(!0):this.edit_view_ui_dic.include_job_item_ids.setEnabled(!1)}onEmployeeGroupSelectionTypeChange(){this.current_edit_record.user_group_selection_type_id==10?this.edit_view_ui_dic.user_group_ids.setEnabled(!1):this.edit_view_ui_dic.user_group_ids.setEnabled(!0)}onEmployeeTitleSelectionTypeChange(){this.current_edit_record.user_title_selection_type_id==10?this.edit_view_ui_dic.user_title_ids.setEnabled(!1):this.edit_view_ui_dic.user_title_ids.setEnabled(!0)}onBranchSelectionTypeChange(){this.current_edit_record.user_branch_selection_type_id==10?this.edit_view_ui_dic.user_branch_ids.setEnabled(!1):this.edit_view_ui_dic.user_branch_ids.setEnabled(!0)}onDepartmentSelectionTypeChange(){this.current_edit_record.user_department_selection_type_id==10?this.edit_view_ui_dic.user_department_ids.setEnabled(!1):this.edit_view_ui_dic.user_department_ids.setEnabled(!0)}onJobItemGroupSelectionTypeChange(){this.current_edit_record.job_item_group_selection_type_id==10?this.edit_view_ui_dic.job_item_group_ids.setEnabled(!1):this.edit_view_ui_dic.job_item_group_ids.setEnabled(!0)}getFilterColumnsFromDisplayColumns(t,a){return t==null&&(t={}),t.latitude=!0,t.longitude=!0,this._getFilterColumnsFromDisplayColumns(t,a)}}export{E as JobViewController};
//# sourceMappingURL=JobViewController-lysxjtxJ.bundle.js.map
