import{_ as c,j as i}from"./vendor-tTApdY0Y.bundle.js";import"./TImage-D3G3HRb1.bundle.js";import"./TImageAdvBrowser-CQSTdPda.bundle.js";class y extends BaseViewController{constructor(t={}){c.defaults(t,{el:"#legal_entity_view_container",status_array:null,type_array:null,classification_code_array:null,country_array:null,province_array:null,e_province_array:null,payment_services_status_array:null,company_api:null}),super(t)}init(){this.edit_view_tpl="LegalEntityEditView.html",this.permission_id="legal_entity",this.viewId="LegalEntity",this.script_name="LegalEntityView",this.table_name_key="legal_entity",this.context_menu_name=i.i18n._("Legal Entities"),this.navigation_label=i.i18n._("Legal Entity"),this.api=TTAPI.APILegalEntity,this.company_api=TTAPI.APICompany,this.render(),this.buildContextMenu(),this.initData()}initOptions(){var t=[{option_name:"status",api:this.api},{option_name:"type",api:this.api},{option_name:"classification_code",api:this.api},{option_name:"payment_services_status",api:this.api},{option_name:"country",field_name:"country",api:this.company_api}];this.initDropDownOptions(t)}onSetSearchFilterFinished(){var t,a;this.search_panel.getSelectTabIndex()===0?(t=this.basic_search_field_ui_dic.country,a=t.getValue(),this.setProvince(a)):this.search_panel.getSelectTabIndex()===1&&(t=this.adv_search_field_ui_dic.country,a=t.getValue(),this.setProvince(a))}getLogoUrl(){var t=!1;return this.current_edit_record.id&&(t=ServiceCaller.getURLByObjectType("legal_entity_logo")+"&object_id="+this.current_edit_record.id),Debug.Text(t,"LegalEntityViewController.js","LegalEntityViewController","getLogoUrl",10),t}setEditViewDataDone(){this.onPaymentServicesStatusChange(),super.setEditViewDataDone(),this.file_browser.setImage(this.getLogoUrl())}getCustomContextMenuModel(){var t={exclude:["export_excel"],include:[{label:"",id:"other_header",menu_align:"right",action_group:"other",action_group_header:!0,vue_icon:"tticon tticon-more_vert_black_24dp"},{label:i.i18n._("Payment Services Statement"),id:"payment_services_statement",menu_align:"right",action_group:"other"}]};return t}setCustomDefaultMenuIcon(t,a,e){switch(t){case"payment_services_statement":this.setDefaultMenuPaymentServicesStatementIcon(a,e);break}}setDefaultMenuPaymentServicesStatementIcon(t,a,e){a===1?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,t.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,t.id,!1)}onCustomContextClick(t){switch(t){case"payment_services_statement":this.onPaymentServicesStatementClick();break}}onPaymentServicesStatementClick(){var t={0:null,1:null};this.doFormIFrameCall(t)}doFormIFrameCall(t){Global.APIFileDownload(this.api.className,"getPaymentServicesAccountStatementReport",t)}onBuildAdvUIFinished(){this.adv_search_field_ui_dic.country.change(i.proxy(function(){var t=this.adv_search_field_ui_dic.country,a=t.getValue();this.setProvince(a),this.adv_search_field_ui_dic.province.setValue(null)},this))}onBuildBasicUIFinished(){this.basic_search_field_ui_dic.country.change(i.proxy(function(){var t=this.basic_search_field_ui_dic.country,a=t.getValue();this.setProvince(a),this.basic_search_field_ui_dic.province.setValue(null)},this))}onFormItemChange(t,a){this.setIsChanged(t),this.setMassEditingFieldsWhenFormChange(t);var e=t.getField(),l=t.getValue();switch(e){case"country":if(l.toString()===this.current_edit_record[e].toString())break;this.eSetProvince(l);break;case"payment_services_status_id":this.current_edit_record[e]=l,this.onPaymentServicesStatusChange();break}if(this.current_edit_record[e]=l,e==="country"){this.onCountryChange();return}a||this.validate()}openEditView(t){if(t==!1){var a=this;this.initOptions(),this.api.getLegalEntity({filter_items_per_page:1},{onResult:function(e){var l=e.getResult();typeof l=="object"&&(a.initEditViewUI(a.viewId,a.edit_view_tpl),a.current_edit_record=l[0],a.initEditView())}})}else super.openEditView()}onPaymentServicesStatusChange(){this.current_edit_record&&this.current_edit_record.payment_services_status_id==10?(this.attachElement("payment_services_user_name"),this.attachElement("payment_services_api_key")):(this.detachElement("payment_services_user_name"),this.detachElement("payment_services_api_key")),this.editFieldResize()}buildEditViewUI(){super.buildEditViewUI();var t=this,a={tab_legal_entity:{label:i.i18n._("Legal Entity")},tab_payment_services:{label:i.i18n._("Payment Services"),display_on_mass_edit:!1},tab_audit:!0};this.setTabModel(a);var e;this.navigation&&(this.navigation.AComboBox({api_class:TTAPI.APILegalEntity,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_legal_entity",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation());var l=this.edit_view_tab.find("#tab_legal_entity"),r=l.find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(r);var d=this.edit_view_tab.find("#tab_payment_services"),n=d.find(".first-column");this.edit_view_tabs[1]=[],this.edit_view_tabs[1].push(n),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"status_id"}),e.setSourceData(t.status_array),this.addEditFieldToColumn(i.i18n._("Status"),e,r,""),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"type_id"}),e.setSourceData(t.type_array),this.addEditFieldToColumn(i.i18n._("Type"),e,r,""),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"classification_code"}),e.setSourceData(t.classification_code_array),this.addEditFieldToColumn(i.i18n._("Classification Code"),e,r,""),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"legal_name",width:"100%"}),this.addEditFieldToColumn(i.i18n._("Legal Name"),e,r),e.parent().width("45%"),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"trade_name",width:"100%"}),this.addEditFieldToColumn(i.i18n._("Trade Name"),e,r),e.parent().width("45%"),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"short_name",width:"150"}),this.addEditFieldToColumn(i.i18n._("Short Name/Abbreviation"),e,r),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"address1",width:"100%"}),this.addEditFieldToColumn(i.i18n._("Address (Line 1)"),e,r),e.parent().width("45%"),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"address2",width:"100%"}),this.addEditFieldToColumn(i.i18n._("Address (Line 2)"),e,r),e.parent().width("45%"),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"city",width:149}),this.addEditFieldToColumn(i.i18n._("City"),e,r),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"country",set_empty:!0}),e.setSourceData(t.country_array),this.addEditFieldToColumn(i.i18n._("Country"),e,r),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"province"}),e.setSourceData([]),this.addEditFieldToColumn(i.i18n._("Province/State"),e,r),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"postal_code",width:149}),this.addEditFieldToColumn(i.i18n._("Postal/ZIP Code"),e,r),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"work_phone",width:149}),this.addEditFieldToColumn(i.i18n._("Phone"),e,r),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"fax_phone",width:149}),this.addEditFieldToColumn(i.i18n._("Fax"),e,r),e=Global.loadWidgetByName(FormItemType.DATE_PICKER),e.TDatePicker({field:"start_date"}),this.addEditFieldToColumn(i.i18n._("Start Date"),e,r),e=Global.loadWidgetByName(FormItemType.DATE_PICKER),e.TDatePicker({field:"end_date"}),this.addEditFieldToColumn(i.i18n._("End Date"),e,r),typeof FormData>"u"?(e=Global.loadWidgetByName(FormItemType.IMAGE_BROWSER),this.file_browser=e.TImageBrowser({field:"",default_width:128,default_height:128}),this.file_browser.bind("imageChange",function(_,o){new ServiceCaller().uploadFile(o.getValue(),"object_type=legal_entity_logo&object_id="+t.current_edit_record.id,{onResult:function(s){s.toLowerCase()==="true"?t.file_browser.setImage(t.getLogoUrl()):TAlertManager.showAlert(s,"Error")}})})):(e=Global.loadWidgetByName(FormItemType.IMAGE_AVD_BROWSER),this.file_browser=e.TImageAdvBrowser({field:"",callBack:function(_){new ServiceCaller().uploadFile(_,"object_type=legal_entity_logo&object_id="+t.current_edit_record.id,{onResult:function(o){o.toLowerCase()==="true"?t.file_browser.setImage(t.getLogoUrl()):TAlertManager.showAlert(o,"Error")}})}})),this.is_edit&&(this.file_browser.setEnableDelete(!0),this.file_browser.bind("deleteClick",function(_,o){t.api.deleteImage(t.current_edit_record.id,{onResult:function(s){t.onDeleteImage()}})})),this.addEditFieldToColumn(i.i18n._("Logo"),this.file_browser,r,"",null,!1,!0),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"payment_services_status_id"}),e.setSourceData(t.payment_services_status_array),this.addEditFieldToColumn(i.i18n._("Status"),e,n,"",null,!0),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"payment_services_user_name",width:250}),this.addEditFieldToColumn(i.i18n._("User Name"),e,n,"",null,!0),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"payment_services_api_key",width:510}),this.addEditFieldToColumn(i.i18n._("API Key"),e,n,"",null,!0)}setProvince(t,a){var e=this;!t||t==="-1"||t==="0"?(e.province_array=[],this.adv_search_field_ui_dic.province.setSourceData([]),this.basic_search_field_ui_dic.province.setSourceData([])):this.company_api.getOptions("province",t,{onResult:function(l){l=l.getResult(),l||(l=[]),e.province_array=Global.buildRecordArray(l),e.adv_search_field_ui_dic.province.setSourceData(e.province_array),e.basic_search_field_ui_dic.province.setSourceData(e.province_array)}})}eSetProvince(t,a){var e=this,l=e.edit_view_ui_dic.province;!t||t==="-1"||t==="0"?(e.e_province_array=[],l.setSourceData([])):this.company_api.getOptions("province",t,{onResult:function(r){r=r.getResult(),r||(r=[]),e.e_province_array=Global.buildRecordArray(r),a&&e.e_province_array.length>0&&(e.current_edit_record.province=e.e_province_array[0].value,l.setValue(e.current_edit_record.province)),l.setSourceData(e.e_province_array)}})}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:i.i18n._("Status"),in_column:1,field:"status_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:i.i18n._("Legal Name"),in_column:1,field:"legal_name",multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:i.i18n._("Trade Name"),in_column:1,field:"trade_name",multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:i.i18n._("Phone"),field:"work_phone",basic_search:!1,adv_search:!0,in_column:1,object_type_id:110,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:i.i18n._("Fax"),field:"fax_phone",basic_search:!1,adv_search:!0,in_column:1,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:i.i18n._("Address (Line1)"),field:"address1",basic_search:!1,adv_search:!0,in_column:2,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:i.i18n._("Address (Line2)"),field:"address2",basic_search:!1,adv_search:!0,in_column:2,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:i.i18n._("Postal/ZIP Code"),field:"postal_code",basic_search:!1,adv_search:!0,in_column:2,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:i.i18n._("Country"),in_column:2,field:"country",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.COMBO_BOX}),new SearchField({label:i.i18n._("Province/State"),in_column:2,field:"province",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:i.i18n._("City"),field:"city",basic_search:!0,adv_search:!0,in_column:3,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:i.i18n._("Created By"),in_column:3,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,script_name:"EmployeeView",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:i.i18n._("Updated By"),in_column:3,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,script_name:"EmployeeView",form_item_type:FormItemType.AWESOME_BOX})]}}export{y as LegalEntityViewController};
//# sourceMappingURL=LegalEntityViewController-DvOBTZ6W.bundle.js.map
