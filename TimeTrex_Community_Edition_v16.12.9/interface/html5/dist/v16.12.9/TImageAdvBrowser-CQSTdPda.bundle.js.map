{"version":3,"file":"TImageAdvBrowser-CQSTdPda.bundle.js","sources":["../../global/widgets/filebrowser/TImageAdvBrowser.js"],"sourcesContent":["( function( $ ) {\n\n\t$.fn.TImageAdvBrowser = function( options ) {\n\n\t\tGlobal.addCss( 'global/widgets/filebrowser/TImageBrowser.css' );\n\t\tvar opts = $.extend( {}, $.fn.TImageAdvBrowser.defaults, options );\n\n\t\tvar $this = this;\n\t\tvar field;\n\t\tvar name = 'file_data';\n\n\t\tvar accept_filter = '';\n\n\t\tvar default_width = 177;\n\t\tvar default_height = 42;\n\n\t\tvar callBack = null;\n\n\t\tvar enabled = true;\n\n\t\tvar image;\n\n\t\tvar result_form_data;\n\n\t\tthis.setEnable = function( val ) {\n\t\t\tenabled = val;\n\n\t\t\tvar btn = this.children().eq( 1 );\n\t\t\tif ( !val ) {\n\t\t\t\tbtn.hide();\n\t\t\t} else {\n\t\t\t\tbtn.show();\n\t\t\t}\n\n\t\t};\n\n\t\tthis.clearErrorStyle = function() {\n\n\t\t};\n\n\t\tthis.getField = function() {\n\t\t\treturn field;\n\t\t};\n\n\t\tthis.getValue = function() {\n\t\t\treturn result_form_data;\n\t\t};\n\n\t\tthis.setImage = function( url ) {\n\t\t\tif ( !url ) {\n\t\t\t\timage.attr( 'src', '' );\n\t\t\t\timage.hide();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t//Append CSRF token if its not already.\n\t\t\tif ( url.indexOf( 'X-CSRF-Token=' ) === -1 ) {\n\t\t\t\turl = url + '&X-CSRF-Token=' + getCookie( 'CSRF-Token' );\n\t\t\t}\n\n\t\t\timage.hide();\n\t\t\timage.attr( 'src', url );\n\t\t\timage.css( 'height', 'auto' );\n\t\t\timage.css( 'width', 'auto' );\n\n\t\t};\n\n\t\tthis.onImageLoad = function( image ) {\n\n\t\t\tvar image_height = $( image ).height() > 0 ? $( image ).height() : image.naturalHeight;\n\t\t\tvar image_width = $( image ).width() > 0 ? $( image ).width() : image.naturalWidth;\n\n\t\t\tif ( image_height > default_height ) {\n\t\t\t\t$( image ).css( 'height', default_height );\n\n\t\t\t}\n\n\t\t\tif ( image_width > default_width ) {\n\t\t\t\t$( image ).css( 'width', default_width );\n\t\t\t\t$( image ).css( 'height', 'auto' );\n\t\t\t}\n\n\t\t\t// This causes extreme (10x) performance degradation on Bootstrap 5.1.0 and later. (Related TText setResizeEvent call)\n\t\t\t// $this.trigger( 'setSize' );\n\n\t\t\tif ( image_height < 5 ) {\n\t\t\t\t$( image ).hide();\n\t\t\t} else {\n\t\t\t\t$( image ).show();\n\t\t\t}\n\n\t\t};\n\n\t\tthis.setValue = function( val ) {\n\n\t\t\tif ( !val ) {\n\t\t\t\tval = '';\n\t\t\t}\n\n\t\t};\n\n\t\tthis.setEnableDelete = function( val ) {\n\t\t\tvar image = $this.find( '.image' );\n\t\t\tif ( !val ) {\n\t\t\t\timage.removeAttr( 'enable-delete' );\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\timage.attr( 'enable-delete', 1 );\n\t\t\t}\n\t\t};\n\n\t\tthis.each( function() {\n\n\t\t\tvar o = $.meta ? $.extend( {}, opts, $( this ).data() ) : opts;\n\n\t\t\tfield = o.field;\n\n\t\t\tvar $$this = this;\n\n\t\t\t$( this ).find( '#upload_image' ).text( $.i18n._( 'Upload Image' ) );\n\n\t\t\tif ( o.callBack ) {\n\t\t\t\tcallBack = o.callBack;\n\t\t\t}\n\n\t\t\tif ( o.show_browser === false ) {\n\t\t\t\t$( this ).children().eq( 1 ).hide();\n\t\t\t}\n\n\t\t\tif ( o.default_width > 0 ) {\n\t\t\t\tdefault_width = o.default_width;\n\t\t\t}\n\n\t\t\tif ( o.default_height > 0 ) {\n\t\t\t\tdefault_height = o.default_height;\n\t\t\t}\n\n\t\t\tif ( Global.isSet( o.name ) ) {\n\t\t\t\tname = o.name;\n\t\t\t}\n\n\t\t\tif ( Global.isSet( accept_filter ) ) {\n\t\t\t\taccept_filter = o.accept_filter;\n\t\t\t}\n\n\t\t\tif ( Global.isSet( o.deleteImageHandler ) ) {\n\t\t\t\t$this.find( '.file-browser' ).on( 'deleteClick', function() {\n\t\t\t\t\to.deleteImageHandler();\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\tvar browser = $( this ).children().eq( 1 );\n\t\t\tbrowser.bind( 'click', function() {\n\t\t\t\tIndexViewController.openWizard( 'UserPhotoWizard', null, function( form_data ) {\n\n\t\t\t\t\tif ( callBack ) {\n\t\t\t\t\t\tcallBack( form_data );\n\t\t\t\t\t}\n\n\t\t\t\t\tresult_form_data = form_data;\n\n\t\t\t\t} );\n\t\t\t} );\n\n\t\t\timage = $( this ).children().eq( 0 );\n\t\t\timage.on( 'load', function() {\n\t\t\t\t$this.onImageLoad( this );\n\t\t\t} );\n\n\t\t\timage.hide();\n\n\t\t} );\n\n\t\treturn this;\n\n\t};\n\n\t$.fn.TImageAdvBrowser.defaults = {};\n\t$.fn.TImageAdvBrowser.html_template = `\n\t<div class=\"file-browser\">\n\t\t<img class=\"image\">\n\t\t<button id=\"upload_image\" class=\"t-button file-browser-btn\" style=\"display: block\"></button>\n\t</div>\n\t`;\n\n} )( jQuery );"],"names":["$","options","opts","$this","field","accept_filter","default_width","default_height","callBack","image","result_form_data","val","btn","url","image_height","image_width","o","browser","form_data","jQuery"],"mappings":"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"}