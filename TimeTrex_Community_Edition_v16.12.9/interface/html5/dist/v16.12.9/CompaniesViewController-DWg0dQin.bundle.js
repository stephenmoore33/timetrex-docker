import{_ as T,j as t}from"./vendor-tTApdY0Y.bundle.js";class f extends BaseViewController{constructor(i={}){T.defaults(i,{el:"#companies_view_container",status_array:null,country_array:null,province_array:null,e_province_array:null,saml_authentication_type_array:null,saml_authentication_field_array:null}),super(i)}init(i){this.edit_view_tpl="CompaniesEditView.html",this.permission_id="company",this.viewId="Companies",this.script_name="CompanyView",this.table_name_key="company",this.context_menu_name=t.i18n._("Companies"),this.navigation_label=t.i18n._("Companies"),this.api=TTAPI.APICompany,this.render(),this.buildContextMenu(),this.initData()}initOptions(i){var a=[{option_name:"status"},{option_name:"product_edition"},{option_name:"industry"},{option_name:"country",field_name:"country"},{option_name:"password_policy_type"},{option_name:"password_minimum_permission_level",field_name:"password_minimum_permission_level"},{option_name:"password_minimum_strength",field_name:"password_minimum_strength"},{option_name:"ldap_authentication_type"},{option_name:"saml_authentication_type"},{option_name:"saml_authentication_field"}];this.initDropDownOptions(a,function(o){i&&i(o)})}onSetSearchFilterFinished(){var i,a;this.search_panel.getSelectTabIndex()===0?(i=this.basic_search_field_ui_dic.country,a=i.getValue(),this.setProvince(a)):this.search_panel.getSelectTabIndex()===1&&(i=this.adv_search_field_ui_dic.country,a=i.getValue(),this.setProvince(a))}onBuildAdvUIFinished(){this.adv_search_field_ui_dic.country.change(t.proxy(function(){var i=this.adv_search_field_ui_dic.country,a=i.getValue();this.setProvince(a),this.adv_search_field_ui_dic.province.setValue(null)},this))}onBuildBasicUIFinished(){this.basic_search_field_ui_dic.country.change(t.proxy(function(){var i=this.basic_search_field_ui_dic.country,a=i.getValue();this.setProvince(a),this.basic_search_field_ui_dic.province.setValue(null)},this))}onFormItemChange(i,a){this.setIsChanged(i),this.setMassEditingFieldsWhenFormChange(i);var o=i.getField(),d=i.getValue();switch(this.current_edit_record[o]=d,o){case"country":var s=this.edit_view_ui_dic.province;s.setValue(null);break}if((o==="ldap_authentication_type_id"||o==="saml_authentication_type_id")&&this.onTypeChange(),o==="country"){this.onCountryChange();return}a||this.validate()}getCustomContextMenuModel(){var i={exclude:["mass_edit","copy"],include:[{label:t.i18n._("Sign In"),id:"login",menu_align:"right",group:"navigation",vue_icon:"tticon tticon-login_black_24dp"},{label:t.i18n._("Jump To"),id:"jump_to_header",menu_align:"right",action_group:"jump_to",action_group_header:!0,permission_result:!1,sort_order:9050},{label:t.i18n._("Employees"),id:"employee",menu_align:"right",action_group:"jump_to",group:"navigation",sort_order:9050}]};return i}setCustomDefaultMenuIcon(i,a,o){switch(i){case"employee":this.setDefaultMenuEmployeeIcon(a,o);break}}setCustomEditMenuIcon(i,a){switch(i){case"employee":this.setEditMenuEmployeeIcon(a);break}}setEditMenuEmployeeIcon(i){this.viewPermissionValidate("user")||ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,i.id,!1),ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,i.id,!1)}setDefaultMenuEmployeeIcon(i,a){this.viewPermissionValidate("user")||ContextMenuManager.hideMenuItem(this.determineContextMenuMountAttributes().id,i.id,!1),a===1?ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,i.id,!0):ContextMenuManager.disableMenuItem(this.determineContextMenuMountAttributes().id,i.id,!1)}onCustomContextClick(i){switch(i){case"login":this.onLoginClick();break;case"employee":this.onEmployeeClick();break}}onEmployeeClick(){var i=this.getGridSelectIdArray(),a={filter_data:{}},o={value:i[0]};a.filter_data.company_id=o,Global.addViewTab(this.viewId,t.i18n._("Companies"),window.location.href),IndexViewController.goToView("Employee",a)}onLoginClick(){var i={};i.company_id=this.getGridSelectIdArray()[0],LocalCacheData.extra_filter_for_next_open_view={},LocalCacheData.extra_filter_for_next_open_view.filter_data=i,IndexViewController.openWizard("LoginUserWizard",null,function(a){Global.NewSession(a)})}buildEditViewUI(){var i=this;super.buildEditViewUI();var a={tab_company:{label:t.i18n._("Company"),is_multi_column:!0},tab_password_policy:{label:t.i18n._("Password Policy")},tab_ldap:{label:t.i18n._("LDAP Authentication")},tab_saml:{label:t.i18n._("SAML Authentication")},tab_audit:!0};this.setTabModel(a);var o=this.edit_view_tab.find("#tab_company"),d=o.find(".first-column"),s=o.find(".second-column");this.navigation.AComboBox({api_class:TTAPI.APICompany,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_company",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation();var e,l,n;this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(d),this.edit_view_tabs[0].push(s),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"status_id"}),e.setSourceData(i.status_array),this.addEditFieldToColumn(t.i18n._("Status"),e,d,""),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"product_edition_id"}),e.setSourceData(i.product_edition_array),this.addEditFieldToColumn(t.i18n._("Product Edition"),e,d),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"name",width:"100%"}),this.addEditFieldToColumn(t.i18n._("Full Name"),e,d),e.parent().width("45%"),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"short_name",width:128}),this.addEditFieldToColumn(t.i18n._("Short Name"),e,d),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"industry_id"}),e.setSourceData(i.industry_array),this.addEditFieldToColumn(t.i18n._("Industry"),e,d),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"address1",width:"100%"}),this.addEditFieldToColumn(t.i18n._("Address (Line 1)"),e,d),e.parent().width("45%"),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"address2",width:"100%"}),this.addEditFieldToColumn(t.i18n._("Address (Line 2)"),e,d),e.parent().width("45%"),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"city",width:149}),this.addEditFieldToColumn(t.i18n._("City"),e,d),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"country",set_empty:!0}),e.setSourceData(i.country_array),this.addEditFieldToColumn(t.i18n._("Country"),e,d),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"province"}),e.setSourceData([]),this.addEditFieldToColumn(t.i18n._("Province/State"),e,d),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"postal_code",width:149}),this.addEditFieldToColumn(t.i18n._("Postal/ZIP Code"),e,d,""),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"work_phone",width:149}),this.addEditFieldToColumn(t.i18n._("Phone"),e,s,""),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"fax_phone",width:149}),this.addEditFieldToColumn(t.i18n._("Fax"),e,s),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!1,layout_name:"global_user",show_search_inputs:!0,set_empty:!0,field:"admin_contact",customSearchFilter:function(p){return i.setCompanyIdFilter(p)}}),this.addEditFieldToColumn(t.i18n._("Administrative Contact"),e,s),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!1,layout_name:"global_user",show_search_inputs:!0,set_empty:!0,field:"billing_contact",customSearchFilter:function(p){return i.setCompanyIdFilter(p)}}),this.addEditFieldToColumn(t.i18n._("Billing Contact"),e,s),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX),e.AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!1,layout_name:"global_user",show_search_inputs:!0,set_empty:!0,field:"support_contact",customSearchFilter:function(p){return i.setCompanyIdFilter(p)}}),this.addEditFieldToColumn(t.i18n._("Primary Support Contact"),e,s);var c=this.edit_view_tab.find("#tab_password_policy"),m=c.find(".first-column");this.edit_view_tabs[1]=[],this.edit_view_tabs[1].push(m),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"password_policy_type_id"}),e.setSourceData(i.password_policy_type_array),this.addEditFieldToColumn(t.i18n._("Password Policy"),e,m,""),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"password_minimum_permission_level"}),e.setSourceData(i.password_minimum_permission_level_array),this.addEditFieldToColumn(t.i18n._("Minimum Permission Level"),e,m),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"password_minimum_strength"}),e.setSourceData(i.password_minimum_strength_array),this.addEditFieldToColumn(t.i18n._("Minimum Strength"),e,m),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"password_minimum_length",width:30}),this.addEditFieldToColumn(t.i18n._("Minimum Length"),e,m),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"password_minimum_age",width:30}),l=t("<div class='widget-h-box'></div>"),n=t("<span class='widget-right-label'> "+t.i18n._("in Days")+"</span>"),l.append(e),l.append(n),this.addEditFieldToColumn(t.i18n._("Minimum Age"),e,m,"",l),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"password_maximum_age",width:30}),l=t("<div class='widget-h-box'></div>"),n=t("<span class='widget-right-label'> "+t.i18n._("in Days")+"</span>"),l.append(e),l.append(n),this.addEditFieldToColumn(t.i18n._("Maximum Age"),e,m,"",l);var h=this.edit_view_tab.find("#tab_ldap"),_=h.find(".first-column");this.edit_view_tabs[2]=[],this.edit_view_tabs[2].push(_),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"ldap_authentication_type_id"}),e.setSourceData(i.ldap_authentication_type_array),this.addEditFieldToColumn(t.i18n._("LDAP Authentication"),e,_),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"ldap_host",width:240}),l=t("<div class='widget-h-box'></div>"),n=t("<span class='widget-right-label'> "+t.i18n._("(ie: ldaps://ldap.mycompany.com)")+"</span>"),l.append(e),l.append(n),this.addEditFieldToColumn(t.i18n._("Server"),e,_,"",l,!0),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"ldap_port",width:50}),l=t("<div class='widget-h-box'></div>"),n=t("<span class='widget-right-label'> "+t.i18n._("(ie: 389 or 636 for SSL)")+"</span>"),l.append(e),l.append(n),this.addEditFieldToColumn(t.i18n._("Port"),e,_,"",l,!0),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"ldap_bind_user_name"}),l=t("<div class='widget-h-box'></div>"),n=t("<span class='widget-right-label'> "+t.i18n._("Used to search for the user, for anonymous binding enter: anonymous")+"</span>"),l.append(e),l.append(n),this.addEditFieldToColumn(t.i18n._("Bind User Name"),e,_,"",l,!0),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"ldap_bind_password"}),this.addEditFieldToColumn(t.i18n._("Bind Password"),e,_,"",null,!0),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"ldap_base_dn",width:300}),l=t("<div class='widget-h-box'></div>"),n=t("<span class='widget-right-label'> "+t.i18n._("(ie: DC=companyname,DC=com)")+"</span>"),l.append(e),l.append(n),this.addEditFieldToColumn(t.i18n._("Base DN"),e,_,"",l,!0),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"ldap_bind_attribute",width:150}),l=t("<div class='widget-h-box'></div>"),n=t("<span class='widget-right-label'> "+t.i18n._("For binding the LDAP user. (ie: userPrincipalName)")+"</span>"),l.append(e),l.append(n),this.addEditFieldToColumn(t.i18n._("Bind Attribute"),e,_,"",l,!0),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"ldap_user_filter",width:150}),l=t("<div class='widget-h-box'></div>"),n=t("<span class='widget-right-label'> "+t.i18n._("Additional filter parameters. (ie: is_timetrex_user=1)")+"</span>"),l.append(e),l.append(n),this.addEditFieldToColumn(t.i18n._("User Filter"),e,_,"",l,!0),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"ldap_login_attribute",width:150}),l=t("<div class='widget-h-box'></div>"),n=t("<span class='widget-right-label'> "+t.i18n._("For searching the LDAP user. (ie: sAMAccountName or userPrincipalName)")+"</span>"),l.append(e),l.append(n),this.addEditFieldToColumn(t.i18n._("Login Attribute"),e,_,"",l,!0);var y=this.edit_view_tab.find("#tab_saml"),r=y.find(".first-column");this.edit_view_tabs[3]=[],this.edit_view_tabs[3].push(r),e=Global.loadWidgetByName(FormItemType.COMBO_BOX),e.TComboBox({field:"saml_authentication_type_id"}),e.setSourceData(i.saml_authentication_type_array),this.addEditFieldToColumn(t.i18n._("SAML Authentication"),e,r,"",null,!0),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"saml_acs_url",width:"100%"});var l=t("<div class='widget-h-box' style='width: 100%;'></div>"),u=t(' <img style="margin-left: 5px; position: absolute; cursor: pointer; width: 20px; height: 20px;" src="'+Global.getRealImagePath("css/global/widgets/ribbon/icons/copy-35x35.png")+'">');u.click(function(){i.copyURL("saml_acs_url")}),l.append(e),l.append(u),this.addEditFieldToColumn(LocalCacheData.getLoginData().application_name+" "+t.i18n._("Reply (ACS) URL"),e,r,"",l,!0,!0),e.parent().parent().width("45%"),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"saml_logout_redirect",width:"100%"});var l=t("<div class='widget-h-box' style='width: 100%;'></div>"),u=t(' <img style="margin-left: 5px; position: absolute; cursor: pointer; width: 20px; height: 20px;" src="'+Global.getRealImagePath("css/global/widgets/ribbon/icons/copy-35x35.png")+'">');u.click(function(){i.copyURL("saml_logout_redirect")}),l.append(e),l.append(u),this.addEditFieldToColumn(LocalCacheData.getLoginData().application_name+" "+t.i18n._("Logout Redirect URL"),e,r,"",l,!0,!0),e.parent().parent().width("45%"),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"saml_idp_entity_id",width:"100%"}),this.addEditFieldToColumn(t.i18n._("Issuer (Entity ID) URL"),e,r,"",null,!0,!0),e.parent().width("45%"),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"saml_idp_sso_url",width:"100%"}),this.addEditFieldToColumn(t.i18n._("Login (SSO) URL"),e,r,"",null,!0,!0),e.parent().width("45%"),e=Global.loadWidgetByName(FormItemType.TEXT_INPUT),e.TTextInput({field:"saml_idp_slo_url",width:"100%"}),this.addEditFieldToColumn(t.i18n._("Logout (SLO) URL"),e,r,"",null,!0,!0),e.parent().width("45%"),e=Global.loadWidgetByName(FormItemType.TEXT_AREA),e.TTextArea({field:"saml_idp_x509_certificate",width:"100%",height:350}),this.addEditFieldToColumn(t.i18n._("X.509 Certificate"),e,r,"",null,!0,!0),e.parent().width("45%")}setCompanyIdFilter(i){var a=this.current_edit_record.id;return a||(a=-1),i?i.filter_data?i.filter_data.company_id=a:i.filter_data={company_id:a}:i={filter_data:{company_id:a}},i}setCurrentEditRecordData(){for(var i in this.current_edit_record){var a=this.edit_view_ui_dic[i];if(Global.isSet(a))switch(i){case"country":this.setCountryValue(a,i);break;default:a.setValue(this.current_edit_record[i]);break}}this.collectUIDataToCurrentEditRecord(),this.current_edit_record.saml_sp_json?this.setSAMLSpValue(this.current_edit_record.saml_sp_json):this.setSAMLSpValue({}),this.setEditViewDataDone()}setEditViewDataDone(){super.setEditViewDataDone(),this.onTypeChange()}onTypeChange(){this.current_edit_record.ldap_authentication_type_id==1||this.current_edit_record.ldap_authentication_type_id==2?(this.attachElement("ldap_host"),this.attachElement("ldap_port"),this.attachElement("ldap_bind_user_name"),this.attachElement("ldap_bind_password"),this.attachElement("ldap_base_dn"),this.attachElement("ldap_bind_attribute"),this.attachElement("ldap_user_filter"),this.attachElement("ldap_login_attribute")):(this.detachElement("ldap_host"),this.detachElement("ldap_port"),this.detachElement("ldap_bind_user_name"),this.detachElement("ldap_bind_password"),this.detachElement("ldap_base_dn"),this.detachElement("ldap_bind_attribute"),this.detachElement("ldap_user_filter"),this.detachElement("ldap_login_attribute")),this.current_edit_record.saml_authentication_type_id==20?(this.attachElement("saml_idp_entity_id"),this.attachElement("saml_idp_sso_url"),this.attachElement("saml_idp_slo_url"),this.attachElement("saml_idp_x509_certificate"),this.attachElement("saml_acs_url"),this.attachElement("saml_logout_redirect")):(this.detachElement("saml_idp_entity_id"),this.detachElement("saml_idp_sso_url"),this.detachElement("saml_idp_slo_url"),this.detachElement("saml_idp_x509_certificate"),this.detachElement("saml_acs_url"),this.detachElement("saml_logout_redirect")),this.editFieldResize()}setSAMLSpValue(i){for(let a of this.saml_authentication_field_array){let o=i[a.id]?i[a.id]:null;this.edit_view_ui_dic[a.id].setValue(o),this.current_edit_record[a.id]=o}this.edit_view_ui_dic.saml_acs_url.setValue(Global.getBaseURL("../../",!1)+"api/saml/api.php?action=acs"),this.edit_view_ui_dic.saml_acs_url.setEnabled(!1),this.edit_view_ui_dic.saml_logout_redirect.setValue(Global.getBaseURL("../../",!1)+"api/saml/api.php?action=slo_redirect"),this.edit_view_ui_dic.saml_logout_redirect.setEnabled(!1),this.onTypeChange()}uniformVariable(i){i.saml_sp_json||(i.saml_sp_json={});for(let a of this.saml_authentication_field_array)i.saml_sp_json[a.id]=this.edit_view_ui_dic[a.id]?this.edit_view_ui_dic[a.id].getValue():null;return i}setProvince(i,a){var o=this;!i||i==="-1"||i==="0"?(o.province_array=[],this.adv_search_field_ui_dic.province.setSourceData([]),this.basic_search_field_ui_dic.province.setSourceData([])):this.api.getOptions("province",i,{onResult:function(d){d=d.getResult(),d||(d=[]),o.province_array=Global.buildRecordArray(d),o.adv_search_field_ui_dic.province.setSourceData(o.province_array),o.basic_search_field_ui_dic.province.setSourceData(o.province_array)}})}eSetProvince(i,a){var o=this,d=o.edit_view_ui_dic.province;!i||i==="-1"||i==="0"?(o.e_province_array=[],d.setSourceData([])):this.api.getOptions("province",i,{onResult:function(s){s=s.getResult(),s||(s=[]),o.e_province_array=Global.buildRecordArray(s),a&&o.e_province_array.length>0&&(o.current_edit_record.province=o.e_province_array[0].value,d.setValue(o.current_edit_record.province)),d.setSourceData(o.e_province_array)}})}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:t.i18n._("Name"),in_column:1,field:"name",multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:t.i18n._("Short Name"),in_column:1,field:"short_name",multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:t.i18n._("Status"),in_column:1,field:"status_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:t.i18n._("Product Edition"),in_column:1,field:"product_edition_id",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:t.i18n._("Country"),in_column:2,field:"country",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.COMBO_BOX}),new SearchField({label:t.i18n._("Province/State"),in_column:2,field:"province",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:t.i18n._("City"),field:"city",basic_search:!0,adv_search:!0,in_column:2,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:t.i18n._("Created By"),in_column:2,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,script_name:"EmployeeView",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:t.i18n._("Updated By"),in_column:2,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,script_name:"EmployeeView",form_item_type:FormItemType.AWESOME_BOX})]}copyURL(i){var a=this.edit_view_ui_dic[i][0],o=document.createElement("textarea");o.value=a.value,document.body.appendChild(o),o.select(),document.execCommand("Copy"),o.remove(),TAlertManager.showAlert(t.i18n._("TimeTrex SAML URL copied to clipboard."))}}export{f as CompaniesViewController};
//# sourceMappingURL=CompaniesViewController-DWg0dQin.bundle.js.map
