import{j as s}from"./vendor-tTApdY0Y.bundle.js";import{l as _}from"./linkify-string.es-CAumhp2W.bundle.js";var E={message_control_api:null,event_bus:new TTEventBus({view_id:"embedded_message"}),init:function(d,i,l,e,a,n,u){var m={};m.filter_data={},m.filter_data.object_type_id=i,m.filter_data.object_id=d;var f=[];this.message_control_api=TTAPI.APIMessageControl;var p=this;this.message_control_api.getEmbeddedMessage(m,{onResult:function(g){if(!(!e||!n.from)){var r=g.getResult();if(Global.isArray(r)){s(e.find(".separate")).css("display","block"),l.messages=r;var b=s("<div></div>");for(var T in r){var t=r[T];t.status_id==10&&f.push(t.id);var y=t.from_first_name+" "+t.from_last_name+" @ "+t.updated_date;n.from.setValue(y),n.subject.setValue(Global.htmlDecode(t.subject)),n.body.html(_(Global.htmlDecode(t.body),{target:"_blank",nl2br:!0,className:"linkified"})),n.body.setResizeEvent();var o=s(a.find("#tab_request").find(".edit-view-tab").find(".embedded-message-template")).clone();o.removeClass("embedded-message-template"),o.addClass("embedded-message-container"),o.css("display","block"),o.css("margin","0px"),o.appendTo(b)}f.length>0&&p.message_control_api.markRecipientMessageAsRead(f,{onResult:function(c){p.event_bus.emit("tt_topbar","profile_pending_counts",{object_types:["notification","message"]})}}),s(a.find("#tab_request").find(".edit-view-tab").find(".embedded-message-column")).hide(),a.find("#tab_request").find(".edit-view-tab").find(".embedded-message-container").hide(),a.find("#tab_request").find(".edit-view-tab").find(".embedded-message-container").remove(),a.find("#tab_request").find(".edit-view-tab").append(b.html())}else s(e.find(".separate")).css("display","none");u()}}})},initUI:function(d,i){var l=i.find(".separate").css("display","none"),e=Global.loadWidgetByName(FormItemType.SEPARATED_BOX);e.SeparatedBox({label:s.i18n._("Messages")}),d.addEditFieldToColumn(null,e,l);var a=i.find(".embedded-message-template");e=Global.loadWidgetByName(FormItemType.TEXT),e.TText({field:"from",selected_able:!0}),d.addEditFieldToColumn(s.i18n._("From"),e,a,""),e=Global.loadWidgetByName(FormItemType.TEXT),e.TText({field:"subject",selected_able:!0}),d.addEditFieldToColumn(s.i18n._("Subject"),e,a),e=Global.loadWidgetByName(FormItemType.TEXT),e.TText({field:"body",width:600,height:400,selected_able:!0}),d.addEditFieldToColumn(s.i18n._("Body"),e,a,"",null,null,!0),d.edit_view_tabs[0].push(a),a.css("display","none")},reply:function(d,i,l){this.message_control_api.setMessageControl(d,!1,i,{onResult:function(e){l&&l(e)}})}};export{E as EmbeddedMessage};
//# sourceMappingURL=EmbeddedMessageCommon-DY_cePqF.bundle.js.map
