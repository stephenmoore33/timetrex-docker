import{_ as f,j as a}from"./vendor-tTApdY0Y.bundle.js";class W extends BaseWizardController{constructor(r={}){f.defaults(r,{el:".wizard-bg"}),super(r)}init(r){this.title=a.i18n._("Job Invoice Wizard"),this.steps=3,this.current_step=1,this.render()}render(){super.render(),this.initCurrentStep()}buildCurrentStepUI(){var r=this;switch(this.content_div.empty(),this.stepsWidgetDic[this.current_step]={},this.current_step){case 1:var e=this.getLabel();e.text(a.i18n._("Select one or more jobs you wish to invoice"));var t=this.getAComboBox(TTAPI.APIJob,!0,"global_job","job_id",!0),i=a("<div class='wizard-acombobox-div'></div>");i.append(t),this.content_div.append(e),this.content_div.append(i),this.stepsWidgetDic[this.current_step][t.getField()]=t;break;case 2:e=this.getLabel(),e.text(a.i18n._("Select the date range you wish to invoice jobs for")),this.content_div.append(e);var s=a(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html")),n=s.find(".form-item-label"),d=s.find(".form-item-input-div"),p=this.getComboBox("time_period",!0);n.text(a.i18n._("Time Period")),d.append(p),this.content_div.append(s),s=a(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html")),n=s.find(".form-item-label"),d=s.find(".form-item-input-div");var c=this.getDatePicker("start_date");n.text(a.i18n._("Start Date")),d.append(c),this.content_div.append(s),s=a(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html")),n=s.find(".form-item-label"),d=s.find(".form-item-input-div");var h=this.getDatePicker("end_date");n.text(a.i18n._("End Date")),d.append(h),this.content_div.append(s),s=a(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html")),n=s.find(".form-item-label"),d=s.find(".form-item-input-div");var u=this.getAComboBox(TTAPI.APIPayPeriod,!0,"global_Pay_period","pay_period_id");n.text(a.i18n._("Pay Period")),d.append(u),this.content_div.append(s),s=a(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html")),n=s.find(".form-item-label"),d=s.find(".form-item-input-div");var g=this.getAComboBox(TTAPI.APIPayPeriodSchedule,!0,"global_pay_period_schedule","pay_period_schedule_id");n.text(a.i18n._("Pay Period Schedule")),d.append(g),this.content_div.append(s),p.bind("formItemChange",function(P,y){r.onTimePeriodChange(y)});var D=this.getLabel();D.text(a.i18n._("Select the date to be displayed on the invoice")),this.content_div.append(D);var v=this.getDatePicker("effective_date");this.content_div.append(v),this.stepsWidgetDic[this.current_step][p.getField()]=p,this.stepsWidgetDic[this.current_step][v.getField()]=v,this.stepsWidgetDic[this.current_step][c.getField()]=c,this.stepsWidgetDic[this.current_step][h.getField()]=h,this.stepsWidgetDic[this.current_step][u.getField()]=u,this.stepsWidgetDic[this.current_step][g.getField()]=g,r.onTimePeriodChange(p);break;case 3:e=this.getLabel(),e.text(a.i18n._("Please select invoice options")),i=a('<div style="text-align: left;margin-left: 15px;"></div>'),this.content_div.append(e);var o=r.getCheckBox("create_invoices"),l=a('<label class="wizard-checkbox-label" style="display: block;">'+a.i18n._("Create Invoices")+"</label>");l.prepend(o),i.append(l),this.stepsWidgetDic[this.current_step][o.getField()]=o,o=r.getCheckBox("include_pending_transactions"),l=a('<label class="wizard-checkbox-label" style="display: block;">'+a.i18n._("Include all non-invoiced transactions in the same date range")+"</label>"),l.prepend(o),i.append(l),this.stepsWidgetDic[this.current_step][o.getField()]=o,o=r.getCheckBox("overwrite_duplicate_transactions"),l=a('<label class="wizard-checkbox-label" style="display: block;">'+a.i18n._("Overwrite already existing duplicate transactions")+"</label>"),l.prepend(o),i.append(l),this.stepsWidgetDic[this.current_step][o.getField()]=o,this.content_div.append(i);break}}onTimePeriodChange(r){var e=r.getValue(),t=this.stepsWidgetDic[this.current_step].start_date.parent().parent(),i=this.stepsWidgetDic[this.current_step].end_date.parent().parent(),s=this.stepsWidgetDic[this.current_step].pay_period_id.parent().parent(),n=this.stepsWidgetDic[this.current_step].pay_period_schedule_id.parent().parent();e==="custom_date"?(t.css("display","block"),i.css("display","block"),s.css("display","none"),n.css("display","none")):e==="custom_pay_period"?(t.css("display","none"),i.css("display","none"),s.css("display","block"),n.css("display","none")):e==="this_pay_period"||e==="last_pay_period"||e==="to_last_pay_period"||e==="to_this_pay_period"?(t.css("display","none"),i.css("display","none"),s.css("display","none"),n.css("display","block")):(t.css("display","none"),i.css("display","none"),s.css("display","none"),n.css("display","none"))}buildCurrentStepData(){var r=this,e=this.stepsDataDic[this.current_step],t=this.stepsWidgetDic[this.current_step];switch(this.current_step){case 1:if(e)for(var i in e)e.hasOwnProperty(i)&&t[i].setValue(e[i]);else for(var i in t)t.hasOwnProperty(i)&&t[i].setValue(-1);break;case 2:TTAPI.APIJobSummaryReport.getOptions("time_period",{onResult:function(s){if(t.time_period.setSourceData(Global.buildRecordArray(s.getResult())),e)for(var d in e)e.hasOwnProperty(d)&&t[d].setValue(e[d]);else{var n=new Date;t.effective_date.setValue(n.format()),t.time_period.setValue("today")}r.onTimePeriodChange(t.time_period)}});break;case 3:if(e)for(var i in e)e.hasOwnProperty(i)&&t[i].setValue(e[i]);else for(var i in t)t.hasOwnProperty(i)&&t[i].setValue(!0);break;default:for(var i in e)e.hasOwnProperty(i)&&t[i].setValue(e[i]);break}}onDoneClick(){var r=this;super.onDoneClick(),this.saveCurrentStep();var e={};e.time_period=this.stepsDataDic[2].time_period;for(var t in this.stepsDataDic[2])!this.stepsDataDic[2].hasOwnProperty([t])||t==="time_period"||t==="effective_date"||(e[t]=this.stepsDataDic[2][t]);var i=this.stepsDataDic[2].effective_date,s=this.stepsDataDic[1].job_id,n={};n.create_invoices=this.stepsDataDic[3].create_invoices,n.include_pending_transactions=this.stepsDataDic[3].include_pending_transactions,n.overwrite_duplicate_transactions=this.stepsDataDic[3].overwrite_duplicate_transactions,TTAPI.APIJob.generateInvoices(e,i,s,n,{onResult:function(d){if(d&&d.isValid()){var p=d.getAttributeInAPIDetails("user_generic_status_batch_id");p&&TTUUID.isUUID(p)&&p!=TTUUID.zero_id&&p!=TTUUID.not_exist_id&&UserGenericStatusWindowController.open(p,[LocalCacheData.getLoginUser().id])}r.onCloseClick(),r.call_back&&r.call_back()}})}saveCurrentStep(){this.stepsDataDic[this.current_step]={};var r=this.stepsDataDic[this.current_step],e=this.stepsWidgetDic[this.current_step];switch(this.current_step){case 2:for(var t in e)e.hasOwnProperty(t)&&e[t].is(":visible")&&(r[t]=e[t].getValue());break;default:for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t].getValue());break}}setDefaultDataToSteps(){if(!this.default_data)return null}}export{W as JobInvoiceWizardController};
//# sourceMappingURL=JobInvoiceWizardController-Bda8IW1P.bundle.js.map
