import{_ as v,j as a}from"./vendor-tTApdY0Y.bundle.js";class f extends BaseWizardController{constructor(s={}){v.defaults(s,{el:".wizard-bg",api_permission:null}),super(s)}init(s){this.title=a.i18n._("Permission Wizard"),this.steps=3,this.current_step=1,this.render()}render(){super.render(),this.api_permission=TTAPI.APIPermission,this.initCurrentStep()}buildCurrentStepUI(){var s=this;switch(this.content_div.empty(),this.stepsWidgetDic[this.current_step]={},this.current_step){case 1:var t=this.getLabel();t.text(a.i18n._("Choose role and permission actions")),this.content_div.append(t);var e=a(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html")),r=e.find(".form-item-label"),i=e.find(".form-item-input-div"),n=this.getComboBox("role",!1);r.text(a.i18n._("Role")),i.append(n),this.content_div.append(e),e=a(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html")),r=e.find(".form-item-label"),i=e.find(".form-item-input-div");var o=this.getAComboBox(null,!0,"global_option_column","permission",!1,"value");r.text(a.i18n._("Permissions")),i.append(o),this.content_div.append(e),this.stepsWidgetDic[this.current_step][n.getField()]=n,this.stepsWidgetDic[this.current_step][o.getField()]=o;break;case 2:t=this.getLabel(),t.text(a.i18n._("Choose modules and sub-modules")),this.content_div.append(t),e=a(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html")),r=e.find(".form-item-label"),i=e.find(".form-item-input-div");var l=this.getAComboBox(null,!0,"global_option_column","section_group",!1,"value");r.text(a.i18n._("Modules")),i.append(l),this.content_div.append(e),e.bind("formItemChange",function(D,h){var g=h.getValue();s.setSection(g,!0)}),e=a(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html")),r=e.find(".form-item-label"),i=e.find(".form-item-input-div");var c=this.getAComboBox(null,!0,"global_option_column","section",!1,"value");r.text(a.i18n._("Sub-Modules")),i.append(c),this.content_div.append(e),this.stepsWidgetDic[this.current_step][l.getField()]=l,this.stepsWidgetDic[this.current_step][c.getField()]=c;break;case 3:t=this.getLabel(),t.text(a.i18n._("Would you like to allow, deny or simply highlight the chosen permissions")),this.content_div.append(t);var p=a('<input type="radio" name="action" id="allow" value="allow"><label for="allow">Allow </label>'),d=a('<input type="radio" name="action" id="deny" value="deny"><label for="deny">Deny </label>'),u=a('<input type="radio" name="action" id="highlight" value="highlight"><label for="highlight">Highlight Only </label>');this.content_div.append(p),this.content_div.append(d),this.content_div.append(u),this.stepsWidgetDic[this.current_step].allow=p,this.stepsWidgetDic[this.current_step].deny=d,this.stepsWidgetDic[this.current_step].highlight=u;break}}setSection(s,t){var e=this.stepsWidgetDic[this.current_step];this.api_permission.getSectionBySectionGroup(s,{onResult:function(r){var i=Global.buildRecordArray(r.getResult());e.section.setSourceData(i),t&&e.section.setValue(i)}})}buildCurrentStepData(){var s=this,t=this.stepsDataDic[this.current_step],e=this.stepsWidgetDic[this.current_step];switch(this.current_step){case 1:this.api_permission.getOptions("preset",{onResult:function(r){var i=Global.buildRecordArray(r.getResult());if(i.unshift({value:0,label:a.i18n._("CUSTOM")}),e.role.setSourceData(i),t&&e.role.setValue(t.role),LocalCacheData.current_open_primary_controller.current_edit_record&&LocalCacheData.current_open_primary_controller.current_edit_record.name){var n=LocalCacheData.current_open_primary_controller.current_edit_record.name.toLowerCase();for(var o in i)if(i[o].label.toLowerCase()==n){e.role.setSelectedIndex(o);break}}}}),this.api_permission.getOptions("common_permissions",{onResult:function(r){var i=Global.buildRecordArray(r.getResult());e.permission.setSourceData(i),t?e.permission.setValue(t.permission):e.permission.setValue(i)}});break;case 2:this.api_permission.getOptions("section_group",{onResult:function(r){var i=Global.buildRecordArray(r.getResult());e.section_group.setSourceData(i),t?t.section_group&&t.section_group.length>0&&(e.section_group.setValue(t.section_group),s.setSection(t.section_group),e.section.setValue(t.section)):(e.section_group.setValue(i[0].value),s.setSection(i[0].value,!0))}});break;case 3:t?e[t.action].prop("checked","checked"):e.allow.prop("checked","checked");break}}onDoneClick(){var s=this;super.onDoneClick(),this.saveCurrentStep();var t=this.stepsDataDic[1].role,e=this.stepsDataDic[2].section,r=this.stepsDataDic[1].permission,i=this.stepsDataDic[3].action;this.api_permission.filterPresetPermissions(t,e,r,{onResult:function(n){n.isValid?(s.onCloseClick(),s.call_back&&s.call_back(n.getResult(),i)):(TAlertManager.showErrorAlert(n),s.onCloseClick())}})}saveCurrentStep(){this.stepsDataDic[this.current_step]={};var s=this.stepsDataDic[this.current_step],t=this.stepsWidgetDic[this.current_step];switch(this.current_step){case 3:for(var e in t)t.hasOwnProperty(e)&&(t[e].prop("checked")||t[e][0].checked===!0)&&(s.action=e);break;default:for(var e in t)t.hasOwnProperty(e)&&(s[e]=t[e].getValue());break}}setDefaultDataToSteps(){if(!this.default_data)return null}}export{f as PermissionWizardController};
//# sourceMappingURL=PermissionWizardController-BB4kNJjI.bundle.js.map
